---
title: Построитель моделей и принципы его работы
description: Сведения об использовании построителя моделей ML.NET для автоматического обучения модели машинного обучения
author: natke
ms.date: 06/26/2019
ms.custom: overview
ms.openlocfilehash: 6f5bbe3c389e3ca42550a48ef3e6edbc963ac2e9
ms.sourcegitcommit: 52e588dc2ee74d484cd07ac60076be25cbf777ab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2019
ms.locfileid: "67410592"
---
# <a name="what-is-model-builder-and-how-does-it-work"></a>Построитель моделей и принципы его работы

Построитель моделей ML.NET — это понятное графическое расширение Visual Studio для создания, обучения и развертывания пользовательских моделей машинного обучения. 

Построитель моделей использует автоматизированное машинное обучение (AutoML) для анализа различных алгоритмов и параметров машинного обучения и выбора наиболее подходящих из них для конкретного сценария.

Для работы с построителем моделей не нужно быть экспертом в области машинного обучения. Все, что требуется, — это данные и проблема, которую нужно решить. Построитель моделей генерирует код для добавления модели в приложение .NET.

![Анимация: пользовательский интерфейс расширения "Построитель моделей" для Visual Studio](media/ml-dotnet-model-builder.gif)

> [!NOTE]
> Построитель моделей в настоящее время находится на этапе предварительной версии.

## <a name="scenarios"></a>Сценарии

Построитель моделей может создавать модели машинного обучения для приложения на основе множества различных сценариев.

Сценарий описывает тип прогноза, который нужно сделать на основе данных. Например:
- прогнозирование будущего объема продаж продукта на основе исторических данных по продажам;
- классификация тональности как положительной или отрицательной на основе отзывов клиентов;
- определение того, является ли банковская операция мошеннической;
- направление проблем, с которыми обращаются клиенты, на рассмотрение соответствующим сотрудникам компании.

В построителе моделей сценарий необходимо сопоставить с [задачей ML.NET](resources/tasks.md). Построитель моделей можно использовать для **регрессии** (прогнозирования чисел) и **классификации** (прогнозирования категорий).

### <a name="which-machine-learning-scenario-is-right-for-me"></a>Выбор подходящего сценария машинного обучения

В построителе моделей доступны шаблоны для анализа тональности, классификации проблем, прогнозирования цен и пользовательских сценариев. Их можно использовать в качестве отправной точки для конкретного сценария ML.NET.

#### <a name="sentiment-analysis-binary-classification"></a>Анализ тональности (двоичная классификация)

Анализ тональности можно использовать для определения положительной или отрицательной тональности отзыва клиента. Это пример задачи двоичной классификации.

Двоичная классификация служит для разделения данных на две категории (да или нет, успех или неудача, истина или ложь, положительные или отрицательные). Она позволяет получить ответ на такие вопросы:

- Является ли сообщение электронной почты спамом? (обнаружение спама)
- Кто из подавших заявление подходит на вакансию? (предварительный отбор кандидатов)
- Кто из клиентов может не оплатить счета вовремя? (устранение рисков)
- Является ли операция с кредитной картой мошеннической? (обнаружение мошенничества)

Если ваш сценарий требует классификации на две категории, вы можете использовать этот шаблон со своим набором данных.
 
#### <a name="issue-classification-multiclass-classification"></a>Классификация проблем (мультиклассовая классификация)

С помощью классификации проблем можно разделять проблемы, о которых сообщают клиенты (например, на GitHub), на категории исходя из их названий и описаний. Это пример задачи многоклассовой классификации.

Многоклассовая классификация служит для разделения данных на три или более категорий. Она позволяет получить ответ на такие вопросы:

- В какой отдел следует перенаправить запрос в службу поддержки? (перенаправление запросов в службу поддержки)
- Каков приоритет проблемы клиента? (определение приоритетов проблем клиентов)
- К какой категории относится продукт? (классификация продуктов)
- К какому типу относится документ? (классификация документов и сообщений электронной почты)

Шаблон многоклассовой классификации можно использовать для сценария, который предполагает разделение данных на три или более категорий.

#### <a name="price-prediction-regression"></a>Прогнозирование цен (регрессия)

С помощью прогнозирования цен можно прогнозировать цены на недвижимость исходя из местоположения, площади и других характеристик объекта недвижимости. Это пример задачи регрессии.

Регрессия служит для прогнозирования числовых значений. Она позволяет получить ответ на такие вопросы:

- По какой цене можно продать дом? (прогнозирование цен)
- Через какое время механическая деталь потребует обслуживания? (прогнозное обслуживание)
- Сколько влаги содержится в этом осушителе? (мониторинг оборудования)
- Каков будет общий годовой объем продаж в этом регионе? (прогнозирование продаж)

Шаблон прогнозирования цен можно использовать для сценария, который предполагает прогнозирование числовых значений на основе собственного набора данных.

#### <a name="custom-scenario-choose-your-task"></a>Пользовательский сценарий (выбор собственной задачи)

Пользовательский сценарий позволяет выбрать собственную задачу. Выберите сценарий, который лучше всего подходит для вашей проблемы.

Пользовательский сценарий позволяет выбрать собственную задачу машинного обучения. В предыдущих шаблонах задачи машинного обучения были ограничены сценариями двоичной классификации, многоклассовой классификации и регрессии. Этот шаблон дает возможность выбрать любую задачу машинного обучения, требуемую для анализа ваших данных.

## <a name="data"></a>Данные

После того как вы сопоставите сценарий с задачей, построитель моделей попросит вас предоставить набор данных. Данные используются для обучения, оценки и выбора оптимальной модели для сценария. Кроме того, необходимо выбрать результат, который требуется спрогнозировать.

### <a name="choose-the-output-to-predict-label"></a>Выбор результата для прогнозирования (метка)

Набор данных — это таблица, строки которой содержат образцы для обучения, а столбцы — атрибуты. В каждой строке есть:
- **метка** (атрибут, который нужно спрогнозировать);
- **признаки** (атрибуты, исходя из которых прогнозируется метка).

В сценарии прогнозирования цен на недвижимость признаками могут быть:
- площадь дома;
- количество спален и ванных комнат;
- почтовый индекс.

Метка — это историческая цена на дом данной площади, с данным количеством спален и ванных комнат, а также почтовым индексом.

![Таблица цен на недвижимость, содержащая признаки (площадь, количество комнат, почтовый индекс) и метку (цена)](media/model-builder-data.png)

### <a name="data-formats"></a>Форматы данных

В построителе моделей на данные налагаются указанные ниже ограничения.

- Данные должны храниться в файле (CSV или TSV со строкой заголовков) или в базе данных SQL на сервере.
- Максимальный размер набора данных для обучения составляет 1 ГБ.
- На сервере SQL максимальное количество строк для обучения составляет 100 000.
- Перед обучением данные копируются с сервера SQL на локальный компьютер.

### <a name="example-datasets"></a>Примеры наборов данных

Если у вас нет собственного набора данных, можно воспользоваться одним из следующих:

|Сценарий|Задача машинного обучения|Данные|Метка|Функции|
|-|-|-|-|-|
|Прогнозирование цен|регрессия;|[данные по платам за такси](https://github.com/dotnet/machinelearning-samples/blob/master/datasets/taxi-fare-train.csv)|Плата|Время поездки, расстояние|
|Обнаружение аномалий|двоичная классификация;|[данные по продажам продуктов](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/AnomalyDetection_Sales/SpikeDetection/Data/product-sales.csv)|Продажи продукта|Месяц.|
|Анализ мнений|двоичная классификация;|[данные по комментариям на веб-сайте](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/BinaryClassification_SentimentAnalysis/SentimentAnalysis/Data/wikiDetoxAnnotated40kRows.tsv)|Метка (0 — отрицательная тональность, 1 — положительная)|Комментарий, год|
|Обнаружение мошенничества.|двоичная классификация;|[данные по кредитным картам](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/BinaryClassification_CreditCardFraudDetection/CreditCardFraudDetection.Trainer/assets/input/creditcardfraud-dataset.zip)|Класс (1 — мошенничество, 0 — нет)|Сумма, V1–V28 (анонимизированные признаки)|
|Классификация текста|классификация по нескольким классам.|[Данные по проблемам на GitHub](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/end-to-end-apps/MulticlassClassification-GitHubLabeler/GitHubLabeler/Data/corefx-issues-train.tsv)|Область|Название, описание|

## <a name="train"></a>Обучение

После выбора сценария, данных и метки построитель моделей обучает модель.

### <a name="what-is-training"></a>Сведения об обучении

Обучение — это автоматический процесс, посредством которого построитель моделей учит модель отвечать на вопросы в рамках сценария. После обучения модель может делать прогнозы на основе новых входных данных. Например, если модель прогнозирует цены на недвижимость и на рынке появляется новый дом, она может спрогнозировать цену его продажи.

Так как построитель моделей использует автоматизированное машинное обучение (AutoML), во время обучения вводить данные или производить настройку не нужно.

### <a name="how-long-should-i-train-for"></a>Требуемая длительность обучения

Вы можете указать время обучения. Как правило, чем дольше длится обучение, тем точнее получается модель. Кроме того, время обучения растет с увеличением размера набора данных для обучения. В таблице ниже приводится примерное время обучения в зависимости от размера набора данных.

Размер набора данных  | Тип набора данных       | Среднее Время обучения
------------- | ------------------ | --------------
0–10 МБ     | Числа и текст   | 10 с
10–100 МБ   | Числа и текст   | 10 мин 
100–500 МБ  | Числа и текст   | 30 мин 
500 МБ — 1 ГБ    | Числа и текст   | 60 мин 
Более 1 ГБ         | Числа и текст   | Более 3 часов 

Время обучения также зависит от следующих факторов:

- тип столбцов (текстовые или числовые);
- тип задачи машинного обучения (регрессия или классификация);
- количество строк, используемых для обучения;
- количество столбцов признаков, используемых для обучения.

Построитель моделей был протестирован на наборах данных размером до 1 ТБ, однако при таком максимальном размере на создание модели может уйти до четырех дней.

## <a name="evaluate"></a>Оценка

Оценка — это процесс использования обученной модели для составления прогнозов на основе новых данных с последующим измерением их точности.

Построитель моделей разделяет обучающие данные на набор для обучения и тестовый набор. Обучающие данные (80 %) служат для обучения модели, а тестовые (20 %) резервируются для ее оценки.  Метрики, используемые для оценки, зависят от задачи машинного обучения. Дополнительные сведения см. в статье [Метрики оценки модели](resources/metrics.md).  

### <a name="sentiment-analysis-binary-classification"></a>Анализ тональности (двоичная классификация)

Метрика по умолчанию для задач двоичной классификации — **точность**. Точность — это доля правильных прогнозов, которые модель делает на основе тестового набора данных. **Чем ближе она к 100 %, тем лучше**.

Чтобы модель считалась приемлемой, другие метрики, например площадь под кривой, которая представляет собой отношение доли истинно положительных результатов к доле ложноположительных результатов, должны превышать 0,5. 

Для достижения оптимального соотношения между точностью (отношением числа правильных прогнозов к общему числу прогнозов данного класса) и полнотой (отношением числа правильных прогнозов к общему числу элементов данного класса) можно использовать дополнительные метрики, например оценку F1.

### <a name="issue-classification-multiclass-classification"></a>Классификация проблем (мультиклассовая классификация)

Метрика по умолчанию для задач многоклассовой классификации — **микроточность**. **Чем ближе она к 100 %, тем лучше**.

Для задач классификации данных на несколько категорий существуют два вида точности.

- Микроточность — это доля прогнозов, которые являются правильными для всех экземпляров. В сценарии классификации проблем микроточность — это доля проблем, которые были отнесены к правильной категории. 
- Макроточность — это средняя точность на уровне класса. В сценарии классификации проблем точность измеряется для каждой категории, а затем средние значения точности по каждой категории усредняются. Для этой метрики всем классам назначается одинаковый вес. Для идеально уравновешенных наборов данных (с одинаковым количеством образцов в каждой категории) микроточность и макроточность совпадают.


### <a name="price-prediction-regression"></a>Прогнозирование цен (регрессия)

Метрика по умолчанию для задач регрессии — **коэффициент детерминации**. Наилучшее возможное значение — 1. Чем ближе коэффициент детерминации к 1, тем лучше модель.

Другие метрики, такие как абсолютная потеря, квадратичная потеря и среднеквадратичная потеря, могут использоваться для анализа модели и ее сравнения с другими моделями регрессии. 

## <a name="improve"></a>Улучшение

Если точность модели недостаточно высока, можно сделать следующее:

* Увеличить время обучения. Чем дольше длится обучение, тем больше алгоритмов и параметров может опробовать система машинного обучения.

* Добавить больше данных. Иногда для подготовки качественной модели машинного обучения недостаточно данных. 

* Сбалансировать данные. Для задач классификации обучающий набор должен быть сбалансирован по всем категориям. Например, если имеются четыре класса для 100 образцов, причем первые два класса (тег1 и тег2) используются для 90 записей, а другие два (тег3 и тег4) — для остальных 10 записей, несбалансированность данных может сказаться на правильности прогнозирования классов тег3 и тег4.

## <a name="code"></a>Код

После этапа оценки построитель моделей предоставляет файл модели и код, с помощью которого можно добавить модель в свое приложение. Модели ML.NET сохраняются как ZIP-файлы. Код для загрузки и использования модели добавляется в решение как новый проект. Кроме того, построитель моделей добавляет для примера консольное приложение, которое можно запустить, чтобы увидеть модель в действии.

Построитель моделей также выводит код, использовавшийся для создания модели, чтобы можно было понять, как именно она формировалась. Код обучения модели можно использовать для повторного обучения на основе новых данных.

## <a name="whats-next"></a>Что дальше?

Попробуйте [сценарий прогнозирования цен или любой сценарий регрессии](tutorials/predict-prices-with-model-builder.md)
