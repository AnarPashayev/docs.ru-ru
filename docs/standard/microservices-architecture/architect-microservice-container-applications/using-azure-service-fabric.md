---
title: Использование Azure Service Fabric
description: Узнайте, какие модели приложения Azure Service Fabric можно использовать, кроме оркестрации контейнеров.
ms.date: 09/20/2018
ms.openlocfilehash: 3c629b473a429b64243b5756c96fef6585c939b7
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65644529"
---
# <a name="using-azure-service-fabric"></a>Использование Azure Service Fabric

Платформа Azure Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления готовых продуктов (зачастую монолитных) к предоставлению служб. При ее создании учитывался опыт разработки и эксплуатации масштабных служб, например базы данных SQL Azure, Azure Cosmos DB, служебной шины Azure или базы данных Кортаны. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

Service Fabric помогает решить сложные проблемы при разработке и запуске службы, связанные с эффективным использованием ресурсов инфраструктуры, что позволяет командам решать бизнес-задачи, применяя подход на основе микрослужб.

Service Fabric предоставляет два масштабных решения, которые позволяют создавать приложения в рамках подхода на основе микрослужб.

- Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, управления состоянием и мониторинга работоспособности. В сущности, эти системные службы позволяют задействовать множество характеристик микрослужб, описанных ранее.

- Программные интерфейсы (API) или платформы, позволяющие создавать приложения как микрослужбы: [надежные субъекты и надежные службы](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework). Для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами средств управления надежным состоянием.

Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные интерфейсы API, упрощающие создание микрослужб.

Как показано на рис. 4-27, вы можете создавать и запускать микрослужбы в Service Fabric как простые процессы или как контейнеры Docker. Микрослужбы на основе контейнеров можно также сочетать с микрослужбами на основе процессов в рамках одного кластера Service Fabric.

![Сравнение кластеров Azure Service Fabric: микрослужбы как процессы, где каждый узел выполняет один процесс для каждой микрослужбы; микрослужбы как контейнеры, где каждый узел выполняет Docker с несколькими контейнерами, один контейнер на микрослужбу.](./media/image30.png)

**Рис. 4-27**. Развертывание микрослужб в виде процессов или контейнеров в Azure Service Fabric

В кластерах Service Fabric на основе узлов Linux и Windows могут выполняться соответственно контейнеры Docker Linux и контейнеры Windows.

Актуальные сведения о поддержке контейнеров в Azure Service Fabric см. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

Service Fabric — это хороший пример платформы, которая позволяет определять логическую архитектуру (бизнес-микрослужбы или ограниченные контексты), отличную от физической реализации, как описано в разделе [Логическая и физическая архитектура](logical-versus-physical-architecture.md). Например, если вы реализуете [надежные службы с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction), которые представлены далее в разделе [Микрослужбы с отслеживанием и без отслеживания состояния](#stateless-versus-stateful-microservices), бизнес-микрослужба может состоять из нескольких физических служб.

Как показано на рис. 4-28, с точки зрения логической архитектуры микрослужб при создании надежной службы Service Fabric с отслеживанием состояния обычно требуется реализовать два уровня служб. Первый из них — это внутренняя надежная служба с отслеживанием состояния, которая обеспечивает работу нескольких разделов (каждый раздел является службой с отслеживанием состояния). Второй уровень — это внешняя служба или служба шлюза, которая отвечает за маршрутизацию и объединение данных в разных разделах или экземплярах служб с отслеживанием состояния. Служба шлюза также отвечает за взаимодействие с клиентом и выполнение повторных обращений к внутренней службе. Службой шлюза называется реализуемая вами пользовательская служба, но вы также можете использовать готовую [службу обратного прокси-сервера](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy) Service Fabric.

![](./media/image31.png)

**Рис. 4-28**. Бизнес-микрослужба с несколькими экземплярами службы с отслеживанием состояния и пользовательской внешней службой шлюза

В любом случае при использовании надежных служб Service Fabric с отслеживанием состояния у вас также есть логическая микрослужба или бизнес-микрослужба (ограниченный контекст), которая обычно состоит из нескольких физических служб. Каждую из служб шлюза и служб раздела можно реализовать как службу веб-API ASP.NET, как показано на рис. 4-28.

В Service Fabric службы можно объединять в группы и развертывать как [приложение Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-model), которое представляет собой модуль упаковки и развертывания для оркестратора или кластера. Таким образом, приложение Service Fabric можно сопоставить с автономной логической микрослужбой или ограниченным контекстом, чтобы развертывать службы в автономном режиме.

## <a name="service-fabric-and-containers"></a>Service Fabric и контейнеры

Вы также можете развертывать службы в образах контейнеров в кластере Service Fabric. Как показано на рис. 4-29, для каждой службы обычно имеется один контейнер.

![Приложение Service Fabric может выполнять несколько контейнеров, обращающихся к внешней базе данных, и весь набор будет логической границей бизнес-микрослужбы.](./media/image32.png)

**Рис. 4-29**. Бизнес-микрослужба с несколькими службами (контейнерами) в Service Fabric

Однако в Service Fabric также возможны так называемые "сцепленные" контейнеры (два контейнера, которые должны развертываться вместе в составе логической службы). Важным моментом является то, что бизнес-микрослужба — это логическая граница вокруг нескольких связанных элементов. Во многих случаях это может быть одна служба с единственной моделью данных, однако в других она может представлять собой несколько физических служб.

Имейте в виду, что вы можете сочетать службы в процессах и службы в контейнерах в рамках одного приложения Service Fabric, как показано на рис. 4-30.

![Приложение Service Fabric со службами и контейнерами в одном узле.](./media/image33.png)

**Рис. 4-30**. Бизнес-микрослужба, сопоставленная с приложением Service Fabric с контейнерами и службами с отслеживанием состояния

Дополнительные сведения о поддержке контейнеров в Azure Service Fabric см. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

## <a name="stateless-versus-stateful-microservices"></a>Микрослужбы с отслеживанием и без отслеживания состояния

Как уже упоминалось, у каждой микрослужбы (логического ограниченного контекста) должна быть своя модель предметной области (данные и логика). В случае микрослужб без отслеживания состояния базы данных будут внешними — с применением либо реляционных СУБД, таких как SQL Server, либо СУБД на основе NoSQL, например MongoDB или Azure Cosmos DB.

Однако сами службы могут поддерживать отслеживание состояния в Service Fabric, т. е. данные будут находиться в микрослужбе. Эти данные могут существовать не только на том же сервере, но и внутри процесса микрослужбы, в памяти, а также храниться на жестких дисках и реплицироваться в другие узлы. На рис. 4-30 показаны различные подходы.

![В службы без отслеживания состояния состояние (постоянное хранение, база данных) хранится за пределами микрослужбы. В службах с отслеживанием состояния состояние хранится внутри микрослужбы.](./media/image34.png)

**Рис. 4-31**. Микрослужбы с отслеживанием и без отслеживания состояния

Микрослужбы без отслеживания состояния — вполне допустимый подход, и он проще в реализации, чем микрослужбы с отслеживанием состояния, так как подобен традиционным и общеизвестным шаблонам. Но микрослужбы без отслеживания состояния вызывают задержку при взаимодействии процесса с источниками данных и вдобавок содержат больше "движущихся деталей", что осложняет повышение производительности за счет дополнительного кэша и очередей. Результат таков: вы можете получить более сложные архитектуры со слишком большим количеством уровней.

Напротив, [микрослужбы с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) могут показывать превосходство в сложных сценариях, поскольку при их использовании отсутствуют задержки во взаимодействии логики предметной области с данными. Интенсивная обработка данных, игровые серверы, базы данных как услуга и другие сценарии, требующие низкой задержки, — все они выигрывают от использования служб с отслеживанием состояния, обеспечивая локальное состояние для более быстрого доступа.

Службы без отслеживания состояния и с отслеживанием состояния дополняют друг друга. Например, на рис. 4-31 на схеме справа показано, что службу с отслеживанием состояния можно разбить на несколько разделов. Для доступа к этим разделам может потребоваться служба без отслеживания состояния, выступающая в роли службы шлюза и способная обращаться к каждому разделу с помощью ключей разделов.

У служб с отслеживанием состояния есть недостатки. Они повышают уровень сложности при необходимости их масштабирования. Функциональность, которая обычно реализовывалась бы в рамках внешней базы данных, должна обрабатывать такие операции, как репликация данных между микрослужбами с отслеживанием состояния и секционирование данных. Но это как раз одна из тех областей, где может помочь оркестратор, такой как [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-platform-architecture) с [надежными службами с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis). Он упрощает разработку и жизненный цикл микрослужб с отслеживанием состояния с помощью [API Reliable Services](https://docs.microsoft.com/azure/service-fabric/service-fabric-work-with-reliable-collections) и [Reliable Actors](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

К другим платформам микрослужб, которые допускают использование служб с отслеживанием состояния и поддерживают шаблон субъекта, повышая отказоустойчивость и снижая задержки при взаимодействии между бизнес-логикой и данными, относятся Microsoft [Orleans](https://github.com/dotnet/orleans) от Microsoft Research и [Akka.NET](https://getakka.net/). В настоящее время идет работа над улучшением поддержки Docker в обеих этих платформах.

Учтите, что контейнеры Docker сами по себе не поддерживают отслеживание состояния. Чтобы реализовать службу с отслеживанием состояния, вам потребуется одна из высокоуровневых платформ, указанных выше.

## <a name="using-azure-service-fabric-mesh"></a>Использование сетки Azure Service Fabric 

Сетка Azure Service Fabric — это полностью управляемая служба, которая позволяет разработчикам создавать и развертывать критически важные приложения без необходимости управлять инфраструктурой. Используйте сетку Service Fabric, чтобы создавать и запускать безопасные распределенные приложения для микрослужб, которые масштабируются по запросу. 

Как показано на рис. 4-32, приложения, размещенные в сетке Service Fabric, выполняются и масштабируются так, что вам не приходится беспокоиться об инфраструктуре.

![Многоконтейнерное приложение в классическом варианте Docker можно развертывать в сетке Azure Service Fabric, не беспокоясь об инфраструктуре.](media/image39.png)

**Рис. 4-32.** Развертывание приложения для микрослужб или контейнеров в сетке Service Fabric

На самом деле сетка Service Fabric состоит из кластеров из тысяч компьютеров. Все операции в кластере скрыты от разработчика. Нужно просто отправить контейнеры и указать необходимые ресурсы, требования к доступности и ограничения ресурсов. Сетка Service Fabric автоматически выделяет инфраструктуру, запрошенную развертыванием приложения, а также обрабатывает сбои инфраструктуры, гарантируя высокую доступность ваших приложений. Вы думаете только о работоспособности и скорости реагирования приложения, а не об инфраструктуре.

Дополнительные сведения см. в [документации по сетке Service Fabric](https://docs.microsoft.com/azure/service-fabric-mesh/).

## <a name="choosing-orchestrators-in-azure"></a>Выбор оркестраторов в Azure

В следующей таблице приведены рекомендации по выбору оркестратора в зависимости от рабочих нагрузок и фокуса операционной системы.

![Службы Azure Kubernetes больше подходят для Linux, чем для Windows, и обычно используются для развертывания микрослужб на базе контейнеров. Azure Service Fabric (кластер и сетка) больше подходит для Windows, чем для Linux, и обычно используется для микрослужб на основе контейнеров, микрослужб на основе обычных процессов и служб с отслеживанием состояния.](media/image40.png)

**Рис. 4-33.** Выбор оркестратора в руководстве по Azure

>[!div class="step-by-step"]
>[Назад](scalable-available-multi-container-microservice-applications.md)
>[Вперед](../docker-application-development-process/index.md)
