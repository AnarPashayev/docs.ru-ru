---
title: Безопасные рекомендации по кодированию для .NET
description: Дизайн кода для работы с . Разрешения, применяемые NET, и другие меры по обеспечению соблюдения, чтобы предотвратить доступ вредоносного кода к данным или выполнение других действий.
ms.date: 06/28/2018
helpviewer_keywords:
- managed wrapper to native code implementation
- secure coding
- reusable components
- library code that exposes protected resources
- code, security
- code security
- secure coding, options
- components [.NET], security
- code security, options
- security-neutral code
- security [.NET], coding guidelines
ms.assetid: 4f882d94-262b-4494-b0a6-ba9ba1f5f177
ms.openlocfilehash: 05f7e039ecdc0cd33baa015872924fb9e1f078aa
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79187728"
---
# <a name="secure-coding-guidelines"></a><span data-ttu-id="ff79a-103">Безопасные рекомендации по кодированию</span><span class="sxs-lookup"><span data-stu-id="ff79a-103">Secure coding guidelines</span></span>

<span data-ttu-id="ff79a-104">Защита на основе фактических данных и управление доступом для кода предоставляют очень мощные, четкие механизмы для обеспечения безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff79a-104">Evidence-based security and code access security provide very powerful, explicit mechanisms to implement security.</span></span> <span data-ttu-id="ff79a-105">Большинство кода приложений может просто использовать инфраструктуру, реализованную .NET.</span><span class="sxs-lookup"><span data-stu-id="ff79a-105">Most application code can simply use the infrastructure implemented by .NET.</span></span> <span data-ttu-id="ff79a-106">В некоторых случаях требуется дополнительная защита на уровне приложения, построенная либо путем расширения системы, либо с помощью новых специальных методов.</span><span class="sxs-lookup"><span data-stu-id="ff79a-106">In some cases, additional application-specific security is required, built either by extending the security system or by using new ad hoc methods.</span></span>

<span data-ttu-id="ff79a-107">Используя в коде принудительные разрешения и другие меры принуждения.NET, следует возводить барьеры, чтобы предотвратить доступ к информации, которую вы не хотите, чтобы он получил или выполнял другие нежелательные действия.</span><span class="sxs-lookup"><span data-stu-id="ff79a-107">Using .NET enforced permissions and other enforcement in your code, you should erect barriers to prevent malicious code from accessing information that you don't want it to have or performing other undesirable actions.</span></span> <span data-ttu-id="ff79a-108">Кроме того, необходимо соблюсти баланс между безопасностью и удобством использования во всех планируемых сценариях с использованием доверенного кода.</span><span class="sxs-lookup"><span data-stu-id="ff79a-108">Additionally, you must strike a balance between security and usability in all the expected scenarios using trusted code.</span></span>

<span data-ttu-id="ff79a-109">В этом обзоре описываются различные способы разработки кода, взаимодействующего с системой безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff79a-109">This overview describes the different ways code can be designed to work with the security system.</span></span>

## <a name="securing-resource-access"></a><span data-ttu-id="ff79a-110">Обеспечение доступа к ресурсам</span><span class="sxs-lookup"><span data-stu-id="ff79a-110">Securing resource access</span></span>

<span data-ttu-id="ff79a-111">При разработке и написания кода необходимо защитить и ограничить доступ данного кода к ресурсам, особенно при использовании или вызове кода неизвестного происхождения.</span><span class="sxs-lookup"><span data-stu-id="ff79a-111">When designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin.</span></span> <span data-ttu-id="ff79a-112">Убедиться, что ваш код является безопасным, можно с помощью следующих методов.</span><span class="sxs-lookup"><span data-stu-id="ff79a-112">So, keep in mind the following techniques to ensure your code is secure:</span></span>

- <span data-ttu-id="ff79a-113">Не используйте управление доступом для кода (CAS).</span><span class="sxs-lookup"><span data-stu-id="ff79a-113">Do not use Code Access Security (CAS).</span></span>

- <span data-ttu-id="ff79a-114">Не используйте частично доверенный код.</span><span class="sxs-lookup"><span data-stu-id="ff79a-114">Do not use partial trusted code.</span></span>

- <span data-ttu-id="ff79a-115">Не используйте атрибут [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) (APTCA).</span><span class="sxs-lookup"><span data-stu-id="ff79a-115">Do not use the [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) attribute (APTCA).</span></span>

- <span data-ttu-id="ff79a-116">Не используйте удаленное взаимодействие .NET.</span><span class="sxs-lookup"><span data-stu-id="ff79a-116">Do not use .NET Remoting.</span></span>

- <span data-ttu-id="ff79a-117">Не используйте модель DCOM.</span><span class="sxs-lookup"><span data-stu-id="ff79a-117">Do not use Distributed Component Object Model (DCOM).</span></span>

- <span data-ttu-id="ff79a-118">Не используйте двоичные модули форматирования.</span><span class="sxs-lookup"><span data-stu-id="ff79a-118">Do not use binary formatters.</span></span>

<span data-ttu-id="ff79a-119">Код безопасности доступа и безопасности прозрачный код не поддерживается в качестве границы безопасности с частично доверенным кодом.</span><span class="sxs-lookup"><span data-stu-id="ff79a-119">Code Access Security and Security-Transparent Code are not supported as a security boundary with partially trusted code.</span></span> <span data-ttu-id="ff79a-120">Мы не рекомендуем загружать и выполнять код из неизвестных источников, не предприняв дополнительные меры безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff79a-120">We advise against loading and executing code of unknown origins without putting alternative security measures in place.</span></span> <span data-ttu-id="ff79a-121">Ниже приведены дополнительные меры безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff79a-121">The alternative security measures are:</span></span>

- <span data-ttu-id="ff79a-122">Виртуализация</span><span class="sxs-lookup"><span data-stu-id="ff79a-122">Virtualization</span></span>

- <span data-ttu-id="ff79a-123">Контейнеры AppContainer</span><span class="sxs-lookup"><span data-stu-id="ff79a-123">AppContainers</span></span>

- <span data-ttu-id="ff79a-124">Пользователи операционной системы (ОС) и разрешения</span><span class="sxs-lookup"><span data-stu-id="ff79a-124">Operating system (OS) users and permissions</span></span>

- <span data-ttu-id="ff79a-125">Контейнеры Hyper-V</span><span class="sxs-lookup"><span data-stu-id="ff79a-125">Hyper-V containers</span></span>

## <a name="security-neutral-code"></a><span data-ttu-id="ff79a-126">Нейтральный код безопасности</span><span class="sxs-lookup"><span data-stu-id="ff79a-126">Security-neutral code</span></span>

<span data-ttu-id="ff79a-127">Нейтральный код не взаимодействует явным образом с системой безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff79a-127">Security-neutral code does nothing explicit with the security system.</span></span> <span data-ttu-id="ff79a-128">Он работает с любыми полученными разрешениями.</span><span class="sxs-lookup"><span data-stu-id="ff79a-128">It runs with whatever permissions it receives.</span></span> <span data-ttu-id="ff79a-129">Хотя приложения, не успевающие за исключением безопасности, связанные с защищенными операциями (например, использование файлов, сетей и т.д.), могут привести к необработанному исключению, нейтральный код безопасности по-прежнему использует преимущества технологий безопасности в .NET .</span><span class="sxs-lookup"><span data-stu-id="ff79a-129">Although applications that fail to catch security exceptions associated with protected operations (such as using files, networking, and so on) can result in an unhandled exception, security-neutral code still takes advantage of the security technologies in .NET.</span></span>

<span data-ttu-id="ff79a-130">Библиотека нейтрального кода имеет особенности, которые следует понимать.</span><span class="sxs-lookup"><span data-stu-id="ff79a-130">A security-neutral library has special characteristics that you should understand.</span></span> <span data-ttu-id="ff79a-131">Предположим, что в вашей библиотеке предоставляются элементы API, которые используют файлы или вызывают неуправляемый код.</span><span class="sxs-lookup"><span data-stu-id="ff79a-131">Suppose your library provides API elements that use files or call unmanaged code.</span></span> <span data-ttu-id="ff79a-132">Если ваш код не имеет соответствующего разрешения, он не будет работать, как описано.</span><span class="sxs-lookup"><span data-stu-id="ff79a-132">If your code doesn't have the corresponding permission, it won't run as described.</span></span> <span data-ttu-id="ff79a-133">Однако даже если код имеет разрешения, вызывающий его код приложения должен иметь те же разрешения, чтобы он мог работать.</span><span class="sxs-lookup"><span data-stu-id="ff79a-133">However, even if the code has the permission, any application code that calls it must have the same permission in order to work.</span></span> <span data-ttu-id="ff79a-134">Если код вызова не имеет нужного <xref:System.Security.SecurityException> разрешения, появляется в результате ходьбы стека безопасности доступа к коду.</span><span class="sxs-lookup"><span data-stu-id="ff79a-134">If the calling code doesn't have the right permission, a <xref:System.Security.SecurityException> appears as a result of the code access security stack walk.</span></span>

## <a name="application-code-that-isnt-a-reusable-component"></a><span data-ttu-id="ff79a-135">Код приложения, который не является многоразовым компонентом</span><span class="sxs-lookup"><span data-stu-id="ff79a-135">Application code that isn't a reusable component</span></span>

<span data-ttu-id="ff79a-136">Если ваш код является частью приложения, которое не будет вызываться другим кодом, безопасность проста и специальное кодирование может не потребоваться.</span><span class="sxs-lookup"><span data-stu-id="ff79a-136">If your code is part of an application that won't be called by other code, security is simple and special coding might not be required.</span></span> <span data-ttu-id="ff79a-137">Однако помните, что вредоносный код может вызвать ваш код.</span><span class="sxs-lookup"><span data-stu-id="ff79a-137">However, remember that malicious code can call your code.</span></span> <span data-ttu-id="ff79a-138">Хотя управление доступом для кода может предотвратить доступ вредоносного кода к ресурсам, такой код все еще может считывать значения полей или свойств, которые могут содержать конфиденциальные сведения.</span><span class="sxs-lookup"><span data-stu-id="ff79a-138">While code access security might stop malicious code from accessing resources, such code could still read values of your fields or properties that might contain sensitive information.</span></span>

<span data-ttu-id="ff79a-139">Кроме того, если код принимает ввод пользователя из Интернета или других ненадежных источников, будьте осторожны, чтобы не были введены вредоносные данные.</span><span class="sxs-lookup"><span data-stu-id="ff79a-139">Additionally, if your code accepts user input from the Internet or other unreliable sources, you must be careful about malicious input.</span></span>

## <a name="managed-wrapper-to-native-code-implementation"></a><span data-ttu-id="ff79a-140">Управляемая обертка к реализации родного кода</span><span class="sxs-lookup"><span data-stu-id="ff79a-140">Managed wrapper to native code implementation</span></span>

<span data-ttu-id="ff79a-141">Обычно в этом сценарии некоторые полезные функции реализуются в машинном коде, который требуется сделать доступным для управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="ff79a-141">Typically in this scenario, some useful functionality is implemented in native code that you want to make available to managed code.</span></span> <span data-ttu-id="ff79a-142">Управляемые оболочки легко создаются с помощью вызова неуправляемого кода или COM-взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="ff79a-142">Managed wrappers are easy to write using either platform invoke or COM interop.</span></span> <span data-ttu-id="ff79a-143">Однако если это сделать, для успешного выполнения вызывающим ваши оболочки объектам необходимо предоставить права на неуправляемый код.</span><span class="sxs-lookup"><span data-stu-id="ff79a-143">However, if you do this, callers of your wrappers must have unmanaged code rights in order to succeed.</span></span> <span data-ttu-id="ff79a-144">В соответствии с политикой по умолчанию это означает, что код, загруженный из интрасети или Интернета, не будет работать с обертками.</span><span class="sxs-lookup"><span data-stu-id="ff79a-144">Under default policy, this means that code downloaded from an intranet or the Internet won't work with the wrappers.</span></span>

<span data-ttu-id="ff79a-145">Вместо того, чтобы давать неуправляемые права кода всем приложениям, которые используют эти обертки, лучше отдать эти права только коду обертки.</span><span class="sxs-lookup"><span data-stu-id="ff79a-145">Instead of giving unmanaged code rights to all applications that use these wrappers, it's better to give these rights only to the wrapper code.</span></span> <span data-ttu-id="ff79a-146">Если эта базовая функциональность не предоставляет никакие ресурсы и реализация также безопасна, оболочке достаточно просто объявить свои права, что позволяет любому коду вызывать ее.</span><span class="sxs-lookup"><span data-stu-id="ff79a-146">If the underlying functionality exposes no resources and the implementation is likewise safe, the wrapper only needs to assert its rights, which enables any code to call through it.</span></span> <span data-ttu-id="ff79a-147">При использовании ресурсов написание безопасного кода должно быть таким же, как в случае кода библиотеки, описанного в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="ff79a-147">When resources are involved, security coding should be the same as the library code case described in the next section.</span></span> <span data-ttu-id="ff79a-148">Поскольку оболочка потенциально предоставляет вызывающим объектам доступ к этим ресурсам, необходима тщательная проверка безопасности машинного кода, за которую отвечает оболочка.</span><span class="sxs-lookup"><span data-stu-id="ff79a-148">Because the wrapper is potentially exposing callers to these resources, careful verification of the safety of the native code is necessary and is the wrapper's responsibility.</span></span>

## <a name="library-code-that-exposes-protected-resources"></a><span data-ttu-id="ff79a-149">Библиотечный код, который предоставляет защищенные ресурсы</span><span class="sxs-lookup"><span data-stu-id="ff79a-149">Library code that exposes protected resources</span></span>

<span data-ttu-id="ff79a-150">Следующий подход является наиболее мощным и, следовательно, потенциально опасным (если сделано неправильно) для кодирования безопасности: ваша библиотека служит интерфейсом для другого кода для доступа к определенным ресурсам, которые в противном случае не доступны, так же, как классы .NET обеспечивают соблюдение разрешения на ресурсы, которые они используют.</span><span class="sxs-lookup"><span data-stu-id="ff79a-150">The following approach is the most powerful and hence potentially dangerous (if done incorrectly) for security coding: your library serves as an interface for other code to access certain resources that aren't otherwise available, just as the .NET classes enforce permissions for the resources they use.</span></span> <span data-ttu-id="ff79a-151">При предоставлении доступа к ресурсу код должен сначала запросить соответствующее разрешение на ресурс (т. е. он должен выполнить проверку безопасности), а затем объявить свои права на выполнение текущей операции.</span><span class="sxs-lookup"><span data-stu-id="ff79a-151">Wherever you expose a resource, your code must first demand the permission appropriate to the resource (that is, it must perform a security check) and then typically assert its rights to perform the actual operation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ff79a-152">Связанные разделы</span><span class="sxs-lookup"><span data-stu-id="ff79a-152">Related topics</span></span>

|<span data-ttu-id="ff79a-153">Title</span><span class="sxs-lookup"><span data-stu-id="ff79a-153">Title</span></span>|<span data-ttu-id="ff79a-154">Описание</span><span class="sxs-lookup"><span data-stu-id="ff79a-154">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="ff79a-155">Обеспечение безопасности данных</span><span class="sxs-lookup"><span data-stu-id="ff79a-155">Securing State Data</span></span>](securing-state-data.md)|<span data-ttu-id="ff79a-156">Описание порядка защиты закрытых членов.</span><span class="sxs-lookup"><span data-stu-id="ff79a-156">Describes how to protect private members.</span></span>|
|[<span data-ttu-id="ff79a-157">Безопасность и ввод данных пользователем</span><span class="sxs-lookup"><span data-stu-id="ff79a-157">Security and User Input</span></span>](security-and-user-input.md)|<span data-ttu-id="ff79a-158">Вопросы безопасности для приложений, которые принимают пользовательский ввод.</span><span class="sxs-lookup"><span data-stu-id="ff79a-158">Describes security concerns for applications that accept user input.</span></span>|
|[<span data-ttu-id="ff79a-159">Безопасность и конфликты</span><span class="sxs-lookup"><span data-stu-id="ff79a-159">Security and Race Conditions</span></span>](security-and-race-conditions.md)|<span data-ttu-id="ff79a-160">Описывается, как избежать состояний соперничества в коде.</span><span class="sxs-lookup"><span data-stu-id="ff79a-160">Describes how to avoid race conditions in your code.</span></span>|
|[<span data-ttu-id="ff79a-161">Безопасность и создание кода "на лету"</span><span class="sxs-lookup"><span data-stu-id="ff79a-161">Security and On-the-Fly Code Generation</span></span>](security-and-on-the-fly-code-generation.md)|<span data-ttu-id="ff79a-162">Вопросы безопасности для приложений, создающих динамический код.</span><span class="sxs-lookup"><span data-stu-id="ff79a-162">Describes security concerns for applications that generate dynamic code.</span></span>|
|[<span data-ttu-id="ff79a-163">Безопасность на основе ролей</span><span class="sxs-lookup"><span data-stu-id="ff79a-163">Role-Based Security</span></span>](role-based-security.md)|<span data-ttu-id="ff79a-164">Подробно описывает безопасность на основе ролей .NET и предоставляет инструкции по ее использованию в коде.</span><span class="sxs-lookup"><span data-stu-id="ff79a-164">Describes .NET role-based security in detail and provides instructions for using it in your code.</span></span>|
