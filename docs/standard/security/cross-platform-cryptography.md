---
title: Кросс-платформенная криптография в .NET Core и .NET 5
description: Сведения о криптографических возможностях на платформах, поддерживаемых .NET.
ms.date: 06/19/2020
ms.technology: dotnet-standard
helpviewer_keywords:
- cryptography, cross-platform
- encryption, cross-platform
ms.openlocfilehash: 793a9bc55e5bd660374abd2ae81899e63ce3f36a
ms.sourcegitcommit: b6a1869f97a37f11a68c90afde1a520a6887dcbc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85854029"
---
# <a name="cross-platform-cryptography-in-net-core-and-net-5"></a>Кросс-платформенная криптография в .NET Core и .NET 5

Криптографические операции в .NET Core и .NET 5 выполняются с помощью библиотек операционной системы (ОС). Эта зависимость имеет преимущества:

* Приложения .NET получают преимущество от надежности ОС. Хранение библиотек шифрования, защищенных от уязвимостей, имеет высокий приоритет для поставщиков ОС. Для этого они предоставляют обновления, которые должны быть применены системными администраторами.
* Приложения .NET имеют доступ к алгоритмам, проверенным FIPS, если библиотеки ОС проверены с помощью FIPS.

Зависимость от библиотек ОС также означает, что приложения .NET могут использовать только криптографические функции, поддерживаемые операционной системой. Хотя все платформы поддерживают определенные основные функции, некоторые функции, которые поддерживает .NET, нельзя использовать на некоторых платформах. В этой статье определяются функции, поддерживаемые на каждой платформе.

В этой статье предполагается, что у вас есть опыт работы с криптографией в .NET. Дополнительные сведения см. в разделе [модель шифрования .NET](cryptography-model.md) и [службы шифрования .NET](cryptographic-services.md).

## <a name="hash-algorithms"></a>Алгоритмы хэширования

Все классы хэш-алгоритма и проверки подлинности сообщений на основе хэша, включая `*Managed` классы, откладываются на библиотеки ОС. Хотя различные библиотеки ОС отличаются производительностью, они должны быть совместимыми.

## <a name="symmetric-encryption"></a>Симметричное шифрование

Базовые шифры и цепочки выполняются системными библиотеками, и все они поддерживаются всеми платформами.

| Шифрование и режим | Windows | Linux | macOS |
|---------------|---------|-------|-------|
| AES-CBC       | ✔️     | ✔️    | ✔️   |
| AES-ECB       | ✔️     | ✔️    | ✔️   |
| 3DES-CBC      | ✔️     | ✔️    | ✔️   |
| 3DES-ECB      | ✔️     | ✔️    | ✔️   |
| DES-CBC       | ✔️     | ✔️    | ✔️   |
| DES-ECB       | ✔️     | ✔️    | ✔️   |

## <a name="authenticated-encryption"></a>Шифрование с проверкой подлинности

Поддержка шифрования с проверкой подлинности (AE) предоставляется для AES-CCM и AES-GCM через <xref:System.Security.Cryptography.AesCcm?displayProperty=fullName> <xref:System.Security.Cryptography.AesGcm?displayProperty=fullName> классы и.

В Windows и Linux реализации AES-CCM и AES-GCM предоставляются библиотеками ОС.

### <a name="aes-ccm-and-aes-gcm-on-macos"></a>AES-CCM и AES-GCM на macOS

В macOS системные библиотеки не поддерживают AES-CCM или AES-GCM для кода стороннего производителя, поэтому <xref:System.Security.Cryptography.AesCcm> <xref:System.Security.Cryptography.AesGcm> классы и используют OpenSSL для поддержки. Пользователям в macOS необходимо получить соответствующую копию OpenSSL (либкрипто) для работы этих типов, и она должна находиться в пути, по умолчанию по которому система загрузит библиотеку. Рекомендуется установить OpenSSL из диспетчера пакетов, например Homebrew.

`libcrypto.0.9.7.dylib`Библиотеки и, `libcrypto.0.9.8.dylib` Входящие в macOS, относятся к более ранним версиям OpenSSL и не будут использоваться. `libcrypto.35.dylib`Библиотеки, `libcrypto.41.dylib` и `libcrypto.42.dylib` находятся в либрессл и не будут использоваться.

### <a name="aes-ccm-keys-nonces-and-tags"></a>AES — ключи CCM, временные и Теги

* Размеры ключей

  Технология AES-CCM работает с ключами 128, 192 и 256-bit.

* Размеры nonce

  <xref:System.Security.Cryptography.AesCcm>Класс поддерживает 56, 64, 72, 80, 88, 96 и 104-bit (7, 8, 9, 10, 11, 12 и 13 байт) временные.

* Размеры тегов

  <xref:System.Security.Cryptography.AesCcm>Класс поддерживает создание или обработку 32, 48, 64, 80, 96, 112 и 128-bit (4, 8, 10, 12, 14 и 16-байтовых) тегов.

### <a name="aes-gcm-keys-nonces-and-tags"></a>Ключи AES-GCM, временные и Теги

* Размеры ключей

  AES-GCM работает с ключами 128, 192 и 256-bit.

* Размеры nonce

  <xref:System.Security.Cryptography.AesGcm>Класс поддерживает только 96-разрядный (12-байтный) временные.

* Размеры тегов

  <xref:System.Security.Cryptography.AesGcm>Класс поддерживает создание или обработку 96, 104, 112, 120 и 128-bit (12, 13, 14, 15 и 16-байтовых) тегов.

## <a name="asymmetric-cryptography"></a>Асимметричное шифрование

Этот раздел содержит следующие подразделы:

* [RSA](#rsa)
* [ECDSA](#ecdsa)
* [ECDH](#ecdh)
* [DSA](#dsa)

### <a name="rsa"></a>RSA

Создание ключей RSA (Ривест – Шамир – Адельман) выполняется библиотеками ОС и зависит от ограничений размера и характеристик производительности.

Операции с ключами RSA выполняются библиотеками ОС, а типы загружаемых ключей подчиняются требованиям операционной системы.

.NET не предоставляет необработанные операции RSA (без дополнения).

Библиотеки ОС используются для заполнения и расшифровки. Не все платформы поддерживают одни и те же параметры заполнения:

| Режим заполнения                          | Windows (CNG) | Linux (OpenSSL) | macOS | Windows (CAPI) |
|---------------------------------------|---------------|-----------------|-------|----------------|
| Шифрование PKCS1                      | ✔️           | ✔️              | ✔️   | ✔️             |
| OAEP-SHA-1                          | ✔️           | ✔️              | ✔️   | ✔️             |
| OAEP-SHA-2 (SHA256, SHA384, SHA512) | ✔️           | ✔️              | ✔️   | ❌             |
| Подпись PKCS1 (MD5, SHA-1)          | ✔️           | ✔️              | ✔️   | ✔️             |
| Подпись PKCS1 (SHA-2)               | ✔️           | ✔️              | ✔️   | ⚠️\*           |
| PSS                                   | ✔️           | ✔️              | ✔️   | ❌             |

\*Windows CryptoAPI (CAPI) поддерживает PKCS1 сигнатуру с помощью алгоритма SHA-2. Но отдельный объект RSA может быть загружен в поставщик служб шифрования (CSP), который не поддерживает его.

#### <a name="rsa-on-windows"></a>RSA в Windows

* Windows CryptoAPI (CAPI) используется всякий раз, когда [`new RSACryptoServiceProvider()`](xref:System.Security.Cryptography.RSACryptoServiceProvider) используется.
* Функция следующего поколения для шифрования Windows (CNG) используется всякий раз, когда [`new RSACng()`](xref:System.Security.Cryptography.RSACng) используется.
* Объект, возвращаемый функцией, <xref:System.Security.Cryptography.RSA.Create%2A?displayProperty=nameWithType> внутренне работает под управлением CNG Windows. Использование Windows CNG является подробным описанием реализации и может быть изменено.
* <xref:System.Security.Cryptography.X509Certificates.RSACertificateExtensions.GetRSAPublicKey%2A>Метод расширения для <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> возвращает <xref:System.Security.Cryptography.RSACng> экземпляр. Это использование <xref:System.Security.Cryptography.RSACng> является подробным описанием реализации и может быть изменено.
* <xref:System.Security.Cryptography.X509Certificates.RSACertificateExtensions.GetRSAPrivateKey%2A>Метод расширения <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> в настоящее время предпочитает <xref:System.Security.Cryptography.RSACng> экземпляр, но если <xref:System.Security.Cryptography.RSACng> не может открыть ключ, <xref:System.Security.Cryptography.RSACryptoServiceProvider> будет предпринята попыток. Предпочтительный поставщик — это сведения о реализации, которые могут быть изменены.

#### <a name="rsa-native-interop"></a>Встроенное взаимодействие RSA

.NET предоставляет типы, позволяющие программам взаимодействовать с библиотеками ОС, используемыми кодом шифрования .NET. Применяемые типы не выполняют преобразование между платформами и должны использоваться только при необходимости.

| Тип                                                         | Windows | Linux         | macOS         |
|--------------------------------------------------------------|---------|---------------|---------------|
| <xref:System.Security.Cryptography.RSACryptoServiceProvider> | ✔️     | ⚠️<sup>1</sup>| ⚠️<sup>1</sup> |
| <xref:System.Security.Cryptography.RSACng>                   | ✔️     | ❌            | ❌            |
| <xref:System.Security.Cryptography.RSAOpenSsl>               | ❌     | ✔️            | ⚠️<sup>открыт</sup> |

<sup>1</sup> в MacOS и Linux <xref:System.Security.Cryptography.RSACryptoServiceProvider> можно использовать для совместимости с существующими программами. В этом случае любой метод, требующий взаимодействия ОС, например открытие именованного ключа, создает исключение <xref:System.PlatformNotSupportedException> .

<sup>2</sup> в macOS <xref:System.Security.Cryptography.RSAOpenSsl> работает, если установлен OpenSSL и соответствующий либкрипто dylib можно найти с помощью динамической загрузки библиотеки. Если не удается найти соответствующую библиотеку, будут созданы исключения.

### <a name="ecdsa"></a>ECDSA

Создание ключа ECDSA (алгоритм цифровой подписи на основе эллиптических кривых) выполняется библиотеками ОС и зависит от ограничений размера и характеристик производительности.

Кривые ключей ECDSA определяются библиотеками ОС и подвержены их ограничениям.

| эллиптическая кривая;                     | Windows 10    | Windows 7 — 8,1 | Linux         | macOS         |
|------------------------------------|---------------|-----------------|---------------|---------------|
| Директива NIST P-256 (secp256r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| Директива NIST P-384 (secp384r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| Директива NIST P-521 (secp521r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| Кривые Brainpool (как именованные кривые) | ✔️           | ❌              | ⚠️<sup>1</sup>| ❌           |
| Другие именованные кривые                 | ⚠️<sup>открыт</sup>| ❌             | ⚠️<sup>1</sup>| ❌           |
| Явные кривые                    | ✔️           | ❌              | ✔️           | ❌            |
| Экспортировать или импортировать как явные       | ✔️           | ❌<sup>3-5</sup>  | ✔️           | ❌<sup>3-5</sup>|

<sup>1</sup> дистрибутивы Linux не поддерживают одни и те же именованные кривые.

<sup>2</sup> поддержка именованных кривых была добавлена в Windows CNG в Windows 10. Дополнительные сведения см. в разделе [CNG с именем эллиптические кривые](https://msdn.microsoft.com/library/windows/desktop/mt632245(v=vs.85).aspx). Именованные кривые недоступны в более ранних версиях Windows, за исключением трех кривых в Windows 7.

<sup>3</sup> для экспорта с явными параметрами кривой требуется поддержка библиотеки ОС, которая недоступна в macOS или более ранних версиях Windows.

#### <a name="ecdsa-native-interop"></a>Собственное взаимодействие с ECDSA

.NET предоставляет типы, позволяющие программам взаимодействовать с библиотеками ОС, используемыми кодом шифрования .NET. Участвующие типы не переводятся между платформами и должны использоваться только при необходимости.

| Тип                                             | Windows | Linux | macOS |
|--------------------------------------------------|---------|-------|-------|
| <xref:System.Security.Cryptography.ECDsaCng>     | ✔️     | ❌    | ❌    |
| <xref:System.Security.Cryptography.ECDsaOpenSsl> | ❌     | ✔️    | ⚠️\*  |

\*В macOS <xref:System.Security.Cryptography.ECDsaOpenSsl> работает, если в системе установлен OpenSSL, а соответствующий либкрипто dylib можно найти с помощью динамической загрузки библиотеки. Если не удается найти соответствующую библиотеку, будут созданы исключения.

### <a name="ecdh"></a>ECDH

Создание ключа ECDH (Диффи-Хелмана на эллиптических кривых) выполняется библиотеками ОС и зависит от ограничений размера и характеристик производительности.

<xref:System.Security.Cryptography.ECDiffieHellman>Класс не возвращает "необработанное" значение вычисления ECDH. Все возвращаемые данные находятся в терминах функций формирования ключа:

* HASH (Z)
* HASH (в начале | | Z | | Добавление
* HMAC (ключ, Z)
* HMAC (ключ, начало | | Z | | Добавление
* HMAC (Z, Z)
* HMAC (Z, в начале | | Z | | Добавление
* Tls11Prf (метка, начальное значение)

Ключевые кривые ECDH определяются библиотеками ОС и подвержены их ограничениям.

| эллиптическая кривая;                     | Windows 10    | Windows 7 — 8,1 | Linux         | macOS         |
|------------------------------------|---------------|-----------------|---------------|---------------|
| Директива NIST P-256 (secp256r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| Директива NIST P-384 (secp384r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| Директива NIST P-521 (secp521r1)             | ✔️           | ✔️              | ✔️           | ✔️            |
| кривые Brainpool (как именованные кривые) | ✔️           | ❌              | ⚠️<sup>1</sup>| ❌           |
| другие именованные кривые                 | ⚠️<sup>открыт</sup>| ❌             | ⚠️<sup>1</sup>| ❌           |
| явные кривые                    | ✔️           | ❌              | ✔️           | ❌            |
| Экспортировать или импортировать как явные       | ✔️           | ❌<sup>3-5</sup>  | ✔️           | ❌<sup>3-5</sup>|

<sup>1</sup> дистрибутивы Linux не поддерживают одни и те же именованные кривые.

<sup>2</sup> поддержка именованных кривых была добавлена в Windows CNG в Windows 10. Дополнительные сведения см. в разделе [CNG с именем эллиптические кривые](https://msdn.microsoft.com/library/windows/desktop/mt632245(v=vs.85).aspx). Именованные кривые недоступны в более ранних версиях Windows, за исключением трех кривых в Windows 7.

<sup>3</sup> для экспорта с явными параметрами кривой требуется поддержка библиотеки ОС, которая недоступна в macOS или более ранних версиях Windows.

#### <a name="ecdh-native-interop"></a>Встроенное взаимодействие ECDH

.NET предоставляет типы, позволяющие программам взаимодействовать с библиотеками ОС, используемыми .NET. Участвующие типы не переводятся между платформами и должны использоваться только при необходимости.

| Тип                                                       | Windows | Linux | macOS |
|------------------------------------------------------------|---------|-------|-------|
| <xref:System.Security.Cryptography.ECDiffieHellmanCng>     | ✔️     | ❌    | ❌   |
| <xref:System.Security.Cryptography.ECDiffieHellmanOpenSsl> | ❌     | ✔️    | ⚠️\* |

\*В macOS <xref:System.Security.Cryptography.ECDiffieHellmanOpenSsl> работает, если установлен OpenSSL и соответствующий либкрипто dylib можно найти с помощью динамической загрузки библиотеки. Если не удается найти соответствующую библиотеку, будут созданы исключения.

### <a name="dsa"></a>DSA

Создание ключей (алгоритм цифровой подписи) осуществляется с помощью системных библиотек и зависит от ограничений размера и характеристик производительности.

| Функция                      | Windows CNG | Linux | macOS         | Windows CAPI |
|-------------------------------|-------------|-------|---------------|--------------|
| Создание ключа (<= 1024 бит)   | ✔️         | ✔️    | ❌            | ✔️           |
| Создание ключа (> 1024 бит)    | ✔️         | ✔️    | ❌            | ❌            |
| Загрузка ключей (<= 1024 бит)   | ✔️         | ✔️    | ✔️            | ✔️           |
| Загрузка ключей (> 1024 бит)    | ✔️         | ✔️    | ⚠️\*          | ❌            |
| FIPS 186-2                    | ✔️         | ✔️    | ✔️            | ✔️           |
| FIPS 186-3 (подписи SHA-2) | ✔️         | ✔️    | ❌            | ❌            |

\*macOS загружает ключи DSA больше 1024 бит, но поведение этих ключей не определено. Они не работают в соответствии с FIPS 186-3.

#### <a name="dsa-on-windows"></a>DSA в Windows

* Windows CryptoAPI (CAPI) используется всякий раз, когда [`new DSACryptoServiceProvider()`](xref:System.Security.Cryptography.DSACryptoServiceProvider) используется.
* Функция следующего поколения для шифрования Windows (CNG) используется всякий раз, когда [`new DSACng()`](xref:System.Security.Cryptography.DSACng) используется.
* Объект, возвращаемый функцией, <xref:System.Security.Cryptography.DSA.Create%2A?displayProperty=nameWithType> внутренне работает под управлением CNG Windows. Использование Windows CNG является подробным описанием реализации и может быть изменено.
* <xref:System.Security.Cryptography.X509Certificates.DSACertificateExtensions.GetDSAPublicKey%2A>Метод расширения для <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> возвращает <xref:System.Security.Cryptography.DSACng> экземпляр. Это использование <xref:System.Security.Cryptography.DSACng> является подробным описанием реализации и может быть изменено.
* <xref:System.Security.Cryptography.X509Certificates.DSACertificateExtensions.GetDSAPrivateKey%2A>Метод расширения <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> предпочитает <xref:System.Security.Cryptography.DSACng> экземпляр, но если <xref:System.Security.Cryptography.DSACng> не может открыть ключ, <xref:System.Security.Cryptography.DSACryptoServiceProvider> будет предпринята попыток.  Предпочтительный поставщик — это сведения о реализации, которые могут быть изменены.

#### <a name="dsa-native-interop"></a>Встроенное взаимодействие DSA

.NET предоставляет типы, позволяющие программам взаимодействовать с библиотеками ОС, используемыми кодом шифрования .NET. Участвующие типы не переводятся между платформами и должны использоваться только при необходимости.

| Тип                                                         | Windows | Linux         | macOS         |
|--------------------------------------------------------------|---------|---------------|---------------|
| <xref:System.Security.Cryptography.DSACryptoServiceProvider> | ✔️     | ⚠️<sup>1</sup> | ⚠️<sup>1</sup> |
| <xref:System.Security.Cryptography.DSACng>                   | ✔️     | ❌             | ❌            |
| <xref:System.Security.Cryptography.DSAOpenSsl>               | ❌      | ✔️            | ⚠️<sup>открыт</sup> |

<sup>1</sup> в MacOS и Linux <xref:System.Security.Cryptography.DSACryptoServiceProvider> можно использовать для совместимости с существующими программами. В этом случае любой метод, требующий взаимодействия с системой, например открытие именованного ключа, создает исключение <xref:System.PlatformNotSupportedException> .

<sup>2</sup> в macOS <xref:System.Security.Cryptography.DSAOpenSsl> работает, если установлен OpenSSL и соответствующий либкрипто dylib можно найти с помощью динамической загрузки библиотеки. Если не удается найти соответствующую библиотеку, будут созданы исключения.

## <a name="x509-certificates"></a>Сертификаты X.509

Большая часть поддержки сертификатов X. 509 в .NET поступает из библиотек ОС. Чтобы загрузить сертификат в <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> <xref:System.Security.Cryptography.X509Certificates.X509Certificate> экземпляр или в .NET, сертификат должен быть загружен базовой библиотекой ОС.

### <a name="read-a-pkcs12pfx"></a>Чтение PKCS12/PFX

| Сценарий                                     | Windows | Linux | macOS |
|----------------------------------------------|---------|-------|-------|
| Empty                                        | ✔️     | ✔️    | ✔️   |
| Один сертификат, закрытый ключ отсутствует              | ✔️     | ✔️    | ✔️   |
| Один сертификат с закрытым ключом            | ✔️     | ✔️    | ✔️   |
| Несколько сертификатов, без закрытых ключей       | ✔️     | ✔️    | ✔️   |
| Несколько сертификатов, один закрытый ключ       | ✔️     | ✔️    | ✔️   |
| Несколько сертификатов, несколько закрытых ключей | ✔️     | ⚠️\*  | ✔️   |

\*Доступно в выпусках .NET 5 Preview.

### <a name="write-a-pkcs12pfx"></a>Запись PKCS12/PFX

| Сценарий                                     | Windows | Linux | macOS |
|----------------------------------------------|---------|-------|-------|
| Empty                                        | ✔️     | ✔️    | ⚠️\* |
| Один сертификат, закрытый ключ отсутствует              | ✔️     | ✔️    | ⚠️\* |
| Один сертификат с закрытым ключом            | ✔️     | ✔️    | ✔️   |
| Несколько сертификатов, без закрытых ключей       | ✔️     | ✔️    | ⚠️\* |
| Несколько сертификатов, один закрытый ключ       | ✔️     | ✔️    | ✔️   |
| Несколько сертификатов, несколько закрытых ключей | ✔️     | ⚠️\*  | ✔️   |
| Эфемерная Загрузка                            | ✔️     | ✔️    | ⚠️\* |

\*Доступно в выпусках .NET 5 Preview.

macOS не может загрузить закрытые ключи сертификата без объекта цепочки ключей, что требует записи на диск. Области цепочки ключей создаются автоматически для загрузки PFX и удаляются, когда они больше не используются. Поскольку <xref:System.Security.Cryptography.X509Certificates.X509KeyStorageFlags.EphemeralKeySet?displayProperty=nameWithType> параметр означает, что закрытый ключ не должен записываться на диск, при утверждении этого флага в macOS результат будет иметь значение <xref:System.PlatformNotSupportedException> .

### <a name="write-a-pkcs7-certificate-collection"></a>Создание коллекции сертификатов PKCS7

Windows и Linux выдают большие двоичные объекты PKCS7 в кодировке DER. macOS выдает большие двоичные объекты PKCS7 с кодировкой CER с неопределенной длиной.

### <a name="x509store"></a>X509Store

В Windows <xref:System.Security.Cryptography.X509Certificates.X509Store> класс представляет собой представление API-интерфейсов хранилища сертификатов Windows. Эти API-интерфейсы работают в .NET Core и .NET 5 так же, как в .NET Framework.

В Linux <xref:System.Security.Cryptography.X509Certificates.X509Store> класс является проекцией решений о доверии системы (только для чтения), принятия решений о доверии пользователей (для чтения и записи) и хранилища ключей пользователей (чтение и запись).

В macOS <xref:System.Security.Cryptography.X509Certificates.X509Store> класс является проекцией решений о доверии системы (только для чтения), принятия решений о доверии пользователей (только для чтения) и хранилища ключей пользователей (чтение и запись).

В следующих таблицах показано, какие сценарии поддерживаются на каждой платформе. Для неподдерживаемых сценариев ( ❌ в таблицах) <xref:System.Security.Cryptography.CryptographicException> создается исключение.

#### <a name="the-my-store"></a>Хранилище My

| Сценарий                                         | Windows | Linux | macOS |
|--------------------------------------------------|---------|-------|-------|
| Открыть: Currentuser\my (только для чтения)                   | ✔️     | ✔️    | ✔️   |
| Открыть: Currentuser\my (ReadWrite)                  | ✔️     | ✔️    | ✔️   |
| Open: Currentuser\my (Ексистингонли)               | ✔️     | ⚠️    | ✔️   |
| Открыть LocalMachine\My                             | ✔️     | ❌    | ✔️   |

В Linux хранилища создаются при первой записи, и по умолчанию хранилища пользователей не существуют, поэтому открытие `CurrentUser\My` с `ExistingOnly` может завершиться ошибкой.

В macOS `CurrentUser\My` хранилище является цепочкой ключей пользователя по умолчанию, которая по `login.keychain` умолчанию имеет значение. `LocalMachine\My`Хранилище — `System.keychain` .

#### <a name="the-root-store"></a>Корневое хранилище

| Сценарий                              | Windows | Linux | macOS           |
|---------------------------------------|---------|-------|-----------------|
| Открыть Куррентусер\рут (только для чтения)      | ✔️     | ✔️    | ✔️             |
| Открыть Куррентусер\рут (ReadWrite)     | ✔️     | ✔️    | ❌              |
| Open Куррентусер\рут (Ексистингонли)  | ✔️     | ⚠️    | ✔️ (если только для чтения) |
| Открыть Локалмачине\рут (только для чтения)     | ✔️     | ✔️    | ✔️             |
| Открыть Локалмачине\рут (ReadWrite)    | ✔️     | ❌    | ❌              |
| Open Локалмачине\рут (Ексистингонли) | ✔️     | ⚠️    | ✔️ (если только для чтения) |

В Linux `LocalMachine\Root` хранилище представляет собой интерпретацию пакета центров сертификации в пути по умолчанию для OpenSSL.

В macOS `CurrentUser\Root` хранилище представляет собой интерпретацию `SecTrustSettings` результатов для домена доверия пользователя. `LocalMachine\Root`Хранилище представляет собой интерпретацию `SecTrustSettings` результатов для доверенных доменов администрирования и системы.

#### <a name="the-intermediate-store"></a>Промежуточное хранилище

| Сценарий                                      | Windows | Linux | macOS           |
|-----------------------------------------------|---------|-------|-----------------|
| Открыть Куррентусер\интермедиате (только для чтения)      | ✔️     | ✔️    | ✔️             |
| Открыть Куррентусер\интермедиате (ReadWrite)     | ✔️     | ✔️    | ❌              |
| Open Куррентусер\интермедиате (Ексистингонли)  | ✔️     | ⚠️    | ✔️ (если только для чтения) |
| Открыть Локалмачине\интермедиате (только для чтения)     | ✔️     | ✔️    | ✔️             |
| Открыть Локалмачине\интермедиате (ReadWrite)    | ✔️     | ❌    | ❌              |
| Open Локалмачине\интермедиате (Ексистингонли) | ✔️     | ⚠️    | ✔️ (если только для чтения) |

В Linux `CurrentUser\Intermediate` хранилище используется в качестве кэша при скачивании промежуточных центров сертификации с помощью записей доступа к информации о центрах сертификации в успешных сборках X509Chain. `LocalMachine\Intermediate`Хранилище представляет собой интерпретацию пакета ЦС в пути по умолчанию для OpenSSL.

#### <a name="the-disallowed-store"></a>Неразрешенное хранилище

| Сценарий                                    | Windows | Linux | macOS           |
|---------------------------------------------|---------|-------|-----------------|
| Открыть Куррентусер\дисалловед (только для чтения)      | ✔️     | ⚠️    | ✔️             |
| Открыть Куррентусер\дисалловед (ReadWrite)     | ✔️     | ⚠️    | ❌              |
| Open Куррентусер\дисалловед (Ексистингонли)  | ✔️     | ⚠️    | ✔️ (если только для чтения) |
| Открыть Локалмачине\дисалловед (только для чтения)     | ✔️     | ❌    | ✔️             |
| Открыть Локалмачине\дисалловед (ReadWrite)    | ✔️     | ❌    | ❌              |
| Open Локалмачине\дисалловед (Ексистингонли) | ✔️     | ❌    | ✔️ (если только для чтения) |

В Linux `Disallowed` хранилище не используется в построении цепочки, и попытка добавить в него содержимое приведет к <xref:System.Security.Cryptography.CryptographicException> . <xref:System.Security.Cryptography.CryptographicException>Исключение возникает при открытии хранилища, `Disallowed` если оно уже получило содержимое.

В macOS хранилища Куррентусер\дисалловед и Локалмачине\дисалловед являются интерпретациями соответствующих результатов Сектрустсеттингс для сертификатов, для которых установлено доверие `Always Deny` .

#### <a name="nonexistent-store"></a>Несуществующее хранилище

| Сценарий                                         | Windows | Linux | macOS |
|--------------------------------------------------|---------|-------|-------|
| Открыть несуществующее хранилище (Ексистингонли)           | ❌     | ❌     | ❌    |
| Открыть несуществующее хранилище CurrentUser (ReadWrite)  | ✔️     | ✔️     | ⚠️   |
| Открытие несуществующего хранилища LocalMachine (ReadWrite) | ✔️     | ❌     | ❌    |

В macOS создание пользовательского хранилища с помощью API X509Store поддерживается только для `CurrentUser` расположения. Он создаст новую цепочку ключей без пароля в каталоге цепочки ключей пользователя (*~/либрари/кэйчаинс*). Чтобы создать цепочку ключей с паролем, можно использовать P/Invoke `SecKeychainCreate` . Аналогичным образом `SecKeychainOpen` можно использовать для открытия области цепочки ключей в разных местах. Полученный результат `IntPtr` можно передать в [`new X509Store(IntPtr)`](xref:System.Security.Cryptography.X509Certificates.X509Store.%23ctor(System.IntPtr)) , чтобы получить хранилище, поддерживающее чтение и запись, в соответствии с разрешениями текущего пользователя.

### <a name="x509chain"></a>X509Chain

macOS не поддерживает использование автономных списков отзыва сертификатов, поэтому `X509RevocationMode.Offline` рассматривается как `X509RevocationMode.Online` .

macOS не поддерживает время ожидания, инициированное пользователем, для CRL (список отзыва сертификатов)/OCSP (Online Certificate Status Protocol)/AIA (доступ к информации о центрах сертификации), поэтому `X509ChainPolicy.UrlRetrievalTimeout` игнорируется.

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Модель шифрования .NET](cryptography-model.md)
* [Службы шифрования .NET](cryptographic-services.md)
