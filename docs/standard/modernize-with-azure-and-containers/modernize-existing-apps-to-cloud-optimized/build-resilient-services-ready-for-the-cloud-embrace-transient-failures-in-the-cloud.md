---
title: Создание гибких служб, готовых для облака. адаптация к временным сбоям в облаке
description: Модернизация существующих приложений .NET с помощью облака Azure и Windows контейнерах | Создание гибких служб, готовых для облака. адаптация к временным сбоям в облаке
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 04/30/2018
ms.openlocfilehash: 801d017457d1cdc3c8a495c8127b203380cb1d9e
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61811845"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="261a2-105">Создание устойчивых служб, готовых к использованию в облаке: адаптация к временным сбоям в облаке</span><span class="sxs-lookup"><span data-stu-id="261a2-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="261a2-106">Устойчивость — это возможность восстановления после сбоев и продолжение работы.</span><span class="sxs-lookup"><span data-stu-id="261a2-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="261a2-107">Устойчивость не о избежать сбоев, но исходить следует из того, что происходит сбой и последующего ответа на них способом, который позволяет избежать простоев или потери данных.</span><span class="sxs-lookup"><span data-stu-id="261a2-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="261a2-108">Цель устойчивости — вернуть приложение в полностью функционирующее состояние после сбоя.</span><span class="sxs-lookup"><span data-stu-id="261a2-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="261a2-109">Приложение будет готово для облака, когда и как минимум, он реализует модель на основе программного обеспечения устойчивости, а не модель на основе оборудования.</span><span class="sxs-lookup"><span data-stu-id="261a2-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="261a2-110">Облачного приложения должна быть предусмотрена обработка частичных сбоев, которые наверняка будут происходить.</span><span class="sxs-lookup"><span data-stu-id="261a2-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="261a2-111">Создание или частично рефакторинг приложения для обеспечения отказоустойчивости ожидаемый частичных сбоев.</span><span class="sxs-lookup"><span data-stu-id="261a2-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="261a2-112">Оно должно уметь справляться с частичными сбоями, таких как временные сети и узлы или виртуальные машины, аварийно завершается в облаке.</span><span class="sxs-lookup"><span data-stu-id="261a2-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="261a2-113">Даже контейнеры, перемещается на другой узел в кластере оркестратора может привести к кратковременным сбоям в приложении.</span><span class="sxs-lookup"><span data-stu-id="261a2-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="261a2-114">Обработка частичного сбоя</span><span class="sxs-lookup"><span data-stu-id="261a2-114">Handling partial failure</span></span>

<span data-ttu-id="261a2-115">В приложении облачных имеется постоянно присутствующей риск частичного сбоя.</span><span class="sxs-lookup"><span data-stu-id="261a2-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="261a2-116">К примеру экземпляр одного веб-сайта или контейнер может произойти сбой, или оно может быть недоступна или не отвечает в течение некоторого времени.</span><span class="sxs-lookup"><span data-stu-id="261a2-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="261a2-117">Кроме того, одна виртуальная машина или сервер могут завершаться со сбоем.</span><span class="sxs-lookup"><span data-stu-id="261a2-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="261a2-118">Так, как клиенты и службы являются отдельными процессами, служба может не иметь возможность своевременно реагировать на запрос клиента.</span><span class="sxs-lookup"><span data-stu-id="261a2-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="261a2-119">Служба может быть перегружена и медленно отвечать на запросы, или он может быть недоступен в течение короткого времени из-за проблемы с сетью.</span><span class="sxs-lookup"><span data-stu-id="261a2-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="261a2-120">Например рассмотрим монолитного приложения .NET, которое обращается к базе данных в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="261a2-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="261a2-121">Если базы данных Azure SQL или сторонняя служба не отвечает для кратких времени (к базе данных Azure SQL может быть перемещен на другой узел или сервер и не отвечать в течение нескольких секунд), когда пользователь пытается выполнить любое действие, приложения могут завершаться со сбоем и показывать w исключение одновременно.</span><span class="sxs-lookup"><span data-stu-id="261a2-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="261a2-122">Схожая ситуация может возникнуть в приложении, которое использует службы HTTP.</span><span class="sxs-lookup"><span data-stu-id="261a2-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="261a2-123">Сети или самой службы могут оказаться недоступными в облаке во время короткий, это временная ошибка.</span><span class="sxs-lookup"><span data-stu-id="261a2-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="261a2-124">Надежное приложение, как показано на рисунке 4-9 следует реализовать методы, такие как «повторных попыток с экспоненциальной выдержкой» для предоставления возможности для обработки временных сбоев в ресурсы приложения.</span><span class="sxs-lookup"><span data-stu-id="261a2-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="261a2-125">«Размыкатели цепи» также следует использовать в приложениях.</span><span class="sxs-lookup"><span data-stu-id="261a2-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="261a2-126">Размыкатель цепи останавливает приложение из-за попытки доступа к ресурсу, когда это действительно длительный сбой.</span><span class="sxs-lookup"><span data-stu-id="261a2-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="261a2-127">Используя Размыкатель цепи, приложение позволяет избежать подстегивающих мысль отказ в обслуживании на самого себя.</span><span class="sxs-lookup"><span data-stu-id="261a2-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Частичные сбои, обрабатывать повторные попытки с экспоненциальной выдержкой](./media/image9.png)

> <span data-ttu-id="261a2-129">**Рис. 4-9.**</span><span class="sxs-lookup"><span data-stu-id="261a2-129">**Figure 4-9.**</span></span> <span data-ttu-id="261a2-130">Частичные сбои, обрабатывать повторные попытки с экспоненциальной выдержкой</span><span class="sxs-lookup"><span data-stu-id="261a2-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="261a2-131">Эти методы можно использовать в HTTP-ресурсов и ресурсов базы данных.</span><span class="sxs-lookup"><span data-stu-id="261a2-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="261a2-132">На рисунке 4-9, приложение основано на 3-уровневой архитектуре, поэтому необходимо, чтобы эти методы на уровне служб (HTTP) и на уровне данных уровня (TCP).</span><span class="sxs-lookup"><span data-stu-id="261a2-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="261a2-133">В монолитном приложении, которое использует только одно приложение уровень, кроме базы данных (без дополнительных служб или микрослужбы) обработка временных ошибок на уровне подключения базы данных может оказаться достаточно.</span><span class="sxs-lookup"><span data-stu-id="261a2-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="261a2-134">В этом случае необходим только конкретной конфигурации подключения к базе данных.</span><span class="sxs-lookup"><span data-stu-id="261a2-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="261a2-135">При реализации устойчивой обмена данными, доступ к базе данных, в зависимости от версии .NET, вы используете, может быть простым (например, [с Entity Framework 6 или более поздней версии](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="261a2-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="261a2-136">Это просто настройки подключения к базе данных).</span><span class="sxs-lookup"><span data-stu-id="261a2-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="261a2-137">Или, может потребоваться использовать дополнительные библиотеки, такие как [временных Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (для более ранних версий платформы .NET), или даже реализовать свою собственную библиотеку.</span><span class="sxs-lookup"><span data-stu-id="261a2-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="261a2-138">При реализации повторных попыток HTTP и размыкателей цепи, для .NET рекомендуется использовать [Polly](https://github.com/App-vNext/Polly) библиотеку, предназначенную .NET Framework 4.0, .NET Framework 4.5 и .NET Standard 1.1, которая включает поддержку .NET Core.</span><span class="sxs-lookup"><span data-stu-id="261a2-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="261a2-139">Чтобы узнать, как для реализации стратегии для обработки частичных сбоев в облаке, см. следующие ссылки.</span><span class="sxs-lookup"><span data-stu-id="261a2-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="261a2-140">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="261a2-140">Additional resources</span></span>

- <span data-ttu-id="261a2-141">**Реализация устойчивых взаимодействия для обработки частичного сбоя**</span><span class="sxs-lookup"><span data-stu-id="261a2-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies](../../microservices-architecture/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="261a2-142">**Entity Framework подключения устойчивости и повторного выполнения логики (версия 6 и более поздние версии)**</span><span class="sxs-lookup"><span data-stu-id="261a2-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="261a2-143">**Блок приложения обработки временных сбоев**</span><span class="sxs-lookup"><span data-stu-id="261a2-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="261a2-144">**Библиотека Polly для устойчивой связью HTTP**</span><span class="sxs-lookup"><span data-stu-id="261a2-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="261a2-145">[Назад](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Вперед](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="261a2-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
