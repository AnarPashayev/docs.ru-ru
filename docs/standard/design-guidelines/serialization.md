---
title: Сериализация
ms.date: 10/22/2008
ms.technology: dotnet-standard
ms.assetid: bebb27ac-9712-4196-9931-de19fc04dbac
ms.openlocfilehash: fb5d714e2452f1b9c1dcc79cc179b35a2dd48fec
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75709079"
---
# <a name="serialization"></a>Сериализация
Сериализация — это процесс преобразования объекта в формат, который можно легко сохранить или перенести. Например, можно сериализовать объект, передать его через Интернет по протоколу HTTP и десериализовать на целевом компьютере.  
  
 .NET Framework предлагает три основные технологии сериализации, оптимизированные для различных сценариев сериализации. В следующей таблице описаны эти технологии, а также связанные с ними основные типы Framework.  
  
|**Название технологии**|**Основные типы**|**Сценарии**|  
|-------------------------|--------------------|-------------------|  
|**Сериализация контракта данных**|<xref:System.Runtime.Serialization.DataContractAttribute> <br /> <xref:System.Runtime.Serialization.DataMemberAttribute> <br /> <xref:System.Runtime.Serialization.DataContractSerializer> <br /> <xref:System.Runtime.Serialization.NetDataContractSerializer> <br /> <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> <br /> <xref:System.Runtime.Serialization.ISerializable>|Общее сохранение<br />Веб-службы<br />JSON|  
|**XML-сериализация**|<xref:System.Xml.Serialization.XmlSerializer>|Формат XML с полным контролем над формой XML|  
|**Сериализация среды выполнения (двоичная и SOAP)**|<xref:System.SerializableAttribute> <br /> <xref:System.Runtime.Serialization.ISerializable> <br /> <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> <br /> <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>|Удаленное взаимодействие .NET|  
  
 **✓ DO** Вспомните сериализации при разработке новых типов.  
  
## <a name="choosing-the-right-serialization-technology-to-support"></a>Правильный выбор сериализации для поддержки  
 **✓ CONSIDER** поддержки сериализации контракта данных, если экземпляры этого типа, может потребоваться сохранить или использовать в веб-службы.  
  
 **✓ CONSIDER** поддержка XML-сериализации вместо или в дополнение к сериализации контракта данных, если требуется больший контроль над форматом XML, который создается при сериализации типа.  
  
 Это может быть необходимо в некоторых сценариях взаимодействия, когда необходимо использовать конструкцию XML, не поддерживаемую сериализацией контракта данных, например для создания XML-атрибутов.  
  
 **✓ CONSIDER** поддерживающий сериализацию во время выполнения, если экземпляров типа проходить через границы удаленного взаимодействия .NET.  
  
 **X AVOID** поддерживающий сериализацию во время выполнения или XML-сериализации только в целях общие сохраняемости. Вместо этого предпочтительнее использовать сериализацию контракта данных.  
  
## <a name="supporting-data-contract-serialization"></a>Поддержка сериализации контракта данных  
 Типы могут поддерживать сериализацию контракта данных путем применения <xref:System.Runtime.Serialization.DataContractAttribute> к типу и <xref:System.Runtime.Serialization.DataMemberAttribute> членам (поля и свойства) типа.  
  
 **✓ CONSIDER** пометить тип общедоступные элементы данных, если тип можно использовать в режиме частичного доверия.  
  
 При полном доверии сериализаторы контрактов данных могут сериализовать и десериализовать неоткрытые типы и члены, но только открытые члены могут быть сериализованы и десериализованы при частичном доверии.  
  
 **✓ DO** реализовать Get и set для всех свойств, имеющих <xref:System.Runtime.Serialization.DataMemberAttribute>. Для сериализаторов контрактов данных требуется, чтобы метод считывания и метод задания для типа считались сериализуемыми. (В .NET Framework 3,5 с пакетом обновления 1 (SP1) некоторые свойства коллекции могут быть доступны только для получения.) Если тип не будет использоваться в частичном доверии, то один или оба из методов доступа к свойствам могут быть не открытыми.  
  
 **✓ CONSIDER** с помощью обратные вызовы сериализации для инициализации десериализованный экземпляров.  
  
 При десериализации объектов конструкторы не вызываются. (Существуют исключения из правила. Конструкторы коллекций, помеченные <xref:System.Runtime.Serialization.CollectionDataContractAttribute>, вызываются во время десериализации.) Таким образом, любая логика, которая выполняется во время обычной разработки, должна быть реализована как один из обратных вызовов сериализации.  
  
 `OnDeserializedAttribute` является наиболее часто используемым атрибутом обратного вызова. Кроме того, в семейство входят атрибуты <xref:System.Runtime.Serialization.OnDeserializingAttribute>, <xref:System.Runtime.Serialization.OnSerializingAttribute> и <xref:System.Runtime.Serialization.OnSerializedAttribute>. Их можно использовать для пометки обратных вызовов, которые выполняются перед десериализацией, перед сериализацией и после сериализации соответственно.  
  
 **✓ CONSIDER** с помощью <xref:System.Runtime.Serialization.KnownTypeAttribute> для указания конкретных типов, которые должны использоваться при десериализации графа сложного объекта.  
  
 **✓ DO** рассмотрите возможность прямой и обратной совместимости при создании или изменении сериализуемые типы.  
  
 Необходимо помнить, что сериализуемые потоки будущих версий типа могут быть десериализованы в текущую версию типа и наоборот.  
  
 Убедитесь, что вы понимаете, что члены данных, даже частные и внутренние, не могут изменить их имена, типы или даже их порядок в будущих версиях типа, если только особое внимание не требуется для сохранения контракта с применением явных параметров к атрибутам контракта данных. .  
  
 Проверка совместимости сериализации при внесении изменений в сериализуемые типы. Попробуйте десериализовать новую версию в предыдущую и наоборот.  
  
 **✓ CONSIDER** реализации <xref:System.Runtime.Serialization.IExtensibleDataObject> разрешающее полной совместимости между различными версиями типа.  
  
 Интерфейс дает сериализатору гарантию отсутствия потерь данных при выполнении циклов обработки значений. Свойство <xref:System.Runtime.Serialization.IExtensibleDataObject.ExtensionData%2A?displayProperty=nameWithType> используется для хранения любых данных из будущей версии типа, которая неизвестна текущей версии, и поэтому не может хранить ее в своих членах данных. Когда текущая версия затем сериализуется и десериализуется в будущую версию, дополнительные данные будут доступны в сериализованном потоке.  
  
## <a name="supporting-xml-serialization"></a>Поддержка XML-сериализации  
 Сериализация контракта данных — это основная технология сериализации (по умолчанию) в .NET Framework, но существуют сценарии сериализации, не поддерживаемые сериализацией контракта данных. Например, она не обеспечивает полный контроль над формой XML-кода, создаваемого или используемого сериализатором. Если требуется такой контроль, необходимо использовать XML-сериализацию, и вам нужно разработать типы для поддержки этой технологии сериализации.  
  
 **X AVOID** полученных проектирование к типам специально для сериализации XML, если нет очень сильный причины для контроля формы XML. Эта технология сериализации была заменена сериализацией контракта данных, описанной в предыдущем разделе.  
  
 **✓ CONSIDER** реализации <xref:System.Xml.Serialization.IXmlSerializable> интерфейс, если требуется, чтобы еще больше возможностей контроля формы сериализованного XML чем предлагаемый путем применения атрибутов XML-сериализации. Два метода интерфейса, <xref:System.Xml.Serialization.IXmlSerializable.ReadXml%2A> и <xref:System.Xml.Serialization.IXmlSerializable.WriteXml%2A>, позволяют полностью управлять сериализованным XML-потоком. Можно также управлять схемой XML, созданной для типа, применяя `XmlSchemaProviderAttribute`.  
  
## <a name="supporting-runtime-serialization"></a>Поддержка сериализации во время выполнения  
 Сериализация среды выполнения — это технология, используемая удаленным взаимодействием .NET. Если вы считаете, что типы будут переноситься с помощью удаленного взаимодействия .NET, необходимо убедиться, что они поддерживают сериализацию среды выполнения.  
  
 Базовая поддержка сериализации среды выполнения может быть предоставлена путем применения <xref:System.SerializableAttribute>, а в более сложных сценариях — реализация простого шаблона сериализации во время выполнения (Реализуйте <xref:System.Runtime.Serialization.ISerializable> и предоставляли конструктор сериализация).  
  
 **✓ CONSIDER** поддерживающий сериализацию во время выполнения, если к типам, которые будут использоваться при удаленном взаимодействии .NET. Например, пространство имен <xref:System.AddIn?displayProperty=nameWithType> использует удаленное взаимодействие .NET, поэтому все типы, которыми обмениваются надстройки `System.AddIn`, должны поддерживать сериализацию среды выполнения.  
  
 **✓ CONSIDER** реализации шаблона сериализуемые среды выполнения, если требуется полный контроль над процессом сериализации. Например, в том случае, когда необходимо преобразовать сериализуемые или десериализуемые данные.  
  
 Шаблон очень прост. Нужно всего лишь реализовать интерфейс <xref:System.Runtime.Serialization.ISerializable> и предусмотреть специальный конструктор, который будет использоваться при десериализации объекта.  
  
 **✓ DO** защищенный конструктор сериализации и предоставляют два параметра типизированных и именованных точно так, как показано в примере ниже.  
  
```csharp
[Serializable]  
public class Person : ISerializable
{  
    protected Person(SerializationInfo info, StreamingContext context)
    {  
        // ...  
    }  
}  
```
  
 **✓ DO** реализовать <xref:System.Runtime.Serialization.ISerializable> члены явным образом.  
  
 **✓ DO** запрос компоновки, чтобы применить <xref:System.Runtime.Serialization.ISerializable.GetObjectData%2A?displayProperty=nameWithType> реализации. Это гарантирует, что только полностью доверенное ядро и сериализатор среды выполнения имеют доступ к члену.  
  
 *Части © 2005, 2009 Корпорация Майкрософт. Все права защищены.*  
  
 *Перепечатано с разрешения Pearson Education, Inc. из книги [Инфраструктура программных проектов. Соглашения, идиомы и шаблоны для многократно используемых библиотек .NET (2-е издание)](https://www.informit.com/store/framework-design-guidelines-conventions-idioms-and-9780321545619), авторы: Кржиштоф Цвалина (Krzysztof Cwalina) и Брэд Абрамс (Brad Abrams). Книга опубликована 22 октября 2008 г. издательством Addison-Wesley Professional в рамках серии, посвященной разработке для Microsoft Windows.*  
  
## <a name="see-also"></a>См. также:

- [Рекомендации по проектированию на основе Framework](../../../docs/standard/design-guidelines/index.md)
- [Правила использования](../../../docs/standard/design-guidelines/usage-guidelines.md)
