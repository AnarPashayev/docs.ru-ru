---
title: Сериализация
ms.date: 10/22/2008
ms.assetid: bebb27ac-9712-4196-9931-de19fc04dbac
ms.openlocfilehash: 85481e9d759a71346d83c66f67d9623fc32e76ec
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2020
ms.locfileid: "94828677"
---
# <a name="serialization"></a>Сериализация
Сериализация — это процесс преобразования объекта в формат, который можно легко сохранить или перенести. Например, можно сериализовать объект, передать его через Интернет по протоколу HTTP и десериализовать на целевом компьютере.

 .NET Framework предлагает три основные технологии сериализации, оптимизированные для различных сценариев сериализации. В следующей таблице описаны эти технологии, а также связанные с ними основные типы Framework.

|**Имя технологии**|**Основные типы**|**Сценарии**|
|-------------------------|--------------------|-------------------|
|**Сериализация контрактов данных**|<xref:System.Runtime.Serialization.DataContractAttribute> <br /> <xref:System.Runtime.Serialization.DataMemberAttribute> <br /> <xref:System.Runtime.Serialization.DataContractSerializer> <br /> <xref:System.Runtime.Serialization.NetDataContractSerializer> <br /> <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> <br /> <xref:System.Runtime.Serialization.ISerializable>|Общее сохранение<br />Веб-службы<br />JSON|
|**XML-сериализация**|<xref:System.Xml.Serialization.XmlSerializer>|Формат XML с полным контролем над формой XML|
|**Сериализация среды выполнения (двоичная и SOAP)**|<xref:System.SerializableAttribute> <br /> <xref:System.Runtime.Serialization.ISerializable> <br /> <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> <br /> <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>|Удаленное взаимодействие .NET|

 ✔️ думать о сериализации при проектировании новых типов.

## <a name="choosing-the-right-serialization-technology-to-support"></a>Правильный выбор сериализации для поддержки
 ✔️ Рассмотрите поддержку сериализации контракта данных, если экземпляры типа могут быть сохранены или использованы в веб-службах.

 ✔️ Рассмотрите возможность поддержки сериализации XML вместо сериализации контракта данных, если требуется больший контроль над форматом XML, создаваемым при сериализации типа.

 Это может быть необходимо в некоторых сценариях взаимодействия, когда необходимо использовать конструкцию XML, не поддерживаемую сериализацией контракта данных, например для создания XML-атрибутов.

 ✔️ РЕКОМЕНДУЕТСЯ поддерживать сериализацию среды выполнения, если экземпляры типа должны перемещаться между границами удаленного взаимодействия .NET.

 ❌ Избегайте поддержки сериализации среды выполнения или сериализации XML только для общих целей сохранения. Вместо этого предпочтительнее использовать сериализацию контракта данных.

## <a name="supporting-data-contract-serialization"></a>Поддержка сериализации контракта данных
 Типы могут поддерживать сериализацию контракта данных, применяя <xref:System.Runtime.Serialization.DataContractAttribute> к типу и <xref:System.Runtime.Serialization.DataMemberAttribute> к элементам (поля и свойства) типа.

 ✔️ Рассмотрите возможность пометки членов данных типа public, если тип можно использовать в частичном доверии.

 При полном доверии сериализаторы контрактов данных могут сериализовать и десериализовать неоткрытые типы и члены, но только открытые члены могут быть сериализованы и десериализованы при частичном доверии.

 ✔️ реализовать методы получения и задания для всех свойств, имеющих <xref:System.Runtime.Serialization.DataMemberAttribute> . Для сериализаторов контрактов данных требуется, чтобы метод считывания и метод задания для типа считались сериализуемыми. (В .NET Framework 3,5 с пакетом обновления 1 (SP1) некоторые свойства коллекции могут быть доступны только для получения.) Если тип не будет использоваться в частичном доверии, то один или оба из методов доступа к свойствам могут быть не открытыми.

 ✔️ Рассмотрите возможность использования обратных вызовов сериализации для инициализации десериализованных экземпляров.

 При десериализации объектов конструкторы не вызываются. (Существуют исключения из правила. Конструкторы коллекций, помеченные атрибутом <xref:System.Runtime.Serialization.CollectionDataContractAttribute> , вызываются во время десериализации.) Таким образом, любая логика, которая выполняется во время обычной разработки, должна быть реализована как один из обратных вызовов сериализации.

 `OnDeserializedAttribute` наиболее часто используемый атрибут обратного вызова. Кроме того, в семейство входят атрибуты <xref:System.Runtime.Serialization.OnDeserializingAttribute>, <xref:System.Runtime.Serialization.OnSerializingAttribute> и <xref:System.Runtime.Serialization.OnSerializedAttribute>. Их можно использовать для пометки обратных вызовов, которые выполняются перед десериализацией, перед сериализацией и после сериализации соответственно.

 ✔️ РЕКОМЕНДУЕТСЯ использовать <xref:System.Runtime.Serialization.KnownTypeAttribute> для указания конкретных типов, которые должны использоваться при десериализации сложного графа объекта.

 ✔️ учитывать обратную и прямую совместимость при создании или изменении сериализуемых типов.

 Необходимо помнить, что сериализуемые потоки будущих версий типа могут быть десериализованы в текущую версию типа и наоборот.

 Убедитесь, что вы понимаете, что члены данных, даже частные и внутренние, не могут изменить их имена, типы или даже их порядок в будущих версиях типа, если только особое внимание не требуется для сохранения контракта с применением явных параметров к атрибутам контракта данных.

 Проверка совместимости сериализации при внесении изменений в сериализуемые типы. Попробуйте десериализовать новую версию в предыдущую и наоборот.

 ✔️ РЕКОМЕНДУЕТСЯ реализовать <xref:System.Runtime.Serialization.IExtensibleDataObject> , чтобы разрешить циклический переход между разными версиями типа.

 Интерфейс дает сериализатору гарантию отсутствия потерь данных при выполнении циклов обработки значений. <xref:System.Runtime.Serialization.IExtensibleDataObject.ExtensionData%2A?displayProperty=nameWithType>Свойство используется для хранения любых данных из будущей версии типа, которая неизвестна текущей версии, и поэтому не может хранить ее в своих членах данных. Когда текущая версия затем сериализуется и десериализуется в будущую версию, дополнительные данные будут доступны в сериализованном потоке.

## <a name="supporting-xml-serialization"></a>Поддержка XML-сериализации
 Сериализация контракта данных — это основная технология сериализации (по умолчанию) в .NET Framework, но существуют сценарии сериализации, не поддерживаемые сериализацией контракта данных. Например, она не обеспечивает полный контроль над формой XML-кода, создаваемого или используемого сериализатором. Если требуется такой контроль, необходимо использовать XML-сериализацию, и вам нужно разработать типы для поддержки этой технологии сериализации.

 ❌ Избегайте разработки типов специально для сериализации XML, если нет серьезной причины для управления формой создаваемого XML. Эта технология сериализации была заменена сериализацией контракта данных, описанной в предыдущем разделе.

 ✔️ РЕКОМЕНДУЕТСЯ реализовать <xref:System.Xml.Serialization.IXmlSerializable> интерфейс, если требуется более полный контроль над формой сериализованного XML, чем предложено, применяя атрибуты СЕРИАЛИЗАЦИИ XML. Два метода интерфейса, <xref:System.Xml.Serialization.IXmlSerializable.ReadXml%2A> и <xref:System.Xml.Serialization.IXmlSerializable.WriteXml%2A>, обеспечивают полный контроль над сериализуемым потоком XML. Можно также управлять схемой XML, создаваемой для типа, применяя `XmlSchemaProviderAttribute` .

## <a name="supporting-runtime-serialization"></a>Поддержка сериализации во время выполнения
 Сериализация среды выполнения — это технология, используемая удаленным взаимодействием .NET. Если вы считаете, что типы будут переноситься с помощью удаленного взаимодействия .NET, необходимо убедиться, что они поддерживают сериализацию среды выполнения.

 Базовая поддержка сериализации среды выполнения может быть предоставлена путем применения <xref:System.SerializableAttribute> , и более сложные сценарии включают реализацию простого шаблона сериализации во время выполнения (реализующий <xref:System.Runtime.Serialization.ISerializable> и предоставляющих конструктор сериализация).

 ✔️ РЕКОМЕНДУЕТСЯ поддерживать сериализацию среды выполнения, если типы будут использоваться с удаленным взаимодействием .NET. Например, <xref:System.AddIn?displayProperty=nameWithType> пространство имен использует удаленное взаимодействие .NET, поэтому все типы, которыми обмениваются `System.AddIn` надстройки, должны поддерживать сериализацию среды выполнения.

 ✔️ РЕКОМЕНДУЕТСЯ реализовать шаблон сериализации среды выполнения, если требуется полный контроль над процессом сериализации. Например, в том случае, когда необходимо преобразовать сериализуемые или десериализуемые данные.

 Шаблон очень прост. Нужно всего лишь реализовать интерфейс <xref:System.Runtime.Serialization.ISerializable> и предусмотреть специальный конструктор, который будет использоваться при десериализации объекта.

 ✔️ сделать конструктор сериализации защищенным и указать два введенных и именованных параметра точно так же, как показано в примере ниже.

```csharp
[Serializable]
public class Person : ISerializable
{
    protected Person(SerializationInfo info, StreamingContext context)
    {
        // ...
    }
}
```

 ✔️ реализовать эти <xref:System.Runtime.Serialization.ISerializable> элементы явным образом.

 ✔️ применить запрос ссылки к <xref:System.Runtime.Serialization.ISerializable.GetObjectData%2A?displayProperty=nameWithType> реализации. Это гарантирует, что только полностью доверенное ядро и сериализатор среды выполнения имеют доступ к члену.

 *Части © 2005, 2009 Корпорация Майкрософт. Все права защищены.*

 *Перепечатано с разрешения Pearson Education, Inc. из книги [Инфраструктура программных проектов. Соглашения, идиомы и шаблоны для многократно используемых библиотек .NET (2-е издание)](https://www.informit.com/store/framework-design-guidelines-conventions-idioms-and-9780321545619), авторы: Кржиштоф Цвалина (Krzysztof Cwalina) и Брэд Абрамс (Brad Abrams). Книга опубликована 22 октября 2008 г. издательством Addison-Wesley Professional в рамках серии, посвященной разработке для Microsoft Windows.*

## <a name="see-also"></a>См. также статью

- [Рекомендации по проектированию платформы](index.md)
- [Рекомендации по использованию](usage-guidelines.md)
