---
title: Потоки и работа с ними
description: Сведения о потоковой обработке, в том числе о процессах и потоках, о том, когда следует использовать несколько потоков и как использовать многопоточность для повышения скорости реагирования или увеличения пропускной способности в .NET.
ms.date: 11/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- multiple threads
- threading [.NET]
- threading [.NET], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
ms.openlocfilehash: f7af6e1e73016e67c097b4fdbfb5f5d2d84e00d3
ms.sourcegitcommit: 7588b1f16b7608bc6833c05f91ae670c22ef56f8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/02/2020
ms.locfileid: "93188137"
---
# <a name="threads-and-threading"></a><span data-ttu-id="078ee-103">Потоки и работа с ними</span><span class="sxs-lookup"><span data-stu-id="078ee-103">Threads and threading</span></span>

<span data-ttu-id="078ee-104">Многопоточность позволяет увеличивать скорость реагирования приложения и, если приложение работает в многопроцессорной или многоядерной системе, его пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="078ee-104">Multithreading allows you to increase the responsiveness of your application and, if your application runs on a multiprocessor or multi-core system, increase its throughput.</span></span>

## <a name="processes-and-threads"></a><span data-ttu-id="078ee-105">Процессы и потоки</span><span class="sxs-lookup"><span data-stu-id="078ee-105">Processes and threads</span></span>

<span data-ttu-id="078ee-106">*Процесс*  — это исполнение программы.</span><span class="sxs-lookup"><span data-stu-id="078ee-106">A *process* is an executing program.</span></span> <span data-ttu-id="078ee-107">Операционная система использует процессы для разделения исполняемых приложений.</span><span class="sxs-lookup"><span data-stu-id="078ee-107">An operating system uses processes to separate the applications that are being executed.</span></span> <span data-ttu-id="078ee-108">*Поток*  — это основная единица, которой операционная система выделяет время процессора.</span><span class="sxs-lookup"><span data-stu-id="078ee-108">A *thread* is the basic unit to which an operating system allocates processor time.</span></span> <span data-ttu-id="078ee-109">Каждый поток имеет [приоритет планирования](scheduling-threads.md) и набор структур, в которых система сохраняет контекст потока, когда выполнение потока приостановлено.</span><span class="sxs-lookup"><span data-stu-id="078ee-109">Each thread has a [scheduling priority](scheduling-threads.md) and maintains a set of structures the system uses to save the thread context when the thread's execution is paused.</span></span> <span data-ttu-id="078ee-110">Контекст потока содержит все сведения, позволяющие потоку безболезненно возобновить выполнение, в том числе набор регистров процессора и стек потока.</span><span class="sxs-lookup"><span data-stu-id="078ee-110">The thread context includes all the information the thread needs to seamlessly resume execution, including the thread's set of CPU registers and stack.</span></span> <span data-ttu-id="078ee-111">Несколько потоков могут выполняться в контексте процесса.</span><span class="sxs-lookup"><span data-stu-id="078ee-111">Multiple threads can run in the context of a process.</span></span> <span data-ttu-id="078ee-112">Все потоки процесса используют общий диапазон виртуальных адресов.</span><span class="sxs-lookup"><span data-stu-id="078ee-112">All threads of a process share its virtual address space.</span></span> <span data-ttu-id="078ee-113">Поток может исполнять любую часть программного кода, включая части, выполняемые в данный момент другим потоком.</span><span class="sxs-lookup"><span data-stu-id="078ee-113">A thread can execute any part of the program code, including parts currently being executed by another thread.</span></span>

> [!NOTE]
> <span data-ttu-id="078ee-114">Платформа .NET Framework предоставляет способ изоляции приложений в процессе с помощью *доменов приложений*.</span><span class="sxs-lookup"><span data-stu-id="078ee-114">.NET Framework provides a way to isolate applications within a process with the use of *application domains*.</span></span> <span data-ttu-id="078ee-115">(Домены приложений недоступны в .NET Core.) Дополнительные сведения см. в разделе [Домены приложений и потоки](../../framework/app-domains/application-domains.md#application-domains-and-threads) в статье [Домены приложений](../../framework/app-domains/application-domains.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-115">(Application domains are not available on .NET Core.) For more information, see the [Application domains and threads](../../framework/app-domains/application-domains.md#application-domains-and-threads) section of the [Application domains](../../framework/app-domains/application-domains.md) article.</span></span>

<span data-ttu-id="078ee-116">По умолчанию программа .NET запускается с одним потоком, часто называемым *основным* потоком.</span><span class="sxs-lookup"><span data-stu-id="078ee-116">By default, a .NET program is started with a single thread, often called the *primary* thread.</span></span> <span data-ttu-id="078ee-117">Тем не менее она может создавать дополнительные потоки для выполнения кода параллельно или одновременно с основным потоком.</span><span class="sxs-lookup"><span data-stu-id="078ee-117">However, it can create additional threads to execute code in parallel or concurrently with the primary thread.</span></span> <span data-ttu-id="078ee-118">Эти потоки часто называются *рабочими потоками*.</span><span class="sxs-lookup"><span data-stu-id="078ee-118">These threads are often called *worker* threads.</span></span>

## <a name="when-to-use-multiple-threads"></a><span data-ttu-id="078ee-119">Цели применения нескольких потоков</span><span class="sxs-lookup"><span data-stu-id="078ee-119">When to use multiple threads</span></span>

<span data-ttu-id="078ee-120">Используйте несколько потоков, чтобы увеличить скорость реагирования приложения и воспользоваться преимуществами многопроцессорной или многоядерной системы, чтобы увеличить пропускную способность приложения.</span><span class="sxs-lookup"><span data-stu-id="078ee-120">You use multiple threads to increase the responsiveness of your application and to take advantage of a multiprocessor or multi-core system to increase the application's throughput.</span></span>

<span data-ttu-id="078ee-121">Представьте себе классическое приложение, в котором основной поток отвечает за элементы пользовательского интерфейса и реагирует на действия пользователя.</span><span class="sxs-lookup"><span data-stu-id="078ee-121">Consider a desktop application, in which the primary thread is responsible for user interface elements and responds to user actions.</span></span> <span data-ttu-id="078ee-122">Используйте рабочие потоки для выполнения длительных операций, которые, в противном случае будут занимать основной поток, в результате чего пользовательский интерфейс будет недоступен.</span><span class="sxs-lookup"><span data-stu-id="078ee-122">Use worker threads to perform time-consuming operations that, otherwise, would occupy the primary thread and make the user interface non-responsive.</span></span> <span data-ttu-id="078ee-123">Для более оперативной реакции на входящие сообщения или события также можно использовать выделенный поток связи с сетью или устройством.</span><span class="sxs-lookup"><span data-stu-id="078ee-123">You can also use a dedicated thread for network or device communication to be more responsive to incoming messages or events.</span></span>

<span data-ttu-id="078ee-124">Если программа выполняет операции, которые могут выполняться параллельно, можно уменьшить общее время выполнения путем выполнения этих операций в отдельных потоках и запуска программы в многопроцессорной или многоядерной системе.</span><span class="sxs-lookup"><span data-stu-id="078ee-124">If your program performs operations that can be done in parallel, the total execution time can be decreased by performing those operations in separate threads and running the program on a multiprocessor or multi-core system.</span></span> <span data-ttu-id="078ee-125">В такой системе использование многопоточности может увеличить пропускную способность, а также повысить скорость реагирования.</span><span class="sxs-lookup"><span data-stu-id="078ee-125">On such a system, use of multithreading might increase throughput along with the increased responsiveness.</span></span>

## <a name="how-to-use-multithreading-in-net"></a><span data-ttu-id="078ee-126">Как использовать многопоточность в .NET</span><span class="sxs-lookup"><span data-stu-id="078ee-126">How to use multithreading in .NET</span></span>

<span data-ttu-id="078ee-127">Начиная с .NET Framework 4, для многопоточности рекомендуется использовать [библиотеку параллельных задач (TPL)](../parallel-programming/task-parallel-library-tpl.md) и [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-127">Starting with .NET Framework 4, the recommended way to utilize multithreading is to use [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) and [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md).</span></span> <span data-ttu-id="078ee-128">Дополнительные сведения см. в разделе [Параллельное программирование](../parallel-programming/index.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-128">For more information, see [Parallel programming](../parallel-programming/index.md).</span></span>

<span data-ttu-id="078ee-129">Библиотека параллельных задач и PLINQ полагаются на потоки <xref:System.Threading.ThreadPool>.</span><span class="sxs-lookup"><span data-stu-id="078ee-129">Both TPL and PLINQ rely on the <xref:System.Threading.ThreadPool> threads.</span></span> <span data-ttu-id="078ee-130">Класс <xref:System.Threading.ThreadPool?displayProperty=nameWithType> предоставляет приложения .NET с пулом рабочих потоков.</span><span class="sxs-lookup"><span data-stu-id="078ee-130">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides a .NET application with a pool of worker threads.</span></span> <span data-ttu-id="078ee-131">Также можно использовать потоки из пула потоков.</span><span class="sxs-lookup"><span data-stu-id="078ee-131">You can also use thread pool threads.</span></span> <span data-ttu-id="078ee-132">Дополнительные сведения см. в разделе [Управляемый пул потоков](the-managed-thread-pool.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-132">For more information, see [The managed thread pool](the-managed-thread-pool.md).</span></span>

<span data-ttu-id="078ee-133">Наконец, можно использовать класс <xref:System.Threading.Thread?displayProperty=nameWithType>, который представляет управляемый поток.</span><span class="sxs-lookup"><span data-stu-id="078ee-133">At last, you can use the <xref:System.Threading.Thread?displayProperty=nameWithType> class that represents a managed thread.</span></span> <span data-ttu-id="078ee-134">Дополнительные сведения см. в разделе [Использование потоков и работа с потоками](using-threads-and-threading.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-134">For more information, see [Using threads and threading](using-threads-and-threading.md).</span></span>

<span data-ttu-id="078ee-135">Несколько потоков могут требовать доступ к общему ресурсу.</span><span class="sxs-lookup"><span data-stu-id="078ee-135">Multiple threads might need to access a shared resource.</span></span> <span data-ttu-id="078ee-136">Чтобы сохранить ресурс в неповрежденном состоянии и избежать состояния гонки, необходимо синхронизировать доступ к нему потоков.</span><span class="sxs-lookup"><span data-stu-id="078ee-136">To keep the resource in a uncorrupted state and avoid race conditions, you must synchronize the thread access to it.</span></span> <span data-ttu-id="078ee-137">Вы также можете координировать взаимодействие нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="078ee-137">You also might want to coordinate the interaction of multiple threads.</span></span> <span data-ttu-id="078ee-138">Платформа .NET предоставляет ряд типов для синхронизации доступа к общему ресурсу или координации взаимодействия потоков.</span><span class="sxs-lookup"><span data-stu-id="078ee-138">.NET provides a range of types that you can use to synchronize access to a shared resource or coordinate thread interaction.</span></span> <span data-ttu-id="078ee-139">Дополнительные сведения см. в разделе [Обзор примитивов синхронизации](overview-of-synchronization-primitives.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-139">For more information, see [Overview of synchronization primitives](overview-of-synchronization-primitives.md).</span></span>

<span data-ttu-id="078ee-140">Исключения следует обрабатывать в потоках.</span><span class="sxs-lookup"><span data-stu-id="078ee-140">Do handle exceptions in threads.</span></span> <span data-ttu-id="078ee-141">Необработанные исключения в потоках, как правило, приводят к завершению процесса.</span><span class="sxs-lookup"><span data-stu-id="078ee-141">Unhandled exceptions in threads generally terminate the process.</span></span> <span data-ttu-id="078ee-142">Дополнительные сведения см. в статье [Исключения в управляемых потоках](exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="078ee-142">For more information, see [Exceptions in managed threads](exceptions-in-managed-threads.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="078ee-143">См. также</span><span class="sxs-lookup"><span data-stu-id="078ee-143">See also</span></span>

- [<span data-ttu-id="078ee-144">Объекты и функциональные возможности работы с потоками</span><span class="sxs-lookup"><span data-stu-id="078ee-144">Threading objects and features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="078ee-145">Рекомендации по работе с потоками</span><span class="sxs-lookup"><span data-stu-id="078ee-145">Managed threading best practices</span></span>](managed-threading-best-practices.md)
- [<span data-ttu-id="078ee-146">Параллельная обработка, параллелизм и асинхронное программирование в .NET</span><span class="sxs-lookup"><span data-stu-id="078ee-146">Parallel Processing, Concurrency, and Async Programming in .NET</span></span>](../parallel-processing-and-concurrency.md)
- [<span data-ttu-id="078ee-147">Процессы и потоки</span><span class="sxs-lookup"><span data-stu-id="078ee-147">About Processes and Threads</span></span>](/windows/desktop/procthread/about-processes-and-threads)
