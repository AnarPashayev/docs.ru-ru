---
title: Использование потоков и работа с потоками
description: Сведения об использовании потоков и работе с потоками в .NET для написания приложений, способных одновременно выполнять несколько операций (многопоточность).
ms.date: 08/08/2018
helpviewer_keywords:
- threading [.NET], about threading
- managed threading
ms.assetid: 9b5ec2cd-121b-4d49-b075-222cf26f2344
ms.openlocfilehash: 85968cfb1a228826429876e525f0c8452f97cfc4
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2020
ms.locfileid: "94826096"
---
# <a name="using-threads-and-threading"></a><span data-ttu-id="2ca68-103">Использование потоков и работа с потоками</span><span class="sxs-lookup"><span data-stu-id="2ca68-103">Using threads and threading</span></span>

<span data-ttu-id="2ca68-104">С помощью языка .NET можно создавать приложения, которые выполняют несколько операций одновременно.</span><span class="sxs-lookup"><span data-stu-id="2ca68-104">With .NET, you can write applications that perform multiple operations at the same time.</span></span> <span data-ttu-id="2ca68-105">Операции, которые потенциально могут задержать выполнение других операций, выполняются в отдельных потоках; такой способ организации работы приложения называется *многопоточностью* или *свободным созданием потоков*.</span><span class="sxs-lookup"><span data-stu-id="2ca68-105">Operations with the potential of holding up other operations can execute on separate threads, a process known as *multithreading* or *free threading*.</span></span>  
  
<span data-ttu-id="2ca68-106">Приложения, использующие многопоточность, более оперативно реагируют на действия пользователя, поскольку пользовательский интерфейс остается активным, в то время как задачи, требующие интенсивной работы процессора, выполняются в других потоках.</span><span class="sxs-lookup"><span data-stu-id="2ca68-106">Applications that use multithreading are more responsive to user input because the user interface stays active as processor-intensive tasks execute on separate threads.</span></span> <span data-ttu-id="2ca68-107">Многопоточность также эффективна при создании масштабируемых приложений, поскольку пользователь может добавлять потоки при увеличении рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="2ca68-107">Multithreading is also useful when you create scalable applications, because you can add threads as the workload increases.</span></span>

> [!NOTE]
> <span data-ttu-id="2ca68-108">Если требуется больший контроль над поведением потоков приложения, можно управлять потоками самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="2ca68-108">If you need more control over the behavior of the application's threads, you can manage the threads yourself.</span></span> <span data-ttu-id="2ca68-109">Однако многопоточное программирование значительно упрощено благодаря классам <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> и <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md), классам параллельных коллекций из пространства имен <xref:System.Collections.Concurrent?displayProperty=nameWithType> и модели программирования, которая вместо потоков использует концепцию задач.</span><span class="sxs-lookup"><span data-stu-id="2ca68-109">However, multithreaded programming is greatly simplified with the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> classes, [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md), concurrent collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and a programming model that is based on the concept of tasks rather than threads.</span></span> <span data-ttu-id="2ca68-110">Дополнительные сведения см. в статье [Параллельное программирование в .NET](../parallel-programming/index.md) и [Библиотека параллельных задач (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="2ca68-110">For more information, see [Parallel Programming](../parallel-programming/index.md) and [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span>

## <a name="how-to-create-and-start-a-new-thread"></a><span data-ttu-id="2ca68-111">Практическое руководство. Создание и запуск нового потока</span><span class="sxs-lookup"><span data-stu-id="2ca68-111">How to: Create and start a new thread</span></span>

<span data-ttu-id="2ca68-112">Чтобы создать поток, создайте новый экземпляр класса <xref:System.Threading.Thread?displayProperty=nameWithType> и укажите в конструкторе имя метода, который должен выполняться в новом потоке.</span><span class="sxs-lookup"><span data-stu-id="2ca68-112">You create a new thread by creating a new instance of the <xref:System.Threading.Thread?displayProperty=nameWithType> class and providing the name of the method that you want to execute on a new thread to the constructor.</span></span> <span data-ttu-id="2ca68-113">Чтобы запустить созданный поток, вызовите метод <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-113">To start a created thread, call the <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2ca68-114">Дополнительные сведения и примеры см. в статье [Создание потоков и передача данных во время запуска](creating-threads-and-passing-data-at-start-time.md) и справочнике по API <xref:System.Threading.Thread>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-114">For more information and examples, see the [Creating threads and passing data at start time](creating-threads-and-passing-data-at-start-time.md) article and the <xref:System.Threading.Thread> API reference.</span></span>

## <a name="how-to-stop-a-thread"></a><span data-ttu-id="2ca68-115">Практическое руководство. Остановка потока</span><span class="sxs-lookup"><span data-stu-id="2ca68-115">How to: Stop a thread</span></span>

<span data-ttu-id="2ca68-116">Чтобы прервать выполнение потока, используйте метод <xref:System.Threading.CancellationToken?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-116">To terminate the execution of a thread, use the <xref:System.Threading.CancellationToken?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2ca68-117">Это единый способ совместной отмены потоков.</span><span class="sxs-lookup"><span data-stu-id="2ca68-117">It provides a unified way to stop threads cooperatively.</span></span> <span data-ttu-id="2ca68-118">Подробные сведения см. в статье [Отмена в управляемых потоках](cancellation-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="2ca68-118">For more information, see [Cancellation in managed threads](cancellation-in-managed-threads.md).</span></span>

<span data-ttu-id="2ca68-119">Иногда выполнить совместную отмену потока невозможно, так как он выполняет код сторонних производителей, не поддерживающий такую отмену.</span><span class="sxs-lookup"><span data-stu-id="2ca68-119">Sometimes it is not possible to stop a thread cooperatively, because it runs third-party code not designed for cooperative cancellation.</span></span> <span data-ttu-id="2ca68-120">В этом случае вы можете выполнить принудительное завершение.</span><span class="sxs-lookup"><span data-stu-id="2ca68-120">In this case, you might want to terminate its execution forcibly.</span></span> <span data-ttu-id="2ca68-121">Чтобы принудительно завершить выполнение потока, воспользуйтесь методом <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2ca68-121">To terminate the execution of a thread forcibly, in .NET Framework you can use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2ca68-122">Этот метод вызывает <xref:System.Threading.ThreadAbortException> в потоке, для которого был вызван.</span><span class="sxs-lookup"><span data-stu-id="2ca68-122">That method raises a <xref:System.Threading.ThreadAbortException> on the thread on which it's invoked.</span></span> <span data-ttu-id="2ca68-123">Дополнительные сведения см. в разделе [Уничтожение потоков](destroying-threads.md).</span><span class="sxs-lookup"><span data-stu-id="2ca68-123">For more information, see [Destroying threads](destroying-threads.md).</span></span> <span data-ttu-id="2ca68-124">Метод <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> не поддерживается в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2ca68-124">The <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method is not supported in .NET Core.</span></span> <span data-ttu-id="2ca68-125">Если необходимо принудительно завершить выполнение кода сторонних производителей в .NET Core, запустите его в отдельном процессе и воспользуйтесь <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-125">If you need to terminate the execution of third-party code forcibly in .NET Core, run it in the separate process and use <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="2ca68-126"><xref:System.Threading.CancellationToken?displayProperty=nameWithType> можно использовать только начиная с .NET Framework 4.</span><span class="sxs-lookup"><span data-stu-id="2ca68-126">The <xref:System.Threading.CancellationToken?displayProperty=nameWithType> is not available before .NET Framework 4.</span></span> <span data-ttu-id="2ca68-127">Чтобы завершить поток в более ранних версиях .NET Framework, вручную реализуйте совместную отмену с помощью методов синхронизации потоков.</span><span class="sxs-lookup"><span data-stu-id="2ca68-127">To stop a thread in older .NET Framework versions, implement the cooperative cancellation manually using the thread synchronization techniques.</span></span> <span data-ttu-id="2ca68-128">Например, вы можете создать изменяемое логическое поле `shouldStop` и использовать его для запроса остановки кода, выполняемого потоком.</span><span class="sxs-lookup"><span data-stu-id="2ca68-128">For example, you can create the volatile boolean field `shouldStop` and use it to request the code executed by the thread to stop.</span></span> <span data-ttu-id="2ca68-129">Дополнительные сведения см. в [справочнике по C#](../../csharp/language-reference/keywords/volatile.md) и в этой статье: <xref:System.Threading.Volatile?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-129">For more information, see [volatile](../../csharp/language-reference/keywords/volatile.md) in C# Reference and <xref:System.Threading.Volatile?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="2ca68-130">Используйте метод <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType>, чтобы вызывающий поток ждал завершения останавливаемого потока.</span><span class="sxs-lookup"><span data-stu-id="2ca68-130">Use the <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method to make the calling thread wait for the termination of the thread being stopped.</span></span>

## <a name="how-to-pause-or-interrupt-a-thread"></a><span data-ttu-id="2ca68-131">Практическое руководство. Приостановка или прерывание потока</span><span class="sxs-lookup"><span data-stu-id="2ca68-131">How to: Pause or interrupt a thread</span></span>

<span data-ttu-id="2ca68-132">Используйте метод <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType>, чтобы приостановить текущий поток на определенное время.</span><span class="sxs-lookup"><span data-stu-id="2ca68-132">You use the <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> method to pause the current thread for a specified amount of time.</span></span> <span data-ttu-id="2ca68-133">Заблокированный поток можно прервать путем вызова метода <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-133">You can interrupt a blocked thread by calling the <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2ca68-134">Дополнительные сведения см. в разделе [Приостановка и прерывание потоков](pausing-and-resuming-threads.md).</span><span class="sxs-lookup"><span data-stu-id="2ca68-134">For more information, see [Pausing and interrupting threads](pausing-and-resuming-threads.md).</span></span>

## <a name="thread-properties"></a><span data-ttu-id="2ca68-135">Свойства потока</span><span class="sxs-lookup"><span data-stu-id="2ca68-135">Thread properties</span></span>

<span data-ttu-id="2ca68-136">В приведенной ниже таблице показаны некоторые свойства <xref:System.Threading.Thread>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-136">The following table presents some of the <xref:System.Threading.Thread> properties:</span></span>  
  
|<span data-ttu-id="2ca68-137">Свойство.</span><span class="sxs-lookup"><span data-stu-id="2ca68-137">Property</span></span>|<span data-ttu-id="2ca68-138">Описание</span><span class="sxs-lookup"><span data-stu-id="2ca68-138">Description</span></span>|  
|--------------|-----------|  
|<xref:System.Threading.Thread.IsAlive%2A>|<span data-ttu-id="2ca68-139">Возвращает `true`, если поток был запущен и не был завершен нормально либо был прерван.</span><span class="sxs-lookup"><span data-stu-id="2ca68-139">Returns `true` if a thread has been started and has not yet terminated normally or aborted.</span></span>|  
|<xref:System.Threading.Thread.IsBackground%2A>|<span data-ttu-id="2ca68-140">Возвращает или задает логическое значение, которое указывает, является ли поток фоновым потоком.</span><span class="sxs-lookup"><span data-stu-id="2ca68-140">Gets or sets a Boolean that indicates if a thread is a background thread.</span></span> <span data-ttu-id="2ca68-141">Фоновые потоки отличаются от основных потоков лишь тем, что они не влияют на завершение процесса.</span><span class="sxs-lookup"><span data-stu-id="2ca68-141">Background threads are like foreground threads, but a background thread doesn't prevent a process from stopping.</span></span> <span data-ttu-id="2ca68-142">Когда обработка всех основных потоков закончена, общеязыковая среда выполнения завершает процесс, применяя метод <xref:System.Threading.Thread.Abort%2A> к тем фоновым потокам, которые еще продолжают существовать.</span><span class="sxs-lookup"><span data-stu-id="2ca68-142">Once all foreground threads that belong to a process have stopped, the common language runtime ends the process by calling the <xref:System.Threading.Thread.Abort%2A> method on background threads that are still alive.</span></span> <span data-ttu-id="2ca68-143">См. дополнительные сведения об [основных и фоновых потоках](foreground-and-background-threads.md).</span><span class="sxs-lookup"><span data-stu-id="2ca68-143">For more information, see [Foreground and Background Threads](foreground-and-background-threads.md).</span></span>|  
|<xref:System.Threading.Thread.Name%2A>|<span data-ttu-id="2ca68-144">Возвращает или задает имя потока.</span><span class="sxs-lookup"><span data-stu-id="2ca68-144">Gets or sets the name of a thread.</span></span> <span data-ttu-id="2ca68-145">Наиболее часто используется для обнаружения отдельных потоков при отладке.</span><span class="sxs-lookup"><span data-stu-id="2ca68-145">Most frequently used to discover individual threads when you debug.</span></span>|  
|<xref:System.Threading.Thread.Priority%2A>|<span data-ttu-id="2ca68-146">Возвращает или задает значение <xref:System.Threading.ThreadPriority>, которое используется операционной системой для установки приоритетов потоков.</span><span class="sxs-lookup"><span data-stu-id="2ca68-146">Gets or sets a <xref:System.Threading.ThreadPriority> value that is used by the operating system to prioritize thread scheduling.</span></span> <span data-ttu-id="2ca68-147">Дополнительные сведения см. в разделе [Планирование потоков](scheduling-threads.md) и в справочнике по <xref:System.Threading.ThreadPriority>.</span><span class="sxs-lookup"><span data-stu-id="2ca68-147">For more information, see [Scheduling threads](scheduling-threads.md) and the <xref:System.Threading.ThreadPriority> reference.</span></span>|  
|<xref:System.Threading.Thread.ThreadState%2A>|<span data-ttu-id="2ca68-148">Возвращает значение <xref:System.Threading.ThreadState>, содержащее текущие состояния потока.</span><span class="sxs-lookup"><span data-stu-id="2ca68-148">Gets a <xref:System.Threading.ThreadState> value containing the current states of a thread.</span></span>|  

## <a name="see-also"></a><span data-ttu-id="2ca68-149">См. также</span><span class="sxs-lookup"><span data-stu-id="2ca68-149">See also</span></span>

- <xref:System.Threading.Thread?displayProperty=nameWithType>
- [<span data-ttu-id="2ca68-150">Потоки и работа с потоками</span><span class="sxs-lookup"><span data-stu-id="2ca68-150">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="2ca68-151">Параллельное программирование</span><span class="sxs-lookup"><span data-stu-id="2ca68-151">Parallel Programming</span></span>](../parallel-programming/index.md)
