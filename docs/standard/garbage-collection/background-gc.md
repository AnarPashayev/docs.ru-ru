---
title: Фоновая сборка мусора
description: Познакомьтесь с фоновой сборкой мусора в .NET и ее различиях в сборке мусора на рабочих станциях и серверах.
ms.date: 04/21/2020
helpviewer_keywords:
- garbage collection, background
- background garbage collection
ms.openlocfilehash: 780503288d3474cd99a595bdbd52c3a5abba5308
ms.sourcegitcommit: 45c8eed045779b70a47b23169897459d0323dc89
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/18/2020
ms.locfileid: "84990237"
---
# <a name="background-garbage-collection"></a><span data-ttu-id="1669e-103">Фоновая сборка мусора</span><span class="sxs-lookup"><span data-stu-id="1669e-103">Background garbage collection</span></span>

<span data-ttu-id="1669e-104">При фоновой сборке мусора сборка эфемерных поколений (0 и 1) выполняется по мере надобности, в ходе выполнения сборки поколения 2.</span><span class="sxs-lookup"><span data-stu-id="1669e-104">In background garbage collection (GC), ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="1669e-105">Фоновая сборка мусора выполняется в одном или нескольких выделенных потоках в зависимости от того, является ли она фоновой или серверной и применяется только к коллекциям поколения 2.</span><span class="sxs-lookup"><span data-stu-id="1669e-105">Background garbage collection is performed on one or more dedicated threads, depending on whether it's background or server GC, and applies only to generation 2 collections.</span></span>

<span data-ttu-id="1669e-106">Фоновая сборка мусора включена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1669e-106">Background garbage collection is enabled by default.</span></span> <span data-ttu-id="1669e-107">Ее можно включить или отключить с помощью параметра конфигурации [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) в приложениях .NET Framework или параметра [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) в приложениях .NET Core.</span><span class="sxs-lookup"><span data-stu-id="1669e-107">It can be enabled or disabled with the [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework apps or the [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) setting in .NET Core apps.</span></span>

> [!NOTE]
> <span data-ttu-id="1669e-108">Фоновая сборка мусора заменяет [параллельную сборку мусора](#concurrent-garbage-collection) и доступна в .NET Framework 4 и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="1669e-108">Background garbage collection replaces [concurrent garbage collection](#concurrent-garbage-collection) and is available in .NET Framework 4 and later versions.</span></span> <span data-ttu-id="1669e-109">В .NET Framework 4 она поддерживается только для сборки мусора на *рабочих станциях*.</span><span class="sxs-lookup"><span data-stu-id="1669e-109">In .NET Framework 4, it's supported only for *workstation* garbage collection.</span></span> <span data-ttu-id="1669e-110">Начиная с .NET Framework 4.5 фоновая сборка мусора доступна для сборки мусора как на *рабочих станциях*, так и на *серверах*</span><span class="sxs-lookup"><span data-stu-id="1669e-110">Starting with .NET Framework 4.5, background garbage collection is available for both *workstation* and *server* garbage collection.</span></span>

<span data-ttu-id="1669e-111">Сборка для эфемерных поколений во время фоновой сборки мусора называется *высокоприоритетной* сборкой мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-111">A collection on ephemeral generations during background garbage collection is known as *foreground* garbage collection.</span></span> <span data-ttu-id="1669e-112">Во время выполнения высокоприоритетных сборок мусора все управляемые потоки приостанавливаются.</span><span class="sxs-lookup"><span data-stu-id="1669e-112">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="1669e-113">Если выполняется фоновая сборка мусора и в поколении 0 размещено достаточное количество объектов, среда CLR выполняет высокоприоритетную сборку мусора для поколения 0 или поколения 1.</span><span class="sxs-lookup"><span data-stu-id="1669e-113">When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="1669e-114">Выделенный поток фоновой сборки мусора проверяет в частых точках, безопасных для сбора мусора, чтобы определить, не появился ли запрос выполнения высокоприоритетной сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-114">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="1669e-115">В этом случае фоновая сборка мусора приостанавливается, чтобы позволить выполниться высокоприоритетной сборке мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-115">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="1669e-116">После выполнения высокоприоритетной сборки мусора работа выделенного потока фоновой сборки мусора и пользовательских потоков возобновляется.</span><span class="sxs-lookup"><span data-stu-id="1669e-116">After the foreground garbage collection is completed, the dedicated background garbage collection threads and user threads resume.</span></span>

<span data-ttu-id="1669e-117">Фоновая сборка мусора удаляет ограничения на распределение, наложенные параллельной сборкой мусора, так как эфемерные сборки мусора могут выполняться во время фоновой сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-117">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="1669e-118">Фоновая сборка мусора может удалить неиспользуемые объекты в эфемерных поколениях.</span><span class="sxs-lookup"><span data-stu-id="1669e-118">Background garbage collection can remove dead objects in ephemeral generations.</span></span> <span data-ttu-id="1669e-119">Она также при необходимости может увеличить кучу во время сборки мусора поколения 1.</span><span class="sxs-lookup"><span data-stu-id="1669e-119">It can also expand the heap if needed during a generation 1 garbage collection.</span></span>

## <a name="background-workstation-vs-server-gc"></a><span data-ttu-id="1669e-120">Фоновая сборка мусора на рабочих станциях и серверах</span><span class="sxs-lookup"><span data-stu-id="1669e-120">Background workstation vs. server GC</span></span>

<span data-ttu-id="1669e-121">Начиная с .NET Framework 4.5 фоновая сборка мусора стала доступна для серверной сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-121">Starting with .NET Framework 4.5, background garbage collection is available for server GC.</span></span> <span data-ttu-id="1669e-122">Это режим по умолчанию для сборки мусора сервера.</span><span class="sxs-lookup"><span data-stu-id="1669e-122">Background GC is the default mode for server garbage collection.</span></span>

<span data-ttu-id="1669e-123">Этот режим функционирует аналогично фоновой сборке мусора рабочей станции, но с некоторыми отличиями.</span><span class="sxs-lookup"><span data-stu-id="1669e-123">Background server garbage collection functions similarly to background workstation garbage collection, but there are a few differences:</span></span>

- <span data-ttu-id="1669e-124">Для фоновой сборки мусора рабочей станции используется один выделенной поток фоновой сборки мусора, тогда как для фоновой серверной сборки мусора используется несколько потоков.</span><span class="sxs-lookup"><span data-stu-id="1669e-124">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads.</span></span> <span data-ttu-id="1669e-125">Как правило, имеется по одному выделенному потоку для каждого логического процессора.</span><span class="sxs-lookup"><span data-stu-id="1669e-125">Typically, there's a dedicated thread for each logical processor.</span></span>

- <span data-ttu-id="1669e-126">В отличие от потока фоновой сборки мусора рабочей станции у потоков фоновый сборки мусора сервера время ожидания не истекает.</span><span class="sxs-lookup"><span data-stu-id="1669e-126">Unlike the workstation background garbage collection thread, the background server GC threads do not time out.</span></span>

<span data-ttu-id="1669e-127">На следующем рисунке показана фоновая сборка мусора *рабочей станции* в отдельном выделенном потоке:</span><span class="sxs-lookup"><span data-stu-id="1669e-127">The following illustration shows background *workstation* garbage collection performed on a separate, dedicated thread:</span></span>

![Фоновая сборка мусора рабочей станции](media/fundamentals/background-workstation-garbage-collection.png)

<span data-ttu-id="1669e-129">На следующем рисунке показана фоновая сборка мусора *сервера* в отдельном выделенном потоке:</span><span class="sxs-lookup"><span data-stu-id="1669e-129">The following illustration shows background *server* garbage collection performed on separate, dedicated threads:</span></span>

![Фоновая сборка мусора сервера](media/fundamentals/background-server-garbage-collection.png)

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="1669e-131">Параллельная сборка мусора</span><span class="sxs-lookup"><span data-stu-id="1669e-131">Concurrent garbage collection</span></span>

> [!TIP]
> <span data-ttu-id="1669e-132">Этот раздел касается:</span><span class="sxs-lookup"><span data-stu-id="1669e-132">This section applies to:</span></span>
>
> - <span data-ttu-id="1669e-133">.NET Framework 3.5 и более ранних версий в части, относящейся к сборке мусора рабочей станции;</span><span class="sxs-lookup"><span data-stu-id="1669e-133">.NET Framework 3.5 and earlier for workstation garbage collection</span></span>
> - <span data-ttu-id="1669e-134">.NET Framework 4 и более ранних версий в части, относящейся к серверной сборке мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-134">.NET Framework 4 and earlier for server garbage collection</span></span>
>
> <span data-ttu-id="1669e-135">В более поздних версиях параллельная сборка мусора заменена на фоновую.</span><span class="sxs-lookup"><span data-stu-id="1669e-135">Concurrent garbage is replaced by background garbage collection in later versions.</span></span>

<span data-ttu-id="1669e-136">При сборке мусора рабочей станции или серверной сборке мусора можно [включить параллельную сборку мусора](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), что позволит потокам работать параллельно с выделенным потоком, выполняющим сборку мусора, в течение большей части продолжительности сборки.</span><span class="sxs-lookup"><span data-stu-id="1669e-136">In workstation or server garbage collection, you can [enable concurrent garbage collection](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="1669e-137">Этот вариант влияет только на сборки мусора для поколения 2, сборки для поколений 0 и 1 всегда выполняются непараллельно, так как они заканчиваются быстро.</span><span class="sxs-lookup"><span data-stu-id="1669e-137">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish fast.</span></span>

<span data-ttu-id="1669e-138">Параллельная сборка мусора позволяет интерактивным приложениям лучше реагировать, минимизируя паузы для сборки.</span><span class="sxs-lookup"><span data-stu-id="1669e-138">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="1669e-139">В течение большей части времени выполнения потока параллельной сборки мусора управляемые потоки могут продолжить выполнение.</span><span class="sxs-lookup"><span data-stu-id="1669e-139">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="1669e-140">Это приведет к сокращению пауз во время выполнения сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="1669e-140">This design results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="1669e-141">Параллельная сборка мусора выполняется в выделенном потоке.</span><span class="sxs-lookup"><span data-stu-id="1669e-141">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="1669e-142">По умолчанию среда CLR выполняет сборку мусора рабочей станции с выключенной параллельной сборкой мусора, как на компьютерах с одним процессором, так и с несколькими.</span><span class="sxs-lookup"><span data-stu-id="1669e-142">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled on both single-processor and multi-processor computers.</span></span>

<span data-ttu-id="1669e-143">На следующем рисунке показана параллельная сборка мусора на отдельном выделенном потоке.</span><span class="sxs-lookup"><span data-stu-id="1669e-143">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

![Параллельные потоки сборки мусора](media/gc-concurrent.png)

## <a name="see-also"></a><span data-ttu-id="1669e-145">См. также</span><span class="sxs-lookup"><span data-stu-id="1669e-145">See also</span></span>

- [<span data-ttu-id="1669e-146">Сборка мусора рабочей станции и сборка мусора сервера</span><span class="sxs-lookup"><span data-stu-id="1669e-146">Workstation and server garbage collection</span></span>](workstation-server-gc.md)
- [<span data-ttu-id="1669e-147">Параметры конфигурации времени выполнения для сборки мусора</span><span class="sxs-lookup"><span data-stu-id="1669e-147">Run-time configuration options for garbage collection</span></span>](../../core/run-time-config/garbage-collector.md)
