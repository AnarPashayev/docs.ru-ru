---
title: Сборка мусора на рабочей станции и сервере
description: Узнайте о сборке мусора на рабочей станции и сервере с использованием .NET.
ms.date: 04/21/2020
helpviewer_keywords:
- garbage collection, workstation
- garbage collection, server
- workstation garbage collection
- server garbage collection
ms.openlocfilehash: 5ff2b1fe2f997913e071f35ec5abb167ed757608
ms.sourcegitcommit: 5280b2aef60a1ed99002dba44e4b9e7f6c830604
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "84306699"
---
# <a name="workstation-and-server-garbage-collection"></a><span data-ttu-id="fa6bc-103">Сборка мусора рабочей станции и сборка мусора сервера</span><span class="sxs-lookup"><span data-stu-id="fa6bc-103">Workstation and server garbage collection</span></span>

<span data-ttu-id="fa6bc-104">Сборщик мусора является самонастраивающимся и может работать в широком диапазоне сценариев.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-104">The garbage collector is self-tuning and can work in a wide variety of scenarios.</span></span> <span data-ttu-id="fa6bc-105">Но вы можете [задать тип сборки мусора](../../core/run-time-config/garbage-collector.md#flavors-of-garbage-collection) на основе характеристик рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-105">However, you can [set the type of garbage collection](../../core/run-time-config/garbage-collector.md#flavors-of-garbage-collection) based on the characteristics of the workload.</span></span> <span data-ttu-id="fa6bc-106">Среда CLR предоставляет следующие виды сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-106">The CLR provides the following types of garbage collection:</span></span>

- <span data-ttu-id="fa6bc-107">Сборка мусора на рабочей станции выполняется для клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-107">Workstation garbage collection (GC), which is designed for client apps.</span></span> <span data-ttu-id="fa6bc-108">Это вариант по умолчанию для автономных приложений.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-108">It's the default GC flavor for standalone apps.</span></span> <span data-ttu-id="fa6bc-109">Для размещенных приложений, например размещаемых в ASP.NET, разновидность сборки мусора по умолчанию определяется узлом.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-109">For hosted apps, for example, those hosted by ASP.NET, the host determines the default GC flavor.</span></span>

  <span data-ttu-id="fa6bc-110">Сборка мусора рабочей станции может быть параллельной или непараллельной.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-110">Workstation garbage collection can be concurrent or non-concurrent.</span></span> <span data-ttu-id="fa6bc-111">Параллельная (или *фоновая*) сборка мусора позволяет управляемым потокам продолжать операции во время этого процесса.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-111">Concurrent (or *background*) garbage collection enables managed threads to continue operations during a garbage collection.</span></span> <span data-ttu-id="fa6bc-112">В .NET Framework 4 и более поздних версиях [фоновая сборка мусора](background-gc.md) заменяет [параллельную сборку мусора](background-gc.md#concurrent-garbage-collection).</span><span class="sxs-lookup"><span data-stu-id="fa6bc-112">[Background garbage collection](background-gc.md) replaces [concurrent garbage collection](background-gc.md#concurrent-garbage-collection) in .NET Framework 4 and later versions.</span></span>

- <span data-ttu-id="fa6bc-113">Сборка мусора сервера, предназначенная для серверных приложений, которым нужны высокое быстродействие и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-113">Server garbage collection, which is intended for server applications that need high throughput and scalability.</span></span>

  - <span data-ttu-id="fa6bc-114">В .NET Core серверная сборка мусора может быть непараллельной или фоновой.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-114">In .NET Core, server garbage collection can be non-concurrent or background.</span></span>

  - <span data-ttu-id="fa6bc-115">В .NET Framework 4.5 и более поздних версий сборка мусора на сервере может быть непараллельной или фоновой.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-115">In .NET Framework 4.5 and later versions, server garbage collection can be non-concurrent or background.</span></span> <span data-ttu-id="fa6bc-116">В .NET Framework 4 и более ранних версиях серверная сборка мусора является непараллельной.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-116">In .NET Framework 4 and previous versions, server garbage collection is non-concurrent.</span></span>

<span data-ttu-id="fa6bc-117">На рисунке ниже показаны выделенные потоки, выполняющие сборку мусора на сервере.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-117">The following illustration shows the dedicated threads that perform the garbage collection on a server:</span></span>

![Потоки сборки мусора сервера](media/gc-server.png)

## <a name="performance-considerations"></a><span data-ttu-id="fa6bc-119">Особенности производительности</span><span class="sxs-lookup"><span data-stu-id="fa6bc-119">Performance considerations</span></span>

### <a name="workstation-gc"></a><span data-ttu-id="fa6bc-120">Сборщик мусора рабочей станции</span><span class="sxs-lookup"><span data-stu-id="fa6bc-120">Workstation GC</span></span>

<span data-ttu-id="fa6bc-121">Ниже приведены замечания по сборке мусора рабочей станции, касающиеся потоков и производительности.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-121">The following are threading and performance considerations for workstation garbage collection:</span></span>

- <span data-ttu-id="fa6bc-122">Сборка выполняется для пользовательского потока, запустившего сборку мусора, и сохраняет тот же приоритет.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-122">The collection occurs on the user thread that triggered the garbage collection and remains at the same priority.</span></span> <span data-ttu-id="fa6bc-123">Так как пользовательские потоки обычно выполняются с обычным приоритетом, сборщик мусора (выполняемый для потока с обычным приоритетом) должен конкурировать с другими потоками за время процессора.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-123">Because user threads typically run at normal priority, the garbage collector (which runs on a normal priority thread) must compete with other threads for CPU time.</span></span> <span data-ttu-id="fa6bc-124">(Потоки, выполняющие машинный код, не приостанавливаются ни при серверной сборке мусора, ни при сборке мусора рабочей станции.)</span><span class="sxs-lookup"><span data-stu-id="fa6bc-124">(Threads that run native code are not suspended on either server or workstation garbage collection.)</span></span>

- <span data-ttu-id="fa6bc-125">Для компьютера с одним процессором всегда используется сборка мусора рабочей станции, независимо от [параметра конфигурации](../../core/run-time-config/garbage-collector.md#systemgcservercomplus_gcserver).</span><span class="sxs-lookup"><span data-stu-id="fa6bc-125">Workstation garbage collection is always used on a computer that has only one processor, regardless of the [configuration setting](../../core/run-time-config/garbage-collector.md#systemgcservercomplus_gcserver).</span></span>

### <a name="server-gc"></a><span data-ttu-id="fa6bc-126">Сборщик мусора сервера</span><span class="sxs-lookup"><span data-stu-id="fa6bc-126">Server GC</span></span>

<span data-ttu-id="fa6bc-127">Ниже приведены замечания по сборке мусора сервера, касающиеся потоков и производительности.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-127">The following are threading and performance considerations for server garbage collection:</span></span>

- <span data-ttu-id="fa6bc-128">Сборка выполняется в нескольких выделенных потоках, выполняемых с приоритетом `THREAD_PRIORITY_HIGHEST` .</span><span class="sxs-lookup"><span data-stu-id="fa6bc-128">The collection occurs on multiple dedicated threads that are running at `THREAD_PRIORITY_HIGHEST` priority level.</span></span>

- <span data-ttu-id="fa6bc-129">Для каждого процессора предоставляется куча и выделенный поток, выполняющий сборку мусора, и сборка куч выполняется одновременно.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-129">A heap and a dedicated thread to perform garbage collection are provided for each CPU, and the heaps are collected at the same time.</span></span> <span data-ttu-id="fa6bc-130">Каждая куча содержит кучу небольших объектов и кучу больших объектов, и все кучи доступны из пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-130">Each heap contains a small object heap and a large object heap, and all heaps can be accessed by user code.</span></span> <span data-ttu-id="fa6bc-131">Объекты из различных куч могут ссылаться друг на друга.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-131">Objects on different heaps can refer to each other.</span></span>

- <span data-ttu-id="fa6bc-132">Так как несколько потоков сборки мусора работают совместно, для кучи одного и того же размера сборка мусора сервера выполняется быстрее сборки мусора рабочей станции.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-132">Because multiple garbage collection threads work together, server garbage collection is faster than workstation garbage collection on the same size heap.</span></span>

- <span data-ttu-id="fa6bc-133">В сборке мусора сервера часто используются сегменты большего размера.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-133">Server garbage collection often has larger size segments.</span></span> <span data-ttu-id="fa6bc-134">Однако это только обобщение: размер сегмента зависит от реализации и может изменяться.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-134">However, this is only a generalization: segment size is implementation-specific and is subject to change.</span></span> <span data-ttu-id="fa6bc-135">При настройке приложения не делайте предположений относительно размера сегментов, выделенных сборщиком мусора.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-135">Don't make assumptions about the size of segments allocated by the garbage collector when tuning your app.</span></span>

- <span data-ttu-id="fa6bc-136">Сборка мусора сервера может оказаться ресурсоемкой операцией.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-136">Server garbage collection can be resource-intensive.</span></span> <span data-ttu-id="fa6bc-137">Например, предположим, что на компьютере с 4 процессорами выполняются 12 процессов, использующих сборку мусора на сервере.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-137">For example, imagine that there are 12 processes that use server GC running on a computer that has four processors.</span></span> <span data-ttu-id="fa6bc-138">Если все процессы осуществляют сбор мусора одновременно, они мешают друг другу, так как на одном процессоре запланировано 12 потоков.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-138">If all the processes happen to collect garbage at the same time, they would interfere with each other, as there would be 12 threads scheduled on the same processor.</span></span> <span data-ttu-id="fa6bc-139">Если процессы активны, использовать серверную сборку мусора для всех них не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-139">If the processes are active, it's not a good idea to have them all use server GC.</span></span>

<span data-ttu-id="fa6bc-140">При запуске сотен экземпляров приложения рассмотрите возможность использования сборки мусора рабочей станции с отключенной параллельной сборкой мусора.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-140">If you're running hundreds of instances of an application, consider using workstation garbage collection with concurrent garbage collection disabled.</span></span> <span data-ttu-id="fa6bc-141">Это уменьшит число переключений контекста, что может повысить быстродействие.</span><span class="sxs-lookup"><span data-stu-id="fa6bc-141">This will result in less context switching, which can improve performance.</span></span>

## <a name="see-also"></a><span data-ttu-id="fa6bc-142">См. также</span><span class="sxs-lookup"><span data-stu-id="fa6bc-142">See also</span></span>

- [<span data-ttu-id="fa6bc-143">Фоновая сборка мусора</span><span class="sxs-lookup"><span data-stu-id="fa6bc-143">Background garbage collection</span></span>](background-gc.md)
- [<span data-ttu-id="fa6bc-144">Параметры конфигурации времени выполнения для сборки мусора</span><span class="sxs-lookup"><span data-stu-id="fa6bc-144">Run-time configuration options for garbage collection</span></span>](../../core/run-time-config/garbage-collector.md)
