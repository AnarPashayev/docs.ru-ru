---
title: Режимы задержки
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- garbage collection, intrusiveness
- garbage collection, latency modes
ms.assetid: 96278bb7-6eab-4612-8594-ceebfc887d81
ms.openlocfilehash: a8eaf0c80aa32978eead80c51a905cbcd66a537b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2020
ms.locfileid: "74283595"
---
# <a name="latency-modes"></a><span data-ttu-id="ea914-102">Режимы задержки</span><span class="sxs-lookup"><span data-stu-id="ea914-102">Latency modes</span></span>

<span data-ttu-id="ea914-103">Чтобы освободить объекты, сборщик мусора должен остановить все выполняющиеся потоки приложения.</span><span class="sxs-lookup"><span data-stu-id="ea914-103">To reclaim objects, the garbage collector (GC) must stop all the executing threads in an application.</span></span> <span data-ttu-id="ea914-104">Период, в течение которого активен сборщик мусора, называется *задержкой*.</span><span class="sxs-lookup"><span data-stu-id="ea914-104">The period of time during which the garbage collector is active is referred to as its *latency*.</span></span>

<span data-ttu-id="ea914-105">В некоторых ситуациях, например, когда приложение получает данные или отображает содержимое, полная сборка мусора может произойти в критическое время и снизить производительность.</span><span class="sxs-lookup"><span data-stu-id="ea914-105">In some situations, such as when an application retrieves data or displays content, a full garbage collection can occur at a critical time and impede performance.</span></span> <span data-ttu-id="ea914-106">Степень вмешательства сборщика мусора можно настроить, присвоив свойству <xref:System.Runtime.GCSettings.LatencyMode%2A?displayProperty=nameWithType> одно из значений <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ea914-106">You can adjust the intrusiveness of the garbage collector by setting the <xref:System.Runtime.GCSettings.LatencyMode%2A?displayProperty=nameWithType> property to one of the <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> values.</span></span>

## <a name="low-latency-settings"></a><span data-ttu-id="ea914-107">Параметры режима небольшой задержки</span><span class="sxs-lookup"><span data-stu-id="ea914-107">Low latency settings</span></span>

<span data-ttu-id="ea914-108">При использовании параметров режима небольшой задержки влияние сборщика мусора на работу приложения будет минимальным.</span><span class="sxs-lookup"><span data-stu-id="ea914-108">Using a "low" latency setting means the garbage collector intrudes less in your application.</span></span> <span data-ttu-id="ea914-109">В этом случае процесс сборки мусора будет более экономно расходовать ресурсы памяти.</span><span class="sxs-lookup"><span data-stu-id="ea914-109">Garbage collection is more conservative about reclaiming memory.</span></span>

<span data-ttu-id="ea914-110">Перечисление <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> предоставляет 2 параметра малого времени ожидания:</span><span class="sxs-lookup"><span data-stu-id="ea914-110">The <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> enumeration provides two low latency settings:</span></span>

- <span data-ttu-id="ea914-111">[GCLatencyMode.LowLatency](xref:System.Runtime.GCLatencyMode.LowLatency) отключает сборку мусора для объектов поколения 2 и выполняет только сборку мусора для объектов поколений 0 и 1.</span><span class="sxs-lookup"><span data-stu-id="ea914-111">[GCLatencyMode.LowLatency](xref:System.Runtime.GCLatencyMode.LowLatency) suppresses generation 2 collections and performs only generation 0 and 1 collections.</span></span> <span data-ttu-id="ea914-112">Его можно использовать только в течение коротких периодов времени.</span><span class="sxs-lookup"><span data-stu-id="ea914-112">It can be used only for short periods of time.</span></span> <span data-ttu-id="ea914-113">Если в системе за продолжительный период возникнет нехватка памяти, сборщик мусора начнет сборку, что приведет к кратковременной остановке приложения и прервет срочную задачу.</span><span class="sxs-lookup"><span data-stu-id="ea914-113">Over longer periods, if the system is under memory pressure, the garbage collector will trigger a collection, which can briefly pause the application and disrupt a time-critical operation.</span></span> <span data-ttu-id="ea914-114">Этот параметр доступен только для сборки мусора на рабочей станции.</span><span class="sxs-lookup"><span data-stu-id="ea914-114">This setting is available only for workstation garbage collection.</span></span>

- <span data-ttu-id="ea914-115">[GCLatencyMode.SustainedLowLatency](xref:System.Runtime.GCLatencyMode.SustainedLowLatency) отключает приоритетную сборку мусора для объектов поколения 2 и выполняет только сборку для объектов поколений 0 и 1, а также фоновую сборку для объектов поколения 2.</span><span class="sxs-lookup"><span data-stu-id="ea914-115">[GCLatencyMode.SustainedLowLatency](xref:System.Runtime.GCLatencyMode.SustainedLowLatency) suppresses foreground generation 2 collections and performs only generation 0, 1, and background generation 2 collections.</span></span> <span data-ttu-id="ea914-116">Его можно использовать дольше и он доступен для сборки мусора как на рабочей станции, так и на сервере.</span><span class="sxs-lookup"><span data-stu-id="ea914-116">It can be used for longer periods of time, and is available for both workstation and server garbage collection.</span></span> <span data-ttu-id="ea914-117">Этот параметр нельзя использовать, если фоновая сборка мусора отключена.</span><span class="sxs-lookup"><span data-stu-id="ea914-117">This setting cannot be used if background garbage collection is disabled.</span></span>

<span data-ttu-id="ea914-118">В периоды небольшого времени ожидания сборка мусора для объектов поколения 2 подавляется, пока не произойдет одно из следующего:</span><span class="sxs-lookup"><span data-stu-id="ea914-118">During low latency periods, generation 2 collections are suppressed unless the following occurs:</span></span>

- <span data-ttu-id="ea914-119">система получит уведомление о нехватке памяти от операционной системы;</span><span class="sxs-lookup"><span data-stu-id="ea914-119">The system receives a low memory notification from the operating system.</span></span>

- <span data-ttu-id="ea914-120">Код приложения запустит сборку мусора путем вызова метода <xref:System.GC.Collect%2A?displayProperty=nameWithType> и укажет значение 2 для параметра `generation`.</span><span class="sxs-lookup"><span data-stu-id="ea914-120">Application code induces a collection by calling the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method and specifying 2 for the `generation` parameter.</span></span>

## <a name="scenarios"></a><span data-ttu-id="ea914-121">Сценарии</span><span class="sxs-lookup"><span data-stu-id="ea914-121">Scenarios</span></span>

<span data-ttu-id="ea914-122">В следующей таблице перечислены сценарии работы приложений с использованием значений <xref:System.Runtime.GCLatencyMode>:</span><span class="sxs-lookup"><span data-stu-id="ea914-122">The following table lists the application scenarios for using the <xref:System.Runtime.GCLatencyMode> values:</span></span>

|<span data-ttu-id="ea914-123">Режим периода ожидания</span><span class="sxs-lookup"><span data-stu-id="ea914-123">Latency mode</span></span>|<span data-ttu-id="ea914-124">Сценарии приложения</span><span class="sxs-lookup"><span data-stu-id="ea914-124">Application scenarios</span></span>|
|------------------|---------------------------|
|<xref:System.Runtime.GCLatencyMode.Batch>|<span data-ttu-id="ea914-125">Для приложений, которые не имеют пользовательского интерфейса или операций на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="ea914-125">For applications that have no user interface (UI) or server-side operations.</span></span><br /><br /><span data-ttu-id="ea914-126">Если фоновая сборка мусора отключена, этот режим используется по умолчанию для сборки мусора рабочей станции или сервера.</span><span class="sxs-lookup"><span data-stu-id="ea914-126">When background garbage collection is disabled, this is the default mode for workstation and server garbage collection.</span></span> <span data-ttu-id="ea914-127">Режим <xref:System.Runtime.GCLatencyMode.Batch> также переопределяет значение параметра [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), то есть отключает фоновые или параллельные процессы сборки.</span><span class="sxs-lookup"><span data-stu-id="ea914-127"><xref:System.Runtime.GCLatencyMode.Batch> mode also overrides the [gcConcurrent](../../framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) setting, that is, it prevents background or concurrent collections.</span></span>|
|<xref:System.Runtime.GCLatencyMode.Interactive>|<span data-ttu-id="ea914-128">Для большинства приложений, имеющих пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="ea914-128">For most applications that have a UI.</span></span><br /><br /><span data-ttu-id="ea914-129">Это режим по умолчанию для сборки мусора рабочей станции и сервера.</span><span class="sxs-lookup"><span data-stu-id="ea914-129">This is the default mode for workstation and server garbage collection.</span></span> <span data-ttu-id="ea914-130">Тем не менее, в случае с размещенным приложением, приоритет будут иметь параметры сборки мусора, задаваемые в ведущем процессе.</span><span class="sxs-lookup"><span data-stu-id="ea914-130">However, if an app is hosted, the garbage collector settings of the hosting process take precedence.</span></span>|
|<xref:System.Runtime.GCLatencyMode.LowLatency>|<span data-ttu-id="ea914-131">Для приложений, которые осуществляют операции, чувствительные ко времени выполнения, для которых перерывы в работе из-за сборки мусора могут иметь резко отрицательные последствия.</span><span class="sxs-lookup"><span data-stu-id="ea914-131">For applications that have short-term, time-sensitive operations during which interruptions from the garbage collector could be disruptive.</span></span> <span data-ttu-id="ea914-132">Например, это приложения, которые выполняют визуализацию анимации или получение данных.</span><span class="sxs-lookup"><span data-stu-id="ea914-132">For example, applications that render animations or data acquisition functions.</span></span>|
|<xref:System.Runtime.GCLatencyMode.SustainedLowLatency>|<span data-ttu-id="ea914-133">Для приложений, которые осуществляют операции, чувствительные ко времени выполнения, время выполнения которых ограничено, но может быть достаточно продолжительным, для которых перерывы в работе из-за сборки мусора могут иметь резко отрицательные последствия.</span><span class="sxs-lookup"><span data-stu-id="ea914-133">For applications that have time-sensitive operations for a contained but potentially longer duration of time during which interruptions from the garbage collector could be disruptive.</span></span> <span data-ttu-id="ea914-134">Например, приложения, требующие быстрого отклика при изменении рыночных показателей в торговую сессию.</span><span class="sxs-lookup"><span data-stu-id="ea914-134">For example, applications that need quick response times as market data changes during trading hours.</span></span><br /><br /><span data-ttu-id="ea914-135">Этот режим использует больший размер управляемой кучи, нежели другие режимы.</span><span class="sxs-lookup"><span data-stu-id="ea914-135">This mode results in a larger managed heap size than other modes.</span></span> <span data-ttu-id="ea914-136">Так как он не сжимает управляемую кучу, возможен больший уровень фрагментации.</span><span class="sxs-lookup"><span data-stu-id="ea914-136">Because it does not compact the managed heap, higher fragmentation is possible.</span></span> <span data-ttu-id="ea914-137">Необходимо обеспечить достаточный объем памяти.</span><span class="sxs-lookup"><span data-stu-id="ea914-137">Ensure that sufficient memory is available.</span></span>|

## <a name="guidelines-for-using-low-latency"></a><span data-ttu-id="ea914-138">Рекомендации по использованию режима небольшой задержки</span><span class="sxs-lookup"><span data-stu-id="ea914-138">Guidelines for using low latency</span></span>

<span data-ttu-id="ea914-139">При использовании режима [GCLatencyMode.LowLatency](xref:System.Runtime.GCLatencyMode.LowLatency) придерживайтесь следующих рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="ea914-139">When you use [GCLatencyMode.LowLatency](xref:System.Runtime.GCLatencyMode.LowLatency) mode, consider the following guidelines:</span></span>

- <span data-ttu-id="ea914-140">Продолжительность периодов небольшого времени ожидания должна быть как можно более короткой.</span><span class="sxs-lookup"><span data-stu-id="ea914-140">Keep the period of time in low latency as short as possible.</span></span>

- <span data-ttu-id="ea914-141">Избегайте выделения больших объемов памяти в периоды небольшого времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="ea914-141">Avoid allocating high amounts of memory during low latency periods.</span></span> <span data-ttu-id="ea914-142">Могут возникать уведомления о нехватке памяти, потому что сборщик мусора освобождает меньше объектов.</span><span class="sxs-lookup"><span data-stu-id="ea914-142">Low memory notifications can occur because garbage collection reclaims fewer objects.</span></span>

- <span data-ttu-id="ea914-143">В режиме небольшой задержки необходимо свести к минимуму число выделений, в частности выделений в куче для больших объектов и закрепленных объектов.</span><span class="sxs-lookup"><span data-stu-id="ea914-143">While in the low latency mode, minimize the number of new allocations, in particular allocations onto the large object heap and pinned objects.</span></span>

- <span data-ttu-id="ea914-144">Не забывайте про потоки, которые могут выделять память.</span><span class="sxs-lookup"><span data-stu-id="ea914-144">Be aware of threads that could be allocating.</span></span> <span data-ttu-id="ea914-145">Поскольку свойство <xref:System.Runtime.GCSettings.LatencyMode%2A> относится ко всему процессу, исключения <xref:System.OutOfMemoryException> можно создать в любом потоке, выделяющем память.</span><span class="sxs-lookup"><span data-stu-id="ea914-145">Because the <xref:System.Runtime.GCSettings.LatencyMode%2A> property setting is process-wide, <xref:System.OutOfMemoryException> exceptions can be generated on any thread that is allocating.</span></span>

- <span data-ttu-id="ea914-146">Заключите код режима небольшой задержки в области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="ea914-146">Wrap the low latency code in constrained execution regions.</span></span> <span data-ttu-id="ea914-147">Дополнительные сведения см. в статье [Области ограниченного выполнения](../../../docs/framework/performance/constrained-execution-regions.md).</span><span class="sxs-lookup"><span data-stu-id="ea914-147">For more information, see [Constrained execution regions](../../../docs/framework/performance/constrained-execution-regions.md).</span></span>

- <span data-ttu-id="ea914-148">Можно принудительно запускать освобождение объектов поколения 2 в периоды небольшого времени ожидания путем вызова метода <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ea914-148">You can force generation 2 collections during a low latency period by calling the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%29?displayProperty=nameWithType> method.</span></span>

## <a name="see-also"></a><span data-ttu-id="ea914-149">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="ea914-149">See also</span></span>

- <xref:System.GC?displayProperty=nameWithType>
- [<span data-ttu-id="ea914-150">Индуцированные коллекции</span><span class="sxs-lookup"><span data-stu-id="ea914-150">Induced Collections</span></span>](../../../docs/standard/garbage-collection/induced.md)
- [<span data-ttu-id="ea914-151">Сборка мусора</span><span class="sxs-lookup"><span data-stu-id="ea914-151">Garbage Collection</span></span>](../../../docs/standard/garbage-collection/index.md)
