---
title: Индуцированные коллекции
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- garbage collection, forced
ms.assetid: 019008fe-4708-4e65-bebf-04fd9941e149
ms.openlocfilehash: 36dff45587c6c28ba17fd7389dc3863893ff8f61
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/02/2020
ms.locfileid: "84286045"
---
# <a name="induced-collections"></a><span data-ttu-id="d5193-102">Индуцированные коллекции</span><span class="sxs-lookup"><span data-stu-id="d5193-102">Induced Collections</span></span>
<span data-ttu-id="d5193-103">В большинстве случаев сборщик мусора может определить самое подходящее время для выполнения сборки мусора, поэтому следует дать ему возможность работать независимо.</span><span class="sxs-lookup"><span data-stu-id="d5193-103">In most cases, the garbage collector can determine the best time to perform a collection, and you should let it run independently.</span></span> <span data-ttu-id="d5193-104">В очень редких случаях принудительная сборка мусора может улучшить производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="d5193-104">There are rare situations when a forced collection might improve your application's performance.</span></span> <span data-ttu-id="d5193-105">В этих случаях вы можете принудительно запустить сборку мусора с помощью метода <xref:System.GC.Collect%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d5193-105">In these cases, you can induce garbage collection by using the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method to force a garbage collection.</span></span>  
  
 <span data-ttu-id="d5193-106">Используйте метод <xref:System.GC.Collect%2A?displayProperty=nameWithType>, если обнаружите заметное уменьшение объема доступной памяти в определенной точке кода приложения.</span><span class="sxs-lookup"><span data-stu-id="d5193-106">Use the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method when there is a significant reduction in the amount of memory being used at a specific point in your application's code.</span></span> <span data-ttu-id="d5193-107">Например, если приложение использует сложное диалоговое окно с несколькими элементами управления, вызов <xref:System.GC.Collect%2A> при закрытом диалоговом окне может повысить производительность, немедленно очищая память, выделенную для этого окна.</span><span class="sxs-lookup"><span data-stu-id="d5193-107">For example, if your application uses a complex dialog box that has several controls, calling <xref:System.GC.Collect%2A> when the dialog box is closed could improve performance by immediately reclaiming the memory used by the dialog box.</span></span> <span data-ttu-id="d5193-108">Убедитесь, что приложение не запускает сборку мусора слишком часто, потому что это может уменьшить производительность, если сборщик мусора непродуктивно пытается удалить объекты в не самое удачное время.</span><span class="sxs-lookup"><span data-stu-id="d5193-108">Be sure that your application is not inducing garbage collection too frequently, because that can decrease performance if the garbage collector is trying to reclaim objects at non-optimal times.</span></span> <span data-ttu-id="d5193-109">Можно передать значение перечисления <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> в метод <xref:System.GC.Collect%2A>, чтобы осуществлять сбор только в случае его эффективности, как описано в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="d5193-109">You can supply a <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> enumeration value to the <xref:System.GC.Collect%2A> method to collect only when collection would be productive, as discussed in the next section.</span></span>  
  
## <a name="gc-collection-mode"></a><span data-ttu-id="d5193-110">Режим сборки мусора</span><span class="sxs-lookup"><span data-stu-id="d5193-110">GC collection mode</span></span>  
 <span data-ttu-id="d5193-111">Можно использовать одну из перегрузок метода <xref:System.GC.Collect%2A?displayProperty=nameWithType>, которая включает значение <xref:System.GCCollectionMode>, чтобы определить поведение принудительной сборки, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="d5193-111">You can use one of the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method overloads that includes a <xref:System.GCCollectionMode> value to specify the behavior for a forced collection as follows.</span></span>  
  
|<span data-ttu-id="d5193-112">Значение `GCCollectionMode`</span><span class="sxs-lookup"><span data-stu-id="d5193-112">`GCCollectionMode` value</span></span>|<span data-ttu-id="d5193-113">Описание:</span><span class="sxs-lookup"><span data-stu-id="d5193-113">Description</span></span>|  
|------------------------------|-----------------|  
|<xref:System.GCCollectionMode.Default>|<span data-ttu-id="d5193-114">Использует настройку сборки мусора по умолчанию для текущей версии .NET.</span><span class="sxs-lookup"><span data-stu-id="d5193-114">Uses the default garbage collection setting for the running version of .NET.</span></span>|  
|<xref:System.GCCollectionMode.Forced>|<span data-ttu-id="d5193-115">Вызывает немедленное выполнение принудительной сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="d5193-115">Forces garbage collection to occur immediately.</span></span> <span data-ttu-id="d5193-116">Это эквивалентно вызову перегрузки метода <xref:System.GC.Collect?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d5193-116">This is equivalent to calling the <xref:System.GC.Collect?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="d5193-117">В результате образуется коллекция полной блокировки всех поколений.</span><span class="sxs-lookup"><span data-stu-id="d5193-117">It results in a full blocking collection of all generations.</span></span><br /><br /> <span data-ttu-id="d5193-118">Можно также сжать кучу больших объектов, установив для свойства <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> значение <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> перед запуском немедленной сборки мусора с полной блокировкой.</span><span class="sxs-lookup"><span data-stu-id="d5193-118">You can also compact the large object heap by setting the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> before forcing an immediate full blocking garbage collection.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="d5193-119">Позволяет сборщику мусора определить, является ли текущий момент оптимальным для освобождения объектов.</span><span class="sxs-lookup"><span data-stu-id="d5193-119">Enables the garbage collector to determine whether the current time is optimal to reclaim objects.</span></span><br /><br /> <span data-ttu-id="d5193-120">Сборщик мусора может определить, что сборка мусора будет недостаточно продуктивна, в этом случае он возвратится без удаления объектов.</span><span class="sxs-lookup"><span data-stu-id="d5193-120">The garbage collector could determine that a collection would not be productive enough to be justified, in which case it will return without reclaiming objects.</span></span>|  
  
## <a name="background-or-blocking-collections"></a><span data-ttu-id="d5193-121">Фоновые или блокирующие сборки</span><span class="sxs-lookup"><span data-stu-id="d5193-121">Background or blocking collections</span></span>  
 <span data-ttu-id="d5193-122">Вы можете вызвать перегрузку метода <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType>, чтобы указать, является ли принудительная сборка блокирующей.</span><span class="sxs-lookup"><span data-stu-id="d5193-122">You can call the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> method overload to specify whether an induced collection is blocking or not.</span></span> <span data-ttu-id="d5193-123">Тип выполняемой сборки зависит от сочетания значений, установленных для параметров `mode` и `blocking`.</span><span class="sxs-lookup"><span data-stu-id="d5193-123">The type of collection performed depends on a combination of the method's `mode` and `blocking` parameters.</span></span> <span data-ttu-id="d5193-124">`mode` является элементом перечисления <xref:System.GCCollectionMode>, а `blocking` — это значение <xref:System.Boolean>.</span><span class="sxs-lookup"><span data-stu-id="d5193-124">`mode` is a member of the <xref:System.GCCollectionMode> enumeration, and `blocking` is a <xref:System.Boolean> value.</span></span> <span data-ttu-id="d5193-125">В следующей таблице описаны разные сочетания аргументов `mode` и `blocking`.</span><span class="sxs-lookup"><span data-stu-id="d5193-125">The following table summarizes the interaction of the `mode` and `blocking` arguments.</span></span>  
  
|`mode`|`blocking` = `true`|`blocking` = `false`|  
|------------|--------------------------|---------------------------|  
|<span data-ttu-id="d5193-126"><xref:System.GCCollectionMode.Forced> или <xref:System.GCCollectionMode.Default></span><span class="sxs-lookup"><span data-stu-id="d5193-126"><xref:System.GCCollectionMode.Forced> or <xref:System.GCCollectionMode.Default></span></span>|<span data-ttu-id="d5193-127">Блокирующий сбор выполнится, как только это станет возможным.</span><span class="sxs-lookup"><span data-stu-id="d5193-127">A blocking collection is performed as soon as possible.</span></span> <span data-ttu-id="d5193-128">Если в это время выполняется фоновая сборка и параметр поколения имеет значение 0 или 1, метод <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> немедленно запускает блокирующую сборку и возвращает управление по ее завершении.</span><span class="sxs-lookup"><span data-stu-id="d5193-128">If a background collection is in progress and generation is 0 or 1, the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method immediately triggers a blocking collection and returns when the collection is finished.</span></span> <span data-ttu-id="d5193-129">Если выполняется фоновая сборка и параметр `generation` имеет значение 2, метод дожидается завершения фоновой сборки, активирует блокирующую сборку поколения 2 и возвращает управление.</span><span class="sxs-lookup"><span data-stu-id="d5193-129">If a background collection is in progress and the `generation` parameter is 2, the method waits until the background collection is finished, triggers a blocking generation 2 collection, and then returns.</span></span>|<span data-ttu-id="d5193-130">Сборка выполнится, как только это станет возможным.</span><span class="sxs-lookup"><span data-stu-id="d5193-130">A collection is performed as soon as possible.</span></span> <span data-ttu-id="d5193-131">Метод <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> запрашивает фоновую сборку, но не гарантирует этот режим. В зависимости от обстоятельств может выполняться блокирующая сборка.</span><span class="sxs-lookup"><span data-stu-id="d5193-131">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="d5193-132">Если фоновая сборка уже выполняется, метод возвращает управление немедленно.</span><span class="sxs-lookup"><span data-stu-id="d5193-132">If a background collection is already in progress, the method returns immediately.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="d5193-133">В зависимости от текущего состояния сборщика мусора и значения параметра `generation` может выполняться блокирующая сборка.</span><span class="sxs-lookup"><span data-stu-id="d5193-133">A blocking collection may be performed, depending on the state of the garbage collector and the `generation` parameter.</span></span> <span data-ttu-id="d5193-134">Сборщик мусора пытается обеспечить оптимальную производительность.</span><span class="sxs-lookup"><span data-stu-id="d5193-134">The garbage collector tries to provide optimal performance.</span></span>|<span data-ttu-id="d5193-135">Сборка может быть выполнена в зависимости от состояния сборщика мусора.</span><span class="sxs-lookup"><span data-stu-id="d5193-135">A collection may be performed, depending on the state of the garbage collector.</span></span> <span data-ttu-id="d5193-136">Метод <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> запрашивает фоновую сборку, но не гарантирует этот режим. В зависимости от обстоятельств может выполняться блокирующая сборка.</span><span class="sxs-lookup"><span data-stu-id="d5193-136">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="d5193-137">Сборщик мусора пытается обеспечить оптимальную производительность.</span><span class="sxs-lookup"><span data-stu-id="d5193-137">The garbage collector tries to provide optimal performance.</span></span> <span data-ttu-id="d5193-138">Если фоновая сборка уже выполняется, метод возвращает управление немедленно.</span><span class="sxs-lookup"><span data-stu-id="d5193-138">If a background collection is already in progress, the method returns immediately.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="d5193-139">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="d5193-139">See also</span></span>

- [<span data-ttu-id="d5193-140">Режимы задержки</span><span class="sxs-lookup"><span data-stu-id="d5193-140">Latency Modes</span></span>](latency.md)
- [<span data-ttu-id="d5193-141">Сборка мусора</span><span class="sxs-lookup"><span data-stu-id="d5193-141">Garbage Collection</span></span>](index.md)
