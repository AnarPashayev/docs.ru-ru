---
title: Анализатор переносимости .NET
description: Сведения о том, как применять анализатор переносимости .NET для оценки переносимости кода в разных реализациях .NET, включая .NET Core, .NET Standard, UWP и Xamarin.
ms.date: 09/13/2019
ms.technology: dotnet-standard
ms.assetid: 0375250f-5704-4993-a6d5-e21c499cea1e
ms.openlocfilehash: d8b5fcf8b6c3230e41585261de747edb9105aa31
ms.sourcegitcommit: 9c45035b781caebc63ec8ecf912dc83fb6723b1f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88811812"
---
# <a name="the-net-portability-analyzer"></a><span data-ttu-id="669ad-103">Анализатор переносимости .NET</span><span class="sxs-lookup"><span data-stu-id="669ad-103">The .NET Portability Analyzer</span></span>

<span data-ttu-id="669ad-104">Хотите, чтобы ваши библиотеки поддерживали несколько платформ?</span><span class="sxs-lookup"><span data-stu-id="669ad-104">Want to make your libraries support multi-platform?</span></span> <span data-ttu-id="669ad-105">Хотите узнать, какой объем работ требуется проделать, чтобы ваше приложение .NET Framework работало в .NET Core?</span><span class="sxs-lookup"><span data-stu-id="669ad-105">Want to see how much work is required to make your .NET Framework application run on .NET Core?</span></span> <span data-ttu-id="669ad-106">[Анализатор переносимости .NET](https://github.com/microsoft/dotnet-apiport) — это средство, которое анализирует сборки и предоставляет подробный отчет об отсутствующих API-интерфейсах .NET для приложений или библиотек, которые переносятся на заданные целевые платформы .NET.</span><span class="sxs-lookup"><span data-stu-id="669ad-106">The [.NET Portability Analyzer](https://github.com/microsoft/dotnet-apiport) is a tool that analyzes assemblies and provides a detailed report on .NET APIs that are missing for the applications or libraries to be portable on your specified targeted .NET platforms.</span></span> <span data-ttu-id="669ad-107">Анализатор переносимости предлагается как [расширение Visual Studio](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer), которое анализирует одну сборку на проект, и как [консольное приложение ApiPort](https://aka.ms/apiportdownload), которое анализирует сборки по указанным файлам или каталогам.</span><span class="sxs-lookup"><span data-stu-id="669ad-107">The Portability Analyzer is offered as a [Visual Studio Extension](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer), which analyzes one assembly per project, and as a [ApiPort console app](https://aka.ms/apiportdownload), which analyzes assemblies by specified files or directory.</span></span>

<span data-ttu-id="669ad-108">После преобразования проекта для новой целевой платформы, например .NET Core, вы можете использовать [анализатор API](api-analyzer.md) на основе Roslyn для определения API, вызывающих исключение <xref:System.PlatformNotSupportedException>, и других проблем совместимости.</span><span class="sxs-lookup"><span data-stu-id="669ad-108">Once you've converted your project to target the new platform, like .NET Core, you can use the Roslyn-based [API Analyzer tool](api-analyzer.md) to identify APIs throwing <xref:System.PlatformNotSupportedException> exceptions and other compatibility issues.</span></span>

## <a name="common-targets"></a><span data-ttu-id="669ad-109">Стандартные целевые платформы</span><span class="sxs-lookup"><span data-stu-id="669ad-109">Common targets</span></span>

- <span data-ttu-id="669ad-110">[.NET Core](../../core/index.yml). Имеет модульную архитектуру, поддерживает сценарии параллельной установки и использование с разными платформами.</span><span class="sxs-lookup"><span data-stu-id="669ad-110">[.NET Core](../../core/index.yml): Has a modular design, supports side-by-side installation, and targets cross-platform scenarios.</span></span> <span data-ttu-id="669ad-111">Параллельная установка позволяет внедрять новые версии .NET Core, не влияя на работоспособность других приложений.</span><span class="sxs-lookup"><span data-stu-id="669ad-111">Side-by-side installation allows you to adopt new .NET Core versions without breaking other apps.</span></span> <span data-ttu-id="669ad-112">Если ваша цель — перенос веб-приложения в .NET Core для обеспечения поддержки нескольких платформ, это рекомендуемый целевой объект.</span><span class="sxs-lookup"><span data-stu-id="669ad-112">If your goal is to port your app to .NET Core and support multiple platforms, this is the recommended target.</span></span>
- <span data-ttu-id="669ad-113">.[NET Standard](../net-standard.md): включает API .NET Standard, доступный во всех реализациях .NET.</span><span class="sxs-lookup"><span data-stu-id="669ad-113">.[NET Standard](../net-standard.md): Includes the .NET Standard APIs available on all .NET implementations.</span></span> <span data-ttu-id="669ad-114">Если ваша цель — выполнение библиотеки на всех поддерживаемых платформах .NET, это рекомендуемый целевой объект.</span><span class="sxs-lookup"><span data-stu-id="669ad-114">If your goal is to make your library run on all .NET supported platforms, this is recommended target.</span></span>
- <span data-ttu-id="669ad-115">[ASP.NET Core](/aspnet/core): современная веб платформа, созданная на .NET Core.</span><span class="sxs-lookup"><span data-stu-id="669ad-115">[ASP.NET Core](/aspnet/core): A modern web-framework built on .NET Core.</span></span> <span data-ttu-id="669ad-116">Если вашей целью является перенос веб-приложения на .NET Core для поддержки нескольких платформ, это рекомендуемый целевой объект.</span><span class="sxs-lookup"><span data-stu-id="669ad-116">If your goal is to port your web app to .NET Core to support multiple platforms, this is the recommended target.</span></span>
- <span data-ttu-id="669ad-117">Платформа .NET Core и [ее расширения](../../core/porting/windows-compat-pack.md): включает в себя API .NET Core, а также пакет обеспечения совместимости Windows, который предоставляет множество доступных технологий .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="669ad-117">.NET Core + [Platform Extensions](../../core/porting/windows-compat-pack.md): Includes the .NET Core APIs in addition to the Windows Compatibility Pack, which provides many of the .NET Framework available technologies.</span></span> <span data-ttu-id="669ad-118">Это рекомендуемый целевой объект для переноса приложения из .NET Framework на .NET Core в Windows.</span><span class="sxs-lookup"><span data-stu-id="669ad-118">This is a recommended target for porting your app from .NET Framework to .NET Core on Windows.</span></span>
- <span data-ttu-id="669ad-119">Платформа .NET Standard и [ее расширения](../../core/porting/windows-compat-pack.md): включает в себя API .NET Standard, а также пакет обеспечения совместимости Windows, который предоставляет множество доступных технологий .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="669ad-119">.NET Standard + [Platform Extensions](../../core/porting/windows-compat-pack.md): Includes the .NET Standard APIs in addition to the Windows Compatibility Pack, which provides many of the .NET Framework available technologies.</span></span> <span data-ttu-id="669ad-120">Это рекомендуемый целевой объект для переноса библиотеки из .NET Framework на .NET Core в Windows.</span><span class="sxs-lookup"><span data-stu-id="669ad-120">This is a recommended target for porting your library from .NET Framework to .NET Core on Windows.</span></span>

## <a name="how-to-use-the-net-portability-analyzer"></a><span data-ttu-id="669ad-121">Как использовать анализатор переносимости .NET</span><span class="sxs-lookup"><span data-stu-id="669ad-121">How to use the .NET Portability Analyzer</span></span>

<span data-ttu-id="669ad-122">Чтобы начать пользоваться анализатором переносимости .NET в Visual Studio, скачайте и установите расширение из [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer).</span><span class="sxs-lookup"><span data-stu-id="669ad-122">To begin using the .NET Portability Analyzer in Visual Studio, you first need to download and install the extension from the [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer).</span></span> <span data-ttu-id="669ad-123">Оно работает в Visual Studio 2017 и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="669ad-123">It works on Visual Studio 2017 and later versions.</span></span> <span data-ttu-id="669ad-124">Настройте его в Visual Studio, выбрав **Анализ** > **Параметры анализатора переносимости** и указав целевые платформы, являющиеся платформами или версиями .NET, для которых вы хотите оценить пропуски в переносимости по сравнению с платформой или версией, на которой собрана ваша текущая сборка.</span><span class="sxs-lookup"><span data-stu-id="669ad-124">Configure it in Visual Studio via **Analyze** > **Portability Analyzer Settings** and select your Target Platforms, which are the .NET platforms/versions that you want to evaluate the portability gaps comparing with the platform/version that your current assembly is built with.</span></span>

![Снимок экрана: анализатор переносимости](./media/portability-analyzer/portability-screenshot.png)

<span data-ttu-id="669ad-126">Можно также использовать консольное приложение ApiPort, загрузив его из [репозитория ApiPort](https://aka.ms/apiportdownload).</span><span class="sxs-lookup"><span data-stu-id="669ad-126">You can also use the ApiPort console application, download it from [ApiPort repository](https://aka.ms/apiportdownload).</span></span> <span data-ttu-id="669ad-127">Можно использовать параметр команды `listTargets`, чтобы отобразить список доступных целевых платформ, а затем выбрать целевые платформы, указав параметр команды `-t` или `--target`.</span><span class="sxs-lookup"><span data-stu-id="669ad-127">You can use `listTargets` command option to display the available target list, then pick target platforms by specifying `-t` or `--target` command option.</span></span>

### <a name="solution-wide-view"></a><span data-ttu-id="669ad-128">Представление, охватывающее все решение</span><span class="sxs-lookup"><span data-stu-id="669ad-128">Solution wide view</span></span>

<span data-ttu-id="669ad-129">Полезным шагом при анализе решения с множеством проектов стала бы визуализация зависимостей, позволяющая понять, от чего именно зависит каждое такое подмножество сборок.</span><span class="sxs-lookup"><span data-stu-id="669ad-129">A useful step in analyzing a solution with many projects would be to visualize the dependencies to understand which subset of assemblies depend on what.</span></span> <span data-ttu-id="669ad-130">Общая рекомендация заключается в применении результатов анализа по принципу "снизу вверх", начиная с листовых узлов в графе зависимостей.</span><span class="sxs-lookup"><span data-stu-id="669ad-130">The general recommendation is to apply the results of the analysis in a bottom-up approach starting with the leaf nodes in a dependency graph.</span></span>

<span data-ttu-id="669ad-131">Чтобы получить эти сведения, можно выполнить следующую команду.</span><span class="sxs-lookup"><span data-stu-id="669ad-131">To retrieve this, you may run the following command:</span></span>

```console
ApiPort.exe analyze -r DGML -f [directory or file]
```

<span data-ttu-id="669ad-132">При открытии в Visual Studio результат будет выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="669ad-132">A result of this would look like the following when opened in Visual Studio:</span></span>

![Снимок экрана: анализ DGML](./media/portability-analyzer/dgml-example.png)

### <a name="analyze-portability"></a><span data-ttu-id="669ad-134">Анализ переносимости</span><span class="sxs-lookup"><span data-stu-id="669ad-134">Analyze portability</span></span>
<span data-ttu-id="669ad-135">Чтобы проанализировать весь проект в Visual Studio, щелкните его правой кнопкой мыши в **обозревателе решений** и выберите пункт **Анализировать переносимость сборки**.</span><span class="sxs-lookup"><span data-stu-id="669ad-135">To analyze your entire project in Visual Studio, right-click on your project in **Solution Explorer** and select **Analyze Assembly Portability**.</span></span> <span data-ttu-id="669ad-136">Или в меню **Анализ** выберите **Анализировать переносимость сборки**.</span><span class="sxs-lookup"><span data-stu-id="669ad-136">Otherwise, go to the **Analyze** menu and select **Analyze Assembly Portability**.</span></span> <span data-ttu-id="669ad-137">После этого выберите исполняемый файл или DLL-файл проекта.</span><span class="sxs-lookup"><span data-stu-id="669ad-137">From there, select your project's executable or DLL.</span></span>

![Снимок экрана: анализатор переносимости из обозревателя решений](./media/portability-analyzer/portability-solution-explorer.png)

<span data-ttu-id="669ad-139">Можно также использовать [консольное приложение ApiPort](https://aka.ms/apiportdownload).</span><span class="sxs-lookup"><span data-stu-id="669ad-139">You can also use the [ApiPort console app](https://aka.ms/apiportdownload).</span></span>

- <span data-ttu-id="669ad-140">Для анализа текущего каталога выполните следующую команду: `ApiPort.exe analyze -f .`.</span><span class="sxs-lookup"><span data-stu-id="669ad-140">Type the following command to analyze the current directory: `ApiPort.exe analyze -f .`</span></span>
- <span data-ttu-id="669ad-141">Для анализа заданного списка DLL-файлов выполните следующую команду: `ApiPort.exe analyze -f first.dll -f second.dll -f third.dll`.</span><span class="sxs-lookup"><span data-stu-id="669ad-141">To analyze a specific list of .dll files, type the following command: `ApiPort.exe analyze -f first.dll -f second.dll -f third.dll`</span></span>
- <span data-ttu-id="669ad-142">Выполните `ApiPort.exe -?`, чтобы получить дополнительную помощь</span><span class="sxs-lookup"><span data-stu-id="669ad-142">Run `ApiPort.exe -?` to get more help</span></span>

<span data-ttu-id="669ad-143">Рекомендуется включать все связанные файлы EXE и DLL, которые у вас есть и которые вы хотите перенести, а также исключить файлы, от которых зависит приложение, но у вас их нет и вы не хотите их переносить.</span><span class="sxs-lookup"><span data-stu-id="669ad-143">It is recommended that you include all the related exe and dll files that you own and want to port, and exclude the files that your app depends on, but you don't own and can't port.</span></span> <span data-ttu-id="669ad-144">Это позволит получить наиболее актуальный отчет о переносимости.</span><span class="sxs-lookup"><span data-stu-id="669ad-144">This will give you most relevant portability report.</span></span>

### <a name="view-and-interpret-portability-result"></a><span data-ttu-id="669ad-145">Просмотр и интерпретация результатов переносимости</span><span class="sxs-lookup"><span data-stu-id="669ad-145">View and interpret portability result</span></span>

<span data-ttu-id="669ad-146">В отчете отображаются только интерфейсы API, которые не поддерживаются целевой платформой.</span><span class="sxs-lookup"><span data-stu-id="669ad-146">Only APIs that are unsupported by a Target Platform appear in the report.</span></span>
<span data-ttu-id="669ad-147">После выполнения анализа в Visual Studio вы увидите ссылку на файл отчета о переносимости .NET.</span><span class="sxs-lookup"><span data-stu-id="669ad-147">After running the analysis in Visual Studio, you'll see your .NET Portability report file link pops up.</span></span> <span data-ttu-id="669ad-148">Если вы использовали [консольное приложение ApiPort](https://aka.ms/apiportdownload), ваш отчет о переносимости .NET сохраняется как файл в формате, который вы указали.</span><span class="sxs-lookup"><span data-stu-id="669ad-148">If you used the [ApiPort console app](https://aka.ms/apiportdownload), your .NET Portability report is saved as a file in the format you specified.</span></span> <span data-ttu-id="669ad-149">По умолчанию используется файл Excel ( *.xlsx*) в текущем каталоге.</span><span class="sxs-lookup"><span data-stu-id="669ad-149">The default is in an Excel file (*.xlsx*) in your current directory.</span></span>

#### <a name="portability-summary"></a><span data-ttu-id="669ad-150">Сводка переносимости</span><span class="sxs-lookup"><span data-stu-id="669ad-150">Portability Summary</span></span>

![Снимок экрана: сводка по переносимости](./media/portability-analyzer/api-catalog-portablility-summary.png)

<span data-ttu-id="669ad-152">В разделе со сводкой по переносимости в этом отчете показан процент переносимости для каждой сборки, включенной в анализ.</span><span class="sxs-lookup"><span data-stu-id="669ad-152">The Portability Summary section of the report shows the portability percentage for each assembly included in the run.</span></span> <span data-ttu-id="669ad-153">В предыдущем примере 71,24 % API-интерфейсов .NET Framework, используемых в приложении `svcutil`, доступны в .NET Core и расширениях платформы.</span><span class="sxs-lookup"><span data-stu-id="669ad-153">In the previous example, 71.24% of the .NET Framework APIs used in the `svcutil` app are available in .NET Core + Platform Extensions.</span></span> <span data-ttu-id="669ad-154">Если запустить анализатор переносимости .NET для нескольких сборок, каждая сборка должна иметь строку в сводном отчете о переносимости.</span><span class="sxs-lookup"><span data-stu-id="669ad-154">If you run the .NET Portability Analyzer tool against multiple assemblies, each assembly should have a row in the Portability Summary report.</span></span>

#### <a name="details"></a><span data-ttu-id="669ad-155">Подробнее</span><span class="sxs-lookup"><span data-stu-id="669ad-155">Details</span></span>

![Снимок экрана: сведения о переносимости](./media/portability-analyzer/api-catalog-portablility-details.png)

<span data-ttu-id="669ad-157">В разделе **Details** (Подробные сведения) в отчете указываются API, отсутствующие на любой из выбранных **целевых платформ**.</span><span class="sxs-lookup"><span data-stu-id="669ad-157">The **Details** section of the report lists the APIs missing from any of the selected **Targeted Platforms**.</span></span>

- <span data-ttu-id="669ad-158">Тип целевого объекта: в типе есть API, отсутствующие на целевой платформе.</span><span class="sxs-lookup"><span data-stu-id="669ad-158">Target type: the type has missing API from a Target Platform</span></span>
- <span data-ttu-id="669ad-159">Член целевого объекта: метод отсутствует на целевой платформе.</span><span class="sxs-lookup"><span data-stu-id="669ad-159">Target member: the method is missing from a Target Platform</span></span>
- <span data-ttu-id="669ad-160">Имя сборки: сборка .NET Framework, в которой находится отсутствующий API.</span><span class="sxs-lookup"><span data-stu-id="669ad-160">Assembly name: the .NET Framework assembly that the missing API lives in.</span></span>
- <span data-ttu-id="669ad-161">Каждая из выбранных целевых платформ представлена одним столбцом, например ".NET Core": значение "Не поддерживается" означает, что API не поддерживается на этой целевой платформе.</span><span class="sxs-lookup"><span data-stu-id="669ad-161">Each of the selected Target Platforms is one column, such as ".NET Core": "Not supported" value means the API is not supported on this Target Platform.</span></span>
- <span data-ttu-id="669ad-162">Рекомендованные изменения: рекомендованный API или технология для замены.</span><span class="sxs-lookup"><span data-stu-id="669ad-162">Recommended Changes: the recommended API or technology to change to.</span></span> <span data-ttu-id="669ad-163">В настоящее время это поле является пустым или устарело для многих интерфейсов API.</span><span class="sxs-lookup"><span data-stu-id="669ad-163">Currently, this field is empty or out of date for many APIs.</span></span> <span data-ttu-id="669ad-164">Ввиду большого количества API нам сложно поддерживать актуальность.</span><span class="sxs-lookup"><span data-stu-id="669ad-164">Due to the large number of APIs, we have a significant challenge to keep it up to date.</span></span> <span data-ttu-id="669ad-165">Мы рассматриваем альтернативные решения, чтобы предоставлять клиентам полезные сведения.</span><span class="sxs-lookup"><span data-stu-id="669ad-165">We're looking at alternative solutions to provide helpful information to customers.</span></span>

#### <a name="missing-assemblies"></a><span data-ttu-id="669ad-166">Отсутствующие сборки</span><span class="sxs-lookup"><span data-stu-id="669ad-166">Missing Assemblies</span></span>

![Снимок экрана: отсутствующие сборки](./media/portability-analyzer/api-catalog-missing-assemblies.png)

<span data-ttu-id="669ad-168">В отчете есть раздел "Отсутствующие сборки".</span><span class="sxs-lookup"><span data-stu-id="669ad-168">You may find a Missing Assemblies section in your report.</span></span> <span data-ttu-id="669ad-169">В данном разделе приводится список сборок, на которые ссылаются проанализированные сборки и которые не были проанализированы.</span><span class="sxs-lookup"><span data-stu-id="669ad-169">This section contains a list of assemblies that are referenced by your analyzed assemblies and were not analyzed.</span></span> <span data-ttu-id="669ad-170">Если эта сборка принадлежит вам, включите ее в анализ переносимости API, чтобы получить по ней подробный отчет о переносимости на уровне API.</span><span class="sxs-lookup"><span data-stu-id="669ad-170">If it's an assembly that you own, include it in the API portability analyzer run so that you can get a detailed, API-level portability report for it.</span></span> <span data-ttu-id="669ad-171">Если это библиотека стороннего производителя, проверьте наличие актуальной версии, поддерживающей целевую платформу, и рассмотрите возможность перехода на более новую версию.</span><span class="sxs-lookup"><span data-stu-id="669ad-171">If it's a third-party library, check if there is a newer version that supports your target platform, and consider moving to the newer version.</span></span> <span data-ttu-id="669ad-172">В конечном счете список должен включать все сторонние сборки, от которых зависит ваше приложение, и вы должны проверить, что у них есть версии, которые поддерживают вашу целевую платформу.</span><span class="sxs-lookup"><span data-stu-id="669ad-172">Eventually, the list should include all the third-party assemblies that your app depends on that have a version supporting your target platform.</span></span>

<span data-ttu-id="669ad-173">Дополнительные сведения об анализаторе переносимости .NET см. в [документации GitHub](https://github.com/Microsoft/dotnet-apiport#documentation) и видеоролике с [кратким обзором анализатора переносимости .NET](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer) на Channel 9.</span><span class="sxs-lookup"><span data-stu-id="669ad-173">For more information on the .NET Portability Analyzer, visit the [GitHub documentation](https://github.com/Microsoft/dotnet-apiport#documentation) and [A Brief Look at the .NET Portability Analyzer](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer) Channel 9 video.</span></span>
