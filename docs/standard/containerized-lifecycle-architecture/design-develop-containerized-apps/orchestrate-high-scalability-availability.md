---
title: Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности
description: Реальное производственное приложения должны быть развертываются и управляются с помощью оркестраторов, которые обрабатывают работоспособности, рабочей нагрузки и жизненные циклы всех контейнеров.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 02/15/2019
ms.openlocfilehash: 148eab941644667c803c5613b8815f50263fc0fb
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61644898"
---
# <a name="orchestrating-microservices-and-multi-container-applications-for-high-scalability-and-availability"></a>Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности

Использование оркестраторов для приложений, готовых к рабочей среде важно в том случае, если приложение на основе микрослужб или разнесено по нескольким контейнерам. Как было сказано ранее, в рамках подхода на основе микрослужб каждая микрослужба имеет собственную модель и данные, поэтому она является автономной с точки зрения разработки и развертывания. Но если у вас есть более традиционное бизнес-приложение, состоящее из нескольких служб (например, SOA) и требующее распределенного развертывания, оно также будет включать в себя несколько контейнеров или служб. Такие системы сложны в масштабировании и управлении, поэтому для создания масштабируемого многоконтейнерного приложения, готового к развертыванию в рабочей среде, оркестратор абсолютно необходим.

Рис. 4-6 показано развертывание в кластере приложения, состоящего из нескольких микрослужб (контейнеров).

![Составные приложения Docker в кластере: для каждого экземпляра службы используется один контейнер. Контейнеры Docker являются "единицами развертывания", а отдельный контейнер является экземпляром Docker. Узел обрабатывает много контейнеров.](./media/image6.png)

**Рис. 4-6**. Кластер контейнеров

Такой подход выглядит логичным. Но как вы обрабатываются балансировки нагрузки, маршрутизацию и оркестрация этих составных приложений?

Интерфейс командной строки Docker (CLI) соответствует требованиям управления один контейнер на одном узле, но ее недостаточно, если требуется управлять множеством контейнеров, развернутых на нескольких узлах для более сложных распределенных приложений. В большинстве случаев требуется платформа управления, который будет автоматически запускать контейнеры, масштабировать контейнеры с несколькими экземплярами на изображение, приостанавливать или завершать их работу, когда они понадобятся и в идеале также управлять как при доступе к ресурсам, например, данные и сети хранилище.

Чтобы перейти от отдельных контейнеров или простыми составными приложениями, а также к управлению крупными корпоративными приложениями с микрослужбами управления, следует прибегнуть к платформам оркестрации и кластеризации.

С архитектуры и разработки точки зрения Если вы являетесь построение корпоративных больших, на основе микрослужб, приложений, важно понять следующие платформы и продукты, которые поддерживают сложные сценарии:

- **Кластеры и оркестраторы**. Если вам нужно масштабировать приложения на множестве узлов Docker, такие, как с помощью большого приложения на базе микрослужб, крайне важно иметь возможность управлять всеми этими узлами как единым кластером, абстрагируясь от сложности базовой платформы. Именно такую возможность предоставляют кластеры контейнеров и оркестраторы. Примерами оркестраторов могут служить Azure Service Fabric и Kubernetes. Функции Kubernetes доступны в Azure через службу Azure Kubernetes.

- **Планировщики**. *Планирование* означает, что возможность администратору возможность запускать контейнеры в кластере, поэтому планировщики также предоставляют пользовательский интерфейс для этого. Планировщик кластера имеет несколько функций: обеспечение эффективного использования ресурсов в кластере, применение заданных пользователем ограничений, эффективная балансировка нагрузки контейнеров между узлами, а также обеспечение устойчивости к ошибкам и высокой доступности.

Понятия кластера и планировщика тесно связаны друг с другом, поэтому продукты, предоставляемые разными поставщиками, часто включают в себя оба набора возможностей. В разделе ниже показано наиболее важных платформ и программного обеспечения варианты кластерами и планирования. Эти оркестраторы широко доступны в общедоступных облаках, таких как Azure.

## <a name="software-platforms-for-container-clustering-orchestration-and-scheduling"></a>Программные платформы для кластеризации контейнеров, оркестрации и планирования

| Platform | Комментарии |
|:---:|:---|
| **Kubernetes** <br/> ![Логотип Kubernetes](./media/kubernetes-logo.png) | [*Kubernetes*](https://kubernetes.io/) — это решение с открытым кодом, которое предоставляет широкий ряд возможностей: от организации инфраструктуры кластера и планирования контейнеров до оркестрации. Оно позволяет автоматизировать развертывание, масштабирование и выполнение операций с контейнерами приложений в кластерах узлов. <br/> <br/> *Kubernetes* предоставляет ориентированную на контейнеры инфраструктуру, которая объединяет контейнеры приложений в логические блоки, чтобы упростить управление и обнаружение. <br/> <br/> Решение *Kubernetes* является зрелым в Linux и менее зрелым в Windows. |
| **Служба Azure Kubernetes (AKS)** <br/> ![Логотип служба Azure Kubernetes](./media/aks-logo.png) | [Служба Azure Kubernetes (AKS)](https://azure.microsoft.com/services/kubernetes-service/) является управляемой службой оркестрации контейнеров Kubernetes в Azure, которая упрощает управление, развертывание и эксплуатацию кластера Kubernetes. |
| **Azure Service Fabric** <br/> ![Логотип Azure Service Fabric](./media/service-fabric-logo.png) | [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа микрослужб от корпорации Майкрософт, которая предназначена для создания приложений. Она позволяет [оркестрировать](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-resource-manager-introduction) службы и создавать кластеры компьютеров. Службы в Service Fabric могут развертываться как контейнеры или как обычные процессы. Кроме того, в рамках одного приложения или кластера можно сочетать службы в процессах и службы в контейнерах. <br/> <br/> Кластеры *Service Fabric* могут быть развернуты в Azure, локально или в любом облаке. Тем не менее управляемый подход упрощает развертывание в Azure. <br/> <br/> *Service Fabric* предоставляет дополнительные перспективные [модели программирования Service Fabric](https://azure.microsoft.com/documentation/articles/service-fabric-choose-framework/), такие как [службы с отслеживанием состояния](https://azure.microsoft.com/documentation/articles/service-fabric-reliable-services-introduction/) и [Reliable Actors](https://azure.microsoft.com/documentation/articles/service-fabric-reliable-actors-introduction/). <br/> <br/> Решение *Service Fabric* является зрелым в Windows (годы развития в этой среде) и менее зрелым в Linux. <br/> <br/> С 2017 года в Service Fabric поддерживаются как контейнеры Linux, так и контейнеры Windows. |
| **Azure Service Fabric сетки** <br/> ![Логотип сетки Azure Service Fabric](./media/azure-service-fabric-mesh-logo.png) | [*Azure Service Fabric Mesh* ](https://docs.microsoft.com/azure/service-fabric-mesh/service-fabric-mesh-overview) обеспечивает такой же надежностью, критически важной производительности и масштабирования, что и Service Fabric, но также предлагает полностью управляемые и бессерверной платформы. Нет необходимости управлять кластером, виртуальными машинами, хранилищем и конфигурацией сети. Вы можете сконцентрировать усилия на разработке приложений. <br/> <br/> *Service Fabric Mesh* поддерживает контейнеры Windows и Linux, позволяя разрабатывать с помощью языка программирования и платформу.

## <a name="using-container-based-orchestrators-in-azure"></a>Использование оркестраторов на основе контейнеров в Azure

Несколько поставщиков облачных решений предлагают поддержку контейнеров Docker, а также кластеров Docker и поддержки оркестрации, включая Azure, Amazon EC2 Container Service и Google Container Engine. Azure поддерживает Docker кластера и оркестратора посредством службы Azure Kubernetes (AKS), Azure Service Fabric и Azure Service Fabric сетки.

## <a name="using-azure-kubernetes-service"></a>Использование службы Azure Kubernetes

Кластер Kubernetes пулы несколько узлов Docker и предоставляет их как один виртуальный узел Docker, чтобы можно было развернуть несколько контейнеров в кластере и горизонтального масштабирования с любым количеством экземпляров контейнера. Кластер отвечает за выполнение всех сложных задач управления, включая масштабирование, обеспечение работоспособности и т. д.

Служба AKS позволяет упростить создание и настройку кластера виртуальных машин в Azure, предварительно настроенных для выполнения упакованных в контейнеры приложений, а также управление им. Благодаря оптимизированной конфигурации популярных средств планирования и оркестрации с открытым кодом служба AKS дает возможность развертывать приложения на основе контейнеров в Microsoft Azure и управлять ими, используя имеющиеся навыки или прибегая к знаниям большого и продолжающего расширяться сообщества.

Служба Azure Kubernetes оптимизирует настройку популярных средств и технологий кластеризации Docker с открытым кодом для Azure. Вы получаете открытое решение, которое обеспечивает переносимость как контейнеров, так и конфигурации приложения. Вы выбираете размер, число узлов и средства оркестрации, а служба Azure Kubernetes делает все остальное.

![Структура кластера Kubernetes: один главный узел, который обрабатывает DNS, планировщик, прокси-сервер и т. д., и несколько рабочих узлов, на которых размещены контейнеры.](media/image36.png)

**Рис. 4-7**. Упрощенная структура и топология кластера Kubernetes

Рис. 4-7 показана структура кластер Kubernetes, где большинство координации кластера управляет главный узел (VM), а остальные узлы, которые управляются как единый пул с точки зрения приложения можно развертывать контейнеры. Это позволяет масштабировать до тысяч или даже десятков тысяч контейнеров.

## <a name="development-environment-for-kubernetes"></a>Среда разработки для Kubernetes

В среде разработки, [Docker, было объявлено в июле 2018](https://blog.docker.com/2018/07/kubernetes-is-now-available-in-docker-desktop-stable-channel/), Kubernetes также можно выполнить на машине разработки (Windows 10 или macOS), просто установив [Docker Desktop](https://www.docker.com/community-edition). Позднее можно развернуть ее в облако (AKS) для дальнейшего тестирования интеграции, как показано на рисунке 4-8.

![В июле 2018 г. компания Docker объявила о поддержке компьютера разработки для кластеров Kubernetes с помощью Docker Desktop.](media/kubernetes-development-environment.png)

**Рис. 4-8**. Выполнение Kubernetes на компьютере разработки и в облаке

## <a name="get-started-with-azure-kubernetes-service-aks"></a>Начало работы со службой Azure Kubernetes (AKS)

Чтобы начать использовать AKS, мы Развернем кластер AKS с помощью портала Azure или с помощью интерфейса командной строки. Дополнительные сведения о развертывании кластера службы контейнеров Azure см. в статье [Развертывание кластера службы Azure Kubernetes (AKS)](https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal).

За программное обеспечение, устанавливаемое по умолчанию в составе службы AKS, плата не взимается. Все возможности по умолчанию реализуются с помощью ПО с открытым кодом. Служба AKS доступна для нескольких виртуальных машин в Azure. Плата взимается только за выбранные вычислительные операции, а также за другие используемые ресурсы базовой инфраструктуры, такие как хранилище и сеть. За саму службу AKS вы дополнительно не платите.

Для дальнейшей реализации на основе сведения о развертывании в Kubernetes `kubectl` и версией в исходной `.yaml` файлы, см. в записи [Настройка eShopOnContainers в AKS (служба Azure Kubernetes)](https://github.com/dotnet-architecture/eShopOnContainers/wiki/10.-Setting-the-solution-up-in-AKS-(Azure-Kubernetes-Service)).

## <a name="deploy-with-helm-charts-into-kubernetes-clusters"></a>Развертывание с помощью диаграмм Helm в Kubernetes кластеры

При развертывании приложения в кластере Kubernetes, можно использовать исходный `kubectl.exe` инструмента интерфейса командной строки, с помощью файлов развертывания на основе собственного формата (`.yaml` файлы), как уже упоминалось в предыдущем разделе. Однако для более сложных приложений Kubernetes, например при развертывании сложных приложений на основе микрослужб, мы рекомендуем использовать [Helm](https://helm.sh/).

Чарты helm помогает определить, версии, установка, общий ресурс, обновления или выполнить откат даже самые сложные приложения Kubernetes.

Более того, использование Helm рекомендуется, поскольку дополнительные среды Kubernetes в Azure, такие как [Azure Dev Spaces](https://docs.microsoft.com/azure/dev-spaces/azure-dev-spaces), также основаны на чартах Helm.

Поддерживаемая helm [Cloud собственного Foundation вычислений (CNCF)](https://www.cncf.io/) в сотрудничестве с Майкрософт, Google, Bitnami и участник сообщества Helm.

О дальнейшей реализации диаграмм Helm и Kubernetes, см. в записи [использование диаграмм Helm для развертывания eShopOnContainers в AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/10.1-Deploying-to-AKS-using-Helm-Charts).

## <a name="use-azure-dev-spaces-for-you-kubernetes-application-lifecycle"></a>Использование пробелов разработки Azure для вас жизненным циклом приложений Kubernetes

[Azure Dev Spaces](https://docs.microsoft.com/azure/dev-spaces/azure-dev-spaces) обеспечивает быструю итеративную среду разработки Kubernetes для команд разработчиков. Выполнив минимальную настройку компьютера разработки, можно итеративно запускать и отлаживать контейнеры непосредственно в службе Azure Kubernetes (AKS). Вы можете разрабатывать приложения в Windows, Mac или Linux, с помощью знакомых средств, таких как Visual Studio, Visual Studio Code или командной строки.

Как уже упоминалось, пробелы разработки Azure использует чарты Helm, при развертывании контейнерных приложений.

Azure пробелы разработки помогает группам разработчиков работать более производительно, в Kubernetes, так как он позволяет быстро выполнять итерацию и отладку кода непосредственно в глобальной кластера Kubernetes в Azure, просто с помощью Visual Studio 2017 или Visual Studio Code. Кластер Kubernetes в Azure — это общий управляемый кластер Kubernetes, поэтому ваша команда может работать совместно. Вы можете разрабатывать код в изолированном пространстве, а затем развернуть его в глобальном кластере и выполнить сквозное тестирование с другими компонентами без репликации или имитации зависимостей.

Как показано на рисунке 4-9, средство наиболее отличительный пробелы разработки Azure предоставляет возможность создания «пробелы», которые могут выполняться интегрированной остальной части глобального развертывания в кластере.

![Azure Dev Spaces позволяет прозрачно комбинировать и сопоставлять рабочие микрослужбы с экземпляром контейнера разработки, упрощая тестирование новых версий.](media/image38.png)

**Рис. 4-9**. Использование нескольких пространств в Azure Dev Spaces

По сути можно настроить пробел общей разработки в Azure. Каждый разработчик может сосредоточиться на своей части приложения, можно итеративно разработка «предварительно фиксации» кода в пространстве разработки, которая уже содержит все остальные службы и облачные ресурсы, которые зависят от конкретной ситуации. Зависимости всегда находятся в актуальном состоянии, и разработчики работают в среде, отражающей рабочую.

Azure пробелы разработки реализует концепцию пробела, который позволяет работать изолированно, а также без риска помешать другим членам группы. Эта возможность основана на префиксы URL-адресов; При использовании префикса пространства разработки в URL-адрес для контейнера запроса пробелы разработки Azure запускает специальную версию контейнера, который он развернут для этой области, при наличии. В противном случае будет запускаться глобальная или объединенная версия.

Вы увидите [eShopOnContainers вики-страницы в пространствах разработки Azure](https://github.com/dotnet-architecture/eShopOnContainers/wiki/10.2-Using-Azure-Dev-Spaces-and-AKS) для получения практических представления на конкретный пример.

Для получения дополнительных сведений см. в статье на [Team Development with Azure Dev пробелы](https://docs.microsoft.com/azure/dev-spaces/team-development-netcore).

## <a name="additional-resources"></a>Дополнительные ресурсы

- **Начало работы со службой Azure Kubernetes (AKS)** \
  <https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal>

- **Azure Dev Spaces** \
  <https://docs.microsoft.com/azure/dev-spaces/azure-dev-spaces>

- **Kubernetes.** Официальный сайт. \
  <https://kubernetes.io/>

## <a name="using-azure-service-fabric"></a>Использование Azure Service Fabric

Azure Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления «коробочных» продуктов, зачастую монолитных в стиле, к предоставлению служб. Ее создании учитывался опыт разработки и эксплуатации масштабных служб, таких как базы данных SQL Azure, Azure Cosmos DB, служебную шину Azure или серверная часть Кортаны, Service Fabric. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

Service Fabric помогает решить сложные проблемы при разработке и запуске службы, связанные с эффективным использованием ресурсов инфраструктуры, что позволяет командам решать бизнес-задачи, применяя подход на основе микрослужб.

Service Fabric предоставляет два масштабных решения, которые позволяют создавать приложения в рамках подхода на основе микрослужб.

- Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, управления состоянием и мониторинга работоспособности. В сущности, эти системные службы позволяют задействовать множество характеристик микрослужб, описанных ранее.

- Программные интерфейсы (API) или платформы, позволяющие создавать приложения как микрослужбы: [Reliable Actors и Reliable Services](https://docs.microsoft.com/azure/service-fabric/service-fabric-choose-framework). Для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами средств управления надежным состоянием.

Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные интерфейсы API, упрощающие создание микрослужб.

Как показано на рисунке 4-10, можно создавать и запускать микрослужбы в Service Fabric как простые процессы или как контейнеры Docker. Микрослужбы на основе контейнеров можно также сочетать с микрослужбами на основе процессов в рамках одного кластера Service Fabric.

![Сравнение Azure service Fabric кластеры: Микрослужбы, как процессы, где каждый узел выполняется один процесс для каждой микрослужбы; Микрослужбы, как контейнеры, где каждый узел выполняется Docker с несколькими контейнерами, один контейнер на микрослужбы.](./media/azure-service-fabric-cluster-types.png)

**Рис. 4-10**. Развертывание микрослужб в виде процессов или контейнеров в Azure Service Fabric

В кластерах Service Fabric на основе узлов Linux и Windows могут выполняться соответственно контейнеры Docker Linux и контейнеры Windows.

Актуальные сведения о поддержке контейнеров в Azure Service Fabric см. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

Service Fabric — это хороший пример платформы, где можно определить логическую архитектуру (бизнес-микрослужбы или ограниченные контексты) от физической реализации. Например, если вы реализуете [надежных служб с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction) в [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview), которые представлены в следующем разделе, "[и микрослужбы с отслеживанием состояниябезотслеживаниясостояния](#stateless-versus-stateful-microservices),» у вас есть бизнес-микрослужба с нескольких физических служб.

Как показано на рисунке 4-10 и мышление с точки зрения логической архитектуры микрослужб, при реализации службы Reliable Service Fabric с отслеживанием состояния обычно необходимо реализовать два уровня служб. Первый из них — это внутренняя надежная служба с отслеживанием состояния, которая обеспечивает работу нескольких разделов (каждый раздел является службой с отслеживанием состояния). Второй уровень — это внешняя служба или служба шлюза, которая отвечает за маршрутизацию и объединение данных в разных разделах или экземплярах служб с отслеживанием состояния. Служба шлюза также отвечает за взаимодействие с клиентом и выполнение повторных обращений к внутренней службе. Службой шлюза называется реализуемая вами пользовательская служба, но вы также можете использовать готовую [службу обратного прокси-сервера](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy) Service Fabric.

![Service Fabric есть рецепт для поддержки нескольких с отслеживанием состояния надежных служб в контейнерах.](./media/service-fabric-stateful-business-microservice.png)

**Рис. 4-11**. Бизнес-микрослужба с несколькими экземплярами службы с отслеживанием состояния и клиентскую часть пользовательского шлюза

В любом случае при использовании надежных служб Service Fabric с отслеживанием состояния, также имеется логических или бизнес-микрослужба (ограниченный контекст), состоящий из нескольких физических служб. Каждый из их, служба шлюза и служб раздела можно реализовать как службы веб-API ASP.NET, как показано на рисунке 4-11.

В Service Fabric службы можно объединять в группы и развертывать как [приложение Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-model), которое представляет собой модуль упаковки и развертывания для оркестратора или кластера. Таким образом, приложение Service Fabric можно сопоставить с автономной логической микрослужбой или ограниченным контекстом, чтобы развертывать службы в автономном режиме.

### <a name="service-fabric-and-containers"></a>Service Fabric и контейнеры

Вы также можете развертывать службы в образах контейнеров в кластере Service Fabric. Как показано на рис. 4-12, большую часть времени будет существовать только один контейнер для каждой службы.

![Приложения Service Fabric можно запустить несколько контейнеров, доступ к внешней базе данных, а также полный набор будет логическая граница бизнес-Микрослужба](./media/azure-service-fabric-business-microservice.png)

**Рис. 4-12**. Бизнес-микрослужба с несколькими службами (контейнерами) в Service Fabric

Однако в Service Fabric также возможны так называемые "сцепленные" контейнеры (два контейнера, которые должны развертываться вместе в составе логической службы). Важным моментом является то, что бизнес-микрослужба — это логическая граница вокруг нескольких связанных элементов. Во многих случаях это может быть одна служба с единственной моделью данных, однако в других она может представлять собой несколько физических служб.

Обратите внимание на то, что вы можете сочетать службы в процессах и в контейнерах, в одном приложении Service Fabric, как показано на рисунке 4-13.

![Приложение service fabric, под управлением служб и контейнеров в том же узле.](./media/business-microservice-mapped-to-service-fabric-application.png)

**Рис. 4-13**. Бизнес-микрослужба, сопоставленная с приложением Service Fabric с контейнерами и службами с отслеживанием состояния

Дополнительные сведения о поддержке контейнеров в Azure Service Fabric см. в статье [Service Fabric и контейнеры](https://docs.microsoft.com/azure/service-fabric/service-fabric-containers-overview).

## <a name="stateless-versus-stateful-microservices"></a>Микрослужбы с отслеживанием и без отслеживания состояния

Как уже упоминалось, у каждой микрослужбы (логического ограниченного контекста) должна быть своя модель предметной области (данные и логика). В случае микрослужб без отслеживания состояния базы данных будут внешними — с применением либо реляционных СУБД, таких как SQL Server, либо СУБД на основе NoSQL, например MongoDB или Azure Cosmos DB.

Однако сами службы могут поддерживать отслеживание состояния в Service Fabric, т. е. данные будут находиться в микрослужбе. Эти данные могут существовать не только на том же сервере, но и внутри процесса микрослужбы, в памяти, а также храниться на жестких дисках и реплицироваться в другие узлы. На рис. 4-30 показаны различные подходы.

![В службы без отслеживания состояния состояние (постоянного хранения, базы данных) хранится за пределами микрослужбы. В службах с отслеживанием состояния состояние сохраняется внутри микрослужбы.](./media/stateless-vs-stateful-microservices.png)

**Рис. 4-14**. Микрослужбы с отслеживанием и без отслеживания состояния

Микрослужбы без отслеживания состояния — вполне допустимый подход, и он проще в реализации, чем микрослужбы с отслеживанием состояния, так как подобен традиционным и общеизвестным шаблонам. Но микрослужбы без отслеживания состояния вызывают задержку при взаимодействии процесса с источниками данных и вдобавок содержат больше "движущихся деталей", что осложняет повышение производительности за счет дополнительного кэша и очередей. Результат таков: вы можете получить более сложные архитектуры со слишком большим количеством уровней.

Напротив, [микрослужбы с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis) могут показывать превосходство в сложных сценариях, поскольку при их использовании отсутствуют задержки во взаимодействии логики предметной области с данными. Интенсивная обработка данных, игровые серверы, базы данных как услуга и другие сценарии, требующие низкой задержки, — все они выигрывают от использования служб с отслеживанием состояния, обеспечивая локальное состояние для более быстрого доступа.

Службы без отслеживания состояния и с отслеживанием состояния дополняют друг друга. Например как показано на схеме справа показано на рис. 4-31, службы с отслеживанием состояния можно разбить на несколько разделов. Для доступа к этим разделам может потребоваться служба без отслеживания состояния, выступающая в роли службы шлюза и способная обращаться к каждому разделу с помощью ключей разделов.

У служб с отслеживанием состояния есть недостатки. Они повышают уровень высокой сложности для масштабировать. Функциональность, которая обычно реализовывалась бы в рамках внешней базы данных, должна обрабатывать такие операции, как репликация данных между микрослужбами с отслеживанием состояния и секционирование данных. Но это как раз одна из тех областей, где может помочь оркестратор, такой как [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-platform-architecture) с [надежными службами с отслеживанием состояния](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-introduction#when-to-use-reliable-services-apis). Он упрощает разработку и жизненный цикл микрослужб с отслеживанием состояния с помощью [API Reliable Services](https://docs.microsoft.com/azure/service-fabric/service-fabric-work-with-reliable-collections) и [Reliable Actors](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction).

К другим платформам микрослужб, которые допускают использование служб с отслеживанием состояния и поддерживают шаблон субъекта, повышая отказоустойчивость и снижая задержки при взаимодействии между бизнес-логикой и данными, относятся Microsoft [Orleans](https://github.com/dotnet/orleans) от Microsoft Research и [Akka.NET](https://getakka.net/). В настоящее время идет работа над улучшением поддержки Docker в обеих этих платформах.

Помните, что контейнеры Docker сами без отслеживания состояния. Чтобы реализовать службу с отслеживанием состояния, вам потребуется одна из высокоуровневых платформ, указанных выше.

## <a name="using-azure-service-fabric-mesh"></a>Использование сетки Azure Service Fabric

Azure Service Fabric Mesh — это полностью управляемая служба, которая позволяет разработчикам создание и развертывание критически важных приложений без необходимости управлять какой-либо инфраструктурой. Используйте сетку Service Fabric, чтобы создавать и запускать безопасные распределенные приложения для микрослужб, которые масштабируются по запросу.

Как показано на рисунке 4-15, приложений, размещенных в Service Fabric Mesh запуска и масштабирования не беспокоясь об инфраструктуре, подключив ее.

![Можно развернуть многоконтейнерное приложение, работающее в Docker desktop для Azure Service Fabric Mesh не беспокоясь об инфраструктуре.](media/image39.png)

**Рис. 4-15**. Развертывание приложения для микрослужб или контейнеров в сетке Service Fabric

На самом деле сетка Service Fabric состоит из кластеров из тысяч компьютеров. Все операции в кластере скрыты от разработчика. Нужно просто отправить контейнеры и указать необходимые ресурсы, требования к доступности и ограничения ресурсов. Сетка Service Fabric автоматически выделяет инфраструктуру, запрошенную развертыванием приложения, а также обрабатывает сбои инфраструктуры, гарантируя высокую доступность ваших приложений. Вы думаете только о работоспособности и скорости реагирования приложения, а не об инфраструктуре.

Для получения дополнительных сведений см. в разделе [документации Service Fabric Mesh](https://docs.microsoft.com/azure/service-fabric-mesh/).

## <a name="choosing-orchestrators-in-azure"></a>Выбор оркестраторов в Azure

В следующей таблице приведены рекомендации по выбору оркестратора в зависимости от рабочих нагрузок и фокуса операционной системы.

![Службы Azure Kubernetes является более зрелым в Linux, чем в Windows и обычно используется для развертывания микрослужб, в зависимости от контейнеров. Azure Service Fabric (кластер и сетка) больше подходит для Windows, чем для Linux, и обычно используется для микрослужб на основе контейнеров, микрослужб на основе обычных процессов и служб с отслеживанием состояния.](media/image40.png)

**Рис. 4-16**. Выбор оркестратора в руководстве по Azure

>[!div class="step-by-step"]
>[Назад](soa-applications.md)
>[Вперед](deploy-azure-kubernetes-service.md)
