---
title: Состояние и данные в приложениях Docker
description: Узнайте, доступен параметр для сохранения состояния в контейнерных приложений.
ms.date: 02/15/2019
ms.openlocfilehash: bc171a419632f2ac61c7c9bf6b201b84e0691c3a
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65641250"
---
# <a name="state-and-data-in-docker-applications"></a>Состояние и данные в приложениях Docker

Представьте себе контейнер как экземпляр процесса. Процесс не находится в неизменном состоянии. Хотя контейнер может записывать данные в локальное хранилище, при условии, что экземпляр всегда будет на месте — например, предположив, что одного расположения в памяти будет устойчивой. Образы контейнеров, как и процессы, должно быть принято несколько экземпляров, и они конечном итоге будут завершены; Если они управляются оркестратором контейнеров, следует полагать, что они могут перемещаться из одного узла или виртуальной Машины на другой.

Для управления постоянными данными в приложениях Docker используются следующие решения:

Из узла Docker в качестве [томов Docker](https://docs.docker.com/engine/admin/volumes/):

- **Тома** хранятся в той части файловой системы узла, которая находится под управлением Docker.

- **Привязать подключение** можно сопоставить с любой папки в файловой системе узла, поэтому доступ не может управляться из процесса Docker и может представлять угрозу для безопасности, а контейнер может получить доступ к конфиденциальным папки операционной системы.

- **Подключения tmpfs** аналогичны виртуальным папкам, которые существуют только в памяти узла и никогда не записываются в файловую систему.

Из удаленного хранилища:

- [Служба хранилища Azure](https://azure.microsoft.com/documentation/services/storage/) предоставляет геораспределенное хранилище, предоставляя неплохим долговременным решением сохраняемости для контейнеров.

- Удаленные реляционные базы данных, такие как [базы данных SQL Azure](https://azure.microsoft.com/services/sql-database/), базы данных NoSQL [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), или кэшировать служб, таких как [Redis](https://redis.io/).

Из контейнера Docker:

- Docker имеет функцию под названием *оверлейная файловая система*. Эта функция реализует задачу копирования при записи, что хранилищ обновленные сведения о корневой файловой системы контейнера. Эти сведения «закладывает в верхней части» исходное изображение, на котором базируется контейнер. Если удалить контейнер из системы, эти изменения будут утеряны. Таким образом хотя можно сохранить состояние контейнера в его локальном хранилище, проектирование системы на основе этой функции будет противоречить конструкции контейнера, который по умолчанию без отслеживания состояния.

- Однако тома Docker теперь является предпочтительным способом для обработки локальных данных в Docker. Дополнительные сведения о хранилище в контейнерах, см. на [драйверы Docker](https://docs.docker.com/engine/userguide/storagedriver/) и [об образах, контейнеры и драйверы запоминающих устройств](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/).

Ниже приведены дополнительные сведения об этих параметрах.

**Тома** — это каталоги из ОС узла, сопоставленные с каталогами в контейнерах. Если код в контейнере имеет доступ к каталогу, на самом деле он обращается к каталогу на ОС узла. Этот каталог не привязан к времени существования самого контейнера, находится под управлением Docker и изолирован от основных функциональных возможностей хост-компьютера. Поэтому тома данных хранят данные независимо от контейнера. Если удалить контейнер или образ из узла Docker, данные из томов данных не будут удалены.

Тома могут быть именованными или анонимными (по умолчанию). Именованные тома — это следующий этап развития **контейнеров томов данных**. Они упрощают обмен данными между контейнерами. Тома также поддерживает драйверы томов, которые позволяют хранить данные на удаленных узлах, т. д.

**Привязать подключение** были доступны в течение длительного времени, а также разрешить сопоставление любой папки в точку подключения в контейнере. Подключения привязки имеют больше ограничений, чем тома, и с ними связаны некоторые проблемы безопасности, поэтому тома являются рекомендуемым способом.

**`tmpfs` Подключает** — это виртуальные папки, которые находятся только в оперативной памяти на узле и никогда не записываются в файловую систему. Они быстрые и безопасные, но используют ресурсы памяти и предназначены только для временных данных.

Как показано на рисунке 4-5, обычные тома Docker могут храниться за пределами самих контейнерами, но в физических границах сервера узла или виртуальной машины. Тем не менее контейнеры Docker с одного сервера узла или виртуальной машины не могут обращаться к тому на другом сервере узла или виртуальной машине. Другими словами, с помощью этих томов невозможно управлять данными контейнеров, которые выполняются на разных узлах Docker, хотя такой режим работы можно реализовать с помощью драйвера томов, который поддерживает удаленные узлы.

![Тома могут совместно использоваться несколькими контейнерами, но только на одном узле, если вы не используете удаленный драйвер с поддержкой удаленных узлов. ](./media/image5.png)

**Рис. 4-5**. Тома и внешние источники данных для приложений на основе контейнера

Кроме того, когда контейнеры Docker управляются оркестратором, контейнеры могут "перемещаться" между узлами в рамках оптимизации, выполняемой кластером. Поэтому тома данных не рекомендуется использовать для бизнес-данных. Но они являются прекрасным механизмом для работы с файлами трассировки, временными файлами или аналогичные, которая не влияет на целостность бизнес-данных.

**Удаленные источники данных и инструменты кэширования**, такие как база данных Azure SQL, Azure Cosmos DB или служба кэша, например Redis, можно использовать в упакованных в контейнеры приложениях так же, как они используются при разработке без контейнеров. Это проверенный способ хранения данных бизнес-приложений.

**Служба хранилища Azure** Обычно бизнес-данных должна находиться во внешних ресурсах или базах данных, например службы хранилища Azure. Хранилище Azure предоставляет следующие службы в облаке.

- Хранилище BLOB-объектов хранит неструктурированные данные объектов. Большой двоичный объект может представлять собой текстовые или двоичные данные любого типа, например документ или файл мультимедиа (файлы с изображением, аудио и видео). Хранилище BLOB-объектов также называют хранилищем объектов.

- Хранилище файлов предоставляет общее хранилище для приложений прежних версий, с помощью стандартного протокола SMB. Виртуальные машины Azure и облачные службы могут совместно использовать данные файлов в компонентах приложений через подключенный общий ресурс. Локальные приложения могут обращаться к данным файлов совместно с помощью API REST службы файлов.

- Хранилище таблиц содержит структурированные наборы данных. Хранилище таблиц — это хранилище данных NoSQL типа "ключ-значение", обеспечивающее быструю разработку и доступ к большим объемам данных.

**Реляционные базы данных и базы данных NoSQL.** Существует множество вариантов внешних баз данных — реляционные базы данных, такие как SQL Server, PostgreSQL, Oracle или базы данных NoSQL, например Azure Cosmos DB, MongoDB и т. д. Эти базы данных не будут рассматриваться как части этого руководства, так как они являются полностью посвящен новой теме.

>[!div class="step-by-step"]
>[Назад](monolithic-applications.md)
>[Вперед](soa-applications.md)
