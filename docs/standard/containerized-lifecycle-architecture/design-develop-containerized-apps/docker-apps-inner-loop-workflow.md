---
title: Рабочий процесс внутреннего цикла разработки для приложений Docker
description: Дополнительные сведения «внутреннем цикле» рабочего процесса для разработки приложений Docker.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 02/15/2019
ms.openlocfilehash: dda75e120b0f17a591fadc22944c78d1174ca156
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64664375"
---
# <a name="inner-loop-development-workflow-for-docker-apps"></a>Рабочий процесс внутреннего цикла разработки для приложений Docker

Перед запуском рабочего процесса внешний цикл, охватывающие весь DevOps цикл, все начинает на компьютере каждого разработчика, кодирования самого приложения, с помощью предпочитаемых языков или платформ и его локальному тестированию (рис. 4-21). Однако в любом случае, вам придется важный момент общее, независимо от того, какой язык, framework или платформ. В этом конкретного рабочего процесса вы всегда разработке и тестировании контейнеров Docker, а на локальном компьютере.

![Шаг 1 - код/запуска/отладки](./media/image18.png)

**Рис. 4-21**. Внутренний цикл разработки контекста

Контейнер или экземпляр образа Docker будет содержать следующие компоненты:

- Выбранная операционная система (например, дистрибутив Linux или Windows)

- Файлы, добавленные разработчиком (например, двоичные файлы приложения)

- Конфигурации (например, параметры среды и зависимости)

- Инструкции для того, какие процессы с Docker

Можно настроить рабочий процесс внутреннего цикла разработки, который использует Docker, процесс (см. в следующем разделе). Рассмотрим начальные действия по настройке среды не включены, так как вам нужно сделать всего один раз.

## <a name="building-a-single-app-within-a-docker-container-using-visual-studio-code-and-docker-cli"></a>Создание одного приложения в контейнере Docker, с помощью Visual Studio Code и Docker CLI

Приложения, состоящего из ваших собственных служб и дополнительных библиотек (зависимостей).

Рис. 4-22 показывает основные шаги, которые обычно требуется выполнить при создании приложения Docker, следуют подробное описание каждого шага.

![Обзор рабочего процесса: Шаг 1 - кода, шаг 2 - писать файлы Dockerfile, шаг 3 - Создание образов, определенные с помощью файлов Dockerfile, шаг 4 - определение служб с помощью файла docker-Compose, шаг 5 - запуск контейнеров или составными приложениями, шаг 6 - тестирование приложений, шаг 7 - Push начать внешний цикл (конвейеров CI/CD) или продолжить de созданию.](./media/image19.png)

**Рис. 4-22**. Высокоуровневый рабочий процесс для жизненного цикла для Docker контейнерных приложений с помощью интерфейса командной строки Docker

### <a name="step-1-start-coding-in-visual-studio-code-and-create-your-initial-appservice-baseline"></a>Шаг 1. Приступаем к написанию кода в Visual Studio Code и создания начальной приложения или услуги базовых показателей

Способ, при разработке приложения похоже на способ сделать это без Docker. Разница в том, что при разработке, развертывание и тестирование приложения или службы, работающие в контейнеры Docker, размещенные в локальной среде (например, виртуальной Машины Linux или Windows).

**Настройка локальной среды**

Последние версии Docker для Mac и Windows проще, чем когда-либо для разработки приложений Docker и установки прямолинейна.

> [! СВЕДЕНИЯ]
>
> Инструкции по настройке Docker для Windows, см. в статье <https://docs.docker.com/docker-for-windows/>.
>
>Инструкции по настройке Docker для Mac, см. в статье <https://docs.docker.com/docker-for-mac/>.

Кроме того потребуется редактор кода, чтобы фактически можно разрабатывать приложения при использовании интерфейса командной строки Docker.

Корпорация Майкрософт предоставляет Visual Studio Code, который представляет собой редактор небольшой объем кода, который поддерживается на Mac, Windows и Linux, а также предоставляет поддержку технологии IntelliSense с [поддержка множества языков](https://code.visualstudio.com/docs/languages/overview) (JavaScript, .NET, Go, Java, Ruby, Python и большинство современные языки), [отладки](https://code.visualstudio.com/Docs/editor/debugging), [интеграция с Git](https://code.visualstudio.com/Docs/editor/versioncontrol) и [поддержке расширений](https://code.visualstudio.com/docs/extensions/overview). Этот редактор — отлично подходит для разработчиков Mac и Linux. В Windows также можно использовать полный приложения Visual Studio.

> [! СВЕДЕНИЯ]
>
> Инструкции по установке Visual Studio Code для Windows, Mac или Linux, см. в статье <https://code.visualstudio.com/docs/setup/setup-overview/>.
>
> Инструкции по настройке Docker для Mac, см. в статье <https://docs.docker.com/docker-for-mac/>.

Можно работать с помощью Docker CLI и написать код, используя любой редактор кода, но с помощью Visual Studio Code с расширением Docker упрощает создание и настройка `Dockerfile` и `docker-compose.yml` файлов в рабочей области. Задачи и скрипты также можно запустить из Visual Studio IDE код для выполнения команды Docker, с помощью интерфейса командной строки Docker под.

Расширение Docker для VS Code предоставляет следующие возможности:

- Автоматическое `Dockerfile` и `docker-compose.yml` файл поколения

- Советы по выделению и при наведении указателя мыши синтаксису для `docker-compose.yml` и `Dockerfile` файлов

- IntelliSense (завершений) для `Dockerfile` и `docker-compose.yml` файлов

- Анализ кода (ошибки и предупреждения) для `Dockerfile` файлов

- Команда интеграцию палитры (F1) для наиболее часто используемых команд Docker

- Интеграция обозревателя для управления образами и контейнерами

- Развернуть образы из DockerHub и реестры контейнеров Azure в службе приложений Azure

Чтобы установить расширение Docker, нажмите клавиши Ctrl + Shift + P, введите `ext install`, и выполните команду установить расширение, чтобы открыть список расширений Marketplace. Затем введите **docker** для фильтрации результатов, а затем выберите модуль поддержки Docker, как показано на рис. 4-23.

![Представление расширения Docker для VS Code.](./media/image20.png)

**Рис. 4-23**. Установка расширения Docker в Visual Studio Code

### <a name="step-2-create-a-dockerfile-related-to-an-existing-image-plain-os-or-dev-environments-like-net-core-nodejs-and-ruby"></a>Шаг 2. Создание файла DockerFile, связанного с существующим образом (plain ОС или сред разработки, например .NET Core, Node.js и Ruby)

Вам потребуется `DockerFile` каждого пользовательского образа для построения и каждого контейнера должны быть развернуты. Если приложение состоит из единственный экземпляр пользовательской службы, вам потребуется один `DockerFile`. Но если приложение состоит из нескольких служб (как в архитектуре микрослужб), вам понадобится `Dockerfile` каждой службы.

`DockerFile` Обычно помещается в корневой папке приложения или службы и содержит необходимые команды, поэтому Docker знает, как установить и запустить приложения или службы. Можно создать вашей `DockerFile` и добавьте его в проект, а также код (node.js, .NET Core, и т.д.), или, если вы новичок в среду, взгляните на следующий совет.

> [!TIP]
>
> Можно использовать расширения Docker помогут вам при использовании `Dockerfile` и `docker-compose.yml` файлы, связанные с Docker контейнеров. В конечном счете скорее всего, вы будете писать таких файлов без это средство, но с помощью расширения Docker является хорошей отправной точкой, которая ускоряет изучение оболочки.

На рисунке 4-24, посмотрим, насколько docker-compose с помощью расширения Docker для VS Code добавляется файл.

![Представление консоли расширения Docker для VS Code.](./media/image24.png)

**Рис. 4-24**. Файлы docker, добавленные с помощью **файлы Docker, добавьте к команде рабочей области**

При добавлении файла DockerFile, указать, какой базовый образ Docker, вы будете использовать (например, использование `FROM mcr.microsoft.com/dotnet/core/aspnet`). Обычно вы создадите пользовательский образ на основе базового образа, которую можно получить из любой официального репозитория в [реестра Docker Hub](https://hub.docker.com/) (таких как [изображение для .NET Core](https://hub.docker.com/_/microsoft-dotnet-core/) или [для Node.js](https://hub.docker.com/_/node/)).

***Использовать существующий официальный образ Docker***

Использование официального репозитория стек для языка с номером версии гарантирует, что те же функции языка доступны на всех компьютерах (включая разработки, тестирования и эксплуатации).

Ниже приведен пример DockerFile для контейнера .NET Core.

```Dockerfile
# Base Docker image to use  
FROM mcr.microsoft.com/dotnet/core/aspnet:2.2
  
# Set the Working Directory and files to be copied to the image  
ARG source  
WORKDIR /app  
COPY ${source:-bin/Release/PublishOutput} .  
  
# Configure the listening port to 80 (Internal/Secured port within Docker host)  
EXPOSE 80  
  
# Application entry point  
ENTRYPOINT ["dotnet", "MyCustomMicroservice.dll"]
```

В этом случае образ основан на версии 2.2 официального образа ASP.NET Core Docker (мультиархитектурного для Linux и Windows), согласно строке `FROM mcr.microsoft.com/dotnet/core/aspnet:2.2`. (Дополнительные сведения об этом см. в разделе [образ Docker ASP.NET Core](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) страницы и [образ Docker .NET Core](https://hub.docker.com/_/microsoft-dotnet-core/) страницы).

В DockerFile можно также указать Docker прослушивать TCP-порт, который будет использоваться во время выполнения (например, порт 80).

В Dockerfile можно задать дополнительные параметры конфигурации, в зависимости от используемого языка и платформы. Например `ENTRYPOINT` линия с пустым `["dotnet", "MySingleContainerWebApp.dll"]` указывает Docker запускать приложение .NET Core. Если вы используете пакет SDK и .NET Core CLI (`dotnet CLI`) для построения и запуска приложения .NET, этот параметр будет другим. Ключевой момент здесь является то, что ENTRYPOINT строки и другие параметры зависят от языка и платформы, выбранных для приложения.

> [! СВЕДЕНИЯ]
>
> Дополнительные сведения о создании образов Docker для приложений .NET Core, см. в статье <https://docs.microsoft.com/dotnet/core/docker/building-net-docker-images>.
>
> Дополнительные сведения о создании собственных образов, перейдите к <https://docs.docker.com/engine/tutorials/dockerimages/>.

**Использование мультиархитектурных репозиториев**

Имя одного образа в репозиторий может содержать варианты платформ, например образ Linux и образ Windows. Эта функция позволяет поставщиков, таких как Microsoft (creators базового образа) создать один репозиторий для охвата нескольких платформ (то есть, Linux и Windows). Например [dotnet/core/aspnet](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) репозитория в реестре центра Docker обеспечивает поддержку для Linux и Windows Nano Server, используя то же имя образа.

Извлечение [dotnet/core/aspnet](https://hub.docker.com/_/microsoft-dotnet-core-aspnet/) образа с узла Windows извлекает вариант Windows, тогда как извлекать имя образа из узла Linux извлекает вариант для Linux.

***Создание базового образа с нуля***

Можно создать свой собственный базовый образ Docker с нуля, описанные в этой [статье](https://docs.docker.com/engine/userguide/eng-image/baseimages/) из Docker. Этот сценарий является скорее всего, не лучше подходит, если только вы начинаете с помощью Docker, но если вы хотите задать определенные биты базового образа, это можно сделать.

### <a name="step-3-create-your-custom-docker-images-embedding-your-service-in-it"></a>Шаг 3. Создание пользовательских образов Docker внедрения службы в нем

Для каждого пользовательского службы, которая состоит из приложения необходимо создать связанный образ. Если приложение состоит из одной службы или веб-приложения, вам потребуется всего одним изображением.

> [!NOTE]
>
> Учитывая «рабочего процесса DevOps внешний цикл», образы будут создаваться по автоматизированный процесс сборки при каждой отправке исходного кода в репозиторий Git (непрерывная интеграция), поэтому изображения будет создан в глобальной среде из вашей исходный код.
>
> Но прежде чем мы рассмотрим переход по этому маршруту внешний цикл, но нужно убедиться, что приложения Docker фактически работает правильно, чтобы они не будет отправлено код, который может не работать должным образом для системы управления версиями (Git, и т.д.).
>
> Таким образом каждый разработчик сначала необходимо выполнить процесс внутреннего цикла для локального тестирования и продолжить разработку, пока они хотят передать полный функцию или изменить систему управления версиями.

Чтобы создать образ в локальной среде и с помощью DockerFile, можно использовать команду docker build, как показано на рис. 4-25 (также можно запустить `docker-compose up --build` для приложений, состоящих из нескольких контейнеров и служб).

![Выходные данные консоли сборки docker-Compose, показывающий ход выполнения загрузки изображений.](./media/image25.png)

**Рис. 4-25**. Выполнения команды docker build

При необходимости вместо непосредственного выполнения команды `docker build` из папки проекта, сначала можно создать развертываемую папку с библиотеками .NET с помощью запуска `dotnet publish` команды, а затем запустите `docker build`.

В этом примере создается образ Docker с именем `cesardl/netcore-webapi-microservice-docker:first` (`:first` — это тег, например определенной версии). Вы можете использовать этот шаг для каждого пользовательского образа, который необходимо создать для своего составного приложения Docker с несколькими контейнерами.

Можно найти существующие образы в локальном репозитории (компьютере разработки) с помощью docker команду образов, как показано на рисунке 4-26.

![Выходные данные консоли из команды docker иллюстрации, существующих образов.](./media/image26.png)

**Рис. 4-26**. Просмотр существующих образов с помощью образов docker

### <a name="step-4-define-your-services-in-docker-composeyml-when-building-a-composed-docker-app-with-multiple-services"></a>Шаг 4. Определение служб в файле docker-compose.yml, при создании составного приложения Docker с несколькими службами

С помощью `docker-compose.yml` файл, можно определить набор связанных служб для развертывания как составное приложение с помощью команд развертывания, как описано в следующем разделе шаг.

Создание этого файла в основной или корневой папке решения; оно должно быть содержимое, как показано в этом `docker-compose.yml` файла:

```yml
version: '3.4'
services:
  web:
    build: .
    ports:
     - "81:80"
    volumes:
     - .:/code
    depends_on:
     - redis
  redis:
    image: redis
```

В данном случае этот файл определяет две службы: веб-службы (настраиваемая служба) и служба redis (служба популярных кэширования). Каждая служба будет развертываться как контейнер, поэтому нам нужно использовать конкретный образ Docker для каждого. Для этого конкретного веб-службы изображение необходимо выполнить следующие:

- Строится на основе файла DockerFile в текущем каталоге

- Пересылать предоставленный порт 80 в контейнере для порта 81 на хост-компьютере

- Подключения в каталог проекта на узле для/Code в контейнере, благодаря чему можно изменять код без повторной сборки образа

- Привязать веб-службы к службе redis

Служба использует redis [последней версии образа общей redis](https://hub.docker.com/_/redis/) извлечь из реестра Docker Hub. [redis](https://redis.io/) — это система популярных кэширования для серверных приложений.

### <a name="step-5-build-and-run-your-docker-app"></a>Шаг 5. Сборка и запуск приложения Docker

Если приложение имеет только один контейнер, необходимо просто запустите его, развернув ее к узлу Docker (виртуальной Машине или физическом сервере). Тем не менее, если приложение состоит из нескольких служб, необходимо *комбинирование ее*, слишком. Давайте посмотрим, различные варианты.

***Вариант а Запустите единственного контейнера или службы***

Образ Docker можно запустить с помощью команды docker run, как показано ниже:

```console
docker run -t -d -p 80:5000 cesardl/netcore-webapi-microservice-docker:first
```

Для данного конкретного развертывания мы будем перенаправление запросов, отправленный на порт 80 с внутренним портом 5000. Теперь приложение прослушивает внешний порт 80 на уровне узла.

***Вариант б Составление и выполнение приложения-контейнера с несколькими***

В большинстве корпоративных сценариев приложение Docker будет состоять из нескольких служб. В этих случаях можно запустить `docker-compose up` команду (рис. 4-27), которая будет использовать файл docker-compose.yml, который вы создали ранее. Данная команда развертывает составное приложение со всеми связанные с ним контейнеры.

![Выходные данные консоли-команду docker compose up.](./media/image27.png)

**Рис. 4-27**. Результаты выполнения команды «docker-compose up»

После того, как `docker-compose up`, развертывании приложения и его связанные контейнеры в узле Docker, как показано на рис. 4-28, в представлении виртуальной Машины.

![Виртуальная машина выполнения многоконтейнерных приложений.](./media/image28.png)

**Рис. 4-28**. Виртуальная машина с развернутыми контейнерами Docker

### <a name="step-6-test-your-docker-application-locally-in-your-local-cd-vm"></a>Шаг 6. Тестирование приложения Docker (локально, в вашей локальной виртуальной Машине компакт-диска)

Этот шаг будет зависеть от действия приложения.

В простой .NET Core веб-API «Hello World» развернуть в качестве единственного контейнера или службы необходимо просто доступ к службе, предоставляя TCP-порт, указанный в DockerFile.

Если localhost не включена, чтобы перейти к службе, найти IP-адрес для компьютера с помощью следующей команды:

```console
docker-machine {IP} {YOUR-CONTAINER-NAME}
```

На узле Docker откройте браузер и перейдите к этому сайту; Вы увидите/службе приложений под управлением, как показано на рис. 4-29.

![Представление браузера ответа от localhost/API/values.](./media/image29.png)

**Рис. 4-29**. Тестирование приложения Docker локально с помощью localhost

Обратите внимание на то что он использует порт 80, но внутренне он перенаправляется на порт 5000, потому что это, как она была развернута с `docker run`, как описано ранее.

Это можно проверить с помощью CURL с терминала. В установки Docker в Windows IP-адрес по умолчанию является 10.0.75.1, как показано на рис. 4-30.

![Получение выходных данных консоли http://10.0.75.1/API/values с помощью curl](./media/image30.png)

**Рис. 4-30**. Тестирование приложения Docker локально с помощью CURL

**Отладка контейнера, запущенного в Docker**

Visual Studio Code поддерживает отладки Docker, если вы используете Node.js и других платформ, таких как контейнеры .NET Core.

Также можно отлаживать контейнеры .NET Core или .NET Framework в Docker при использовании Visual Studio для Windows или Mac, как описано в следующем разделе.

> [! СВЕДЕНИЯ]
>
> Дополнительные сведения об отладке контейнеров Node.js Docker, перейдите к <https://blog.docker.com/2016/07/live-debugging-docker/> и <https://blogs.msdn.microsoft.com/user_ed/2016/02/27/visual-studio-code-new-features-13-big-debugging-updates-rich-object-hover-conditional-breakpoints-node-js-mono-more/>.

>[!div class="step-by-step"]
>[Назад](docker-apps-development-environment.md)
>[Вперед](visual-studio-tools-for-docker.md)
