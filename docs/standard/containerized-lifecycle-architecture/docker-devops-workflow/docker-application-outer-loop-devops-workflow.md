---
title: Действия в рабочем процессе внешнего цикла DevOps для приложения Docker
description: Инструкции по «внешний цикл» рабочего процесса DevOps
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 02/15/2019
ms.openlocfilehash: 7193200d74eeac23e9cba11b3ed2056458c9984e
ms.sourcegitcommit: 438919211260bb415fc8f96ca3eabc33cf2d681d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2019
ms.locfileid: "59613022"
---
# <a name="steps-in-the-outer-loop-devops-workflow-for-a-docker-application"></a>Действия в рабочем процессе внешнего цикла DevOps для приложения Docker

Рис. 5-1 представляет end-to-end, описание шагов, составляющих рабочий процесс DevOps для внешнего цикла.

![На этой диаграмме показаны «внешний цикл» DevOps. Когда код отправляется в репозиторий, конвейер непрерывной Интеграции запускается, а затем начинает конвейера компакт-диска, возвращает развернуто приложение. Метрики, собранные из развернутых приложений отправляются обратно рабочую нагрузку разработки, где происходит «внутреннем цикле», чтобы группы разработчиков имеют фактические данные реагировать на потребности пользователей и бизнес.](./media/image1.png)

**Рис. 5-1**. Рабочий процесс внешнего цикла DevOps для приложений Docker с использованием средств Майкрософт

Теперь давайте рассмотрим каждое из этих действий более подробно.

## <a name="step-1-inner-loop-development-workflow"></a>Шаг 1. Рабочий процесс внутреннего цикла разработки

Этот шаг описан подробно в главе 4, но Напомню, Вот где начинается внешний цикл некоторое время, по которому разработчик помещает код в систему управления версиями (например, Git), инициированные действия конвейера непрерывной Интеграции.

## <a name="step-2-source-code-control-integration-and-management-with-azure-devops-services-and-git"></a>Шаг 2. Интеграция системы управления версиями и управление с помощью служб Azure DevOps и Git

На этом этапе необходимо иметь систему управления версиями для сбора консолидированных версию весь код, поступающие от разные разработчики в команде.

Несмотря на то, что система управления версиями (SCC) и управления версиями может показаться привычкой цикл для большинства разработчиков, при создании приложений с помощью Docker жизни DevOps, очень важно подчеркнуть, что вам не нужно отправить образов Docker с приложением непосредственно в глобальной Docker реестр (например, реестр контейнеров Azure или Docker Hub) с компьютера разработчика. Напротив образов Docker освобождение и развертываемых в рабочих средах должны создаваться только на исходный код, который интегрируется в глобальной сборке или конвейер непрерывной Интеграции, исходя из репозитория исходного кода (например, Git).

Локальные изображения, созданные разработчиками, следует использовать только по их при тестировании в своих собственных компьютерах. Поэтому крайне важно иметь конвейер DevOps, активировать из кода SCC.

Azure DevOps Services и Team Foundation Server поддерживает Git и системы управления версиями Team Foundation. Можно выбрать между ними и использовать его для качества Microsoft end-to-end. Тем не менее, также можно управлять код во внешних репозиториях (например, GitHub, на локальном репозитории Git или Subversion) и по-прежнему иметь возможность подключиться к нему и получите код как начальную точку для конвейера DevOps CI.

## <a name="step-3-build-ci-integrate-and-test-with-azure-devops-services-and-docker"></a>Шаг 3. Сборки непрерывной Интеграции, интеграции и тестирование с помощью Azure DevOps служб и Docker

Непрерывная Интеграция стал стандартом для тестирования современного программного обеспечения и доставки. Решение Docker обеспечивает четкое разделение между командами разработки и операций. Неизменность образов Docker обеспечивает Повторяемое развертывание между что разработки, тестирования через непрерывной Интеграции и запустить в рабочей среде. Подсистема docker развернуть на ноутбуках разработчика и инфраструктуру тестирования делает контейнеры портативных в средах.

На этом этапе после систему управления версиями с правильный код отправки, вам потребуется *служба сборок* для кода и запустить глобальной сборки и тестирования.

О построении конвейера непрерывной Интеграции, состоящий из репозитория кода (Git т. д.), сервер сборки (службы Azure DevOps), подсистема Docker и в реестр Docker является внутреннего рабочего процесса для выполнения этого шага (непрерывной Интеграции, сборки, тестирования).

Позволяет службам DevOps в Azure как основа для построения приложений и настройка конвейера непрерывной Интеграции, а также для публикации «артефактов сборки» «репозитория артефактов,» как описано в следующем шаге.

При использовании Docker для развертывания «итоговые версии артефактов» для развертывания образов Docker с помощью приложения или служб, внедренных в них. Эти образы являются отправлена или опубликовать его *реестра Docker* (частный репозиторий, например тех, которые имеются в реестре контейнеров Azure, или любой общедоступный как реестре центра Docker, которая часто используется для официальных базовых образах).

Вот основной принцип: Конвейер непрерывной Интеграции будет создан off путем фиксации в репозиторий SCC как Git. Фиксация вызовет служб Azure DevOps запустить задание сборки в контейнере Docker и, после успешного завершения этого задания можно передать образ Docker в реестр Docker, как показано на рисунке 5-2.

![В первой части внешний цикл включает в себя шаги 1 – 3, из кода, запуска, отладки и проверить, затем репозитория кода до шага непрерывной Интеграции сборки и тестирования](./media/image2.png)

**Рис. 5-2**. Действия, связанные с непрерывной Интеграции

Ниже приведены основные этапы рабочего процесса непрерывной Интеграции с решениями Docker и служб Azure DevOps.

1. Разработчик отправляет фиксацию с репозиторием SCC (Git/Azure DevOps Services, GitHub, и т.д.).

2. Если вы используете Azure DevOps Services или Git, CI является встроенной, что означает, что это сложнее, чем установка флажка в службах Azure DevOps. Если вы используете внешние SCC (например, GitHub), `webhook` будет уведомлять служб Azure DevOps, обновления или передать в Git и GitHub.

3. Службы Azure DevOps извлекает хранилище SCC, включая Dockerfile, описывающий изображение, а также код приложения и тестов.

4. Службы DevOps Azure создает образ Docker и помечает его с номером сборки.

5. Службы Azure DevOps создает в контейнере Docker в подготовленный компьютер Docker и запускает соответствующие тесты.

6. Если тесты проходят успешно, изображение сначала помечается значащее имя, чтобы вы знаете, «blessed сборки» (например «/ 1.0.0» или любые другие метки) и затем передается в реестр Docker (Docker Hub, реестр контейнеров Azure, DTR т. д.)

### <a name="implementing-the-ci-pipeline-with-azure-devops-services-and-the-docker-extension-for-azure-devops-services"></a>Реализация в конвейер непрерывной Интеграции с помощью служб Azure DevOps и расширения Docker для служб Azure DevOps

Visual Studio Azure DevOps Services содержит шаблоны выпуска, который можно использовать в конвейере CI/CD с помощью которого можно создание образов Docker, отправлять образы Docker в реестр Docker с поддержкой аутентификации, запуска образов Docker или выполнить другие операции, предоставляемые & сборки интерфейс командной строки Docker. Он также добавляет задачи Docker Compose, который можно использовать для сборки, Push-уведомлений и запуска многоконтейнерного приложения Docker или выполнить другие операции, предоставляемые Docker Compose интерфейса командной строки, как показано на рисунке 5-3.

![Представление браузера конвейера непрерывной Интеграции Docker в Azure DevOps](./media/image3.png)

**Рис. 5-3**. Конвейер непрерывной Интеграции Docker в службах Azure DevOps, включая сборки и шаблонов выпуска и связанные с ними задачи.

Эти шаблоны и задачи можно использовать для создания артефактов CI/CD для сборки и тестирования и развертывания в Azure Service Fabric, службе Azure Kubernetes и аналогичные предложения.

Эти задачи Visual Studio Team Services, сборки узлов и виртуальных Машин Docker в Linux, подготовленного в Azure и предпочтительный реестра Docker (реестр контейнеров Azure, Docker Hub, закрытый DTR Docker или другой реестр Docker) можно создать конвейер непрерывной Интеграции Docker в очень согласованно.

***Требования:***

- Службы Azure DevOps, или для локальных установок Team Foundation Server 2015 с обновлением 3 или более поздней версии.

- Агент служб Azure DevOps, который содержит двоичные файлы Docker.

  Простой способ создать один из этих агентов — использовать Docker для запуска контейнера на основе образа Docker агент служб Azure DevOps.

> [! Сведения о] для чтения сведения о сборке Services Docker Azure DevOps CI конвейера и просмотреть пошаговые руководства, посетите следующие сайты:
>
> - Агент Visual Studio Team Services (теперь службы DevOps Azure) как контейнер Docker: \
>   <https://hub.docker.com/_/microsoft-azure-pipelines-vsts-agent>
>
> - Создание образов Docker для Linux .NET Core с помощью служб Azure DevOps: \
>   <https://blogs.msdn.microsoft.com/stevelasker/2016/06/13/building-net-core-linux-docker-images-with-visual-studio-team-services/>
>
> - Построение под управлением Linux Visual Studio Team Service компьютер с поддержкой Docker "сборки": \
>   <http://donovanbrown.com/post/2016/06/03/Building-a-Linux-Based-Visual-Studio-Team-Service-Build-Machine-with-Docker-Support>

### <a name="integrate-test-and-validate-multi-container-docker-applications"></a>Интеграция, тестирование и проверка приложений с несколькими контейнерами Docker

Как правило большинство приложений Docker состоят из нескольких контейнеров, а не в одном контейнере. Хороший пример — это приложение, ориентированных на микрослужбы, для которого имеется один контейнер на микрослужбы. Но даже без строго следующим шаблонам микрослужб подход, вполне вероятно, что приложение Docker будет состоять из нескольких контейнеров или служб.

Таким образом после создания контейнеров приложений в конвейере непрерывной Интеграции, необходимо также развернуть, интеграции и тестирование приложения в целом все его контейнеры в узле Docker integration или даже в кластер тестирования, к которому будут контейнеров распределенные.

Если вы используете один узел, можно использовать команды Docker, такие как docker-compose для создания и развертывания связанных контейнеров для тестирования и проверки среды Docker в одной виртуальной Машины. Но если вы работаете с кластером orchestrator, такие как DC/OS, Kubernetes или Docker Swarm, необходимо выполнить развертывание контейнеров посредством другого механизма или orchestrator, в зависимости от выбранного кластера или планировщика.

Ниже приведены несколько типов тестов, которые можно выполнять на контейнеры Docker.

- Модульные тесты для контейнеров Docker

- Тестирование групп взаимосвязанных приложений и микрослужб

- Тестирование в рабочей среде и «перестраховочным» выпуски

Важно то, что при выполнении интеграционных и функциональных тестов, необходимо выполнить эти тесты из вне контейнеров. Тесты не включенных или запуска в контейнерах, на которых выполняется развертывание, так как контейнеры основаны на статические изображения, которые должны быть так же, как те, которые вы будете развертывать в рабочей среде.

Является целесообразным при тестировании более сложные сценарии, например включая несколько кластеров (проверки кластера, промежуточный кластер и рабочий кластер) является публикация образов в реестр, его можно проверить в разных кластерах.

### <a name="push-the-custom-application-docker-image-into-your-global-docker-registry"></a>Передать образ Docker пользовательского приложения в глобальной реестра Docker

После тестирования и проверки образов Docker, стоит теги и публиковать их в реестр Docker. Реестр Docker — ключевой компонент в жизненный цикл приложения Docker, так как это централизованное место, где хранятся пользовательские теста (также называется «blessed images») будет развернут в контроля Качества и рабочей средах.

Подобно как код приложения, хранящиеся в репозитории SCC (например, Git) — «источник истины», реестр Docker — «источник истины» для двоичных приложения или bits для контроля Качества или рабочей среде развертывания.

Как правило может потребоваться у ваших частных репозиториев для пользовательских образов в частный репозиторий в реестре контейнеров Azure на локальный реестр как доверенный реестр Docker или в реестре и общедоступное облако с ограниченным доступом (например Docker Hub), несмотря на то что в последнем случае если код не является открытым исходным кодом, должны доверять безопасности поставщика. В любом случае метода, используемого аналогичные и основан на `docker push` команды, как показано на рисунке 5-4.

![На шаге 3, для создания интеграции и тестирования (CI) может опубликовать получаемые образы docker в частный или общедоступный реестр.](./media/image4.png)

**Рис. 5-4**. Публикация пользовательских образов в реестре Docker

Имеется несколько предложений реестров Docker из поставщиков облачных решений, таких как реестр контейнеров Azure, реестр контейнеров Amazon Web Services, реестр контейнеров Google, Quay реестра и т. д.

С помощью Docker задач, можно передать набор обслуживания образов, определением `docker-compose.yml` файл с несколькими Tag, в реестр Docker, прошедшего проверку подлинности (например, реестр контейнеров Azure), как показано на рисунке 5-5.

![Представление браузера шага для публикации образов в реестр с DevOps в Azure.](./media/image5.png)

**Рис. 5-5**. Использование служб Azure DevOps для публикации пользовательских образов в реестр Docker

> [! Сведения о] Дополнительные сведения о реестре контейнеров Azure см. в разделе <https://aka.ms/azurecontainerregistry>.

## <a name="step-4-cd-deploy"></a>Шаг 4. Компакт-ДИСК, развертывание

Неизменность образов Docker гарантирует воспроизводимые развертывания с что разработки, тестирования через непрерывной Интеграции и запустить в рабочей среде. После образы Docker приложений, опубликованных в реестр Docker (частный или общедоступный), их можно развернуть в нескольких средах, которые могут иметь (производство, контроля Качества, промежуточного хранения, и т.д.) из конвейера компакт-диска с помощью служб Azure DevOps конвейер задачи или Azure DevOps Services Release Management.

Однако на этом этапе он зависит от какого рода приложения Docker вы развертываете. Развертывание простого приложения (с композиции и развертывания точки зрения) как монолитного приложения, включающего в себя несколько контейнеров или служб и развернутых несколько серверов или виртуальных машин отличается от процесса развертывания более сложное приложение как ориентированных на микрослужбы приложения с возможностями обработки. Эти два сценария описаны в следующих разделах.

### <a name="deploying-composed-docker-applications-to-multiple-docker-environments"></a>Развертывание составных приложений Docker в нескольких средах Docker

Рассмотрим сначала в менее сложных сценарий: развертывание в простой узлов Docker (виртуальные машины или серверы) в среде одного или нескольких сред (контроля Качества, промежуточной и рабочей). В этом случае конвейере непрерывной Поставки можно использовать внутри docker-compose (из задач развертывания служб Azure DevOps) для развертывания приложений Docker с набором связанных контейнеров или служб, как показано на рисунке 5-6.

![Развертывание компакт-диска шаге (4) можно опубликовать в разных средах, таких как q & a, промежуточной и рабочей.](./media/image6.png)

**Рис. 5-6**. Развертывание контейнеров приложения простой реестр среды узла Docker

Рис. 5-7 выделяет, как можно соединиться с вашей сборки CI среды контроля Качества и тестирования с помощью служб Azure DevOps, щелкнув Docker Compose в диалоговом окне Добавить задачу. Тем не менее, при развертывании в промежуточной или рабочей среде, обычно используется Release Management возможности обработки нескольких сред (например контроля Качества, промежуточной и рабочей). При развертывании на отдельные узлы Docker, она использует службы Azure DevOps «Docker Compose» задачи (который вызывает `docker-compose up` команды взгляд изнутри). При развертывании в службе контейнеров Azure, использует задачу развертывания Docker, как описано в следующем разделе.

![Добавление задачи Docker Compose представление браузера.](./media/image7.png)

**Рис. 5-7**. Добавление задачи Docker Compose в конвейере служб Azure DevOps

При создании выпуска в службах Azure DevOps, он принимает набор входных артефакты. Эти артефакты предназначены быть неизменными в течение жизненного цикла выпуска, во всех средах. При введении контейнеры входной артефакты идентификации образов в реестре для развертывания. В зависимости от того, как идентифицируются эти образы, они не гарантированно не изменяются на протяжении выпуска, наиболее очевидная вариантов, при ссылке на `myimage:latest` из `docker-compose` файла.

Шаблоны служб Azure DevOps дать возможность создать артефакты сборки, содержащие изображения реестра формирует дайджест, гарантированно уникальным идентификатором один двоичный образ. Это те, что Вы действительно хотите использовать в качестве входных данных для выпуска.

### <a name="managing-releases-to-docker-environments-by-using-azure-devops-services-release-management"></a>Управление выпусками в средах Docker с помощью управления выпусками служб Azure DevOps

Через шаблоны служб Azure DevOps, можно создать новый образ, опубликуйте его в реестр Docker, запустите его на узлах Linux или Windows и использовать команды, такие как `docker-compose` для развертывания нескольких контейнеров в качестве приложение целиком, все это Azure DevOps Возможности управления выпусками, предназначены для нескольких сред служб, как показано на рис. 5-8.

![Представление обозревателя Azure DevOps, Настройка Docker compose выпусков.](./media/image8.png)

**Рис. 5-8**. Настройка задачи Azure DevOps служб Docker Compose в управлении выпусками служб Azure DevOps

Однако следует помнить, что сценарии показано на рис. 5-6 и реализован на рис. 5-8 — это простой продукт (развертывание виртуальных машин и отдельные узлы Docker, и будет существовать на одном контейнере или экземпляр каждого образа) и, возможно, следует использовать только для разработки или тестирования sce narios. В большинстве корпоративных сценариев рабочей среде, следует по балансировки нагрузки между несколько узлов, серверы и виртуальные машины, а также «интеллектуальные отработки отказа» имеют высокий уровень доступности (HA) и более простой в управлении масштабируемости, если сервер или узел не удается, его служб и контейнеров будут переведены на другом сервере узла или виртуальной Машины. В этом случае необходимо более сложных технологий, таких как кластеры контейнеров, планировщики и оркестраторы. Таким образом способ развертывания к этим кластерам, обработка сложных сценариев описан в следующем разделе.

### <a name="deploying-docker-applications-to-docker-clusters"></a>Развертывание приложений Docker в кластеры Docker

Характер распределенных приложений требует вычислительных ресурсов, которые также распространяются. Чтобы рабочая возможности, необходимо иметь кластеризации возможности, которые обеспечивают высокую масштабируемость и высокий уровень доступности, на основе пула ресурсов.

Можно развернуть контейнеры вручную к этим кластерам из инструмента интерфейса командной строки или с веб-Интерфейсом, но необходимо зарезервировать такого рода ручной работы по тестированию spot развертывания или целей управления, такие как масштабирование или мониторинга.

С точки зрения компакт-диска, а также службам DevOps в Azure в частности, позволяет выполнять задачи по развертыванию специально сделан из среды управления выпусками служб Azure DevOps, которые будут развертывать контейнерные приложения для распределенных кластерах в контейнере Службы, как показано на рисунке 5-9.

![Развертывание компакт-диска шаге (4) также можно опубликовать для кластеров с помощью оркестраторов.](./media/image9.png)

**Рис. 5-9**. Развертывание распределенных приложений в службе контейнеров

Изначально при развертывании для некоторых кластеров или оркестраторы, традиционно используется сценарии развертывания и механизма каждого каждого оркестратора (то есть Kubernetes и Service Fabric имеют механизмы развертывания) вместо более простой и простой в использовании `docker-compose` средство на основе `docker-compose.yml` файла определения. Однако благодаря в задачу развертывания Docker на службы Azure DevOps, показано на рисунке 5-10, теперь также развертыванием на поддерживаемых оркестраторов, просто использовав вашей знакомый `docker-compose.yml` файла, потому что средство выполняет этот «перевод» автоматически (из вашей `docker-compose.yml`файл в формат, необходимые для orchestrator).

![Задача развертывания представление браузера каталога задач в Azure DevOps, показывающий Docker.](./media/image10.png)

**Рис. 5-10**. Добавление задачи развертывания Docker RM вашей среды

Рис. 5-11 показано, как можно изменить в задачу развертывания Docker и указать тип объекта (Azure DC/OS службы контейнеров, в данном случае), файл Docker Compose и подключение к реестру Docker (например, реестр контейнеров Azure или Docker Hub). Это задача, которая будет извлекать готовые к использованию пользовательских образов Docker для развертывания как контейнеры в кластере.

![Представление обозревателя Azure DevOps, разверните определение задачи orchestrator.](./media/image11.png)

**Рис. 5-11**. Docker развернуть задача определения развертывание в Azure DC/OS службы контейнеров

> [! Сведения о] Дополнительные сведения о конвейере компакт-диска с помощью служб Azure DevOps и Docker, посетите <https://azure.microsoft.com/services/devops/pipelines>

## <a name="step-5-run-and-manage"></a>Шаг 5. Запуск и управление ими

Поскольку выполнение приложений и управления ими в рабочей среде корпоративного уровня является главной темой в самого себя и из-за типа операций и людей, работающих на этом уровне (ИТ-операций), а также большого объема в этой области, посвящена всей следующей главе Объяснение.

## <a name="step-6-monitor-and-diagnose"></a>Шаг 6. Мониторинг и диагностика

В этом разделе также рассматривается в следующей главе как часть задачи, он выполняет в рабочих системах; Тем не менее важно подчеркнуть, что информации, полученной на этом шаге нужно передать обратно к группе разработки, таким образом, чтобы приложение постоянно повышается. С этой точки зрения, он также является частью DevOps, несмотря на то, что задачи и операции, обычно выполняются с ИТ.

Только в том случае, если мониторинг и диагностика — 100% в пределах области DevOps являются мониторинга процессов и аналитики, выполняемая команда разработчиков средах тестирования или бета-версии. Это делается путем выполнения нагрузочного тестирования или отслеживая бета-версии или контроля Качества средах, где тест-инженеров бета-версия устанавливается на новые версии.

>[!div class="step-by-step"]
>[Назад](index.md)
>[Вперед](create-ci-cd-pipelines-azure-devops-services-aspnetcore-kubernetes.md)
