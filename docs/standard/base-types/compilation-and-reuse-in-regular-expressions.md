---
title: Компиляция и многократное использование в регулярных выражениях
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- parsing text with regular expressions, compilation
- searching with regular expressions, compilation
- .NET regular expressions, engines
- .NET regular expressions, compilation
- regular expressions, compilation
- compilation, regular expressions
- pattern-matching with regular expressions, compilation
- regular expressions, engines
ms.assetid: 182ec76d-5a01-4d73-996c-0b0d14fcea18
ms.openlocfilehash: fbf10c7f3b4ebf4db97b18b2a2ef165226a48027
ms.sourcegitcommit: 4a938327bad8b2e20cabd0f46a9dc50882596f13
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2020
ms.locfileid: "92889482"
---
# <a name="compilation-and-reuse-in-regular-expressions"></a>Компиляция и многократное использование в регулярных выражениях
Производительность приложений, активно использующих регулярные выражения, можно оптимизировать, если понимать, каким образом обработчик регулярных выражений компилирует выражения и как кэшируются регулярные выражения. В этом разделе описаны и компиляция, и кэширование.  
  
## <a name="compiled-regular-expressions"></a>Скомпилированные регулярные выражения  
 По умолчанию обработчик регулярных выражений компилирует регулярные выражения в последовательность внутренних инструкций (это коды высокого уровня, которые отличаются от языка MSIL). Когда обработчик выполняет регулярное выражение, он преобразовывает внутренние коды.  
  
 Если объект <xref:System.Text.RegularExpressions.Regex> создается с параметром <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType>, то регулярное выражение явно компилируется в язык MSIL вместо внутренних инструкций высокого уровня. Это позволяет JIT-компилятору платформы .NET преобразовывать выражение в изначальный машинный код данного объекта для повышения производительности.  Стоимость конструирования объекта <xref:System.Text.RegularExpressions.Regex> может быть выше, однако стоимость выполнения совпадений, скорее всего, будет значительно меньше.

 Также можно применить предварительно скомпилированные регулярные выражения. Все выражения можно скомпилировать в библиотеку DLL с помощью метода <xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A>, чтобы использовать их многократно. Этим вы избавитесь от компиляции во время выполнения, сохраняя скорость работы как при использовании скомпилированных регулярных выражений.  
  
## <a name="the-regular-expressions-cache"></a>Кэш регулярных выражений  
 Для повышения производительности обработчик регулярных выражений поддерживает кэш скомпилированных регулярных выражений на уровне приложения. Кэш хранит шаблоны регулярных выражений, которые используются только при вызове статических методов. (Шаблоны регулярных выражений, предоставляемые методами экземпляра, не кэшируются.) Это устраняет потребность в повторном разборе выражения в байт-код высокого уровня при каждом его использовании.  
  
 Максимальное число кэшированных регулярных выражений определяется значением `static` (`Shared` в Visual Basic) свойства <xref:System.Text.RegularExpressions.Regex.CacheSize%2A?displayProperty=nameWithType>. По умолчанию обработчик регулярных выражений кэширует до 15 скомпилированных регулярных выражений. Если число скомпилированных регулярных выражений превышает размер кэша, из него удаляется наиболее давнее по использованию регулярное выражение и кэшируется новое регулярное выражение.  
  
 Приложение может повторно использовать регулярные выражения одним из указанных далее двух способов.  
  
- Вы можете использовать статический метод объекта <xref:System.Text.RegularExpressions.Regex> для определения регулярного выражения. Если используется шаблон регулярного выражения, который уже был определен при вызове другого статического метода, обработчик регулярных выражений попробует извлечь его из кэша. Если он недоступен в кэше, обработчик скомпилирует регулярное выражение и добавит его в кэш.
  
- Вы можете многократно использовать существующий объект <xref:System.Text.RegularExpressions.Regex> везде, где потребуется созданный его шаблон регулярного выражения.  
  
 Создание и быстрое уничтожение многочисленных объектов <xref:System.Text.RegularExpressions.Regex> — это очень затратный процесс, так как высоки издержки на создание объектов и компиляцию регулярных выражений. Для приложений, использующих большое количество разных регулярных выражений, производительность можно повысить путем вызова статических методов `Regex` и, возможно, путем увеличения размера кэша для регулярных выражений.  
  
## <a name="see-also"></a>См. также

- [Регулярные выражения .NET](regular-expressions.md)
