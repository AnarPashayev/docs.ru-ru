---
title: Компиляция и многократное использование в регулярных выражениях
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- parsing text with regular expressions, compilation
- searching with regular expressions, compilation
- .NET Framework regular expressions, engines
- .NET Framework regular expressions, compilation
- regular expressions, compilation
- compilation, regular expressions
- pattern-matching with regular expressions, compilation
- regular expressions, engines
ms.assetid: 182ec76d-5a01-4d73-996c-0b0d14fcea18
ms.openlocfilehash: 3e1dfe8373145286b03e503f038e267ff0d4c4f3
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2020
ms.locfileid: "73091731"
---
# <a name="compilation-and-reuse-in-regular-expressions"></a>Компиляция и многократное использование в регулярных выражениях
Производительность приложений, активно использующих регулярные выражения, можно оптимизировать, если понимать, каким образом обработчик регулярных выражений компилирует выражения и как кэшируются регулярные выражения. В этом разделе описаны и компиляция, и кэширование.  
  
## <a name="compiled-regular-expressions"></a>Скомпилированные регулярные выражения  
 По умолчанию обработчик регулярных выражений компилирует регулярные выражения в последовательность внутренних инструкций (это коды высокого уровня, которые отличаются от языка MSIL). Когда обработчик выполняет регулярное выражение, он преобразовывает внутренние коды.  
  
 Если объект <xref:System.Text.RegularExpressions.Regex> создается с параметром <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType>, то регулярное выражение явно компилируется в язык MSIL вместо внутренних инструкций высокого уровня. Это позволяет JIT-компилятору платформы .NET преобразовывать выражение в изначальный машинный код данного объекта для повышения производительности.  
  
Однако созданный язык MSIL выгрузить невозможно. Выгрузить код можно, только выгрузив весь домен приложения (т. е. выгрузив весь код приложения). Фактически, если регулярное выражение компилируется с параметром <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType>, то использованные скомпилированным выражением ресурсы никогда не высвобождаются, даже если объект <xref:System.Text.RegularExpressions.Regex>, создавший это регулярное выражение, удаляется сборщиком мусора.  
  
 Соблюдайте осторожность и создавайте как можно меньше регулярных выражений, компилируемых с параметром <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType>, чтобы не расходовать слишком много ресурсов. Если в приложении необходимо использовать большое или неограниченное число регулярных выражений, их необходимо преобразовывать, а не компилировать. Если же вы намерены многократно использовать небольшое число регулярных выражений, компилируйте их с параметром <xref:System.Text.RegularExpressions.RegexOptions.Compiled?displayProperty=nameWithType>, чтобы повысить производительность. Также можно применить предварительно скомпилированные регулярные выражения. Все выражения можно скомпилировать в библиотеку DLL с помощью метода <xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A>, чтобы использовать их многократно. Этим вы избавитесь от компиляции во время выполнения, сохраняя скорость работы как при использовании скомпилированных регулярных выражений.  
  
## <a name="the-regular-expressions-cache"></a>Кэш регулярных выражений  
 Для повышения производительности обработчик регулярных выражений поддерживает кэш скомпилированных регулярных выражений на уровне приложения. Кэш хранит шаблоны регулярных выражений, которые используются только при вызове статических методов. (Шаблоны регулярных выражений, предоставляемые методами экземпляра, не кэшируются.) Это устраняет потребность в повторном разборе выражения в байт-код высокого уровня при каждом его использовании.  
  
 Максимальное число кэшированных регулярных выражений определяется значением `static` (`Shared` в Visual Basic) свойства <xref:System.Text.RegularExpressions.Regex.CacheSize%2A?displayProperty=nameWithType>. По умолчанию обработчик регулярных выражений кэширует до 15 скомпилированных регулярных выражений. Если число скомпилированных регулярных выражений превышает размер кэша, из него удаляется наиболее давнее по использованию регулярное выражение и кэшируется новое регулярное выражение.  
  
 Приложение может воспользоваться преимуществом заранее скомпилированных регулярных выражений одним из указанных далее двух способов.  
  
- Вы можете использовать статический метод объекта <xref:System.Text.RegularExpressions.Regex> для определения регулярного выражения. Если используется шаблон регулярного выражения, который уже был определен при вызове другого статического метода, обработчик регулярных выражений будет извлекать его из кэша. Если нет, обработчик скомпилирует регулярное выражение и добавит его в кэш.  
  
- Вы можете многократно использовать существующий объект <xref:System.Text.RegularExpressions.Regex> везде, где потребуется созданный его шаблон регулярного выражения.  
  
 Создание и быстрое уничтожение многочисленных объектов <xref:System.Text.RegularExpressions.Regex> — это очень затратный процесс, так как высоки издержки на создание объектов и компиляцию регулярных выражений. Для приложений, использующих большое количество разных регулярных выражений, производительность можно повысить путем вызова статических методов `Regex` и, возможно, путем увеличения размера кэша для регулярных выражений.  
  
## <a name="see-also"></a>См. также

- [Регулярные выражения .NET](../../../docs/standard/base-types/regular-expressions.md)
