---
title: Подстановки в регулярных выражениях
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- regular expressions, substitutions
- replacement patterns
- metacharacters, substitutions
- .NET Framework regular expressions, substitutions
- constructs, substitutions
- substitutions
ms.assetid: d1f52431-1c7d-4dc6-8792-6b988256892e
ms.openlocfilehash: 3562bd113ae4c9a3f721d8858a5d3625ef548d3a
ms.sourcegitcommit: 00aa62e2f469c2272a457b04e66b4cc3c97a800b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2020
ms.locfileid: "78160083"
---
# <a name="substitutions-in-regular-expressions"></a>Подстановки в регулярных выражениях
Подстановки — это языковые элементы, которые распознаются только в шаблонах замены. Они используют шаблон регулярного выражения для определения всего текста или его части, предназначенной для замены совпадающего текста во входной строке. Шаблон замены может включать одну или несколько подстановок вместе с литеральными символами. Для перегруженных версий метода <xref:System.Text.RegularExpressions.Regex.Replace%2A?displayProperty=nameWithType> , имеющих параметр `replacement` , и для метода <xref:System.Text.RegularExpressions.Match.Result%2A?displayProperty=nameWithType> предоставляются шаблоны замены. Эти методы заменяют совпавший шаблон шаблоном, определенным параметром `replacement` .  
  
 Платформа .NET Framework определяет элементы подстановки, перечисленные в следующей таблице.  
  
|Замена|Описание|  
|------------------|-----------------|  
|$ *число*|Включает в строку замены последнюю подстроку, соответствующую группе записи, которая идентифицируется как *number*, где *number* — десятичное значение. Дополнительные сведения см. в разделе [Подстановка нумерованной группы](#substituting-a-numbered-group).|  
|${ *name* }|Включает в строку замены последнюю подстроку, соответствующую именованной группе, обозначаемой как `(?<`*name*`> )` . Дополнительные сведения см. в разделе [Подстановка именованной группы](#substituting-a-named-group).|  
|$$|Включает один литерал "$" в строку замены. Дополнительные сведения см. в разделе [Подстановка символа "$"](#substituting-a--character).|  
|$&|Включает копию всего соответствия в строку замены. Дополнительные сведения см. в разделе [Подстановка всего соответствия](#substituting-the-entire-match).|  
|$\`|Включает весь текст входной строки до соответствия в строку замены. Дополнительные сведения см. в разделе [Подстановка текста до соответствия](#substituting-the-text-before-the-match).|  
|$'|Включает весь текст входной строки после соответствия в строку замены. Дополнительные сведения см. в разделе [Подстановка текста после соответствия](#substituting-the-text-after-the-match).|  
|$+|Включает последнюю записанную группу в строку замены. Дополнительные сведения см. в разделе [Подстановка последней записанной группы](#substituting-the-last-captured-group).|  
|$\_|Включает всю входную строку в строку замены. Дополнительные сведения см. в разделе [Замена всей входной строки](#substituting-the-entire-input-string).|  
  
## <a name="substitution-elements-and-replacement-patterns"></a>Элементы подстановки и шаблонов замены  
 В шаблонах замены распознается только одна специальная конструкция: подстановки. Ни один из остальных элементов языка регулярных выражений, включая escape-символы и точку (`.`), которая соответствует любому знаку, не поддерживается. Аналогичным образом, подставляемые элементы языка распознаются только в шаблонах замены и никогда не являются допустимыми в шаблоны регулярных выражений.  
  
 Единственный знак, который может встречаться в шаблоне регулярного выражения либо в подстановке, — это знак `$` , хотя он в разных случаях имеет разное значение. В шаблоне регулярного выражения `$` является привязкой, совпадающей с концом строки. В шаблоне замены `$` указывает начало подстановки.  
  
> [!NOTE]
> Для получения возможностей, подобных шаблону замены в регулярном выражении, используйте обратную ссылку. Дополнительные сведения об обратных ссылках см. в разделе [Конструкции обратных ссылок](../../../docs/standard/base-types/backreference-constructs-in-regular-expressions.md).  

## <a name="substituting-a-numbered-group"></a>Подстановка нумерованной группы  
 Языковой элемент `$`*number* включает последнюю подстроку, сопоставленную по группе записи *number* в строке замены, где *number* — это индекс группы записи. Например, шаблон замены `$1` указывает, что совпадающая подстрока будет заменена первой группой записи. Дополнительные сведения о нумерованных группах записи см. в разделе [Grouping Constructs](../../../docs/standard/base-types/grouping-constructs-in-regular-expressions.md).  
  
 Все цифры, указанные после `$` , интерпретируются как относящиеся к группе *number* . Если это не соответствует вашим намерениям, можно вместо этого подставить именованную группу. Например, можно использовать строку замены `${1}1` вместо `$11` , чтобы определить строку замены как значение первой записанной группы вместе с номером "1". Дополнительные сведения см. в разделе [Подстановка именованной группы](#substituting-a-named-group).  
  
 Группы записи, которым явно не назначены имена с помощью синтаксиса `(?<`*name*`>)` , нумеруются слева направо, начиная с единицы. Именованные группы также нумеруются слева направо, начиная с номера, превышающего индекс последней неименованной группы. Например, в регулярном выражении `(\w)(?<digit>\d)`индекс именованной группы `digit` — 2.  
  
 Если *number* не соответствует допустимой группе записи, определенной в шаблоне регулярного выражения, `$`*number* интерпретируется как последовательность литеральных символов, используемая для замены каждого соответствия.  
  
 В следующем примере подстановка `$`*number* используется для удаления символа валюты из десятичного значения. Она удаляет символы денежной единицы, найденные в начале или конце денежного значения, и распознает два наиболее распространенных десятичных разделителя ("." и ",").  
  
 [!code-csharp[Conceptual.RegEx.Language.Substitutions#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/numberedgroup1.cs#1)]
 [!code-vb[Conceptual.RegEx.Language.Substitutions#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/numberedgroup1.vb#1)]  
  
 Шаблон регулярного выражения `\p{Sc}*(\s?\d+[.,]?\d*)\p{Sc}*` определяется, как показано в следующей таблице.  
  
|Модель|Описание|  
|-------------|-----------------|  
|`\p{Sc}*`|Совпадение с нулем или более символами денежной единицы.|  
|`\s?`|Совпадение с нулем или одним символом пробела.|  
|`\d+`|Совпадение с одной или несколькими десятичными цифрами.|  
|`[.,]?`|Совпадение с нулем или одной точкой либо запятой.|  
|`\d*`|Соответствует нулю или нескольким десятичным числам.|  
|`(\s?\d+[.,]?\d*)`|Совпадение с пробелом, за которым следует одна или несколько десятичных цифр, после которых идет ноль или одна точка либо запятая, а за ними — ноль или более десятичных цифр. Это первая группа записи. Так как шаблон замены имеет вид `$1`, вызов метода <xref:System.Text.RegularExpressions.Regex.Replace%2A?displayProperty=nameWithType> заменяет всю совпадающую подстроку данной группой записи.|  

## <a name="substituting-a-named-group"></a>Подстановка именованной группы  
 Языковой элемент `${`*name*`}` замещает последнюю подстроку, сопоставленную по группе записи *name* , где *name* — это имя группы записи, определенной в языковом элементе `(?<`*name*`>)` . Дополнительные сведения об именованных группах записи см. в разделе [Grouping Constructs](../../../docs/standard/base-types/grouping-constructs-in-regular-expressions.md).  
  
 Если *name* не соответствует допустимой именованной группе записи, определенной в регулярном выражении, и состоит из цифр, то `${`*name*`}` интерпретируется как нумерованная группа.  
  
 Если *name* не соответствует ни допустимой именованной группе записи, ни допустимой нумерованной группе записи, определенной в шаблоне регулярного выражения, `${`*name*`}` интерпретируется как последовательность литеральных символов, используемая для замены каждого соответствия.  
  
 В следующем примере подстановка `${`*name*`}` используется для удаления символа валюты из десятичного значения. Она удаляет символы денежной единицы, найденные в начале или конце денежного значения, и распознает два наиболее распространенных десятичных разделителя ("." и ",").  
  
 [!code-csharp[Conceptual.RegEx.Language.Substitutions#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/namedgroup1.cs#2)]
 [!code-vb[Conceptual.RegEx.Language.Substitutions#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/namedgroup1.vb#2)]  
  
 Шаблон регулярного выражения `\p{Sc}*(?<amount>\s?\d[.,]?\d*)\p{Sc}*` определяется, как показано в следующей таблице.  
  
|Модель|Описание|  
|-------------|-----------------|  
|`\p{Sc}*`|Совпадение с нулем или более символами денежной единицы.|  
|`\s?`|Совпадение с нулем или одним символом пробела.|  
|`\d+`|Совпадение с одной или несколькими десятичными цифрами.|  
|`[.,]?`|Совпадение с нулем или одной точкой либо запятой.|  
|`\d*`|Соответствует нулю или нескольким десятичным числам.|  
|`(?<amount>\s?\d[.,]?\d*)`|Совпадение с пробелом, за которым следует одна или несколько десятичных цифр, после которых идет ноль или одна точка либо запятая, а за ними — ноль или более десятичных цифр. Это группа записи с именем `amount`. Так как шаблон замены имеет вид `${amount}`, вызов метода <xref:System.Text.RegularExpressions.Regex.Replace%2A?displayProperty=nameWithType> заменяет всю совпадающую подстроку данной группой записи.|  

## <a name="substituting-a--character"></a>Подстановка знака "$"  
 Подстановка `$$` вставляет символ литерала "$"в строку замены.  
  
 В следующем примере объект <xref:System.Globalization.NumberFormatInfo> используется для определения символа валюты для текущего языка и региональных параметров и его размещения в строке валюты. Затем он динамически создает как шаблон регулярного выражения, так и шаблон замены. Если пример выполняется на компьютере, где в качестве языка и региональных параметров задано значение «Английский — США» (en-US), будет создан шаблон регулярного выражения `\b(\d+)(\.(\d+))?` и шаблон замены `$$ $1$2`. Шаблон замены замещает совпавший текст символом валюты и пробелом после первой и второй записанной группы.  
  
 [!code-csharp[Conceptual.Regex.Language.Substitutions#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/dollarsign1.cs#8)]
 [!code-vb[Conceptual.Regex.Language.Substitutions#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/dollarsign1.vb#8)]  
  
 Шаблон регулярного выражения `\b(\d+)(\.(\d+))?` определяется, как показано в следующей таблице.  
  
|Модель|Описание|  
|-------------|-----------------|  
|`\b`|Начало соответствия в начале границы слова.|  
|`(\d+)`|Совпадение с одной или несколькими десятичными цифрами. Это первая группа записи.|  
|`\.`|Совпадение с точкой (десятичным разделителем).|  
|`(\d+)`|Совпадение с одной или несколькими десятичными цифрами. Это третья группа записи.|  
|`(\.(\d+))?`|Совпадение с нулем или одним вхождением точки, за которой следует одна или несколько десятичных цифр. Это вторая группа записи.|  

## <a name="substituting-the-entire-match"></a>Подстановка всего соответствия  
 Подстановка `$&` включает все соответствие в строку замены. Часто она используется для добавления подстроки в начало или в конец совпадающей строки. Например, шаблон замены `($&)` добавляет скобки в начало и в конец каждого соответствия. Если нет соответствия, подстановка `$&` не оказывает влияния.  
  
 В следующем примере используется подстановка `$&` для добавления кавычек в начало и в конец названий книг, хранящихся в строковом массиве.  
  
 [!code-csharp[Conceptual.RegEx.Language.Substitutions#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/entirematch1.cs#3)]
 [!code-vb[Conceptual.RegEx.Language.Substitutions#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/entirematch1.vb#3)]  
  
 Шаблон регулярного выражения `^(\w+\s?)+$` определяется, как показано в следующей таблице.  
  
|Модель|Описание|  
|-------------|-----------------|  
|`^`|Начало соответствия в начале входной строки.|  
|`(\w+\s?)+`|Выделяет один или несколько раз шаблон из одного или нескольких словообразующих символов, за которыми следует ноль или один символ пробела.|  
|`$`|Соответствует концу входной строки.|  
  
 Шаблон замены `"$&"` добавляет литеральные кавычки в начало и в конец каждого соответствия.  

## <a name="substituting-the-text-before-the-match"></a>Подстановка текста до соответствия  
 Подстановка ``$` `` заменяет совпадающую строку всей входной строкой до соответствия. То есть она дублирует входную строку вплоть до соответствия, удаляя совпадающий текст. Любой текст, следующий за совпадающим текстом, не изменяется в результирующей строке. Если во входной строке несколько соответствий, текст замены выводится из исходной входной строки, а не из строки, в которой текст был заменен более ранними совпадениями. \(Иллюстрация приведена в примере.\) Если нет соответствия, подстановка ``$` `` не оказывает влияния.  
  
 В следующем примере шаблон регулярного выражения `\d+` используется для сопоставления последовательности из одной или нескольких цифр десятичного числа во входной строке. Строка замены ``$` `` заменяет эти цифры текстом, который предшествует совпадению.  
  
 [!code-csharp[Conceptual.Regex.Language.Substitutions#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/before1.cs#4)]
 [!code-vb[Conceptual.Regex.Language.Substitutions#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/before1.vb#4)]  
  
 В этом примере входная строка `"aa1bb2cc3dd4ee5"` содержит пять совпадений. В следующей таблице показано, как подстановка ``$` `` вызывает замену обработчиком регулярных выражений каждого соответствия во входной строке. Вставленный текст отображается в столбце результатов полужирным шрифтом.  
  
|Соответствует|Положение|Строка до соответствия|Результирующая строка|  
|-----------|--------------|-------------------------|-------------------|  
|1|2|aa|aa**aa**bb2cc3dd4ee5|  
|2|5|aa1bb|aaaabb**aa1bb**cc3dd4ee5|  
|3|8|aa1bb2cc|aaaabbaa1bbcc**aa1bb2cc**dd4ee5|  
|4|11|aa1bb2cc3dd|aaaabbaa1bbccaa1bb2ccdd**aa1bb2cc3dd**ee5|  
|5|14|aa1bb2cc3dd4ee|aaaabbaa1bbccaa1bb2ccddaa1bb2cc3ddee**aa1bb2cc3dd4ee**|

## <a name="substituting-the-text-after-the-match"></a>Подстановка текста после соответствия  
 Подстановка `$'` заменяет совпадающую строку всей входной строкой после соответствия. То есть входная строка после соответствия дублируется с удалением совпадающего текста. Любой текст, который предшествует совпадающему тексту, не изменяется в результирующей строке. Если нет соответствия, подстановка  `$'` не оказывает влияния.  
  
 В следующем примере шаблон регулярного выражения `\d+` используется для сопоставления последовательности из одной или нескольких цифр десятичного числа во входной строке. Строка замены `$'` заменяет эти цифры текстом, который следует за соответствием.  
  
 [!code-csharp[Conceptual.Regex.Language.Substitutions#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/after1.cs#5)]
 [!code-vb[Conceptual.Regex.Language.Substitutions#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/after1.vb#5)]  
  
 В этом примере входная строка `"aa1bb2cc3dd4ee5"` содержит пять совпадений. В следующей таблице показано, как подстановка `$'` вызывает замену обработчиком регулярных выражений каждого соответствия во входной строке. Вставленный текст отображается в столбце результатов полужирным шрифтом.  
  
|Соответствует|Положение|Строка после соответствия|Результирующая строка|  
|-----------|--------------|------------------------|-------------------|  
|1|2|bb2cc3dd4ee5|aa**bb2cc3dd4ee5**bb2cc3dd4ee5|  
|2|5|cc3dd4ee5|aabb2cc3dd4ee5bb**cc3dd4ee5**cc3dd4ee5|  
|3|8|dd4ee5|aabb2cc3dd4ee5bbcc3dd4ee5cc**dd4ee5**dd4ee5|  
|4|11|ee5|aabb2cc3dd4ee5bbcc3dd4ee5ccdd4ee5dd**ee5**ee5|  
|5|14|<xref:System.String.Empty?displayProperty=nameWithType>|aabb2cc3dd4ee5bbcc3dd4ee5ccdd4ee5ddee5ee|  

## <a name="substituting-the-last-captured-group"></a>Подстановка последней записанной группы  
 Подстановка `$+` заменяет совпадающую строку всей последней группой записи. Если группы записи отсутствуют или значение последней захваченной группы равно <xref:System.String.Empty?displayProperty=nameWithType>, подстановка `$+` не оказывает влияния.  
  
 В следующем примере в строке определяются повторяющиеся слова и используется подстановка `$+` для их замены одним вхождением слова. Параметр <xref:System.Text.RegularExpressions.RegexOptions.IgnoreCase?displayProperty=nameWithType> позволяет  убедиться, что слова, отличающиеся регистром, но идентичные во всем остальном, считаются дубликатами.  
  
 [!code-csharp[Conceptual.Regex.Language.Substitutions#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/lastmatch1.cs#6)]
 [!code-vb[Conceptual.Regex.Language.Substitutions#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/lastmatch1.vb#6)]  
  
 Шаблон регулярного выражения `\b(\w+)\s\1\b` определяется, как показано в следующей таблице.  
  
|Модель|Описание|  
|-------------|-----------------|  
|`\b`|Совпадение должно начинаться на границе слова.|  
|`(\w+)`|Совпадение с одним или несколькими символами слова. Это первая группа записи.|  
|`\s`|Соответствует пробелу.|  
|`\1`|Соответствует первой группе записи.|  
|`\b`|Совпадение должно заканчиваться на границе слова.|  

## <a name="substituting-the-entire-input-string"></a>Замена всей входной строки  
 Подстановка `$_` заменяет совпадающую строку всей входной строкой. То есть совпадающий текст удаляется и заменяется всей строкой, включая совпадающий текст.  
  
 В следующем примере сопоставляется одна или несколько цифр десятичного числа во входной строке. При этом используется подстановка `$_` для их замены входной строкой.  
  
 [!code-csharp[Conceptual.Regex.Language.Substitutions#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.regex.language.substitutions/cs/entire1.cs#7)]
 [!code-vb[Conceptual.Regex.Language.Substitutions#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.regex.language.substitutions/vb/entire1.vb#7)]  
  
 В этом примере входная строка `"ABC123DEF456"` содержит два совпадения. В следующей таблице показано, как подстановка `$_` вызывает замену обработчиком регулярных выражений каждого соответствия во входной строке. Вставленный текст отображается в столбце результатов полужирным шрифтом.  
  
|Соответствует|Положение|Соответствие|Результирующая строка|  
|-----------|--------------|-----------|-------------------|  
|1|3|123|ABC**ABC123DEF456**DEF456|  
|2|5|456|ABCABC123DEF456DEF**ABC123DEF456**|  
  
## <a name="see-also"></a>См. также раздел

- [Элементы языка регулярных выражений — краткий справочник](../../../docs/standard/base-types/regular-expression-language-quick-reference.md)
