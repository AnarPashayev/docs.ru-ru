---
title: Присоединенные и отсоединенные дочерние задачи
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, child tasks
ms.assetid: c95788bf-90a6-4e96-b7bc-58e36a228cc5
ms.openlocfilehash: 8f15ee4f136e3e2df1a4e1c7683467f2a4bc9bc0
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73123187"
---
# <a name="attached-and-detached-child-tasks"></a><span data-ttu-id="98082-102">Присоединенные и отсоединенные дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-102">Attached and Detached Child Tasks</span></span>
<span data-ttu-id="98082-103">*Дочерняя задача* (или *вложенная задача*) — это экземпляр <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, создаваемый в пользовательском делегате другой задачи, которая называется *родительской задачей*.</span><span class="sxs-lookup"><span data-stu-id="98082-103">A *child task* (or *nested task*) is a <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> instance that is created in the user delegate of another task, which is known as the *parent task*.</span></span> <span data-ttu-id="98082-104">Дочерняя задача может быть отсоединенной или присоединенной.</span><span class="sxs-lookup"><span data-stu-id="98082-104">A child task can be either detached or attached.</span></span> <span data-ttu-id="98082-105">*Отсоединенная дочерняя задача* — это задача, которая выполняется независимо от своего родительского объекта.</span><span class="sxs-lookup"><span data-stu-id="98082-105">A *detached child task* is a task that executes independently of its parent.</span></span> <span data-ttu-id="98082-106">*Присоединенная дочерняя задача* — это вложенная задача, созданная с параметром <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>, родительский объект которой не запрещает ее присоединение явно или по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="98082-106">An *attached child task* is a nested task that is created with the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option whose parent does not explicitly or by default prohibit it from being attached.</span></span> <span data-ttu-id="98082-107">Задача может создавать любое количество присоединенных и отсоединенных дочерних задач, ограничиваемое только системными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="98082-107">A task may create any number of attached and detached child tasks, limited only by system resources.</span></span>  
  
 <span data-ttu-id="98082-108">В следующей таблице перечислены основные различия между двумя видами дочерних задач.</span><span class="sxs-lookup"><span data-stu-id="98082-108">The following table lists the basic differences between the two kinds of child tasks.</span></span>  
  
|<span data-ttu-id="98082-109">Категория</span><span class="sxs-lookup"><span data-stu-id="98082-109">Category</span></span>|<span data-ttu-id="98082-110">Отсоединенные дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-110">Detached child tasks</span></span>|<span data-ttu-id="98082-111">Присоединенные дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-111">Attached child tasks</span></span>|  
|--------------|--------------------------|--------------------------|  
|<span data-ttu-id="98082-112">Родительский объект ожидает завершение дочерних задач.</span><span class="sxs-lookup"><span data-stu-id="98082-112">Parent waits for child tasks to complete.</span></span>|<span data-ttu-id="98082-113">Нет</span><span class="sxs-lookup"><span data-stu-id="98082-113">No</span></span>|<span data-ttu-id="98082-114">Yes</span><span class="sxs-lookup"><span data-stu-id="98082-114">Yes</span></span>|  
|<span data-ttu-id="98082-115">Родительский объект распространяет исключения, созданные дочерними задачами.</span><span class="sxs-lookup"><span data-stu-id="98082-115">Parent propagates exceptions thrown by child tasks.</span></span>|<span data-ttu-id="98082-116">Нет</span><span class="sxs-lookup"><span data-stu-id="98082-116">No</span></span>|<span data-ttu-id="98082-117">Yes</span><span class="sxs-lookup"><span data-stu-id="98082-117">Yes</span></span>|  
|<span data-ttu-id="98082-118">Состояние родительского объекта зависит от состояния дочернего объекта.</span><span class="sxs-lookup"><span data-stu-id="98082-118">Status of parent depends on status of child.</span></span>|<span data-ttu-id="98082-119">Нет</span><span class="sxs-lookup"><span data-stu-id="98082-119">No</span></span>|<span data-ttu-id="98082-120">Yes</span><span class="sxs-lookup"><span data-stu-id="98082-120">Yes</span></span>|  
  
 <span data-ttu-id="98082-121">В большинстве случаев рекомендуется использовать отсоединенные дочерние задачи, поскольку их связи с другими задачами менее сложные.</span><span class="sxs-lookup"><span data-stu-id="98082-121">In most scenarios, we recommend that you use detached child tasks, because their relationships with other tasks are less complex.</span></span> <span data-ttu-id="98082-122">Именно поэтому задачи, создаваемые в родительских задачах, по умолчанию отсоединены, и чтобы создать присоединенную дочернюю задачу, необходимо явно указать параметр <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="98082-122">That is why tasks created inside parent tasks are detached by default, and you must explicitly specify the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option to create an attached child task.</span></span>  
  
## <a name="detached-child-tasks"></a><span data-ttu-id="98082-123">Отсоединенные дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-123">Detached child tasks</span></span>  
 <span data-ttu-id="98082-124">Несмотря на то что дочерняя задача создается родительской задачей, по умолчанию она не зависит от родительской задачи.</span><span class="sxs-lookup"><span data-stu-id="98082-124">Although a child task is created by a parent task, by default it is independent of the parent task.</span></span> <span data-ttu-id="98082-125">В следующем примере родительская задача создает одну простую дочернюю задачу.</span><span class="sxs-lookup"><span data-stu-id="98082-125">In the following example, a parent task creates one simple child task.</span></span> <span data-ttu-id="98082-126">Если вы несколько раз выполните этот пример кода, то заметите, что выходные данные примера отличаются от показанных здесь и что выходные данные могут изменяться после каждого выполнения кода.</span><span class="sxs-lookup"><span data-stu-id="98082-126">If you run the example code multiple times, you may notice that the output from the example differs from that shown, and also that the output may change each time you run the code.</span></span> <span data-ttu-id="98082-127">Это происходит потому, что родительская задача и дочерние задачи выполняются независимо друг от друга; дочерняя задача является отсоединенной.</span><span class="sxs-lookup"><span data-stu-id="98082-127">This occurs because the parent task and child tasks execute independently of each other; the child is a detached task.</span></span> <span data-ttu-id="98082-128">В этом примере ожидается только выполнение родительской задачи, а дочерняя задача может не выполниться или выполниться прежде, чем завершится консольное приложение.</span><span class="sxs-lookup"><span data-stu-id="98082-128">The example waits only for the parent task to complete, and the child task may not execute or complete before the console app terminates.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/nested1.cs#1)]
 [!code-vb[TPL_ChildTasks#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/nested1.vb#1)]  
  
 <span data-ttu-id="98082-129">Если дочерняя задача представлена объектом <xref:System.Threading.Tasks.Task%601>, а не объектом <xref:System.Threading.Tasks.Task>, вы можете обеспечить, чтобы родительская задача ожидала завершение дочерней задачи, обратившись к свойству <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> дочернего объекта, даже если это отсоединенная дочерняя задача.</span><span class="sxs-lookup"><span data-stu-id="98082-129">If the child task is represented by a <xref:System.Threading.Tasks.Task%601> object rather than a <xref:System.Threading.Tasks.Task> object, you can ensure that the parent task will wait for the child to complete by accessing the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the child even if it is a detached child task.</span></span> <span data-ttu-id="98082-130">Свойство <xref:System.Threading.Tasks.Task%601.Result%2A> выполняет блокировку до завершения его задачи, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="98082-130">The <xref:System.Threading.Tasks.Task%601.Result%2A> property blocks until its task completes, as the following example shows.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/childtasks.cs#4)]
 [!code-vb[TPL_ChildTasks#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/tpl_childtasks.vb#4)]  
  
## <a name="attached-child-tasks"></a><span data-ttu-id="98082-131">Присоединенные дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-131">Attached child tasks</span></span>  
 <span data-ttu-id="98082-132">В отличие от отсоединенных дочерних задач, вложенные дочерние задачи полностью синхронизируются с родительским объектом.</span><span class="sxs-lookup"><span data-stu-id="98082-132">Unlike detached child tasks, attached child tasks are closely synchronized with the parent.</span></span> <span data-ttu-id="98082-133">Вы можете изменить отсоединенную дочернюю задачу из предыдущего примера на присоединенную дочернюю задачу с помощью параметра <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> в инструкции создания задачи, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="98082-133">You can change the detached child task in the previous example to an attached child task by using the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option in the task creation statement, as shown in the following example.</span></span> <span data-ttu-id="98082-134">В этом коде присоединенная дочерняя задача завершается перед родительской задачей.</span><span class="sxs-lookup"><span data-stu-id="98082-134">In this code, the attached child task completes before its parent.</span></span> <span data-ttu-id="98082-135">В результате выходные данные из этого примера остаются неизменными после каждого выполнения кода.</span><span class="sxs-lookup"><span data-stu-id="98082-135">As a result, the output from the example is the same each time you run the code.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1.cs#2)]
 [!code-vb[TPL_ChildTasks#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1.vb#2)]  
  
 <span data-ttu-id="98082-136">Присоединенные дочерние задачи можно использовать для создания полностью синхронизированных графиков асинхронных операций.</span><span class="sxs-lookup"><span data-stu-id="98082-136">You can use attached child tasks to create tightly synchronized graphs of asynchronous operations.</span></span>  
  
 <span data-ttu-id="98082-137">Однако дочернюю задачу можно присоединить к ее родительской задаче только в том случае, если эта родительская задача не запрещает присоединенные дочерние задачи.</span><span class="sxs-lookup"><span data-stu-id="98082-137">However, a child task can attach to its parent only if its parent does not prohibit attached child tasks.</span></span> <span data-ttu-id="98082-138">Родительские задачи могут явно запрещать присоединение к ним дочерних задач путем указания параметра <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> в конструкторе класса родительской задачи или с помощью метода <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="98082-138">Parent tasks can explicitly prevent child tasks from attaching to them by specifying the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option in the parent task's class constructor or the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="98082-139">Родительские задачи неявно запрещают присоединение к ним дочерних задач, если они создаются путем вызова метода <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="98082-139">Parent tasks implicitly prevent child tasks from attaching to them if they are created by calling the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="98082-140">Это показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="98082-140">The following example illustrates this.</span></span> <span data-ttu-id="98082-141">Он аналогичен предыдущему примеру, за исключением того, что родительская задача создается путем вызова метода <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=nameWithType> вместо метода <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="98082-141">It is identical to the previous example, except that the parent task is created by calling the <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=nameWithType> method rather than the <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="98082-142">Поскольку дочерняя задача не может быть присоединена к родительской задаче, выходные данные этого примера будут непредсказуемыми.</span><span class="sxs-lookup"><span data-stu-id="98082-142">Because the child task is not able to attach to its parent, the output from the example is unpredictable.</span></span> <span data-ttu-id="98082-143">Поскольку параметры создания задачи по умолчанию для перегрузок <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> включают параметр <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>, этот пример является функциональным эквивалентом первого примера в разделе «Отсоединенные дочерние задачи».</span><span class="sxs-lookup"><span data-stu-id="98082-143">Because the default task creation options for the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> overloads include <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>, this example is functionally equivalent to the first example in the "Detached child tasks" section.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1a.cs#3)]
 [!code-vb[TPL_ChildTasks#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1a.vb#3)]  
  
## <a name="exceptions-in-child-tasks"></a><span data-ttu-id="98082-144">Исключения в дочерних задачах</span><span class="sxs-lookup"><span data-stu-id="98082-144">Exceptions in child tasks</span></span>  
 <span data-ttu-id="98082-145">Если отсоединенная дочерняя задача вызывает исключение, это исключение должно наблюдаться или обрабатываться непосредственно в родительской задаче, как и в случае любой не вложенной задачи.</span><span class="sxs-lookup"><span data-stu-id="98082-145">If a detached child task throws an exception, that exception must be observed or handled directly in the parent task just as with any non-nested task.</span></span> <span data-ttu-id="98082-146">Если присоединенная дочерняя задача создает исключение, оно автоматически распространяется в родительскую задачу и обратно в поток, который ожидает или пытается получить доступ к свойству <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> задачи.</span><span class="sxs-lookup"><span data-stu-id="98082-146">If an attached child task throws an exception, the exception is automatically propagated to the parent task and back to the thread that waits or tries to access the task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="98082-147">Таким образом, используя присоединенные дочерние задачи, можно обрабатывать все исключения всего лишь в одной точке в вызове метода <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> в вызывающем потоке.</span><span class="sxs-lookup"><span data-stu-id="98082-147">Therefore, by using attached child tasks, you can handle all exceptions at just one point in the call to <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> on the calling thread.</span></span> <span data-ttu-id="98082-148">Дополнительные сведения см. в разделе [Обработка исключений](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="98082-148">For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span></span>  
  
## <a name="cancellation-and-child-tasks"></a><span data-ttu-id="98082-149">Отмена и дочерние задачи</span><span class="sxs-lookup"><span data-stu-id="98082-149">Cancellation and child tasks</span></span>  
 <span data-ttu-id="98082-150">Отмена задачи выполняется совместно.</span><span class="sxs-lookup"><span data-stu-id="98082-150">Task cancellation is cooperative.</span></span> <span data-ttu-id="98082-151">А именно, чтобы можно было отменить задачу, каждая присоединенная или отсоединенная дочерняя задача должна отслеживать состояние токена отмены.</span><span class="sxs-lookup"><span data-stu-id="98082-151">That is, to be cancelable, every attached or detached child task must monitor the status of the cancellation token.</span></span> <span data-ttu-id="98082-152">Если нужно отменить родительскую задачу и все ее дочерние задачи с помощью одного запроса отмены, передайте один и тот же токен в качестве аргумента во все задачи и предоставьте в каждую задачу логику для ответа на запрос в каждой задаче.</span><span class="sxs-lookup"><span data-stu-id="98082-152">If you want to cancel a parent and all its children by using one cancellation request, you pass the same token as an argument to all tasks and provide in each task the logic to respond to the request in each task.</span></span> <span data-ttu-id="98082-153">Дополнительные сведения см. в разделах [Отмена задач](../../../docs/standard/parallel-programming/task-cancellation.md) и [Практическое руководство. Отмена задачи и ее дочерних элементов](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="98082-153">For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md) and [How to: Cancel a Task and Its Children](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md).</span></span>  
  
### <a name="when-the-parent-cancels"></a><span data-ttu-id="98082-154">Когда родительская задача отменяется</span><span class="sxs-lookup"><span data-stu-id="98082-154">When the parent cancels</span></span>  
 <span data-ttu-id="98082-155">Если родительская задача отменяет сама себя до запуска ее дочерней задачи, то дочерняя задача никогда не запускается.</span><span class="sxs-lookup"><span data-stu-id="98082-155">If a parent cancels itself before its child task is started, the child never starts.</span></span> <span data-ttu-id="98082-156">Если родительская задача отменяет сама себя после запуска ее дочерней задачи, то дочерняя задача выполняется до завершения, если в ней отсутствует собственная логика отмены.</span><span class="sxs-lookup"><span data-stu-id="98082-156">If a parent cancels itself after its child task has already started, the child runs to completion unless it has its own cancellation logic.</span></span> <span data-ttu-id="98082-157">Дополнительные сведения см. в разделе [Отмена задач](../../../docs/standard/parallel-programming/task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="98082-157">For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).</span></span>  
  
### <a name="when-a-detached-child-task-cancels"></a><span data-ttu-id="98082-158">Когда отменяется отсоединенная дочерняя задача</span><span class="sxs-lookup"><span data-stu-id="98082-158">When a detached child task cancels</span></span>  
 <span data-ttu-id="98082-159">Если отсоединенная дочерняя задача отменяет сама себя, используя тот же токен, переданный в родительскую задачу, и родительская задача не ожидает дочернюю задачу, то исключение не распространяется, поскольку оно трактуется как неопасная совместная отмена.</span><span class="sxs-lookup"><span data-stu-id="98082-159">If a detached child task cancels itself by using the same token that was passed to the parent, and the parent does not wait for the child task, no exception is propagated, because the exception is treated as benign cooperation cancellation.</span></span> <span data-ttu-id="98082-160">Это происходит так же, как и в случае любой задачи верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="98082-160">This behavior is the same as that of any top-level task.</span></span>  
  
### <a name="when-an-attached-child-task-cancels"></a><span data-ttu-id="98082-161">Когда отменяется присоединенная дочерняя задача</span><span class="sxs-lookup"><span data-stu-id="98082-161">When an attached child task cancels</span></span>  
 <span data-ttu-id="98082-162">Если присоединенная дочерняя задача отменяет саму себя, используя тот же токен, который был передан в ее родительскую задачу, <xref:System.Threading.Tasks.TaskCanceledException> распространяется в присоединенный поток в объекте <xref:System.AggregateException>.</span><span class="sxs-lookup"><span data-stu-id="98082-162">When an attached child task cancels itself by using the same token that was passed to its parent task, a <xref:System.Threading.Tasks.TaskCanceledException> is propagated to the joining thread inside an <xref:System.AggregateException>.</span></span> <span data-ttu-id="98082-163">Вы должны ожидать родительскую задачу, чтобы можно было обработать все неопасные исключения в дополнение ко всем исключениям с ошибкой, которые распространяются вверх по графу присоединенных дочерних задач.</span><span class="sxs-lookup"><span data-stu-id="98082-163">You must wait for the parent task so that you can handle all benign exceptions in addition to all faulting exceptions that are propagated up through a graph of attached child tasks.</span></span>  
  
 <span data-ttu-id="98082-164">Дополнительные сведения см. в разделе [Обработка исключений](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="98082-164">For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span></span>  
  
## <a name="preventing-a-child-task-from-attaching-to-its-parent"></a><span data-ttu-id="98082-165">Запрет присоединения дочерней задачи к ее родителю</span><span class="sxs-lookup"><span data-stu-id="98082-165">Preventing a child task from attaching to its parent</span></span>  
 <span data-ttu-id="98082-166">Необработанное исключение, вызванное дочерней задачей, распространяется в родительскую задачу.</span><span class="sxs-lookup"><span data-stu-id="98082-166">An unhandled exception that is thrown by a child task is propagated to the parent task.</span></span> <span data-ttu-id="98082-167">Вы можете использовать это поведение, чтобы наблюдать за всеми исключениями дочерних задач в одной корневой задаче, вместо того чтобы перемещаться по дереву задач.</span><span class="sxs-lookup"><span data-stu-id="98082-167">You can use this behavior to observe all child task exceptions from one root task instead of traversing a tree of tasks.</span></span> <span data-ttu-id="98082-168">Однако распространение исключений может привести к проблемам, если родительская задача не ожидает присоединение из другого кода.</span><span class="sxs-lookup"><span data-stu-id="98082-168">However, exception propagation can be problematic when a parent task does not expect attachment from other code.</span></span> <span data-ttu-id="98082-169">Например, рассмотрим приложение, которое вызывает сторонний компонент библиотеки из объекта <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="98082-169">For example, consider an app that calls a third-party library component from a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="98082-170">Если сторонний компонент библиотеки также создает объект <xref:System.Threading.Tasks.Task> и задает <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>, чтобы присоединить его к родительской задаче, то все необработанные исключения, возникающие в дочерней задаче, распространяются в родительскую задачу.</span><span class="sxs-lookup"><span data-stu-id="98082-170">If the third-party library component also creates a <xref:System.Threading.Tasks.Task> object and specifies <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> to attach it to the parent task, any unhandled exceptions that occur in the child task propagate to the parent.</span></span> <span data-ttu-id="98082-171">Это может привести к непредвиденному поведению в основном приложении.</span><span class="sxs-lookup"><span data-stu-id="98082-171">This could lead to unexpected behavior in the main app.</span></span>  
  
 <span data-ttu-id="98082-172">Чтобы запретить присоединение к родительской задаче дочерних задач, укажите параметр <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> при создании родительской задачи <xref:System.Threading.Tasks.Task> или объекта <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="98082-172">To prevent a child task from attaching to its parent task, specify the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option when you create the parent <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object.</span></span> <span data-ttu-id="98082-173">Если задача пытается присоединиться к родительской, а родительская задача задана с параметром <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>, то дочерней задаче не удастся присоединиться к родительской задаче, и она будет выполняться в точности так, как если бы параметр <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> не был указан.</span><span class="sxs-lookup"><span data-stu-id="98082-173">When a task tries to attach to its parent and the parent specifies the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option, the child task will not be able to attach to a parent and will execute just as if the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option was not specified.</span></span>  
  
 <span data-ttu-id="98082-174">Можно также запрещать присоединение дочерней задачи к ее родителю, когда дочерняя задача не завершается своевременно.</span><span class="sxs-lookup"><span data-stu-id="98082-174">You might also want to prevent a child task from attaching to its parent when the child task does not finish in a timely manner.</span></span> <span data-ttu-id="98082-175">Поскольку родительская задача не завершается, пока не будут завершены все ее дочерние задачи, дочерняя задача с длительным временем выполнения может привести к снижению производительности всего приложения.</span><span class="sxs-lookup"><span data-stu-id="98082-175">Because a parent task does not finish until all child tasks finish, a long-running child task can cause the overall app to perform poorly.</span></span> <span data-ttu-id="98082-176">Пример, в котором показано, как повысить производительность приложения, предотвращая присоединение задачи к ее родительской задаче, см. в разделе [Практическое руководство. Запрет присоединения дочерней задачи к ее родительской задаче](../../../docs/standard/parallel-programming/how-to-prevent-a-child-task-from-attaching-to-its-parent.md).</span><span class="sxs-lookup"><span data-stu-id="98082-176">For an example that shows how to improve app performance by preventing a task from attaching to its parent task, see [How to: Prevent a Child Task from Attaching to its Parent](../../../docs/standard/parallel-programming/how-to-prevent-a-child-task-from-attaching-to-its-parent.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="98082-177">См. также</span><span class="sxs-lookup"><span data-stu-id="98082-177">See also</span></span>

- [<span data-ttu-id="98082-178">Параллельное программирование</span><span class="sxs-lookup"><span data-stu-id="98082-178">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)
- [<span data-ttu-id="98082-179">Параллелизм данных</span><span class="sxs-lookup"><span data-stu-id="98082-179">Data Parallelism</span></span>](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)
