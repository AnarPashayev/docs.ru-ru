---
title: Параллелизм данных (библиотека параллельных задач)
description: Сведения о том, как библиотека параллельных задач (TPL) поддерживает параллелизм данных для одновременного выполнения одной и той же операции для элементов в исходной коллекции или массиве в .NET.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parallelism, data
ms.assetid: 3f05f33f-f1da-4b16-81c2-9ceff1bef449
ms.openlocfilehash: 513c5dde1526a8a21f68171f304b245d0a34f563
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594469"
---
# <a name="data-parallelism-task-parallel-library"></a><span data-ttu-id="7136a-103">Параллелизм данных (библиотека параллельных задач)</span><span class="sxs-lookup"><span data-stu-id="7136a-103">Data Parallelism (Task Parallel Library)</span></span>
<span data-ttu-id="7136a-104">Понятие *Параллелизм данных* относится к сценариям, в которых одна и та же операция выполняется одновременно (то есть параллельно) для элементов в исходной коллекции или массиве.</span><span class="sxs-lookup"><span data-stu-id="7136a-104">*Data parallelism* refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array.</span></span> <span data-ttu-id="7136a-105">В параллельных операциях с данными исходная коллекция секционируются таким образом, чтобы несколько потоков могли одновременно работать в разных сегментах.</span><span class="sxs-lookup"><span data-stu-id="7136a-105">In data parallel operations, the source collection is partitioned so that multiple threads can operate on different segments concurrently.</span></span>  
  
 <span data-ttu-id="7136a-106">Библиотека параллельных задач (TPL) поддерживает параллелизм данных с помощью класса <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="7136a-106">The Task Parallel Library (TPL) supports data parallelism through the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="7136a-107">Этот класс предоставляет параллельные реализации на основе методов циклов [for](../../csharp/language-reference/keywords/for.md) и [foreach](../../csharp/language-reference/keywords/foreach-in.md) (`For` и `For Each` в Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="7136a-107">This class provides method-based parallel implementations of [for](../../csharp/language-reference/keywords/for.md) and [foreach](../../csharp/language-reference/keywords/foreach-in.md) loops (`For` and `For Each` in Visual Basic).</span></span> <span data-ttu-id="7136a-108">Вы пишете логику цикла для <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> или <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> в значительной степени так же, как пишете последовательный цикл.</span><span class="sxs-lookup"><span data-stu-id="7136a-108">You write the loop logic for a <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> loop much as you would write a sequential loop.</span></span> <span data-ttu-id="7136a-109">Нет необходимости создавать потоки или очередь рабочих элементов.</span><span class="sxs-lookup"><span data-stu-id="7136a-109">You do not have to create threads or queue work items.</span></span> <span data-ttu-id="7136a-110">В базовых циклах нет необходимости применять блокировки.</span><span class="sxs-lookup"><span data-stu-id="7136a-110">In basic loops, you do not have to take locks.</span></span> <span data-ttu-id="7136a-111">Библиотека параллельных задач обрабатывает все низкоуровневые работы.</span><span class="sxs-lookup"><span data-stu-id="7136a-111">The TPL handles all the low-level work for you.</span></span> <span data-ttu-id="7136a-112">Чтобы узнать больше об использовании <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> и <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, загрузите документ [Шаблоны параллельного программирования: описание и применение в .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span><span class="sxs-lookup"><span data-stu-id="7136a-112">For in-depth information about the use of <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, download the document [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span> <span data-ttu-id="7136a-113">В следующем примере кода показан простой цикл `foreach` и его параллельный эквивалент.</span><span class="sxs-lookup"><span data-stu-id="7136a-113">The following code example shows a simple `foreach` loop and its parallel equivalent.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7136a-114">В этой документации для определения делегатов в библиотеке параллельных задач используются лямбда-выражения.</span><span class="sxs-lookup"><span data-stu-id="7136a-114">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="7136a-115">Если вы не знакомы с лямбда-выражениями в C# или Visual Basic, см. раздел [Лямбда-выражения в PLINQ и TPL](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="7136a-115">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>  
  
 [!code-csharp[TPL#20](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#20)]
 [!code-vb[TPL#20](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#20)]  
  
 <span data-ttu-id="7136a-116">При выполнении параллельного цикла библиотека параллельных задач разделяет источник данных, чтобы цикл мог одновременно работать в нескольких частях.</span><span class="sxs-lookup"><span data-stu-id="7136a-116">When a parallel loop runs, the TPL partitions the data source so that the loop can operate on multiple parts concurrently.</span></span> <span data-ttu-id="7136a-117">В фоне планировщик заданий разделяет задачу исходя из системных ресурсов и рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7136a-117">Behind the scenes, the Task Scheduler partitions the task based on system resources and workload.</span></span> <span data-ttu-id="7136a-118">По возможности планировщик перераспределяет работу по нескольким потокам и процессорам, если рабочая нагрузка становится несбалансированной.</span><span class="sxs-lookup"><span data-stu-id="7136a-118">When possible, the scheduler redistributes work among multiple threads and processors if the workload becomes unbalanced.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7136a-119">Можно также указать собственный пользовательский разделитель или планировщик.</span><span class="sxs-lookup"><span data-stu-id="7136a-119">You can also supply your own custom partitioner or scheduler.</span></span> <span data-ttu-id="7136a-120">Дополнительные сведения см. в разделах [Пользовательские разделители для PLINQ и TPL](custom-partitioners-for-plinq-and-tpl.md) и [Планировщики задач](xref:System.Threading.Tasks.TaskScheduler).</span><span class="sxs-lookup"><span data-stu-id="7136a-120">For more information, see [Custom Partitioners for PLINQ and TPL](custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).</span></span>  
  
 <span data-ttu-id="7136a-121">Оба метода <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> и <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> имеют несколько перегрузок, позволяющих остановить или прервать выполнение цикла, отслеживать состояние цикла в других потоках, обслуживать локальное состояние потока, завершить локальные по отношению к потоку объекты, управлять степенью параллелизма и т. д.</span><span class="sxs-lookup"><span data-stu-id="7136a-121">Both the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on.</span></span> <span data-ttu-id="7136a-122">Вспомогательные типы, обеспечивающие эту функциональную возможность, включают в себя <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken> и <xref:System.Threading.CancellationTokenSource>.</span><span class="sxs-lookup"><span data-stu-id="7136a-122">The helper types that enable this functionality include <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken>, and <xref:System.Threading.CancellationTokenSource>.</span></span>  
  
 <span data-ttu-id="7136a-123">Дополнительные сведения см. в разделе [Шаблоны параллельного программирования: описание и применение в .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span><span class="sxs-lookup"><span data-stu-id="7136a-123">For more information, see [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span>  
  
 <span data-ttu-id="7136a-124">Параллелизм данных с декларативным или подобным запросу синтаксисом поддерживается в PLINQ.</span><span class="sxs-lookup"><span data-stu-id="7136a-124">Data parallelism with declarative, or query-like, syntax is supported by PLINQ.</span></span> <span data-ttu-id="7136a-125">Дополнительные сведения см. в разделе [Parallel LINQ (PLINQ)](introduction-to-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="7136a-125">For more information, see [Parallel LINQ (PLINQ)](introduction-to-plinq.md).</span></span>  
  
## <a name="related-topics"></a><span data-ttu-id="7136a-126">См. также</span><span class="sxs-lookup"><span data-stu-id="7136a-126">Related Topics</span></span>  
  
|<span data-ttu-id="7136a-127">Заголовок</span><span class="sxs-lookup"><span data-stu-id="7136a-127">Title</span></span>|<span data-ttu-id="7136a-128">Описание</span><span class="sxs-lookup"><span data-stu-id="7136a-128">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="7136a-129">Практическое руководство. Написание простого цикла Parallel.For</span><span class="sxs-lookup"><span data-stu-id="7136a-129">How to: Write a Simple Parallel.For Loop</span></span>](how-to-write-a-simple-parallel-for-loop.md)|<span data-ttu-id="7136a-130">Описание способа написания цикла <xref:System.Threading.Tasks.Parallel.For%2A> по какому-либо массиву или индексируемой исходной коллекции <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="7136a-130">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop over any array or indexable <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|[<span data-ttu-id="7136a-131">Практическое руководство. Написание простого цикла Parallel.ForEach</span><span class="sxs-lookup"><span data-stu-id="7136a-131">How to: Write a Simple Parallel.ForEach Loop</span></span>](how-to-write-a-simple-parallel-foreach-loop.md)|<span data-ttu-id="7136a-132">Описание способа написания цикла <xref:System.Threading.Tasks.Parallel.ForEach%2A> по какой-либо исходной коллекции <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="7136a-132">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop over any <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|<span data-ttu-id="7136a-133">[Практическое руководство. Остановка или прерывание цикла Parallel.For](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="7136a-133">[How to: Stop or Break from a Parallel.For Loop](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span></span>|<span data-ttu-id="7136a-134">В этом руководстве описывается, как остановить или приостановить параллельный цикл, чтобы все потоки были информированы об этом действии.</span><span class="sxs-lookup"><span data-stu-id="7136a-134">Describes how to stop or break from a parallel loop so that all threads are informed of the action.</span></span>|  
|[<span data-ttu-id="7136a-135">Практическое руководство. Написание цикла Parallel.For и локальными переменными потока</span><span class="sxs-lookup"><span data-stu-id="7136a-135">How to: Write a Parallel.For Loop with Thread-Local Variables</span></span>](how-to-write-a-parallel-for-loop-with-thread-local-variables.md)|<span data-ttu-id="7136a-136">В этом руководстве рассматривается написание цикла <xref:System.Threading.Tasks.Parallel.For%2A>, в котором каждый поток поддерживает частную переменную, которая не видна другим потокам, и синхронизация результатов из всех потоков после завершения цикла.</span><span class="sxs-lookup"><span data-stu-id="7136a-136">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="7136a-137">Практическое руководство. Написание цикла Parallel.ForEach c локальными переменными раздела</span><span class="sxs-lookup"><span data-stu-id="7136a-137">How to: Write a Parallel.ForEach Loop with Partition-Local Variables</span></span>](how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)|<span data-ttu-id="7136a-138">В этом руководстве рассматривается написание цикла <xref:System.Threading.Tasks.Parallel.ForEach%2A>, в котором каждый поток поддерживает частную переменную, которая не видна другим потокам, и синхронизация результатов из всех потоков после завершения цикла.</span><span class="sxs-lookup"><span data-stu-id="7136a-138">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="7136a-139">Практическое руководство. Отмена цикла Parallel.For или Parallel.ForEach</span><span class="sxs-lookup"><span data-stu-id="7136a-139">How to: Cancel a Parallel.For or ForEach Loop</span></span>](how-to-cancel-a-parallel-for-or-foreach-loop.md)|<span data-ttu-id="7136a-140">В этом руководстве описывается, как отменить параллельный цикл с помощью <xref:System.Threading.CancellationToken?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="7136a-140">Describes how to cancel a parallel loop by using a <xref:System.Threading.CancellationToken?displayProperty=nameWithType></span></span>|  
|[<span data-ttu-id="7136a-141">Практическое руководство. Повышение скорости выполнения небольших тел циклов</span><span class="sxs-lookup"><span data-stu-id="7136a-141">How to: Speed Up Small Loop Bodies</span></span>](how-to-speed-up-small-loop-bodies.md)|<span data-ttu-id="7136a-142">В этом руководстве описывается один из способов увеличения скорости выполнения, когда тело цикла очень мало.</span><span class="sxs-lookup"><span data-stu-id="7136a-142">Describes one way to speed up execution when a loop body is very small.</span></span>|  
|[<span data-ttu-id="7136a-143">Библиотека параллельных задач (TPL)</span><span class="sxs-lookup"><span data-stu-id="7136a-143">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)|<span data-ttu-id="7136a-144">Общие сведения о библиотеке параллельных задач.</span><span class="sxs-lookup"><span data-stu-id="7136a-144">Provides an overview of the Task Parallel Library.</span></span>|  
|[<span data-ttu-id="7136a-145">Параллельное программирование</span><span class="sxs-lookup"><span data-stu-id="7136a-145">Parallel Programming</span></span>](index.md)|<span data-ttu-id="7136a-146">Введение в параллельное программирование в .NET Framework</span><span class="sxs-lookup"><span data-stu-id="7136a-146">Introduces Parallel Programming in the .NET Framework.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="7136a-147">См. также</span><span class="sxs-lookup"><span data-stu-id="7136a-147">See also</span></span>

- [<span data-ttu-id="7136a-148">Параллельное программирование</span><span class="sxs-lookup"><span data-stu-id="7136a-148">Parallel Programming</span></span>](index.md)
