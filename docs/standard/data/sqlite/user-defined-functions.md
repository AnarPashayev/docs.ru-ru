---
title: Определяемые пользователем функции
ms.date: 12/13/2019
description: Узнайте, как создавать определяемые пользователем скалярные и агрегатные функции.
ms.openlocfilehash: 9ee3fbac73215353c8dc82199203b0d25e580cdb
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75450414"
---
# <a name="user-defined-functions"></a>Определяемые пользователем функции

Большинство баз данных имеют метод-диалект SQL, который можно использовать для определения собственных функций. SQLite, однако, работает в процессе с приложением. Вместо того чтобы изучать новый диалект SQL, можно просто использовать язык программирования приложения.

## <a name="scalar-functions"></a>Скалярные функции

Скалярные функции возвращают одно скалярное значение для каждой строки в запросе. Определите новые скалярные функции и переопределите встроенные, используя <xref:Microsoft.Data.Sqlite.SqliteConnection.CreateFunction%2A>.

Список поддерживаемых параметров и возвращаемых типов для аргумента `func` см. в разделе [типы данных](types.md) .

При указании аргумента `state` это значение будет передаваться в каждый вызов функции. Используйте этот способ, чтобы избежать замыканий.

Укажите `isDeterministic`, если функция является детерминированной, чтобы разрешить SQLite использовать дополнительные оптимизации при компиляции запросов.

В следующем примере показано, как добавить скалярную функцию для вычисления радиуса цилиндра.

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/ScalarFunctionSample/Program.cs?name=snippet_CreateFunction)]

## <a name="operators"></a>Операторы

Следующие операторы SQLite реализуются соответствующими скалярными функциями. Определение этих скалярных функций в приложении будет переопределять поведение этих операторов.

| оператора          | Функция      |
| ----------------- | ------------- |
| X СТАНДАРТНАЯ МАСКА Y          | стандартная маска (Y, X)    |
| X, НАПРИМЕР Y          | Like (Y, X)    |
| X, НАПРИМЕР Y ESC | Like (Y, X, Z) |
| X СООТВЕТСТВУЕТ Y         | Match (Y, X)   |
| X REGEXP Y        | RegExp (Y, X)  |

В следующем примере показано, как определить функцию RegExp для включения соответствующего оператора. SQLite не включает реализацию по умолчанию функции regexp.

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/RegularExpressionSample/Program.cs?name=snippet_Regex)]

## <a name="aggregate-functions"></a>Агрегатные функции

Агрегатные функции возвращают одно агрегированное значение для всех строк в запросе. Определение и переопределение агрегатных функций с помощью <xref:Microsoft.Data.Sqlite.SqliteConnection.CreateAggregate%2A>.

Аргумент `seed` указывает начальное состояние контекста. Используйте этот способ, чтобы избежать также замыканий.

Аргумент `func` вызывается один раз для каждой строки. Используйте контекст для накопления конечного результата. Возвращает контекст. Этот шаблон позволяет контексту быть типом значения или неизменяемым.

Если `resultSelector` не указано, в качестве результата используется конечное состояние контекста. Это может упростить определение функций, таких как Sum и Count, для которых требуется только увеличение числа строк и их возврат.

Укажите `resultSelector`, чтобы вычислить окончательный результат из контекста после прохода по всем строкам.

Список поддерживаемых типов параметров для аргумента `func` и возвращаемых типов для `resultSelector`см. в разделе [типы данных](types.md) .

Если функция детерминирована, укажите `isDeterministic`, чтобы разрешить SQLite использовать дополнительные оптимизации при компиляции запросов.

В следующем примере определяется агрегатная функция для вычисления стандартного отклонения столбца.

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/AggregateFunctionSample/Program.cs?name=snippet_CreateAggregate)]

## <a name="errors"></a>Ошибки соединителя

Если определяемая пользователем функция создает исключение, сообщение возвращается в SQLite. Затем SQLite вызовет ошибку, а Microsoft. Data. SQLite вызовет исключение Склитиксцептион. Дополнительные сведения см. в разделе [ошибки базы данных](database-errors.md).

По умолчанию код ошибки SQLite будет SQLITE_ERROR (или 1). Однако можно изменить его, выполнив <xref:Microsoft.Data.Sqlite.SqliteException> в функции с указанным <xref:Microsoft.Data.Sqlite.SqliteException.SqliteErrorCode>.

## <a name="debugging"></a>Отладка

SQLite вызывает реализацию напрямую. Это позволяет добавлять точки останова, которые инициируются, когда SQLite оценивает запросы. Для создания определяемых пользователем функций доступны полные отладочные возможности отладки .NET.

## <a name="see-also"></a>См. также:

* [Типы данных](types.md)
* [Основные функции SQLite](https://www.sqlite.org/lang_corefunc.html)
* [Агрегатные функции SQLite](https://www.sqlite.org/lang_aggfunc.html)
