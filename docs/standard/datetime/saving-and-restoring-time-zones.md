---
title: Сохранение и восстановление часовых поясов
ms.date: 04/10/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- restoring time zones
- deserialization [.NET Framework], time zones
- serialization [.NET Framework], time zones
- time zone objects [.NET Framework], restoring
- saving time zones
- time zone objects [.NET Framework], deserializing
- time zones [.NET Framework], saving
- time zones [.NET Framework], restoring
- time zone objects [.NET Framework], serializing
- time zone objects [.NET Framework], saving
ms.assetid: 4028b310-e7ce-49d4-a646-1e83bfaf6f9d
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 9d783f9e0d098e472dcf67aea394804d6eef2662
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62026527"
---
# <a name="saving-and-restoring-time-zones"></a>Сохранение и восстановление часовых поясов

<xref:System.TimeZoneInfo> Класс использует реестр для получения данных предопределенный часовой пояс. Тем не менее реестр является динамической структурой. Кроме того сведения о часовом поясе, которые содержит реестр используется главным образом для проведения коррекции и преобразования времени за текущий год в операционной системе. Это имеет два важных следствий для приложений, которые зависят от точных данных часовых поясов.

* Часовой пояс, который является обязательным для приложения не могут быть определены в реестре или были переименованы или удалены из реестра.

* Часовой пояс, который определен в реестре могут отсутствовать сведения о конкретных правилах коррекции, которые необходимы для выполнения преобразований, исторических часовых поясов.

<xref:System.TimeZoneInfo> Класс обходит эти ограничения с помощью поддержки сериализации (сохранения) и десериализации (восстановления) данных часового пояса.

## <a name="time-zone-serialization-and-deserialization"></a>Часовой пояс сериализации и десериализации

Сохранение и восстановление часовых поясов, сериализации и десериализации данных часового пояса включает в себя только два вызова метода:

* Можно сериализовать <xref:System.TimeZoneInfo> путем вызова этого объекта <xref:System.TimeZoneInfo.ToSerializedString%2A> метод. Метод не принимает никаких параметров и возвращает строку, которая содержит сведения о часовом поясе.

* Может выполнить десериализацию <xref:System.TimeZoneInfo> объекта из сериализованной строки, передав эту строку `static` (`Shared` в Visual Basic) <xref:System.TimeZoneInfo.FromSerializedString%2A?displayProperty=nameWithType> метод.

## <a name="serialization-and-deserialization-scenarios"></a>Сценарии сериализации и десериализации

Возможность сохранения (или сериализации) <xref:System.TimeZoneInfo> объект в строку, а также для восстановления (или десериализации) его для последующего использования увеличивает эффективность и гибкость <xref:System.TimeZoneInfo> класса. В этом разделе рассматриваются некоторые из ситуаций, в которых сериализация и десериализация наиболее полезны.

### <a name="serializing-and-deserializing-time-zone-data-in-an-application"></a>Сериализация и десериализация данных часового пояса в приложении

Сериализованный часовой пояс может быть восстановлена из строки, при необходимости. Приложение может сделать это, если часовой пояс, полученный из реестра не удалось правильно преобразовать даты и времени в пределах определенного диапазона дат. Например данные о часовом поясе в реестре Windows XP поддерживает единственное правило коррекции, хотя часовые пояса, определенные в реестре Windows Vista, обычно предоставляют сведения о двух правил коррекции. Это означает, что преобразования исторического времени может быть неточной. Это ограничение можно обойти сериализации и десериализации данных часового пояса.

В следующем примере пользовательский <xref:System.TimeZoneInfo> представляющий определяется класс, без правил коррекции Восточном стандартном часовом поясе с 1883 по 1917 годы до введения перехода на летнее время в Соединенных Штатах. Пользовательский часовой пояс сериализуется в переменную, которая имеет глобальную область. Метод преобразования часового пояса `ConvertUtcTime`, передается универсальное синхронизированное время (UTC) раз для преобразования. В случае дата и время в 1917 годы или более ранней версии пользовательского восточного стандартного часового пояса восстанавливается из сериализованной строки и заменяет часовой пояс, полученный из реестра.

[!code-csharp[System.TimeZone2.Serialization.1#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/cs/Serialization.cs#1)]
[!code-vb[System.TimeZone2.Serialization.1#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.1/vb/Serialization.vb#1)]

### <a name="handling-time-zone-exceptions"></a>Обработка исключений часового пояса

Так как реестр — это динамическая структура, его содержимое, распространяются случайного или преднамеренного изменения. Это означает, что часовой пояс, который должен быть определен в реестре и необходим для успешного выполнения приложения может отсутствовать. Не поддерживается для часового пояса сериализации и десериализации, у вас есть другого выбора, чтобы обработать полученный в результате <xref:System.TimeZoneNotFoundException> , завершения работы приложения. Тем не менее, используя часовой пояс сериализации и десериализации, можно обрабатывать непредвиденный <xref:System.TimeZoneNotFoundException> , восстановив требуемый часовой пояс из сериализованной строки и приложение будет продолжать работу.

В следующем примере создает и выполняет сериализацию центра стандартный пользовательский часовой пояс. Затем предпринимается попытка получить центральном стандартном часовом поясе из реестра. Если операция получения создает исключение <xref:System.TimeZoneNotFoundException> или <xref:System.InvalidTimeZoneException>, обработчик исключений десериализует часовой пояс.

[!code-csharp[System.TimeZone2.Serialization.2#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/cs/Serialization2.cs#1)]
[!code-vb[System.TimeZone2.Serialization.2#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.Serialization.2/vb/Serialization2.vb#1)]

### <a name="storing-a-serialized-string-and-restoring-it-when-needed"></a>Хранение сериализованной строки и восстановление при необходимости

Приведенные выше примеры хранятся сведения о часовом поясе строковой переменной и восстановить его при необходимости. Тем не менее строка, содержащая сериализованного времени, сведения о зоне сама может быть сохранена в некотором носителе, например внешний файл, файл ресурсов, внедренных в приложение, или в реестре. (Обратите внимание, что сведения о пользовательских часовых поясов должны храниться отдельно от разделы часового пояса системы в реестре).

Хранение строк сериализованных часовых поясов таким образом отделяет процедуру создания часового пояса от самого приложения. Например процедура создания часового пояса можно выполнять и создать файл данных, который содержит исторические данные о часовом поясе, приложение может использовать. Файл данных может быть, а затем установить приложение и ее можно открыть, и один или несколько его часовых поясов может быть десериализован, когда приложению требуется их.

Пример, который использует внедренный ресурс для хранения сериализованных данных часового пояса, см. в разделе [как: Сохранение часовых поясов во внедренном ресурсе](../../../docs/standard/datetime/save-time-zones-to-an-embedded-resource.md) и [как: Восстановление часовых поясов из внедренного ресурса](../../../docs/standard/datetime/restore-time-zones-from-an-embedded-resource.md).

## <a name="see-also"></a>См. также

- [Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)
