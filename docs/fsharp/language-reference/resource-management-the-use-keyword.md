---
title: 'Управление ресурсами: Ключевое слово use'
description: Дополнительные сведения о F# ключевое слово «use» и функция «using», которые позволяют управлять инициализацией и освобождением ресурсов.
ms.date: 05/16/2016
ms.openlocfilehash: 3389f84713ec7cf5459dd0132249970f0e2ef3e0
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65641696"
---
# <a name="resource-management-the-use-keyword"></a>Управление ресурсами: Ключевое слово use

В этом разделе описывается ключевое слово `use` и `using` функции, которые позволяют управлять инициализацией и освобождением ресурсов.

## <a name="resources"></a>Ресурсы

Термин *ресурсов* используется более чем одним способом. Да, ресурсы могут быть данные, которые использует приложение, такие как строки, графики и тому подобное, но в этом контексте *ресурсы* ссылается на ресурсы операционной системы или программного обеспечения, такие как контексты графических устройств, дескрипторы файлов, сети и базы данных, подключения, параллельной обработки объектов, таких как дескрипторы ожидания и т. д. Использование этих ресурсов приложениями подразумевает получение ресурса из операционной системы или другого поставщика ресурсов, за которым следует в более позднем выпуске ресурса в пул, чтобы его можно указать в другое приложение. Проблемы возникают, когда приложения не освобождают ресурсы в общий пул.

## <a name="managing-resources"></a>Управление ресурсами

Эффективное и ответственное управление ресурсами в приложении, необходимо освободить ресурсы незамедлительно и предсказуемым образом. .NET Framework помогает сделать это, предоставляя `System.IDisposable` интерфейс. Тип, реализующий `System.IDisposable` имеет `System.IDisposable.Dispose` метод, который правильно освобождает ресурсы. Грамотно сконструированные приложения гарантирует, что `System.IDisposable.Dispose` немедленно вызывается, когда любой объект, который содержит это ограниченный ресурс больше не используется. К счастью, большинство языков .NET обеспечивают поддержку, чтобы облегчить эту задачу, и F# не является исключением. Существует два полезных языковых конструкций, которые поддерживают шаблон dispose: `use` привязки и `using` функции.

## <a name="use-binding"></a>Использование привязки

`use` Ключевое слово имеет форму напоминает `let` привязки:

Используйте *значение* = *выражение*

Он предоставляет те же функции, что `let` привязки, но добавляет вызов `Dispose` для значения, если значение выходит за пределы области. Обратите внимание, что компилятор вставляет проверку значения null для значения, поэтому, если значение равно `null`, вызов `Dispose` не выполняется.

В следующем примере показано, как автоматически закрывать файл с помощью `use` ключевое слово.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet6301.fs)]

> [!NOTE]
> Можно использовать `use` в выражения вычисления, в этом случае настроенную версию `use` используется выражение. Дополнительные сведения см. в разделе [последовательностей](sequences.md), [асинхронные рабочие потоки](asynchronous-workflows.md), и [выражения вычисления](computation-expressions.md).

## <a name="using-function"></a>с помощью функции

`using` Функция имеет следующий вид:

`using` (*expression1*) *лямбды или function*

В `using` выражения, *expression1* создает объект, который необходимо освободить. Результат *expression1* (объект, который необходимо освободить) становится аргумент *значение*, *функции или лямбда*, который является либо функцию, ожидающую один Осталось аргумент типа, который соответствует значению созданные *expression1*, или лямбда-выражение, которое ожидает аргумент этого типа. В конце выполнения функции, среда выполнения вызывает `Dispose` и освобождает ресурсы (если значение не является `null`, в этом случае вызов метода Dispose не выполняется).

В следующем примере демонстрируется `using` выражение с лямбда-выражения.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet6302.fs)]

В следующем примере показан `using` выражение с функцией.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet6303.fs)]

Обратите внимание на то, что функция может быть функцией, которая уже применены некоторые аргументы. Это действие представлено в следующем примере кода: Он создает файл, содержащий строку `XYZ`.

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet6304.fs)]

`using` Функции и `use` привязка — почти эквивалентные способы сделать то же самое. `using` Ключевое слово предоставляет больший контроль над тем, когда `Dispose` вызывается. При использовании `using`, `Dispose` вызывается в конце функции или лямбда-выражения; при использовании `use` ключевое слово, `Dispose` вызывается в конце содержащего его блока кода. Как правило, вы должны отдавать предпочтение использованию `use` вместо `using` функции.

## <a name="see-also"></a>См. также

- [Справочник по языку F#](index.md)
