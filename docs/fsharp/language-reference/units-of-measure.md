---
title: Единицы измерения
description: Узнайте, как значения с плавающей запятой и F# целым числом со знаком в могут иметь связанные единицы измерения, которые обычно используются для обозначения длины, объема и массы.
ms.date: 05/16/2016
ms.openlocfilehash: f97eac9984f934c55aff8cf9f287afbc3aa098f3
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2019
ms.locfileid: "68630159"
---
# <a name="units-of-measure"></a>Единицы измерения

Целочисленные значения с плавающей запятой F# и со знаком в могут иметь связанные единицы измерения, которые обычно используются для обозначения длины, объема, массы и т. д. Используя количественные единицы, вы включаете компилятор, чтобы убедиться, что арифметические связи имеют правильные единицы, что помогает предотвратить ошибки программирования.

## <a name="syntax"></a>Синтаксис

```fsharp
[<Measure>] type unit-name [ = measure ]
```

## <a name="remarks"></a>Примечания

В предыдущем синтаксисе параметр *Unit-Name* определяется как единица измерения. Необязательная часть используется для определения новой меры с точки зрения ранее определенных единиц. Например, в следующей строке определяется мера `cm` (сантиметр).

```fsharp
[<Measure>] type cm
```

Следующая строка определяет меру `ml` (миллилитер) как кубический сантиметр (`cm^3`).

```fsharp
[<Measure>] type ml = cm^3
```

В предыдущем синтаксисе *мера* — это формула, в которой участвуют единицы. В формулах, в которых задействованы единицы, целочисленные степени поддерживаются (положительные и отрицательные), пробелы между единицами указывают `*` на произведение двух единиц, также указывают `/` на произведение единиц и обозначает частное число единиц. Для обратной единицы можно использовать отрицательное целое число или значение `/` , которое обозначает разделение между числителем и знаменателем формулы единицы. Несколько единиц в знаменателе должны быть заключены в круглые скобки. Единицы, разделенные пробелами `/` после, обрабатываются как часть знаменателя, но все единицы после a `*` обрабатываются как часть числителя.

Можно использовать 1 в выражениях единиц измерения, чтобы указать количество без измерения или вместе с другими единицами, например в числителе. Например, единицы курса записываются как `1/s`, где `s` — секунды. Круглые скобки не используются в формулах единиц. Константы числового преобразования не указываются в формулах единиц; Однако константы преобразования можно определить с помощью единиц по отдельности и использовать их в вычислениях с проверкой единиц измерения.

Формулы единиц, означающие то же самое, можно написать различными способами. Таким образом, компилятор преобразует формулы единиц в согласованную форму, которая преобразует отрицательные степени в обратные, группирует единицы в один числитель и знаменатель и алфабетизес единицы в числителе и знаменателе.

Например, формулы `kg m s^-2` единиц и `m /s s * kg` преобразуются в `kg m/s^2`.

Единицы измерения используются в выражениях с плавающей запятой. Использование чисел с плавающей запятой вместе со связанными единицами измерения позволяет добавить другой уровень безопасности типа и помогает избежать ошибок несоответствия единиц, которые могут возникать в формулах при использовании слабо типизированных чисел с плавающей запятой. При написании выражения с плавающей запятой, в котором используются единицы измерения, единицы в выражении должны совпадать.

Литералы можно закомментировать с помощью формулы единицы в угловых скобках, как показано в следующих примерах.

```fsharp
1.0<cm>
55.0<miles/hour>
```

Между числом и угловой скобкой не ставится пробел. Однако можно включить литеральный суффикс `f`, например, как показано в следующем примере.

```fsharp
// The f indicates single-precision floating point.
55.0f<miles/hour>
```

Такая Аннотация изменяет тип литерала с его примитивного типа (например `float` `float<miles/hour>`,) на размер измерения, `float<cm>` например или, в данном случае. Заметка единицы измерения `<1>` указывает на неизмерение количества, и его тип эквивалентен типу-примитиву без параметра Unit.

Тип единицы измерения — это целочисленный тип с плавающей запятой или со знаком, а также дополнительный комментарий к единице, обозначенный в квадратных скобках. Таким образом, при написании типа преобразования из `g` (грамм) в `kg` (килограммы) эти типы описываются следующим образом.

```fsharp
let convertg2kg (x : float<g>) = x / 1000.0<g/kg>
```

Единицы измерения используются для проверки единиц времени компиляции, но не сохраняются в среде выполнения. Поэтому они не влияют на производительность.

Единицы измерения можно применять к любому типу, а не только к типам с плавающей запятой. Тем не менее, только типы с плавающей запятой, целочисленные типы со знаком и десятичные типы поддерживают измерения количества. Поэтому имеет смысл использовать единицы измерения только для примитивных типов и для агрегатов, содержащих эти примитивные типы.

В следующем примере показано использование единиц измерения.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6901.fs)]

В следующем примере кода показано, как преобразовать из числа с плавающей запятой, не определяющего, в измерение с плавающей запятой. Вы просто умножаете на 1,0, применяя измерения к 1,0. Это можно представить в виде функции, например `degreesFahrenheit`.

Кроме того, при передаче измеренных значений в функции, которые предполагают безразмерные числа с плавающей запятой, необходимо отказаться от `float` единиц или привести `float` к типу с помощью оператора. В этом примере вы делите `1.0<degC>` на `printf` аргументы в, так как `printf` предполагается количество безразмерных измерений.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6902.fs)]

В следующем примере сеанса показаны выходные данные и входные данные этого кода.

```
Enter a temperature in degrees Fahrenheit.
90
That temperature in degrees Celsius is    32.22.
```

## <a name="using-generic-units"></a>Использование универсальных единиц

Можно создавать универсальные функции, которые работают с данными, имеющими связанную единицу измерения. Для этого нужно указать тип вместе с универсальной единицей в качестве параметра типа, как показано в следующем примере кода.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6903.fs)]

## <a name="creating-aggregate-types-with-generic-units"></a>Создание агрегатных типов с универсальными единицами

В следующем коде показано, как создать агрегатный тип, состоящий из отдельных значений с плавающей запятой, имеющих универсальные единицы измерения. Это позволяет создать один тип, который работает с различными единицами измерения. Кроме того, универсальные единицы измерения сохраняют безопасность типа, гарантируя, что универсальный тип, имеющий один набор единиц, отличается от типа того же универсального типа с другим набором единиц. На основе этого метода `Measure` можно применить атрибут к параметру типа.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6904.fs)]

## <a name="units-at-runtime"></a>Единицы во время выполнения

Единицы измерения используются для проверки статических типов. При компиляции значений с плавающей запятой единицы измерения исключаются, поэтому они теряются во время выполнения. Таким образом, любая попытка реализовать функциональность, зависящую от проверки единиц во время выполнения, невозможна. Например, невозможно реализовать `ToString` функцию для вывода единиц на печать.

## <a name="conversions"></a>Преобразования

Для преобразования типа с единицами (например, `float<'u>`) в тип, не имеющий единиц, можно использовать стандартную функцию преобразования. Например, можно использовать `float` для преобразования `float` в значение, не имеющее единиц, как показано в следующем коде.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6905.fs)]

Чтобы преобразовать значение без единиц измерения в значение, имеющее единицы измерения, можно умножить его на значение 1 или 1,0 с заметками соответствующих единиц. Однако для написания уровней взаимодействия существуют также некоторые явные функции, которые можно использовать для преобразования бесмодульных значений в значения с единицами измерения. Они находятся в модуле [Microsoft. FSharp. Core. LanguagePrimitives](https://msdn.microsoft.com/library/69d08ac5-5d51-4c20-bf1e-850fd312ece3) . Например, чтобы выполнить преобразование из бесмодульного `float` модуля `float<cm>`в, используйте [флоатвисмеасуре](https://msdn.microsoft.com/library/69520bc7-d67b-46b8-9004-7cac9646b8d9), как показано в следующем коде.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet6906.fs)]

## <a name="units-of-measure-in-the-f-core-library"></a>Единицы измерения в F# основной библиотеке

Библиотека единиц измерения доступна в `FSharp.Data.UnitSystems.SI` пространстве имен. Она включает в себя единицы СИ как в виде символов ( `m` например, для счетчика `UnitSymbols` ) в подпространстве имен, так и `meter` их полное имя (например, для `UnitNames` счетчика) в подпространстве имен.

## <a name="see-also"></a>См. также

- [Справочник по языку F#](index.md)
