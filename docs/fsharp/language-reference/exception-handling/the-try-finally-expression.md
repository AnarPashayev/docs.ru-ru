---
title: Исключения. Выражение try…finally
description: Узнайте, F# как "try... Наконец "выражение позволяет выполнять код очистки, даже если блок кода создает исключение.
ms.date: 05/16/2016
ms.openlocfilehash: 03fbda1ef5d55560232f0217f603fc04c0af0eb4
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2019
ms.locfileid: "68630270"
---
# <a name="exceptions-the-tryfinally-expression"></a>Исключения. Выражение try…finally

`try...finally` Выражение позволяет выполнять код очистки, даже если блок кода создает исключение.

## <a name="syntax"></a>Синтаксис

```fsharp
try
    expression1
finally
    expression2
```

## <a name="remarks"></a>Примечания

Выражение можно использовать для выполнения кода в *Expression2* в предыдущем синтаксисе независимо от того, создано ли исключение во время выполнения *expression1.* `try...finally`

Тип *Expression2* не влияет на значение всего выражения; тип, возвращаемый, если исключение не возникает, является последним значением в *expression1*. При возникновении исключения значение не возвращается, а поток управления передается в следующий обработчик исключений, находящийся выше по стеку вызовов. Если обработчик исключений не найден, программа завершает работу. Перед выполнением кода в обработчике сопоставления или завершения программы выполняется код в `finally` ветви.

В следующем коде показано использование `try...finally` выражения.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5701.fs)]

На консоль выводятся следующие выходные данные.

```
Closing stream
Exception handled.
```

Как видно из выходных данных, поток был закрыт до обработки внешнего исключения, а файл `test.txt` содержит текст `test1`, указывающий на то, что буферы были сброшены и записаны на диск, даже если исключение передано. Управление внешним обработчиком исключений.

Обратите внимание `try...with` , что конструкция является отдельной конструкцией `try...finally` из конструкции. Поэтому, если в коде требуется `with` блок `finally` и блок, необходимо вложить две конструкции, как показано в следующем примере кода.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5702.fs)]

В контексте вычислительных выражений, включая выражения последовательности и асинхронные рабочие процессы, **попробуйте... выражения finally** могут иметь пользовательскую реализацию. Дополнительные сведения см. в разделе [выражения вычислений](../computation-expressions.md).

## <a name="see-also"></a>См. также

- [Обработка исключений](index.md)
- [Исключения. `try...with` Выражение](the-try-with-expression.md)
