---
title: Активные шаблоны
description: Узнайте, как использовать активные шаблоны для определения именованных секций, разделяющих входные F# данные на языке программирования.
ms.date: 05/16/2016
ms.openlocfilehash: f5ed4a8600cba10d23d01628aba6ca07e543c586
ms.sourcegitcommit: 14ad34f7c4564ee0f009acb8bfc0ea7af3bc9541
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2019
ms.locfileid: "73425095"
---
# <a name="active-patterns"></a>Активные шаблоны

*Активные шаблоны* позволяют определить именованные секции, которые подделят входные данные, чтобы эти имена можно было использовать в выражении сопоставления шаблонов точно так же, как для размеченного объединения. Активные шаблоны можно использовать для разложения данных в настраиваемом порядке для каждого раздела.

## <a name="syntax"></a>Синтаксис

```fsharp
// Active pattern of one choice.
let (|identifier|) [arguments] valueToMatch= expression

// Active Pattern with multiple choices.
// Uses a FSharp.Core.Choice<_,...,_> based on the number of case names. In F#, the limitation n <= 7 applies.
let (|identifer1|identifier2|...|) valueToMatch = expression

// Partial active pattern definition.
// Uses a FSharp.Core.option<_> to represent if the type is satisfied at the call site.
let (|identifier|_|) [arguments ] valueToMatch = expression
```

## <a name="remarks"></a>Заметки

В предыдущем синтаксисе идентификаторы представляют собой имена секций входных данных, представленных *аргументами*, или, иными словами, имена подмножеств набора всех значений аргументов. В определении активного шаблона может быть до семи секций. *Выражение* описывает форму, в которую разбиваются данные. Определение активного шаблона можно использовать для определения правил, определяющих, какие из именованных секций являются значениями, заданными в качестве аргументов. Символы (| и |) называются *скрепками в виде полукруглого* символа, а функция, созданная с помощью этого типа привязки let, называется *активным распознавателем*.

В качестве примера рассмотрим следующий активный шаблон с аргументом.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5001.fs)]

Активный шаблон можно использовать в выражении сопоставления шаблонов, как показано в следующем примере.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5002.fs)]

Выходные данные этой программы выглядят следующим образом:

```console
7 is odd
11 is odd
32 is even
```

Другим применением активных шаблонов является разбиение типов данных несколькими способами, например, когда одни и те же базовые данные имеют различные возможные представления. Например, объект `Color` можно разбить на представление RGB или в представление HSB.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5003.fs)]

Выходные данные приведенной выше программы выглядят следующим образом:

```console
Red
 Red: 255 Green: 0 Blue: 0
 Hue: 360.000000 Saturation: 1.000000 Brightness: 0.500000
Black
 Red: 0 Green: 0 Blue: 0
 Hue: 0.000000 Saturation: 0.000000 Brightness: 0.000000
White
 Red: 255 Green: 255 Blue: 255
 Hue: 0.000000 Saturation: 0.000000 Brightness: 1.000000
Gray
 Red: 128 Green: 128 Blue: 128
 Hue: 0.000000 Saturation: 0.000000 Brightness: 0.501961
BlanchedAlmond
 Red: 255 Green: 235 Blue: 205
 Hue: 36.000000 Saturation: 1.000000 Brightness: 0.901961
```

В сочетании эти два способа использования активных шаблонов позволяют секционировать и разбивать данные на соответствующую форму и выполнять соответствующие вычисления с соответствующими данными в форме, наиболее удобной для вычислений.

Результирующие выражения сопоставления шаблонов позволяют написать данные удобным для чтения способом, значительно упрощая потенциально сложную ветвление и код анализа данных.

## <a name="partial-active-patterns"></a>Частичные активные шаблоны

Иногда необходимо секционировать только часть входного пространства. В этом случае вы пишете набор частичных шаблонов, каждый из которых соответствует некоторым входным данным, но не соответствует другим входным данным. Активные шаблоны, которые не всегда создают значение, называются *частичными активными шаблонами*; они имеют возвращаемое значение, которое является типом параметра. Чтобы определить частичный активный шаблон, используйте подстановочный знак (\_) в конце списка шаблонов в неменяющих роликах. Следующий код иллюстрирует использование частично активного шаблона.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5004.fs)]

Выходные данные предыдущего примера выглядят следующим образом:

```console
1.100000 : Floating point
0 : Integer
0.000000 : Floating point
10 : Integer
Something else : Not matched.
```

При использовании частичных активных шаблонов иногда отдельные варианты могут быть несоединенными или взаимоисключающими, но они не должны быть. В следующем примере прямоугольный квадрат и куб шаблона не являются несвязанными, так как некоторые числа представляют собой квадраты и Кубы, например 64. Следующая программа использует шаблон и для объединения квадратных и шаблонных шаблонов Куба. Он выводит все целые числа до 1000, которые являются квадратами и кубами, а также только Кубы.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5005.fs)]

Выходные данные выглядят следующим образом:

```console
1 is a cube and a square
8 is a cube
27 is a cube
64 is a cube and a square
125 is a cube
216 is a cube
343 is a cube
512 is a cube
729 is a cube and a square
1000 is a cube
```

## <a name="parameterized-active-patterns"></a>Параметризованные активные шаблоны

Активные шаблоны всегда принимают по крайней мере один аргумент для сопоставляемого элемента, но они могут также принимать дополнительные аргументы, в этом случае применяется к *параметризованному активному шаблону* Name. Дополнительные аргументы позволяют специализированные шаблоны. Например, активные шаблоны, использующие регулярные выражения для анализа строк, часто содержат регулярное выражение в качестве дополнительного параметра, как в следующем коде, который также использует частичный активный шаблон `Integer`, определенный в предыдущем примере кода. В этом примере строки, в которых используются регулярные выражения для различных форматов даты, предоставляются для настройки общего Парсережекс активного шаблона. Целочисленный активный шаблон используется для преобразования совпадающих строк в целые числа, которые могут быть переданы конструктору DateTime.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5006.fs)]

Выходные данные предыдущего кода выглядят следующим образом:

```console
12/22/2008 12:00:00 AM 1/1/2009 12:00:00 AM 1/15/2008 12:00:00 AM 12/28/1995 12:00:00 AM
```

Активные шаблоны не ограничиваются только выражениями, соответствующими шаблонам, их также можно использовать в привязке let.

[!code-fsharp[Main](~/samples/snippets/fsharp/lang-ref-2/snippet5007.fs)]

Выходные данные предыдущего кода выглядят следующим образом:

```console
Hello, random citizen!
Hello, George!
```

## <a name="see-also"></a>См. также

- [Справочник по языку F#](index.md)
- [Выражения match](match-expressions.md)
