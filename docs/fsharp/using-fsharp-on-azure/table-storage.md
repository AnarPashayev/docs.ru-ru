---
title: Начало работы с хранилищем таблиц Azure с использованиемF#
description: Store структурированных данных в облаке, используя хранилище таблиц Azure или Azure Cosmos DB.
author: sylvanc
ms.date: 03/26/2018
ms.openlocfilehash: 54c777acd454e4f675175b814675c185e41ad9a4
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61756355"
---
# <a name="get-started-with-azure-table-storage-and-the-azure-cosmos-db-table-api-using-f"></a>Начало работы с хранилищем таблиц Azure и API таблицы Azure Cosmos DB с помощью языка F\#

Хранилище таблиц Azure — это служба, которая хранит структурированные данные NoSQL в облаке. Хранилище таблиц — это хранилище ключей и атрибутов с бессхемной конструкцией. Поскольку табличное хранилище является бессхемным, можно легко адаптировать данные по мере расширения приложения. Доступ к данным — быстрое и экономичное для всех типов приложений. Табличное хранилище обычно значительно дешевле, чем традиционные SQL для похожих объемов данных.

Хранилище таблиц можно использовать для хранения гибких наборов данных, таких как данные пользователя для веб-приложений, адресных книг, сведений об устройстве и любого другого типа метаданных, которые требуются вашей службе. Можно хранить любое число сущностей в таблице, и учетную запись хранения может содержать любое количество таблиц в пределах емкости учетной записи хранения.

Azure Cosmos DB предоставляет API таблицы для приложений, написанные для хранилища таблиц Azure и которым требуется первоклассные возможности, такие как:

- Комплексные возможности глобального распределения.
- Выделенная пропускная способность по всему миру.
- Миллисекунд задержки на 99-го процентиля.
- Гарантированно высокий уровень доступности.
- Автоматическое вторичное индексирование.

Приложения, написанные для хранилища таблиц Azure можно перенести в Azure Cosmos DB с помощью API таблицы без изменения кода и воспользоваться возможностями уровня "премиум". API таблицы включает клиентские пакеты SDK для .NET, Java, Python и Node.js.

Дополнительные сведения см. в разделе [введение в API таблицы Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/table-introduction).

## <a name="about-this-tutorial"></a>Сведения об этом руководстве

Этот учебник демонстрирует запись F# код для выполнения некоторых общих задач, используя хранилище таблиц Azure или Azure Cosmos DB API таблиц, включая создание и удаление таблицы и вставки, обновления, удаления и запроса данных таблицы.

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать это руководство, необходимо сначала [создать учетную запись хранения](/azure/storage/storage-create-storage-account) или [учетной записи Azure Cosmos DB](https://azure.microsoft.com/try/cosmosdb/).

## <a name="create-an-f-script-and-start-f-interactive"></a>Создание F# сценариев и запустить F# интерактивный

Примеры в этой статье можно использовать в любом F# приложения или F# скрипта. Чтобы создать F# скрипт, создайте файл с `.fsx` расширение, например `tables.fsx`в вашей F# среды разработки.

Затем используйте [диспетчера пакетов](package-management.md) например [Paket](https://fsprojects.github.io/Paket/) или [NuGet](https://www.nuget.org/) для установки `WindowsAzure.Storage` пакета и ссылка `WindowsAzure.Storage.dll` в скрипте, с помощью `#r`директива. Сделать это за `Microsoft.WindowsAzure.ConfigurationManager` для получения Microsoft.Azure пространства имен.

### <a name="add-namespace-declarations"></a>Добавьте объявления пространств имен

Добавьте следующий `open` операторы в верхнюю часть `tables.fsx` файла:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L1-L5)]

### <a name="get-your-azure-storage-connection-string"></a>Получить строку подключения хранилища Azure

Если вы подключаетесь к таблиц службы хранилища Azure, нужно будет строки подключения в этом руководстве. Можно скопировать строку подключения на портале Azure. Дополнительные сведения о строках подключения см. в разделе [Настройка строк подключения службы хранилища](/azure/storage/storage-configure-connection-string).

### <a name="get-your-azure-cosmos-db-connection-string"></a>Получить строку подключения к Azure Cosmos DB

Если вы подключаетесь к Azure Cosmos DB, нужно будет строки подключения в этом руководстве. Можно скопировать строку подключения на портале Azure. На портале Azure в учетной записи Cosmos DB, перейдите к **параметры** > **строку подключения**и нажмите кнопку **копирования** кнопку, чтобы скопировать первичный подключения Строка. 

Для этого руководства введите строку подключения в скрипте, как в следующем примере:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L11-L11)]

Однако это **не рекомендуется** реальных проектов. Ключ учетной записи хранения похож на корневой пароль для учетной записи хранения. Не забудьте защитить ключ учетной записи хранения. Избегайте распределения его другим пользователям, в коде, или сохранить его в текстовом файле, доступном другим пользователям. Можно повторно создать ключ с помощью портала Azure, если вы считаете, что он мог быть скомпрометирован.

Для реальных приложений, чтобы сохранить строку подключения хранилища рекомендуется в файле конфигурации. Чтобы получить строку подключения из файла конфигурации, это можно сделать:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L13-L15)]

Использование диспетчера конфигураций Azure не является обязательным. Можно также использовать API, например .NET Framework `ConfigurationManager` типа.

### <a name="parse-the-connection-string"></a>Проанализировать строку подключения

Чтобы проанализировать строку подключения, используйте следующую команду:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L21-L22)]

Эта команда возвращает `CloudStorageAccount`.

### <a name="create-the-table-service-client"></a>Создание клиента службы таблиц

`CloudTableClient` Класс позволяет получать таблицы и сущности в хранилище таблиц. Вот один из способов создания клиента службы:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L28-L29)]

Теперь вы готовы написать код, который считывает и записывает данные в хранилище таблиц.

### <a name="create-a-table"></a>Создание таблицы

В этом примере показано, как создать таблицу, если он еще не существует:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L35-L39)]

### <a name="add-an-entity-to-a-table"></a>Добавление сущности в таблицу

Сущность должна иметь тип, наследующий от `TableEntity`. Вы можете расширить `TableEntity` по своему усмотрению, но ваш тип *необходимо* иметь конструктор без параметров. Только свойства, имеющие и `get` и `set` хранятся в таблице Azure.

Сущности раздела и ключа строки однозначно идентифицировать сущность в таблице. Сущности с одинаковым ключом раздела можно запрашивать быстрее, чем с разными ключами раздела, но использование различных ключей разделов обеспечивает более высокую масштабируемость параллельных операций.

Ниже приведен пример `Customer` , использующий `lastName` как ключ раздела и `firstName` как ключ строки.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L45-L52)]

Теперь добавьте `Customer` в таблицу. Чтобы сделать это, создайте `TableOperation` , выполняющийся в таблице. В этом случае создается `Insert` операции.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L54-L55)]

### <a name="insert-a-batch-of-entities"></a>Вставка пакета сущностей

Можете вставить пакет сущностей в таблицу с использованием одиночную операцию записи. Пакетные операции позволяют объединить операции в одно выполнение, но они имеют некоторые ограничения:

- Вы можете выполнять операции обновления, удаления и вставки в одной пакетной операции.
- Пакетная операция может включать до 100 сущностей.
- Все сущности в пакетной операции должен иметь один и тот же ключ секции.
- Хотя можно выполнить запрос в пакетной операции, он должен быть единственной операцией в пакете.

Ниже приведен код, который объединяет два вставок в пакетной операции.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L62-L71)]

### <a name="retrieve-all-entities-in-a-partition"></a>Получение всех сущностей в разделе

Чтобы запросить таблицу для всех сущностей в разделе, используйте `TableQuery` объекта. Здесь вы фильтрации для сущностей, где «Smith» является ключом секции.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L77-L82)]

Вы теперь выведите результаты:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L84-L85)]

### <a name="retrieve-a-range-of-entities-in-a-partition"></a>Получение диапазона сущностей в разделе

Если вы не хотите запрашивать все сущности в секции, можно указать диапазон, объединив фильтр ключа раздела с фильтром ключа строк. Здесь используется два фильтра для получения всех сущностей в разделе «Smith» где ключ строки (имя) начинается с буквы, более ранних, чем «M» в алфавите.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L91-L100)]

Вы теперь выведите результаты:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L102-L103)]

### <a name="retrieve-a-single-entity"></a>Извлечение одной сущности

Можно написать запрос для получения отдельной сущности. Здесь используется `TableOperation` для указания клиента «Ben Smith». Вместо коллекции, вы получаете `Customer`. Указание ключа секции и ключа строки в запросе — это самый быстрый способ извлечь одну сущность из службы таблиц.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L109-L111)]

Вы теперь выведите результаты:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L113-L115)]

### <a name="replace-an-entity"></a>Замена сущности

Чтобы обновить сущность, извлеките ее из службы таблиц, измените объект сущности, а затем сохраните изменения обратно в службу таблиц с использованием `Replace` операции. Это приводит к сущность будет полностью заменена на сервере, если только сущность на сервере была изменена с момента ее получения, в этом случае операция завершится ошибкой. Причина заключается в том, чтобы предотвратить приложения от перезаписи изменений из других источников.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L121-L128)]

### <a name="insert-or-replace-an-entity"></a>Вставка или замена сущности

В некоторых случаях вы не знаете, существует ли сущность в таблице. И если да, текущие значения, хранящиеся в ней больше не требуются. Можно использовать `InsertOrReplace` для создания сущности или заменить его, если он существует, независимо от ее состояния.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L134-L141)]

### <a name="query-a-subset-of-entity-properties"></a>Запрос подмножества свойств сущности

Табличный запрос может получить лишь несколько свойств сущности, а не все из них. Этот метод, который называется проекции, можно повысить производительность запросов, особенно для крупных сущностей. Здесь, возвращают только по электронной почте адреса, используя `DynamicTableEntity` и `EntityResolver`. Обратите внимание на то, что проекция не поддерживается в эмуляторе локального хранилища, поэтому этот код выполняется только в том случае, если вы используете учетную запись в службе таблиц.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L147-L158)]

### <a name="retrieve-entities-in-pages-asynchronously"></a>Асинхронного получения объектов со страниц

Если вы читаете большое количество сущностей, и вы хотите их обработка по мере их загрузки, а не ждать их все для возврата, можно использовать Сегментированный запрос. Здесь возвращают результаты в страницы с помощью асинхронных рабочих процессов таким образом, чтобы не блокировать выполнение во время ожидания для большого набора результатов.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L163-L178)]

Теперь пользователь хранимую процедуру вычисления синхронно:

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L180-L180)]

### <a name="delete-an-entity"></a>Удаление сущности

Сущность можно удалить после ее получения. Как и в обновление сущности, это не выполняется, если сущность не была изменена с момента ее получения.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L186-L187)]

### <a name="delete-a-table"></a>Удаление таблицы

Можно удалить таблицу из учетной записи хранения. Таблица, которая была удалена, будет недоступен нельзя воссоздать в течение заданного времени после удаления.

[!code-fsharp[TableStorage](../../../samples/snippets/fsharp/azure/table-storage.fsx#L193-L193)]

## <a name="next-steps"></a>Следующие шаги

Теперь, когда ознакомились с основными понятиями хранилища таблиц, по следующим ссылкам, чтобы узнать о более сложных задачах хранилища и API таблицы Azure Cosmos DB.

- [Введение в Azure API таблиц Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/table-introduction)
- [Клиентская библиотека хранилища для .NET](https://docs.microsoft.com/dotnet/api/overview/azure/storage?view=azure-dotnet)
- [Тип поставщика хранилища Azure](https://fsprojects.github.io/AzureStorageTypeProvider/)
- [Блог группы разработчиков хранилища Azure](https://blogs.msdn.com/b/windowsazurestorage/)
- [Настройка строк подключения](https://docs.microsoft.com/azure/storage/common/storage-configure-connection-string)
- [Приступая к работе с хранилищем таблиц Azure в .NET](https://azure.microsoft.com/resources/samples/storage-table-dotnet-getting-started/)
