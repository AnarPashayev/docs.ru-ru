---
title: Начало работы с хранилищем BLOB-объектов Azure с помощью языка F#
description: Храните неструктурированные данные в облаке с помощью хранилища BLOB-объектов Azure.
author: sylvanc
ms.date: 09/20/2016
ms.openlocfilehash: c765f38cba7642e813a5966d3b7754c5ce45abbd
ms.sourcegitcommit: 6f28b709592503d27077b16fff2e2eacca569992
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70107113"
---
# <a name="get-started-with-azure-blob-storage-using-f"></a>Приступая к работе с хранилищем BLOB-объектов Azure с помощью F\#

Хранилище BLOB-объектов Azure — это служба, которая сохраняет неструктурированные данные в облаке в виде BLOB-объектов. В хранилище BLOB-объектов можно хранить любые типы текстовых или двоичных данных, таких как документы, файлы мультимедиа или установщики приложений. Хранилище BLOB-объектов также называют хранилищем объектов.

В этой статье показано, как выполнять общие задачи с помощью хранилища BLOB-объектов. Примеры написаны с F# помощью клиентской библиотеки службы хранилища Azure для .NET. В рассмотренных задачах содержатся сведения о передаче, перечислении, скачивании и удалении больших двоичных объектов.

Общие сведения о хранилище BLOB-объектов см. [в этом](/azure/storage/storage-dotnet-how-to-use-blobs)разделе.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством необходимо сначала [создать учетную запись хранения Azure](/azure/storage/storage-create-storage-account). Вам также потребуется ключ доступа к хранилищу для этой учетной записи.

## <a name="create-an-f-script-and-start-f-interactive"></a>Создание F# скрипта и запуск F# интерактивного

Примеры в этой статье можно использовать как в F# приложении, так и в F# сценарии. Чтобы создать F# скрипт, создайте файл с `.fsx` `blobs.fsx`расширением, например в среде F# разработки.

Затем используйте [Диспетчер пакетов](package-management.md) , например [пакет](https://fsprojects.github.io/Paket/) или `WindowsAzure.Storage` [NuGet](https://www.nuget.org/) , для установки пакетов и `Microsoft.WindowsAzure.ConfigurationManager` ссылок `WindowsAzure.Storage.dll` `Microsoft.WindowsAzure.Configuration.dll` и в скрипте с помощью `#r` директивы.

### <a name="add-namespace-declarations"></a>Добавить объявления пространств имен

Добавьте следующие `open` инструкции в начало `blobs.fsx` файла:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L1-L5)]

### <a name="get-your-connection-string"></a>Получение строки подключения

Для работы с этим руководством требуется строка подключения к службе хранилища Azure. Дополнительные сведения о строках подключения см. в разделе [Настройка строк подключения к хранилищу](/azure/storage/storage-configure-connection-string).

В этом руководстве вы вводите строку подключения в скрипте следующим образом:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L11-L11)]

Однако это **не рекомендуется** для реальных проектов. Ключ учетной записи хранения аналогичен корневому паролю для вашей учетной записи хранения. Всегда будьте внимательны, чтобы защитить ключ учетной записи хранения. Не рекомендуется распространять его другим пользователям, жестко программировать или сохранять в виде обычного текстового файла, доступного для других пользователей. Вы можете повторно создать ключ с помощью портала Azure, если считаете, что он был скомпрометирован.

Для реальных приложений лучшим способом поддержания строки подключения к хранилищу является файл конфигурации. Чтобы получить строку подключения из файла конфигурации, можно сделать следующее:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L13-L15)]

Использование Configuration Manager Azure является необязательным. Можно также использовать API, например `ConfigurationManager` тип .NET Framework.

### <a name="parse-the-connection-string"></a>Анализ строки подключения

Чтобы проанализировать строку подключения, используйте:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L21-L22)]

Он возвращает `CloudStorageAccount`.

### <a name="create-some-local-dummy-data"></a>Создание локальных фиктивных данных

Прежде чем начать, создайте в каталоге нашего скрипта некоторые фиктивные локальные данные. Позже вы отправите эти данные.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L28-L30)]

### <a name="create-the-blob-service-client"></a>Создание клиента службы BLOB-объектов

`CloudBlobClient` Тип позволяет извлекать контейнеры и большие двоичные объекты, хранящиеся в хранилище BLOB-объектов. Вот один из способов создания клиента службы:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L36-L36)]

Теперь все готово для написания кода, считывающего данные из хранилища BLOB-объектов и записывающего данные в него.

## <a name="create-a-container"></a>Создание контейнера

В этом примере показано, как создать контейнер, если он еще не существует:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L42-L46)]

По умолчанию новый контейнер является частным. Это означает, что необходимо указать ключ доступа к хранилищу, чтобы скачать BLOB-объекты из этого контейнера. Если вы хотите сделать файлы в контейнере доступными для всех, можно задать для контейнера значение Public, используя следующий код:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L48-L49)]

Любой пользователь в Интернете может видеть большие двоичные объекты в общедоступном контейнере, но вы можете изменить или удалить их только в том случае, если у вас есть соответствующий ключ доступа к учетной записи или подписанный URL-доступ.

## <a name="upload-a-blob-into-a-container"></a>Отправка большого двоичного объекта в контейнер

Хранилище больших двоичных объектов Azure поддерживает блочные и страничные BLOB-объекты. В большинстве случаев рекомендуемым типом для использования является Блочный BLOB-объект.

Чтобы передать файл в блочный BLOB-объект, получите ссылку на контейнер и используйте его для получения ссылки на блочный BLOB-объект. После получения ссылки на большой двоичный объект можно передать в него любой поток данных, вызвав `UploadFromFile` метод. Эта операция создает большой двоичный объект, если он не существовал ранее, или перезаписывает его, если он существует.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L55-L59)]

## <a name="list-the-blobs-in-a-container"></a>Вывод списка больших двоичных объектов в контейнере

Чтобы получить список больших двоичных объектов в контейнере, сначала получите ссылку на контейнер. Затем можно использовать `ListBlobs` метод контейнера для извлечения больших двоичных объектов и (или) каталогов внутри него. Чтобы получить доступ к широкому набору свойств и методов для `IListBlobItem`возвращаемого значения, необходимо привести его `CloudBlockBlob`к `CloudPageBlob`объекту, `CloudBlobDirectory` или. Если тип неизвестен, можно использовать проверку типа, чтобы определить, какой из них приводится к типу. В следующем коде показано, как получить и вывести URI каждого элемента в `mydata` контейнере:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L67-L80)]

Кроме того, в именах больших двоичных объектов можно присвоить сведения о пути. При этом создается структура виртуального каталога, которую можно упорядочить и просмотреть как традиционную файловую систему. Обратите внимание, что структура каталогов является только виртуальной. единственные ресурсы, доступные в хранилище BLOB-объектов, — это контейнеры и большие двоичные объекты. Однако клиентская библиотека хранилища предоставляет `CloudBlobDirectory` объект для ссылки на виртуальный каталог и упрощает процесс работы с большими двоичными объектами, организованными таким образом.

Например, рассмотрим следующий набор блочных BLOB-объектов в контейнере с `photos`именем:

*photo1. jpg*\
*2015/архитектура/описание. txt*\
*2015/Architecture/photo3. jpg*\
*2015/Architecture/photo4. jpg*\
*2016/Architecture/photo5. jpg*\
*2016/Architecture/photo6. jpg*\
*2016/архитектура/описание. txt*\
*2016/photo7. jpg*\

При вызове `ListBlobs` в контейнере (как в приведенном выше примере) возвращается иерархический список. Если он содержит `CloudBlobDirectory` объекты и `CloudBlockBlob` , представляющие каталоги и большие двоичные объекты в контейнере соответственно, то результирующие выходные данные выглядят примерно так:

```console
Directory: https://<accountname>.blob.core.windows.net/photos/2015/
Directory: https://<accountname>.blob.core.windows.net/photos/2016/
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

При необходимости можно задать `UseFlatBlobListing` для `true`параметра `ListBlobs` метода значение. В этом случае каждый большой двоичный объект в контейнере возвращается как `CloudBlockBlob` объект. Вызов `ListBlobs` для возврата плоского списка выглядит следующим образом:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L82-L89)]

в зависимости от текущего содержимого контейнера результаты выглядят следующим образом:

```console
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2015/architecture/description.txt
Block blob of length 314618: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo3.jpg
Block blob of length 522713: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo4.jpg
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2016/architecture/description.txt
Block blob of length 419048: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo5.jpg
Block blob of length 506388: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo6.jpg
Block blob of length 399751: https://<accountname>.blob.core.windows.net/photos/2016/photo7.jpg
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

## <a name="download-blobs"></a>Скачать BLOB-объекты

Чтобы скачать большие двоичные объекты, сначала извлеките ссылку на большой `DownloadToStream` двоичный объект, а затем вызовите метод. В следующем примере `DownloadToStream` метод используется для передачи содержимого большого двоичного объекта в объект потока, который затем можно сохранить в локальный файл.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L95-L101)]

Можно также использовать `DownloadToStream` метод для загрузки содержимого большого двоичного объекта в виде текстовой строки.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L103-L106)]

## <a name="delete-blobs"></a>Удаление больших двоичных объектов

Чтобы удалить большой двоичный объект, сначала получите ссылку на большой двоичный `Delete` объект, а затем вызовите для него метод.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L112-L116)]

## <a name="list-blobs-in-pages-asynchronously"></a>Асинхронное отображение списка больших двоичных объектов в страницах

Если вы перечислите большое количество больших двоичных объектов или хотите контролировать количество результатов, возвращаемых в одной операции перечисления, можно вывести список больших двоичных объектов на страницах результатов. В этом примере показано, как асинхронно возвращать результаты на страницах, чтобы выполнение не блокировалось в ожидании возврата большого набора результатов.

В этом примере показан плоский список больших двоичных объектов, но можно также выполнить иерархическое построение, задав `useFlatBlobListing` для `false`параметра `ListBlobsSegmentedAsync` метода значение.

В примере определяется асинхронный метод с помощью `async` блока. ``let!`` Ключевое слово приостанавливает выполнение метода Sample до завершения задачи листинга.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L122-L160)]

Теперь мы можем использовать эту асинхронную подпрограммы, как показано ниже. Сначала необходимо отправить некоторые фиктивные данные (с помощью локального файла, созданного ранее в этом руководстве).

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L162-L166)]

Теперь вызовите подпрограммы. Используется `Async.RunSynchronously` для принудительного выполнения асинхронной операции.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L168-L168)]

## <a name="writing-to-an-append-blob"></a>Запись в добавочный BLOB-объект

Добавочный BLOB-объект оптимизирован для операций добавления, таких как ведение журнала. Как и блочный BLOB-объект, добавочный большой двоичный объект состоит из блоков, но при добавлении нового блока в добавочный большой двоичный объект всегда добавляется в конец большого двоичного объекта. Нельзя обновить или удалить существующий блок в добавочном большом двоичном объекте. Идентификаторы блоков для добавочного большого двоичного объекта не предоставляются, так как они предназначены для блочного BLOB-объекта.

Каждый блок в добавочном BLOB-объекте может иметь другой размер, не более 4 МБ, а добавочный BLOB-объект может включать не более 50 000 блоков. Таким образом, максимальный размер добавочного большого двоичного объекта немного превышает 195 ГБ (4 МБ X 50 000 блоков).

В следующем примере создается новый добавочный BLOB-объект и к нему добавляются некоторые данные, имитируя простую операцию ведения журнала.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L174-L203)]

Дополнительные сведения о различиях между тремя типами больших двоичных объектов см. в разделе Основные данные о [блочных и страничных BLOB-](https://msdn.microsoft.com/library/azure/ee691964.aspx) объектах.

## <a name="concurrent-access"></a>Одновременный доступ

Для поддержки одновременного доступа к большому двоичному объекту из нескольких клиентов или нескольких экземпляров процесса можно использовать **теги eTag** или **аренды**.

- **ETag** — позволяет определить, что большой двоичный объект или контейнер был изменен другим процессом

- **Аренда** — предоставляет способ получения монопольного доступа, устанавливать возобновляемую, записи или удаления большого двоичного объекта в течение определенного периода времени.

Дополнительные сведения см. [в разделе Управление параллелизмом в Служба хранилища Microsoft Azure](https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/).

## <a name="naming-containers"></a>Именование контейнеров

Каждый BLOB-объект в хранилище Azure должен находиться в контейнере. Контейнер образует часть имени большого двоичного объекта. Например, `mydata` — это имя контейнера в этих примерах URI больших двоичных объектов:

- https://storagesample.blob.core.windows.net/mydata/blob1.txt
- https://storagesample.blob.core.windows.net/mydata/photos/myphoto.jpg

Имя контейнера должно быть допустимым DNS-именем, удовлетворяющим следующим правилам именования:

1. Имена контейнеров должны начинаться с буквы или цифры и могут содержать только буквы, цифры и знак тире (-).
1. Перед символом дефиса (-) перед ним должна стоять буква или цифра. в именах контейнеров не допускаются последовательные дефисы.
1. Все буквы в имени контейнера должны быть строчными.
1. Имена контейнеров должны иметь длину от 3 до 63 символов.

Обратите внимание, что имя контейнера всегда должно быть строчным. Если вы включили в имя контейнера прописную букву или нарушаете правила именования контейнеров, может возникнуть ошибка 400 (недопустимый запрос).

## <a name="managing-security-for-blobs"></a>Управление безопасностью для больших двоичных объектов

По умолчанию служба хранилища Azure защищает ваши данные, ограничивая доступ к владельцу учетной записи, который имеет ключи доступа к учетной записи. Если необходимо предоставить общий доступ к данным большого двоичного объекта в учетной записи хранения, важно сделать это, не нарушая безопасность ключей доступа к учетной записи. Кроме того, можно зашифровать данные большого двоичного объекта, чтобы обеспечить их безопасность при передаче по сети и в службе хранилища Azure.

### <a name="controlling-access-to-blob-data"></a>Управление доступом к данным большого двоичного объекта

По умолчанию данные большого двоичного объекта в вашей учетной записи хранения доступны только владельцу учетной записи хранения. Для проверки подлинности запросов к хранилищу BLOB-объектов требуется ключ доступа к учетной записи по умолчанию. Однако может потребоваться предоставить другим пользователям доступ к данным большого двоичного объекта.

### <a name="encrypting-blob-data"></a>Шифрование данных больших двоичных объектов

Служба хранилища Azure поддерживает шифрование данных большого двоичного объекта как на клиенте, так и на сервере.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали основы хранилища BLOB-объектов, воспользуйтесь следующими ссылками для получения дополнительных сведений.

### <a name="tools"></a>Сервис

- [F#азуресторажетипепровидер](https://fsprojects.github.io/AzureStorageTypeProvider/)\
Поставщик F# типов, который можно использовать для просмотра ресурсов хранилища Azure BLOB-объектов, таблиц и очередей, а также для простого применения операций CRUD к ним.

- [FSharp. Azure. Storage](https://github.com/fsprojects/FSharp.Azure.Storage)\
F# API для использования службы хранилища таблиц Microsoft Azure

- [Обозреватель службы хранилища Microsoft Azure (MASE)](/azure/vs-azure-tools-storage-manage-with-storage-explorer)\
Бесплатное автономное приложение от корпорации Майкрософт, позволяющее визуально работать с данными службы хранилища Azure в Windows, OS X и Linux.

### <a name="blob-storage-reference"></a>Ссылка на хранилище BLOB-объектов

- [API-интерфейсы службы хранилища Azure для .NET](/dotnet/api/overview/azure/storage)
- [Справочник по службам хранилища Azure REST API](/rest/api/storageservices/Azure-Storage-Services-REST-API-Reference)

### <a name="related-guides"></a>Связанные руководства

- [начало работы с хранилищем BLOB-объектов Azure вC#](https://azure.microsoft.com/resources/samples/storage-blob-dotnet-getting-started/)
- [Перенос данных с помощью служебной программы командной строки AzCopy в Windows](/azure/storage/common/storage-use-azcopy)
- [Перенос данных с помощью служебной программы командной строки AzCopy в Linux](/azure/storage/common/storage-use-azcopy-linux)
- [Настройка строк подключения службы хранилища Azure](/azure/storage/common/storage-configure-connection-string)
- [Блог команды разработчиков службы хранилища Azure](https://blogs.msdn.microsoft.com/windowsazurestorage/)
- [Краткое руководство Создание большого двоичного объекта в хранилище объектов с помощью .NET](/azure/storage/blobs/storage-quickstart-blobs-dotnet)
