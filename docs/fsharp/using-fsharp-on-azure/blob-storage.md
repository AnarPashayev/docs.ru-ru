---
title: Начало работы с хранилищем BLOB-объектов Azure с помощью языка F#
description: Store неструктурированных данных в облаке в хранилище BLOB-объектов Azure.
author: sylvanc
ms.date: 09/20/2016
ms.openlocfilehash: 3d020c2cd9a11db1cd4b7a60113e1be03655f763
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2019
ms.locfileid: "65880036"
---
# <a name="get-started-with-azure-blob-storage-using-f"></a>Начало работы с хранилищем BLOB-объектов Azure, с помощью F\#

Хранилище BLOB-объектов Azure — это служба, которая сохраняет неструктурированные данные в облаке в виде BLOB-объектов. В хранилище BLOB-объектов можно хранить любые типы текстовых или двоичных данных, таких как документы, файлы мультимедиа или установщики приложений. Хранилище BLOB-объектов также называют хранилищем объектов.

В этой статье показано, как выполнять типовые задачи с помощью хранилища BLOB-объектов. Примеры написаны с помощью F# с помощью клиентской библиотеки хранилища Azure для .NET. Задачи, описанные включают как отправка, список, скачивание и удаление больших двоичных объектов.

Общие сведения о хранилище BLOB-объектов, см. в разделе [руководство по .NET для хранилища BLOB-объектов](/azure/storage/storage-dotnet-how-to-use-blobs).

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать это руководство, необходимо сначала [создать учетную запись хранения](/azure/storage/storage-create-storage-account). Вам также потребуется ключ доступа к хранилищу для этой учетной записи.

## <a name="create-an-f-script-and-start-f-interactive"></a>Создание F# сценариев и запустить F# интерактивный

Примеры в этой статье можно использовать в любом F# приложения или F# скрипта. Чтобы создать F# скрипт, создайте файл с `.fsx` расширение, например `blobs.fsx`в вашей F# среды разработки.

Затем используйте [диспетчера пакетов](package-management.md) например [Paket](https://fsprojects.github.io/Paket/) или [NuGet](https://www.nuget.org/) установка `WindowsAzure.Storage` и `Microsoft.WindowsAzure.ConfigurationManager` пакетов и справочник по `WindowsAzure.Storage.dll` и `Microsoft.WindowsAzure.Configuration.dll` в скрипт с помощью `#r` директива.

### <a name="add-namespace-declarations"></a>Добавьте объявления пространств имен

Добавьте следующий `open` операторы в верхнюю часть `blobs.fsx` файла:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L1-L5)]

### <a name="get-your-connection-string"></a>Получить строку подключения

В этом руководстве необходимо строки подключения к службе хранилища Azure. Дополнительные сведения о строках подключения см. в разделе [Настройка строк подключения службы хранилища](/azure/storage/storage-configure-connection-string).

Для этого руководства введите строку подключения в скрипте, следующим образом:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L11-L11)]

Однако это **не рекомендуется** реальных проектов. Ключ учетной записи хранения похож на корневой пароль для учетной записи хранения. Не забудьте защитить ключ учетной записи хранения. Избегайте распределения его другим пользователям, в коде, или сохранить его в текстовом файле, доступном другим пользователям. Можно повторно создать ключ с помощью портала Azure, если вы считаете, что он мог быть скомпрометирован.

Для реальных приложений, чтобы сохранить строку подключения хранилища рекомендуется в файле конфигурации. Чтобы получить строку подключения из файла конфигурации, это можно сделать:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L13-L15)]

Использование диспетчера конфигураций Azure не является обязательным. Можно также использовать API, например .NET Framework `ConfigurationManager` типа.

### <a name="parse-the-connection-string"></a>Проанализировать строку подключения

Чтобы проанализировать строку подключения, используйте следующую команду:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L21-L22)]

Эта команда возвращает `CloudStorageAccount`.

### <a name="create-some-local-dummy-data"></a>Создание локального фиктивный данных

Прежде чем начать, создайте некоторые фиктивные локальных данных в каталоге нашего сценария. Затем можно загрузить эти данные.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L28-L30)]

### <a name="create-the-blob-service-client"></a>Создание клиента службы BLOB-объектов

`CloudBlobClient` Тип позволяет извлекать контейнеры и большие двоичные объекты, хранящиеся в хранилище BLOB-объектов. Вот один из способов создания клиента службы:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L36-L36)]

Теперь вы готовы написать код, который считывает и записывает данные в хранилище BLOB-объектов.

## <a name="create-a-container"></a>Создание контейнера

В этом примере показано, как создать контейнер, если он еще не существует:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L42-L46)]

По умолчанию новый контейнер является закрытым. Это значит, что необходимо указать ключ доступа к хранилищу, чтобы скачать большие двоичные объекты из этого контейнера. Если вы хотите сделать файлы в контейнере доступными для всех пользователей, можно разместить контейнер открытым, используя следующий код:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L48-L49)]

Любой пользователь в Интернете может видеть большие двоичные объекты в общедоступном контейнере, но можно изменить или удалить их только в том случае, если у вас есть ключа доступа или подписанный URL-адрес.

## <a name="upload-a-blob-into-a-container"></a>Отправка большого двоичного объекта в контейнер

Хранилище BLOB-объектов поддерживает блочные и страничные. В большинстве случаев большой двоичный объект является типом, рекомендуемые для использования.

Для отправки файла в блочный большой двоичный объект, получите ссылку на контейнер и используйте ее для получения ссылку на большой двоичный объект блока. Получив ссылку на BLOB-объектов, можно отправить любой поток данных к нему путем вызова `UploadFromFile` метод. Эта операция создает большой двоичный объект, если он не был ранее существует, или заменяет его, если он существует.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L55-L59)]

## <a name="list-the-blobs-in-a-container"></a>Перечисление больших двоичных объектов в контейнере

Чтобы получить список больших двоичных объектов в контейнере, сначала нужно получите ссылку на контейнер. Затем можно использовать контейнер `ListBlobs` метод для извлечения больших двоичных объектов и (или) каталогов внутри него. Чтобы получить доступ к широкому набору свойств и методов возвращаемого `IListBlobItem`, необходимо преобразовать его в `CloudBlockBlob`, `CloudPageBlob`, или `CloudBlobDirectory` объекта. Если тип неизвестен, можно использовать проверку типов, чтобы определить, какие для приведения. Следующий код показывает, как получить и вывести URI каждого элемента в `mydata` контейнера:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L67-L80)]

Вы также можете имя BLOB-объектов с информацией о пути в их именах. Это создает структуры виртуальных каталогов, которые можно упорядочивать и просматривать, как и традиционную файловую систему. Обратите внимание, что структура каталогов является виртуальным только - только ресурсы, доступные в хранилище BLOB-объектов, контейнеров и больших двоичных объектов. Однако клиентская библиотека хранилища предоставляет `CloudBlobDirectory` объекта к виртуальному каталогу и упростить процесс работы с большими двоичными объектами, которые упорядочены таким образом.

Например, рассмотрим следующий набор блочных BLOB-объектов в контейнере с именем `photos`:

*photo1.jpg*\
*2015/Architecture/Description.txt*\
*2015/Architecture/photo3.jpg*\
*2015/Architecture/photo4.jpg*\
*2016/Architecture/photo5.jpg*\
*2016/Architecture/photo6.jpg*\
*2016/Architecture/Description.txt*\
*2016/photo7.jpg*\

При вызове `ListBlobs` в контейнере (как в примере выше) возвращается иерархический список. Если он содержит оба `CloudBlobDirectory` и `CloudBlockBlob` объекты, представляющие каталоги и большие двоичные объекты в контейнере, соответственно, а затем полученный результат выглядит примерно так:

```console
Directory: https://<accountname>.blob.core.windows.net/photos/2015/
Directory: https://<accountname>.blob.core.windows.net/photos/2016/
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

При необходимости можно задать `UseFlatBlobListing` параметр `ListBlobs` метод `true`. В этом случае каждый большой двоичный объект в контейнере возвращается в виде `CloudBlockBlob` объекта. Вызов `ListBlobs` для возврата неструктурированного списка выглядит следующим образом:

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L82-L89)]

и, в зависимости от текущего содержимого контейнера, результаты будут выглядеть следующим образом:

```console
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2015/architecture/description.txt
Block blob of length 314618: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo3.jpg
Block blob of length 522713: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo4.jpg
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2016/architecture/description.txt
Block blob of length 419048: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo5.jpg
Block blob of length 506388: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo6.jpg
Block blob of length 399751: https://<accountname>.blob.core.windows.net/photos/2016/photo7.jpg
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

## <a name="download-blobs"></a>Скачивание больших двоичных объектов

Чтобы скачать большие двоичные объекты, сначала нужно получить ссылку на BLOB-объектов, а затем вызовите `DownloadToStream` метод. В следующем примере используется `DownloadToStream` метод для переноса содержимого большого двоичного объекта в объект потока, который затем можно сохранить в локальном файле.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L95-L101)]

Можно также использовать `DownloadToStream` метод для загрузки содержимого большого двоичного объекта в виде текстовой строки.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L103-L106)]

## <a name="delete-blobs"></a>Удаление больших двоичных объектов

Чтобы удалить большой двоичный объект, сначала получите ссылку на BLOB-объектов, а затем вызовите `Delete` для него метода.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L112-L116)]

## <a name="list-blobs-in-pages-asynchronously"></a>Асинхронно больших двоичных объектов в страницы

Если вы хотите контролировать количество результатов, возвращаемых в одной операцией получения листинга расположить большое количество больших двоичных объектов, можно больших двоичных объектов в страницы результатов. В этом примере показано, как асинхронно возвращать результаты для того, чтобы не блокировать выполнение ожиданием большого объема возвращаемых результатов.

В этом примере показано плоского списка больших двоичных объектов, но можно также выполнить иерархический список, задав `useFlatBlobListing` параметр `ListBlobsSegmentedAsync` метод `false`.

Образец определяет асинхронный метод, с помощью `async` блока. ``let!`` Ключевое слово приостанавливает выполнение примера метода, до завершения задачи в список.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L122-L160)]

Теперь мы можем использовать этот асинхронные подпрограммы следующим образом. Сначала вам необходимо отправить некоторые фиктивные данные (с помощью локальный файл, созданный ранее в этом руководстве).

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L162-L166)]

Теперь вызовите процедуру. Использовании `Async.RunSynchronously` для принудительного выполнения асинхронной операции.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L168-L168)]

## <a name="writing-to-an-append-blob"></a>Запись в добавочный BLOB-объект

Добавочный большой двоичный объект оптимизирован для операций добавления, например ведения журнала. Как и блочный BLOB-объект добавочный большой двоичный объект состоит из блоков, но при добавлении нового блока в добавочный большой двоичный объект, он всегда добавляется в конец большого двоичного объекта. Невозможно обновить или удалить существующий блок в добавочном большом двоичном объекте. Идентификаторы блоков в добавочном большом двоичном объекте не отображаются, как они предназначены для блочных BLOB-объектов.

Каждый блок в добавочном большом двоичном объекте может иметь разный размер, не более 4 МБ и добавочный большой двоичный объект может содержать не более 50 000 блоков. Таким образом, максимальный размер добавочный большой двоичный объект является немного более 195 ГБ (4 МБ X 50 000 блоков).

Следующий пример создает новый добавочный большой двоичный объект и добавляет некоторые данные, имитируя простые операции ведение журнала.

[!code-fsharp[BlobStorage](../../../samples/snippets/fsharp/azure/blob-storage.fsx#L174-L203)]

См. в разделе [основные сведения о блочных, страничных и добавочных](https://msdn.microsoft.com/library/azure/ee691964.aspx) Дополнительные сведения о различиях между тремя типами больших двоичных объектов.

## <a name="concurrent-access"></a>Одновременный доступ

Для поддержки параллельного доступа к большому двоичному объекту из нескольких клиентов или экземпляров процесса, можно использовать **теги eTag** или **аренды**.

* **ETag** -позволяет обнаружить, что большой двоичный объект или контейнер были изменены другим процессом

* **Аренда** -предоставляет способ получить монопольный обновляемый запись или удаление доступа к большому двоичному объекту в течение заданного времени

Дополнительные сведения см. в разделе [управление параллелизмом в хранилище Microsoft Azure](https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/).

## <a name="naming-containers"></a>Контейнеры именования

Каждый большой двоичный объект в службе хранилища Azure должны находиться в контейнере. Контейнер составляет часть имени BLOB-объектов. Например `mydata` имя контейнера в этих URI BLOB-образец объектов:

- https://storagesample.blob.core.windows.net/mydata/blob1.txt
- https://storagesample.blob.core.windows.net/mydata/photos/myphoto.jpg

Имя контейнера должно быть допустимым DNS-именем, удовлетворяющие следующим правилам именования:

1. Имена контейнеров должны начинаться с буквы или цифры и может содержать только буквы, цифры и дефис (-).
1. Каждого символа дефиса (-) непосредственно перед и после него должны буква или цифра; последовательные дефисы не допускаются в именах контейнеров.
1. Все буквы в имени контейнера должны быть строчными.
1. Имени контейнера должна составлять от 3 до 63 символов.

Обратите внимание на то, что имя контейнера всегда должен быть нижнего регистра. Если вы включите является буквой верхнего регистра в имени контейнера или другом нарушении правил именования контейнера, может появиться ошибку 400 (неправильный запрос).

## <a name="managing-security-for-blobs"></a>Управление безопасностью для больших двоичных объектов

По умолчанию службы хранилища Azure защищает ваши данные, ограничивая доступ к владелец учетной записи, у которого есть ключи доступа учетной записи. Если вам нужно совместно использовать данные большого двоичного объекта в учетной записи хранения, очень важно сделать это без ущерба для безопасности ключей доступа учетной записи. Кроме того можно зашифровать данные больших двоичных объектов, чтобы обеспечить безопасную отправку по сети и в службе хранилища Azure.

### <a name="controlling-access-to-blob-data"></a>Управление доступом к данным BLOB-объектов

По умолчанию данные больших двоичных объектов в учетной записи хранения доступен только владельцу учетной записи хранения. Проверка подлинности запросов к хранилищу BLOB-объектов требуется ключ доступа учетной записи по умолчанию. Тем не менее может потребоваться сделать определенные данные больших двоичных объектов доступным другим пользователям.

### <a name="encrypting-blob-data"></a>Шифрование данных больших двоичных объектов

Служба хранилища Azure поддерживает шифрование данных больших двоичных объектов, как на стороне клиента, так и на сервере.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали основные сведения о хранилище BLOB-объектов, используйте следующие ссылки для получения дополнительных сведений.

### <a name="tools"></a>Инструменты

- [F#AzureStorageTypeProvider](https://fsprojects.github.io/AzureStorageTypeProvider/)\
F# Тип поставщика, который может использоваться для просмотра ресурсов BLOB-объектов, таблиц и хранилища очередей Azure и легко применить с ними операции CRUD.

- [FSharp.Azure.Storage](https://github.com/fsprojects/FSharp.Azure.Storage)\
F# API за использование службы хранилища таблиц Microsoft Azure

- [Обозреватель хранилищ Microsoft Azure (MASE)](/azure/vs-azure-tools-storage-manage-with-storage-explorer)\
Это бесплатное автономное приложение от корпорации Майкрософт, который позволяет визуально работать с данными из хранилища Azure в Windows, OS X и Linux.

### <a name="blob-storage-reference"></a>Справочник по хранилища BLOB-объектов

- [API службы хранилища Azure для .NET](/dotnet/api/overview/azure/storage)
- [Справочник по API REST служб хранилища Azure](/rest/api/storageservices/Azure-Storage-Services-REST-API-Reference)

### <a name="related-guides"></a>Связанные руководства

- [Приступая к работе с хранилищем BLOB-объектов Azure в C#](https://azure.microsoft.com/resources/samples/storage-blob-dotnet-getting-started/)
- [Перенос данных с помощью программы командной строки AzCopy для Windows](/azure/storage/common/storage-use-azcopy)
- [Перенос данных с помощью служебной программы командной строки AzCopy для Linux](/azure/storage/common/storage-use-azcopy-linux)
- [Настройка строк подключения службы хранилища Azure](/azure/storage/common/storage-configure-connection-string)
- [Блог группы разработчиков хранилища Azure](https://blogs.msdn.microsoft.com/windowsazurestorage/)
- [Краткое руководство. Создание большого двоичного объекта в хранилище объектов с помощью .NET](/azure/storage/blobs/storage-quickstart-blobs-dotnet)
