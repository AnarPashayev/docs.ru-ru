---
title: Начало работы с хранилищем BLOB-объектов Azure с помощью языка F#
description: Храните неструктурированные данные в облаке с помощью хранилища BLOB-объектов Azure.
author: sylvanc
ms.date: 09/20/2016
ms.openlocfilehash: 90ec0d63b11ad00c53a1740211e9a6509582e863
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75935506"
---
# <a name="get-started-with-azure-blob-storage-using-f"></a>Приступая к работе с хранилищем BLOB-объектов Azure с помощью F\#

Хранилище BLOB-объектов Azure — это служба, которая сохраняет неструктурированные данные в облаке в виде BLOB-объектов. В хранилище BLOB-объектов можно хранить любые типы текстовых или двоичных данных, таких как документы, файлы мультимедиа или установщики приложений. Хранилище BLOB-объектов также называют хранилищем объектов.

В этой статье показано, как выполнять общие задачи с помощью хранилища BLOB-объектов. Примеры написаны с F# помощью клиентской библиотеки службы хранилища Azure для .NET. В рассмотренных задачах содержатся сведения о передаче, перечислении, скачивании и удалении больших двоичных объектов.

Общие сведения о хранилище BLOB-объектов см. [в этом](/azure/storage/storage-dotnet-how-to-use-blobs)разделе.

## <a name="prerequisites"></a>Prerequisites

Для работы с этим руководством необходимо сначала [создать учетную запись хранения Azure](/azure/storage/storage-create-storage-account). Вам также потребуется ключ доступа к хранилищу для этой учетной записи.

## <a name="create-an-f-script-and-start-f-interactive"></a>Создание F# скрипта и запуск F# интерактивного

Примеры в этой статье можно использовать как в F# приложении, так и в F# сценарии. Чтобы создать F# скрипт, создайте файл с расширением `.fsx`, например `blobs.fsx`, в среде F# разработки.

Затем используйте [Диспетчер пакетов](package-management.md) , например [пакет](https://fsprojects.github.io/Paket/) или [NuGet](https://www.nuget.org/) , для установки пакетов `WindowsAzure.Storage` и `Microsoft.WindowsAzure.ConfigurationManager`, а также ссылки на `WindowsAzure.Storage.dll` и `Microsoft.WindowsAzure.Configuration.dll` в скрипте с помощью директивы `#r`.

### <a name="add-namespace-declarations"></a>Добавление объявлений пространств имен

Добавьте в начало файла `blobs.fsx` следующие инструкции `open`:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L1-L5)]

### <a name="get-your-connection-string"></a>Получение строки подключения

Для работы с этим руководством требуется строка подключения к службе хранилища Azure. Дополнительные сведения о строках подключения см. в разделе [Настройка строк подключения к хранилищу](/azure/storage/storage-configure-connection-string).

В этом руководстве вы вводите строку подключения в скрипте следующим образом:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L11-L11)]

Однако это **не рекомендуется** для реальных проектов. Ключ учетной записи хранения похож на корневой пароль для вашей учетной записи хранения. Не забудьте защитить ключ учетной записи хранения. Не сообщайте его другим пользователям, не определяйте его в коде и не храните его в текстовом файле, доступном другим пользователям. Вы можете повторно создать ключ с помощью портала Azure, если считаете, что он был скомпрометирован.

Для реальных приложений лучшим способом поддержания строки подключения к хранилищу является файл конфигурации. Чтобы получить строку подключения из файла конфигурации, можно сделать следующее:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L13-L15)]

Использование диспетчера конфигураций Azure не является обязательным. Можно также использовать API, например тип `ConfigurationManager` .NET Framework.

### <a name="parse-the-connection-string"></a>Проанализируйте строку подключения

Чтобы проанализировать строку подключения, используйте:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L21-L22)]

Это возвращает `CloudStorageAccount`.

### <a name="create-some-local-dummy-data"></a>Создание локальных фиктивных данных

Прежде чем начать, создайте в каталоге нашего скрипта некоторые фиктивные локальные данные. Позже вы отправите эти данные.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L28-L30)]

### <a name="create-the-blob-service-client"></a>Создание клиента службы BLOB-объектов

Тип `CloudBlobClient` позволяет извлекать контейнеры и большие двоичные объекты, хранящиеся в хранилище BLOB-объектов. Вот один из способов создать клиента службы.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L36-L36)]

Теперь вы можете написать код, который считывает и записывает данные в хранилище BLOB-объектов.

## <a name="create-a-container"></a>Создание контейнера

В этом примере показано, как создать контейнер:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L42-L46)]

По умолчанию новый контейнер является закрытым. Это значит, что вам нужно указать ключ доступа к хранилищу, чтобы загрузить большие двоичные объекты из этого контейнера. Чтобы сделать файлы в этом контейнере доступными для всех пользователей, сделайте контейнер открытым, используя следующий код:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L48-L49)]

Любой пользователь в Интернете может видеть большие двоичные объекты в открытом контейнере, но изменить или удалить их можно только при наличии ключа доступа или подписанного URL-адреса.

## <a name="upload-a-blob-into-a-container"></a>Отправка BLOB-объекта в контейнер

Хранилище BLOB-объектов Azure поддерживает блочные и страничные BLOB-объекты. В большинстве случаев рекомендуемым типом для использования является Блочный BLOB-объект.

Для передачи файла в блочный BLOB-объект получите ссылку на контейнер и используйте ее для получения ссылки на блочный BLOB-объект. После получения ссылки на большой двоичный объект можно передать в него любой поток данных, вызвав метод `UploadFromFile`. Эта операция создает большой двоичный объект, если он не существовал ранее, или перезаписывает его, если он существует.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L55-L59)]

## <a name="list-the-blobs-in-a-container"></a>Перечисление BLOB-объектов в контейнере

Для перечисления BLOB-объектов в контейнере сначала необходимо получить ссылку на контейнер. Затем можно использовать метод `ListBlobs` контейнера для извлечения больших двоичных объектов и (или) каталогов внутри него. Чтобы получить доступ к обширному набору свойств и методов для возвращаемого `IListBlobItem`, необходимо привести его к `CloudBlockBlob`, `CloudPageBlob`или объекту `CloudBlobDirectory`. Если тип неизвестен, можно использовать проверку типов, чтобы определить нужный тип. Следующий код демонстрирует, как получить и вывести URI каждого элемента в контейнере `mydata` :

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L67-L80)]

Кроме того, в именах больших двоичных объектов можно присвоить сведения о пути. Таким образом, создается такая структура виртуальных каталогов, которую можно организовывать и просматривать, как и традиционную файловую систему. Обратите внимание, что используется только структура виртуальных каталогов, так как единственные ресурсы, доступные в хранилище больших двоичных объектов, — контейнеры и большие двоичные объекты. Однако клиентская библиотека хранилища предоставляет объект `CloudBlobDirectory` для ссылки на виртуальный каталог и упрощает процесс работы с большими двоичными объектами, организованными таким образом.

Например, рассмотрим следующий набор блочных BLOB-объектов в контейнере с именем `photos`:

*photo1. jpg*\
\ *2015/архитектура/описание. txt*
*2015/Architecture/photo3. jpg*\
*2015/Architecture/photo4. jpg*\
*2016/Architecture/photo5. jpg*\
*2016/Architecture/photo6. jpg*\
\ " *архитектура"/"описание. txt* "
*2016 или photo7. jpg*\

При вызове `ListBlobs` для контейнера (как в приведенном выше примере) возвращается иерархический список. Если он содержит объекты `CloudBlobDirectory` и `CloudBlockBlob`, представляющие каталоги и большие двоичные объекты в контейнере соответственно, результирующие выходные данные выглядят примерно так:

```console
Directory: https://<accountname>.blob.core.windows.net/photos/2015/
Directory: https://<accountname>.blob.core.windows.net/photos/2016/
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

При необходимости можно задать для параметра `UseFlatBlobListing` метода `ListBlobs` значение `true`. В этом случае каждый большой двоичный объект в контейнере возвращается как объект `CloudBlockBlob`. Вызов `ListBlobs` для возврата плоского списка выглядит следующим образом:

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L82-L89)]

в зависимости от текущего содержимого контейнера результаты выглядят следующим образом:

```console
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2015/architecture/description.txt
Block blob of length 314618: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo3.jpg
Block blob of length 522713: https://<accountname>.blob.core.windows.net/photos/2015/architecture/photo4.jpg
Block blob of length 4: https://<accountname>.blob.core.windows.net/photos/2016/architecture/description.txt
Block blob of length 419048: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo5.jpg
Block blob of length 506388: https://<accountname>.blob.core.windows.net/photos/2016/architecture/photo6.jpg
Block blob of length 399751: https://<accountname>.blob.core.windows.net/photos/2016/photo7.jpg
Block blob of length 505623: https://<accountname>.blob.core.windows.net/photos/photo1.jpg
```

## <a name="download-blobs"></a>Скачивание больших двоичных объектов

Чтобы скачать большие двоичные объекты, сначала извлеките ссылку на большой двоичный объект, а затем вызовите метод `DownloadToStream`. В следующем примере используется метод `DownloadToStream` для передачи содержимого большого двоичного объекта в объект потока, который затем можно сохранить в локальном файле.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L95-L101)]

Можно также использовать метод `DownloadToStream` для загрузки содержимого большого двоичного объекта в виде текстовой строки.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L103-L106)]

## <a name="delete-blobs"></a>удаление больших двоичных объектов.

Чтобы удалить большой двоичный объект, сначала получите ссылку на большой двоичный объект, а затем вызовите для него метод `Delete`.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L112-L116)]

## <a name="list-blobs-in-pages-asynchronously"></a>Асинхронное перечисление BLOB-объектов в страницах

Если вам нужно расположить большое количество BLOB-объектов или вы хотите управлять отображением количества объектов в результате запроса, вы можете задать расположение BLOB-объектов на странице. В этом примере вы узнаете, как расположить запрошенные результаты на странице асинхронно для того, чтобы не блокировать выполнение задачи ожиданием большого объема возвращаемых данных.

В этом примере показан плоский список больших двоичных объектов, но можно также выполнить иерархическое построение, установив для параметра `useFlatBlobListing` метода `ListBlobsSegmentedAsync` значение `false`.

В примере определяется асинхронный метод с помощью блока `async`. Ключевое слово ``let!`` приостанавливает выполнение метода Sample до завершения задачи листинга.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L122-L160)]

Теперь мы можем использовать эту асинхронную подпрограммы, как показано ниже. Сначала необходимо отправить некоторые фиктивные данные (с помощью локального файла, созданного ранее в этом руководстве).

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L162-L166)]

Теперь вызовите подпрограммы. Для принудительного выполнения асинхронной операции используется `Async.RunSynchronously`.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L168-L168)]

## <a name="writing-to-an-append-blob"></a>Запись в расширенный большой двоичный объект

Добавочный большой двоичный объект оптимизирован для операций добавления, например ведения журналов. Как и блочный BLOB-объект, добавочный большой двоичный объект состоит из блоков, но при добавлении нового блока в добавочный большой двоичный объект он всегда добавляется в конец этого объекта. Вы не можете обновить или удалить существующий блок в добавочном большом двоичном объекте. Идентификаторы блоков в добавочном большом двоичном объекте не отображаются, как в блочном BLOB-объекте.

Каждый блок в добавочном большом двоичном объекте может иметь разный размер (не более 4 МБ), кроме того, добавочный большой двоичный объект может содержать не более 50 000 блоков. Таким образом, максимальный размер добавочного большого двоичного объекта немного превышает 195 ГБ (4 МБ X 50 000 блоков).

В следующем примере создается новый добавочный BLOB-объект и к нему добавляются некоторые данные, имитируя простую операцию ведения журнала.

[!code-fsharp[BlobStorage](~/samples/snippets/fsharp/azure/blob-storage.fsx#L174-L203)]

Дополнительные сведения о различиях между тремя типами больших двоичных объектов см. в статье [Основные сведения о блочных, страничных и добавочных BLOB-объектах](https://msdn.microsoft.com/library/azure/ee691964.aspx).

## <a name="concurrent-access"></a>Одновременный доступ

Чтобы реализовать одновременный доступ нескольких клиентов или экземпляров процесса к BLOB-объекту, можно использовать **ETags** или **lease**.

- **Etag** — позволяет обнаружить, что BLOB-объект или контейнер были изменены другим процессом

- **Lease** — аренда позволяет получить монопольный обновляемый доступ к BLOB-объекту на запись или удаление в течение заданного периода времени.

Дополнительные сведения см. [в разделе Управление параллелизмом в Служба хранилища Microsoft Azure](https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/).

## <a name="naming-containers"></a>Именование контейнеров

Каждый BLOB-объект в Azure должен располагаться в контейнере. Контейнер составляет часть имени BLOB-объекта. Например, `mydata` — имя контейнера в таких взятых в качестве образца URI BLOB-объектов:

- https://storagesample.blob.core.windows.net/mydata/blob1.txt
- https://storagesample.blob.core.windows.net/mydata/photos/myphoto.jpg

Имя контейнера должно быть допустимым DNS-именем и соответствовать указанным ниже правилам именования.

1. Имена контейнеров должны начинаться с буквы или цифры и могут содержать только буквы, цифры и тире (-).
1. Каждое тире (-) должно стоять непосредственно перед буквой или цифрой и после нее. В именах контейнеров запрещено использовать несколько тире подряд.
1. Все знаки в имени контейнера должны быть строчными.
1. Имя контейнера должно содержать от 3 до 63 знаков.

Обратите внимание, что имя контейнера должно содержать только строчные буквы. При использовании заглавных букв в имени контейнера или другом нарушении правил именования контейнера может появиться ошибка 400 (Ошибка запроса).

## <a name="managing-security-for-blobs"></a>Управление системой безопасности больших двоичных объектов

По умолчанию служба хранилища Azure защищает данные, ограничивая доступ к учетной записи пользователя, который владеет ключами доступа к учетной записи. Если вы хотите предоставить доступ к данным больших двоичных объектов в своей учетной записи хранения, важно сделать это без ущерба для безопасности ключей доступа к учетной записи. Кроме того, вы можете зашифровать данные больших двоичных объектов, чтобы обеспечить их безопасную отправку по сети в службу хранилища Azure.

### <a name="controlling-access-to-blob-data"></a>Управление доступом к данным больших двоичных объектов

По умолчанию данные больших двоичных объектов в учетной записи хранения доступны только владельцу учетной записи хранения. По умолчанию для проверки подлинности запросов к хранилищу BLOB-объектов требуется ключ доступа к учетной записи. Однако может потребоваться предоставить другим пользователям доступ к данным большого двоичного объекта.

### <a name="encrypting-blob-data"></a>Шифрование данных больших двоичных объектов

Служба хранилища Azure поддерживает шифрование данных большого двоичного объекта как на клиенте, так и на сервере.

## <a name="next-steps"></a>Следующие шаги

Вы ознакомились с базовыми понятиями о хранилище BLOB-объектов. Дополнительные сведения см. по следующим ссылкам.

### <a name="tools"></a>Средства .

- [ F# Азуресторажетипепровидер](https://fsprojects.github.io/AzureStorageTypeProvider/)\
Поставщик F# типов, который можно использовать для просмотра ресурсов хранилища Azure BLOB-объектов, таблиц и очередей, а также для простого применения операций CRUD к ним.

- [FSharp. Azure. Storage](https://github.com/fsprojects/FSharp.Azure.Storage)\
F# API для использования службы хранилища таблиц Microsoft Azure

- [Обозреватель службы хранилища Microsoft Azure (MASE)](/azure/vs-azure-tools-storage-manage-with-storage-explorer)\
Бесплатное автономное приложение от корпорации Майкрософт, позволяющее визуально работать с данными службы хранилища Azure в Windows, OS X и Linux.

### <a name="blob-storage-reference"></a>Справочная документация по хранилищу BLOB-объектов

- [API-интерфейсы хранилища Azure для .NET](/dotnet/api/overview/azure/storage)
- [Azure Storage Services REST API Reference](/rest/api/storageservices/Azure-Storage-Services-REST-API-Reference) (Справочник по REST API службы хранилища Azure)

### <a name="related-guides"></a>Связанные руководства

- [начало работы с хранилищем BLOB-объектов Azure вC#](https://azure.microsoft.com/resources/samples/storage-blob-dotnet-getting-started/)
- [Перенос данных с помощью служебной программы командной строки AzCopy в Windows](/azure/storage/common/storage-use-azcopy)
- [Перенос данных с помощью служебной программы командной строки AzCopy в Linux](/azure/storage/common/storage-use-azcopy-linux)
- [Настройка строк подключения службы хранилища Azure](/azure/storage/common/storage-configure-connection-string)
- [Блог рабочей группы службы хранилища Azure](https://docs.microsoft.com/archive/blogs/windowsazurestorage/)
- [Краткое руководство. Создание большого двоичного объекта в хранилище объектов с помощью .NET](/azure/storage/blobs/storage-quickstart-blobs-dotnet)
