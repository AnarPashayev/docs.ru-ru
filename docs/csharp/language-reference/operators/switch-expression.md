---
title: Выражение switch в справочнике по C#
description: Узнайте, как использовать выражение switch в C# для сопоставления шаблонов и других самоанализов данных.
ms.date: 01/14/2021
ms.openlocfilehash: 55fef8d351b178fd0ec23847e81e6c56eb1367b0
ms.sourcegitcommit: 3a8f1979a98c6c19217a1930e0af5908988eb8ba
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/16/2021
ms.locfileid: "98536090"
---
# <a name="switch-expression-c-reference"></a><span data-ttu-id="e53bf-103">Выражение switch (справочник по C#)</span><span class="sxs-lookup"><span data-stu-id="e53bf-103">switch expression (C# reference)</span></span>

<span data-ttu-id="e53bf-104">В этой статье рассматривается выражение `switch`, представленное в C# 8.0.</span><span class="sxs-lookup"><span data-stu-id="e53bf-104">This article covers the `switch` expression, introduced in C# 8.0.</span></span> <span data-ttu-id="e53bf-105">Дополнительные сведения об инструкции `switch` см. в статье [`switch`switch (справочник по C#)](../keywords/switch.md) в разделе [Ключевые слова C#](../keywords/index.md).</span><span class="sxs-lookup"><span data-stu-id="e53bf-105">For information on the `switch` statement, see the article on the [`switch` statement](../keywords/switch.md) in the [statements](../keywords/index.md) section.</span></span>

## <a name="basic-example"></a><span data-ttu-id="e53bf-106">Простой пример</span><span class="sxs-lookup"><span data-stu-id="e53bf-106">Basic example</span></span>

<span data-ttu-id="e53bf-107">Выражение `switch` предоставляет в контексте выражения семантику, аналогичную `switch`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-107">The `switch` expression provides for `switch`-like semantics in an expression context.</span></span> <span data-ttu-id="e53bf-108">Оно предоставляет краткий синтаксис, когда ветви switch возвращают значение.</span><span class="sxs-lookup"><span data-stu-id="e53bf-108">It provides a concise syntax when the switch arms produce a value.</span></span> <span data-ttu-id="e53bf-109">В следующем примере показана структура выражения switch.</span><span class="sxs-lookup"><span data-stu-id="e53bf-109">The following example shows the structure of a switch expression.</span></span> <span data-ttu-id="e53bf-110">Оно преобразует значения из `enum`, представляя визуальные направления в интерактивном сопоставлении с соответствующим направлением кардинала:</span><span class="sxs-lookup"><span data-stu-id="e53bf-110">It translates values from an `enum` representing visual directions in an online map to the corresponding cardinal direction:</span></span>

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetBasicStructure":::

<span data-ttu-id="e53bf-111">В предыдущем примере показаны основные элементы выражения switch:</span><span class="sxs-lookup"><span data-stu-id="e53bf-111">The preceding sample shows the basic elements of a switch expression:</span></span>

- <span data-ttu-id="e53bf-112">*Выражение диапазона*. В предыдущем примере в качестве выражения диапазона используется переменная `direction`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-112">The *range expression*: The preceding example uses the variable `direction` as the range expression.</span></span>
- <span data-ttu-id="e53bf-113">*Ветви выражения switch*. Каждая ветвь выражения switch содержит *шаблон*, необязательное *условие регистра*, маркер `=>` и *выражение*.</span><span class="sxs-lookup"><span data-stu-id="e53bf-113">The *switch expression arms*: Each switch expression arm contains a *pattern*, an optional *case guard*, the `=>` token, and an *expression*.</span></span>

<span data-ttu-id="e53bf-114">Результатом *выражения switch* является значение выражения первой *ветви выражения switch*, чей *шаблон* совпадает с *выражением диапазона*, а *условие регистра*, если таковое есть, принимает `true`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-114">The result of the *switch expression* is the value of the expression of the first *switch expression arm* whose *pattern* matches the *range expression* and whose *case guard*, if present, evaluates to `true`.</span></span> <span data-ttu-id="e53bf-115">*Выражение* справа от маркера `=>` не может быть оператором выражения.</span><span class="sxs-lookup"><span data-stu-id="e53bf-115">The *expression* on the right of the `=>` token can't be an expression statement.</span></span>

<span data-ttu-id="e53bf-116">*Ветви выражения switch* оцениваются в текстовом порядке.</span><span class="sxs-lookup"><span data-stu-id="e53bf-116">The *switch expression arms* are evaluated in text order.</span></span> <span data-ttu-id="e53bf-117">Если выбрать нижнюю *ветвь выражения switch* не удается,поскольку верхняя *ветвь выражения switch* соответствует всем его значениям, компилятор выдает ошибку.</span><span class="sxs-lookup"><span data-stu-id="e53bf-117">The compiler issues an error when a lower *switch expression arm* can't be chosen because a higher *switch expression arm* matches all its values.</span></span>

## <a name="patterns-and-case-guards"></a><span data-ttu-id="e53bf-118">Шаблоны и условия использования</span><span class="sxs-lookup"><span data-stu-id="e53bf-118">Patterns and case guards</span></span>

<span data-ttu-id="e53bf-119">В выражениях switch поддерживаются многие шаблоны.</span><span class="sxs-lookup"><span data-stu-id="e53bf-119">Many patterns are supported in switch expression arms.</span></span> <span data-ttu-id="e53bf-120">В предыдущем примере использовался *шаблон константы*.</span><span class="sxs-lookup"><span data-stu-id="e53bf-120">The preceding example uses a *constant pattern*.</span></span> <span data-ttu-id="e53bf-121">*Шаблон константы* сравнивает выражение диапазона со значением.</span><span class="sxs-lookup"><span data-stu-id="e53bf-121">A *constant pattern* compares the range expression to a value.</span></span> <span data-ttu-id="e53bf-122">Это значение должно быть константой времени компиляции.</span><span class="sxs-lookup"><span data-stu-id="e53bf-122">That value must be a compile-time constant.</span></span> <span data-ttu-id="e53bf-123">*Шаблон типа* сравнивает выражение диапазона с известным типом.</span><span class="sxs-lookup"><span data-stu-id="e53bf-123">The *type pattern* compares the range expression to a known type.</span></span> <span data-ttu-id="e53bf-124">В следующем примере из последовательности извлекается третий элемент.</span><span class="sxs-lookup"><span data-stu-id="e53bf-124">The following example retrieves the third element from a sequence.</span></span> <span data-ttu-id="e53bf-125">В нем используются различные методы, основанные на типе последовательности:</span><span class="sxs-lookup"><span data-stu-id="e53bf-125">It uses different methods based on the type of the sequence:</span></span>

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetTypePattern":::

<span data-ttu-id="e53bf-126">Шаблоны могут быть рекурсивными, где шаблон проверяет тип, и если этот тип соответствует, шаблон соответствует одному или нескольким значениям свойств в выражении диапазона.</span><span class="sxs-lookup"><span data-stu-id="e53bf-126">Patterns can be recursive, where a pattern tests a type, and if that type matches, the pattern matches one or more property values on the range expression.</span></span> <span data-ttu-id="e53bf-127">Для расширения предыдущего примера можно использовать рекурсивные шаблоны.</span><span class="sxs-lookup"><span data-stu-id="e53bf-127">You can use recursive patterns to extend the preceding example.</span></span> <span data-ttu-id="e53bf-128">Вы добавляете ветви выражения switch для массивов, которые содержат менее 3 элементов.</span><span class="sxs-lookup"><span data-stu-id="e53bf-128">You add switch expression arms for arrays that have fewer than 3 elements.</span></span> <span data-ttu-id="e53bf-129">Рекурсивные шаблоны показаны в примере ниже.</span><span class="sxs-lookup"><span data-stu-id="e53bf-129">Recursive patterns are shown in the following example:</span></span>

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetRecursivePattern":::

<span data-ttu-id="e53bf-130">Рекурсивные шаблоны могут проверять свойства выражения диапазона, но не могут выполнять произвольный код.</span><span class="sxs-lookup"><span data-stu-id="e53bf-130">Recursive patterns can examine properties of the range expression, but can't execute arbitrary code.</span></span> <span data-ttu-id="e53bf-131">Чтобы обеспечить аналогичные проверки для других типов последовательностей, можно использовать *условие регистра* указанное в предложении `when`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-131">You can use a *case guard*, specified in a `when` clause, to provide similar checks for other sequence types:</span></span>

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetGuardCase":::

<span data-ttu-id="e53bf-132">Наконец, для перехвата аргументов можно добавить шаблоны `_` и `null`, которые не обрабатываются ни одной ветвью выражения switch.</span><span class="sxs-lookup"><span data-stu-id="e53bf-132">Finally, you can add the `_` pattern and the `null` pattern to catch arguments that aren't processed by any other switch expression arm.</span></span> <span data-ttu-id="e53bf-133">Это делает выражения switch *исчерпывающими*, что означает, что будет обрабатываться любое возможное значение выражения диапазона.</span><span class="sxs-lookup"><span data-stu-id="e53bf-133">That makes the switch expression *exhaustive*, meaning any possible value of the range expression is handled.</span></span> <span data-ttu-id="e53bf-134">В следующем примере добавляются такие ветви выражения:</span><span class="sxs-lookup"><span data-stu-id="e53bf-134">The following example adds those expression arms:</span></span>

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetExhaustive":::

<span data-ttu-id="e53bf-135">В предыдущем примере добавляется шаблон `null`, а шаблон типа `IEnumerable<T>` меняется на шаблон `_`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-135">The preceding example adds a `null` pattern, and changes the `IEnumerable<T>` type pattern to a `_` pattern.</span></span> <span data-ttu-id="e53bf-136">В качестве ветви выражения switch шаблон `null` содержит проверку значения null.</span><span class="sxs-lookup"><span data-stu-id="e53bf-136">The `null` pattern provides a null check as a switch expression arm.</span></span> <span data-ttu-id="e53bf-137">Выражение для этой ветви создает исключение <xref:System.ArgumentNullException>.</span><span class="sxs-lookup"><span data-stu-id="e53bf-137">The expression for that arm throws an <xref:System.ArgumentNullException>.</span></span> <span data-ttu-id="e53bf-138">Шаблон `_` соответствует всем входным данным, которые не совпали с предыдущими ветвями.</span><span class="sxs-lookup"><span data-stu-id="e53bf-138">The `_` pattern matches all inputs that haven't been matched by previous arms.</span></span> <span data-ttu-id="e53bf-139">Он должен появиться после проверки `null`, иначе он будет совпадать с входными файлами `null`.</span><span class="sxs-lookup"><span data-stu-id="e53bf-139">It must come after the `null` check, or it would match `null` inputs.</span></span>

## <a name="non-exhaustive-switch-expressions"></a><span data-ttu-id="e53bf-140">Неисчерпывающие выражения switch</span><span class="sxs-lookup"><span data-stu-id="e53bf-140">Non-exhaustive switch expressions</span></span>

<span data-ttu-id="e53bf-141">Если ни один из шаблонов выражения switch не перехватывает аргумент, среда выполнения создает исключение.</span><span class="sxs-lookup"><span data-stu-id="e53bf-141">If none of a switch expression's patterns catches an argument, the runtime throws an exception.</span></span> <span data-ttu-id="e53bf-142">В .NET Core 3.0 и более поздних версиях исключением является <xref:System.Runtime.CompilerServices.SwitchExpressionException?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e53bf-142">In .NET Core 3.0 and later versions, the exception is a <xref:System.Runtime.CompilerServices.SwitchExpressionException?displayProperty=nameWithType>.</span></span> <span data-ttu-id="e53bf-143">В .NET Framework исключением является <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="e53bf-143">In .NET Framework, the exception is an <xref:System.InvalidOperationException>.</span></span>

## <a name="see-also"></a><span data-ttu-id="e53bf-144">См. также</span><span class="sxs-lookup"><span data-stu-id="e53bf-144">See also</span></span>

- [<span data-ttu-id="e53bf-145">Предложение языковой спецификации C# для рекурсивных шаблонов</span><span class="sxs-lookup"><span data-stu-id="e53bf-145">C# language spec proposal for recursive patterns</span></span>](~/_csharplang/proposals/csharp-8.0/patterns.md#switch-expression)
- [<span data-ttu-id="e53bf-146">справочник по C#</span><span class="sxs-lookup"><span data-stu-id="e53bf-146">C# reference</span></span>](../index.md)
- [<span data-ttu-id="e53bf-147">Операторы и выражения C#</span><span class="sxs-lookup"><span data-stu-id="e53bf-147">C# operators and expressions</span></span>](index.md)
- [<span data-ttu-id="e53bf-148">Сопоставление шаблонов</span><span class="sxs-lookup"><span data-stu-id="e53bf-148">Pattern matching</span></span>](../../pattern-matching.md)
