---
title: Ссылочные типы, допускающие значение NULL, — справочник по C#
description: Сведения о ссылочных типах C#, допускающих значение NULL, и их использовании
ms.date: 04/06/2020
ms.openlocfilehash: 274a613a8381a2b7718c9025f51aadb2eb32af36
ms.sourcegitcommit: 870bc4b4087510f6fba3c7b1c0d391f02bcc1f3e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2020
ms.locfileid: "92471867"
---
# <a name="nullable-reference-types-c-reference"></a><span data-ttu-id="2eed9-103">Ссылочные типы, допускающие значение NULL (справочник по C#)</span><span class="sxs-lookup"><span data-stu-id="2eed9-103">Nullable reference types (C# reference)</span></span>

> [!NOTE]
> <span data-ttu-id="2eed9-104">В этой статье рассматриваются ссылочные типы, допускающие значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-104">This article covers nullable reference types.</span></span> <span data-ttu-id="2eed9-105">Вы также можете объявить [типы значений, допускающие значение NULL](nullable-value-types.md).</span><span class="sxs-lookup"><span data-stu-id="2eed9-105">You can also declare [nullable value types](nullable-value-types.md).</span></span>

<span data-ttu-id="2eed9-106">Ссылочные типы, допускающие значение NULL, доступны начиная с C# 8.0, в коде, который дал явное согласие на *контекст, поддерживающий значение NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-106">Nullable reference types are available beginning with C# 8.0, in code that has opted in to a *nullable aware context* .</span></span> <span data-ttu-id="2eed9-107">Ссылочные типы, допускающие значение NULL, предупреждения о значении NULL при статическом анализе и [оператор, опускающий NULL](../operators/null-forgiving.md), являются необязательными функциями языка.</span><span class="sxs-lookup"><span data-stu-id="2eed9-107">Nullable reference types, the null static analysis warnings, and the [null-forgiving operator](../operators/null-forgiving.md) are optional language features.</span></span> <span data-ttu-id="2eed9-108">По умолчанию все они отключены.</span><span class="sxs-lookup"><span data-stu-id="2eed9-108">All are turned off by default.</span></span> <span data-ttu-id="2eed9-109">*Контекст, допускающий значение NULL* , контролируется на уровне проекта с помощью параметров сборки или в коде с помощью директив pragma.</span><span class="sxs-lookup"><span data-stu-id="2eed9-109">A *nullable context* is controlled at the project level using build settings, or in code using pragmas.</span></span>

 <span data-ttu-id="2eed9-110">В контексте, поддерживающем значение NULL:</span><span class="sxs-lookup"><span data-stu-id="2eed9-110">In a nullable aware context:</span></span>

- <span data-ttu-id="2eed9-111">переменная ссылочного типа `T` должна быть инициализирована со значением, отличным от NULL, и ей невозможно присвоить значение, которое может быть равно `null`;</span><span class="sxs-lookup"><span data-stu-id="2eed9-111">A variable of a reference type `T` must be initialized with non-null, and may never be assigned a value that may be `null`.</span></span>
- <span data-ttu-id="2eed9-112">переменная ссылочного типа `T?` может быть инициализирована с помощью `null`, или ей может быть присвоено значение `null`, но она должна быть проверена на `null` перед разыменованием;</span><span class="sxs-lookup"><span data-stu-id="2eed9-112">A variable of a reference type `T?` may be initialized with `null` or assigned `null`, but is required to be checked against `null` before de-referencing.</span></span>
- <span data-ttu-id="2eed9-113">переменная `m` типа `T?` считается не равной NULL при применении оператора, опускающего NULL, как в `m!`.</span><span class="sxs-lookup"><span data-stu-id="2eed9-113">A variable `m` of type `T?` is considered to be non-null when you apply the null-forgiving operator, as in `m!`.</span></span>

<span data-ttu-id="2eed9-114">Различия между ссылочным типом, не допускающим значение NULL, `T` и ссылочным типом, допускающим значение NULL, `T?` проявляются при интерпретации предыдущих правил компилятором.</span><span class="sxs-lookup"><span data-stu-id="2eed9-114">The distinctions between a non-nullable reference type `T` and a nullable reference type `T?` are enforced by the compiler's interpretation of the preceding rules.</span></span> <span data-ttu-id="2eed9-115">Переменная типа `T` и переменная типа `T?` представлены одним и тем же типом .NET.</span><span class="sxs-lookup"><span data-stu-id="2eed9-115">A variable of type `T` and a variable of type `T?` are represented by the same .NET type.</span></span> <span data-ttu-id="2eed9-116">В следующем примере объявляется строка, не допускающая значение NULL, и строка, допускающая значение NULL, а затем используется оператор, опускающий NULL, для присваивания значения строке, не допускающей значение NULL:</span><span class="sxs-lookup"><span data-stu-id="2eed9-116">The following example declares a non-nullable string and a nullable string, and then uses the null-forgiving operator to assign a value to a non-nullable string:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetCoreSyntax":::

<span data-ttu-id="2eed9-117">Переменные `notNull` и `nullable` представлены типом <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="2eed9-117">The variables `notNull` and `nullable` are both represented by the <xref:System.String> type.</span></span> <span data-ttu-id="2eed9-118">Так как типы, допускающие и не допускающие значение NULL, хранятся в виде одного типа, существует несколько мест, где использование ссылочного типа, допускающего значение NULL, не допускается.</span><span class="sxs-lookup"><span data-stu-id="2eed9-118">Because the non-nullable and nullable types are both stored as the same type, there are several locations where using a nullable reference type isn't allowed.</span></span> <span data-ttu-id="2eed9-119">Как правило, ссылочный тип, допускающий значение NULL, запрещено использовать в качестве базового класса или реализованного интерфейса.</span><span class="sxs-lookup"><span data-stu-id="2eed9-119">In general, a nullable reference type can't be used as a base class or implemented interface.</span></span> <span data-ttu-id="2eed9-120">Ссылочный тип, допускающий значение NULL, не может использоваться в выражении проверки типа или создания объекта.</span><span class="sxs-lookup"><span data-stu-id="2eed9-120">A nullable reference type can't be used in any object creation or type testing expression.</span></span> <span data-ttu-id="2eed9-121">Ссылочный тип, допускающий значение NULL, не может быть типом выражения доступа к члену.</span><span class="sxs-lookup"><span data-stu-id="2eed9-121">A nullable reference type can't be the type of a member access expression.</span></span> <span data-ttu-id="2eed9-122">Эти конструкции показаны в следующих примерах:</span><span class="sxs-lookup"><span data-stu-id="2eed9-122">The following examples show these constructs:</span></span>

```csharp
public MyClass : System.Object? // not allowed
{
}

var nullEmpty = System.String?.Empty; // Not allowed
var maybeObject = new object?(); // Not allowed
try
{
    if (thing is string? nullableString) // not allowed
        Console.WriteLine(nullableString);
} catch (Exception? e) // Not Allowed
{
    Console.WriteLine("error");
}
```

## <a name="nullable-references-and-static-analysis"></a><span data-ttu-id="2eed9-123">Ссылки, допускающие значение NULL, и статический анализ</span><span class="sxs-lookup"><span data-stu-id="2eed9-123">Nullable references and static analysis</span></span>

<span data-ttu-id="2eed9-124">Примеры в предыдущем разделе иллюстрируют природу ссылочных типов, допускающих значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-124">The examples in the previous section illustrate the nature of nullable reference types.</span></span> <span data-ttu-id="2eed9-125">Ссылочные типы, допускающие значение NULL, не являются новыми типами классов, а обозначены заметками для существующих ссылочных типов.</span><span class="sxs-lookup"><span data-stu-id="2eed9-125">Nullable reference types aren't new class types, but rather annotations on existing reference types.</span></span> <span data-ttu-id="2eed9-126">Компилятор использует эти заметки, чтобы помочь найти потенциальные ошибки для пустых ссылок в коде.</span><span class="sxs-lookup"><span data-stu-id="2eed9-126">The compiler uses those annotations to help you find potential null reference errors in your code.</span></span> <span data-ttu-id="2eed9-127">Во время выполнения нет никакой разницы между ссылочным типом, не допускающим значение NULL, и ссылочным типом, допускающим значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-127">There's no runtime difference between a non-nullable reference type and a nullable reference type.</span></span> <span data-ttu-id="2eed9-128">Компилятор не добавляет никакую проверку для ссылочных типов, не допускающих значение NULL, во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="2eed9-128">The compiler doesn't add any runtime checking for non-nullable reference types.</span></span> <span data-ttu-id="2eed9-129">Преимущества заключаются в анализе времени компиляции.</span><span class="sxs-lookup"><span data-stu-id="2eed9-129">The benefits are in the compile-time analysis.</span></span> <span data-ttu-id="2eed9-130">Компилятор создает предупреждения, помогающие находить и исправлять потенциальные ошибки со значениями NULL в коде.</span><span class="sxs-lookup"><span data-stu-id="2eed9-130">The compiler generates warnings that help you find and fix potential null errors in your code.</span></span> <span data-ttu-id="2eed9-131">Вы объявляете свое намерение, и компилятор предупреждает вас, если код нарушает его.</span><span class="sxs-lookup"><span data-stu-id="2eed9-131">You declare your intent, and the compiler warns you when your code violates that intent.</span></span>

<span data-ttu-id="2eed9-132">В контексте, допускающем значение NULL, компилятор выполняет статический анализ для переменных любого ссылочного типа, как допускающего, так и не допускающего значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-132">In a nullable enabled context, the compiler performs static analysis on variables of any reference type, both nullable and non-nullable.</span></span> <span data-ttu-id="2eed9-133">Компилятор отслеживает состояние NULL каждой ссылочной переменной в виде *не NULL* или *может быть NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-133">The compiler tracks the null state of each reference variable as either *not null* or *maybe null* .</span></span> <span data-ttu-id="2eed9-134">Состоянием по умолчанию для ссылки, не допускающей значение NULL, является *не NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-134">The default state of a non-nullable reference is *not null* .</span></span> <span data-ttu-id="2eed9-135">Состоянием по умолчанию для ссылки, допускающей значение NULL, является *может быть NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-135">The default state of a nullable reference is *maybe null* .</span></span>

<span data-ttu-id="2eed9-136">Ссылочные типы, не допускающие значение NULL, всегда должны быть безопасными для разыменования, так как их состоянием NULL является *не NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-136">Non-nullable reference types should always be safe to dereference because their null state is *not null* .</span></span> <span data-ttu-id="2eed9-137">Чтобы применить это правило, компилятор выдает предупреждения, если ссылочный тип, не допускающий значение NULL, не инициализируется со значением, отличным от NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-137">To enforce that rule, the compiler issues warnings if a non-nullable reference type isn't initialized to a non-null value.</span></span> <span data-ttu-id="2eed9-138">Локальные переменные должны присваиваться там же, где они объявляются.</span><span class="sxs-lookup"><span data-stu-id="2eed9-138">Local variables must be assigned where they're declared.</span></span> <span data-ttu-id="2eed9-139">Каждый конструктор должен назначить каждое поле либо в своем теле, вызываемом конструкторе, либо с помощью инициализатора поля.</span><span class="sxs-lookup"><span data-stu-id="2eed9-139">Every constructor must assign every field, either in its body, a called constructor, or using a field initializer.</span></span> <span data-ttu-id="2eed9-140">Компилятор выдает предупреждения, если ссылка, не допускающая значение NULL, присваивается ссылке с состоянием *может быть NULL* .</span><span class="sxs-lookup"><span data-stu-id="2eed9-140">The compiler issues warnings if a non-nullable reference is assigned to a reference whose state is *maybe null* .</span></span> <span data-ttu-id="2eed9-141">Однако так как ссылка, не допускающая значение NULL, имеет состояние *не NULL* , при разыменовании этих переменных предупреждения не выдаются.</span><span class="sxs-lookup"><span data-stu-id="2eed9-141">However, because a non-nullable reference is *not null* , no warnings are issued when those variables are de-referenced.</span></span>

<span data-ttu-id="2eed9-142">Ссылочные типы, допускающие значение NULL, могут быть инициализированы или присвоены `null`.</span><span class="sxs-lookup"><span data-stu-id="2eed9-142">Nullable reference types may be initialized or assigned to `null`.</span></span> <span data-ttu-id="2eed9-143">Таким образом, статический анализ должен определить, что переменная имеет состояние *не NULL* , до ее разыменования.</span><span class="sxs-lookup"><span data-stu-id="2eed9-143">Therefore, static analysis must determine that a variable is *not null* before it's dereferenced.</span></span> <span data-ttu-id="2eed9-144">Если ссылка, допускающая значение NULL, определяется как *может быть NULL* , ее невозможно присвоить ссылочной переменной, не допускающей значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-144">If a nullable reference is determined to be *maybe null* , it can't be assigned to a non-nullable reference variable.</span></span> <span data-ttu-id="2eed9-145">В следующем классе показаны примеры этих предупреждений:</span><span class="sxs-lookup"><span data-stu-id="2eed9-145">The following class shows examples of these warnings:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetClassWithNullable":::

<span data-ttu-id="2eed9-146">В следующем фрагменте кода показано, где компилятор выдает предупреждения при использовании этого класса:</span><span class="sxs-lookup"><span data-stu-id="2eed9-146">The following snippet shows where the compiler emits warnings when using this class:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetLocalWarnings":::

<span data-ttu-id="2eed9-147">В предыдущих примерах показан статический анализ компилятора для определения состояния NULL ссылочных переменных.</span><span class="sxs-lookup"><span data-stu-id="2eed9-147">The preceding examples demonstrate the compiler's static analysis to determine the null state of reference variables.</span></span> <span data-ttu-id="2eed9-148">Компилятор применяет правила языка для проверок и присваиваний, чтобы получить сведения для анализа.</span><span class="sxs-lookup"><span data-stu-id="2eed9-148">The compiler applies language rules for null checks and assignments to inform its analysis.</span></span>  <span data-ttu-id="2eed9-149">Компилятор не может делать предположения о семантике методов или свойств.</span><span class="sxs-lookup"><span data-stu-id="2eed9-149">The compiler can't make assumptions about the semantics of methods or properties.</span></span> <span data-ttu-id="2eed9-150">При вызове методов, выполняющих проверки значений NULL, компилятор не может понять, что эти методы влияют на состояние NULL переменной.</span><span class="sxs-lookup"><span data-stu-id="2eed9-150">If you call methods that perform null checks, the compiler can't know those methods affect a variable's null state.</span></span> <span data-ttu-id="2eed9-151">Существует ряд атрибутов, которые можно добавить в API, чтобы сообщить компилятору о семантике аргументов и возвращаемых значений.</span><span class="sxs-lookup"><span data-stu-id="2eed9-151">There are a number of attributes you can add to your APIs to inform the compiler about the semantics of arguments and return values.</span></span> <span data-ttu-id="2eed9-152">Эти атрибуты применялись для многих общих API в библиотеках .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2eed9-152">These attributes have been applied to many common APIs in the .NET Core libraries.</span></span> <span data-ttu-id="2eed9-153">Например, <xref:System.String.IsNullOrEmpty%2A> был обновлен, и компилятор правильно интерпретирует этот метод как проверку значения NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-153">For example, <xref:System.String.IsNullOrEmpty%2A> has been updated, and the compiler correctly interprets that method as a null check.</span></span> <span data-ttu-id="2eed9-154">Дополнительные сведения об атрибутах, применяемых для статического анализа состояния NULL, см. в статье [Атрибуты, допускающие значение NULL](../attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="2eed9-154">For more information about the attributes that apply to null state static analysis, see the article on [Nullable attributes](../attributes/nullable-analysis.md).</span></span>

## <a name="setting-the-nullable-context"></a><span data-ttu-id="2eed9-155">Задание контекста, допускающего значение NULL</span><span class="sxs-lookup"><span data-stu-id="2eed9-155">Setting the nullable context</span></span>

<span data-ttu-id="2eed9-156">Существует два способа управления контекстом, допускающим значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-156">There are two ways to control the nullable context.</span></span> <span data-ttu-id="2eed9-157">На уровне проекта можно добавить параметр `<Nullable>enable</Nullable>`.</span><span class="sxs-lookup"><span data-stu-id="2eed9-157">At the project level, you can add the `<Nullable>enable</Nullable>` project setting.</span></span> <span data-ttu-id="2eed9-158">В одном файле исходного кода C# можно добавить директиву pragma `#nullable enable`, чтобы включить контекст, допускающий значение NULL.</span><span class="sxs-lookup"><span data-stu-id="2eed9-158">In a single C# source file, you can add the `#nullable enable` pragma to enable the nullable context.</span></span> <span data-ttu-id="2eed9-159">См. статью о [настройке стратегии, допускающей значение NULL](../../nullable-migration-strategies.md).</span><span class="sxs-lookup"><span data-stu-id="2eed9-159">See the article on [setting a nullable strategy](../../nullable-migration-strategies.md).</span></span>

## <a name="c-language-specification"></a><span data-ttu-id="2eed9-160">Спецификация языка C#</span><span class="sxs-lookup"><span data-stu-id="2eed9-160">C# language specification</span></span>

<span data-ttu-id="2eed9-161">Дополнительные сведения см. в следующих предложениях для [спецификации языка C#](~/_csharplang/spec/introduction.md):</span><span class="sxs-lookup"><span data-stu-id="2eed9-161">For more information, see the following proposals for the [C# language specification](~/_csharplang/spec/introduction.md):</span></span>

- [<span data-ttu-id="2eed9-162">Ссылочные типы, допускающие значение NULL</span><span class="sxs-lookup"><span data-stu-id="2eed9-162">Nullable reference types</span></span>](~/_csharplang/proposals/csharp-8.0/nullable-reference-types.md)
- [<span data-ttu-id="2eed9-163">Ссылочные типы, допускающие значение NULL. Черновик спецификации</span><span class="sxs-lookup"><span data-stu-id="2eed9-163">Draft nullable reference types specification</span></span>](~/_csharplang/proposals/csharp-8.0/nullable-reference-types-specification.md)

## <a name="see-also"></a><span data-ttu-id="2eed9-164">См. также</span><span class="sxs-lookup"><span data-stu-id="2eed9-164">See also</span></span>

- [<span data-ttu-id="2eed9-165">справочник по C#</span><span class="sxs-lookup"><span data-stu-id="2eed9-165">C# reference</span></span>](../index.md)
- [<span data-ttu-id="2eed9-166">Типы значений, допускающие значение NULL</span><span class="sxs-lookup"><span data-stu-id="2eed9-166">Nullable value types</span></span>](nullable-value-types.md)
