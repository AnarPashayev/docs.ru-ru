---
title: Руководство по программированию на C#. Универсальные шаблоны в среде выполнения
ms.date: 07/20/2015
helpviewer_keywords:
- generics [C#], at run time
ms.assetid: 119df7e6-9ceb-49df-af36-24f8f8c0747f
ms.openlocfilehash: a53a21d3028e588f5c4d5ce7bf35fad8d3720a08
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75702991"
---
# <a name="generics-in-the-run-time-c-programming-guide"></a>Универсальные типы во время выполнения (Руководство по программированию в C#)
Универсальный тип или метод, компилируемый на языке MSIL, будет содержать метаданные, определяющие наличие в нем параметров типа. Способ использования MSIL для универсального типа зависит от того, является ли предоставленный параметр типа ссылочным типом или типом значения.  
  
 Если в качестве параметра при первом построении универсального типа использовался тип значения, во время выполнения создается специальный универсальный тип, для которого в соответствующих местах кода MSIL заменяются предоставленные параметры. Специальные универсальные типы создаются один раз для каждого уникального типа значения, используемого в качестве параметра.  
  
 Допустим, в коде программы объявляется стек, состоящий из целых чисел:  
  
 [!code-csharp[csProgGuideGenerics#42](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#42)]  
  
 В этой точке среда выполнения создает специальную версию класса <xref:System.Collections.Generic.Stack%601>, параметр которого будет соответствующим образом заменяться целым числом. После этого каждый раз, когда в коде программы используется стек целых чисел, среда выполнения обращается к созданному специальному классу <xref:System.Collections.Generic.Stack%601>. В следующем примере создаются два экземпляра стека целых чисел, которые совместно используют один экземпляр кода `Stack<int>`:  
  
 [!code-csharp[csProgGuideGenerics#43](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#43)]  
  
 Допустим, в другой точке кода создается другой класс <xref:System.Collections.Generic.Stack%601>, в качестве параметра которого используется другой тип значения, например `long`, или определяемая пользователем структура. В результате среда выполнения создает другую версию универсального типа и заменяет `long` в соответствующих местах кода MSIL. Преобразования больше не требуются, поскольку каждый специальный универсальный класс содержит собственный тип значения.  
  
 Для ссылочных типов универсальные шаблоны применяются несколько иным образом. При первом создании универсального типа с любым ссылочным типом среда выполнения создает в коде MSIL специальный универсальный тип, параметры которого заменяются ссылками на объекты. После этого каждый раз при создании экземпляра такого сконструированного типа с использованием в качестве параметра ссылочного типа (независимо от того, какой это тип) среда выполнения использует ранее созданную специальную версию универсального типа. Это возможно, поскольку все ссылки имеют одинаковый размер.  
  
 Допустим, у вас есть два ссылочных типа (классы `Customer` и `Order`) и вы создаете стек типов `Customer`:  
  
 [!code-csharp[csProgGuideGenerics#47](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#47)]  
  
 [!code-csharp[csProgGuideGenerics#44](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#44)]  
  
 В этой точке среда выполнения создает специальную версию класса <xref:System.Collections.Generic.Stack%601>, содержащую ссылки на объекты, которые не хранят данные и будут заполнены позднее. Допустим, в следующей строке кода создается стек другого ссылочного типа с именем `Order`:  
  
 [!code-csharp[csProgGuideGenerics#45](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#45)]  
  
 В отличие от типов значений, в этом случае не создается другая специальная версия класса <xref:System.Collections.Generic.Stack%601> для типа `Order`. Вместо этого создается экземпляр специальной версии класса <xref:System.Collections.Generic.Stack%601> и задается переменная `orders`, ссылающаяся на него. Предположим, далее встречается строка кода, в которой создается стек типа `Customer`:  
  
 [!code-csharp[csProgGuideGenerics#46](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideGenerics/CS/Generics.cs#46)]  
  
 Как и в случае предшествующего использования класса <xref:System.Collections.Generic.Stack%601>, созданного с помощью типа `Order`, создается другой специальный экземпляр класса <xref:System.Collections.Generic.Stack%601>. Содержащиеся в нем указатели будут ссылаться на область памяти с размером типа `Customer`. Поскольку число ссылок в разных программах может значительно различаться, реализация C# на основе универсальных шаблонов позволяет значительно сократить объем кода за счет того, что компилятор создает для универсальных классов ссылочных типов только один специальный класс.  
  
 Кроме того, при создании экземпляра универсального класса C# с использованием параметра типа значения или ссылочного типа копия может выполнять запросы к нему во время выполнения, и при этом могут быть установлены его фактический тип и параметр типа.  
  
## <a name="see-also"></a>См. также

- <xref:System.Collections.Generic>
- [Руководство по программированию на C#](../index.md)
- [Введение в универсальные шаблоны](./index.md)
- [Универсальные шаблоны](../../../standard/generics/index.md)
