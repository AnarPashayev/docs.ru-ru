---
title: Сериализация (C#)
description: Сериализация — это процесс преобразования объекта в поток байтов для сохранения или передачи в память, базу данных или файл.
ms.date: 01/02/2020
ms.openlocfilehash: 29625648b19c97556c107997ef9ecd3f0f971cbf
ms.sourcegitcommit: 7499bdb428d63ed0e19e97f54d3d576c41598659
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2020
ms.locfileid: "87455744"
---
# <a name="serialization-c"></a><span data-ttu-id="d02ce-103">Сериализация (C#)</span><span class="sxs-lookup"><span data-stu-id="d02ce-103">Serialization (C#)</span></span>

<span data-ttu-id="d02ce-104">Сериализация — это процесс преобразования объекта в поток байтов для сохранения или передачи в память, базу данных или файл.</span><span class="sxs-lookup"><span data-stu-id="d02ce-104">Serialization is the process of converting an object into a stream of bytes to store the object or transmit it to memory, a database, or a file.</span></span> <span data-ttu-id="d02ce-105">Эта операция предназначена для того, чтобы сохранить состояния объекта для последующего воссоздания при необходимости.</span><span class="sxs-lookup"><span data-stu-id="d02ce-105">Its main purpose is to save the state of an object in order to be able to recreate it when needed.</span></span> <span data-ttu-id="d02ce-106">Обратный процесс называется десериализацией.</span><span class="sxs-lookup"><span data-stu-id="d02ce-106">The reverse process is called deserialization.</span></span>

## <a name="how-serialization-works"></a><span data-ttu-id="d02ce-107">Как работает сериализация</span><span class="sxs-lookup"><span data-stu-id="d02ce-107">How serialization works</span></span>

<span data-ttu-id="d02ce-108">На этом рисунке показан общий процесс сериализации.</span><span class="sxs-lookup"><span data-stu-id="d02ce-108">This illustration shows the overall process of serialization:</span></span>

![График сериализации](./media/index/serialization-process.gif)

<span data-ttu-id="d02ce-110">Объект сериализуется в поток, который служит для передачи данных.</span><span class="sxs-lookup"><span data-stu-id="d02ce-110">The object is serialized to a stream that carries the data.</span></span> <span data-ttu-id="d02ce-111">Поток также может содержать сведения о типе объекта, в том числе о его версии, языке и региональных параметрах, а также имени сборки.</span><span class="sxs-lookup"><span data-stu-id="d02ce-111">The stream may also have information about the object's type, such as its version, culture, and assembly name.</span></span> <span data-ttu-id="d02ce-112">В этом формате потока объект можно сохранить в базе данных, файле или памяти.</span><span class="sxs-lookup"><span data-stu-id="d02ce-112">From that stream, the object can be stored in a database, a file, or memory.</span></span>

### <a name="uses-for-serialization"></a><span data-ttu-id="d02ce-113">Применение сериализации</span><span class="sxs-lookup"><span data-stu-id="d02ce-113">Uses for serialization</span></span>

<span data-ttu-id="d02ce-114">Сериализация позволяет разработчику сохранять состояние объекта и воссоздавать его при необходимости. Это полезно для длительного хранения объектов или для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="d02ce-114">Serialization allows the developer to save the state of an object and re-create it as needed, providing storage of objects as well as data exchange.</span></span> <span data-ttu-id="d02ce-115">Посредством сериализации разработчик может выполнять следующие действия:</span><span class="sxs-lookup"><span data-stu-id="d02ce-115">Through serialization, a developer can perform actions such as:</span></span>

* <span data-ttu-id="d02ce-116">Отправка объекта в удаленное приложение с помощью веб-службы</span><span class="sxs-lookup"><span data-stu-id="d02ce-116">Sending the object to a remote application by using a web service</span></span>
* <span data-ttu-id="d02ce-117">Передача объекта из одного домена в другой</span><span class="sxs-lookup"><span data-stu-id="d02ce-117">Passing an object from one domain to another</span></span>
* <span data-ttu-id="d02ce-118">Передача объекта через брандмауэр в виде строки JSON или XML</span><span class="sxs-lookup"><span data-stu-id="d02ce-118">Passing an object through a firewall as a JSON or XML string</span></span>
* <span data-ttu-id="d02ce-119">Хранение сведений о безопасности и пользователях между приложениями</span><span class="sxs-lookup"><span data-stu-id="d02ce-119">Maintaining security or user-specific information across applications</span></span>

## <a name="json-serialization"></a><span data-ttu-id="d02ce-120">Сериализация JSON</span><span class="sxs-lookup"><span data-stu-id="d02ce-120">JSON serialization</span></span>

<span data-ttu-id="d02ce-121">В пространстве имен <xref:System.Text.Json> содержатся классы для сериализации и десериализации в формате JSON.</span><span class="sxs-lookup"><span data-stu-id="d02ce-121">The <xref:System.Text.Json> namespace contains classes for JavaScript Object Notation (JSON) serialization and deserialization.</span></span> <span data-ttu-id="d02ce-122">JSON — это открытый стандарт, который широко применяется для обмена данными через Интернет.</span><span class="sxs-lookup"><span data-stu-id="d02ce-122">JSON is an open standard that is commonly used for sharing data across the web.</span></span>

<span data-ttu-id="d02ce-123">В формате JSON открытые свойства объекта сериализуются в строку, массив байтов или поток в соответствии со [спецификацией JSON RFC 8259](https://tools.ietf.org/html/rfc8259).</span><span class="sxs-lookup"><span data-stu-id="d02ce-123">JSON serialization serializes the public properties of an object into a string, byte array, or stream that conforms to [the RFC 8259 JSON specification](https://tools.ietf.org/html/rfc8259).</span></span> <span data-ttu-id="d02ce-124">Для управления способами сериализации или десериализации с использованием <xref:System.Text.Json.JsonSerializer> экземпляр класса:</span><span class="sxs-lookup"><span data-stu-id="d02ce-124">To control the way <xref:System.Text.Json.JsonSerializer> serializes or deserializes an instance of the class:</span></span>

* <span data-ttu-id="d02ce-125">использует объект <xref:System.Text.Json.JsonSerializerOptions>;</span><span class="sxs-lookup"><span data-stu-id="d02ce-125">Use a <xref:System.Text.Json.JsonSerializerOptions> object</span></span>
* <span data-ttu-id="d02ce-126">применяет к классам или свойствам атрибуты из пространства имен <xref:System.Text.Json.Serialization>;</span><span class="sxs-lookup"><span data-stu-id="d02ce-126">Apply attributes from the <xref:System.Text.Json.Serialization> namespace to classes or properties</span></span>
* <span data-ttu-id="d02ce-127">[реализует пользовательские преобразователи](../../../../standard/serialization/system-text-json-converters-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="d02ce-127">[Implement custom converters](../../../../standard/serialization/system-text-json-converters-how-to.md)</span></span>

## <a name="binary-and-xml-serialization"></a><span data-ttu-id="d02ce-128">Двоичная сериализация и сериализация XML</span><span class="sxs-lookup"><span data-stu-id="d02ce-128">Binary and XML serialization</span></span>

<span data-ttu-id="d02ce-129">В пространстве имен <xref:System.Runtime.Serialization> содержатся классы для сериализации и десериализации в двоичном формате и формате XML.</span><span class="sxs-lookup"><span data-stu-id="d02ce-129">The <xref:System.Runtime.Serialization> namespace contains classes for binary and XML serialization and deserialization.</span></span>

<span data-ttu-id="d02ce-130">Двоичная сериализация использует двоичное кодирование, создавая компактные потоки для хранения или передачи через сетевые сокеты.</span><span class="sxs-lookup"><span data-stu-id="d02ce-130">Binary serialization uses binary encoding to produce compact serialization for uses such as storage or socket-based network streams.</span></span> <span data-ttu-id="d02ce-131">Процесс двоичной сериализации сериализует все элементы, даже доступные только для чтения. Также этот вариант имеет более высокую производительность.</span><span class="sxs-lookup"><span data-stu-id="d02ce-131">In binary serialization, all members, even members that are read-only, are serialized, and performance is enhanced.</span></span>

[!INCLUDE [binary-serialization-warning](~/includes/binary-serialization-warning.md)]

<span data-ttu-id="d02ce-132">При XML-сериализации все открытые поля и свойства объекта (или параметры и возвращаемые значения метода) сериализуются в XML-поток по правилам определенного документа XSD (язык определения схемы XML).</span><span class="sxs-lookup"><span data-stu-id="d02ce-132">XML serialization serializes the public fields and properties of an object, or the parameters and return values of methods, into an XML stream that conforms to a specific XML Schema definition language (XSD) document.</span></span> <span data-ttu-id="d02ce-133">XML-сериализация создает строго типизированные классы с открытыми свойствами и полями, которые преобразуются в формат XML.</span><span class="sxs-lookup"><span data-stu-id="d02ce-133">XML serialization results in strongly typed classes with public properties and fields that are converted to XML.</span></span> <span data-ttu-id="d02ce-134">Пространство имен <xref:System.Xml.Serialization> содержит классы для сериализации и десериализации XML.</span><span class="sxs-lookup"><span data-stu-id="d02ce-134"><xref:System.Xml.Serialization> contains classes for serializing and deserializing XML.</span></span> <span data-ttu-id="d02ce-135">Чтобы контролировать сериализацию и десериализацию экземпляров класса, осуществляемую <xref:System.Xml.Serialization.XmlSerializer>, вы можете применять к классам и их членам специальные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="d02ce-135">You apply attributes to classes and class members to control the way the <xref:System.Xml.Serialization.XmlSerializer> serializes or deserializes an instance of the class.</span></span>

### <a name="making-an-object-serializable"></a><span data-ttu-id="d02ce-136">Превращение объекта в сериализуемый</span><span class="sxs-lookup"><span data-stu-id="d02ce-136">Making an object serializable</span></span>

<span data-ttu-id="d02ce-137">Для двоичной сериализации или сериализации XML вам потребуются:</span><span class="sxs-lookup"><span data-stu-id="d02ce-137">For binary or XML serialization, you need:</span></span>

* <span data-ttu-id="d02ce-138">сериализуемый объект;</span><span class="sxs-lookup"><span data-stu-id="d02ce-138">The object to be serialized</span></span>
* <span data-ttu-id="d02ce-139">поток, содержащий сериализованный объект;</span><span class="sxs-lookup"><span data-stu-id="d02ce-139">A stream to contain the serialized object</span></span>
* <span data-ttu-id="d02ce-140">экземпляр <xref:System.Runtime.Serialization.Formatter?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-140">A <xref:System.Runtime.Serialization.Formatter?displayProperty=fullName> instance</span></span>

<span data-ttu-id="d02ce-141">Примените к типу атрибут <xref:System.SerializableAttribute>, чтобы указать возможность сериализации экземпляров этого типа.</span><span class="sxs-lookup"><span data-stu-id="d02ce-141">Apply the <xref:System.SerializableAttribute> attribute to a type to indicate that instances of the type can be serialized.</span></span> <span data-ttu-id="d02ce-142">Если в типе нет атрибута <xref:System.SerializableAttribute>, при попытке сериализации выдается исключение.</span><span class="sxs-lookup"><span data-stu-id="d02ce-142">An  exception is thrown if you attempt to serialize but the type doesn't have the <xref:System.SerializableAttribute> attribute.</span></span>

<span data-ttu-id="d02ce-143">Чтобы запретить сериализацию поля, примените атрибут <xref:System.NonSerializedAttribute>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-143">To prevent a field from being serialized, apply the <xref:System.NonSerializedAttribute> attribute.</span></span> <span data-ttu-id="d02ce-144">Если поле сериализуемого типа содержит указатель, дескриптор или специальные структуры данных для определенной среды, и содержимое этого поле невозможно разумно воссоздать в другой среде, такое поле лучше сделать несериализуемым.</span><span class="sxs-lookup"><span data-stu-id="d02ce-144">If a field of a serializable type contains a pointer, a handle, or some other data structure that is specific to a particular environment, and the field cannot be meaningfully reconstituted in a different environment, then you may want to make it nonserializable.</span></span>

<span data-ttu-id="d02ce-145">Если сериализуемый класс содержит ссылки на объекты других классов, имеющие пометку <xref:System.SerializableAttribute>, эти объекты тоже будут сериализованы.</span><span class="sxs-lookup"><span data-stu-id="d02ce-145">If a serialized class contains references to objects of other classes that are marked <xref:System.SerializableAttribute>, those objects will also be serialized.</span></span>

### <a name="basic-and-custom-serialization"></a><span data-ttu-id="d02ce-146">Базовая и пользовательская сериализации</span><span class="sxs-lookup"><span data-stu-id="d02ce-146">Basic and custom serialization</span></span>

<span data-ttu-id="d02ce-147">Существует два способа выполнить двоичную сериализацию или сериализацию XML — базовый и пользовательский.</span><span class="sxs-lookup"><span data-stu-id="d02ce-147">Binary and XML serialization can be performed in two ways, basic and custom.</span></span>

<span data-ttu-id="d02ce-148">Базовая сериализация использует платформу .NET для автоматической сериализации объекта.</span><span class="sxs-lookup"><span data-stu-id="d02ce-148">Basic serialization uses .NET to automatically serialize the object.</span></span> <span data-ttu-id="d02ce-149">Единственное требование заключается в необходимости применить атрибут <xref:System.SerializableAttribute> к классу.</span><span class="sxs-lookup"><span data-stu-id="d02ce-149">The only requirement is that the class has the <xref:System.SerializableAttribute> attribute applied.</span></span> <span data-ttu-id="d02ce-150">Атрибут <xref:System.NonSerializedAttribute> также можно использовать для исключения из сериализации определенных полей.</span><span class="sxs-lookup"><span data-stu-id="d02ce-150">The <xref:System.NonSerializedAttribute> can be used to keep specific fields from being serialized.</span></span>

<span data-ttu-id="d02ce-151">При использовании базовой сериализации управление версиями объектов может привести к ошибкам.</span><span class="sxs-lookup"><span data-stu-id="d02ce-151">When you use basic serialization, the versioning of objects may create problems.</span></span> <span data-ttu-id="d02ce-152">Если проблемы с управлением версиями важны, рекомендуется использовать пользовательскую сериализацию.</span><span class="sxs-lookup"><span data-stu-id="d02ce-152">You would use custom serialization when versioning issues are important.</span></span> <span data-ttu-id="d02ce-153">Базовая сериализация является самым простым способом сериализации, но не дает почти никакого контроля над процессом.</span><span class="sxs-lookup"><span data-stu-id="d02ce-153">Basic serialization is the easiest way to perform serialization, but it does not provide much control over the process.</span></span>

<span data-ttu-id="d02ce-154">Используя пользовательскую сериализацию, вы можете точно указать, какие объекты и как будут сериализованы.</span><span class="sxs-lookup"><span data-stu-id="d02ce-154">In custom serialization, you can specify exactly which objects will be serialized and how it will be done.</span></span> <span data-ttu-id="d02ce-155">Класс должен иметь отметку <xref:System.SerializableAttribute> и реализовывать интерфейс <xref:System.Runtime.Serialization.ISerializable>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-155">The class must be marked <xref:System.SerializableAttribute> and implement the <xref:System.Runtime.Serialization.ISerializable> interface.</span></span> <span data-ttu-id="d02ce-156">Если вы хотите настраивать и десериализацию объекта, следует использовать пользовательский конструктор.</span><span class="sxs-lookup"><span data-stu-id="d02ce-156">If you want your object to be deserialized in a custom manner as well, use a custom constructor.</span></span>

## <a name="designer-serialization"></a><span data-ttu-id="d02ce-157">Сериализация конструктора</span><span class="sxs-lookup"><span data-stu-id="d02ce-157">Designer serialization</span></span>

<span data-ttu-id="d02ce-158">Сериализация конструктора — это особая форма сериализации, при которой применяется способ постоянного хранения объектов, используемый в средствах разработки.</span><span class="sxs-lookup"><span data-stu-id="d02ce-158">Designer serialization is a special form of serialization that involves the kind of object persistence associated with development tools.</span></span> <span data-ttu-id="d02ce-159">Сериализация конструктора выполняет преобразование графа объекта в файл исходного кода, с помощью которого впоследствии можно восстановить граф объекта.</span><span class="sxs-lookup"><span data-stu-id="d02ce-159">Designer serialization is the process of converting an object graph into a source file that can later be used to recover the object graph.</span></span> <span data-ttu-id="d02ce-160">Этот файл исходного кода может содержать программный код, разметку или даже информацию из таблицы SQL.</span><span class="sxs-lookup"><span data-stu-id="d02ce-160">A source file can contain code, markup, or even SQL table information.</span></span>

## <a name="related-topics-and-examples"></a><a name="BKMK_RelatedTopics"></a> <span data-ttu-id="d02ce-161">Связанные разделы и примеры</span><span class="sxs-lookup"><span data-stu-id="d02ce-161">Related Topics and Examples</span></span>  

<span data-ttu-id="d02ce-162">В разделе [Обзор System.Text.Json](../../../../standard/serialization/system-text-json-overview.md) описывается способ получить библиотеку `System.Text.Json`.</span><span class="sxs-lookup"><span data-stu-id="d02ce-162">[System.Text.Json overview](../../../../standard/serialization/system-text-json-overview.md) Shows how to get the `System.Text.Json` library.</span></span>

<span data-ttu-id="d02ce-163">[Практическое руководство. Сериализация и десериализация JSON в .NET](../../../../standard/serialization/system-text-json-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="d02ce-163">[How to serialize and deserialize JSON in .NET](../../../../standard/serialization/system-text-json-how-to.md).</span></span>
<span data-ttu-id="d02ce-164">Содержит сведения о том, как считывать и записывать данные объекта в формате JSON с использованием класса <xref:System.Text.Json.JsonSerializer>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-164">Shows how to read and write object data to and from JSON using the <xref:System.Text.Json.JsonSerializer> class.</span></span>

[<span data-ttu-id="d02ce-165">Пошаговое руководство: Сохранение объекта в Visual Studio (C#)</span><span class="sxs-lookup"><span data-stu-id="d02ce-165">Walkthrough: Persisting an Object in Visual Studio (C#)</span></span>](walkthrough-persisting-an-object-in-visual-studio.md)  
<span data-ttu-id="d02ce-166">Демонстрирует, как с помощью сериализации сохранить данные объекта между экземплярами, чтобы сохранять значения и извлекать их при следующем создании экземпляра объекта.</span><span class="sxs-lookup"><span data-stu-id="d02ce-166">Demonstrates how serialization can be used to persist an object's data between instances, allowing you to store values and retrieve them the next time the object is instantiated.</span></span>

[<span data-ttu-id="d02ce-167">Практическое руководство. Чтение данных объекта из XML-файла (C#)</span><span class="sxs-lookup"><span data-stu-id="d02ce-167">How to read object data from an XML file (C#)</span></span>](how-to-read-object-data-from-an-xml-file.md)  
<span data-ttu-id="d02ce-168">Показывает считывание данных объекта, которые ранее были записаны в XML-файл с помощью класса <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-168">Shows how to read object data that was previously written to an XML file using the <xref:System.Xml.Serialization.XmlSerializer> class.</span></span>

[<span data-ttu-id="d02ce-169">Практическое руководство. Запись данных объекта в XML-файл (C#)</span><span class="sxs-lookup"><span data-stu-id="d02ce-169">How to write object data to an XML file (C#)</span></span>](how-to-write-object-data-to-an-xml-file.md)  
<span data-ttu-id="d02ce-170">Показывает, как записать объект из класса в XML-файл с помощью класса <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="d02ce-170">Shows how to write the object from a class to an XML file using the <xref:System.Xml.Serialization.XmlSerializer> class.</span></span>
