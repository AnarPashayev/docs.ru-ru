---
title: Руководство по программированию на C#. Использование исключений
description: Сведения об использовании исключений. Исключения вызываются кодом, который сталкивается с ошибкой, и перехватываются кодом, который может ее исправить.
ms.date: 12/09/2020
helpviewer_keywords:
- exception handling [C#], about exception handling
- exceptions [C#], about exceptions
ms.assetid: 71472c62-320a-470a-97d2-67995180389d
ms.openlocfilehash: 30a7c3eecb599493dfa74d664c4899836c1b9276
ms.sourcegitcommit: 9b877e160c326577e8aa5ead22a937110d80fa44
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97110225"
---
# <a name="use-exceptions-c-programming-guide"></a>Использование исключений (руководство по программированию на C#)

В C# ошибки в программе в среде выполнения передаются через программу с помощью механизма, который называется исключениями. Исключения вызываются кодом, который встречает ошибку, и перехватываются кодом, который может ее исправить. Исключения могут вызываться средой выполнения .NET или кодом в программе. Вызванное исключение передается вверх по стеку вызовов, пока не будет найден соответствующий оператор `catch`. Не перехваченные исключения обрабатываются универсальным обработчиком исключений, предоставляемым системой, которая отображает диалоговое окно.

Исключения представляются классами, производными от <xref:System.Exception>. Этот класс определяет тип исключения и содержит свойства с подробными сведениями об исключении. При вызове исключения создается экземпляр производного класса, а также могут настраиваться свойства исключения. После этого с помощью ключевого слова `throw` вызывается объект. Пример:

:::code language="csharp" source="snippets/exceptions/Program.cs" id="ThrowException":::

После выдачи исключения среда выполнения проверяет, входит ли текущий оператор в блок `try`. Если да, она проверяет, может ли какой-либо из блоков `catch`, связанных с блоком `try`, перехватить исключение. Блоки `Catch` обычно задают типы исключений; если тип блока `catch` совпадает с типом или базовым классом исключения, блок `catch` может обработать этот метод. Пример:

:::code language="csharp" source="snippets/exceptions/Program.cs" id="CatchException":::

Если оператор, который вызывает исключение, не находится в блоке `try`, или блок `try`, в который он входит, не имеет соответствующий блок `catch`, среда выполнения проверяет вызывающий метод на наличие оператора `try` и блоков `catch`. Среда выполнения продолжает перебирать стек вызовов в поиска подходящего блока `catch`. После того как блок `catch` будет найден и выполнен, управление передается оператору, следующему после блока `catch`.

Оператор `try` может содержать не один блок `catch`. Выполняется первый оператор `catch`, который может обработать исключение; все последующие операторы `catch` игнорируются, даже если они совместимы. Блоки catch всегда следует располагать в порядке от наиболее конкретных (наиболее производных) до наименее конкретных. Пример:

:::code language="csharp" source="snippets/exceptions/CatchOrder.cs":::

Прежде чем выполнять блок `catch`, среда выполнения проверяет наличие блоков `finally`. Блоки `Finally` позволяют программисту удалить любое неоднозначное состояние, которое может остаться после прерванного блока `try`, а также освободить любые внешние ресурсы (включая обработчики графики, соединители баз данных или файловые потоки), не дожидаясь, пока сборщик мусора в среде выполнения завершит эти объекты. Пример:

:::code language="csharp" source="snippets/exceptions/Program.cs" id="TestFinally":::

Если `WriteByte()` вызывает исключение, то код во втором блоке `try`, который пытается повторно открыть файл, завершится ошибкой, если `file.Close()` не вызывается, а файл остается заблокированным. Поскольку блоки `finally` выполняются, даже если выдается исключение, блок `finally` в предыдущем примере обеспечивает правильное закрытие файла и помогает избежать ошибки.

Если после выдачи исключения обнаружить совместимый блок `catch` в стеке вызовов не удается, происходит одно из трех:

- Если исключение возникает в методе завершения, он прерывается, и вызывается базовый метод завершения (если есть).
- Если стек вызовов содержит статический конструктор или инициализатор статического поля, выдается исключение <xref:System.TypeInitializationException>, а исходное исключение назначается свойству <xref:System.Exception.InnerException%2A> нового исключения.
- Как только достигается начало потока, он прерывается.
