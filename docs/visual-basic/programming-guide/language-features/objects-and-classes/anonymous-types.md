---
title: Анонимные типы (Visual Basic)
ms.date: 07/20/2015
f1_keywords:
- vb.AnonymousType
helpviewer_keywords:
- anonymous types [Visual Basic], about anonymous types
- anonymous types [Visual Basic]
- types [Visual Basic], anonymous
ms.assetid: 7b87532c-4b3e-4398-8503-6ea9d67574a4
ms.openlocfilehash: 3dc2083e5b4fd06250a1387c32f0eba28e879b30
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61758500"
---
# <a name="anonymous-types-visual-basic"></a>Анонимные типы (Visual Basic)
Visual Basic поддерживает анонимные типы, которые позволяют создавать объекты без написания определения класса для типа данных. Вместо этого компилятор создает класс для вас. Класс не имеет имени, наследует непосредственно от <xref:System.Object>и содержит свойства, которые указаны при объявлении объекта. Так как имя типа данных не указан, он называется *анонимного типа*.  
  
 В следующем примере объявляется и создается переменная `product` как экземпляр анонимного типа, который имеет два свойства: `Name` и `Price`.  
  
 [!code-vb[VbVbalrAnonymousTypes#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#1)]  
  
 Объект *выражение запроса* использует анонимные типы для объединения столбцов данных, выбранных по запросу. Тип результата, нельзя определить заранее, поскольку невозможно предсказать, столбцы, которые может выбрать определенный запрос. Анонимные типы позволяют написать запрос, выбирающий любое количество столбцов, в любом порядке. Компилятор создает тип данных, который соответствует указанным свойствам и указанном порядке.  
  
 В следующих примерах `products` является списком объектов продукта, каждый из которых имеет много свойств. Переменной `namePriceQuery` содержит определение запроса, который, при выполнении возвращает коллекцию экземпляров анонимного типа с двумя свойствами `Name` и `Price`.  
  
 [!code-vb[VbVbalrAnonymousTypes#2](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#2)]  
  
 Переменной `nameQuantityQuery` содержит определение запроса, который, при выполнении возвращает коллекцию экземпляров анонимного типа с двумя свойствами `Name` и `OnHand`.  
  
 [!code-vb[VbVbalrAnonymousTypes#3](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#3)]  
  
 Дополнительные сведения о коде, созданном компилятором для анонимного типа, см. в разделе [определение анонимного типа](../../../../visual-basic/programming-guide/language-features/objects-and-classes/anonymous-type-definition.md).  
  
> [!CAUTION]
>  Анонимный тип называется компилятора создается и могут отличаться для разных компиляций. Ваш код не следует использовать или полагаться на имя анонимного типа, так как имя может измениться при повторной компиляции проекта.  
  
## <a name="declaring-an-anonymous-type"></a>Объявление анонимного типа  
 Объявление экземпляра анонимного типа использует список инициализаторов для указания свойств типа. Можно указать только свойства, при объявлении анонимного типа, не другие элементы класса, например методы или события. В следующем примере `product1` — это экземпляр анонимного типа, который имеет два свойства: `Name` и `Price`.  
  
 [!code-vb[VbVbalrAnonymousTypes#4](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#4)]  
  
 Если назначить свойства как ключевые свойства, их можно использовать для сравнения на равенство двух экземпляров анонимного типа. Тем не менее невозможно изменить значения свойств ключа. Далее в этом разделе приводятся дополнительные сведения в разделе свойства ключа.  
  
 Обратите внимание, что объявление экземпляра анонимного типа как объявление экземпляра именованного типа с помощью инициализатора объектов:  
  
 [!code-vb[VbVbalrAnonymousTypes#5](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#5)]  
  
 Дополнительные сведения о других способах указания свойств анонимного типа, см. в разделе [как: Выведение имен свойств и типов в объявлениях анонимных типов](../../../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-infer-property-names-and-types-in-anonymous-type-declarations.md).  
  
## <a name="key-properties"></a>Ключевые свойства  
 Ключевые свойства отличаются от неключевые свойства коренным образом:  
  
- Чтобы определить, равны ли два экземпляра сравниваются только значений ключевых свойств.  
  
- Значения свойств ключа доступны только для чтения и не может быть изменено.  
  
- Только значений ключевых свойств включаются в созданный компилятором хэш-алгоритм кода для анонимного типа.  
  
### <a name="equality"></a>Равенство  
 Экземпляры анонимные типы могут быть равными, только в том случае, если они являются экземплярами того же анонимного типа. Компилятор обрабатывает два экземпляра как экземпляры того же типа, при соблюдении следующих условий:  
  
- Они объявляются в той же сборке.  
  
- Все свойства имеют те же имена, те же возвращаемые типы и объявляются в том же порядке. Сравнение имен регистр не учитывается.  
  
- Те же свойства в каждом, помечаются как ключевые свойства.  
  
- По крайней мере одно свойство в каждое объявление является ключевым свойством.  
  
 Экземпляр анонимного типа, который не имеет ключевого свойства равен только самому себе.  
  
 [!code-vb[VbVbalrAnonymousTypes#6](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#6)]  
  
 Два экземпляра одного анонимного типа равны, если равны значения их ключевых свойств. Следующие примеры иллюстрируют способ проверки равенства.  
  
 [!code-vb[VbVbalrAnonymousTypes#7](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#7)]  
  
### <a name="read-only-values"></a>Значения только для чтения  
 Невозможно изменить значения свойств ключа. Например, в `prod8` в предыдущем примере, `Name` и `Price` поля являются `read-only`, но `OnHand` можно изменить.  
  
 [!code-vb[VbVbalrAnonymousTypes#8](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#8)]  
  
## <a name="anonymous-types-from-query-expressions"></a>Анонимные типы из выражений запросов  
 Выражения запросов не всегда требуют создания анонимных типов. Если это возможно, они используют существующий тип для хранения данных в столбце. Это происходит, когда запрос возвращает либо все записи из источника данных или только одно поле из каждой записи. В следующих примерах кода `customers` является коллекцией объектов `Customer` класс. Класс имеет множество свойств, и может включать один или несколько из них в результат запроса в любом порядке. В первых двух примерах анонимные типы необходимы, так как запросы выбирают элементы из именованных типов:  
  
- `custs1` содержит коллекцию строк, так как `cust.Name` представляет собой строку.  
  
     [!code-vb[VbVbalrAnonymousTypes#30](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class2.vb#30)]  
  
- `custs2` содержит коллекцию `Customer` объекты, поскольку каждый элемент `customers` является `Customer` объекта и весь элемент выбран в запросе.  
  
     [!code-vb[VbVbalrAnonymousTypes#31](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class2.vb#31)]  
  
 Тем не менее соответствующие именованные типы доступны не всегда. Может потребоваться выбрать имена клиентов и адреса для одной цели, идентификаторы клиентов и расположения для другого и имена клиентов, адреса и История заказа для третьего. Анонимные типы позволяют выбрать любое сочетание свойств, в любом порядке, без предварительного объявления нового именованного типа для хранения результата. Вместо этого компилятор создает анонимный тип для каждой группы свойств. Следующий запрос выбирает только имя и идентификатор клиента из каждого `Customer` объекта в `customers`. Таким образом компилятор создает анонимный тип, содержащий только эти два свойства.  
  
 [!code-vb[VbVbalrAnonymousTYpes#32](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class2.vb#32)]  
  
 Имена и типы данных свойств в анонимном типе берутся из аргументов `Select`, `cust.Name` и `cust.ID`. Свойства в анонимном типе, который создается по запросу, всегда являются ключевыми свойствами. Когда `custs3` выполняется в следующем `For Each` цикл, результат — это набор экземпляров анонимного типа с двумя ключевыми свойствами `Name` и `ID`.  
  
 [!code-vb[VbVbalrAnonymousTypes#33](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class2.vb#33)]  
  
 Элементы в коллекции, представленной `custs3` являются строго типизированными, и можно использовать IntelliSense для навигации по доступных свойств и проверки их типы.  
  
 Дополнительные сведения см. в разделе [Знакомство с LINQ в Visual Basic](../../../../visual-basic/programming-guide/language-features/linq/introduction-to-linq.md).  
  
## <a name="deciding-whether-to-use-anonymous-types"></a>Решите, следует ли использовать анонимные типы  
 Прежде чем создавать объект как экземпляр анонимного класса, убедитесь, что это наилучший вариант. Например если вы хотите создать временный объект для хранения связанных данных, и нет необходимости в других полях и методы, которые могут содержать полный класс, анонимный тип является хорошим решением. Анонимные типы также удобны, если вы хотите выбрать другой набор свойств для каждого объявления, или если вы хотите изменить порядок свойств. Тем не менее если проект содержит несколько объектов, которые имеют одинаковые свойства, в определенном порядке, можно объявить их проще с помощью именованного типа с помощью конструктора классов. Например, с соответствующим конструктором, проще объявить несколько экземпляров `Product` класса, а не объявлять несколько экземпляров анонимного типа.  
  
 [!code-vb[VbVbalrAnonymousTypes#9](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#9)]  
  
 Еще одним преимуществом именованных типов является то, что компилятор может перехватить случайную опечатку в имени свойства. В предыдущих примерах `firstProd2`, `secondProd2`, и `thirdProd2` предназначены для экземпляров того же анонимного типа. Однако, если было случайно объявить `thirdProd2` в одном из следующих способов, его тип будет отличаться от `firstProd2` и `secondProd2`.  
  
 [!code-vb[VbVbalrAnonymousTypes#10](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrAnonymousTypes/VB/Class1.vb#10)]  
  
 Что более важно существуют ограничения на использование анонимных типов, которые не применяются к экземплярам именованных типов. `firstProd2`, `secondProd2`, и `thirdProd2` являются экземплярами того же анонимного типа. Однако имя для общего анонимного типа не поддерживается и не может находиться где требуется имя типа в коде. Например анонимный тип не может использоваться для определения сигнатуры метода, для объявления других переменных или полей или в объявлении любого типа. Таким образом анонимные типы не подходят, при необходимости совместного использования данных в методы.  
  
## <a name="an-anonymous-type-definition"></a>Определение анонимного типа  
 В ответ на объявление экземпляра анонимного типа компилятор создает определение нового класса, который содержит указанные свойства.  
  
 Если анонимный тип содержит по крайней мере одно ключевое свойство, определение переопределяет три члена, унаследованные от <xref:System.Object>: <xref:System.Object.Equals%2A>, <xref:System.Object.GetHashCode%2A>, и <xref:System.Object.ToString%2A>. Код, созданный для проверки равенства и определения, что значение хэш-кода рассматривает только ключевые свойства. Если анонимный тип не содержит ключевых свойств, только <xref:System.Object.ToString%2A> переопределяется. Явно именованные свойства анонимного типа не должны конфликтовать с эти созданные методы. То есть нельзя использовать `.Equals`, `.GetHashCode`, или `.ToString` для имени свойства.  
  
 Определения анонимного типа, которые имеют по крайней мере одно ключевое свойство, также реализуют <xref:System.IEquatable%601?displayProperty=nameWithType> интерфейс, где `T` тип анонимного типа.  
  
 Дополнительные сведения о коде, созданном компилятором, и функциональные возможности переопределенных методов, см. в разделе [определение анонимного типа](../../../../visual-basic/programming-guide/language-features/objects-and-classes/anonymous-type-definition.md).  
  
## <a name="see-also"></a>См. также

- [Инициализаторы объектов. Именованные и анонимные типы](../../../../visual-basic/programming-guide/language-features/objects-and-classes/object-initializers-named-and-anonymous-types.md)
- [Вывод локального типа](../../../../visual-basic/programming-guide/language-features/variables/local-type-inference.md)
- [Introduction to LINQ in Visual Basic](../../../../visual-basic/programming-guide/language-features/linq/introduction-to-linq.md) (Знакомство с LINQ в Visual Basic)
- [Практическое руководство. Выведение имен свойств и типов в объявлениях анонимных типов](../../../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-infer-property-names-and-types-in-anonymous-type-declarations.md)
- [Определение анонимного типа](../../../../visual-basic/programming-guide/language-features/objects-and-classes/anonymous-type-definition.md)
- [Key](../../../../visual-basic/language-reference/modifiers/key.md)
