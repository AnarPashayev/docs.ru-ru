---
title: Расширение пространства имен My
ms.date: 07/20/2015
f1_keywords:
- vb.AddingMyExtensions
helpviewer_keywords:
- My namespace [Visual Basic], customizing
- My namespace
- My namespace [Visual Basic], extending
ms.assetid: 808e8617-b01c-4135-8b21-babe87389e8e
ms.openlocfilehash: 2a7b0b84061fccd9a333a68e4a19477bd19ca4ff
ms.sourcegitcommit: 17ee6605e01ef32506f8fdc686954244ba6911de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74330314"
---
# <a name="extending-the-my-namespace-in-visual-basic"></a>Расширение пространства имен `My` в Visual Basic

Пространство имен `My` в Visual Basic предоставляет свойства и методы, позволяющие легко использовать возможности .NET Framework. Пространство имен `My` упрощает распространенные проблемы программирования, часто сокращая сложность задачи до одной строки кода. Кроме того, `My` пространство имен является полностью расширяемым, чтобы можно было настроить поведение `My` и добавить в его иерархию новые службы для адаптации к конкретным потребностям приложения. В этом разделе обсуждаются способы настройки существующих членов пространства имен `My` и добавления собственных пользовательских классов в пространство имен `My`.

## <a name="customizing-existing-my-namespace-members"></a>Настройка существующих элементов пространства имен `My`

Пространство имен `My` в Visual Basic предоставляет часто используемые сведения о приложении, компьютере и многом другое. Полный список объектов в пространстве имен `My` см. в разделе [Моя ссылка](../../language-reference/keywords/my-reference.md). Возможно, потребуется настроить существующие члены пространства имен `My`, чтобы они лучше соответствовали потребностям приложения. Для любого свойства объекта в пространстве имен `My`, которое не доступно только для чтения, можно задать пользовательское значение.

Например, предположим, что вы часто используете объект `My.User` для доступа к текущему контексту безопасности для пользователя, запустившего приложение. Однако ваша компания использует пользовательский объект пользователя для предоставления дополнительных сведений и возможностей для пользователей в компании. В этом сценарии можно заменить значение по умолчанию свойства `My.User.CurrentPrincipal` экземпляром собственного пользовательского объекта Principal, как показано в следующем примере:

[!code-vb[VbVbcnExtendingMy#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class1.vb#1)]

Установка свойства `CurrentPrincipal` объекта `My.User` изменяет удостоверение, под которым выполняется приложение. Объект `My.User`, в свою очередь, возвращает сведения о вновь указанном пользователе.
  
## <a name="adding-members-to-my-objects"></a>Добавление членов в объекты `My`

Типы, возвращаемые из `My.Application` и `My.Computer`, определяются как классы `Partial`. Таким образом, можно расширить `My.Application` и `My.Computer` объекты, создав класс `Partial` с именем `MyApplication` или `MyComputer`. Класс не может быть классом `Private`. Если класс указан как часть пространства имен `My`, можно добавить свойства и методы, которые будут включены в объекты `My.Application` или `My.Computer`.

В следующем примере в объект `My.Computer` добавляется свойство с именем `DnsServerIPAddresses`:

[!code-vb[VbVbcnExtendingMy#2](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class2.vb#2)]

## <a name="adding-custom-objects-to-the-my-namespace"></a>Добавление пользовательских объектов в пространство имен `My`

Несмотря на то, что пространство имен `My` предоставляет решения для многих распространенных задач программирования, могут возникнуть задачи, которые не поддерживаются пространством имен `My`. Например, приложение может обращаться к пользовательским службам каталогов для пользовательских данных, или приложение может использовать сборки, которые не устанавливаются по умолчанию с Visual Basic. Можно расширить пространство имен `My`, включив в него пользовательские решения для общих задач, характерных для конкретной среды. `My` пространство имен можно легко расширить для добавления новых членов в соответствии с растущими потребностями приложений. Кроме того, можно развернуть расширения пространства имен `My` для других разработчиков в качестве шаблона Visual Basic.
  
### <a name="adding-members-to-the-my-namespace"></a>Добавление членов в пространство имен `My`

Поскольку `My` является пространством имен, как и любым другим пространством имен, можно добавить в него свойства верхнего уровня, просто добавив модуль и указав `Namespace` `My`. Закомментировать модуль атрибутом `HideModuleName`, как показано в следующем примере. Атрибут `HideModuleName` гарантирует, что IntelliSense не будет отображать имя модуля при отображении элементов пространства имен `My`.

[!code-vb[VbVbcnExtendingMy#3](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class1.vb#3)]

Чтобы добавить элементы в пространство имен `My`, добавьте в модуль необходимые свойства. Для каждого свойства, добавляемого в пространство имен `My`, Добавьте закрытое поле типа `ThreadSafeObjectProvider(Of T)`, где тип — это тип, возвращаемый пользовательским свойством. Это поле используется для создания экземпляров потокобезопасных объектов, возвращаемых свойством путем вызова метода `GetInstance`. В результате каждый поток, обращающийся к расширенному свойству, получает свой собственный экземпляр возвращаемого типа. В следующем примере в пространство имен `My` добавляется свойство с именем `SampleExtension`, которое имеет тип `SampleExtension`:

[!code-vb[VbVbcnExtendingMy#4](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class1.vb#4)]

## <a name="adding-events-to-custom-my-objects"></a>Добавление событий в пользовательские объекты `My`

Объект `My.Application` можно использовать для предоставления событий настраиваемых объектов `My` путем расширения разделяемого класса `MyApplication` в пространстве имен `My`. Для проектов на основе Windows можно дважды щелкнуть узел " **Мой проект** " в проекте в **Обозреватель решений**. В **конструкторе проектов**Visual Basic перейдите на вкладку **приложение** и нажмите кнопку **Просмотр событий приложения** . Будет создан новый файл с именем *ApplicationEvents. vb* . Он содержит следующий код для расширения класса `MyApplication`:

[!code-vb[VbVbcnExtendingMy#5](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class1.vb#5)]

Обработчики событий для пользовательских объектов `My` можно добавить, добавив пользовательские обработчики событий в класс `MyApplication`. Пользовательские события позволяют добавлять код, который будет выполняться при добавлении, удалении обработчика событий или при возникновении события. Обратите внимание, что код `AddHandler` для пользовательского события выполняется только в том случае, если пользователь добавляется пользователем для работы с событием. Например, рассмотрим, что объект `SampleExtension` из предыдущего раздела содержит событие `Load`, для которого необходимо добавить пользовательский обработчик событий. В следующем примере кода показан пользовательский обработчик событий с именем `SampleExtensionLoad`, который будет вызываться при возникновении события `My.SampleExtension.Load`. При добавлении кода для обработчика нового события `My.SampleExtensionLoad` выполняется `AddHandler` часть этого кода пользовательского события. Метод `MyApplication_SampleExtensionLoad` включен в пример кода для отображения примера обработчика событий, который обрабатывает событие `My.SampleExtensionLoad`. Обратите внимание, что при редактировании файла *ApplicationEvents. vb* в левом раскрывающемся списке над редактором кода будет доступно событие `SampleExtensionLoad`.

[!code-vb[VbVbcnExtendingMy#6](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbcnExtendingMy/VB/Class1.vb#6)]

## <a name="design-guidelines"></a>Рекомендации по проектированию

При разработке расширений для пространства имен `My` следуйте приведенным ниже рекомендациям, чтобы снизить затраты на обслуживание компонентов расширения.

- **Включайте только логику расширения.** Логика, включенная в расширение пространства имен `My`, должна включать только код, необходимый для предоставления требуемой функциональности в пространстве имен `My`. Так как расширение будет размещаться в пользовательских проектах как исходный код, обновление компонента расширения приведет к высокой стоимости обслуживания, и его следует избегать по возможности.
- **Сократите предположения проекта.** При создании расширений пространства имен `My` не следует полагаться на набор ссылок, импорт на уровне проекта или определенные параметры компилятора (например, `Option Strict` Off). Вместо этого Сократите зависимости и полностью уточните все ссылки на типы с помощью ключевого слова `Global`. Кроме того, убедитесь, что расширение компилируется с `Option Strict`, чтобы избежать ошибок в расширении.
- **Изолируйте код расширения.** Размещение кода в одном файле позволяет легко развернуть расширение как шаблон элемента Visual Studio. Дополнительные сведения см. Далее в подразделе «упаковка и развертывание расширений». Размещение всего кода расширения пространства имен `My` в одном файле или в отдельной папке проекта также поможет пользователям определить расширение пространства имен `My`.

## <a name="designing-class-libraries-for-my"></a>Разработка библиотек классов для `My`

Как и в случае с большинством объектных моделей, некоторые шаблоны проектирования хорошо работают в пространстве имен `My`, а другие — нет. При проектировании расширения для пространства имен `My` учитывайте следующие принципы.

- **Методы без отслеживания состояния.** Методы в пространстве имен `My` должны обеспечивать полное решение для конкретной задачи. Убедитесь, что значения параметров, передаваемые в метод, предоставляют все входные данные, необходимые для выполнения конкретной задачи. Избегайте создания методов, основанных на предыдущем состоянии, например открытых соединений с ресурсами.
- **Глобальные экземпляры.** Единственное состояние, поддерживаемое в `My` пространстве имен, является глобальным по отношению к проекту. Например, `My.Application.Info` инкапсулирует состояние, которое является общим для всего приложения.
- **Простые типы параметров.** Старайтесь не усложнять сложные типы параметров. Вместо этого создайте методы, которые либо не принимают входные параметры, либо принимают простые типы данных, такие как строки, примитивные типы и т. д.
- **Фабричные методы.** Создание экземпляров некоторых типов обязательно затрудняется. Предоставление фабричных методов в качестве расширений пространства имен `My` позволяет более легко обнаруживать и использовать типы, попадающие в эту категорию. Пример метода фабрики, который хорошо работает, `My.Computer.FileSystem.OpenTextFileReader`. В .NET Framework доступно несколько типов потоков. Указывая текстовые файлы в частности, `OpenTextFileReader` помогает пользователю понять, какой поток использовать.

Эти рекомендации не исключают общие принципы разработки библиотек классов. Вместо этого они являются рекомендациями, оптимизированными для разработчиков, использующих Visual Basic и пространство имен `My`. Общие принципы создания библиотек классов см. в разделе [рекомендации по проектированию платформы](../../../standard/design-guidelines/index.md).

## <a name="packaging-and-deploying-extensions"></a>Упаковка и развертывание расширений

Можно включить расширения пространства имен `My` в шаблон проекта Visual Studio или упаковать расширения и развернуть их в качестве шаблона элемента Visual Studio. При упаковке расширений пространства имен `My` в качестве шаблона элемента Visual Studio можно воспользоваться дополнительными возможностями, предоставляемыми Visual Basic. Эти возможности позволяют включить расширение, когда проект ссылается на определенную сборку, или разрешить пользователям явно добавлять расширение пространства имен `My` с помощью страницы **Мои расширения** в конструкторе проектов Visual Basic.

Дополнительные сведения о развертывании расширений пространства имен `My` см. в разделе [Упаковка и развертывание пользовательских расширений](packaging-and-deploying-custom-my-extensions.md).

## <a name="see-also"></a>См. также:

- [Упаковка и развертывание пользовательских расширений пространства имен My](packaging-and-deploying-custom-my-extensions.md)
- [Расширение модели приложения Visual Basic](extending-the-visual-basic-application-model.md)
- [Настройка доступа к объектам через My](customizing-which-objects-are-available-in-my.md)
- [Страница "Мои расширения", конструктор проектов](/visualstudio/ide/reference/my-extensions-page-project-designer-visual-basic)
- [Страница "Приложение" в конструкторе проектов (Visual Basic)](/visualstudio/ide/reference/application-page-project-designer-visual-basic)
- [Partial](../../language-reference/modifiers/partial.md)
