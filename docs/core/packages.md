---
title: Пакеты, метапакеты и платформы — .NET Core
description: В этой статье объясняется терминология, связанная с пакетами, метапакетами и платформами.
author: richlander
ms.date: 06/20/2016
ms.openlocfilehash: 657519edf1c0860ee3222c71ce85723e19029a9d
ms.sourcegitcommit: feb42222f1430ca7b8115ae45e7a38fc4a1ba623
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2020
ms.locfileid: "76965897"
---
# <a name="packages-metapackages-and-frameworks"></a>Пакеты, метапакеты и платформы

.NET Core — это платформа, состоящая из пакетов NuGet. Для некоторых возможностей продукта лучше подходит мелкомодульное определение пакетов, а для других — крупномодульное. С учетом такой двойственности .NET Core распространяется в виде мелкомодульного набора пакетов и в виде более крупных блоков, где тип пакета неофициально называется [метапакет](#metapackages).

Каждый пакет .NET Core поддерживает работу в множестве реализаций .NET, представляемых как платформы. Некоторые из них — это традиционные платформы, например, пакет `net46` представляет платформу .NET Framework. Другой набор — это новые платформы, которые можно представить как "платформы на основе пакетов". Они образуют новую модель определения платформ. Платформы на основе пакетов создаются и определяются полностью как пакеты, что обеспечивает тесную связь между пакетом и платформой.

## <a name="packages"></a>Пакеты

Платформа .NET Core разделяется на набор пакетов, которые предоставляют типы-примитивы, типы данных более высокого уровня, составные типы приложений и общие служебные программы. Каждый из этих пакетов представляет собой отдельную сборку с тем же именем. Например, [пакет System.Runtime](https://www.nuget.org/packages/System.Runtime) содержит сборку System.Runtime.dll.

Мелкомодульное определение пакетов имеет ряд преимуществ:

- Мелкомодульные пакеты могут выпускаться по собственному графику; необходимость в тестировании других пакетов сравнительно невелика.
- Мелкомодульные пакеты могут обеспечивать различную поддержку ОС и ЦП.
- Мелкомодульные пакеты могут иметь зависимости, относящиеся только к одной библиотеке.
- Приложения имеют меньший размер, так как пакеты, на которые нет ссылок, не включаются в распространяемый пакет приложения.

Некоторые из этих преимуществ реализуются только в определенных условиях. Например, пакеты NET Core обычно выпускаются по единому графику с одинаковой поддержкой платформ. В целях обслуживания исправления могут распространяться и устанавливаться как обновления для отдельных пакетов. Благодаря тому что исправление применяется к отдельной библиотеке, сокращается время его проверки и предоставления.

Ниже приведен список основных пакетов NuGet для .NET Core:

- [System.Runtime](https://www.nuget.org/packages/System.Runtime) — базовый пакет .NET Core, включающий <xref:System.Object>, <xref:System.String>, <xref:System.Array>, <xref:System.Action> и <xref:System.Collections.Generic.IList%601>.
- [System.Collections](https://www.nuget.org/packages/System.Collections) — набор универсальных коллекций, в том числе <xref:System.Collections.Generic.List%601> и <xref:System.Collections.Generic.Dictionary%602>.
- [System.Net.Http](https://www.nuget.org/packages/System.Net.Http) — набор типов для сетевого взаимодействия по протоколу HTTP, в том числе <xref:System.Net.Http.HttpClient> и <xref:System.Net.Http.HttpResponseMessage>.
- [System.IO.FileSystem](https://www.nuget.org/packages/System.IO.FileSystem) — набор типов для чтения из локального или сетевого дискового хранилища и записи в него, в том числе <xref:System.IO.File> и <xref:System.IO.Directory>.
- [System.Linq](https://www.nuget.org/packages/System.Linq) — набор типов для выполнения запросов к объектам, включающий `Enumerable` и <xref:System.Linq.ILookup%602>.
- [System.Reflection](https://www.nuget.org/packages/System.Reflection) — набор типов для загрузки, проверки и активации типов, в том числе <xref:System.Reflection.Assembly>, <xref:System.Reflection.TypeInfo> и <xref:System.Reflection.MethodInfo>.

Вместо включения каждого пакета по отдельности можно включить [метапакет](#metapackages) — это гораздо проще и надежнее. Но если вам требуется один пакет, его можно включить как показано в приведенном ниже примере, где задается ссылка на пакет [System.Runtime](https://www.nuget.org/packages/System.Runtime/).

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard1.6</TargetFramework>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="System.Runtime" Version="4.3.0" />
  </ItemGroup>
</Project>
```

## <a name="metapackages"></a>Метапакеты

Метапакет — это принятое в NuGet соглашение для описания набора пакетов, каким-то образом связанных друг с другом. Эти пакеты представляются в метапакете в виде зависимостей. При необходимости метапакет может задать для набора пакетов определенную платформу.

Предыдущие версии средств .NET Core (как на базе project.json, так и на базе CSPROJ) по умолчанию указывали и платформу, и метапакет. Но сейчас на метапакет неявно ссылается целевая платформа, поэтому каждый метапакет привязан к целевой платформе. Например, платформа `netstandard1.6` ссылается на метапакет NetStandard.Library версии 1.6.0. Аналогичным образом, платформа `netcoreapp2.1` ссылается на метапакет Microsoft.NETCore.App версии 2.1.0. Дополнительные сведения см. в разделе [Неявная ссылка на пакет метапакетов в пакете SDK для .NET Core](https://github.com/dotnet/core/blob/master/release-notes/1.0/sdk/1.0-rc3-implicit-package-refs.md).

Задавая целевую платформу и неявно ссылаясь на метапакет, вы, по сути, одним действием добавляете ссылку на каждый его зависимый пакет. Это означает, что все библиотеки в этих пакетах доступны для IntelliSense (или аналогичного средства), а также для публикации приложения.

Использование метапакетов дает следующие преимущества:

- позволяет пользователям легко ссылаться на большой набор мелкомодульных пакетов;
- позволяет определять наборы пакетов (включая конкретные версии), которые тестируются и применяются как единое целое.

Метапакет .NET Standard:

- [NETStandard.Library](https://www.nuget.org/packages/NETStandard.Library) — описывает библиотеки, входящие в .NET Standard. Применяется ко всем реализациям, поддерживающим .NET Standard (например, .NET Framework, .NET Core и Mono). Формирует платформу `netstandard`.

Основные метапакеты .NET Core:

- [Microsoft.NETCore.App](https://www.nuget.org/packages/Microsoft.NETCore.App) — описывает библиотеки, входящие в распространяемый пакет .NET Core. Формирует платформу `.NETCoreApp`. Зависит от метапакета `NETStandard.Library`.
- [Microsoft.AspNetCore.All](https://www.nuget.org/packages/Microsoft.AspNetCore.App) — включает в себя все поддерживаемые пакеты из ASP.NET Core, Entity Framework Core, за исключением тех, которые содержат сторонние зависимости. Дополнительные сведения см. в статье о [метапакете Microsoft.AspNetCore.App для ASP.NET Core](/aspnet/core/fundamentals/metapackage-app).
- [Microsoft.AspNetCore.All](https://www.nuget.org/packages/Microsoft.AspNetCore.All) — включает в себя все поддерживаемые пакеты из ASP.NET Core, Entity Framework Core, а также из внутренних и сторонних зависимостей, используемых ASP.NET Core и Entity Framework Core. Дополнительные сведения см. в статье [Метапакет Microsoft.AspNetCore.All для ASP.NET Core 2.x](/aspnet/core/fundamentals/metapackage).
- [Microsoft.NETCore.Portable.Compatibility](https://www.nuget.org/packages/Microsoft.NETCore.Portable.Compatibility) — набор интерфейсов совместимости, которые обеспечивают выполнение переносимых библиотек классов на основе mscorlib в .NET Core.

## <a name="frameworks"></a>Инфраструктуры

Пакеты .NET Core поддерживают набор платформ среды выполнения. Платформа описывает доступный набор API (и, возможно, других характеристик), который можно применять при создании решения для данной платформы. Платформе присваивается новая версия при добавлении новых интерфейсов API.

Например, [System.IO.FileSystem](https://www.nuget.org/packages/System.IO.FileSystem) поддерживает следующие платформы:

- .NETFramework,Version=4.6;
- .NETStandard,Version=1.3;
- 6 платформ Xamarin (например, xamarinios10).

Полезно будет сравнить первые две из этих платформ, так как они представляют два разных способа определения платформ.

- Платформа `.NETFramework,Version=4.6` представляет доступные API-интерфейсы в .NET Framework 4.6. Вы можете получить библиотеки, скомпилированные с использованием базовых сборок .NET Framework 4.6, и разместить их в пакетах NuGet в папке "lib" для net46. Эта папка будет использоваться для приложений, предназначенных для .NET Framework 4.6 или совместимых с этой платформой. Именно так традиционно работали платформы.

- Платформа `.NETStandard,Version=1.3` — это платформа на основе пакетов. Она использует пакеты, предназначенные для платформы, с целью определения и предоставления интерфейсов API в контексте платформы.

## <a name="package-based-frameworks"></a>Платформы на основе пакетов

Между платформами и пакетами существует двусторонняя связь. Платформы определяют интерфейсы API, доступные для конкретной платформы, например `netstandard1.3`. Пакеты, предназначенные для `netstandard1.3` (или совместимых платформ, например `netstandard1.0`), определяют интерфейсы API, доступные для `netstandard1.3`. Такое определение может казаться циклически замкнутым, но это не так. Интерфейсы API для платформы основаны на пакетах, то есть определяются в них. Сама платформа не определяет интерфейсы API.

Второй стороной связи является выбор ресурсов. Пакеты могут содержать ресурсы для нескольких платформ. При наличии ссылки на набор пакетов или метапакетов платформе необходимо определить, какой ресурс следует выбрать, например `net46` или `netstandard1.3`. Выбрать подходящий ресурс очень важно. Например, ресурс `net46` вряд ли будет совместим с .NET Framework 4.0 или .NET Core 1.0.

Эту связь можно проследить на приведенном ниже рисунке. Интерфейс *API* нацелен на *платформу* и определяет ее. *Платформа* служит для *выбора актива*. *Актив* предоставляет интерфейс API.

![Сочетаемость платформ на основе пакетов](./media/packages/package-framework.png)

В .NET Core используются две основные платформы на основе пакетов:

- `netstandard`
- `netcoreapp`

### <a name="net-standard"></a>.NET Standard

Платформа .NET Standard ([моникер целевой платформы](../standard/frameworks.md): `netstandard`) представляет API-интерфейсы, которые определяются и создаются на основе [.NET Standard](../standard/net-standard.md). Библиотеки, предназначенные для различных сред выполнения, должны быть нацелены на эту платформу. Они будут поддерживаться в любой среде выполнения, совместимой с .NET Standard, например .NET Core, .NET Framework и Mono/Xamarin. Каждая из этих сред выполнения поддерживает ряд версий .NET Standard в зависимости от реализуемых ими интерфейсов API.

Платформа `netstandard` неявно ссылается на метапакет [`NETStandard.Library`](https://www.nuget.org/packages/NETStandard.Library). Например, следующий файл проекта MSBuild указывает, что проект предназначен для библиотеки `netstandard1.6`, которая ссылается на метапакет [`NETStandard.Library` версии 1.6](https://www.nuget.org/packages/NETStandard.Library/1.6.0).

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard1.6</TargetFramework>
  </PropertyGroup>
</Project>
```

Но платформа и ссылки на метапакет в файле проекта не обязательно должны совпадать, и вы можете использовать элемент `<NetStandardImplicitPackageVersion>` в файле проекта для указания версии платформы, которая ниже версии метапакета. Например, приведенный ниже файл проекта является допустимым.

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard1.3</TargetFramework>
    <NetStandardImplicitPackageVersion>1.6.0</NetStandardImplicitPackageVersion>
  </PropertyGroup>
</Project>
```

Нацеливание на `netstandard1.3` и одновременное использование версии 1.6.0 библиотеки `NETStandard.Library` может показаться странным. Однако это допустимый сценарий использования, так как метапакет поддерживает более старые версии `netstandard`. Например, вы могли выбрать версию 1.6.0 метапакета для стандартизации всех библиотек, которые предназначены для различных версий `netstandard`. При таком подходе необходимо восстанавливать только `NETStandard.Library` 1.6.0, но не предыдущие версии.

Обратное (например, нацеливание на `netstandard1.6` с помощью `NETStandard.Library` версии 1.3.0) недопустимо. Нацеливание на платформу определенной версии с помощью метапакета более ранней версии невозможно, так как такой метапакет не будет предоставлять ресурсы для платформы более поздней версии. Согласно схеме управления версиями метапакетов метапакеты соответствуют самой поздней версии платформы, которую они описывают. Вследствие такой схемы управления версиями первая версия `NETStandard.Library` — 1.6.0, при условии, что она содержит ресурсы `netstandard1.6`. (Для согласованности с предыдущим примером здесь используется версия 1.3.0, хотя такой версии в действительности не существует.)

### <a name="net-core-application"></a>Приложение .NET Core

Платформа .NET Core ([моникер целевой платформы](../standard/frameworks.md): `netcoreapp`) представляет пакеты и связанные интерфейсы API, которые входят в состав распространяемого пакета .NET Core и предоставляемой им модели консольных приложений. Приложения .NET Core должны использовать эту платформу вследствие нацеливания на модель консольных приложений, так же как и библиотеки, предназначенные для выполнения только в .NET Core. При использовании этой платформы приложения и библиотеки могут выполняться только в .NET Core.

Метапакет `Microsoft.NETCore.App` предназначен для платформы `netcoreapp`. Он обеспечивает доступ к примерно 40 библиотекам, предоставляемым пакетом `NETStandard.Library`, и примерно 20 дополнительным библиотекам (всего около 60 библиотек). Вы можете ссылаться на дополнительные библиотеки, предназначенные для `netcoreapp` или совместимых платформ, например `netstandard`, для получения доступа к дополнительным интерфейсам API.

Большинство дополнительных библиотек, предоставляемых `Microsoft.NETCore.App`, также предназначены для `netstandard`, при условии что их зависимости обеспечиваются другими библиотеками `netstandard`. Это означает, что библиотеки `netstandard` также могут ссылаться на эти пакеты в качестве зависимостей.
