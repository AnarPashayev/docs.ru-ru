---
title: Отладка консольного приложения .NET Core в Visual Studio
description: Узнайте, как выполнить отладку консольного приложения .NET Core в Visual Studio.
ms.date: 05/20/2020
dev_langs:
- csharp
- vb
ms.custom: vs-dotnet
ms.openlocfilehash: 4bd2a8a0e4b3cea55e209306dd3788552e4b61f3
ms.sourcegitcommit: 03fec33630b46e78d5e81e91b40518f32c4bd7b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2020
ms.locfileid: "84005418"
---
# <a name="tutorial-debug-a-net-core-console-application-using-visual-studio"></a>Учебник. Отладка консольного приложения .NET Core с помощью Visual Studio

В этом руководстве представлены средства отладки, доступные в Visual Studio.

## <a name="prerequisites"></a>Предварительные требования

- В этом руководстве используется консольное приложение, созданное в руководстве [Создание консольного приложения .NET Core в Visual Studio 2019](with-visual-studio.md).

## <a name="debug-build-configuration"></a>Конфигурация отладочной сборки

В Visual Studio по умолчанию используются две конфигурации сборки — *Отладка* и *Выпуск*. Используемая конфигурация сборки отображается на панели инструментов. На следующем изображении панели инструментов показано, что служба Visual Studio настроена для компиляции отладочной версии приложения:

![Панель инструментов Visual Studio с выделенным режимом отладки](./media/debugging-with-visual-studio/visual-studio-toolbar-debug.png)

Сначала запустите отладочную версию приложения. Конфигурация отладочной сборки отключает большинство инструментов оптимизации и предоставляет более подробные сведения о процессе сборки.

## <a name="set-a-breakpoint"></a>Установка точки останова

<!-- markdownlint-disable MD025 -->

1. Установите *точку останова* в строке, где отображается имя, дата и время, щелкнув в левом поле окна изменения кода в этой строке. Кроме того, установить точку останова можно, поместив курсор в строку кода и нажав клавишу **F9** или выбрав **Отладка** > **Переключить точку останова** в строке меню.

   Точка останова приостанавливает выполнение приложения на инструкции, *предшествующей* той строке, в которой установлена точка останова.

   Как видно на следующем рисунке, строку с точкой останова Visual Studio обозначает подсветкой текста и красной точкой в левом поле.

   ![Окно приложения Visual Studio с установленной точкой останова](./media/debugging-with-visual-studio/set-breakpoint-in-editor.png)

1. Запустите программу в режиме отладки, нажав на панели инструментов кнопку **HelloWorld** с зеленой стрелкой. Доступны другие способы запуска отладки: нажмите клавишу **F5** или выберите **Отладка** > **Начать отладку**.

1. Когда программа запросит имя, введите любую строку в окне консоли и нажмите клавишу **ВВОД**.

1. Выполнение программы остановится, когда будет достигнута точка останова, то есть перед выполнением метода `Console.WriteLine`. В окне **Локальные** отображаются значения переменных, которые определены в текущем выполняемом методе.

   ![Снимок экрана с точкой останова в Visual Studio](./media/debugging-with-visual-studio/breakpoint-hit.png)

1. Окно **Интерпретация** позволяет взаимодействовать с приложением, которое вы отлаживаете. Вы можете интерактивно изменить значения переменных и посмотреть, как это повлияет на работу программы.

   1. Если окно **Интерпретация** не отображается, откройте его, выбрав **Отладка** > **Окна** > **Интерпретация**.

   1. Введите `name = "Gracie"` в окне **Интерпретация** и нажмите клавишу **ВВОД**.

   1. Введите `date = DateTime.Parse("2019-11-16T17:25:00Z").ToUniversalTime()` в окне **Интерпретация** и нажмите клавишу **ВВОД**.

   В окне **Интерпретация** отображается значение переменной строки и свойства значения <xref:System.DateTime>. Кроме того, значения переменных обновляются в окне **Локальные**.

   ![Окна "Локальные" и "Интерпретация" в Visual Studio 2019](./media/debugging-with-visual-studio/locals-immediate-window.png)

1. Продолжите выполнение программы, нажав кнопку **Продолжить** на панели инструментов. Или выберите **Отладка** > **Продолжить**.

   Значения, отображаемые в окне консоли, соответствуют изменениям, произведенным в окне **Интерпретация**.

   ![Окно консоли с указанными значениями](./media/debugging-with-visual-studio/console-window.png)

1. Нажмите любую клавишу, чтобы выйти из приложения и остановить отладку.

## <a name="set-a-conditional-breakpoint"></a>Установка условной точки останова

Программа отображает строку, которую вводит пользователь. Что произойдет, если пользователь ничего не введет? Это можно проверить с помощью одной из полезных функций отладки, называемой *условной точкой останова*. Условная точка останова прерывает выполнение программы, если соблюдены одно или несколько условий.

Чтобы проверить поведение программы в случае, когда пользователь не вводит текст, задайте условную точку останова следующим образом.

1. Щелкните правой кнопкой мыши красную точку, обозначающую точку останова. В контекстном меню выберите **Условия**. Откроется диалоговое окно **Параметры точки останова**. Установите флажок **Условия**, если он еще не установлен.

   ![Редактор с панелью параметров точки останова (C#)](./media/debugging-with-visual-studio/breakpoint-settings.png)

1. Для **условного выражения** введите следующий код в поле, где приведен пример кода, который проверяет, имеет ли `x` значение 5. Если нужный язык не отображается, измените выбор языка в верхней части страницы.

   ```csharp
   String.IsNullOrEmpty(name)
   ```

   ```vb
   String.IsNullOrEmpty(name)
   ```

   При каждом достижении точки останова отладчик вызывает метод `String.IsNullOrEmpty(name)` и останавливается на этой строке только в том случае, если вызов метода возвращает `true`.

   Вместо условного выражения можно указать *количество обращений* (в этом случае выполнение программы будет прерываться до тех пор, пока не будет достигнуто заданное количество обращений) или *условие фильтра* (в этом случае выполнение программы будет прерываться на основе таких атрибутов, как идентификатор потока, имя процесса и имя потока).

1. Выберите **Закрыть**, чтобы закрыть диалоговое окно.

1. Запустите отладку программы, нажав клавишу **F5**.

1. Когда в окне консоли появится предложение ввести имя, просто нажмите клавишу **ВВОД**.

1. Так как указанное вами условие соблюдается (`name` имеет значение `null` или <xref:System.String.Empty?displayProperty=nameWithType>), выполнение программы будет остановлено при достижении точки останова, то есть перед выполнением метода `Console.WriteLine`.

1. Выберите окно **Локальные**, в котором отображаются значения локальных переменных для текущего выполняемого метода. В нашем примере этим методом является `Main`. Обратите внимание, что переменная `name` имеет значение `""` или <xref:System.String.Empty?displayProperty=nameWithType>.

1. Убедитесь в том, что переменная содержит пустую строку, введя следующую инструкцию в окне **Интерпретация** и нажав клавишу **ВВОД**. Результат равен `true`.

   ```csharp
   ? name == String.Empty
   ```

   ```vb
   ? String.IsNullOrEmpty(name)
   ```

   Вопросительный знак указывает окну интерпретации на необходимость [вычислить выражение](/visualstudio/ide/reference/immediate-window#enter-commands).

   ![Значение true в окне интерпретации после выполнения инструкции (C#)](./media/debugging-with-visual-studio/immediate-window-output.png)

1. Нажмите кнопку **Продолжить** на панели инструментов, чтобы возобновить выполнение программы.

1. Нажмите любую клавишу, чтобы закрыть окно консоли и остановить отладку.

1. Очистите точку останова. Для этого щелкните красную точку в левом поле окна с кодом. Или выберите **Отладка > Переключить точку останова** при выбранной строке кода.

## <a name="step-through-a-program"></a>Пошаговое выполнение программы

Visual Studio позволяет выполнять программу пошагово, отслеживая результат ее выполнения. Для этого обычно задают точку останова и запускают программу в небольшой части ее кода. Так как программа невелика, можно выполнить ее пошагово.

1. Выберите **Отладка** > **Шаг с заходом**. Или выполните отладку по одному оператору, нажимая клавишу **F11**.

   Следующая выполняемая строка будет выделена, и рядом с ней появится стрелка.

   C#

   ![Метод выполнения по шагам в Visual Studio (C#)](./media/debugging-with-visual-studio/step-into-method.png)

   Visual Basic

   ![Метод выполнения по шагам в Visual Studio (Visual Basic)](./media/debugging-with-visual-studio/vb-step-into-method.png)

   На этом этапе в окне **Локальные** показано, что массив `args` пуст, а `name` и `date` имеют значения по умолчанию. Кроме того, Visual Studio открыла пустое окно консоли.

1. Нажмите клавишу **F11**. Будет выделена следующая выполняемая строка. Окно **Локальные** не изменяется, и окно консоли остается пустым.

   C#

   ![Источник метода выполнения по шагам в Visual Studio (C#)](./media/debugging-with-visual-studio/step-into-source-method.png)

   Visual Basic

   ![Источник метода выполнения по шагам в Visual Studio (Visual Basic)](./media/debugging-with-visual-studio/vb-step-into-source-method.png)

1. Нажмите клавишу **F11**. Visual Studio подсвечивает инструкцию, которая содержит присваивание значения переменной `name`. В окне **Локальные** отображается, что `name` имеет значение `null`, а в окне консоли появилась строка What is your name? (Введите имя:).

1. Ответьте на этот запрос, введя строку в окно консоли и нажав клавишу **ВВОД**. Консоль никак не отреагирует на это, и введенная строка не будет отображаться в окне консоли, но метод <xref:System.Console.ReadLine%2A?displayProperty=nameWithType> получит введенные входные данные.

1. Нажмите клавишу **F11**. Visual Studio подсвечивает оператор, который содержит присваивание значения переменной `date` (`currentDate` в Visual Basic). В окне **Локальные** отображается значение, полученное в результате вызова метода <xref:System.Console.ReadLine%2A?displayProperty=nameWithType>. В окне консоли также отображается строка, указанная в командной строке.

1. Нажмите клавишу **F11**. В окне **Локальные** отображается значение переменной `date`, которому было присвоено свойство <xref:System.DateTime.Now?displayProperty=nameWithType>. В окне консоли изменений не произошло.

1. Нажмите клавишу **F11**. Visual Studio вызывает метод <xref:System.Console.WriteLine(System.String,System.Object,System.Object)?displayProperty=nameWithType>. В окне консоли отображается форматированная строка.

1. Выберите **Отладка** > **Шаг с выходом**. Или отмените пошаговое выполнение, нажав сочетание клавиш **SHIFT**+**F11**.

   В окне консоли отображается сообщение с предложением нажать любую клавишу для выхода.

1. Нажмите любую клавишу, чтобы закрыть окно консоли и остановить отладку.

## <a name="build-a-release-version"></a>Сборка версии в режиме выпуска

После тестирования отладочной версии приложения следует скомпилировать и протестировать версию в режиме выпуска. При сборке в режиме выпуска компилятор использует методы оптимизации, которые иногда могут негативно повлиять на поведение приложения. Например, оптимизации компилятора для повышения производительности могут привести к состоянию конкуренции в многопоточных приложениях.

Чтобы собрать и протестировать консольное приложение в режиме выпуска, переключите конфигурацию сборки из режима **Отладка** в режим **Выпуск** на панели инструментов.

![Панель инструментов Visual Studio по умолчанию с выделенным режимом отладки](./media/debugging-with-visual-studio/visual-studio-toolbar-release.png)

Если нажать клавишу **F5** или выбрать пункт **Собрать решение** в меню **Сборка**, Visual Studio скомпилирует версию приложения в режиме выпуска. Эту версию можно протестировать точно так же, как и отладочную.

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы использовали средства отладки Visual Studio. В следующем руководстве вы опубликуете развертываемую версию приложения.

> [!div class="nextstepaction"]
> [Публикация консольного приложения .NET Core в Visual Studio](publishing-with-visual-studio.md)
