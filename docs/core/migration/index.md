---
title: Перенос .NET Core из project.json
description: Сведения о переносе старого проекта .NET Core с использованием project.json
ms.date: 07/19/2017
ms.custom: seodec18
ms.openlocfilehash: 167f0707bbaf34ce12a1c56ee2320e7cc4f48bd3
ms.sourcegitcommit: 3094dcd17141b32a570a82ae3f62a331616e2c9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2019
ms.locfileid: "71698921"
---
# <a name="migrating-net-core-projects-from-projectjson"></a><span data-ttu-id="91303-103">Перенос проектов .NET Core из project.json</span><span class="sxs-lookup"><span data-stu-id="91303-103">Migrating .NET Core projects from project.json</span></span>

<span data-ttu-id="91303-104">В этом документе рассматриваются следующие три сценария миграции для проектов .NET Core.</span><span class="sxs-lookup"><span data-stu-id="91303-104">This document covers the following three migration scenarios for .NET Core projects:</span></span>

1. [<span data-ttu-id="91303-105">Перенос последней действительной схемы проекта *project.json* в формат *csproj*</span><span class="sxs-lookup"><span data-stu-id="91303-105">Migration from a valid latest schema of *project.json* to *csproj*</span></span>](#migration-from-projectjson-to-csproj)
2. [<span data-ttu-id="91303-106">Перенос проекта DNX в формат csproj</span><span class="sxs-lookup"><span data-stu-id="91303-106">Migration from DNX to csproj</span></span>](#migration-from-dnx-to-csproj)
3. [<span data-ttu-id="91303-107">Перенос проектов RC3 и проектов .NET Core csproj предыдущих версий в окончательный формат</span><span class="sxs-lookup"><span data-stu-id="91303-107">Migration from RC3 and previous .NET Core csproj projects to the final format</span></span>](#migration-from-earlier-net-core-csproj-formats-to-rtm-csproj)

<span data-ttu-id="91303-108">Этот документ относится только к старым проектам .NET Core с поддержкой project.json.</span><span class="sxs-lookup"><span data-stu-id="91303-108">This document is only applicable to older .NET Core projects that use project.json.</span></span> <span data-ttu-id="91303-109">Он неприменим для переноса из .NET Framework в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="91303-109">It does not apply to migrating from .NET Framework to .NET Core.</span></span>

## <a name="migration-from-projectjson-to-csproj"></a><span data-ttu-id="91303-110">Перенос проекта project.json в формат csproj</span><span class="sxs-lookup"><span data-stu-id="91303-110">Migration from project.json to csproj</span></span>

<span data-ttu-id="91303-111">Перенос проекта *project.json* в формат *.csproj* можно выполнить с помощью одного из следующих методов:</span><span class="sxs-lookup"><span data-stu-id="91303-111">Migration from *project.json* to *.csproj* can be done using one of the following methods:</span></span>

- [<span data-ttu-id="91303-112">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="91303-112">Visual Studio</span></span>](#visual-studio)
- [<span data-ttu-id="91303-113">Команда dotnet migrate</span><span class="sxs-lookup"><span data-stu-id="91303-113">dotnet migrate command-line tool</span></span>](#dotnet-migrate)

<span data-ttu-id="91303-114">В обоих методах используется один и тот же базовый механизм переноса, поэтому результаты будут одинаковыми.</span><span class="sxs-lookup"><span data-stu-id="91303-114">Both methods use the same underlying engine to migrate the projects, so the results will be the same for both.</span></span> <span data-ttu-id="91303-115">В большинстве случаев достаточно использовать один из методов переноса проекта *project.json* в формат *csproj*. Никакого дальнейшего редактирования файла проекта вручную не требуется.</span><span class="sxs-lookup"><span data-stu-id="91303-115">In most cases, using one of these two ways to migrate the *project.json* to *csproj* is the only thing that is needed, and no further manual editing of the project file is necessary.</span></span> <span data-ttu-id="91303-116">Имя полученного файла *.csproj* будет совпадать с именем каталога, в котором находится проект.</span><span class="sxs-lookup"><span data-stu-id="91303-116">The resulting *.csproj* file will be named the same as the containing directory name.</span></span>

### <a name="visual-studio"></a><span data-ttu-id="91303-117">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="91303-117">Visual Studio</span></span>

<span data-ttu-id="91303-118">При открытии файла *.xproj* или файла решения, который ссылается на файлы *.xproj*, в Visual Studio 2017 или Visual Studio 2019 версии 16.2 и более ранних откроется диалоговое окно **Одностороннее обновление**.</span><span class="sxs-lookup"><span data-stu-id="91303-118">When you open an *.xproj* file or a solution file that references *.xproj* files in Visual Studio 2017 or Visual Studio 2019 version 16.2 and earlier, the **One-way upgrade** dialog appears.</span></span> <span data-ttu-id="91303-119">В диалоговом окне отображаются проекты для переноса.</span><span class="sxs-lookup"><span data-stu-id="91303-119">The dialog displays the projects to be migrated.</span></span> <span data-ttu-id="91303-120">Если открыть файл решения, будут показаны все проекты, содержащиеся в файле решения.</span><span class="sxs-lookup"><span data-stu-id="91303-120">If you open a solution file, all the projects specified in the solution file are listed.</span></span> <span data-ttu-id="91303-121">Просмотрите список проектов для переноса и нажмите кнопку **OK**.</span><span class="sxs-lookup"><span data-stu-id="91303-121">Review the list of projects to be migrated and select **OK**.</span></span>

![Диалоговое окно "Одностороннее обновление" со списком проектов для переноса](media/one-way-upgrade.jpg)

<span data-ttu-id="91303-123">Visual Studio автоматически переносит выбранные проекты.</span><span class="sxs-lookup"><span data-stu-id="91303-123">Visual Studio migrates the selected projects automatically.</span></span> <span data-ttu-id="91303-124">Если при переносе решений не выбрать все проекты, откроется то же диалоговое окно с предложением обновить остальные проекты для этого решения.</span><span class="sxs-lookup"><span data-stu-id="91303-124">When migrating a solution, if you don't choose all projects, the same dialog appears asking you to upgrade the remaining projects from that solution.</span></span> <span data-ttu-id="91303-125">После миграции проекта вы можете просматривать и изменять его содержимое, щелкнув проект правой кнопкой мыши в окне **Обозреватель решений** и выбрав **Изменить \<имя_проекта>.csproj**.</span><span class="sxs-lookup"><span data-stu-id="91303-125">After the project is migrated, you can see and modify its contents by right-clicking the project in the **Solution Explorer** window and selecting **Edit \<project name>.csproj**.</span></span>

<span data-ttu-id="91303-126">Перенесенные файлы (*project.json*, *global.json*, *.xproj* и файл решения) перемещаются в папку *Backup*.</span><span class="sxs-lookup"><span data-stu-id="91303-126">Files that were migrated (*project.json*, *global.json*, *.xproj*, and solution file) are moved to a *Backup* folder.</span></span> <span data-ttu-id="91303-127">Перенесенный файл решения обновляется до Visual Studio 2017 или Visual Studio 2019, и вы не сможете открыть этот файл решения в Visual Studio 2015 и предыдущих версиях.</span><span class="sxs-lookup"><span data-stu-id="91303-127">The migrated solution file is upgraded to Visual Studio 2017 or Visual Studio 2019 and you won't be able to open that solution file in Visual Studio 2015 or earlier versions.</span></span> <span data-ttu-id="91303-128">Также будет сохранен и автоматически открыт файл *UpgradeLog.htm*, содержащий отчет о переносе.</span><span class="sxs-lookup"><span data-stu-id="91303-128">A file named *UpgradeLog.htm* that contains a migration report is also saved and opened automatically.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="91303-129">Вы не можете перенести проекты с помощью Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="91303-129">You cannot migrate your projects using Visual Studio 2015.</span></span>

### <a name="dotnet-migrate"></a><span data-ttu-id="91303-130">dotnet migrate</span><span class="sxs-lookup"><span data-stu-id="91303-130">dotnet migrate</span></span>

<span data-ttu-id="91303-131">В сценарии для командной строки можно использовать команду [`dotnet migrate`](../tools/dotnet-migrate.md).</span><span class="sxs-lookup"><span data-stu-id="91303-131">In the command-line scenario, you can use the [`dotnet migrate`](../tools/dotnet-migrate.md) command.</span></span> <span data-ttu-id="91303-132">Она переносит проект, решение или набор папок в указанном порядке в зависимости от того, какие объекты были найдены.</span><span class="sxs-lookup"><span data-stu-id="91303-132">It migrates a project, a solution, or a set of folders in that order, depending on which ones were found.</span></span> <span data-ttu-id="91303-133">При переносе проекта переносятся сам проект и его зависимости.</span><span class="sxs-lookup"><span data-stu-id="91303-133">When you migrate a project, the project and all its dependencies are migrated.</span></span>

<span data-ttu-id="91303-134">Перенесенные файлы (*project.json*, *global.json* и *.xproj*) перемещаются в папку *backup*.</span><span class="sxs-lookup"><span data-stu-id="91303-134">Files that were migrated (*project.json*, *global.json*, and *.xproj*) are moved to a *backup* folder.</span></span>

> [!NOTE]
> <span data-ttu-id="91303-135">Если вы используете Visual Studio Code, команда `dotnet migrate` не изменяет файлы, относящиеся к Visual Studio Code, такие как `tasks.json`.</span><span class="sxs-lookup"><span data-stu-id="91303-135">If you are using Visual Studio Code, the `dotnet migrate` command does not modify Visual Studio Code-specific files such as `tasks.json`.</span></span> <span data-ttu-id="91303-136">Эти файлы нужно будет изменить вручную.</span><span class="sxs-lookup"><span data-stu-id="91303-136">These files need to be changed manually.</span></span>
> <span data-ttu-id="91303-137">Это также справедливо, если используется проект Райдер, другой редактор или интегрированная среда разработки (IDE), отличные от Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="91303-137">This is also true if you are using Project Ryder or any editor or Integrated Development Environment (IDE) other than Visual Studio.</span></span>

<span data-ttu-id="91303-138">Сравнение форматов project.json и CSPROJ см. в разделе [Сопоставление между свойствами project.json и CSPROJ](../tools/project-json-to-csproj.md).</span><span class="sxs-lookup"><span data-stu-id="91303-138">See [A mapping between project.json and csproj properties](../tools/project-json-to-csproj.md) for a comparison of project.json and csproj formats.</span></span>

### <a name="common-issues"></a><span data-ttu-id="91303-139">Распространенные проблемы</span><span class="sxs-lookup"><span data-stu-id="91303-139">Common issues</span></span>

- <span data-ttu-id="91303-140">Если вы получили сообщение об ошибке следующего содержания: "Исполняемый файл, соответствующий команде dotnet-migrate, не найден", сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="91303-140">If you get an error: "No executable found matching command dotnet-migrate":</span></span>

<span data-ttu-id="91303-141">Выполните команду `dotnet --version`, чтобы просмотреть используемую версию интерфейса.</span><span class="sxs-lookup"><span data-stu-id="91303-141">Run `dotnet --version` to see which version you are using.</span></span> <span data-ttu-id="91303-142">[`dotnet migrate`](../tools/dotnet-migrate.md) требует использования интерфейса командной строки .NET Core версии RC3 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="91303-142">[`dotnet migrate`](../tools/dotnet-migrate.md) requires .NET Core CLI RC3 or higher.</span></span>
<span data-ttu-id="91303-143">Вы также получите эту ошибку, если в текущем или родительском каталоге есть файл *global.json* и версия `sdk` установлена в более раннюю.</span><span class="sxs-lookup"><span data-stu-id="91303-143">You’ll get this error if you have a *global.json* file in the current or parent directory and the `sdk` version is set to an older version.</span></span>

## <a name="migration-from-dnx-to-csproj"></a><span data-ttu-id="91303-144">Перенос проекта DNX в формат csproj</span><span class="sxs-lookup"><span data-stu-id="91303-144">Migration from DNX to csproj</span></span>

<span data-ttu-id="91303-145">Если все еще используете DNX для разработки .NET Core, перенос необходимо выполнять в два этапа:</span><span class="sxs-lookup"><span data-stu-id="91303-145">If you are still using DNX for .NET Core development, your migration process should be done in two stages:</span></span>

1. <span data-ttu-id="91303-146">Используйте [существующие руководства по переносу DNX](from-dnx.md) для переноса проекта из DNX в проект project-json с активированным интерфейсом командной строки.</span><span class="sxs-lookup"><span data-stu-id="91303-146">Use the [existing DNX migration guidance](from-dnx.md) to migrate from DNX to project-json enabled CLI.</span></span>
2. <span data-ttu-id="91303-147">Выполните действия, описанные в предыдущем разделе, для переноса проекта из формата *project.json* в формат *.csproj*.</span><span class="sxs-lookup"><span data-stu-id="91303-147">Follow the steps from the previous section to migrate from *project.json* to *.csproj*.</span></span>  

> [!NOTE]
> <span data-ttu-id="91303-148">Формат DNX официально признан устаревшим при выпуске предварительной версии 1 интерфейса командной строки .NET Core.</span><span class="sxs-lookup"><span data-stu-id="91303-148">DNX has become officially deprecated during the Preview 1 release of the .NET Core CLI.</span></span>

## <a name="migration-from-earlier-net-core-csproj-formats-to-rtm-csproj"></a><span data-ttu-id="91303-149">Перенос из более ранних форматов csproj NET Core в формат csproj RTM</span><span class="sxs-lookup"><span data-stu-id="91303-149">Migration from earlier .NET Core csproj formats to RTM csproj</span></span>

<span data-ttu-id="91303-150">Формат csproj .NET Core изменяется и развивается с выпуском каждой новой предварительной версии инструментов.</span><span class="sxs-lookup"><span data-stu-id="91303-150">The .NET Core csproj format has been changing and evolving with each new pre-release version of the tooling.</span></span> <span data-ttu-id="91303-151">Инструмента, с помощью которого можно перенести файл проекта из ранних версий csproj до последней версии, не существует, поэтому вам придется вручную изменить файл проекта.</span><span class="sxs-lookup"><span data-stu-id="91303-151">There is no tool that will migrate your project file from earlier versions of csproj to the latest, so you need to manually edit the project file.</span></span> <span data-ttu-id="91303-152">Фактические действия зависят от версии файла проекта, который вы переносите.</span><span class="sxs-lookup"><span data-stu-id="91303-152">The actual steps depend on the version of the project file you are migrating.</span></span> <span data-ttu-id="91303-153">Вот некоторые рекомендации, которые следует учитывать. Они основаны на изменениях, произошедших между версиями:</span><span class="sxs-lookup"><span data-stu-id="91303-153">The following is some guidance to consider based on the changes that happened between versions:</span></span>

- <span data-ttu-id="91303-154">Удалите свойство версии инструмента из элемента `<Project>`, если оно задано.</span><span class="sxs-lookup"><span data-stu-id="91303-154">Remove the tools version property from the `<Project>` element, if it exists.</span></span>
- <span data-ttu-id="91303-155">Удалите пространство имен XML (`xmlns`) из элемента `<Project>`.</span><span class="sxs-lookup"><span data-stu-id="91303-155">Remove the XML namespace (`xmlns`) from the `<Project>` element.</span></span>
- <span data-ttu-id="91303-156">Если атрибут `Sdk` не существует, добавьте этот атрибут к элементу `<Project>` и установите значение атрибута в `Microsoft.NET.Sdk` или `Microsoft.NET.Sdk.Web`.</span><span class="sxs-lookup"><span data-stu-id="91303-156">If it doesn't exist, add the `Sdk` attribute to the `<Project>` element and set it to `Microsoft.NET.Sdk` or `Microsoft.NET.Sdk.Web`.</span></span> <span data-ttu-id="91303-157">Этот атрибут означает, что в проекте используется указанный пакет SDK.</span><span class="sxs-lookup"><span data-stu-id="91303-157">This attribute specifies that the project uses the SDK to be used.</span></span> <span data-ttu-id="91303-158">`Microsoft.NET.Sdk.Web` используется для веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="91303-158">`Microsoft.NET.Sdk.Web` is used for web apps.</span></span>
- <span data-ttu-id="91303-159">Удалите инструкции `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` и `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` в верхней и нижней частях проекта.</span><span class="sxs-lookup"><span data-stu-id="91303-159">Remove the `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` and `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` statements from the top and bottom of the project.</span></span> <span data-ttu-id="91303-160">Эти инструкции импорта выполняются пакетом SDK, поэтому включать их в проект не нужно.</span><span class="sxs-lookup"><span data-stu-id="91303-160">These import statements are implied by the SDK, so there is no need for them to be in the project.</span></span>
- <span data-ttu-id="91303-161">Если в проекте есть элементы `Microsoft.NETCore.App` или `NETStandard.Library` `<PackageReference>`, их следует удалить.</span><span class="sxs-lookup"><span data-stu-id="91303-161">If you have `Microsoft.NETCore.App` or `NETStandard.Library` `<PackageReference>` items in your project, you should remove them.</span></span> <span data-ttu-id="91303-162">Эти ссылки на пакет [содержатся в пакете SDK](https://aka.ms/sdkimplicitrefs).</span><span class="sxs-lookup"><span data-stu-id="91303-162">These package references are [implied by the SDK](https://aka.ms/sdkimplicitrefs).</span></span>
- <span data-ttu-id="91303-163">Удалите элемент `Microsoft.NET.Sdk` `<PackageReference>`, если он существует.</span><span class="sxs-lookup"><span data-stu-id="91303-163">Remove the `Microsoft.NET.Sdk` `<PackageReference>` element, if it exists.</span></span> <span data-ttu-id="91303-164">Пакет SDK ссылается на атрибут `Sdk` элемента `<Project>`.</span><span class="sxs-lookup"><span data-stu-id="91303-164">The SDK reference comes through the `Sdk` attribute on the `<Project>` element.</span></span>
- <span data-ttu-id="91303-165">Удалите [стандартные маски](https://en.wikipedia.org/wiki/Glob_(programming)), [подразумеваемые пакетом SDK](../tools/csproj.md#default-compilation-includes-in-net-core-projects).</span><span class="sxs-lookup"><span data-stu-id="91303-165">Remove the [globs](https://en.wikipedia.org/wiki/Glob_(programming)) that are [implied by the SDK](../tools/csproj.md#default-compilation-includes-in-net-core-projects).</span></span> <span data-ttu-id="91303-166">Если оставить эти объекты glob в проекте, это приведет к ошибке сборки из-за дублирования элементов компиляции.</span><span class="sxs-lookup"><span data-stu-id="91303-166">Leaving these globs in your project will cause an error on build because compile items will be duplicated.</span></span>

<span data-ttu-id="91303-167">После выполнения этих действий ваш проект должен быть полностью совместим с форматом csproj RTM .NET Core.</span><span class="sxs-lookup"><span data-stu-id="91303-167">After these steps your project should be fully compatible with the RTM .NET Core csproj format.</span></span>

<span data-ttu-id="91303-168">Примеры проектов до и после перехода от старого формата csproj к новому см. в статье [Обновление версии-кандидата Visual Studio 2017 — улучшение инструментов .NET Core](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/) в блоге .NET.</span><span class="sxs-lookup"><span data-stu-id="91303-168">For examples of before and after the migration from old csproj format to the new one, see the [Updating Visual Studio 2017 RC – .NET Core Tooling improvements](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/) article on the .NET blog.</span></span>

## <a name="see-also"></a><span data-ttu-id="91303-169">См. также</span><span class="sxs-lookup"><span data-stu-id="91303-169">See also</span></span>

- [<span data-ttu-id="91303-170">Перенос кода, миграция и обновление проектов Visual Studio</span><span class="sxs-lookup"><span data-stu-id="91303-170">Port, Migrate, and Upgrade Visual Studio Projects</span></span>](/visualstudio/porting/port-migrate-and-upgrade-visual-studio-projects)
