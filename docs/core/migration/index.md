---
title: Перенос .NET Core из project.json
description: Сведения о переносе старого проекта .NET Core с использованием project.json
ms.date: 07/19/2017
ms.openlocfilehash: 0d4190a02389089a888d8b52dd8e7c412636b575
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2020
ms.locfileid: "90538254"
---
# <a name="migrating-net-core-projects-from-projectjson"></a>Перенос проектов .NET Core из project.json

В этом документе рассматриваются следующие три сценария миграции для проектов .NET Core.

1. [Перенос последней действительной схемы проекта *project.json* в формат *csproj*](#migration-from-projectjson-to-csproj)
2. [Перенос проекта DNX в формат csproj](#migration-from-dnx-to-csproj)
3. [Перенос проектов RC3 и проектов .NET Core csproj предыдущих версий в окончательный формат](#migration-from-earlier-net-core-csproj-formats-to-rtm-csproj)

Этот документ относится только к старым проектам .NET Core с поддержкой project.json. Он неприменим для переноса из .NET Framework в .NET Core.

## <a name="migration-from-projectjson-to-csproj"></a>Перенос проекта project.json в формат csproj

Перенос проекта *project.json* в формат *.csproj* можно выполнить с помощью одного из следующих методов:

- [Visual Studio](#visual-studio)
- [Команда dotnet migrate](#dotnet-migrate)

В обоих методах используется один и тот же базовый механизм переноса, поэтому результаты будут одинаковыми. В большинстве случаев достаточно использовать один из методов переноса проекта *project.json* в формат *csproj*. Никакого дальнейшего редактирования файла проекта вручную не требуется. Имя полученного файла *.csproj* будет совпадать с именем каталога, в котором находится проект.

### <a name="visual-studio"></a>Visual Studio

При открытии файла *.xproj* или файла решения, который ссылается на файлы *.xproj*, в Visual Studio 2017 или Visual Studio 2019 версии 16.2 и более ранних откроется диалоговое окно **Одностороннее обновление**. В диалоговом окне отображаются проекты для переноса. Если открыть файл решения, будут показаны все проекты, содержащиеся в файле решения. Просмотрите список проектов для переноса и нажмите кнопку **OK**.

![Диалоговое окно "Одностороннее обновление" со списком проектов для переноса](media/one-way-upgrade.jpg)

Visual Studio автоматически переносит выбранные проекты. Если при переносе решений не выбрать все проекты, откроется то же диалоговое окно с предложением обновить остальные проекты для этого решения. Когда проект будет перенесен, для просмотра и изменения его содержимого щелкните проект правой кнопкой в окне **Обозреватель решений** и выберите **Изменить \<project name>.csproj**.

Перенесенные файлы (*project.json*, *global.json*, *.xproj* и файл решения) перемещаются в папку *Backup*. Перенесенный файл решения обновляется до Visual Studio 2017 или Visual Studio 2019, и вы не сможете открыть этот файл решения в Visual Studio 2015 и предыдущих версиях. Также будет сохранен и автоматически открыт файл *UpgradeLog.htm*, содержащий отчет о переносе.

> [!IMPORTANT]
> В Visual Studio 2019 версии 16.3 и более поздних не удается загрузить или перенести файл формата *XPROJ*. Кроме того, Visual Studio 2015 не предоставляет возможность переноса файла *XPROJ*. Если вы используете одну из этих версий Visual Studio, установите подходящую версию Visual Studio или используйте средство миграции командной строки, описанное далее.

### <a name="dotnet-migrate"></a>dotnet migrate

В сценарии для командной строки можно использовать команду [`dotnet migrate`](../tools/dotnet-migrate.md). Она переносит проект, решение или набор папок в указанном порядке в зависимости от того, какие объекты были найдены. При переносе проекта переносятся сам проект и его зависимости.

Перенесенные файлы (*project.json*, *global.json* и *.xproj*) перемещаются в папку *backup*.

> [!NOTE]
> Если вы используете Visual Studio Code, команда `dotnet migrate` не изменяет файлы, относящиеся к Visual Studio Code, такие как *tasks.json*. Эти файлы нужно будет изменить вручную.
> Это также справедливо, если используются редактор или интегрированная среда разработки (IDE), отличные от Visual Studio.

Сравнение форматов *project.json* и *CSPROJ* см. в разделе [Сопоставление свойств project.json и CSPROJ](../tools/project-json-to-csproj.md).

Если вы получили сообщение об ошибке следующего содержания:

> "Исполняемый файл, соответствующий команде dotnet-migrate, не найден"

Выполните команду `dotnet --version`, чтобы просмотреть используемую версию интерфейса. [`dotnet migrate`](../tools/dotnet-migrate.md) был представлен в пакете SDK для .NET Core 1.0.0 и удален в версии 3.0.100.
Вы также получите эту ошибку, если в текущем или родительском каталоге есть файл *global.json* и указанная в нем версия `sdk` выходит за пределы этого диапазона.

## <a name="migration-from-dnx-to-csproj"></a>Перенос проекта DNX в формат csproj

Если все еще используете DNX для разработки .NET Core, перенос необходимо выполнять в два этапа:

1. Используйте [существующие руководства по переносу DNX](from-dnx.md) для переноса проекта из DNX в проект project-json с активированным интерфейсом командной строки.
2. Выполните действия, описанные в предыдущем разделе, для переноса проекта из формата *project.json* в формат *.csproj*.

> [!NOTE]
> Формат DNX официально признан устаревшим при выпуске предварительной версии 1 интерфейса командной строки .NET Core.

## <a name="migration-from-earlier-net-core-csproj-formats-to-rtm-csproj"></a>Перенос из более ранних форматов csproj NET Core в формат csproj RTM

Формат csproj .NET Core изменяется и развивается с выпуском каждой новой предварительной версии инструментов. Инструмента, с помощью которого можно перенести файл проекта из ранних версий csproj до последней версии, не существует, поэтому вам придется вручную изменить файл проекта. Фактические действия зависят от версии файла проекта, который вы переносите. Вот некоторые рекомендации, которые следует учитывать. Они основаны на изменениях, произошедших между версиями:

- Удалите свойство версии инструмента из элемента `<Project>`, если оно задано.
- Удалите пространство имен XML (`xmlns`) из элемента `<Project>`.
- Если атрибут `Sdk` не существует, добавьте этот атрибут к элементу `<Project>` и установите значение атрибута в `Microsoft.NET.Sdk` или `Microsoft.NET.Sdk.Web`. Этот атрибут означает, что в проекте используется указанный пакет SDK. `Microsoft.NET.Sdk.Web` используется для веб-приложений.
- Удалите инструкции `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` и `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` в верхней и нижней частях проекта. Эти инструкции импорта выполняются пакетом SDK, поэтому включать их в проект не нужно.
- Если в проекте есть элементы `Microsoft.NETCore.App` или `NETStandard.Library` `<PackageReference>`, их следует удалить. Эти ссылки на пакет [содержатся в пакете SDK](../tools/csproj.md).
- Удалите элемент `Microsoft.NET.Sdk` `<PackageReference>`, если он существует. Пакет SDK ссылается на атрибут `Sdk` элемента `<Project>`.
- Удалите [стандартные маски](https://en.wikipedia.org/wiki/Glob_(programming)), [подразумеваемые пакетом SDK](../project-sdk/overview.md#default-compilation-includes). Если оставить эти объекты glob в проекте, это приведет к ошибке сборки из-за дублирования элементов компиляции.

После выполнения этих действий ваш проект должен быть полностью совместим с форматом csproj RTM .NET Core.

Примеры проектов до и после перехода от старого формата csproj к новому см. в статье [Обновление версии-кандидата Visual Studio 2017 — улучшение инструментов .NET Core](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/) в блоге .NET.

## <a name="see-also"></a>См. также

- [Перенос кода, миграция и обновление проектов Visual Studio](/visualstudio/porting/port-migrate-and-upgrade-visual-studio-projects)
