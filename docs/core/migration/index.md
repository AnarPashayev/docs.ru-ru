---
title: Перенос .NET Core из project.json
description: Сведения о переносе старого проекта .NET Core с использованием project.json
ms.date: 07/19/2017
ms.custom: seodec18
ms.openlocfilehash: f48728e647b57a8c5796bdc2119f72b58a49d80f
ms.sourcegitcommit: 58fc0e6564a37fa1b9b1b140a637e864c4cf696e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2019
ms.locfileid: "57675918"
---
# <a name="migrating-net-core-projects-from-projectjson"></a>Перенос проектов .NET Core из project.json

В этом документе рассматриваются сценарии переноса для проектов .NET Core. В частности, три следующие сценарии переноса:

1. [Перенос последней действительной схемы проекта *project.json* в формат *csproj*](#migration-from-projectjson-to-csproj)
2. [Перенос проекта DNX в формат csproj](#migration-from-dnx-to-csproj)
3. [Перенос проектов RC3 и проектов .NET Core csproj предыдущих версий в окончательный формат](#migration-from-earlier-net-core-csproj-formats-to-rtm-csproj)

Этот документ относится только к старым проектам .NET Core с поддержкой project.json. Он неприменим для переноса из .NET Framework в .NET Core.

## <a name="migration-from-projectjson-to-csproj"></a>Перенос проекта project.json в формат csproj

Перенос проекта *project.json* в формат *.csproj* можно выполнить с помощью одного из следующих методов:

- [Visual Studio 2017](#visual-studio-2017)
- [Команда dotnet migrate](#dotnet-migrate)

В обоих методах используется один и тот же базовый механизм переноса, поэтому результаты будут одинаковыми. В большинстве случаев достаточно использовать один из методов переноса проекта *project.json* в формат *csproj*. Никакого дальнейшего редактирования файла проекта вручную не требуется. Имя полученного файла *.csproj* будет совпадать с именем каталога, в котором находится проект.

### <a name="visual-studio-2017"></a>Visual Studio 2017

При открытии файла *.xproj* или файла решения, который ссылается на файлы *.xproj*, появится диалоговое окно **Одностороннее обновление**. В диалоговом окне отображаются проекты для переноса.
Если открыть файл решения, будут показаны все проекты, содержащиеся в файле решения. Просмотрите список проектов для переноса и нажмите кнопку **OK**.

![Диалоговое окно "Одностороннее обновление" со списком проектов для переноса](media/one-way-upgrade.jpg)

Visual Studio выполнит перенос для выбранных проектов автоматически. Если при переносе решений не выбрать все проекты, откроется то же диалоговое окно с предложением обновить остальные проекты для этого решения. После миграции проекта вы можете просматривать и изменять его содержимое, щелкнув проект правой кнопкой мыши в окне **Обозреватель решений** и выбрав **Изменить \<имя_проекта>.csproj**.

Перенесенные файлы (*project.json*, *global.json*, *.xproj* и файл решения) будут перемещены в папку *Backup*. Перенесенный файл решения будет обновлен до Visual Studio 2017, и вы не сможете открыть этот файл решения в предыдущих версиях Visual Studio.
Также будет сохранен и автоматически открыт файл *UpgradeLog.htm*, содержащий отчет о переносе.

> [!IMPORTANT]
> Новые средства недоступны в Visual Studio 2015, поэтому вы не сможете выполнить перенос проектов с помощью этой версии Visual Studio.

### <a name="dotnet-migrate"></a>dotnet migrate

В сценарии для командной строки можно использовать команду [`dotnet migrate`](../tools/dotnet-migrate.md). Она переносит проект, решение или набор папок в указанном порядке, в зависимости от того, какие объекты были найдены.
При переносе проекта переносятся сам проект и его зависимости.

Перенесенные файлы (*project.json*, *global.json* и *.xproj*) будут перемещены в папку *backup*.

> [!NOTE]
> Если вы используете Visual Studio Code, команда `dotnet migrate` не будет изменять файлы, относящиеся к Visual Studio Code, такие как `tasks.json`. Эти файлы нужно будет изменить вручную.
> Это также справедливо, если используется проект Райдер, другой редактор или интегрированная среда разработки (IDE), отличные от Visual Studio.

Сравнение форматов project.json и CSPROJ см. в разделе [Сопоставление между свойствами project.json и CSPROJ](../tools/project-json-to-csproj.md).

### <a name="common-issues"></a>Распространенные проблемы

- Если вы получили сообщение об ошибке следующего содержания: "Исполняемый файл, соответствующий команде dotnet-migrate, не найден", сделайте следующее.

Выполните команду `dotnet --version`, чтобы просмотреть используемую версию интерфейса. [`dotnet migrate`](../tools/dotnet-migrate.md) требует использования интерфейса командной строки .NET Core версии RC3 или более поздней версии.
Вы также получите эту ошибку, если в текущем или родительском каталоге есть файл *global.json* и версия `sdk` установлена в более раннюю.

## <a name="migration-from-dnx-to-csproj"></a>Перенос проекта DNX в формат csproj

Если все еще используете DNX для разработки .NET Core, перенос необходимо выполнять в два этапа:

1. Используйте [существующие руководства по переносу DNX](from-dnx.md) для переноса проекта из DNX в проект project-json с активированным интерфейсом командной строки.
2. Выполните действия, описанные в предыдущем разделе, для переноса проекта из формата *project.json* в формат *.csproj*.  

> [!NOTE]
> Формат DNX официально признан устаревшим при выпуске предварительной версии 1 интерфейса командной строки .NET Core.

## <a name="migration-from-earlier-net-core-csproj-formats-to-rtm-csproj"></a>Перенос из более ранних форматов csproj NET Core в формат csproj RTM

Формат csproj .NET Core изменяется и развивается с выпуском каждой новой предварительной версии инструментов. Инструмента, с помощью которого можно перенести файл проекта из ранних версий csproj до последней версии, не существует, поэтому вам придется вручную изменить файл проекта. Фактические действия зависят от версии файла проекта, который вы переносите. Вот некоторые рекомендации, которые следует учитывать. Они основаны на изменениях, произошедших между версиями:

* Удалите свойство версии инструмента из элемента `<Project>`, если оно задано.
* Удалите пространство имен XML (`xmlns`) из элемента `<Project>`.
* Если атрибут `Sdk` не существует, добавьте этот атрибут к элементу `<Project>` и установите значение атрибута в `Microsoft.NET.Sdk` или `Microsoft.NET.Sdk.Web`. Этот атрибут означает, что в проекте используется указанный пакет SDK. `Microsoft.NET.Sdk.Web` используется для веб-приложений.
* Удалите инструкции `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` и `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` в верхней и нижней частях проекта. Эти инструкции импорта выполняются пакетом SDK, поэтому включать их в проект не нужно.
* Если в проекте есть элементы `Microsoft.NETCore.App` или `NETStandard.Library` `<PackageReference>`, их следует удалить. Эти ссылки на пакет [содержатся в пакете SDK](https://aka.ms/sdkimplicitrefs).
* Удалите элемент `Microsoft.NET.Sdk` `<PackageReference>`, если он существует. Пакет SDK ссылается на атрибут `Sdk` элемента `<Project>`.
* Удалите [стандартные маски](https://en.wikipedia.org/wiki/Glob_(programming)), [подразумеваемые пакетом SDK](../tools/csproj.md#default-compilation-includes-in-net-core-projects). Если оставить эти объекты glob в проекте, это приведет к ошибке сборки из-за дублирования элементов компиляции.

После выполнения этих действий ваш проект должен быть полностью совместим с форматом csproj RTM .NET Core.

Примеры проектов до и после перехода от старого формата csproj к новому см. в статье [Обновление версии-кандидата Visual Studio 2017 — улучшение инструментов .NET Core](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/) в блоге .NET.

## <a name="see-also"></a>См. также

- [Перенос кода, миграция и обновление проектов Visual Studio](/visualstudio/porting/port-migrate-and-upgrade-visual-studio-projects)
