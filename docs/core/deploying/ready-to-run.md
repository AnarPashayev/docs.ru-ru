---
title: Обзор развертывания ReadyToRun
description: Узнайте, что собой представляют развертывания ReadyToRun и зачем их использовать при публикации приложения с помощью .NET 5 и .NET Core 3.0, а также более поздних версий.
author: davidwr
ms.author: davidwr
ms.date: 09/21/2020
ms.openlocfilehash: b4052a0c0f4ed9f6cfd273abe5ef45d018bd0ae0
ms.sourcegitcommit: 4d45bda8cd9558ea8af4be591e3d5a29360c1ece
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2020
ms.locfileid: "91654951"
---
# <a name="readytorun-compilation"></a>Компиляция ReadyToRun

Вы можете уменьшить время запуска и задержку приложения .NET, скомпилировав все сборки приложения в формат ReadyToRun (R2R). R2R является разновидностью компиляции AOT.

Бинарные файлы R2R повышают производительность при запуске, снижая объем работы, выполняемой на этом этапе компилятором JIT. Бинарные файлы содержат такой же машинный код, который создается компилятором JIT. Но бинарные файлы R2R имеют больший размер, так как содержат не только код на промежуточном языке (IL), который по-прежнему необходим для некоторых сценариев, но и версию того же кода на машинном языке. Функция R2R доступна только при публикации приложения, предназначенного для конкретной среды выполнения (RID), например для Windows x64 или Linux x64.

Чтобы скомпилировать проект в формат ReadyToRun, нужно опубликовать приложение, задав свойство PublishReadyToRun со значением true.

Опубликовать приложение в формате ReadyToRun можно двумя способами:

01. Укажите флаг PublishReadyToRun непосредственно для команды dotnet publish. Дополнительные сведения см. в статье [dotnet publish](../tools/dotnet-publish.md).

    ```dotnetcli
    dotnet publish -c Release -r win-x64 -p:PublishReadyToRun=true
    ```

02. Укажите свойство в проекте.

    - Добавьте параметр `<PublishReadyToRun>` в проект.

    ```xml
    <PropertyGroup>
      <PublishReadyToRun>true</PublishReadyToRun>
    </PropertyGroup>
    ```

    - Опубликуйте приложение без особых параметров.

    ```dotnetcli
    dotnet publish -c Release -r win-x64
    ```

## <a name="impact-of-using-the-readytorun-feature"></a>Влияние использования функции ReadyToRun

Компиляция Ahead Of Time оказывает существенное влияние на производительность приложения, которую может быть трудно спрогнозировать. Как правило, размер сборки увеличивается в два или три раза. Увеличение физического размера файла может привести к снижению производительности при загрузке сборки с диска и увеличить рабочий набор процесса. Но при этом число методов, компилируемых во время выполнения, обычно значительно сокращается. В результате большинство приложений с большим объемом кода получают значительные преимущества в отношении производительности, если включена функция ReadyToRun. Для приложений с небольшим объемом кода, скорее всего, будет трудно заметить значительное улучшение работы, когда функция ReadyToRun включена, так как библиотеки среды выполнения .NET были предварительно скомпилированы с помощью ReadyToRun.

Такое улучшение относится не только к запуску приложений, но и к первому использованию любого кода в приложении. Например, с помощью ReadyToRun можно уменьшить задержку ответа при первом использовании веб-API в приложении ASP.NET.

### <a name="interaction-with-tiered-compilation"></a>Взаимодействие с многоуровневой компиляцией

Код, созданный при компиляции Ahead Of Time, не так хорошо оптимизирован как код, созданный JIT-компилятором. Для решения этой проблемы в многоуровневой компиляция часто используемые методы ReadyToRun заменяются методами, созданными JIT-компилятором.

## <a name="how-is-the-set-of-precompiled-assemblies-chosen"></a>Как выбирается набор предварительно скомпилированных сборок

Пакет SDK реализует предварительную компиляцию сборок, распространяемых вместе с приложением. Для автономных приложений в такой набор сборок будет включена платформа. Двоичные файлы C++/CLI не подходят для компиляции ReadyToRun.

## <a name="how-is-the-set-of-methods-to-precompile-chosen"></a>Как выбирается набор методов для предварительной компиляции

Компилятор попытается предварительно скомпилировать как можно больше методов. Но по ряду причин использование функции ReadyToRun вряд ли помешает JIT-компиляции.

Помимо прочего, к таким причинам могут относиться:

- использование универсальных типов, определенных в отдельных сборках;
- взаимодействие с нативным кодом;
- использование встроенных аппаратных средств, безопасность которых компилятор не может гарантировать для целевого компьютера;
- некоторые нестандартные шаблоны IL;
- динамическое создание методов с использованием отражения или LINQ.

## <a name="cross-platformarchitecture-restrictions"></a>Ограничения при работе с несколькими платформами и архитектурами

На некоторых платформах SDK компилятор ReadyToRun может выполнять перекрестную компиляцию для других целевых платформ. Поддерживаемые целевые платформы для компиляции указаны в таблице ниже.

| SDK платформы | Поддерживаемые целевые платформы |
| ------------ | --------------------------- |
| Windows X64  | Windows X86, Windows X64, Windows ARM32, Windows ARM64 |
| Windows X86  | Windows X86, Windows ARM32 |
| Linux X64    | Linux X86, Linux X64, Linux ARM32, Linux ARM64 |
| Linux ARM32  | Linux ARM32 |
| Linux ARM64  | Linux ARM64 |
| macOS X64    | macOS X64 |
