---
title: Приложение с одним файлом
description: Узнайте, что такое приложение с одним файлом и зачем нужно использовать эту модель развертывания приложения.
author: lakshanf
ms.author: lakshanf
ms.date: 08/28/2020
ms.openlocfilehash: 795ea98a9fd9d672b199eb2d9b24151340ef8246
ms.sourcegitcommit: cbacb5d2cebbf044547f6af6e74a9de866800985
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/05/2020
ms.locfileid: "89495757"
---
# <a name="single-file-deployment-and-executable"></a>Развертывание и выполнение в виде отдельного файла

Объединение всех зависящих от приложения файлов в один двоичный файл предоставляет разработчику приложения привлекательный вариант развертывания и распространения приложения в виде одного файла. Эта модель развертывания была доступна с момента выпуска .NET Core 3.0 и улучшена в .NET 5.0. Ранее в .NET Core 3.0, когда пользователь запускал приложение с одним файлом, узел .NET Core перед запуском приложения сначала извлекал все файлы во временный каталог. В .NET 5.0 этот подход был улучшен, позволяя запускать код напрямую без необходимости извлекать файлы из приложения.

Развертывание в одном файле доступно как для [зависимой от платформы модели развертывания](index.md#publish-framework-dependent), так и для [автономных приложений](index.md#publish-self-contained). Размер одного файла для автономного приложения будет большим, так как он будет включать в себя среду выполнения и библиотеки платформы. Вариант развертывания в виде одного файла можно сочетать с параметрами публикации [ReadyToRun](../tools/dotnet-publish.md) и [Обрезка (экспериментальная функция в .NET 5.0)](trim-self-contained.md).

Существуют некоторые предостережения, которые необходимо учитывать при использовании одного файла. Первое из них — это использование сведений о пути для поиска файла относительно расположения приложения. API <xref:System.Reflection.Assembly.Location?displayProperty=nameWithType> будет возвращать пустую строку, что является поведением по умолчанию для сборок, загруженных из памяти. Во время сборки компилятор выдаст предупреждение для этого API, чтобы предупредить разработчика о специфичном поведении. Если требуется получить путь к каталогу приложения, то API <xref:System.AppContext.BaseDirectory?displayProperty=nameWithType> возвращает каталог, в котором находится AppHost (сам пакет в одном файлом). Управляемые приложения C++ плохо подходят для развертывания в одном файле, поэтому рекомендуется писать приложения на C#, если требуется совместимость с развертыванием в одном файле.

По умолчанию один файл не включает собственные библиотеки. В Linux предварительно связывается среда выполнения с пакетом, а в каталоге, в котором размещается приложение с одним файлом, развертываются только собственные библиотеки приложения. В Windows предварительно связывается только код размещения, а в каталоге, в котором размещается приложение с одним файлом, развертываются как библиотеки среды выполнения, так и собственные библиотеки приложения. Это позволяет обеспечить эффективную отладку, для которой требуется, чтобы собственные файлы были исключены из одного файла. Можно задать флаг `IncludeNativeLibrariesForSelfExtract`, чтобы включить собственные библиотеки в один пакет, но эти файлы будут извлечены во временный каталог на клиентском компьютере при запуске приложения с одним файлом.

## <a name="exclude-files-from-being-embedded"></a>Исключить файлы из внедрения

Некоторые файлы можно явно исключить из внедрения в один файл, установив следующие метаданные.

```xml
<ExcludeFromSingleFile>true</ExcludeFromSingleFile>
```

Например, чтобы поместить некоторые файлы в каталог публикации, но не объединять их в один файл, укажите следующие параметры.

```xml
<ItemGroup>
  <Content Update="Plugin.dll">
    <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
    <ExcludeFromSingleFile>true</ExcludeFromSingleFile>
  </Content>
</ItemGroup>
```

## <a name="publish-a-single-file-app---cli"></a>Публикация приложения с одним файлом с помощью CLI

Опубликуйте приложение с одним файлом с помощью команды [dotnet publish](../tools/dotnet-publish.md). При публикации приложения задайте следующие свойства.

- Опубликовать для конкретной среды выполнения: `-r win-x64`
- Опубликовать в виде одного файла: `-p:PublishSingleFile=true`

В следующем примере приложение для Windows публикуется как автономное приложение с одним файлом.

```dotnetcli
dotnet publish -r win-x64 -p:PublishSingleFile=true --self-contained true
```

В следующем примере приложение для Linux публикуется как зависимое от платформы приложение с одним файлом.

```dotnetcli
dotnet publish -r linux-x64 -p:PublishSingleFile=true --self-contained false
```

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="publish-a-single-file-app---visual-studio"></a>Публикация приложения с одним файлом с помощью Visual Studio

Visual Studio создает многократно используемые профили публикации, которые управляют процессом публикации приложения.

01. В **обозревателе решений** щелкните правой кнопкой мыши проект, который нужно опубликовать. Нажмите кнопку **Опубликовать**.

    :::image type="content" source="media/single-file/visual-studio-solution-explorer.png" alt-text="Обозреватель решений с контекстным меню, где выделен пункт Опубликовать":::

    Если у вас еще нет профиля публикации, следуйте инструкциям по его созданию и выберите **Папка** в качестве типа целевого объекта.

01. Нажмите кнопку **Изменить**.

    :::image type="content" source="media/single-file/visual-studio-publish-edit-settings.png" alt-text="Профиль публикации Visual Studio с кнопкой Изменить":::

01. В диалоговом окне **Параметры профиля** задайте следующие параметры.

    - Параметру **Режим развертывания** задайте значение **Автономное**.
    - В качестве значения параметра **Целевая среда выполнения** укажите платформу, на которую будет выполнена публикация.
    - Выберите **Создать отдельный файл**.

    Нажмите кнопку **Сохранить**, чтобы сохранить параметры и вернуться в диалоговое окно **Публикация**.

    :::image type="content" source="media/single-file/visual-studio-publish-single-file-properties.png" alt-text="Диалоговое окно параметров профиля с выделенными параметрами для режима развертывания, целевой среды выполнения и создания отдельного файла":::

01. Чтобы опубликовать приложение с одним файлом, нажмите кнопку **Опубликовать**.

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md).

## <a name="publish-a-single-file-app---visual-studio-for-mac"></a>Публикация приложения с одним файлом с помощью Visual Studio для Mac

В Visual Studio для Mac отсутствует возможность публикации приложения в виде одного файла. Вам потребуется опубликовать приложение вручную, выполнив инструкции из раздела [Публикация приложения с одним файлом с помощью CLI](#publish-a-single-file-app---cli). Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="see-also"></a>См. также

- [Развертывание приложений .NET Core](index.md)
- [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md)
- [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md)
- [Команда `dotnet publish`](../tools/dotnet-publish.md).
