---
title: Обрезка автономных приложений
description: Сведения об обрезке автономных приложений для уменьшения их размера. .NET Core объединяет среду выполнения с автономно публикуемым приложением и обычно содержит больше компонентов среды выполнения, чем необходимо.
author: jamshedd
ms.author: jamshedd
ms.date: 04/03/2020
ms.openlocfilehash: 0fde409e9e5911213855ab206368d302b73eebb3
ms.sourcegitcommit: ef86c24c418439b8bb5e3e7d64bbdbe5e11c3e9c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "88720128"
---
# <a name="trim-self-contained-deployments-and-executables"></a>Обрезка автономных развертываний и исполняемых файлов

[Модель развертывания с зависимостью от платформы](index.md#publish-framework-dependent) была наиболее успешной моделью развертывания с момента запуска .NET. При таком сценарии разработчик приложения связывает только приложение и сторонние сборки, ожидая, что среда выполнения .NET и библиотеки платформы будут доступны на клиентском компьютере. Эта модель развертывания продолжает доминировать и в .NET Core, но в некоторых случаях модель, зависящая от платформы, не является оптимальной. Альтернативой является публикация [автономного приложения](index.md#publish-self-contained), в котором среда выполнения и платформа .NET Core объединены вместе с приложением и сборками сторонних производителей.

Автономная модель развертывания — это специализированная версия автономной модели развертывания, оптимизированная для уменьшения размера развертывания. Минимизация размера развертывания является критически важным требованием для некоторых сценариев на стороне клиента, например приложений Blazor. В зависимости от сложности приложения, для его запуска требуется только подмножество сборок платформы. Неиспользуемые компоненты библиотеки не нужны, поэтому их можно удалить из упакованного приложения. Однако существует риск того, что анализ времени сборки приложения может вызвать сбои во время выполнения из-за невозможности надежного анализа различных проблемных шаблонов кода (в основном сосредоточенных на использовании отражения). Так как надежность не гарантируется, эта модель развертывания предлагается в качестве предварительной версии. Модуль анализа времени сборки предоставляет разработчикам предупреждения о проблемных шаблонах кода с предположением, что эти шаблоны кода будут исправлены. Там, где это возможно, мы рекомендуем переместить все зависимости отражения среды выполнения в приложении во время сборки с помощью кода, отвечающего тем же требованиям.

Режим обрезки для приложений можно настроить с помощью TrimMode, и по умолчанию (`copyused`) он будет объединять сборки пакета, используемые в приложении. Приложения Blazor WebAssembly используют более агрессивный режим (`link`), который будет обрезать неиспользуемый код в сборках. Предупреждения анализа обрезки предоставляют сведения о шаблонах кода, в которых невозможен полный анализ зависимостей. Эти предупреждения подавляются по умолчанию и могут быть включены путем установки флага `SuppressTrimAnalysisWarnings` в значение false. Дополнительные сведения о доступных параметрах обрезки можно найти на [странице ILLinker](https://github.com/mono/linker/blob/master/docs/illink-options.md).

> [!NOTE]
> Обрезка — это экспериментальная функция в .NET Core 3.1, 5.0, которая доступна _только_ для автономно публикуемых приложений.

## <a name="prevent-assemblies-from-being-trimmed"></a>Исключение сборок из процесса обрезки

В некоторых случаях функции обрезки не удается обнаружить ссылки. Например, если в сборке среды выполнения отражение используется либо приложением, либо библиотекой, на которую ссылается приложение, прямые ссылки на эту сборку отсутствуют. Процессу обрезки неизвестно об этих косвенных ссылках, и он исключит библиотеку из папки опубликованных.

Когда код косвенно ссылается на сборку через отражение, можно исключить сборку из процесса обрезки с помощью параметра `<TrimmerRootAssembly>`. В следующем примере показано исключение сборки с именем `System.Security` из процесса обрезки.

```xml
<ItemGroup>
    <TrimmerRootAssembly Include="System.Security" />
</ItemGroup>
```

## <a name="trim-your-app---cli"></a>Обрезка приложения с помощью CLI

Выполните обрезку приложения с помощью команды [dotnet publish](../tools/dotnet-publish.md). При публикации приложения задайте следующие три параметра.

- Опубликовать как автономное: `--self-contained true`
- Включить обрезку: `p:PublishTrimmed=true`

В следующем примере показана публикация приложения для Windows в качестве автономного и обрезка выходных данных.

```xml
<ItemGroup>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <SelfContained>true</SelfContained>
    <PublishTrimmed>true</PublishTrimmed>
</ItemGroup>
```

В следующем примере приложение публикуется в режиме агрессивной обрезки, в котором неиспользованный код в сборках будет обрезан, а предупреждения об обрезке будут включены.

```xml
<ItemGroup>
    <TrimMode>link</TrimMode>
    <SuppressTrimAnalysisWarnings>false</SuppressTrimAnalysisWarnings>
</ItemGroup>
```

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="trim-your-app---visual-studio"></a>Обрезка приложения с помощью Visual Studio

Visual Studio создает многократно используемые профили публикации, которые управляют процессом публикации приложения.

01. В **обозревателе решений** щелкните правой кнопкой мыши проект, который нужно опубликовать. Выберите команду **Опубликовать…** .

    :::image type="content" source="media/trim-self-contained/visual-studio-solution-explorer.png" alt-text="Обозреватель решений с контекстным меню, где выделен пункт Опубликовать":::

    Если у вас еще нет профиля публикации, следуйте инструкциям по его созданию и выберите **Папка** в качестве типа целевого объекта.

01. Нажмите кнопку **Изменить**.

    :::image type="content" source="media/trim-self-contained/visual-studio-publish-edit-settings.png" alt-text="Профиль публикации Visual Studio с кнопкой Изменить":::

01. В диалоговом окне **Параметры профиля** задайте следующие параметры.

    - Параметру **Режим развертывания** задайте значение **Автономное**.
    - В качестве значения параметра **Целевая среда выполнения** укажите платформу, на которую будет выполнена публикация.
    - Выберите **Обрезать неиспользуемые сборки (в предварительной версии)** .

    Нажмите кнопку **Сохранить**, чтобы сохранить параметры и вернуться в диалоговое окно **Публикация**.

    :::image type="content" source="media/trim-self-contained/visual-studio-publish-properties.png" alt-text="Диалоговое окно параметров профиля с выделенными параметрами для режима развертывания, целевой среды выполнения и обрезки неиспользуемых сборок.":::

01. Чтобы опубликовать обрезанное приложение, нажмите кнопку **Опубликовать**.

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md).

## <a name="trim-your-app---visual-studio-for-mac"></a>Обрезка приложения с помощью Visual Studio для Mac

В Visual Studio для Mac отсутствует возможность обрезки приложения во время публикации. Вам потребуется вручную опубликовать приложение, выполнив инструкции в разделе [Образка приложения с помощью CLI](#trim-your-app---cli). Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="see-also"></a>См. также

- [Развертывание приложений .NET Core](index.md)
- [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md)
- [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md)
- [Команда dotnet publish](../tools/dotnet-publish.md)
