---
title: Обрезка автономных приложений
description: Сведения об обрезке автономных приложений для уменьшения их размера. .NET Core объединяет среду выполнения с автономно публикуемым приложением и обычно содержит больше компонентов среды выполнения, чем необходимо.
author: jamshedd
ms.author: jamshedd
ms.date: 04/03/2020
ms.openlocfilehash: bb8ac88c5e16b7fd20a7670e4ad76dbe4b44da1b
ms.sourcegitcommit: 7980a91f90ae5eca859db7e6bfa03e23e76a1a50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81242928"
---
# <a name="trim-self-contained-deployments-and-executables"></a>Обрезка автономных развертываний и исполняемых файлов

При публикации автономного приложения среда выполнения .NET Core объединяется с приложением. В этом случае в упакованное приложение добавляется значительный объем содержимого. Когда дело доходит до развертывания приложения, размер часто является важным фактором. Как правило, разработчики приложений стремятся максимально уменьшить размер пакета приложения.

В зависимости от сложности приложения для его запуска и работы требуется только подмножество среды выполнения. Неиспользуемые компоненты среды выполнения не нужны, поэтому их можно удалить из упакованного приложения.

Функция обрезки проверяет двоичные файлы приложения, чтобы найти требуемые сборки среды выполнения и построить соответствующий граф. Оставшиеся сборки среды выполнения, на которые отсутствуют ссылки, исключаются.

> [!NOTE]
> Обрезка — это экспериментальная функция в .NET Core 3.1, которая доступна _только_ для автономно публикуемых приложений.

## <a name="prevent-assemblies-from-being-trimmed"></a>Исключение сборок из процесса обрезки

В некоторых случаях функции обрезки не удается обнаружить ссылки. Например, если в сборке среды выполнения отражение используется либо приложением, либо библиотекой, на которую ссылается приложение, прямые ссылки на эту сборку отсутствуют. Процессу обрезки неизвестно об этих косвенных ссылках, и он исключит библиотеку из папки опубликованных.

Когда код косвенно ссылается на сборку через отражение, можно исключить сборку из процесса обрезки с помощью параметра `<TrimmerRootAssembly>`. В следующем примере показано исключение сборки с именем `System.Security` из процесса обрезки.

```xml
<ItemGroup>
    <TrimmerRootAssembly Include="System.Security" />
</ItemGroup>
```

## <a name="trim-your-app---cli"></a>Обрезка приложения с помощью CLI

Выполните обрезку приложения с помощью команды [dotnet publish](../tools/dotnet-publish.md). При публикации приложения задайте следующие три параметра.

- Опубликовать как автономное: `--self-contained true`
- Отключить однофайловую публикацию: `-p:PublishSingleFile=false`
- Включить обрезку: `p:PublishTrimmed=true`

В следующем примере показана публикация приложения для Windows 10 в качестве автономного и обрезка выходных данных.

```dotnetcli
dotnet publish -c Release -r win10-x64 --self-contained true -p:PublishSingleFile=false -p:PublishTrimmed=true
```

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="trim-your-app---visual-studio"></a>Обрезка приложения с помощью Visual Studio

Visual Studio создает многократно используемые профили публикации, которые управляют процессом публикации приложения.

01. В **обозревателе решений** щелкните правой кнопкой мыши проект, который нужно опубликовать. Выберите команду **Опубликовать…** .

    :::image type="content" source="media/trim-self-contained/visual-studio-solution-explorer.png" alt-text="Обозреватель решений с контекстным меню, где выделен пункт "Опубликовать"":::

    Если у вас еще нет профиля публикации, следуйте инструкциям по его созданию и выберите **Папка** в качестве типа целевого объекта.

01. Нажмите кнопку **Изменить**.

    :::image type="content" source="media/trim-self-contained/visual-studio-publish-edit-settings.png" alt-text="Профиль публикации Visual Studio с кнопкой "Изменить"":::

01. В диалоговом окне **Параметры профиля** задайте следующие параметры.

    - Параметру **Режим развертывания** задайте значение **Автономное**.
    - В качестве значения параметра **Целевая среда выполнения** укажите платформу, на которую будет выполнена публикация.
    - Выберите **Обрезать неиспользуемые сборки (в предварительной версии)** .

    Нажмите кнопку **Сохранить**, чтобы сохранить параметры и вернуться в диалоговое окно **Публикация**.

    :::image type="content" source="media/trim-self-contained/visual-studio-publish-properties.png" alt-text="Диалоговое окно параметров профиля с выделенными параметрами для режима развертывания, целевой среды выполнения и обрезки неиспользуемых сборок.":::

01. Чтобы опубликовать обрезанное приложение, нажмите кнопку **Опубликовать**.

Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md).

## <a name="trim-your-app---visual-studio-for-mac"></a>Обрезка приложения с помощью Visual Studio для Mac

В Visual Studio для Mac отсутствует возможность обрезки приложения во время публикации. Вам потребуется вручную опубликовать приложение, выполнив инструкции в разделе [Образка приложения с помощью CLI](#trim-your-app---cli). Дополнительные сведения см. в статье [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md).

## <a name="see-also"></a>См. также

- [Развертывание приложений .NET Core](index.md)
- [Публикация приложений .NET Core с помощью .NET Core CLI](deploy-with-cli.md)
- [Публикация приложений .NET Core с помощью Visual Studio](deploy-with-vs.md)
- [Команда dotnet publish](../tools/dotnet-publish.md)
