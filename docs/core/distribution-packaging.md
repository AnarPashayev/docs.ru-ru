---
title: Упаковка дистрибутивов .NET Core
description: Узнайте, как создавать пакеты .NET Core, присваивать им имена и управлять их версиями для распространения.
author: tmds
ms.date: 10/09/2019
ms.openlocfilehash: a345aeded29b3058c6c56abbff439ea26cbc7afb
ms.sourcegitcommit: cdf5084648bf5e77970cbfeaa23f1cab3e6e234e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "81386642"
---
# <a name="net-core-distribution-packaging"></a>Упаковка дистрибутивов .NET Core

Так как .NET Core становится доступным на все большем количестве платформ, полезно знать, как создавать пакеты, присваивать им имена и управлять их версиями. Таким образом издатели пакетов смогут обеспечить согласованную работу независимо от платформы, выбранной пользователями для запуска .NET. Эта статья пригодится пользователям, которые:

- выполняют сборку .NET Core из исходного кода;
- хотят внести в .NET Core CLI изменения, способные повлиять на итоговый макет или создаваемые пакеты.

## <a name="disk-layout"></a>Структура диска

Установка .NET Core включает несколько компонентов, которые располагаются в файловой системе следующим образом:

```
{dotnet_root}                                     (*)
├── dotnet                       (1)
├── LICENSE.txt                  (8)
├── ThirdPartyNotices.txt        (8)
├── host                                          (*)
│   └── fxr                                       (*)
│       └── <fxr version>        (2)
├── sdk                                           (*)
│   ├── <sdk version>            (3)
│   └── NuGetFallbackFolder      (4)              (*)
├── packs                                         (*)
│   ├── Microsoft.AspNetCore.App.Ref              (*)
│   │   └── <aspnetcore ref version>     (11)
│   ├── Microsoft.NETCore.App.Ref                 (*)
│   │   └── <netcore ref version>        (12)
│   ├── Microsoft.NETCore.App.Host.<rid>          (*)
│   │   └── <apphost version>            (13)
│   ├── Microsoft.WindowsDesktop.App.Ref          (*)
│   │   └── <desktop ref version>        (14)
│   └── NETStandard.Library.Ref                   (*)
│       └── <netstandard version>        (15)
├── shared                                        (*)
│   ├── Microsoft.NETCore.App                     (*)
│   │   └── <runtime version>     (5)
│   ├── Microsoft.AspNetCore.App                  (*)
│   │   └── <aspnetcore version>  (6)
│   ├── Microsoft.AspNetCore.All                  (*)
│   │   └── <aspnetcore version>  (6)
│   └── Microsoft.WindowsDesktop.App              (*)
│       └── <desktop app version> (7)
└── templates                                     (*)
│   └── <templates version>      (17)
/
├── etc/dotnet
│       └── install_location     (16)
├── usr/share/man/man1
│       └── dotnet.1.gz          (9)
└── usr/bin
        └── dotnet               (10)
```

- (1) **dotnet**: основное приложение (также называется "мультиплексором") выполняет две функции: активирует среду выполнения для запуска приложения и активирует пакет SDK для отправки в него команд. Основное приложение представляет собой исполняемый файл в машинном коде (`dotnet.exe`).

Хотя основное приложение одно, большинство остальных компонентов хранятся в каталогах версий (2, 3, 5, 6). Это значит, что в системе могут быть представлены сразу несколько версий, поскольку разные версии компонентов устанавливаются параллельно.

- (2) **host/fxr/\<fxr version>** содержит логику разрешений платформы, используемую основным приложением. Основное приложение использует новейшую установленную версию hostfxr. Hostfxr отвечает за выбор необходимой среды выполнения при запуске приложения .NET Core. Например, приложение, созданное для среды выполнения .NET Core 2.0.0, использует версию 2.0.5, если версия 2.0.0 недоступна. Аналогично hostfxr выбирает соответствующую версию SDK во время разработки.

- (3) **sdk/\<версия пакета sdk>** Пакет SDK (или "инструментарий") — это набор управляемых инструментов, которые используются для написания кода и сборки библиотек и приложений .NET Core. Пакет SDK содержит .NET Core CLI, компиляторы языков с управляемым кодом, MSBuild, а также соответствующие задачи и целевые объекты сборки, NuGet, новые шаблоны проектов и т. д.

- (4) **sdk/NuGetFallbackFolder** содержит кэш пакетов NuGet, которые пакет SDK использует во время операции восстановления, например при выполнении `dotnet restore` или `dotnet build`. Эта папка используется только в версиях, предшествующих .NET Core 3.0. Ее невозможно создать из источника, так как она содержит предварительно созданные двоичные ресурсы из `nuget.org`.

Папка **shared** содержит платформы. Общая платформа предоставляет набор библиотек в центральном расположении таким образом, что они могут использоваться другими приложениями.

- (5) **shared/Microsoft.NETCore.App/\<runtime version>** эта платформа содержит среду выполнения .NET Core и вспомогательные управляемые библиотеки.

- (6) **shared/Microsoft.AspNetCore.{App,All}/\<aspnetcore version>** содержит библиотеки ASP.NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.App` разрабатываются и поддерживаются как часть проекта .NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.All` представляют собой подмножество, которое также содержит сторонние библиотеки.

- (7) **shared/Microsoft.Desktop.App/\<desktop app version>** содержит библиотеки для классических приложений Windows. Не используется на платформах, отличных от Windows.

- (8) **LICENSE.txt,ThirdPartyNotices.txt** — это, соответственно, лицензии на .NET Core и на сторонние библиотеки, которые используются в .NET Core.

- (9, 10) **dotnet.1.gz, dotnet** `dotnet.1.gz` — это страница руководства по dotnet. `dotnet` представляет собой символическую ссылку на основное приложение dotnet (1). Эти файлы устанавливаются в типичные расположения для системной интеграции.

- (11,12) **Microsoft.NETCore.App.Ref,Microsoft.AspNetCore.App.Ref** описывают API версии `x.y` .NET Core и ASP.NET Core соответственно. Эти пакеты используются при компиляции для этих целевых версий.

- (13) **Microsoft.NETCore.App.Host.\<rid>** содержит собственный двоичный файл для платформы `rid`. Этот двоичный файл представляет собой шаблон, используемый при компиляции приложения .NET Core в собственный двоичный файл для этой платформы.

- (14) **Microsoft.WindowsDesktop.App.Ref** описывает API версии `x.y` для классических приложений Windows. Эти файлы используются при компиляции для этого целевого объекта. Не используется на платформах, отличных от Windows.

- (15) **NETStandard.Library.Ref** описывает API `x.y` netstandard. Эти файлы используются при компиляции для этого целевого объекта.

- (16) **/etc/dotnet/install_location** — это файл, содержащий полный путь для `{dotnet_root}`. Путь может заканчиваться новой строкой. Если корневым элементом является `/usr/share/dotnet`, добавлять этот файл не нужно.

- (17) **templates** содержат шаблоны, используемые пакетом SDK. Например, `dotnet new` находит шаблоны проектов.

Папки, помеченные `(*)`, используются несколькими пакетами. Для некоторых форматов пакетов (например, `rpm`) требуется специальная обработка таких папок. Этим должен заниматься специалист по обслуживанию пакетов.

## <a name="recommended-packages"></a>Рекомендуемые пакеты

Управление версиями .NET Core основано на номерах версий компонентов среды выполнения вида `[major].[minor]`.
Версия пакета SDK использует тот же `[major].[minor]` и имеет независимый номер `[patch]`, отражающий функцию и номер исправления для пакета SDK.
Пример: Пакет SDK версии 2.2.302 — это второй выпуск исправления для третьей функции пакета SDK, который поддерживает среду выполнения версии 2.2. Дополнительные сведения о принципах управления версиями см. в разделе [Общие сведения об управлении версиями .NET Core](./versions/index.md).

Некоторые пакеты содержат часть номера версии в своем имени. Это позволяет устанавливать определенную версию.
Остальная часть версии в имя версии не включается. Это позволяет диспетчеру пакетов операционной системы обновлять пакеты (например, автоматически устанавливать исправления безопасности). Поддерживаемые диспетчеры пакетов рассчитаны на Linux.

Далее перечислены рекомендуемые пакеты.

- `dotnet-sdk-[major].[minor]` — устанавливает новейшую версию пакета SDK для конкретной среды выполнения
  - **Версия:** \<версия среды выполнения>
  - **Пример:** dotnet-sdk-2.1
  - **Содержит:** (3),(4)
  - **Зависимости:** `dotnet-runtime-[major].[minor]`, `aspnetcore-runtime-[major].[minor]`, `dotnet-targeting-pack-[major].[minor]`, `aspnetcore-targeting-pack-[major].[minor]`, `netstandard-targeting-pack-[netstandard_major].[netstandard_minor]`, `dotnet-apphost-pack-[major].[minor]`, `dotnet-templates-[major].[minor]`

- `aspnetcore-runtime-[major].[minor]` — устанавливает конкретную среду выполнения ASP.NET Core
  - **Версия:** \<версия среды выполнения aspnetcore>
  - **Пример:** aspnetcore-runtime-2.1
  - **Содержит:** (6)
  - **Зависимости:** `dotnet-runtime-[major].[minor]`

- `dotnet-runtime-deps-[major].[minor]` _(Необязательно)_  — устанавливает зависимости для запуска автономных приложений
  - **Версия:** \<версия среды выполнения>
  - **Пример:** dotnet-runtime-deps-2.1
  - **Зависимости:** _зависимости, зависящие от распределения_

- `dotnet-runtime-[major].[minor]` — устанавливает конкретную среду выполнения
  - **Версия:** \<версия среды выполнения>
  - **Пример:** dotnet-runtime-2.1
  - **Содержит:** (5)
  - **Зависимости:** `dotnet-hostfxr-[major].[minor]`, `dotnet-runtime-deps-[major].[minor]`

- `dotnet-hostfxr-[major].[minor]` — зависимость
  - **Версия:** \<версия среды выполнения>
  - **Пример:** dotnet-hostfxr-3.0
  - **Содержит:** (2)
  - **Зависимости:** `dotnet-host`

- `dotnet-host` — зависимость
  - **Версия:** \<версия среды выполнения>
  - **Пример:** dotnet-host
  - **Содержит:** (1),(8),(9),(10),(16)

- `dotnet-apphost-pack-[major].[minor]` — зависимость
  - **Версия:** \<версия среды выполнения>
  - **Содержит:** (13)

- `dotnet-targeting-pack-[major].[minor]` — нацеливание на непоследнюю среду выполнения
  - **Версия:** \<версия среды выполнения>
  - **Содержит:** (12)

- `aspnetcore-targeting-pack-[major].[minor]` — нацеливание на непоследнюю среду выполнения
  - **Версия:** \<версия среды выполнения aspnetcore>
  - **Содержит:** (11)

- `netstandard-targeting-pack-[netstandard_major].[netstandard_minor]` — нацеливание на версию netstandard
  - **Версия:** \<версия пакета SDK>
  - **Содержит:** (15)

- `dotnet-templates-[major].[minor]`
  - **Версия:** \<версия пакета SDK>
  - **Содержит:** (15)

Для использования `dotnet-runtime-deps-[major].[minor]` необходимо понимать _зависимости для конкретных дистрибутивов_. Так как система сборки дистрибутива может наследовать этот пакет автоматически, он является необязательным. В этом случае эти зависимости добавляются прямо в пакет `dotnet-runtime-[major].[minor]`.

Если содержимое пакета находится в папке, которой присвоена версия, имя пакета `[major].[minor]` совпадает с именем этой папки. Для всех пакетов, кроме `netstandard-targeting-pack-[netstandard_major].[netstandard_minor]`, также обязательно совпадение версий .NET Core.

Для зависимостей между пакетами должно действовать следующее применимое к версиям правило: _больше или равно_. Например, для `dotnet-sdk-2.2:2.2.401` требуется `aspnetcore-runtime-2.2 >= 2.2.6`. В этом случае пользователь может обновить свою установку с помощью корневого пакета (например, `dnf update dotnet-sdk-2.2`).

Большинство дистрибутивов требуют построения из источника всех артефактов. Это определенным образом влияет на пакеты:

- Сторонние библиотеки в каталоге `shared/Microsoft.AspNetCore.All` нельзя собрать из исходного хода. Поэтому эта папка исключена из пакета `aspnetcore-runtime`.

- Папка `NuGetFallbackFolder` заполняется двоичными артефактами с сайта `nuget.org`. Она должна оставаться пустой.

Несколько пакетов `dotnet-sdk` могут предоставлять одни и те же файлы для каталога `NuGetFallbackFolder`. Чтобы не возникали проблемы с диспетчером пакетов, эти файлы (контрольная сумма, дата изменения и т. д.) должны быть идентичны.

## <a name="building-packages"></a>Построение пакетов

Репозиторий [dotnet/source-build](https://github.com/dotnet/source-build) содержит инструкции по созданию архива TAR с исходным кодом пакета SDK для .NET Core и всех его компонентов. Выход репозитория, построенного из источника, соответствует виду, описанному в первом разделе этой статьи.
