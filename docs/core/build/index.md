---
title: Сборка .NET Core из исходного кода
description: Узнайте, как выполнять сборку .NET Core и интерфейса командной строки .NET Core из исходного кода.
author: bleroy
ms.date: 06/28/2017
ms.openlocfilehash: fe5431667d861d830c2ec56252e6e3e2ca08a866
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "75740914"
---
# <a name="build-net-core-from-source"></a>Сборка .NET Core из исходного кода

Возможность сборки .NET Core из своего исходного кода важна по многим причинам: это упрощает перенос кода .NET Core на новые платформы, позволяет вносить в продукт дополнения и исправления, а также создавать пользовательские версии .NET.
В статье представлены рекомендации для разработчиков, которые хотят осуществлять сборку и распространение собственных версий .NET Core.

## <a name="build-the-clr-from-source"></a>Сборка среды CLR из исходного кода

Исходный код .NET CoreCLR можно найти в репозитории [dotnet/runtime](https://github.com/dotnet/runtime/) на сайте GitHub.

Для сборки сейчас необходимо следующее:

- [Git](https://git-scm.com/)
- [CMake](https://cmake.org/)
- [Python](https://www.python.org/)
- Компилятор C++

После установки необходимых компонентов вы можете выполнить сборку CLR, запустив скрипт (`build.cmd` в Windows или `build.sh` в Linux и macOS) в базовой ветке репозитория [dotnet/runtime](https://github.com/dotnet/runtime/).

Устанавливаемые компоненты отличаются в зависимости от операционной системы (ОС). Инструкции по сборке для конкретных ОС:

- [Windows](https://github.com/dotnet/coreclr/blob/master/Documentation/building/windows-instructions.md)
- [Linux](https://github.com/dotnet/coreclr/blob/master/Documentation/building/linux-instructions.md)
- [macOS](https://github.com/dotnet/coreclr/blob/master/Documentation/building/osx-instructions.md)
- [FreeBSD](https://github.com/dotnet/coreclr/blob/master/Documentation/building/freebsd-instructions.md)
- [NetBSD](https://github.com/dotnet/coreclr/blob/master/Documentation/building/netbsd-instructions.md)

Сборка из одной ОС под другие ОС не поддерживается (за исключением ARM, где сборка осуществляется на X64).  
Сборка под конкретную платформу должна осуществляться на этой же платформе.  

Сборка имеет два основных типа `buildTypes`:

- Debug — применяется по умолчанию; компилирует среду выполнения с минимальным уровнем оптимизации и использованием дополнительных проверок среды выполнения (утверждения assert). Понижение уровня оптимизации и дополнительные проверки замедляют работу среды выполнения, но это необходимо делать для отладки. Этот тип рекомендуется использовать со средами разработки и тестирования.
- Release — компилирует среду выполнения с исходным уровнем оптимизации и без использования дополнительных проверок среды выполнения. Это существенно ускоряет выполнение, но сборка займет немного больше времени, а отладка будет затруднена. Чтобы выбрать этот тип сборки, передайте `release` в соответствующий скрипт.

Кроме того, по умолчанию сборка не только создает исполняемые файлы среды выполнения, но и создает все тесты.
Тестов довольно много, и они занимают немало времени. Однако, если вы хотите просто поэкспериментировать с изменениями, использовать тесты не обязательно.
Вы можете пропустить создание тестов, добавив аргумент в сценарий сборки `skiptests`, как показано в следующем примере (замените `.\build` на `./build.sh` на компьютерах с ОС Unix):

```bat
    .\build skiptests
```

В предыдущем примере показано, как выполнить сборку типа `Debug`со включенными проверками времени разработки (утверждения assert) и отключенной оптимизацией. Чтобы создать конфигурацию Release (Выпуск), обеспечивающую максимальную скорость работы, сделайте следующее.

```bat
    .\build release skiptests
```

Чтобы просмотреть другие варианты сборки, запустите build с квалификатором "-?" или "-help".

### <a name="using-your-build"></a>Использование сборки

Сборка помещает все созданные файлы в каталог `bin` в корне репозитория.
Каталог *bin\Log* содержит созданные во время сборки файлы журнала (они особенно полезны при неудачной сборке).
Фактический результат размещается в каталоге *bin\Product\[платформа].[архитектура_процессора].[тип_сборки]* , например *bin\Product\Windows_NT.x64.Release*.

Хотя "сырой" результат сборки иногда бывает полезен, обычно вам нужны только пакеты NuGet, которые размещаются в подкаталоге `.nuget\pkg` предыдущего выходного каталога.

Существует два основных метода использования новой среды выполнения:

 1. **Использование dotnet.exe и NuGet для создания приложения**.
    Воспользуйтесь указаниями на странице [Using Your Build](https://github.com/dotnet/runtime/blob/master/docs/workflow/testing/using-your-build.md) (Использование сборки), чтобы создать программу, использующую вашу новую среду выполнения, на основе только что созданных вами пакетов NuGet и интерфейса командной строки dotnet. Разработчики, не работающие в среде выполнения, скорее всего будут взаимодействовать с вашей новой средой выполнения именно таким способом.

 2. **Использование corerun.exe для запуска приложения с помощью неупакованных библиотек DLL**.
    Этот репозиторий также задает простое основное приложение corerun.exe, у которого НЕТ зависимостей в NuGet.
    Необходимо сообщить этому приложению, где получить именно те библиотеки DLL, которые вы используете. Вам нужно будет собрать эти библиотеки вместе вручную.
    Этот метод используется во всех тестах в репозитории [dotnet/runtime](https://github.com/dotnet/runtime). Его можно использовать для быстрого локального проведения цикла "правка — компиляция — отладка", например при предварительном модульном тестировании.
    Подробнее об использовании этого метода см. в статье [Executing .NET Core Apps with CoreRun.exe](https://github.com/dotnet/runtime/blob/master/docs/workflow/testing/using-corerun.md) (Запуск приложений .NET Core с помощью CoreRun.exe).

## <a name="build-the-cli-from-source"></a>Сборка интерфейса командной строки из исходного кода

Исходный код для .NET Core CLI находится в репозитории [dotnet/cli](https://github.com/dotnet/cli/) на сайте GitHub.

Для сборки CLI-интерфейса .NET Core на компьютеры должны быть установлены следующие компоненты.

- Windows и Linux:
  - git в каталоге переменной PATH
- macOS:
  - git в каталоге переменной PATH
  - Xcode
  - Openssl

Чтобы выполнить сборку, запустите `build.cmd` в Windows или `build.sh` в Linux и macOS из корня. Если вы не хотите выполнять тесты, используйте `build.cmd -t:Compile` или `./build.sh -t:Compile`. Для сборки CLI в macOS Sierra задайте значение переменной среды DOTNET_RUNTIME_ID, выполнив `export DOTNET_RUNTIME_ID=osx.10.11-x64`.

### <a name="using-your-build"></a>Использование сборки

Чтобы испытать созданный CLI-интерфейс, используйте исполняемый файл `dotnet` из *artifacts/{os}-{arch}/stage2*. Если вы хотите использовать результат сборки при вызове `dotnet` из текущей консоли, вы можете также добавить *artifacts/{os}-{arch}/stage2* в переменную PATH.

## <a name="see-also"></a>См. также

- [Среда выполнения .NET](https://github.com/dotnet/runtime/blob/master/README.md)
- [Руководство разработчика по интерфейсу командной строки .NET Core](https://github.com/dotnet/cli/blob/master/Documentation/project-docs/developer-guide.md)
- [Упаковка дистрибутивов .NET Core](./distribution-packaging.md)
