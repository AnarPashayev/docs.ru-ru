---
title: Упаковка дистрибутивов .NET Core
description: Узнайте, как создавать пакеты .NET Core, присваивать им имена и управлять их версиями для распространения.
author: tmds
ms.date: 03/02/2018
ms.custom: seodec18
ms.openlocfilehash: 5d23147c8a38fbeea9e88c0a18e1f220e854fec1
ms.sourcegitcommit: 6f28b709592503d27077b16fff2e2eacca569992
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70105417"
---
# <a name="net-core-distribution-packaging"></a>Упаковка дистрибутивов .NET Core

Так как .NET Core становится доступным на все большем количестве платформ, полезно знать, как создавать пакеты, присваивать им имена и управлять их версиями. Таким образом издатели пакетов смогут обеспечить согласованную работу независимо от платформы, выбранной пользователями для запуска .NET. Эта статья пригодится пользователям, которые:

- выполняют сборку .NET Core из исходного кода;
- хотят внести в .NET Core CLI изменения, способные повлиять на итоговый макет или создаваемые пакеты.

## <a name="disk-layout"></a>Структура диска

Установка .NET Core включает несколько компонентов, которые располагаются в файловой системе следующим образом:

```
.
├── dotnet                       (1)
├── LICENSE.txt                  (8)
├── ThirdPartyNotices.txt        (8)
├── host
│   └── fxr
│       └── <fxr version>        (2)
├── sdk
│   ├── <sdk version>            (3)
│   └── NuGetFallbackFolder      (4)
└── shared
    ├── Microsoft.NETCore.App
    │   └── <runtime version>    (5)
    └── Microsoft.AspNetCore.App
        └── <aspnetcore version> (6)
    └── Microsoft.AspNetCore.All
        └── <aspnetcore version> (7)
/
├─usr/share/man/man1
│       └── dotnet.1.gz          (9)
└─usr/bin
        └── dotnet               (10)
```

- (1) **dotnet**: основное приложение (также называется "мультиплексором") выполняет две функции: активирует среду выполнения для запуска приложения и активирует пакет SDK для отправки в него команд. Основное приложение представляет собой исполняемый файл в машинном коде (`dotnet.exe`).

Хотя основное приложение одно, большинство остальных компонентов хранятся в каталогах версий (2, 3, 5, 6). Это значит, что в системе могут быть представлены сразу несколько версий, поскольку разные версии компонентов устанавливаются параллельно.

- (2) **host/fxr/\<fxr version>** содержит логику разрешений платформы, используемую основным приложением. Основное приложение использует новейшую установленную версию hostfxr. Hostfxr отвечает за выбор необходимой среды выполнения при запуске приложения .NET Core. Например, приложение, созданное для среды выполнения .NET Core 2.0.0, использует версию 2.0.5, если версия 2.0.0 недоступна. Аналогично hostfxr выбирает соответствующую версию SDK во время разработки.

- (3) **sdk/\<версия пакета sdk>** Пакет SDK (или "инструментарий") — это набор управляемых инструментов, которые используются для написания кода и сборки библиотек и приложений .NET Core. Пакет SDK включает интерфейс командной строки .NET Core (CLI), компиляторы языков с управляемым кодом, MSBuild, а также соответствующие задачи и целевые объекты сборки, NuGet, новые шаблоны проектов и т. д.

- (4) **sdk/NuGetFallbackFolder** содержит кэш пакетов NuGet, которые пакет SDK использует во время операции восстановления, например при выполнении `dotnet restore` или `dotnet build /t:Restore`.

Папка **shared** содержит платформы. Общая платформа предоставляет набор библиотек в центральном расположении таким образом, что они могут использоваться другими приложениями.

- (5) **shared/Microsoft.NETCore.App/\<runtime version>** эта платформа содержит среду выполнения .NET Core и вспомогательные управляемые библиотеки.

- (6,7) **shared/Microsoft.AspNetCore.{App,All}/\<aspnetcore version>** содержит библиотеки ASP.NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.App` разрабатываются и поддерживаются как часть проекта .NET Core. Библиотеки в каталоге `Microsoft.AspNetCore.All` представляют собой подмножество, которое также содержит сторонние библиотеки.

- (8) **LICENSE.txt,ThirdPartyNotices.txt** — это, соответственно, лицензии на .NET Core и на сторонние библиотеки, которые используются в .NET Core.

- (9, 10) **dotnet.1.gz, dotnet** `dotnet.1.gz` — это страница руководства по dotnet. `dotnet` представляет собой символическую ссылку на основное приложение dotnet (1). Эти файлы устанавливаются в типичные расположения для системной интеграции.

## <a name="recommended-packages"></a>Рекомендуемые пакеты

Управление версиями .NET Core основано на номерах версий компонентов среды выполнения вида `[major].[minor]`.
Версия пакета SDK использует тот же `[major].[minor]` и имеет независимый номер `[patch]`, отражающий функцию и номер исправления для пакета SDK.
Например: Пакет SDK версии 2.2.302 — это второй выпуск исправления для третьей функции пакета SDK, который поддерживает среду выполнения версии 2.2. Дополнительные сведения о принципах управления версиями см. в разделе [Общие сведения об управлении версиями .NET Core](../versions/index.md).

Некоторые пакеты содержат часть номера версии в своем имени. Это позволяет устанавливать определенную версию.
Остальная часть версии в имя версии не включается. Это позволяет диспетчеру пакетов операционной системы обновлять пакеты (например, автоматически устанавливать исправления безопасности). Поддерживаемые диспетчеры пакетов рассчитаны на Linux.

Рекомендуемые пакеты перечислены в следующей таблице.

| name                                    | Пример                | Вариант использования: устанавливает...           | Содержит           | Зависимости                                   | Версия            |
|-----------------------------------------|------------------------|---------------------------------|--------------------|------------------------------------------------|--------------------|
| dotnet-sdk-[major]                      | dotnet-sdk-2           | Новейшую версию пакета sdk для основной версии среды выполнения    |                    | dotnet-sdk-[major].[latestminor]               | \<версия sdk>     |
| dotnet-sdk-[major].[minor]              | dotnet-sdk-2.1         | Новейшую версию пакета sdk для конкретной среды выполнения |                    | dotnet-sdk-[major].[minor].[latest sdk feat]xx | \<версия sdk>     |
| dotnet-sdk-[major].[minor].[sdk feat]xx | dotnet-sdk-2.1.3xx     | Конкретный выпуск возможности sdk    | (3),(4)            | aspnetcore-runtime-[major].[minor]             | \<версия sdk>     |
| aspnetcore-runtime-[major].[minor]      | aspnetcore-runtime-2.1 | Конкретную среду выполнения ASP.NET Core   | (6),[(7)]          | dotnet-runtime-[major].[minor]                 | \<версия среды выполнения> |
| dotnet-runtime-[major].[minor]          | dotnet-runtime-2.1     | Конкретную среду выполнения                | (5)                | host-fxr:\<версия среды выполнения>+                   | \<версия среды выполнения> |
| dotnet-host-fxr                         | dotnet-host-fxr        | _зависимость_                    | (2)                | host:\<версия среды выполнения>+                       | \<версия среды выполнения> |
| dotnet-host                             | dotnet-host            | _зависимость_                    | (1),(8),(9),(10)   |                                                | \<версия среды выполнения> |

Большинство дистрибутивов требуют построения из источника всех артефактов. Это определенным образом влияет на пакеты:

- Сторонние библиотеки в каталоге `shared/Microsoft.AspNetCore.All` нельзя собрать из исходного хода. Поэтому эта папка исключена из пакета `aspnetcore-runtime`.

- Папка `NuGetFallbackFolder` заполняется двоичными артефактами с сайта `nuget.org`. Она должна оставаться пустой.

Несколько пакетов `dotnet-sdk` могут предоставлять одни и те же файлы для каталога `NuGetFallbackFolder`. Чтобы не возникали проблемы с диспетчером пакетов, эти файлы (контрольная сумма, дата изменения и т. д.) должны быть идентичны.

### <a name="preview-versions"></a>Предварительные версии

Издатели пакетов могут посчитать нужным выпустить предварительные версии общей платформы и пакета SDK. Предварительные выпуски могут предоставляться с помощью `dotnet-sdk-[major].[minor].[sdk feat]xx`, `aspnetcore-runtime-[major].[minor]` или пакетов `dotnet-runtime-[major].[minor]`. Для предварительных выпусков основной номер версии пакета должен быть равен нулю. Таким образом, финальный выпуск устанавливается как обновление пакета.

### <a name="patch-packages"></a>Пакеты исправлений

Поскольку версия исправления для пакета способна привести к критическим изменениям, издатель пакета может предоставлять _пакеты исправлений_. Они позволяют устанавливать определенную версию исправления, не обновляемую автоматически. Используйте пакеты исправлений только в редких случаях, поскольку обновления с исправлениями безопасности в них не устанавливаются.

Рекомендуемые пакеты и **пакеты исправлений** перечислены в следующей таблице.

| name                                           | Пример                  | Содержит         | Зависимости                                              |
|------------------------------------------------|--------------------------|------------------|-----------------------------------------------------------|
| dotnet-sdk-[major]                             | dotnet-sdk-2             |                  | dotnet-sdk-[major].[latest sdk minor]                     |
| dotnet-sdk-[major].[minor]                     | dotnet-sdk-2.1           |                  | dotnet-sdk-[major].[minor].[latest sdk feat]xx            |
| dotnet-sdk-[major].[minor].[sdk feat]xx        | dotnet-sdk-2.1.3xx       |                  | dotnet-sdk-[major].[minor].[latest sdk patch]             |
| **dotnet-sdk-[major].[minor].[patch]**         | dotnet-sdk-2.1.300       | (3),(4)          | aspnetcore-runtime-[major].[minor].[sdk runtime patch]    |
| aspnetcore-runtime-[major].[minor]             | aspnetcore-runtime-2.1   |                  | aspnetcore-runtime-[major].[minor].[latest runtime patch] |
| **aspnetcore-runtime-[major].[minor].[patch]** | aspnetcore-runtime-2.1.0 | (6),[(7)]        | dotnet-runtime-[major].[minor].[patch]                    |
| dotnet-runtime-[major].[minor]                 | dotnet-runtime-2.1       |                  | dotnet-runtime-[major].[minor].[latest runtime patch]     |
| **dotnet-runtime-[major].[minor].[patch]**     | dotnet-runtime-2.1.0     | (5)              | host-fxr:\<версия среды выполнения>+                              |
| dotnet-host-fxr                                | dotnet-host-fxr          | (2)              | host:\<версия среды выполнения>+                                  |
| dotnet-host                                    | dotnet-host              | (1),(8),(9),(10) |                                                           |

Альтернативой использованию пакетов исправлений является _закрепление_ пакетов на конкретной версии с помощью диспетчера пакетов. Чтобы избежать влияния на другие приложения и пользователей, такие приложения можно построить и развернуть в контейнере.

## <a name="building-packages"></a>Построение пакетов

Репозиторий [dotnet/source-build](https://github.com/dotnet/source-build) содержит инструкции по созданию архива TAR с исходным кодом пакета SDK для .NET Core и всех его компонентов. Выход репозитория, построенного из источника, соответствует виду, описанному в первом разделе этой статьи.
