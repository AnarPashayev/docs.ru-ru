---
title: Архитектура программ командной строки .NET Core
description: Дополнительные сведения об уровнях средств .NET Core, а также об изменениях в последних версиях.
ms.date: 03/06/2017
ms.openlocfilehash: e1a9fe59225c17d54f6e7213d2b3c3fa70ee58e0
ms.sourcegitcommit: 73aa9653547a1cd70ee6586221f79cc29b588ebd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "82102883"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a>Краткий обзор изменений в средствах .NET Core

В этом документе описываются изменения, связанные с переходом от использования *project.json* к MSBuild и системе проектов *csproj*, а также содержатся сведения об изменении расположения средств .NET Core и реализации команд интерфейса командной строки. Эти изменения появились в выпуске SDK для .NET Core версии 1.0 и Visual Studio 2017, который увидел свет 7 марта 2017 г. (см. [объявление](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)), но изначально были реализованы в выпуске предварительной версии 3 пакета SDK для .NET Core.

## <a name="moving-away-from-projectjson"></a>Переход с использования project.json

Самое значительное изменение в средствах .NET Core — [переход от project.json к CSPROJ-файлу](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) в качестве системы проектов. Последние версии средств командной строки не поддерживают файлы *project.json*. Это означает, что эти средства нельзя использовать для сборки, запуска и публикации приложений и библиотек на основе project.json. Чтобы использовать эту версию средств, нужно либо перевести на нее имеющиеся проекты, либо создать новые.

В рамках этого перемещения настраиваемый обработчик сборки, разработанная для сборки проектов project.json, заменена на полнофункциональный модуль [MSBuild](https://github.com/Microsoft/msbuild). MSBuild — это хорошо известное средство в сообществе .NET. Оно являлось ключевой технологией платформы с первого ее выпуска. Модуль MSBuild был портирован на .NET Core и позволяет выполнять сборку приложений .NET Core на любых поддерживающих это решение платформах. Мы стремимся превратить .NET Core в кроссплатформенную среду разработки. Этот переход никак не повлияет на работу в этом направлении.

> [!TIP]
> Если вы только начинаете использовать MSBuild и хотите получить дополнительные сведения, в первую очередь прочтите статью [Основные понятия MSBuild](/visualstudio/msbuild/msbuild-concepts).

## <a name="the-tooling-layers"></a>Многоуровневая архитектура средств

В связи со сменой модуля сборки и переходом на другую систему проектов возникает ряд естественных вопросов. Повлияют ли какие-то из этих изменений на общую архитектуру всей экосистемы средств .NET Core? Появились ли новые двоичные файлы и компоненты?

Сначала рассмотрим схему размещения средств по уровням в предварительной версии 2.

![Высокоуровневая архитектура средств предварительной версии 2](media/cli-msbuild-architecture/p2-arch.png)

Иерархия средств в предварительной версии 2 довольно проста. Внизу в качестве основы лежит .NET Core CLI. Все другие средства более высокого уровня, например Visual Studio и Visual Studio Code, зависят от CLI для выполнения таких операций, как сборка проектов, восстановление зависимостей и т. д. Например, для выполнения операции восстановления в Visual Studio требовалось вызвать в CLI команду `dotnet restore`.

В связи с переходом на новую систему проектов предыдущая схема изменилась.

![Высокоуровневая архитектура пакета SDK для .NET Core 1.0.0](media/cli-msbuild-architecture/p3-arch.png)

Основное различие заключается в том, что интерфейс командной строки больше не является основным уровнем. Теперь эту роль выполняет общий компонент SDK. Общий компонент SDK представляет собой набор целевых объектов и связанных задач, которые отвечают за компиляцию и публикацию кода, упаковку пакетов NuGet и т. д. Сам пакет SDK для .NET доступен с открытым кодом на GitHub в [репозитории SDK](https://github.com/dotnet/sdk).

> [!NOTE]
> Целевой объект — это термин MSBuild, обозначающий именованную операцию, которую может вызвать MSBuild. Обычно она связана с одной или несколькими задачами, выполняющими определенную логику, которую должен реализовать целевой объект. MSBuild поддерживает множество готовых целевых объектов, таких как `Copy` или `Execute`. Благодаря этому пользователи могут создавать собственные задачи с помощью управляемого кода и определять целевые объекты для их выполнения. Дополнительную информацию см. в статье [Задачи MSBuild](/visualstudio/msbuild/msbuild-tasks).

Все наборы инструментов теперь используют общий компонент SDK и его целевые объекты, в том числе интерфейс командной строки. Например, Visual Studio 2019 не вызывает команду `dotnet restore` для восстановления зависимостей в проектах .NET Core. Вместо этого напрямую используется целевой объект Restore (Восстановление). Так как это целевые объекты MSBuild, их можно выполнить с помощью команды [dotnet msbuild](dotnet-msbuild.md) в самом модуле MSBuild.

### <a name="cli-commands"></a>Команды CLI

Внедрение общего компонента SDK означает, что большинство существующих команд CLI были заново реализованы как задачи и целевые объекты MSBuild. Как это повлияло на команды интерфейса командной строки и использование набора инструментов?

С точки зрения использования работа с CLI не изменилась. CLI по-прежнему включает основные команды, существовавшие в выпуске .NET Core 1.0 предварительной версии 2:

- `new`
- `restore`
- `run`
- `build`
- `publish`
- `test`
- `pack`

Эти команды по-прежнему выполняют ожидаемые функции (создание, сборка, публикация, упаковка проекта и т. д.). Ознакомиться с их действием можно на экране справки по конкретной команде (при помощи `dotnet <command> --help`) или в документации на этом сайте.

Что касается выполнения, команды CLI принимают свои параметры и создают вызов непосредственно к модулю MSBuild, который задает требуемые свойства и запускает нужный целевой объект. Чтобы лучше проиллюстрировать это, рассмотрим следующую команду:

   ```dotnetcli
   dotnet publish -o pub -c Release
   ```

Эта команда публикует приложение в папку `pub` с помощью конфигурации Release (Выпуск). На внутреннем уровне эта команда преобразовывается в следующий вызов MSBuild:

   ```dotnetcli
   dotnet msbuild -t:Publish -p:OutputPath=pub -p:Configuration=Release
   ```

Важным исключением из этого правила являются команды `new` и `run`. Они не были реализованы в качестве целевых объектов MSBuild.

### <a name="implicit-restore"></a>Неявное восстановление

[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]
