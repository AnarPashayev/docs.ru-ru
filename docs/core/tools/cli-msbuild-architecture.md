---
title: Архитектура программ командной строки .NET Core
description: Дополнительные сведения об уровнях средств .NET Core, а также об изменениях в последних версиях.
ms.date: 03/06/2017
ms.openlocfilehash: fde1a0acb6af9dd65aa3466b4ea37473b2eab6fb
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "77092919"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a><span data-ttu-id="7752f-103">Краткий обзор изменений в средствах .NET Core</span><span class="sxs-lookup"><span data-stu-id="7752f-103">High-level overview of changes in the .NET Core tools</span></span>

<span data-ttu-id="7752f-104">В этом документе описываются изменения, связанные с переходом от использования *project.json* к MSBuild и системе проектов *csproj*, а также содержатся сведения об изменении расположения средств .NET Core и реализации команд интерфейса командной строки.</span><span class="sxs-lookup"><span data-stu-id="7752f-104">This document describes the changes associated with moving from *project.json* to MSBuild and the *csproj* project system with information on the changes to the layering of the .NET Core tooling and the implementation of the CLI commands.</span></span> <span data-ttu-id="7752f-105">Эти изменения появились в выпуске SDK для .NET Core версии 1.0 и Visual Studio 2017, который увидел свет 7 марта 2017 г. (см. [объявление](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)), но изначально были реализованы в выпуске предварительной версии 3 пакета SDK для .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7752f-105">These changes occurred with the release of .NET Core SDK 1.0 and Visual Studio 2017 on March 7, 2017 (see the [announcement](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)) but were initially implemented with the release of the .NET Core SDK Preview 3.</span></span>

## <a name="moving-away-from-projectjson"></a><span data-ttu-id="7752f-106">Переход с использования project.json</span><span class="sxs-lookup"><span data-stu-id="7752f-106">Moving away from project.json</span></span>

<span data-ttu-id="7752f-107">Самое значительное изменение в средствах .NET Core — [переход от project.json к CSPROJ-файлу](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) в качестве системы проектов.</span><span class="sxs-lookup"><span data-stu-id="7752f-107">The biggest change in the tooling for .NET Core is certainly the [move away from project.json to csproj](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) as the project system.</span></span> <span data-ttu-id="7752f-108">Последние версии средств командной строки не поддерживают файлы *project.json*.</span><span class="sxs-lookup"><span data-stu-id="7752f-108">The latest versions of the command-line tools don't support *project.json* files.</span></span> <span data-ttu-id="7752f-109">Это означает, что эти средства нельзя использовать для сборки, запуска и публикации приложений и библиотек на основе project.json.</span><span class="sxs-lookup"><span data-stu-id="7752f-109">That means that it cannot be used to build, run, or publish project.json based applications and libraries.</span></span> <span data-ttu-id="7752f-110">Чтобы использовать эту версию средств, нужно либо перевести на нее имеющиеся проекты, либо создать новые.</span><span class="sxs-lookup"><span data-stu-id="7752f-110">To use this version of the tools, migrate your existing projects or start new ones.</span></span>

<span data-ttu-id="7752f-111">В рамках этого перемещения настраиваемый обработчик сборки, разработанная для сборки проектов project.json, заменена на полнофункциональный модуль [MSBuild](https://github.com/Microsoft/msbuild).</span><span class="sxs-lookup"><span data-stu-id="7752f-111">As part of this move, the custom build engine that was developed to build project.json projects was replaced with a mature and fully capable build engine called [MSBuild](https://github.com/Microsoft/msbuild).</span></span> <span data-ttu-id="7752f-112">MSBuild — это хорошо известное средство в сообществе .NET.</span><span class="sxs-lookup"><span data-stu-id="7752f-112">MSBuild is a well-known engine in the .NET community.</span></span> <span data-ttu-id="7752f-113">Оно являлось ключевой технологией платформы с первого ее выпуска.</span><span class="sxs-lookup"><span data-stu-id="7752f-113">It has been a key technology since the platform's first release.</span></span> <span data-ttu-id="7752f-114">Модуль MSBuild был портирован на .NET Core и позволяет выполнять сборку приложений .NET Core на любых поддерживающих это решение платформах.</span><span class="sxs-lookup"><span data-stu-id="7752f-114">Because it needs to build .NET Core applications, MSBuild has been ported to .NET Core and can be used on any platform that .NET Core runs on.</span></span> <span data-ttu-id="7752f-115">Мы стремимся превратить .NET Core в кроссплатформенную среду разработки. Этот переход никак не повлияет на работу в этом направлении.</span><span class="sxs-lookup"><span data-stu-id="7752f-115">One of the main promises of .NET Core is that of a cross-platform development stack, and we have made sure that this move does not break that promise.</span></span>

> [!TIP]
> <span data-ttu-id="7752f-116">Если вы только начинаете использовать MSBuild и хотите получить дополнительные сведения, в первую очередь прочтите статью [Основные понятия MSBuild](/visualstudio/msbuild/msbuild-concepts).</span><span class="sxs-lookup"><span data-stu-id="7752f-116">If you are new to MSBuild and would like to learn more about it, you can start by reading the [MSBuild concepts](/visualstudio/msbuild/msbuild-concepts) article.</span></span>

## <a name="the-tooling-layers"></a><span data-ttu-id="7752f-117">Многоуровневая архитектура средств</span><span class="sxs-lookup"><span data-stu-id="7752f-117">The tooling layers</span></span>

<span data-ttu-id="7752f-118">В связи со сменой модуля сборки и переходом на другую систему проектов возникает ряд естественных вопросов.</span><span class="sxs-lookup"><span data-stu-id="7752f-118">With the change in build engine and the move away from the existing project system, some questions naturally follow.</span></span> <span data-ttu-id="7752f-119">Повлияют ли какие-то из этих изменений на общую архитектуру всей экосистемы средств .NET Core?</span><span class="sxs-lookup"><span data-stu-id="7752f-119">Do any of these changes change the overall "layering" of the .NET Core tooling ecosystem?</span></span> <span data-ttu-id="7752f-120">Появились ли новые двоичные файлы и компоненты?</span><span class="sxs-lookup"><span data-stu-id="7752f-120">Are there new bits and components?</span></span>

<span data-ttu-id="7752f-121">Сначала рассмотрим схему размещения средств по уровням в предварительной версии 2.</span><span class="sxs-lookup"><span data-stu-id="7752f-121">Let's start with a quick refresher on Preview 2 layering as shown in the following picture:</span></span>

![Высокоуровневая архитектура средств предварительной версии 2](media/cli-msbuild-architecture/p2-arch.png)

<span data-ttu-id="7752f-123">Иерархия средств в предварительной версии 2 довольно проста.</span><span class="sxs-lookup"><span data-stu-id="7752f-123">The layering of the tools in Preview 2 is straightforward.</span></span> <span data-ttu-id="7752f-124">Внизу в качестве основы лежит .NET Core CLI.</span><span class="sxs-lookup"><span data-stu-id="7752f-124">At the bottom, the foundation is the .NET Core CLI.</span></span> <span data-ttu-id="7752f-125">Все другие средства более высокого уровня, например Visual Studio и Visual Studio Code, зависят от CLI для выполнения таких операций, как сборка проектов, восстановление зависимостей и т. д.</span><span class="sxs-lookup"><span data-stu-id="7752f-125">All other, higher-level tools, such as Visual Studio or Visual Studio Code, depend and rely on the CLI to build projects, restore dependencies, and so on.</span></span> <span data-ttu-id="7752f-126">Например, для выполнения операции восстановления в Visual Studio требовалось вызвать в CLI команду `dotnet restore` ([см. примечание](#dotnet-restore-note)).</span><span class="sxs-lookup"><span data-stu-id="7752f-126">For example, if Visual Studio wanted to perform a restore operation, it would call into the `dotnet restore` ([see note](#dotnet-restore-note)) command in the CLI.</span></span>

<span data-ttu-id="7752f-127">В связи с переходом на новую систему проектов предыдущая схема изменилась.</span><span class="sxs-lookup"><span data-stu-id="7752f-127">With the move to the new project system, the previous diagram changes:</span></span>

![Высокоуровневая архитектура пакета SDK для .NET Core 1.0.0](media/cli-msbuild-architecture/p3-arch.png)

<span data-ttu-id="7752f-129">Основное различие заключается в том, что интерфейс командной строки больше не является основным уровнем. Теперь эту роль выполняет общий компонент SDK.</span><span class="sxs-lookup"><span data-stu-id="7752f-129">The main difference is that the CLI is not the foundational layer anymore; this role is now filled by the "shared SDK component".</span></span> <span data-ttu-id="7752f-130">Общий компонент SDK представляет собой набор целевых объектов и связанных задач, которые отвечают за компиляцию и публикацию кода, упаковку пакетов NuGet и т. д.</span><span class="sxs-lookup"><span data-stu-id="7752f-130">This shared SDK component is a set of targets and associated tasks that are responsible for compiling code, publishing it, packing NuGet packages, and so on.</span></span> <span data-ttu-id="7752f-131">Сам пакет SDK для .NET доступен с открытым кодом на GitHub в [репозитории SDK](https://github.com/dotnet/sdk).</span><span class="sxs-lookup"><span data-stu-id="7752f-131">The .NET Core SDK is open-source and is available on GitHub on the [SDK repo](https://github.com/dotnet/sdk).</span></span>

> [!NOTE]
> <span data-ttu-id="7752f-132">Целевой объект — это термин MSBuild, обозначающий именованную операцию, которую может вызвать MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7752f-132">A "target" is an MSBuild term that indicates a named operation that MSBuild can invoke.</span></span> <span data-ttu-id="7752f-133">Обычно она связана с одной или несколькими задачами, выполняющими определенную логику, которую должен реализовать целевой объект.</span><span class="sxs-lookup"><span data-stu-id="7752f-133">It is usually coupled with one or more tasks that execute some logic that the target is supposed to do.</span></span> <span data-ttu-id="7752f-134">MSBuild поддерживает множество готовых целевых объектов, таких как `Copy` или `Execute`. Благодаря этому пользователи могут создавать собственные задачи с помощью управляемого кода и определять целевые объекты для их выполнения.</span><span class="sxs-lookup"><span data-stu-id="7752f-134">MSBuild supports many ready-made targets such as `Copy` or `Execute`; it also allows users to write their own tasks using managed code and define targets to execute those tasks.</span></span> <span data-ttu-id="7752f-135">Дополнительную информацию см. в статье [Задачи MSBuild](/visualstudio/msbuild/msbuild-tasks).</span><span class="sxs-lookup"><span data-stu-id="7752f-135">For more information, see [MSBuild tasks](/visualstudio/msbuild/msbuild-tasks).</span></span>

<span data-ttu-id="7752f-136">Все наборы инструментов теперь используют общий компонент SDK и его целевые объекты, в том числе интерфейс командной строки.</span><span class="sxs-lookup"><span data-stu-id="7752f-136">All the toolsets now consume the shared SDK component and its targets, CLI included.</span></span> <span data-ttu-id="7752f-137">Например, Visual Studio 2019 не вызывает команду `dotnet restore` ([см. примечание](#dotnet-restore-note)) для восстановления зависимостей в проектах .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7752f-137">For example, Visual Studio 2019 doesn't call into the `dotnet restore` ([see note](#dotnet-restore-note)) command to restore dependencies for .NET Core projects.</span></span> <span data-ttu-id="7752f-138">Вместо этого напрямую используется целевой объект Restore (Восстановление).</span><span class="sxs-lookup"><span data-stu-id="7752f-138">Instead, it uses the "Restore" target directly.</span></span> <span data-ttu-id="7752f-139">Так как это целевые объекты MSBuild, их можно выполнить с помощью команды [dotnet msbuild](dotnet-msbuild.md) в самом модуле MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7752f-139">Since these are MSBuild targets, you can also use raw MSBuild to execute them using the [dotnet msbuild](dotnet-msbuild.md) command.</span></span>

### <a name="cli-commands"></a><span data-ttu-id="7752f-140">Команды интерфейса командной строки</span><span class="sxs-lookup"><span data-stu-id="7752f-140">CLI commands</span></span>

<span data-ttu-id="7752f-141">Внедрение общего компонента SDK означает, что большинство существующих команд CLI были заново реализованы как задачи и целевые объекты MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7752f-141">The shared SDK component means that the majority of existing CLI commands have been reimplemented as MSBuild tasks and targets.</span></span> <span data-ttu-id="7752f-142">Как это повлияло на команды интерфейса командной строки и использование набора инструментов?</span><span class="sxs-lookup"><span data-stu-id="7752f-142">What does this mean for the CLI commands and your usage of the toolset?</span></span>

<span data-ttu-id="7752f-143">С точки зрения использования работа с CLI не изменилась.</span><span class="sxs-lookup"><span data-stu-id="7752f-143">From a usage perspective, it doesn't change the way you use the CLI.</span></span> <span data-ttu-id="7752f-144">CLI по-прежнему включает основные команды, существовавшие в выпуске .NET Core 1.0 предварительной версии 2:</span><span class="sxs-lookup"><span data-stu-id="7752f-144">The CLI still has the core commands that existed in the .NET Core 1.0 Preview 2 release:</span></span>

- `new`
- `restore`
- `run`
- `build`
- `publish`
- `test`
- `pack`

<span data-ttu-id="7752f-145">Эти команды по-прежнему выполняют ожидаемые функции (создание, сборка, публикация, упаковка проекта и т. д.).</span><span class="sxs-lookup"><span data-stu-id="7752f-145">These commands still do what you expect them to do (new up a project, build it, publish it, pack it, and so on).</span></span> <span data-ttu-id="7752f-146">Ознакомиться с их действием можно на экране справки по конкретной команде (при помощи `dotnet <command> --help`) или в документации на этом сайте.</span><span class="sxs-lookup"><span data-stu-id="7752f-146">You can consult either the command's help screen (using `dotnet <command> --help`) or documentation on this site to get familiar with their behavior.</span></span>

<span data-ttu-id="7752f-147">Что касается выполнения, команды CLI принимают свои параметры и создают вызов непосредственно к модулю MSBuild, который задает требуемые свойства и запускает нужный целевой объект.</span><span class="sxs-lookup"><span data-stu-id="7752f-147">From an execution perspective, the CLI commands take their parameters and construct a call to "raw" MSBuild that sets the needed properties and runs the desired target.</span></span> <span data-ttu-id="7752f-148">Чтобы лучше проиллюстрировать это, рассмотрим следующую команду:</span><span class="sxs-lookup"><span data-stu-id="7752f-148">To better illustrate this, consider the following command:</span></span>

   ```dotnetcli
   dotnet publish -o pub -c Release
   ```

<span data-ttu-id="7752f-149">Эта команда публикует приложение в папку `pub` с помощью конфигурации Release (Выпуск).</span><span class="sxs-lookup"><span data-stu-id="7752f-149">This command publishes an application into a `pub` folder using the "Release" configuration.</span></span> <span data-ttu-id="7752f-150">На внутреннем уровне эта команда преобразовывается в следующий вызов MSBuild:</span><span class="sxs-lookup"><span data-stu-id="7752f-150">Internally, this command gets translated into the following MSBuild invocation:</span></span>

   ```dotnetcli
   dotnet msbuild -t:Publish -p:OutputPath=pub -p:Configuration=Release
   ```

<span data-ttu-id="7752f-151">Важным исключением из этого правила являются команды `new` и `run`.</span><span class="sxs-lookup"><span data-stu-id="7752f-151">Notable exceptions to this rule are the `new` and `run` commands.</span></span> <span data-ttu-id="7752f-152">Они не были реализованы в качестве целевых объектов MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7752f-152">They have not been implemented as MSBuild targets.</span></span>

<a name="dotnet-restore-note"></a>
[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]
