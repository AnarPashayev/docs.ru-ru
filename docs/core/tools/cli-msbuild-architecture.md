---
title: Архитектура программ командной строки .NET Core
description: Дополнительные сведения об уровнях средств .NET Core, а также об изменениях в последних версиях.
ms.date: 03/06/2017
ms.openlocfilehash: 05183a9edc26615e00d6383043fd10d8bec06f2b
ms.sourcegitcommit: 4f4a32a5c16a75724920fa9627c59985c41e173c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2019
ms.locfileid: "72521307"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a>Краткий обзор изменений в средствах .NET Core

В этом документе описываются изменения, связанные с переходом от использования *project.json* к MSBuild и системе проектов *csproj*, а также содержатся сведения об изменении расположения средств .NET Core и реализации команд интерфейса командной строки. Эти изменения появились в выпуске SDK для .NET Core версии 1.0 и Visual Studio 2017, который увидел свет 7 марта 2017 г. (см. [объявление](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)), но изначально были реализованы в выпуске предварительной версии 3 пакета SDK для .NET Core.

## <a name="moving-away-from-projectjson"></a>Переход с использования project.json

Самое значительное изменение в средствах .NET Core — [переход от project.json к CSPROJ-файлу](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) в качестве системы проектов. Последние версии средств командной строки не поддерживают файлы *project.json*. Это означает, что эти средства нельзя использовать для сборки, выполнения или публикации приложений и библиотек на основе project.json. Чтобы использовать эту версию средств, необходимо переместить имеющиеся проекты или создать новые. 

В рамках этого перемещения настраиваемый обработчик сборки, разработанная для сборки проектов project.json, заменена на полнофункциональный модуль [MSBuild](https://github.com/Microsoft/msbuild). Это хорошо известный модуль в сообществе .NET, так как это основная технология с момента первого выпуска платформы. Чтобы этот модуль можно было использовать для сборки приложений .NET Core, MSBuild был перенесен на .NET Core, и теперь его можно использовать на любой платформе, где работает .NET Core. Мы стремимся превратить .NET Core в кроссплатформенную среду разработки. Этот переход никак не повлияет на работу в этом направлении.

> [!NOTE]
> Если вы только начинаете использовать MSBuild, советуем сначала ознакомиться со статьей [Основные возможности MSBuild](/visualstudio/msbuild/msbuild-concepts). 

## <a name="the-tooling-layers"></a>Многоуровневая архитектура средств

В связи с переходом на другую систему проектов и заменой модуля сборки возникает естественный вопрос — повлияют ли какие-либо из этих изменений на общую архитектуру всей экосистемы средств .NET Core? Появились ли новые двоичные файлы и компоненты?

Сначала рассмотрим схему размещения средств по уровням в предварительной версии 2.

![Высокоуровневая архитектура средств предварительной версии 2](media/cli-msbuild-architecture/p2-arch.png)

Расположение средств довольно простое. Внизу как основа расположены средства командной строки .NET Core. Все другие средства более высокого уровня, например Visual Studio и Visual Studio Code, зависят от интерфейса командной строки для выполнения таких операций, как сборка проектов, восстановление зависимостей и т. д. Это означает, что, к примеру, для выполнения операции восстановления в Visual Studio требовалось вызвать команду `dotnet restore` ([см. примечание](#dotnet-restore-note)) в интерфейсе командной строки. 

В связи с переходом на новую систему проектов предыдущая схема изменилась. 

![Высокоуровневая архитектура пакета SDK для .NET Core 1.0.0](media/cli-msbuild-architecture/p3-arch.png)

Основное различие заключается в том, что интерфейс командной строки больше не является основным уровнем. Теперь эту роль выполняет общий компонент SDK. Это — набор целевых объектов и связанных задач, которые отвечают за компиляцию и публикацию кода, а также за его упаковку в пакеты NuGet и т. д. Сам пакет SDK с открытым исходным кодом доступен на сайте GitHub в [репозитории SDK](https://github.com/dotnet/sdk). 

> [!NOTE]
> Целевой объект — это термин MSBuild, обозначающий именованную операцию, которую может вызвать MSBuild. Обычно она связана с одной или несколькими задачами, выполняющими определенную логику, которую должен реализовать целевой объект. MSBuild поддерживает множество готовых целевых объектов, таких как `Copy` или `Execute`. Благодаря этому пользователи могут создавать собственные задачи с помощью управляемого кода и определять целевые объекты для их выполнения. Дополнительную информацию см. в статье [Задачи MSBuild](/visualstudio/msbuild/msbuild-tasks). 

Все наборы инструментов теперь используют общий компонент SDK и его целевые объекты, в том числе интерфейс командной строки. Например, в следующей версии для восстановления зависимостей для проектов .NET Core Visual Studio не будет вызывать команду `dotnet restore` ([см. примечание](#dotnet-restore-note)). Вместо этого будет напрямую использоваться операция восстановления. Так как это целевые объекты MSBuild, их можно выполнить с помощью команды [dotnet msbuild](dotnet-msbuild.md) в самом модуле MSBuild. 

### <a name="cli-commands"></a>Команды CLI
Введение общего компонента SDK означает, что большинство существующих команд интерфейса командной строки были заново реализованы как целевые объекты и задачи MSBuild. Как это повлияло на команды интерфейса командной строки и использование набора инструментов? 

Это не влияет на использование интерфейса командной строки. Он по-прежнему содержит основные команды, существующие в предварительной версии 2:

- `new`
- `restore`
- `run` 
- `build`
- `publish`
- `test`
- `pack` 

Эти команды по-прежнему выполняют ожидаемые функции (создание, сборка, публикация, упаковка проекта и т. д.). Большинство параметров не изменились и по-прежнему существуют. Чтобы ознакомиться с изменениями, обратитесь к тексту справки по командам (при помощи `dotnet <command> --help`) или документации на этом сайте. 

Команды интерфейса командной строки с точки зрения выполнения принимают параметры и отправляют вызов к самому модулю MSBuild, который задает необходимые свойства и запускает нужный целевой объект. Чтобы лучше проиллюстрировать это, рассмотрим следующую команду: 

   ```dotnetcli
   dotnet publish -o pub -c Release
   ```
    
Эта команда публикует приложение в папку `pub` с помощью конфигурации Release. На внутреннем уровне эта команда преобразовывается в следующий вызов MSBuild: 

   ```dotnetcli
   dotnet msbuild -t:Publish -p:OutputPath=pub -p:Configuration=Release
   ```

Важным исключением из этого правила являются команды `new` и `run`, так как они были реализованы в качестве целевых объектов MSBuild.

<a name="dotnet-restore-note"></a>  
[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]
