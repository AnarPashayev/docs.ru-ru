---
title: Создание глобального средства .NET Core
description: Сведения о том, как создать глобальное средство. Глобальное средство — это консольное приложение, которое устанавливается с помощью интерфейса командной строки .NET Core.
author: Thraka
ms.author: adegeo
ms.date: 08/22/2018
ms.openlocfilehash: 5c2b1e459f0308f5f96eb041c10f4d7a7ae0ca20
ms.sourcegitcommit: a4b10e1f2a8bb4e8ff902630855474a0c4f1b37a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/19/2019
ms.locfileid: "71117447"
---
# <a name="create-a-net-core-global-tool-using-the-net-core-cli"></a>Создание глобального средства .NET Core с помощью интерфейса командной строки .NET Core

В этой статье объясняется, как создать и упаковать глобальное средство .NET Core. Интерфейс командной строки .NET Core позволяет создавать консольное приложение в качестве глобального средства, которое смогут установить и запустить другие пользователи. Глобальные средства .NET Core представляют собой пакеты NuGet, которые устанавливаются из командной строки .NET Core. См. дополнительные сведения о [глобальных средствах .NET Core](global-tools.md).

[!INCLUDE [topic-appliesto-net-core-21plus.md](../../../includes/topic-appliesto-net-core-21plus.md)]

## <a name="create-a-project"></a>Создание проекта

В этой статье для создания и управления проектом используется .NET Core CLI.

Наш пример средства будет содержать консольное приложение, которое позволяет создать текстовый бот и выводит сообщение. Сначала создайте консольное приложение .NET Core.

```dotnetcli
dotnet new console -o botsay
```

Перейдите к каталогу `botsay`, который вы создали с помощью предыдущей команды.

## <a name="add-the-code"></a>Добавление кода

Откройте файл `Program.cs` в любом текстовом редакторе, например `vim` или [Visual Studio Code](https://code.visualstudio.com/).

Добавьте в начало файла приведенную ниже директиву `using`, которая помогает сократить код отображения сведений о версии приложения.

```csharp
using System.Reflection;
```

Затем перейдите вниз к методу `Main`. Замените этот метод приведенным ниже кодом, который будет обрабатывать аргументы командной строки для приложения. Если аргументы не переданы, отображается короткое справочное сообщение. В противном случае все полученные аргументы преобразуются в строку и передаются на выход бота.

```csharp
static void Main(string[] args)
{
    if (args.Length == 0)
    {
        var versionString = Assembly.GetEntryAssembly()
                                .GetCustomAttribute<AssemblyInformationalVersionAttribute>()
                                .InformationalVersion
                                .ToString();

        Console.WriteLine($"botsay v{versionString}");
        Console.WriteLine("-------------");
        Console.WriteLine("\nUsage:");
        Console.WriteLine("  botsay <message>");
        return;
    }

    ShowBot(string.Join(' ', args));
}
```

### <a name="create-the-bot"></a>Создание бота

Теперь добавьте новый метод с именем `ShowBot`, который принимает один строковый параметр. Этот метод позволяет вывести сообщение и бот ASCII. Код текстового бота взят из примера [dotnetbot](https://github.com/dotnet/core/blob/master/samples/dotnetsay/Program.cs).

```csharp
static void ShowBot(string message)
{
    string bot = $"\n        {message}";
    bot += @"
    __________________
                      \
                       \
                          ....
                          ....'
                           ....
                        ..........
                    .............'..'..
                 ................'..'.....
               .......'..........'..'..'....
              ........'..........'..'..'.....
             .'....'..'..........'..'.......'.
             .'..................'...   ......
             .  ......'.........         .....
             .    _            __        ......
            ..    #            ##        ......
           ....       .                 .......
           ......  .......          ............
            ................  ......................
            ........................'................
           ......................'..'......    .......
        .........................'..'.....       .......
     ........    ..'.............'..'....      ..........
   ..'..'...      ...............'.......      ..........
  ...'......     ...... ..........  ......         .......
 ...........   .......              ........        ......
.......        '...'.'.              '.'.'.'         ....
.......       .....'..               ..'.....
   ..       ..........               ..'........
          ............               ..............
         .............               '..............
        ...........'..              .'.'............
       ...............              .'.'.............
      .............'..               ..'..'...........
      ...............                 .'..............
       .........                        ..............
        .....
";
    Console.WriteLine(bot);
}
```

### <a name="test-the-tool"></a>Тестирование средства

Запустите проект и просмотрите выходные данные. Поработайте с разными вариантами командной строки и сравните результаты:

```dotnetcli
dotnet run
dotnet run -- "Hello from the bot"
dotnet run -- hello from the bot
```

Все аргументы после разделителя `--` передаются выполняемому приложению.

## <a name="setup-the-global-tool"></a>Настройка глобального средства

Прежде чем упаковать и распространять приложение в качестве глобального средства, измените файл проекта. Откройте файл `botsay.csproj` и добавьте три новых узла XML в узел `<Project><PropertyGroup>`:

- `<PackAsTool>`\
ОБЯЗАТЕЛЬНО. Указывает, что приложение будет упаковано для установки в качестве глобального средства.

- `<ToolCommandName>`\
НЕОБЯЗАТЕЛЬНО. Альтернативное имя для средства. Если не указано, имя команды для этого средства будет совпадать с именем файла проекта. Вы можете поместить в пакет несколько средств и выбрать для каждого из них уникальное и понятное имя, чтобы различать средства в одном пакете.

- `<PackageOutputPath>`\
НЕОБЯЗАТЕЛЬНО. Расположение для создания пакета NuGet. Пакет NuGet будет использоваться платформой глобальных средств в интерфейсе командной строки .NET Core для установки созданного средства.

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp2.1</TargetFramework>

    <PackAsTool>true</PackAsTool>
    <ToolCommandName>botsay</ToolCommandName>
    <PackageOutputPath>./nupkg</PackageOutputPath>

  </PropertyGroup>

</Project>
```

Параметр `<PackageOutputPath>` является необязательным, но используется в этом примере. Следует задать для него значение `<PackageOutputPath>./nupkg</PackageOutputPath>`.

Теперь создайте пакет NuGet для приложения.

```dotnetcli
dotnet pack
```

Файл `botsay.1.0.0.nupkg` создается в папке, которую указывает значение XML `<PackageOutputPath>` из файла `botsay.csproj`. В нашем примере это папка `./nupkg`. Это упрощает установку и тестирование. Если вы решите сделать это средство общедоступным, отправьте его в <https://www.nuget.org>. Когда это средство станет доступно в NuGet, разработчикам можно будет выполнить его установку для всех пользователей, используя параметр `--global` команды [dotnet tool install](dotnet-tool-install.md).

Теперь у вас готов пакет и вы можете установить средство с его помощью:

```dotnetcli
dotnet tool install --global --add-source ./nupkg botsay
```

Параметр `--add-source` настраивает временное использование папки `./nupkg` в .NET Core CLI (папка `<PackageOutputPath>` в нашем примере) в качестве дополнительного источника пакетов NuGet. См. дополнительные сведения [об установке глобальных средств .NET Core](global-tools.md).

Если установка выполнена успешно, отображается сообщение с командой, используемой для вызова средства, и установленной версией, аналогичное приведенному ниже:

```output
You can invoke the tool using the following command: botsay
Tool 'botsay' (version '1.0.0') was successfully installed.
```

Теперь вы можете получить ответ от созданного средства. Для этого введите команду `botsay`.

> [!NOTE]
> Если установка прошла успешно, но команду `botsay` выполнить не удается, попробуйте открыть новое окно терминала, чтобы обновить значение PATH.

## <a name="remove-the-tool"></a>Удаление средства

Закончив эксперименты с созданным средством, удалите его с помощью следующей команды:

```dotnetcli
dotnet tool uninstall -g botsay
```
