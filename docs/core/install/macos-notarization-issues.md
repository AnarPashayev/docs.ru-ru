---
title: Работа с заверением macOS Catalina
description: Способы решения проблем с заверением и сертификатами в macOS при установке среды выполнения .NET Core, пакета SDK и приложений, созданных с помощью .NET Core.
author: thraka
ms.author: adegeo
ms.date: 02/14/2020
ms.openlocfilehash: be39c1ea56699f84736a2b37bc958507b16e826b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "79146753"
---
# <a name="macos-catalina-notarization-and-the-impact-on-net-core-downloads-and-projects"></a><span data-ttu-id="1d84f-103">Заверение macOS Catalina и влияние на скачиваемые файлы и проекты .NET Core</span><span class="sxs-lookup"><span data-stu-id="1d84f-103">macOS Catalina Notarization and the impact on .NET Core downloads and projects</span></span>

<span data-ttu-id="1d84f-104">Начиная с macOS Catalina (версия 10.15) все программное обеспечение, созданное после 1 июня 2019 года и распространяемое с идентификатором разработчика, должно быть заверено.</span><span class="sxs-lookup"><span data-stu-id="1d84f-104">Beginning with macOS Catalina (version 10.15), all software built after June 1, 2019, and distributed with Developer ID, must be notarized.</span></span> <span data-ttu-id="1d84f-105">Это требование относится к среде выполнения .NET Core, пакету SDK для .NET Core и программному обеспечению, созданному с помощью .NET Core.</span><span class="sxs-lookup"><span data-stu-id="1d84f-105">This requirement applies to the .NET Core runtime, .NET Core SDK, and software created with .NET Core.</span></span> <span data-ttu-id="1d84f-106">Эта статья описывает распространенные сценарии, с которыми вы можете столкнуться при заверении .NET Core и macOS.</span><span class="sxs-lookup"><span data-stu-id="1d84f-106">This article describes the common scenarios you may face with .NET Core and macOS notarization.</span></span>

## <a name="installing-net-core"></a><span data-ttu-id="1d84f-107">Установка .NET Core</span><span class="sxs-lookup"><span data-stu-id="1d84f-107">Installing .NET Core</span></span>

<span data-ttu-id="1d84f-108">Установщики для .NET Core (среда выполнения и пакет SDK) версии 3.1, 3.0 и 2.1 были заверены с 18 февраля 2020 г.</span><span class="sxs-lookup"><span data-stu-id="1d84f-108">The installers for .NET Core (both runtime and SDK) versions 3.1, 3.0, and 2.1, have been notarized since February 18, 2020.</span></span> <span data-ttu-id="1d84f-109">Более ранние версии не заверены.</span><span class="sxs-lookup"><span data-stu-id="1d84f-109">Prior released versions aren't notarized.</span></span> <span data-ttu-id="1d84f-110">Вы можете вручную установить незаверенную версию .NET Core, скачав установщик и выполнив команду `sudo installer`.</span><span class="sxs-lookup"><span data-stu-id="1d84f-110">You can manually install a non-notarized version of .NET Core by first downloading the installer, and then using the `sudo installer` command.</span></span> <span data-ttu-id="1d84f-111">Дополнительные сведения см. в разделе [Скачивание и установка вручную для macOS](sdk.md?pivots=os-macos#download-and-manually-install).</span><span class="sxs-lookup"><span data-stu-id="1d84f-111">For more information, see [Download and manually install for macOS](sdk.md?pivots=os-macos#download-and-manually-install).</span></span>

<span data-ttu-id="1d84f-112">Начиная со следующих версий, установщики .NET Core являются заверенными:</span><span class="sxs-lookup"><span data-stu-id="1d84f-112">Beginning with the following versions, the .NET Core installers are notarized:</span></span>

- <span data-ttu-id="1d84f-113">Среда выполнения .NET Core</span><span class="sxs-lookup"><span data-stu-id="1d84f-113">.NET Core Runtime</span></span>
  - <span data-ttu-id="1d84f-114">2.1.16</span><span class="sxs-lookup"><span data-stu-id="1d84f-114">2.1.16</span></span>
  - <span data-ttu-id="1d84f-115">3.0.3</span><span class="sxs-lookup"><span data-stu-id="1d84f-115">3.0.3</span></span>
  - <span data-ttu-id="1d84f-116">3.1.2</span><span class="sxs-lookup"><span data-stu-id="1d84f-116">3.1.2</span></span>

- <span data-ttu-id="1d84f-117">Пакет SDK для .NET Core</span><span class="sxs-lookup"><span data-stu-id="1d84f-117">.NET Core SDK</span></span>
  - <span data-ttu-id="1d84f-118">2.1.512</span><span class="sxs-lookup"><span data-stu-id="1d84f-118">2.1.512</span></span>
  - <span data-ttu-id="1d84f-119">3.0.103</span><span class="sxs-lookup"><span data-stu-id="1d84f-119">3.0.103</span></span>
  - <span data-ttu-id="1d84f-120">3.1.102</span><span class="sxs-lookup"><span data-stu-id="1d84f-120">3.1.102</span></span>

## <a name="apphost-is-disabled-by-default"></a><span data-ttu-id="1d84f-121">appHost отключен по умолчанию</span><span class="sxs-lookup"><span data-stu-id="1d84f-121">appHost is disabled by default</span></span>

<span data-ttu-id="1d84f-122">По умолчанию незаверенные версии пакета SDK для .NET Core 3.0 и выше создают собственный исполняемый файл Mach-O (известный как **appHost**) при компиляции, публикации или запуске проекта.</span><span class="sxs-lookup"><span data-stu-id="1d84f-122">By default, non-notarized versions of the .NET Core SDK 3.0 and above produce a native Mach-O executable (known as the **appHost**) when your project compiles, publishes, or is run.</span></span> <span data-ttu-id="1d84f-123">Этот исполняемый файл удобно использовать для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="1d84f-123">This executable is a convenient way to run your app.</span></span> <span data-ttu-id="1d84f-124">В противном случае для запуска приложения нужно выполнить команду `dotnet <filename.dll>`.</span><span class="sxs-lookup"><span data-stu-id="1d84f-124">Otherwise, your app must be started by running `dotnet <filename.dll>`.</span></span> <span data-ttu-id="1d84f-125">Когда appHost включен, команда `dotnet run` вызывается в контексте appHost.</span><span class="sxs-lookup"><span data-stu-id="1d84f-125">When the appHost is enabled, the `dotnet run` command is invoked in the context of the appHost.</span></span> <span data-ttu-id="1d84f-126">Дополнительные сведения см. в разделе [Контекст appHost](#context-of-the-apphost).</span><span class="sxs-lookup"><span data-stu-id="1d84f-126">For more information, see [Context of the appHost](#context-of-the-apphost).</span></span>

<span data-ttu-id="1d84f-127">Начиная с заверенных версий пакета SDK для .NET Core 3.0 и выше исполняемый файл appHost не создается по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-127">Starting with the notarized versions of the .NET Core SDK 3.0 and above, the appHost executable isn't generated by default.</span></span> <span data-ttu-id="1d84f-128">Вы можете включить создание appHost с помощью логического параметра [`UseAppHost`](../project-sdk/msbuild-props.md#useapphost) в файле проекта.</span><span class="sxs-lookup"><span data-stu-id="1d84f-128">You can turn on appHost generation with the [`UseAppHost`](../project-sdk/msbuild-props.md#useapphost) boolean setting in the project file.</span></span> <span data-ttu-id="1d84f-129">Кроме того, можно переключить использование appHost с помощью параметра `-p:UseAppHost` в командной строке для определенной команды `dotnet`:</span><span class="sxs-lookup"><span data-stu-id="1d84f-129">You can also toggle the appHost with the `-p:UseAppHost` parameter on the command line for the specific `dotnet` command you run:</span></span>

- <span data-ttu-id="1d84f-130">Файл проекта</span><span class="sxs-lookup"><span data-stu-id="1d84f-130">Project file</span></span>

  ```xml
  <PropertyGroup>
    <UseAppHost>true</UseAppHost>
  </PropertyGroup>
  ```

- <span data-ttu-id="1d84f-131">Параметр командной строки</span><span class="sxs-lookup"><span data-stu-id="1d84f-131">Command-line parameter</span></span>

  ```dotnetcli
  dotnet run -p:UseAppHost=true
  ```

<span data-ttu-id="1d84f-132">AppHost всегда создается при публикации приложения в [автономном виде](../deploying/index.md#publish-self-contained).</span><span class="sxs-lookup"><span data-stu-id="1d84f-132">An appHost is always created when you publish your app [self-contained](../deploying/index.md#publish-self-contained).</span></span>

<span data-ttu-id="1d84f-133">Дополнительные сведения о параметре `UseAppHost` см. в разделе [Свойства MSBuild для Microsoft.NET.Sdk](../project-sdk/msbuild-props.md#useapphost).</span><span class="sxs-lookup"><span data-stu-id="1d84f-133">For more information about the `UseAppHost` setting, see [MSBuild properties for Microsoft.NET.Sdk](../project-sdk/msbuild-props.md#useapphost).</span></span>

### <a name="context-of-the-apphost"></a><span data-ttu-id="1d84f-134">Контекст appHost</span><span class="sxs-lookup"><span data-stu-id="1d84f-134">Context of the appHost</span></span>

<span data-ttu-id="1d84f-135">Когда appHost включен в проекте и вы используете команду `dotnet run` для запуска приложения, оно вызывается в контексте appHost, а не узла по умолчанию (узлом по умолчанию является команда `dotnet`).</span><span class="sxs-lookup"><span data-stu-id="1d84f-135">When the appHost is enabled in your project, and you use the `dotnet run` command to run your app, the app is invoked in the context of the appHost and not the default host (the default host is the `dotnet` command).</span></span> <span data-ttu-id="1d84f-136">Если appHost отключен в проекте, команда `dotnet run` запускает приложение в контексте узла по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-136">If the appHost is disabled in your project, the `dotnet run` command runs your app in the context of the default host.</span></span> <span data-ttu-id="1d84f-137">Даже если appHost отключен, публикация приложения в качестве автономного приводит к созданию исполняемого файла appHost, который применяется пользователями для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="1d84f-137">Even if the appHost is disabled, publishing your app as self-contained generates an appHost executable, and users use that executable to run your app.</span></span> <span data-ttu-id="1d84f-138">При запуске приложения с помощью `dotnet <filename.dll>` оно вызывается на узле по умолчанию — в общей среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="1d84f-138">Running your app with `dotnet <filename.dll>` invokes the app with the default host, the shared runtime.</span></span>

<span data-ttu-id="1d84f-139">При вызове приложения, использующего appHost, раздел сертификата, к которому обращается приложение, отличается от заверенного узла по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-139">When an app using the appHost is invoked, the certificate partition accessed by the app is different from the notarized default host.</span></span> <span data-ttu-id="1d84f-140">Если приложение должно обращаться к сертификатам, установленным через узел по умолчанию, используйте команду `dotnet run` для запуска приложения из файла проекта или команду `dotnet <filename.dll>` для запуска приложения напрямую.</span><span class="sxs-lookup"><span data-stu-id="1d84f-140">If your app must access the certificates installed through the default host, use the `dotnet run` command to run your app from its project file, or use the `dotnet <filename.dll>` command to start the app directly.</span></span>

<span data-ttu-id="1d84f-141">Дополнительные сведения об этом сценарии см. в разделе [ASP.NET Core, macOS и сертификаты](#aspnet-core-and-macos-and-certificates).</span><span class="sxs-lookup"><span data-stu-id="1d84f-141">More information about this scenario is provided in the [ASP.NET Core and macOS and certificates](#aspnet-core-and-macos-and-certificates) section.</span></span>

## <a name="aspnet-core-and-macos-and-certificates"></a><span data-ttu-id="1d84f-142">ASP.NET Core, macOS и сертификаты</span><span class="sxs-lookup"><span data-stu-id="1d84f-142">ASP.NET Core and macOS and certificates</span></span>

<span data-ttu-id="1d84f-143">.NET Core позволяет управлять сертификатами в цепочке ключей macOS с помощью класса <xref:System.Security.Cryptography.X509Certificates>.</span><span class="sxs-lookup"><span data-stu-id="1d84f-143">.NET Core provides the ability to manage certificates in the macOS Keychain with the <xref:System.Security.Cryptography.X509Certificates> class.</span></span> <span data-ttu-id="1d84f-144">В рамках обращения к цепочке ключей macOS удостоверение приложения используется в качестве первичного ключа при принятии решения о том, какой раздел следует рассматривать.</span><span class="sxs-lookup"><span data-stu-id="1d84f-144">Access to the macOS Keychain uses the applications identity as the primary key when deciding which partition to consider.</span></span> <span data-ttu-id="1d84f-145">Например, неподписанные приложения хранят секреты в неподписанном разделе, а подписанные приложения хранят свои секреты в разделах, доступ к которым есть только у них.</span><span class="sxs-lookup"><span data-stu-id="1d84f-145">For example, unsigned applications store secrets in the unsigned partition, but signed applications store their secrets in partitions only they can access.</span></span> <span data-ttu-id="1d84f-146">Источник выполнения, вызывающий ваше приложение, решает, какой раздел следует использовать.</span><span class="sxs-lookup"><span data-stu-id="1d84f-146">The source of execution that invokes your app decides which partition to use.</span></span>

<span data-ttu-id="1d84f-147">.NET Core предоставляет три источника выполнения: [appHost](#apphost-is-disabled-by-default), узел по умолчанию (команда `dotnet`) и пользовательский узел.</span><span class="sxs-lookup"><span data-stu-id="1d84f-147">.NET Core provides three sources of execution: [appHost](#apphost-is-disabled-by-default), default host (the `dotnet` command), and a custom host.</span></span> <span data-ttu-id="1d84f-148">Каждая модель выполнения может использовать разные удостоверения, подписанные или нет, а также имеет доступ к разным разделам в цепочке ключей.</span><span class="sxs-lookup"><span data-stu-id="1d84f-148">Each execution model may have different identities, either signed or unsigned, and has access to different partitions within the Keychain.</span></span> <span data-ttu-id="1d84f-149">Сертификаты, импортированные в одном режиме, могут быть недоступны в другом.</span><span class="sxs-lookup"><span data-stu-id="1d84f-149">Certificates imported by one mode may not be accessible from another.</span></span> <span data-ttu-id="1d84f-150">Например, заверенные версии .NET Core имеют подписанный узел по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-150">For example, the notarized versions of .NET Core have a default host that is signed.</span></span> <span data-ttu-id="1d84f-151">Сертификаты импортируются в защищенный раздел на основе его удостоверения.</span><span class="sxs-lookup"><span data-stu-id="1d84f-151">Certificates are imported into a secure partition based on its identity.</span></span> <span data-ttu-id="1d84f-152">Эти сертификаты недоступны из созданного appHost, так как appHost не подписан.</span><span class="sxs-lookup"><span data-stu-id="1d84f-152">These certificates aren't accessible from a generated appHost, as the appHost is unsigned.</span></span>

<span data-ttu-id="1d84f-153">Другой пример: по умолчанию ASP.NET Core импортирует SSL-сертификат по умолчанию через узел по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-153">Another example, by default, ASP.NET Core imports a default SSL certificate through the default host.</span></span> <span data-ttu-id="1d84f-154">Приложения ASP.NET Core, использующие appHost, не будут иметь доступ к этому сертификату и получат сообщение об ошибке, когда .NET Core обнаружит, что сертификат недоступен.</span><span class="sxs-lookup"><span data-stu-id="1d84f-154">ASP.NET Core applications that use an appHost won't have access to this certificate and will receive an error when .NET Core detects the certificate isn't accessible.</span></span> <span data-ttu-id="1d84f-155">Это сообщение об ошибке содержит инструкции по устранению данной проблемы.</span><span class="sxs-lookup"><span data-stu-id="1d84f-155">The error message provides instructions on how to fix this problem.</span></span>

<span data-ttu-id="1d84f-156">Если требуется общий доступ к сертификату, macOS предоставляет параметры конфигурации с помощью служебной программы `security`.</span><span class="sxs-lookup"><span data-stu-id="1d84f-156">If certificate sharing is required, macOS provides configuration options with the `security` utility.</span></span>

<span data-ttu-id="1d84f-157">Дополнительные сведения об устранении неполадок, связанных с сертификатами ASP.NET Core, см. в разделе [Применение протокола HTTPS в ASP.NET Core](/aspnet/core/security/enforcing-ssl?view=aspnetcore-3.1&tabs=visual-studio#troubleshoot-certificate-problems).</span><span class="sxs-lookup"><span data-stu-id="1d84f-157">For more information on how to troubleshoot ASP.NET Core certificate issues, see [Enforce HTTPS in ASP.NET Core](/aspnet/core/security/enforcing-ssl?view=aspnetcore-3.1&tabs=visual-studio#troubleshoot-certificate-problems).</span></span>

## <a name="default-entitlements"></a><span data-ttu-id="1d84f-158">Права по умолчанию</span><span class="sxs-lookup"><span data-stu-id="1d84f-158">Default entitlements</span></span>

<span data-ttu-id="1d84f-159">Узел по умолчанию .NET Core (команда `dotnet`) имеет набор прав по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1d84f-159">.NET Core’s default host (the `dotnet` command) has a set of default entitlements.</span></span> <span data-ttu-id="1d84f-160">Эти права необходимы для правильной работы .NET Core.</span><span class="sxs-lookup"><span data-stu-id="1d84f-160">These entitlements are required for proper operation of .NET Core.</span></span> <span data-ttu-id="1d84f-161">Приложению могут понадобиться дополнительные права. В этом случае потребуется создать и использовать [appHost](#apphost-is-disabled-by-default), а затем добавить необходимые права локально.</span><span class="sxs-lookup"><span data-stu-id="1d84f-161">It's possible that your application may need additional entitlements, in which case you'll need to generate and use an [appHost](#apphost-is-disabled-by-default) and then add the necessary entitlements locally.</span></span>

<span data-ttu-id="1d84f-162">Набор прав по умолчанию для .NET Core:</span><span class="sxs-lookup"><span data-stu-id="1d84f-162">Default set of entitlements for .NET Core:</span></span>

- `com.apple.security.cs.allow-jit`
- `com.apple.security.cs.allow-unsigned-executable-memory`
- `com.apple.security.cs.allow-dyld-environment-variables`
- `com.apple.security.cs.disable-library-validation`

## <a name="notarize-a-net-core-app"></a><span data-ttu-id="1d84f-163">Заверение приложения .NET Core</span><span class="sxs-lookup"><span data-stu-id="1d84f-163">Notarize a .NET Core app</span></span>

<span data-ttu-id="1d84f-164">Если вы хотите, чтобы приложение выполнялось в macOS Catalina (версия 10.15) или более поздней версии, рекомендуется заверить его.</span><span class="sxs-lookup"><span data-stu-id="1d84f-164">If you want your application to run on macOS Catalina (version 10.15) or higher, you'll want to notarize your app.</span></span> <span data-ttu-id="1d84f-165">Файл appHost, отправляемый вместе с приложением для заверения, должен использоваться по крайней мере с теми же [правами по умолчанию](#default-entitlements) для .NET Core.</span><span class="sxs-lookup"><span data-stu-id="1d84f-165">The appHost you submit with your application for notarization should be used with at least the same [default entitlements](#default-entitlements) for .NET Core.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1d84f-166">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="1d84f-166">Next steps</span></span>

- <span data-ttu-id="1d84f-167">[Зависимости и требования для .NET Core](dependencies.md).</span><span class="sxs-lookup"><span data-stu-id="1d84f-167">[.NET Core dependencies and requirements](dependencies.md).</span></span>
- <span data-ttu-id="1d84f-168">[Установка пакета SDK для .NET Core](sdk.md).</span><span class="sxs-lookup"><span data-stu-id="1d84f-168">[Install the .NET Core SDK](sdk.md).</span></span>
- <span data-ttu-id="1d84f-169">[Установка среды выполнения .NET Core](runtime.md).</span><span class="sxs-lookup"><span data-stu-id="1d84f-169">[Install the .NET Core Runtime](runtime.md)</span></span>
