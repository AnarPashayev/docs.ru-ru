---
title: Дампы — .NET
description: Общие сведения о дампах в .NET.
ms.date: 10/12/2020
ms.openlocfilehash: 7a4c7bf54b3e9ea43e685eafbd00b4a373326520
ms.sourcegitcommit: c0b803bffaf101e12f071faf94ca21b46d04ff30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/24/2020
ms.locfileid: "97764946"
---
# <a name="dumps"></a><span data-ttu-id="bf1e2-103">Файлы дампа</span><span class="sxs-lookup"><span data-stu-id="bf1e2-103">Dumps</span></span>

<span data-ttu-id="bf1e2-104">Дамп — это файл, который содержит моментальный снимок процесса во время его создания и может быть полезен для проверки состояния приложения.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-104">A dump is a file that contains a snapshot of the process at the time it was created and can be useful for examining the state of your application.</span></span> <span data-ttu-id="bf1e2-105">Дампы можно использовать для отладки приложения .NET, когда трудно подключить к нему отладчик (например, в рабочей среде или в среде CI).</span><span class="sxs-lookup"><span data-stu-id="bf1e2-105">Dumps can be used to debug your .NET application when it is difficult to attach a debugger to it such as production or CI environments.</span></span> <span data-ttu-id="bf1e2-106">Использование дампов позволяет записать состояние проблемного процесса и изучить его без необходимости приостанавливать работу приложения.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-106">Using dumps allows you to capture the state of the problematic process and examine it without having to stop the application.</span></span>

## <a name="collect-dumps"></a><span data-ttu-id="bf1e2-107">Сбор дампов</span><span class="sxs-lookup"><span data-stu-id="bf1e2-107">Collect dumps</span></span>

<span data-ttu-id="bf1e2-108">Дампы можно собирать различными способами в зависимости от того, на какой платформе вы используете приложение.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-108">Dumps can be collected in a variety of ways depending on which platform you are running your app on.</span></span>

> [!NOTE]
> <span data-ttu-id="bf1e2-109">Для сбора дампа внутри контейнера требуется возможность PTRACE, которую можно добавить с помощью `--cap-add=SYS_PTRACE` или `--privileged`.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-109">Collecting a dump inside a container requires PTRACE capability, which can be added via `--cap-add=SYS_PTRACE` or `--privileged`.</span></span>

> [!NOTE]
> <span data-ttu-id="bf1e2-110">Дампы могут содержать конфиденциальные сведения, поскольку они могут содержать всю память выполняющегося процесса.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-110">Dumps may contain sensitive information because they can contain the full memory of the running process.</span></span> <span data-ttu-id="bf1e2-111">При их обработке следует учитывать ограничения безопасности и рекомендации.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-111">Handle them with any security restrictions and guidances in mind.</span></span>

### <a name="collecting-dumps-on-crash"></a><span data-ttu-id="bf1e2-112">Сбор дампов при сбое</span><span class="sxs-lookup"><span data-stu-id="bf1e2-112">Collecting dumps on crash</span></span>

<span data-ttu-id="bf1e2-113">Вы можете использовать переменные среды, чтобы настроить приложение на сбор дампа при сбое.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-113">You can use environment variables to configure your application to collect a dump upon a crash.</span></span> <span data-ttu-id="bf1e2-114">Это полезно, если вы хотите получить представление о причинах сбоя.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-114">This is helpful when you want to get an understanding of why a crash happened.</span></span> <span data-ttu-id="bf1e2-115">Например, запись дампа при возникновении исключения помогает выявить проблемы путем проверки состояния приложения при его сбое.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-115">For example, capturing a dump when an exception is thrown helps you identify an issue by examining the state of the app when it crashed.</span></span>

<span data-ttu-id="bf1e2-116">В следующей таблице приведены переменные среды, которые можно настроить для сбора дампов при сбое.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-116">The following table shows the environment variables you can configure for collecting dumps on a crash.</span></span>

|<span data-ttu-id="bf1e2-117">Переменная среды</span><span class="sxs-lookup"><span data-stu-id="bf1e2-117">Environment variable</span></span>|<span data-ttu-id="bf1e2-118">Описание</span><span class="sxs-lookup"><span data-stu-id="bf1e2-118">Description</span></span>|<span data-ttu-id="bf1e2-119">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="bf1e2-119">Default value</span></span>|
|-------|---------|---|
|`COMPlus_DbgEnableMiniDump`|<span data-ttu-id="bf1e2-120">Если задано значение 1, включите создание дампа ядра.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-120">If set to 1, enable core dump generation.</span></span>|<span data-ttu-id="bf1e2-121">0</span><span class="sxs-lookup"><span data-stu-id="bf1e2-121">0</span></span>|
|`COMPlus_DbgMiniDumpType`|<span data-ttu-id="bf1e2-122">Тип собираемого дампа.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-122">Type of dump to be collected.</span></span> <span data-ttu-id="bf1e2-123">Дополнительные сведения см. в таблице ниже.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-123">For more information, see the table below</span></span>|<span data-ttu-id="bf1e2-124">2 (`MiniDumpWithPrivateReadWriteMemory`)</span><span class="sxs-lookup"><span data-stu-id="bf1e2-124">2 (`MiniDumpWithPrivateReadWriteMemory`)</span></span>|
|`COMPlus_DbgMiniDumpName`|<span data-ttu-id="bf1e2-125">Файл, в который записывается дамп.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-125">Path to a file to write the dump to.</span></span>|`/tmp/coredump.<pid>`|
|`COMPlus_CreateDumpDiagnostics`|<span data-ttu-id="bf1e2-126">Если задано значение 1, включите ведение журнала диагностики для процесса дампа.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-126">If set to 1, enable diagnostic logging of dump process.</span></span>|<span data-ttu-id="bf1e2-127">0</span><span class="sxs-lookup"><span data-stu-id="bf1e2-127">0</span></span>|

<span data-ttu-id="bf1e2-128">В таблице ниже показаны все параметры, доступные для использования для `COMPlus_DbgMiniDumpType`, которые можно указать в качестве значения.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-128">The table below shows all the options you may use for `COMPlus_DbgMiniDumpType` which can be specified as a value.</span></span> <span data-ttu-id="bf1e2-129">Например, если установить для параметра `COMPlus_DbgMiniDumpType` значение 1, при сбое будет собираться дамп типа `MiniDumpNormal`.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-129">For example, setting `COMPlus_DbgMiniDumpType` to 1 means `MiniDumpNormal` type dump will be collected on a crash.</span></span>

|<span data-ttu-id="bf1e2-130">Значение</span><span class="sxs-lookup"><span data-stu-id="bf1e2-130">Value</span></span>|<span data-ttu-id="bf1e2-131">Имя</span><span class="sxs-lookup"><span data-stu-id="bf1e2-131">Name</span></span>|<span data-ttu-id="bf1e2-132">Описание</span><span class="sxs-lookup"><span data-stu-id="bf1e2-132">Description</span></span>|
|-----|----|-----------|
|<span data-ttu-id="bf1e2-133">1</span><span class="sxs-lookup"><span data-stu-id="bf1e2-133">1</span></span>|`MiniDumpNormal`|<span data-ttu-id="bf1e2-134">Включение только сведений, необходимых для записи трассировок стека для всех существующих потоков в процессе.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-134">Include just the information necessary to capture stack traces for all existing threads in a process.</span></span> <span data-ttu-id="bf1e2-135">Ограниченная память кучи сборки мусора и информация.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-135">Limited GC heap memory and information.</span></span>|
|<span data-ttu-id="bf1e2-136">2</span><span class="sxs-lookup"><span data-stu-id="bf1e2-136">2</span></span>|`MiniDumpWithPrivateReadWriteMemory`|<span data-ttu-id="bf1e2-137">Включение кучи сборки мусора и сведений, необходимых для записи трассировок стека для всех существующих потоков в процессе.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-137">Includes the GC heaps and information necessary to capture stack traces for all existing threads in a process.</span></span>|
|<span data-ttu-id="bf1e2-138">3</span><span class="sxs-lookup"><span data-stu-id="bf1e2-138">3</span></span>|`MiniDumpFilterTriage`|<span data-ttu-id="bf1e2-139">Включение только сведений, необходимых для записи трассировок стека для всех существующих потоков в процессе.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-139">Include just the information necessary to capture stack traces for all existing threads in a process.</span></span> <span data-ttu-id="bf1e2-140">Ограниченная память кучи сборки мусора и информация.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-140">Limited GC heap memory and information.</span></span>|
|<span data-ttu-id="bf1e2-141">4</span><span class="sxs-lookup"><span data-stu-id="bf1e2-141">4</span></span>|`MiniDumpWithFullMemory`|<span data-ttu-id="bf1e2-142">Включение в процесс всей доступной памяти.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-142">Include all accessible memory in the process.</span></span> <span data-ttu-id="bf1e2-143">Необработанные данные памяти включаются в конец, чтобы начальные структуры можно было сопоставить напрямую без необработанных данных памяти.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-143">The raw memory data is included at the end, so that the initial structures can be mapped directly without the raw memory information.</span></span> <span data-ttu-id="bf1e2-144">Этот вариант может привести к созданию очень большого файла.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-144">This option can result in a very large file.</span></span>|

### <a name="collecting-dumps-at-specific-point-in-time"></a><span data-ttu-id="bf1e2-145">Сбор дампов в определенный момент времени</span><span class="sxs-lookup"><span data-stu-id="bf1e2-145">Collecting dumps at specific point in time</span></span>

<span data-ttu-id="bf1e2-146">Вы можете собрать дамп, когда приложение еще не завершило работу.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-146">You may want to collect a dump when the app hasn't crashed yet.</span></span> <span data-ttu-id="bf1e2-147">Например, если вы хотите проверить состояние приложения, в котором, на ваш взгляд, возникла взаимоблокировка, настройка переменных среды для сбора дампов при сбое не будет полезна, так как приложение все еще работает.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-147">For example, if you want to examine the state of an application that seems to be in a deadlock, configuring the environment variables to collect dumps on crash will not be helpful because the app is still running.</span></span>

<span data-ttu-id="bf1e2-148">Для сбора дампа в собственном запросе можно использовать `dotnet-dump`, который является средством CLI для сбора и анализа дампов.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-148">To collect dump at your own request, you can use `dotnet-dump`, which is a CLI tool for collecting and analyzing dumps.</span></span> <span data-ttu-id="bf1e2-149">Дополнительные сведения об использовании этого средства для сбора дампов с помощью `dotnet-dump` см. в разделе [Служебная программа для сбора и анализа дампа](dotnet-dump.md).</span><span class="sxs-lookup"><span data-stu-id="bf1e2-149">For more information on how to use it to collect dumps with `dotnet-dump`, see [Dump collection and analysis utility](dotnet-dump.md).</span></span>

## <a name="analyze-dumps"></a><span data-ttu-id="bf1e2-150">Анализ дампов</span><span class="sxs-lookup"><span data-stu-id="bf1e2-150">Analyze dumps</span></span>

<span data-ttu-id="bf1e2-151">Дампы можно проанализировать с помощью средства CLI [`dotnet-dump`](dotnet-dump.md) или посредством [Visual Studio](https://docs.microsoft.com/visualstudio/debugger/using-dump-files).</span><span class="sxs-lookup"><span data-stu-id="bf1e2-151">You can anlayze dumps using the [`dotnet-dump`](dotnet-dump.md) CLI tool or with [Visual Studio](https://docs.microsoft.com/visualstudio/debugger/using-dump-files).</span></span>

> [!NOTE]
> <span data-ttu-id="bf1e2-152">Visual Studio версии 16.8 и более поздних версий позволяет [открывать дампы Linux](https://devblogs.microsoft.com/visualstudio/linux-managed-memory-dump-debugging/), созданные в .NET Core 3.1.7 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-152">Visual Studio version 16.8 and later allows you to [open Linux dumps](https://devblogs.microsoft.com/visualstudio/linux-managed-memory-dump-debugging/) generated on .NET Core 3.1.7 or later.</span></span>  

> [!NOTE]
> <span data-ttu-id="bf1e2-153">Если необходима отладка машинного кода, можно использовать [расширение отладчика SOS](sos-debugging-extension.md) совместно с [LLDB в Linux и macOS](debug-linux-dumps.md#analyze-dumps-on-linux).</span><span class="sxs-lookup"><span data-stu-id="bf1e2-153">If native debugging is necessary, the [SOS debugger extension](sos-debugging-extension.md) can be used with [LLDB on Linux and macOS](debug-linux-dumps.md#analyze-dumps-on-linux).</span></span> <span data-ttu-id="bf1e2-154">SOS также поддерживается в Windows c [Windbg/cdb](/windows-hardware/drivers/debugger/debugger-download-tools), хотя рекомендуется использовать Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-154">SOS is also supported with [Windbg/cdb](/windows-hardware/drivers/debugger/debugger-download-tools) on Windows, although Visual Studio is recommended.</span></span>

## <a name="see-also"></a><span data-ttu-id="bf1e2-155">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="bf1e2-155">See also</span></span>

<span data-ttu-id="bf1e2-156">Узнайте подробнее о том, как можно использовать дампы для диагностики проблем в приложении .NET.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-156">Learn more about how you can leverage dumps to help diagnosing problems in your .NET application.</span></span>

* <span data-ttu-id="bf1e2-157">В [руководстве по отладке дампов Linux](debug-linux-dumps.md) представлены пошаговые инструкции по отладке дампа, собранного в Linux.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-157">[Debug Linux dumps](debug-linux-dumps.md) tutorial walks you through how to debug a dump that was collected in Linux.</span></span>

* <span data-ttu-id="bf1e2-158">В [руководстве по отладке взаимоблокировок](debug-deadlock.md) описывается отладка взаимоблокировок в приложении .NET с помощью дампов.</span><span class="sxs-lookup"><span data-stu-id="bf1e2-158">[Debug deadlock](debug-deadlock.md) tutorial walks you through how to debug a deadlock in your .NET application using dumps.</span></span>
