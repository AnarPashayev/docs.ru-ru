---
title: Проверка дерева действий
ms.date: 03/30/2017
ms.assetid: 100d00e4-8c1d-4233-8fbb-dd443a01155d
ms.openlocfilehash: 014795b79b3536b387096e4de64266e26649da21
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61774152"
---
# <a name="activity-tree-inspection"></a><span data-ttu-id="4a368-102">Проверка дерева действий</span><span class="sxs-lookup"><span data-stu-id="4a368-102">Activity Tree Inspection</span></span>
<span data-ttu-id="4a368-103">Проверка дерева действий используется авторами приложений рабочих процессов для проверки рабочих процессов, размещенных приложением.</span><span class="sxs-lookup"><span data-stu-id="4a368-103">Activity tree inspection is used by workflow application authors to inspect the workflows hosted by the application.</span></span> <span data-ttu-id="4a368-104">Используя службы <xref:System.Activities.WorkflowInspectionServices>, в рабочих процессах можно искать определенные дочерние действия, отдельно взятые действия и их свойства могут быть перечислены, а метаданные действий времени выполнения могут быть кэшированы в определенное время.</span><span class="sxs-lookup"><span data-stu-id="4a368-104">By using <xref:System.Activities.WorkflowInspectionServices>, workflows can be searched for specific child activities, individual activities and their properties can be enumerated, and runtime metadata of the activities can be cached at a specific time.</span></span> <span data-ttu-id="4a368-105">В этом разделе представлены общие сведения о службах <xref:System.Activities.WorkflowInspectionServices> и их использовании для проверки дерева действий.</span><span class="sxs-lookup"><span data-stu-id="4a368-105">This topic provides an overview of <xref:System.Activities.WorkflowInspectionServices> and how to use it to inspect an activity tree.</span></span>  
  
## <a name="using-workflowinspectionservices"></a><span data-ttu-id="4a368-106">Использование WorkflowInspectionServices</span><span class="sxs-lookup"><span data-stu-id="4a368-106">Using WorkflowInspectionServices</span></span>  
 <span data-ttu-id="4a368-107">Метод <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> используется для перечисления всех действий в указанном дереве действий.</span><span class="sxs-lookup"><span data-stu-id="4a368-107">The <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> method is used to enumerate all of the activities in the specified activity tree.</span></span> <span data-ttu-id="4a368-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> возвращает перечислимый объект, который касается всех действий в дереве, включая дочерние действия, обработчики делегатов, значения переменных по умолчанию и выражения аргументов.</span><span class="sxs-lookup"><span data-stu-id="4a368-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> returns an enumerable that touches all activities within the tree including children, delegate handlers, variable defaults, and argument expressions.</span></span> <span data-ttu-id="4a368-109">В следующем примере создается определение рабочего процесса при помощи <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.While>, <xref:System.Activities.Statements.ForEach%601>, <xref:System.Activities.Statements.WriteLine> и выражений.</span><span class="sxs-lookup"><span data-stu-id="4a368-109">In the following example, a workflow definition is created by using a <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.While>, <xref:System.Activities.Statements.ForEach%601>, <xref:System.Activities.Statements.WriteLine>, and expressions.</span></span> <span data-ttu-id="4a368-110">После того, как определение рабочего процесса создано, выполняется его вызов, а затем вызывается метод `InspectActivity`.</span><span class="sxs-lookup"><span data-stu-id="4a368-110">After the workflow definition is created, it is invoked and then the `InspectActivity` method is called.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#45](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#45)]  
  
 <span data-ttu-id="4a368-111">Для перечисления действий вызывается метод <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> относительно корневого действия и рекурсивно относительно каждого возвращенного действия.</span><span class="sxs-lookup"><span data-stu-id="4a368-111">To enumerate the activities, the <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is called on the root activity, and again recursively on each returned activity.</span></span> <span data-ttu-id="4a368-112">В следующем примере имя <xref:System.Activities.Activity.DisplayName%2A> каждого действия и выражения в дереве действий записывается в консоль.</span><span class="sxs-lookup"><span data-stu-id="4a368-112">In the following example, the <xref:System.Activities.Activity.DisplayName%2A> of each activity and expression in the activity tree is written to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#46](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#46)]  
  
 <span data-ttu-id="4a368-113">Результатом этого образца кода является следующее.</span><span class="sxs-lookup"><span data-stu-id="4a368-113">This sample code provides the following output.</span></span>  
  
 <span data-ttu-id="4a368-114">**Элемент списка 1**</span><span class="sxs-lookup"><span data-stu-id="4a368-114">**List Item 1**</span></span>  
<span data-ttu-id="4a368-115">**Элемент списка 2** </span><span class="sxs-lookup"><span data-stu-id="4a368-115">**List Item 2** </span></span>  
<span data-ttu-id="4a368-116">**Элемент списка 3** </span><span class="sxs-lookup"><span data-stu-id="4a368-116">**List Item 3** </span></span>  
<span data-ttu-id="4a368-117">**Элемент списка 4** </span><span class="sxs-lookup"><span data-stu-id="4a368-117">**List Item 4** </span></span>  
<span data-ttu-id="4a368-118">**Элемент списка 5** </span><span class="sxs-lookup"><span data-stu-id="4a368-118">**List Item 5** </span></span>  
<span data-ttu-id="4a368-119">**Элементы, добавленные в коллекцию.** </span><span class="sxs-lookup"><span data-stu-id="4a368-119">**Items added to collection.** </span></span>  
<span data-ttu-id="4a368-120">**Последовательности** </span><span class="sxs-lookup"><span data-stu-id="4a368-120">**Sequence** </span></span>  
 <span data-ttu-id="4a368-121">**Литерал < список\<строка >>**</span><span class="sxs-lookup"><span data-stu-id="4a368-121">**Literal<List\<String>>**</span></span>  
 <span data-ttu-id="4a368-122">**While**</span><span class="sxs-lookup"><span data-stu-id="4a368-122">**While**</span></span>  
 <span data-ttu-id="4a368-123">**AddToCollection\<строка >**</span><span class="sxs-lookup"><span data-stu-id="4a368-123">**AddToCollection\<String>**</span></span>  
 <span data-ttu-id="4a368-124">**VariableValue < ICollection\<строка >>**</span><span class="sxs-lookup"><span data-stu-id="4a368-124">**VariableValue<ICollection\<String>>**</span></span>  
 <span data-ttu-id="4a368-125">**LambdaValue\<строка >**</span><span class="sxs-lookup"><span data-stu-id="4a368-125">**LambdaValue\<String>**</span></span>  
 <span data-ttu-id="4a368-126">**LocationReferenceValue < список\<строка >>**</span><span class="sxs-lookup"><span data-stu-id="4a368-126">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="4a368-127">**LambdaValue\<логическое >**</span><span class="sxs-lookup"><span data-stu-id="4a368-127">**LambdaValue\<Boolean>**</span></span>  
 <span data-ttu-id="4a368-128">**LocationReferenceValue < список\<строка >>**</span><span class="sxs-lookup"><span data-stu-id="4a368-128">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="4a368-129">**По каждому элементу\<строка >**</span><span class="sxs-lookup"><span data-stu-id="4a368-129">**ForEach\<String>**</span></span>  
 <span data-ttu-id="4a368-130">**VariableValue < IEnumerable\<строка >>**</span><span class="sxs-lookup"><span data-stu-id="4a368-130">**VariableValue<IEnumerable\<String>>**</span></span>  
 <span data-ttu-id="4a368-131">**WriteLine**</span><span class="sxs-lookup"><span data-stu-id="4a368-131">**WriteLine**</span></span>  
 <span data-ttu-id="4a368-132">**DelegateArgumentValue\<строка >**</span><span class="sxs-lookup"><span data-stu-id="4a368-132">**DelegateArgumentValue\<String>**</span></span>  
 <span data-ttu-id="4a368-133">**Sequence**</span><span class="sxs-lookup"><span data-stu-id="4a368-133">**Sequence**</span></span>  
 <span data-ttu-id="4a368-134">**WriteLine**</span><span class="sxs-lookup"><span data-stu-id="4a368-134">**WriteLine**</span></span>  
 <span data-ttu-id="4a368-135">**Литерал\<строка >** для извлечения определенного действия вместо перечисления всех действий, <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> используется.</span><span class="sxs-lookup"><span data-stu-id="4a368-135">**Literal\<String>**  To retrieve a specific activity instead of enumerating all of the activities, <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> is used.</span></span> <span data-ttu-id="4a368-136">Как <xref:System.Activities.WorkflowInspectionServices.Resolve%2A>, так <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> выполняют кэширование метаданных, если метод `WorkflowInspectionServices.CacheMetadata` не был вызван ранее.</span><span class="sxs-lookup"><span data-stu-id="4a368-136">Both <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> and <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> perform metadata caching if `WorkflowInspectionServices.CacheMetadata` has not been previously called.</span></span> <span data-ttu-id="4a368-137">Если метод <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> уже был вызван, то <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> основывается на существующих метаданных.</span><span class="sxs-lookup"><span data-stu-id="4a368-137">If <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> has been called then <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is based on the existing metadata.</span></span> <span data-ttu-id="4a368-138">Таким образом, если с момента последнего вызова метода <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> в дерево были внесены изменения, <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> может возвратить неожиданные результаты.</span><span class="sxs-lookup"><span data-stu-id="4a368-138">Therefore, if tree changes have been made since the last call to <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A>, <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> might give unexpected results.</span></span> <span data-ttu-id="4a368-139">Если были внесены изменения в рабочий процесс после вызова метода <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>, метаданные могут быть кэшированы повторно путем вызова <xref:System.Activities.Validation.ActivityValidationServices> <xref:System.Activities.Validation.ActivityValidationServices.Validate%2A> метод.</span><span class="sxs-lookup"><span data-stu-id="4a368-139">If changes have been made to the workflow after calling <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>, metadata can be re-cached by calling the <xref:System.Activities.Validation.ActivityValidationServices> <xref:System.Activities.Validation.ActivityValidationServices.Validate%2A> method.</span></span> <span data-ttu-id="4a368-140">Кэширование метаданных рассматривается в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="4a368-140">Caching metadata is discussed in the next section.</span></span>  
  
### <a name="caching-metadata"></a><span data-ttu-id="4a368-141">Кэширование метаданных</span><span class="sxs-lookup"><span data-stu-id="4a368-141">Caching Metadata</span></span>  
 <span data-ttu-id="4a368-142">При кэшировании метаданных для действия создается и проверяется описание аргументов, переменных, дочерних действий и делегатов действия.</span><span class="sxs-lookup"><span data-stu-id="4a368-142">Caching the metadata for an activity builds and validates a description of the activity’s arguments, variables, child activities, and activity delegates.</span></span> <span data-ttu-id="4a368-143">По умолчанию метаданные кэшируются средой выполнения во время подготовки действия к выполнению.</span><span class="sxs-lookup"><span data-stu-id="4a368-143">Metadata, by default, is cached by the runtime when an activity is prepared for execution.</span></span> <span data-ttu-id="4a368-144">Если автору узла рабочего процесса необходимо кэшировать метаданные для действия или дерева действий раньше, например для выведения всех расходов на передний план, можно использовать метод <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> для выполнения кэширования метаданных в нужное время.</span><span class="sxs-lookup"><span data-stu-id="4a368-144">If a workflow host author wants to cache the metadata for an activity or activity tree before this, for example to take all of the cost upfront, then <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> can be used to cache the metadata at the desired time.</span></span>
