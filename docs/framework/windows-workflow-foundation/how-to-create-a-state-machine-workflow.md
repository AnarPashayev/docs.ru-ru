---
title: Практическое руководство. Создание рабочего процесса конечного автомата
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 3ec60e8f-fad4-493e-a426-e7962d7aee8c
ms.openlocfilehash: 564e9e424b8b82e8837a0a58cb8c11389920c297
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59139637"
---
# <a name="how-to-create-a-state-machine-workflow"></a>Практическое руководство. Создание рабочего процесса конечного автомата
Рабочие процессы могут создаваться как из встроенных, так и из пользовательских действий. В этом разделе действия по созданию рабочего процесса, который использует как встроенные действия, например <xref:System.Activities.Statements.StateMachine> действия и пользовательские действия из предыдущего [как: Создание действия](how-to-create-an-activity.md) раздела. Рабочий процесс моделирует игру по угадыванию числа.  
  
> [!NOTE]
>  Каждый раздел в учебнике «Приступая к работе» построен на основе предыдущих разделов. Для изучения этого раздела, необходимо сначала выполнить [как: Создание действия](how-to-create-an-activity.md).  
  
> [!NOTE]
>  Чтобы скачать завершенную версию учебника, см. раздел [Windows Workflow Foundation (WF45), учебник "Приступая к работе"](https://go.microsoft.com/fwlink/?LinkID=248976).  
  
### <a name="to-create-the-workflow"></a>Создание рабочего процесса  
  
1.  Щелкните правой кнопкой мыши **NumberGuessWorkflowActivities** в **обозревателе решений** и выберите **добавить**, **новый элемент**.  
  
2.  В **установленные**, **общих элементов** выберите **рабочего процесса**. Выберите **действия** из **рабочего процесса** списка.  
  
3.  Тип `StateMachineNumberGuessWorkflow` в **имя** поле и нажмите кнопку **добавить**.  
  
4.  Перетащите **StateMachine** действия из **конечный автомат** раздел **элементов** и сбросьте его в **Перетащите сюда действие** метки на область конструктора рабочих процессов.  
  
### <a name="to-create-the-workflow-variables-and-arguments"></a>Создание переменных и аргументов рабочего процесса  
  
1.  Дважды щелкните **StateMachineNumberGuessWorkflow.xaml** в **обозревателе решений** для отображения рабочего процесса в конструкторе, если он еще не отображается.  
  
2.  Нажмите кнопку **аргументы** в нижнем левом углу конструктора рабочих процессов для отображения **аргументы** области.  
  
3.  Нажмите кнопку **создать аргумент**.  
  
4.  Тип `MaxNumber` в **имя** выберите **в** из **направление** стрелку раскрывающегося списка выберите **Int32** из **Тип аргумента** стрелку раскрывающегося списка и нажмите клавишу ВВОД, чтобы сохранить аргумент.  
  
5.  Нажмите кнопку **создать аргумент**.  
  
6.  Тип `Turns` в **имя** поле, которое расположено ниже только что добавленного `MaxNumber` аргумента выберите **Out** из **направление** стрелку раскрывающегося списка, выберите  **Int32** из **тип аргумента** стрелку раскрывающегося списка и нажмите клавишу ВВОД.  
  
7.  Нажмите кнопку **аргументы** в нижнем левом углу конструктора действий, чтобы закрыть **аргументы** области.  
  
8.  Нажмите кнопку **переменных** в нижнем левом углу конструктора рабочих процессов для отображения **переменных** области.  
  
9. Нажмите кнопку **создать переменную**.  
  
    > [!TIP]
    >  Если не **создать переменную** поле отображается, щелкните <xref:System.Activities.Statements.StateMachine> действия в области конструктора рабочих процессов, чтобы выбрать его.  
  
10. Тип `Guess` в **имя** выберите **Int32** из **тип переменной** стрелку раскрывающегося списка и нажмите клавишу ВВОД, чтобы сохранить переменную.  
  
11. Нажмите кнопку **создать переменную**.  
  
12. Тип `Target` в **имя** выберите **Int32** из **тип переменной** стрелку раскрывающегося списка и нажмите клавишу ВВОД, чтобы сохранить переменную.  
  
13. Нажмите кнопку **переменных** в нижнем левом углу конструктора действий, чтобы закрыть **переменных** области.  
  
### <a name="to-add-the-workflow-activities"></a>Добавление действий рабочего процесса  
  
1.  Нажмите кнопку **State1** чтобы выбрать его. В **окно "Свойства"**, изменить **DisplayName** для `Initialize Target`.  
  
    > [!TIP]
    >  Если **окно "Свойства"** не отображается, выберите **окно "Свойства"** из **представление** меню.  
  
2.  Дважды щелкните только что переименованную **инициализировать целевой объект** состояния в конструкторе рабочих процессов, чтобы развернуть его.  
  
3.  Перетащите **назначить** действия из **примитивы** раздел **элементов** и сбросьте его в **запись** раздел состояния. Тип `Target` в **для** поле и следующее выражение в **введите выражение C#** или **введите выражение VB** поле.  
  
    ```vb  
    New System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    ```csharp  
    new System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    > [!TIP]
    >  Если **элементов** окно не отображается, выберите **элементов** из **представление** меню.  
  
4.  Возврат к общему машины представление в конструкторе рабочих процессов состояния, нажав кнопку **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
5.  Перетащите **состояние** действия из **конечный автомат** раздел **элементов** в конструктор рабочего процесса и наведите его на **инициализировать целевой объект** состояние. Обратите внимание, что вокруг появятся четыре треугольника **инициализировать целевой объект** состояние, когда новое состояние окажется над ним. Сбросьте новое состояние в треугольник непосредственно под **инициализировать целевой объект** состояния. Эта команда помещает новое состояние помещается в рабочий процесс и создает переход из **инициализировать целевой объект** состояния в новое состояние.  
  
6.  Нажмите кнопку **State1** чтобы выбрать его, изменить **DisplayName** для `Enter Guess`, а затем дважды щелкните состояние в конструкторе рабочих процессов, чтобы развернуть его.  
  
7.  Перетащите **WriteLine** действия из **примитивы** раздел **элементов** и сбросьте его в **запись** раздел состояния.  
  
8.  Введите следующее выражение в **текст** свойства **WriteLine**.  
  
    ```vb  
    "Please enter a number between 1 and " & MaxNumber  
    ```  
  
    ```csharp  
    "Please enter a number between 1 and " + MaxNumber  
    ```  
  
9. Перетащите **назначить** действия из **примитивы** раздел **элементов** фигуру на **выхода** раздел состояния.  
  
10. Тип `Turns` в **для** поле и `Turns + 1` в **введите выражение C#** или **введите выражение VB** поле.  
  
11. Возврат к общему машины представление в конструкторе рабочих процессов состояния, нажав кнопку **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
12. Перетащите **FinalState** действия из **конечный автомат** раздел **элементов**, наведите его на **введите ответ** состояния, а затем удалите ее на треугольник, который отображается справа от **введите ответ** состояние для создания перехода между **введите ответ** и **FinalState**.  
  
13. Имя по умолчанию перехода — **T2**. Щелкните переход в конструкторе рабочих процессов, чтобы выбрать его и задайте его **DisplayName** для **правильное пробное значение**. Затем щелкните и выберите **FinalState**и перетащите его вправо, чтобы было достаточно места для отображения полного имени перехода без наложения его на другие из двух состояний. Это позволит упростить выполнение оставшихся действий в учебнике.  
  
14. Дважды щелкните только что переименованную **правильное пробное значение** перехода в конструкторе рабочих процессов, чтобы развернуть его.  
  
15. Перетащите **ReadInt** действия из **NumberGuessWorkflowActivities** раздел **элементов** и поместите его **триггера** раздел перехода.  
  
16. В **окно "Свойства"** для **ReadInt** действия, тип `"EnterGuess"` кавычек в **BookmarkName** поле значения свойства и тип `Guess`в **результат** поле значения свойства  
  
17. Введите следующее выражение в **правильное пробное значение** перехода **условие** поле значения свойства.  
  
    ```vb  
    Guess = Target  
    ```  
  
    ```csharp  
    Guess == Target  
    ```  
  
18. Возврат к общему машины представление в конструкторе рабочих процессов состояния, нажав кнопку **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
    > [!NOTE]
    >  Переход происходит при получении события триггера и оценке <xref:System.Activities.Statements.Transition.Condition%2A> значением `True` (если оно присутствует). Для этого перехода Если пользователя `Guess` соответствует случайно созданному `Target`, управление передается **FinalState** и завершения рабочего процесса.  
  
19. В зависимости от того, является ли пробное значение правильный, рабочий процесс должен перейти либо **FinalState** или обратно **введите ответ** состояния для другой попытки. Оба перехода совместно используют один и тот же триггер ожидания пробного значения пользователя, получаемого с помощью **ReadInt** действия. Это называется общим переходом. Чтобы создать общий переход, щелкните круг, обозначающий начало **правильное пробное значение** переход и перетащите его в нужное состояние. В этом случае переход является самостоятельной перехода, поэтому перетащите начальную точку **правильное пробное значение** переход и сбросьте ее обратно в нижней части **введите ответ** состояния. После создания перехода выберите его в конструкторе рабочих процессов и задать его **DisplayName** свойства **неверное пробное значение**.  
  
    > [!NOTE]
    >  Общие переходы также могут создаваться из в конструкторе переходов, щелкнув **добавить общий переход триггера** в нижней части конструктора перехода, а затем выбрав требуемое целевое состояние из  **Состояния, доступные для подключения** раскрывающегося списка.  
  
    > [!NOTE]
    >  Обратите внимание, что если состояние <xref:System.Activities.Statements.Transition.Condition%2A> перехода оценивается как `false` (или все условия общего перехода триггера оцениваются как `false`), переход не выполняется, а все триггеры для всех переходов из состояния будут запланированы заново. В этом учебнике такая ситуация невозможна из-за способа настройки условий (имеются определенные действия для случая, если догадка верна или неверна).  
  
20. Дважды щелкните **неверное пробное значение** перехода в конструкторе рабочих процессов, чтобы развернуть его. Обратите внимание, что **триггера** уже имеет один и тот же **ReadInt** действия, который использовался **правильное пробное значение** перехода.  
  
21. Введите следующее выражение в **условие** поле значения свойства.  
  
    ```vb  
    Guess <> Target  
    ```  
  
    ```csharp  
    Guess != Target  
    ```  
  
22. Перетащите **Если** действия из **поток управления** раздел **элементов** и поместите его **действие** разделе перехода.  
  
23. Введите следующее выражение в **Если** действия **условие** поле значения свойства.  
  
    ```
    Guess < Target  
    ```  
  
24. Перетащите два **WriteLine** действия из **примитивы** раздел **элементов** и сбросьте их так, чтобы одно находилось в **затем** раздел **Если** действия, а другое — в **Else** раздел.  
  
25. Нажмите кнопку **WriteLine** действия в **затем** раздела, чтобы выбрать его и введите следующее выражение в **текст** поле значения свойства.  
  
    ```
    "Your guess is too low."  
    ```  
  
26. Нажмите кнопку **WriteLine** действия в **Else** раздела, чтобы выбрать его и введите следующее выражение в **текст** поле значения свойства.  
  
    ```
    "Your guess is too high."  
    ```  
  
27. Возврат к общему машины представление в конструкторе рабочих процессов состояния, нажав кнопку **StateMachine** на экране навигатора в верхней части конструктора рабочих процессов.  
  
     В следующем примере показан завершенный рабочий процесс.  
  
     ![Завершения рабочего процесса конечного автомата](./media/wfstatemachinegettingstartedtutorialcomplete.JPG "WFStateMachineGettingStartedTutorialComplete")  
  
### <a name="to-build-the-workflow"></a>Построение рабочего процесса  
  
1.  Чтобы построить решение, нажмите CTRL+SHIFT+B.  
  
     Для указания о том, как запустить рабочий процесс, см. следующий раздел, [как: Запуск рабочего процесса](how-to-run-a-workflow.md). Если вы уже выполнили [как: Запуск рабочего процесса](how-to-run-a-workflow.md) шаг с другим стилем рабочего процесса и планируете запустить его с помощью рабочего процесса конечного автомата состояния с этого шага, сразу перейти к [построение и запуск приложения](how-to-run-a-workflow.md#BKMK_ToRunTheApplication) раздел [как: Запуск рабочего процесса](how-to-run-a-workflow.md).  
  
## <a name="see-also"></a>См. также

- <xref:System.Activities.Statements.Flowchart>
- <xref:System.Activities.Statements.FlowDecision>
- [Программирование в Windows Workflow Foundation](programming.md)
- [Разработка рабочих процессов](designing-workflows.md)
- [Учебник по началу работы](getting-started-tutorial.md)
- [Практическое руководство. Создание действия](how-to-create-an-activity.md)
- [Практическое руководство. Запуск рабочего процесса](how-to-run-a-workflow.md)
