---
title: Набор средств внешнего набора правил
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: eb59b02d469788b23126f4e02c5b7ae5a63081f0
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2020
ms.locfileid: "77094674"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="a721d-102">Набор средств внешнего набора правил</span><span class="sxs-lookup"><span data-stu-id="a721d-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="a721d-103">Обычно, когда правила используются в приложении рабочего процесса, они являются частью сборки.</span><span class="sxs-lookup"><span data-stu-id="a721d-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="a721d-104">В некоторых случаях, возможно, потребуется создать наборы правил отдельно от сборки, чтобы можно было обновлять их, без повторного построения и развертывания сборки рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="a721d-105">В этом образце показано, как управлять и изменять наборы правил в базе данных, а также как получить доступ к этим наборам правил из рабочего процесса в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="a721d-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="a721d-106">Это позволяет запускать экземпляры рабочего процесса, чтобы автоматически включать изменения в наборах правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="a721d-107">В примере набора средств "External RuleSet Toolkit" содержится средство на основе Windows Forms, которое можно использовать для управления и изменения версий набора правил в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="a721d-108">Также включены действие и служба размещения для выполнения этих правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="a721d-109">Для этого примера требуется [Microsoft SQL Server](/sql).</span><span class="sxs-lookup"><span data-stu-id="a721d-109">This sample requires [Microsoft SQL Server](/sql).</span></span>

<span data-ttu-id="a721d-110">Visual Studio предоставляет редактор набора правил в составе Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="a721d-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="a721d-111">Редактор запускается двойным щелчком действия `Policy` в рабочем процессе; редактор выполняет сериализацию объекта набора правил в файл с расширением RULES, связанный с рабочим процессом (действие `Policy` запускает экземпляр набора правил из рабочего процесса).</span><span class="sxs-lookup"><span data-stu-id="a721d-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="a721d-112">При построении проекта рабочего процесса выполняет компиляция в сборку файла с расширением RULES как ресурса.</span><span class="sxs-lookup"><span data-stu-id="a721d-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="a721d-113">Компоненты данного образца включают следующее:</span><span class="sxs-lookup"><span data-stu-id="a721d-113">The components of this sample include:</span></span>

- <span data-ttu-id="a721d-114">Средство пользовательского графического интерфейса набора правил, которое используется для редактирования и управления версиями набора правил в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="a721d-115">Служба набора правил, настройка которой выполняется в ведущем приложении, осуществляет доступ к наборам правил из базы данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="a721d-116">Действие `ExternalPolicy` запрашивает набор правил из службы набора правил и запускает набор правил из рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="a721d-117">Взаимодействие компонентов показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="a721d-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="a721d-118">В следующих разделах приведено описание каждого из компонентов.</span><span class="sxs-lookup"><span data-stu-id="a721d-118">The sections that follow describe each component.</span></span>

![Схема, на которой показан обзор примеров набора внешних наборов правил.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="a721d-120">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="a721d-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="a721d-121">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="a721d-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="a721d-122">Если этот каталог не существует, перейдите к [примерам Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) , чтобы скачать все Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Samples.</span><span class="sxs-lookup"><span data-stu-id="a721d-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="a721d-123">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="a721d-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="a721d-124">Средство "RuleSet"</span><span class="sxs-lookup"><span data-stu-id="a721d-124">RuleSet Tool</span></span>

<span data-ttu-id="a721d-125">На следующем рисунке показан снимок экрана средства создания правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="a721d-126">В меню **хранилище правил** можно загрузить доступные наборы правил из базы данных и сохранить измененные наборы правил обратно в хранилище.</span><span class="sxs-lookup"><span data-stu-id="a721d-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="a721d-127">Файл конфигурации приложения предоставляет строку подключения базы данных для базы данных набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="a721d-128">При запуске это средство автоматически загружает наборы правил из настроенной базы данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Снимок экрана, показывающий браузер набора правил.](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="a721d-130">Средство "RuleSet" служит для применения основного и вспомогательного номеров версий к наборам правил, что позволяет одновременно создавать и хранить несколько версий (средство не предоставляет возможности блокировки или другие возможности управления конфигурацией, помимо поддержки версий).</span><span class="sxs-lookup"><span data-stu-id="a721d-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="a721d-131">С помощью данного средства можно создавать новые версии набора правил или удалять существующие версии.</span><span class="sxs-lookup"><span data-stu-id="a721d-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="a721d-132">При нажатии кнопки **создать**средство создает новое имя набора правил и применяет версию 1,0.</span><span class="sxs-lookup"><span data-stu-id="a721d-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="a721d-133">При копировании версии средство создает копию выбранной версии набора правил, включая содержащиеся правила, и присваивает новые уникальные номера версий.</span><span class="sxs-lookup"><span data-stu-id="a721d-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="a721d-134">Эти номера версий основаны на номерах версий существующих наборов правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="a721d-135">Имя и номера версий набора правил можно изменить с помощью связанных полей на форме.</span><span class="sxs-lookup"><span data-stu-id="a721d-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="a721d-136">При нажатии кнопки **изменить правила**запускается редактор набора правил, как показано на следующем рисунке:</span><span class="sxs-lookup"><span data-stu-id="a721d-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Снимок экрана, показывающий редактор набора правил.](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="a721d-138">Это повторное размещение диалогового окна редактора, входящего в состав Windows Workflow Foundation надстройки Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a721d-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="a721d-139">Оно предоставляет тот же набор функциональных возможностей, включая поддержку Intellisense.</span><span class="sxs-lookup"><span data-stu-id="a721d-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="a721d-140">Правила создаются для целевого типа (например, рабочего процесса), связанного с набором правил в средстве. Если нажать кнопку **Обзор** в главном диалоговом окне средства, откроется диалоговое окно **выбора рабочего процесса или типа** , как показано на рис. 4.</span><span class="sxs-lookup"><span data-stu-id="a721d-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="a721d-141">![Выбор &#47;типа рабочего процесса](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="a721d-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="a721d-142">Рисунок 4. Выбор рабочего процесса или типа</span><span class="sxs-lookup"><span data-stu-id="a721d-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="a721d-143">Диалоговое окно **выбора рабочего процесса или типа** можно использовать, чтобы указать сборку и конкретный тип в этой сборке.</span><span class="sxs-lookup"><span data-stu-id="a721d-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="a721d-144">Этот тип является конечным типом, по которому создаются (и запускаются) правила.</span><span class="sxs-lookup"><span data-stu-id="a721d-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="a721d-145">В большинстве случаев конечным типом является рабочий процесс или какой-либо другой тип действия.</span><span class="sxs-lookup"><span data-stu-id="a721d-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="a721d-146">Тем не менее можно запустить набор правил по любому типу .NET.</span><span class="sxs-lookup"><span data-stu-id="a721d-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="a721d-147">Путь к файлу сборки и типу `name are stored with the` RuleSet в базе данных, чтобы при извлечении набора правил из базы данных средство предпримет попытку автоматически загрузить целевой тип.</span><span class="sxs-lookup"><span data-stu-id="a721d-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="a721d-148">При нажатии кнопки **ОК** в диалоговом окне **выбора рабочего процесса или типа** он проверяет выбранный тип на соответствие с набором правил, чтобы убедиться, что целевой тип содержит все элементы, на которые имеются ссылки в правилах.</span><span class="sxs-lookup"><span data-stu-id="a721d-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="a721d-149">Ошибки отображаются в диалоговом окне **ошибок проверки** .</span><span class="sxs-lookup"><span data-stu-id="a721d-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="a721d-150">Можно выбрать продолжение изменения, несмотря на ошибки, или нажмите кнопку **Отмена**.</span><span class="sxs-lookup"><span data-stu-id="a721d-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="a721d-151">В меню **Сервис** диалогового окна основное средство можно нажать кнопку **проверить** , чтобы повторно проверить версию набора правил на соответствие целевому действию.</span><span class="sxs-lookup"><span data-stu-id="a721d-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Снимок экрана, показывающий диалоговое окно ошибок проверки.](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="a721d-153">В меню **данные** в средстве можно импортировать и экспортировать наборы правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="a721d-154">При нажатии кнопки **Импорт**появляется диалоговое окно выбора файла, в котором можно выбрать файл rules.</span><span class="sxs-lookup"><span data-stu-id="a721d-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="a721d-155">Это может быть файл, изначально созданный в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a721d-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="a721d-156">В RULES-файле должен содержаться сериализованный экземпляр `RuleDefinitions` с коллекцией условий и коллекцией наборов правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="a721d-157">Средство не использует коллекцию условий, но использует формат `RuleDefinitions`. rules, чтобы разрешить взаимодействие с средой Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a721d-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="a721d-158">После выбора файла rules открывается диалоговое окно **выбора набора правил** .</span><span class="sxs-lookup"><span data-stu-id="a721d-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="a721d-159">Можно использовать диалоговое окно для выбора наборов правил из файла, который требуется импортировать (по умолчанию указаны все наборы правил).</span><span class="sxs-lookup"><span data-stu-id="a721d-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="a721d-160">Наборы правил в RULES-файле не содержат номеров версии, поскольку их версии в рамках проекта WF совпадают с версией сборки.</span><span class="sxs-lookup"><span data-stu-id="a721d-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="a721d-161">Во время процесса импорта средство автоматически назначает следующий доступный основной номер версии (который можно изменить после импорта); Номера назначенных версий можно просмотреть в списке **выбора набора правил** .</span><span class="sxs-lookup"><span data-stu-id="a721d-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="a721d-162">Для каждого импортируемого набора правил средство пытается поместить связанный тип из папки bin\Debug в местоположение RULES-файла (если есть), в зависимости от членов, используемых в наборе правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="a721d-163">Если средство обнаруживает несколько соответствующих типов, оно пытается выбирать тип в соответствии с совпадением между именем RULES-файла и именем типа (например, тип `Workflow1` соответствует файлу "Workflow1.rules").</span><span class="sxs-lookup"><span data-stu-id="a721d-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="a721d-164">При наличии нескольких совпадений предлагается выбрать тип.</span><span class="sxs-lookup"><span data-stu-id="a721d-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="a721d-165">Если механизму автоматической идентификации не удается найти соответствующую сборку или тип, после импорта можно нажать кнопку **Обзор** в главном диалоговом окне, чтобы перейти к связанному типу.</span><span class="sxs-lookup"><span data-stu-id="a721d-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="a721d-166">На следующем рисунке показан селектор набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-166">The following image shows the RuleSet Selector:</span></span>

![Снимок экрана, показывающий диалоговое окно выбора набора правил.](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="a721d-168">При нажатии кнопки **Экспорт данных** в главном меню средства диалоговое окно **выбора набора правил** появляется снова, из которого можно определить наборы правил из базы данных, которую необходимо экспортировать.</span><span class="sxs-lookup"><span data-stu-id="a721d-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="a721d-169">При нажатии кнопки **ОК**появляется диалоговое окно **Save File (сохранить файл** ), в котором можно указать имя и расположение результирующего файла rules.</span><span class="sxs-lookup"><span data-stu-id="a721d-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="a721d-170">Поскольку в RULES-файл не содержатся сведения о версии, для заданного имени набора правил можно выбрать только одну версию набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="a721d-171">Действие "PolicyFromService".</span><span class="sxs-lookup"><span data-stu-id="a721d-171">PolicyFromService Activity</span></span>

<span data-ttu-id="a721d-172">Код для действия `PolicyFromService` является прямолинейным.</span><span class="sxs-lookup"><span data-stu-id="a721d-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="a721d-173">Функционирование этого кода во многом аналогично действию `Policy`, предоставляемому в WF, однако вместо извлечения конечного набора правил из RULES-файла данный код выполняет вызов службы размещения, чтобы получить экземпляр набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="a721d-174">Затем код запускает набор правил из экземпляра действия корневого рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="a721d-175">Чтобы использовать данное действие в рабочем процессе, следует добавить ссылку на сборки `PolicyActivities` и `RuleSetService` из проекта рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="a721d-176">Обсуждение способов добавления действия на панель инструментов см. в процедуре в конце данного раздела.</span><span class="sxs-lookup"><span data-stu-id="a721d-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="a721d-177">После того, как действие помещено в рабочий процесс, необходимо указать имя набора правил, который требуется запустить.</span><span class="sxs-lookup"><span data-stu-id="a721d-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="a721d-178">Можно ввести имя как буквенное значение, либо выполнить привязку к переменной рабочего процесса или свойству другого действия.</span><span class="sxs-lookup"><span data-stu-id="a721d-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="a721d-179">Дополнительно можно задать номера версий для конкретного набора правил, который требуется запустить.</span><span class="sxs-lookup"><span data-stu-id="a721d-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="a721d-180">Если оставить значение по умолчанию "0" для основного и вспомогательного номеров версий, действию будет автоматически присвоен номер последней версии в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="a721d-181">Служба "RuleSet"</span><span class="sxs-lookup"><span data-stu-id="a721d-181">RuleSet Service</span></span>

<span data-ttu-id="a721d-182">Эта служба отвечает за извлечение заданной версии набора правил из базы данных и ее возврат в вызывающее действие.</span><span class="sxs-lookup"><span data-stu-id="a721d-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="a721d-183">Как уже обсуждалось ранее, если значения основной и вспомогательной версии, переданные в вызов `GetRuleSet` оба равны "0", служба выполняет извлечение последней версии.</span><span class="sxs-lookup"><span data-stu-id="a721d-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="a721d-184">На этой стадии не выполняется кэширование определений или экземпляров набора правил; также, отсутствуют функции пометки версий набора правил как "развертываемых", чтобы отличить их от наборов правил в процессе выполнения.</span><span class="sxs-lookup"><span data-stu-id="a721d-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="a721d-185">База данных, доступ к которой осуществляется службой, должна быть настроена на узле с помощью файла конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="a721d-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="a721d-186">Запуск средства</span><span class="sxs-lookup"><span data-stu-id="a721d-186">To run the tool</span></span>

1. <span data-ttu-id="a721d-187">В папке, в которой задана таблица набора правил, используемая средством и службой, также содержится файл "Setup.sql".</span><span class="sxs-lookup"><span data-stu-id="a721d-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="a721d-188">Можно запустить пакетный файл "Setup.cmd", чтобы создать базу данных правил в SQL Express и задать таблицу набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="a721d-189">При редактировании пакетного файла или файла "Setup.sql", если использование SQL Express или размещение таблицы в базе данных с именем, отличным от `Rules`, не задано, файлы конфигурации приложения в средстве "RuleSet" и проекты `UsageSample` следует редактировать, используя одинаковые сведения.</span><span class="sxs-lookup"><span data-stu-id="a721d-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="a721d-190">После запуска скрипта "Setup.sql" можно построить решение `ExternalRuleSetToolkit`, а затем запустить средство "RuleSet" из проекта "ExternalRuleSetTool".</span><span class="sxs-lookup"><span data-stu-id="a721d-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="a721d-191">Решение консольного приложения последовательного рабочего процесса `RuleSetToolkitUsageSample` включает образец рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="a721d-192">Рабочий процесс включает действие `PolicyFromService` и две переменные: `orderValue` и `discount`, для которых выполняется запуск конечного набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="a721d-193">Чтобы использовать этот образец, необходимо построить решение `RuleSetToolkitUsageSample`.</span><span class="sxs-lookup"><span data-stu-id="a721d-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="a721d-194">Затем в главном меню средства набора правил щелкните **Импорт данных** и укажите файл дискаунтрулесет. rules в папке рулесеттулкитусажесампле.</span><span class="sxs-lookup"><span data-stu-id="a721d-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="a721d-195">Щелкните пункт меню **хранилище правил — сохранить** , чтобы сохранить импортированный набор правил в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a721d-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="a721d-196">Поскольку ссылка на сборку `PolicyActivities` дана из образца проекта рабочего процесса, действие `PolicyFromService` используется в рабочем процессе.</span><span class="sxs-lookup"><span data-stu-id="a721d-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="a721d-197">Тем не менее, это оно не отображается на панели инструментов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a721d-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="a721d-198">Чтобы добавить действие на панель инструментов, необходимо сделать следующее.</span><span class="sxs-lookup"><span data-stu-id="a721d-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="a721d-199">Щелкните правой кнопкой мыши панель элементов и выберите **пункт Выбрать элементы** (это может занять некоторое время).</span><span class="sxs-lookup"><span data-stu-id="a721d-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="a721d-200">Когда откроется диалоговое окно **Выбор элементов панели элементов** , перейдите на вкладку **действия** .</span><span class="sxs-lookup"><span data-stu-id="a721d-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="a721d-201">Перейдите к `PolicyActivities` сборке в `ExternalRuleSetToolkit` решении и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="a721d-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="a721d-202">Убедитесь, что в диалоговом окне **Выбор элементов панели элементов** выбрано действие `PolicyFromService`, а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="a721d-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="a721d-203">Теперь действие должно отобразиться в области элементов в категории **компоненты рулесеттулкитусажесампле** .</span><span class="sxs-lookup"><span data-stu-id="a721d-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="a721d-204">Служба "RuleSet" уже настроена на узле консольного приложения с помощью приведенного ниже оператора в файле "Program.cs".</span><span class="sxs-lookup"><span data-stu-id="a721d-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="a721d-205">Можно также настроить службу на узле с помощью файла конфигурации. Дополнительные сведения см. в документации по пакету SDK.</span><span class="sxs-lookup"><span data-stu-id="a721d-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="a721d-206">Файл конфигурации приложения добавляется в проект рабочего процесса, чтобы указать строку подключения для базы данных, которая будет использоваться службой.</span><span class="sxs-lookup"><span data-stu-id="a721d-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="a721d-207">Средством "RuleSet" должна использоваться та же строка подключения, что указывает на базу данных, содержащую таблицу набора правил.</span><span class="sxs-lookup"><span data-stu-id="a721d-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="a721d-208">Теперь можно выполнить проект `RuleSetToolkitUsageSample`, а также остальные консольные приложения рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a721d-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="a721d-209">Нажмите клавишу F5 или CTRL + F5 в Visual Studio или непосредственно запустите файл Рулесеттулкитусажесампле. exe.</span><span class="sxs-lookup"><span data-stu-id="a721d-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a721d-210">Чтобы повторную скомпилировать выборку использования, необходимо закрыть средство "RuleSet", поскольку средство загружает сборку выборки использования.</span><span class="sxs-lookup"><span data-stu-id="a721d-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
