---
title: Создание пользовательских действий управления потоком
ms.date: 03/30/2017
ms.assetid: 27f409f6-2d1d-4cfb-9765-93eb2ad667d5
ms.openlocfilehash: 92d98d33b10e431248c4c482fcd26f3036c4c330
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242075"
---
# <a name="creating-custom-flow-control-activities"></a><span data-ttu-id="5fa46-102">Создание пользовательских действий управления потоком</span><span class="sxs-lookup"><span data-stu-id="5fa46-102">Creating custom flow control activities</span></span>

<span data-ttu-id="5fa46-103">.NET Framework содержит множество действий управления потоком, которые работают аналогично абстрактным структурам программирования (например, <xref:System.Activities.Statements.Flowchart> ) или к стандартным инструкциям программирования (например, <xref:System.Activities.Statements.If> ).</span><span class="sxs-lookup"><span data-stu-id="5fa46-103">The .NET Framework contains a variety of flow-control activities that function similarly to abstract programming structures (such as <xref:System.Activities.Statements.Flowchart>)   or to standard programming statements (such as <xref:System.Activities.Statements.If>).</span></span> <span data-ttu-id="5fa46-104">В этом разделе обсуждается архитектура одного из примеров проектов, [неуниверсальное значение foreach](./samples/non-generic-foreach.md).</span><span class="sxs-lookup"><span data-stu-id="5fa46-104">This topic discusses the architecture of one of the sample projects, [Non-Generic ForEach](./samples/non-generic-foreach.md).</span></span>  
  
## <a name="creating-the-custom-class"></a><span data-ttu-id="5fa46-105">Создание пользовательского класса</span><span class="sxs-lookup"><span data-stu-id="5fa46-105">Creating the custom class</span></span>  

 <span data-ttu-id="5fa46-106">Так как неуниверсальному классу ForEach необходимо планировать дочерние действия, он должен быть производным от <xref:System.Activities.NativeActivity>, поскольку действия, производные от <xref:System.Workflow.Activities.CodeActivity>, не имеют этой функциональной возможности.</span><span class="sxs-lookup"><span data-stu-id="5fa46-106">Since the Non-Generic ForEach class will need to schedule child activities, it will need to derive from <xref:System.Activities.NativeActivity>, since activities that derive from <xref:System.Workflow.Activities.CodeActivity> do not have this functionality.</span></span>  
  
```csharp  
public sealed class ForEach : NativeActivity  
{
}
```  
  
 <span data-ttu-id="5fa46-107">Пользовательский класс требует, чтобы это действие использовало несколько элементов для хранения данных и для обеспечения возможности выполнять дочерние действия этого действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-107">The custom class requires several members to store data being used by the activity, and to provide functionality to execute the activity’s child activities.</span></span> <span data-ttu-id="5fa46-108">К этим элементам относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="5fa46-108">These members include:</span></span>  
  
- <span data-ttu-id="5fa46-109">`valueEnumerator` - закрытый <xref:System.Activities.Variable%601> типа <xref:System.Collections.IEnumerator> для последовательного перебора элементов в коллекции.</span><span class="sxs-lookup"><span data-stu-id="5fa46-109">`valueEnumerator`: The non-public <xref:System.Activities.Variable%601> of type <xref:System.Collections.IEnumerator> used to iterate over the collection of items.</span></span> <span data-ttu-id="5fa46-110">Это элемент имеет тип <xref:System.Activities.Variable%601>, так как он используется внутри действия, а не является аргументом или открытым свойством, которые использовались бы в том случае, если бы объект имел происхождение за пределами действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-110">This member is of type <xref:System.Activities.Variable%601> because it is used internally in the activity, rather than an argument or public property, which would be used if this object were to have an origin outside the activity.</span></span>  
  
- <span data-ttu-id="5fa46-111">`OnChildComplete` - открытое свойство <xref:System.Activities.CompletionCallback>, которое выполняется при завершении каждого дочернего действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-111">`OnChildComplete`: The public <xref:System.Activities.CompletionCallback> property that executes when each child completes execution.</span></span> <span data-ttu-id="5fa46-112">Этот элемент представляет собой свойство CLR, так как его значение не изменяется для различных экземпляров действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-112">This member is defined as a CLR property, since its value will not change for different instances of the activity.</span></span>  
  
- <span data-ttu-id="5fa46-113">`Values` - коллекция входных данных, используемая для итераций дочернего действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-113">`Values`: The collection of inputs used for the iterations of the child activity.</span></span> <span data-ttu-id="5fa46-114">Это элемент типа <xref:System.Activities.InArgument%601>, так как данные находятся за пределами действия, но ожидается, что содержимое коллекции не будет меняться во время выполнения действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-114">This member is of type <xref:System.Activities.InArgument%601>, since the origin of the data is outside the activity, but the contents of the collection is not expected to change during the execution of the activity.</span></span> <span data-ttu-id="5fa46-115">Если бы для действия было необходимо обеспечить изменяемость элементов коллекции во время выполнения действия (например, добавление или удаление действий), этот элемент был бы определен как <xref:System.Activities.ActivityAction>, которое затем вычислялось бы при каждом обращении, чтобы изменения были доступны для действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-115">If the activity needed the functionality to change the contents of this collection while the activity was executing (to add or remove activities, for instance), this member would have been defined as an <xref:System.Activities.ActivityAction>, which then would have been evaluated every time it was accessed, so that changes would be available to the activity.</span></span>  
  
- <span data-ttu-id="5fa46-116">`Body` - определяет, что действие должно выполняться для каждого элемента в коллекции `Values`.</span><span class="sxs-lookup"><span data-stu-id="5fa46-116">`Body`: This member defines the activity to be executed for each item in the `Values` collection.</span></span> <span data-ttu-id="5fa46-117">Этот элемент определен как <xref:System.Activities.ActivityAction>, поэтому он вычисляется при каждом обращении к нему.</span><span class="sxs-lookup"><span data-stu-id="5fa46-117">This member is defined as an <xref:System.Activities.ActivityAction> so that it is evaluated every time it is accessed.</span></span>  
  
- <span data-ttu-id="5fa46-118">`Execute` - этот метод использует закрытые элементы `InternalExecute`, `OnForEachComplete` и `GetStateAndExecute` для планирования выполнения и назначения обработчика завершения дочернего действия, определенного в элементе Body.</span><span class="sxs-lookup"><span data-stu-id="5fa46-118">`Execute`: This method uses the `InternalExecute`, `OnForEachComplete`, and `GetStateAndExecute` non-public members to schedule the execution and assign the completion handler of the child activity defined in the Body member.</span></span>  
  
- <span data-ttu-id="5fa46-119">`CacheMetadata` - этот элемент предоставляет среде выполнения сведения, необходимые для выполнения действия.</span><span class="sxs-lookup"><span data-stu-id="5fa46-119">`CacheMetadata`: This member provides the runtime with the information it needs to execute the activity.</span></span> <span data-ttu-id="5fa46-120">По умолчанию метод `CacheMetadata` действия сообщает среде выполнения обо всех открытых элементах действия, но, поскольку в этом действии для некоторых функций используются закрытые элементы, он должен сообщать среде выполнения о существовании этих элементов.</span><span class="sxs-lookup"><span data-stu-id="5fa46-120">By default, an activity’s `CacheMetadata` method will inform the runtime of all public members of the activity, but since this activity uses private members for some functionality, it needs to inform the runtime of their existence so that the runtime can be aware of them.</span></span> <span data-ttu-id="5fa46-121">В этом случае функция `CacheMetadata` переопределяется, чтобы обеспечить доступ к закрытому элементу `valueEnumerator`.</span><span class="sxs-lookup"><span data-stu-id="5fa46-121">In this case, the `CacheMetadata` function is overridden so that the private `valueEnumerator` member can be accessed.</span></span> <span data-ttu-id="5fa46-122">Этот элемент также создает аргумент для значений для этого действия, чтобы их можно было передавать действию во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="5fa46-122">This member also creates an argument for the values for the activity so that they can be passed in to the activity during execution.</span></span>
