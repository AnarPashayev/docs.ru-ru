---
title: Архитектура рабочих процессов Windows
description: Windows Workflow Foundation инкапсулирует единицы работы в виде действий, которые выполняются в среде с управлением потоком, обработкой исключений и другими функциями.
ms.date: 03/30/2017
ms.assetid: 1d4c6495-d64a-46d0-896a-3a01fac90aa9
ms.openlocfilehash: 81d1414fe5c6e17871dbbd0a2dd78cd8ace21ec6
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289143"
---
# <a name="windows-workflow-architecture"></a><span data-ttu-id="54176-103">Архитектура рабочих процессов Windows</span><span class="sxs-lookup"><span data-stu-id="54176-103">Windows Workflow Architecture</span></span>

<span data-ttu-id="54176-104">Windows Workflow Foundation (WF) создает уровень абстракции для разработки интерактивных долго выполняющихся приложений.</span><span class="sxs-lookup"><span data-stu-id="54176-104">Windows Workflow Foundation (WF) raises the abstraction level for developing interactive long-running applications.</span></span> <span data-ttu-id="54176-105">Блоки обработки инкапсулируются в виде действий.</span><span class="sxs-lookup"><span data-stu-id="54176-105">Units of work are encapsulated as activities.</span></span> <span data-ttu-id="54176-106">Действия работают в среде, которая обеспечивает средства для управления потоком, обработки исключений, распространения ошибок, сохранения данных состояния, загрузки и выгрузки текущих рабочих процессов из памяти, отслеживания и управления потоком транзакций.</span><span class="sxs-lookup"><span data-stu-id="54176-106">Activities run in an environment that provides facilities for flow control, exception handling, fault propagation, persistence of state data, loading and unloading of in-progress workflows from memory, tracking, and transaction flow.</span></span>  
  
## <a name="activity-architecture"></a><span data-ttu-id="54176-107">Архитектура действий</span><span class="sxs-lookup"><span data-stu-id="54176-107">Activity Architecture</span></span>  

 <span data-ttu-id="54176-108">Действия разрабатываются в виде типов среды CLR, которые являются производными либо от <xref:System.Activities.Activity>, <xref:System.Activities.CodeActivity>, <xref:System.Activities.AsyncCodeActivity> или <xref:System.Activities.NativeActivity>, либо от их вариантов, возвращающих значение, <xref:System.Activities.Activity%601>, <xref:System.Activities.CodeActivity%601>, <xref:System.Activities.AsyncCodeActivity%601> или <xref:System.Activities.NativeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="54176-108">Activities are developed as CLR types that derive from either <xref:System.Activities.Activity>, <xref:System.Activities.CodeActivity>, <xref:System.Activities.AsyncCodeActivity>, or <xref:System.Activities.NativeActivity>, or their variants that return a value, <xref:System.Activities.Activity%601>, <xref:System.Activities.CodeActivity%601>, <xref:System.Activities.AsyncCodeActivity%601>, or <xref:System.Activities.NativeActivity%601>.</span></span> <span data-ttu-id="54176-109">Разработка действий, которые являются производными от действия <xref:System.Activities.Activity>, позволяет пользователю собирать существующие действия для быстрого создания блоков обработки, работающих в среде рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="54176-109">Developing activities that derive from <xref:System.Activities.Activity> allows the user to assemble pre-existing activities to quickly create units of work that execute in the workflow environment.</span></span> <span data-ttu-id="54176-110">С другой стороны, действие <xref:System.Activities.CodeActivity> позволяет создавать логику выполнения в управляемом коде с использованием <xref:System.Activities.CodeActivityContext> в основном для доступа к аргументам действий.</span><span class="sxs-lookup"><span data-stu-id="54176-110"><xref:System.Activities.CodeActivity>, on the other hand, enables execution logic to be authored in managed code using <xref:System.Activities.CodeActivityContext> primarily for access to activity arguments.</span></span> <span data-ttu-id="54176-111"><xref:System.Activities.AsyncCodeActivity> аналогично <xref:System.Activities.CodeActivity>, за исключением того, что его можно использовать для реализации асинхронных задач.</span><span class="sxs-lookup"><span data-stu-id="54176-111"><xref:System.Activities.AsyncCodeActivity> is similar to <xref:System.Activities.CodeActivity> except that it can be used to implement asynchronous tasks.</span></span> <span data-ttu-id="54176-112">Разработка действий, которые являются производными от действия <xref:System.Activities.NativeActivity>, позволяет пользователям получать доступ к среде выполнения посредством <xref:System.Activities.NativeActivityContext> для таких функций, как планирование дочерних объектов, создание закладок, вызов асинхронной работы, регистрации транзакций и других операций.</span><span class="sxs-lookup"><span data-stu-id="54176-112">Developing activities that derive from <xref:System.Activities.NativeActivity> allows users to access the runtime through the <xref:System.Activities.NativeActivityContext> for functionality like scheduling children, creating bookmarks, invoking asynchronous work, registering transactions, and more.</span></span>  
  
 <span data-ttu-id="54176-113">Создание действий, которые происходят от действия <xref:System.Activities.Activity>, является декларативным, при этом эти действия не могут быть созданы на языке XAML.</span><span class="sxs-lookup"><span data-stu-id="54176-113">Authoring activities that derive from <xref:System.Activities.Activity> is declarative and these activities can be authored in XAML.</span></span> <span data-ttu-id="54176-114">В следующем примере действие `Prompt` создается при помощи других действий для тела выполнения.</span><span class="sxs-lookup"><span data-stu-id="54176-114">In the following example, an activity called `Prompt` is created using other activities for the execution body.</span></span>  
  
```xml  
<Activity x:Class='Prompt'  
  xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'  
    xmlns:z='http://schemas.microsoft.com/netfx/2008/xaml/schema'  
xmlns:my='clr-namespace:XAMLActivityDefinition;assembly=XAMLActivityDefinition'  
xmlns:s="clr-namespace:System;assembly=mscorlib"  
xmlns="http://schemas.microsoft.com/2009/workflow">  
<z:SchemaType.Members>  
    <z:SchemaType.SchemaProperty Name='Text' Type=' InArgument(s:String)' />  
  <z:SchemaType.SchemaProperty Name='Response' Type='OutArgument(s:String)' />  
</z:SchemaType.Members>  
  <Sequence>  
    <my:WriteLine Text='[Text]' />  
    <my:ReadLine BookmarkName='r1' Result='[Response]' />  
  </Sequence>  
</Activity>  
```  
  
## <a name="activity-context"></a><span data-ttu-id="54176-115">Контекст действия</span><span class="sxs-lookup"><span data-stu-id="54176-115">Activity Context</span></span>  

 <span data-ttu-id="54176-116"><xref:System.Activities.ActivityContext> представляет собой интерфейс автора действий со средой выполнения рабочих процессов и обеспечивает доступ ко многим функциям среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="54176-116">The <xref:System.Activities.ActivityContext> is the activity author's interface to the workflow runtime and provides access to the runtime's wealth of features.</span></span> <span data-ttu-id="54176-117">В следующем примере определяется действие, которое использует контекст выполнения для создания закладки (механизм, позволяющий действию зарегистрировать точку продолжения в ходе выполнения, которое может быть возобновлено при передаче узлом данных в действие).</span><span class="sxs-lookup"><span data-stu-id="54176-117">In the following example, an activity is defined that uses the execution context to create a bookmark (the mechanism that allows an activity to register a continuation point in its execution that can be resumed by a host passing data into the activity).</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#15](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#15)]  
  
## <a name="activity-life-cycle"></a><span data-ttu-id="54176-118">Жизненный цикл действия</span><span class="sxs-lookup"><span data-stu-id="54176-118">Activity Life Cycle</span></span>  

 <span data-ttu-id="54176-119">Экземпляр действия запускается в состоянии <xref:System.Activities.ActivityInstanceState.Executing>.</span><span class="sxs-lookup"><span data-stu-id="54176-119">An instance of an activity starts out in the <xref:System.Activities.ActivityInstanceState.Executing> state.</span></span> <span data-ttu-id="54176-120">Если исключения не обнаружены, экземпляр остается в этом состоянии до тех пор, пока дочерние действия и любые другие ожидающие операции (объекты <xref:System.Activities.Bookmark>, например) не завершены, после чего экземпляр переходит в состояние <xref:System.Activities.ActivityInstanceState.Closed>.</span><span class="sxs-lookup"><span data-stu-id="54176-120">Unless exceptions are encountered, it remains in this state until all child activities are finished executing and any other pending work (<xref:System.Activities.Bookmark> objects, for instance) is completed, at which point it transitions to the <xref:System.Activities.ActivityInstanceState.Closed> state.</span></span> <span data-ttu-id="54176-121">Родитель экземпляра действия может запросить прекращение работы дочернего действия; если дочернее действие может быть отменено, оно будет завершено в состоянии <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="54176-121">The parent of an activity instance can request a child to cancel; if the child is able to be canceled it completes in the <xref:System.Activities.ActivityInstanceState.Canceled> state.</span></span> <span data-ttu-id="54176-122">Если в ходе выполнения возникает исключение, среда выполнения переводит действие в состояние <xref:System.Activities.ActivityInstanceState.Faulted> и распространяет исключение по родительской цепочке действий.</span><span class="sxs-lookup"><span data-stu-id="54176-122">If an exception is thrown during execution, the runtime puts the activity into the <xref:System.Activities.ActivityInstanceState.Faulted> state and propagates the exception up the parent chain of activities.</span></span> <span data-ttu-id="54176-123">Ниже приведены три состояния завершения действия.</span><span class="sxs-lookup"><span data-stu-id="54176-123">The following are the three completion states of an activity:</span></span>
  
- <span data-ttu-id="54176-124">**Закрыто:** Действие завершило свою работу и завершило работу.</span><span class="sxs-lookup"><span data-stu-id="54176-124">**Closed:** The activity has completed its work and exited.</span></span>  
  
- <span data-ttu-id="54176-125">**Отменено:** Действие корректно отказало свою работу и завершило работу.</span><span class="sxs-lookup"><span data-stu-id="54176-125">**Canceled:** The activity has gracefully abandoned its work and exited.</span></span> <span data-ttu-id="54176-126">При переходе в это состояние откат операции не будет выполнен явным образом.</span><span class="sxs-lookup"><span data-stu-id="54176-126">Work is not explicitly rolled back when this state is entered.</span></span>  
  
- <span data-ttu-id="54176-127">**Сбой:** Действие обнаружило ошибку и завершило работу без завершения его работы.</span><span class="sxs-lookup"><span data-stu-id="54176-127">**Faulted:** The activity has encountered an error and has exited without completing its work.</span></span>  
  
 <span data-ttu-id="54176-128">Во время сохранения или выгрузки действия остаются в состоянии <xref:System.Activities.ActivityInstanceState.Executing>.</span><span class="sxs-lookup"><span data-stu-id="54176-128">Activities remain in the <xref:System.Activities.ActivityInstanceState.Executing> state when they are persisted or unloaded.</span></span>
