---
title: Безопасность рабочих процессов
ms.date: 03/30/2017
helpviewer_keywords:
- programming [WF], workflow security
ms.assetid: d712a566-f435-44c0-b8c0-49298e84b114
ms.openlocfilehash: 6253a0d76d8b1db938e789f19d2cdd5abba9b700
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96273897"
---
# <a name="workflow-security"></a><span data-ttu-id="a02f8-102">Безопасность рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="a02f8-102">Workflow Security</span></span>

<span data-ttu-id="a02f8-103">Windows Workflow Foundation (WF) интегрируется с несколькими различными технологиями, такими как Microsoft SQL Server и Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="a02f8-103">Windows Workflow Foundation (WF) is integrated with several different technologies, such as Microsoft SQL Server and Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="a02f8-104">В случае неправильной настройки взаимодействие с этими технологиями может вызвать проблемы безопасности в рабочем процессе.</span><span class="sxs-lookup"><span data-stu-id="a02f8-104">Interacting with these technologies may introduce security issues into your workflow if done improperly.</span></span>

## <a name="persistence-security-concerns"></a><span data-ttu-id="a02f8-105">Вопросы безопасности сохраняемости</span><span class="sxs-lookup"><span data-stu-id="a02f8-105">Persistence Security Concerns</span></span>

1. <span data-ttu-id="a02f8-106">Рабочие процессы, которые используют действия <xref:System.Activities.Statements.Delay> и сохраняемость, должны повторно активироваться службой.</span><span class="sxs-lookup"><span data-stu-id="a02f8-106">Workflows that use a <xref:System.Activities.Statements.Delay> activity and persistence need to be reactivated by a service.</span></span> <span data-ttu-id="a02f8-107">Windows AppFabric использует службу Workflow Management Service (WMS) для повторной активации рабочих процессов с истекшими таймерами.</span><span class="sxs-lookup"><span data-stu-id="a02f8-107">Windows AppFabric uses the Workflow Management Service (WMS) to reactivate workflows with expired timers.</span></span> <span data-ttu-id="a02f8-108">WMS создает объект <xref:System.ServiceModel.WorkflowServiceHost> для размещения повторно активированного рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="a02f8-108">WMS creates a <xref:System.ServiceModel.WorkflowServiceHost> to host the reactivated workflow.</span></span> <span data-ttu-id="a02f8-109">Если служба WMS остановлена, сохраненные рабочие процессы не будут активироваться повторно при истечении их таймеров.</span><span class="sxs-lookup"><span data-stu-id="a02f8-109">If the WMS service is stopped, persisted workflows will not be reactivated when their timers expire.</span></span>

2. <span data-ttu-id="a02f8-110">Доступ к устойчивым экземплярам должен быть защищен от вредоносных сущностей, внешних относительно домена приложения.</span><span class="sxs-lookup"><span data-stu-id="a02f8-110">Access to durable instancing should be protected against malicious entities external to the application domain.</span></span> <span data-ttu-id="a02f8-111">Кроме того, разработчики должны гарантировать, что вредоносный код будет невозможно выполнить в том же домене приложения, что и код устойчивого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a02f8-111">In addition, developers should ensure that malicious code can't be executed in the same application domain as the durable instancing code.</span></span>

3. <span data-ttu-id="a02f8-112">Устойчивый экземпляр не должен выполняться с разрешениями более высокого уровня (администратора).</span><span class="sxs-lookup"><span data-stu-id="a02f8-112">Durable instancing should not be run with elevated (Administrator) permissions.</span></span>

4. <span data-ttu-id="a02f8-113">Данные, обрабатываемые за пределами домена приложения, должны быть защищены.</span><span class="sxs-lookup"><span data-stu-id="a02f8-113">Data being processed outside the application domain should be protected.</span></span>

5. <span data-ttu-id="a02f8-114">Приложения, требующие изоляции безопасности, не должны использовать совместно один и тот же экземпляр абстракции схемы.</span><span class="sxs-lookup"><span data-stu-id="a02f8-114">Applications that require security isolation should not share the same instance of the schema abstraction.</span></span> <span data-ttu-id="a02f8-115">Такие приложения должны использовать различные поставщики хранилищ или поставщики хранилищ, настроенные на создание разных экземпляров хранилищ.</span><span class="sxs-lookup"><span data-stu-id="a02f8-115">Such applications should use different store providers, or store providers configured to use different store instantiations.</span></span>

## <a name="sql-server-security-concerns"></a><span data-ttu-id="a02f8-116">Вопросы безопасности SQL Server</span><span class="sxs-lookup"><span data-stu-id="a02f8-116">SQL Server Security Concerns</span></span>

- <span data-ttu-id="a02f8-117">Если используется большое количество дочерних действий, расположений, закладок, расширений узла и областей или используются закладки с очень большим объемом полезных нагрузок, может быть исчерпана память или во время сохранения будет выделен чрезмерно большой объем пространства базы данных.</span><span class="sxs-lookup"><span data-stu-id="a02f8-117">When large numbers of child activities, locations, bookmarks, host extensions, or scopes are used, or when bookmarks with very large payloads are used, memory can be exhausted, or undue amounts of database space can be allocated during persistence.</span></span> <span data-ttu-id="a02f8-118">Избежать этого можно с помощью мер безопасности на уровне объекта и на уровне базы данных.</span><span class="sxs-lookup"><span data-stu-id="a02f8-118">This can be mitigated by using object-level and database-level security.</span></span>

- <span data-ttu-id="a02f8-119">Если используется <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, хранилище экземпляров должно быть защищено.</span><span class="sxs-lookup"><span data-stu-id="a02f8-119">When using <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, the instance store must be secured.</span></span>

- <span data-ttu-id="a02f8-120">Конфиденциальные данные в хранилище экземпляров должны быть зашифрованы.</span><span class="sxs-lookup"><span data-stu-id="a02f8-120">Sensitive data in the instance store should be encrypted.</span></span> <span data-ttu-id="a02f8-121">Дополнительные сведения см. в статье [SQL Server Encryption](/sql/relational-databases/security/encryption/sql-server-encryption).</span><span class="sxs-lookup"><span data-stu-id="a02f8-121">For more information, see [SQL Server Encryption](/sql/relational-databases/security/encryption/sql-server-encryption).</span></span>

- <span data-ttu-id="a02f8-122">Так как строка подключения базы данных часто содержится в файле конфигурации, следует использовать безопасность уровня Windows (ACL) для обеспечения защиты файла конфигурации (обычно это Web.Config), а также для того, чтобы гарантировать, что сведения об имени входа и пароле не содержатся в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="a02f8-122">Since the database connection string is often included in a configuration file, windows-level security (ACL) should be used to ensure that the configuration file (Web.Config usually) is secure, and that login and password information are not included in the connection string.</span></span> <span data-ttu-id="a02f8-123">В качестве альтернативы между базой данных и веб-сервером можно использовать аутентификацию Windows.</span><span class="sxs-lookup"><span data-stu-id="a02f8-123">Windows authentication should be used between the database and the web server instead.</span></span>

## <a name="considerations-for-workflowservicehost"></a><span data-ttu-id="a02f8-124">Рекомендации по WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="a02f8-124">Considerations for WorkflowServiceHost</span></span>

- <span data-ttu-id="a02f8-125">Конечные точки Windows Communication Foundation (WCF), используемые в рабочих процессах, должны быть защищены.</span><span class="sxs-lookup"><span data-stu-id="a02f8-125">Windows Communication Foundation (WCF) endpoints used in workflows should be secured.</span></span> <span data-ttu-id="a02f8-126">Дополнительные сведения см. в статье [Общие сведения о безопасности WCF](../wcf/feature-details/security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a02f8-126">For more information, see [WCF Security Overview](../wcf/feature-details/security-overview.md).</span></span>

- <span data-ttu-id="a02f8-127">Авторизацию на уровне узлов можно реализовать с помощью <xref:System.ServiceModel.ServiceAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="a02f8-127">Host-level authorization can be implemented by using <xref:System.ServiceModel.ServiceAuthorizationManager>.</span></span> <span data-ttu-id="a02f8-128">Дополнительные сведения см. [в разделе как создать пользовательский диспетчер авторизации для службы](../wcf/extending/how-to-create-a-custom-authorization-manager-for-a-service.md) .</span><span class="sxs-lookup"><span data-stu-id="a02f8-128">See [How To: Create a Custom Authorization Manager for a Service](../wcf/extending/how-to-create-a-custom-authorization-manager-for-a-service.md) for details.</span></span>

- <span data-ttu-id="a02f8-129">Кроме того, контекст ServiceSecurityContext для входящего сообщения доступен из рабочего процесса посредством доступа к OperationContext.</span><span class="sxs-lookup"><span data-stu-id="a02f8-129">The ServiceSecurityContext for the incoming message is also available from within workflow by accessing OperationContext.</span></span>

## <a name="wf-security-pack-ctp"></a><span data-ttu-id="a02f8-130">Пакет безопасности WF CTP</span><span class="sxs-lookup"><span data-stu-id="a02f8-130">WF Security Pack CTP</span></span>

 <span data-ttu-id="a02f8-131">CTP-версия 1 представляет собой набор действий и их реализацию на основе [Windows Workflow Foundation](index.md) в [.NET Framework 4](/previous-versions/dotnet/netframework-4.0/w0x726c2(v=vs.100)) (WF 4) и [Windows Identity Foundation (WIF)](/previous-versions/dotnet/framework/security/index).</span><span class="sxs-lookup"><span data-stu-id="a02f8-131">The Microsoft WF Security Pack community technology preview (CTP) 1 is a set of activities and their implementation based on [Windows Workflow Foundation](index.md) in [.NET Framework 4](/previous-versions/dotnet/netframework-4.0/w0x726c2(v=vs.100)) (WF 4) and [Windows Identity Foundation (WIF)](/previous-versions/dotnet/framework/security/index).</span></span> <span data-ttu-id="a02f8-132">Пакет безопасности Microsoft WF CTP 1 содержит действия и их конструкторы, которые демонстрируют простое включение различных сценариев обеспечения безопасности с помощью рабочих процессов, в том числе следующие:</span><span class="sxs-lookup"><span data-stu-id="a02f8-132">The Microsoft WF Security Pack CTP 1 contains both activities and their designers which illustrate how to easily enable various security-related scenarios using workflow, including:</span></span>

1. <span data-ttu-id="a02f8-133">Олицетворение удостоверения клиента в рабочем процессе</span><span class="sxs-lookup"><span data-stu-id="a02f8-133">Impersonating a client identity in the workflow</span></span>

2. <span data-ttu-id="a02f8-134">Авторизация в рабочих процессах, например PrincipalPermission и проверка утверждений</span><span class="sxs-lookup"><span data-stu-id="a02f8-134">In-workflow authorization, such as PrincipalPermission and validation of Claims</span></span>

3. <span data-ttu-id="a02f8-135">Обмен сообщениями с использованием проверки подлинности (с применением определенных в рабочем процессе ClientCredentials), например с использованием имени пользователя и пароля или токена, полученного от службы токенов безопасности (STS)</span><span class="sxs-lookup"><span data-stu-id="a02f8-135">Authenticated messaging using ClientCredentials specified in the workflow, such as username/password or a token retrieved from a Security Token Service (STS)</span></span>

4. <span data-ttu-id="a02f8-136">Сквозная передача токена безопасности клиента внутренней службе (делегирование на основе утверждений) с помощью WS-Trust ActAs</span><span class="sxs-lookup"><span data-stu-id="a02f8-136">Flowing a client security token to a back-end service (claims-based delegation) using WS-Trust ActAs</span></span>

<span data-ttu-id="a02f8-137">Дополнительные сведения и о скачивании пакета безопасности WF CTP см. в статье [пакет безопасности WF CTP](https://archive.codeplex.com/?p=wf)</span><span class="sxs-lookup"><span data-stu-id="a02f8-137">For more information and to download the WF Security Pack CTP, see: [WF Security Pack CTP](https://archive.codeplex.com/?p=wf)</span></span>
