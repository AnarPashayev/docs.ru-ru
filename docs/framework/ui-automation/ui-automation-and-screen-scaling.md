---
title: Модель автоматизации пользовательского интерфейса и масштабирование экрана
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- scaling, screens
- screens, scaling
- UI (user interface), automation
- UI Automation
ms.assetid: 4380cad7-e509-448f-b9a5-6de042605fd4
ms.openlocfilehash: 2a68a74fa6aadcaba21f142d394a1f8a3d8af371
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79179966"
---
# <a name="ui-automation-and-screen-scaling"></a>Модель автоматизации пользовательского интерфейса и масштабирование экрана
> [!NOTE]
> Эта документация предназначена для разработчиков .NET Framework, желающих использовать управляемые классы [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] , заданные в пространстве имен <xref:System.Windows.Automation> . Последние сведения о [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]см. в разделе [API автоматизации Windows. Автоматизация пользовательского интерфейса](/windows/win32/winauto/entry-uiauto-win32).  
  
Начиная с Windows Vista, Windows позволяет пользователям изменять точки на дюйм (dpi) настройки, так что большинство элементов пользовательского интерфейса (Пользовательского интерфейса) на экране появляются больше. Хотя эта функция уже давно доступна в Windows, в предыдущих версиях масштабирование должно было быть реализовано приложениями. Начиная с Windows Vista, desktop Window Manager выполняет масштабирование по умолчанию для всех приложений, которые не обрабатывают их собственное масштабирование. Клиентские приложения модели автоматизации пользовательского интерфейса должны учитывать эту функцию.  
  
<a name="Scaling_in_Windows_Vista"></a>
## <a name="scaling-in-windows-vista"></a>Масштабирование в Windows Vista  
 По умолчанию dpi настройка 96, что означает, что 96 пикселей занимают ширину или высоту одного условного дюйма. Точный размер "дюйма" зависит от размера и физического разрешения монитора. Например, на мониторе шириной в 12 дюймов при горизонтальном разрешении в 1280 пикселей горизонтальная линия в 96 пикселей имеет протяженность около 9/10 дюйма.  
  
 Изменение настройки dpi не то же самое, что изменение разрешения экрана. При масштабировании dpi количество физических пикселей на экране остается прежним. Однако масштабирование применяется к размеру и расположению элементов [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] . Это масштабирование может автоматически выполняться диспетчером окон рабочего стола для рабочего стола и для приложений, в которых не указан явный запрет на масштабирование.  
  
 По сути, когда пользователь устанавливает коэффициент масштаба до 120 dpi, вертикальный или горизонтальный дюйм на экране становится больше на 25 процентов. Все измерения масштабируются согласованно. Смещение окна приложения от верхнего и левого краев экрана увеличивается на 25 процентов. Если масштабирование приложения включено и приложение не является осведомленным, размер окна увеличивается в той же пропорции, [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] наряду с смещениями и размерами всех элементов, которые он содержит.  
  
> [!NOTE]
> По умолчанию DWM не выполняет масштабирование для приложений, не знающих dpi, когда пользователь устанавливает dpi до 120, но выполняет его, когда dpi установлен на пользовательское значение 144 или выше. Тем не менее пользователь может переопределить поведение по умолчанию.  
  
 Масштабирование экрана создает новые проблемы для приложений, которые каким-либо образом связаны с экранными координатами. Теперь экран содержит две системы координат: физическую и логическую. Физические координаты точки являются фактическим смещением в пикселях от верхнего левого угла начала координат. Логические координаты — это смещения, какими они были бы, если бы сами пиксели масштабировались.  
  
 Предположим, вы разрабатываете диалоговое окно с кнопкой, имеющей координаты (100, 48). Когда этот диалоговый ящик отображается по умолчанию 96 dpi, кнопка находится в физических координатах (100, 48). На 120 dpi, он расположен в физических координатах (125, 60). Но логические координаты одинаковы при любом депо: (100, 48).  
  
 Логические координаты важны, потому что они делают поведение операционной системы и приложений последовательным независимо от настройки dpi. Например, <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType> обычно возвращает логические координаты. При перемещении курсора по элементу в диалоговом поле те же координаты возвращаются независимо от настройки dpi. Если вы нарисуете элемент управления на уровне (100, 100), он обращается к этим логическим координатам, и будет занимать ту же относительную позицию в любом параметре dpi.  
  
<a name="Scaling_in_UI_Automation_Clients"></a>
## <a name="scaling-in-ui-automation-clients"></a>Масштабирование в клиентах автоматизации пользовательского интерфейса  
 [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] API не использует логические координаты. Следующие методы и свойства либо возвращают физические координаты, либо принимают их в качестве параметров.  
  
- <xref:System.Windows.Automation.AutomationElement.GetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.TryGetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.ClickablePointProperty>  
  
- <xref:System.Windows.Automation.AutomationElement.FromPoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.AutomationElementInformation.BoundingRectangle%2A>  
  
 По умолчанию клиентское приложение UI Automation, работая в среде non-96- dpi, не сможет получить правильные результаты этих методов и свойств. Например, поскольку положение курсора определяется в логических координатах, клиент не может просто передать эти координаты в метод <xref:System.Windows.Automation.AutomationElement.FromPoint%2A> , чтобы получить элемент, находящийся под курсором. Кроме того, такое приложение не сможет правильно разместить окна за пределами клиентской области.  
  
 Решение состоит из двух частей.  
  
1. Во-первых, сделать клиент скоеприложение dpi-aware. Для этого позвоните в функцию `SetProcessDPIAware` Win32 при запуске. В управляемом коде следующее объявление сделает эту функцию доступной.  
  
     [!code-csharp[Highlighter#101](../../../samples/snippets/csharp/VS_Snippets_Wpf/Highlighter/CSharp/NativeMethods.cs#101)]
     [!code-vb[Highlighter#101](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/Highlighter/VisualBasic/NativeMethods.vb#101)]  
  
     Эта функция делает весь процесс dpi-aware, намереваясь что все окна которые принадлежат к процессу unscaled. Например, в [Highlighter Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter)четыре окна, которые составляют прямоугольник выделения, расположены в физических координатах, полученных из автоматизации uI, а не на логических координатах. Если бы образец не был dpi-aware, то изюминка была бы нарисована на логических координатах на настольном компьютере, что привело бы к неправильному размещению в среде non-96- dpi.  
  
2. Чтобы получить координаты курсора, `GetPhysicalCursorPos`позвоните в функцию Win32. В следующем примере показано, как объявлять и использовать эту функцию.  
  
     [!code-csharp[UIAClient_snip#185](../../../samples/snippets/csharp/VS_Snippets_Wpf/UIAClient_snip/CSharp/ClientForm.cs#185)]
     [!code-vb[UIAClient_snip#185](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UIAClient_snip/VisualBasic/ClientForm.vb#185)]  
  
> [!CAUTION]
> Не используйте <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType>. Поведение этого свойства вне клиентских окон в масштабируемой среде не определено.  
  
 Если приложение выполняет прямую перекрестную связь с приложениями, не осведомленными о не-dpi, возможно, `PhysicalToLogicalPoint` `LogicalToPhysicalPoint`конвертировать между логическими и физическими координатами с помощью функций Win32 и .  
  
## <a name="see-also"></a>См. также раздел

- [Highlighter Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter)
