---
title: Модель автоматизации пользовательского интерфейса и масштабирование экрана
description: Узнайте, как Windows и автоматизация пользовательского интерфейса выполняют масштабирование экрана. DWM выполняет масштабирование по умолчанию для всех приложений, которые должны учитывать клиентские приложения автоматизации пользовательского интерфейса.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- scaling, screens
- screens, scaling
- UI (user interface), automation
- UI Automation
ms.assetid: 4380cad7-e509-448f-b9a5-6de042605fd4
ms.openlocfilehash: cf8069f26b85318994aeeb47d42ad28a3a33834a
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96262532"
---
# <a name="ui-automation-and-screen-scaling"></a>Модель автоматизации пользовательского интерфейса и масштабирование экрана

> [!NOTE]
> Эта документация предназначена для разработчиков .NET Framework, желающих использовать управляемые классы [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] , заданные в пространстве имен <xref:System.Windows.Automation> . Последние сведения о [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)]см. в разделе [API автоматизации Windows. Автоматизация пользовательского интерфейса](/windows/win32/winauto/entry-uiauto-win32).  
  
Начиная с Windows Vista, Windows позволяет пользователям изменять параметр точек на дюйм (DPI), чтобы большинство элементов пользовательского интерфейса на экране отображались крупнее. Хотя эта функция в течение длительного времени была доступна в Windows, в предыдущих версиях масштабирование пришлось бы реализовать в приложениях. Начиная с Windows Vista, диспетчер окон рабочего стола выполняет масштабирование по умолчанию для всех приложений, которые не обрабатывали собственное масштабирование. Клиентские приложения модели автоматизации пользовательского интерфейса должны учитывать эту функцию.  
  
<a name="Scaling_in_Windows_Vista"></a>

## <a name="scaling-in-windows-vista"></a>Масштабирование в Windows Vista  

 Значение dpi по умолчанию — 96. Это означает, что 96 пикселов занимают ширину или высоту на одном определенном дюйме. Точный размер "дюйма" зависит от размера и физического разрешения монитора. Например, на мониторе шириной в 12 дюймов при горизонтальном разрешении в 1280 пикселей горизонтальная линия в 96 пикселей имеет протяженность около 9/10 дюйма.  
  
 Изменение параметра dpi отличается от изменения разрешения экрана. При масштабировании dpi количество физических пикселей на экране остается неизменным. Однако масштабирование применяется к размеру и расположению элементов [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] . Это масштабирование может автоматически выполняться диспетчером окон рабочего стола для рабочего стола и для приложений, в которых не указан явный запрет на масштабирование.  
  
 Фактически, когда пользователь устанавливает коэффициент масштабирования 120 dpi, вертикальный или горизонтальный дюйм на экране станет больше 25%. Все измерения масштабируются согласованно. Смещение окна приложения от верхнего и левого краев экрана увеличивается на 25 процентов. Если масштабирование приложений включено и приложение не учитывает dpi, размер окна увеличивается в той же пропорции, а также смещения и размеров всех элементов, которые [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] он содержит.  
  
> [!NOTE]
> По умолчанию DWM не выполняет масштабирование для приложений, не поддерживающих dpi, когда пользователь устанавливает значение dpi равным 120, но выполняет его, если для dpi задано пользовательское число 144 или выше. Тем не менее пользователь может переопределить поведение по умолчанию.  
  
 Масштабирование экрана создает новые проблемы для приложений, которые каким-либо образом связаны с экранными координатами. Теперь экран содержит две системы координат: физическую и логическую. Физические координаты точки являются фактическим смещением в пикселях от верхнего левого угла начала координат. Логические координаты — это смещения, какими они были бы, если бы сами пиксели масштабировались.  
  
 Предположим, вы разрабатываете диалоговое окно с кнопкой, имеющей координаты (100, 48). Когда это диалоговое окно отображается по умолчанию 96 dpi, кнопка находится в расположениях с физическими координатами (100, 48). В 120 dpi он находится в физических координатах (125, 60). Однако логические координаты одинаковы при любом значении DPI: (100, 48).  
  
 Логические координаты важны, так как они делают поведение операционной системы и приложений совместимым, независимо от параметра dpi. Например, <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType> обычно возвращает логические координаты. При перемещении курсора по элементу в диалоговом окне возвращаются одни и те же координаты независимо от параметра dpi. Если нарисовать элемент управления в (100, 100), он выводится на эти логические координаты и будет занимать ту же относительную точку при любом значении DPI.  
  
<a name="Scaling_in_UI_Automation_Clients"></a>

## <a name="scaling-in-ui-automation-clients"></a>Масштабирование в клиентах автоматизации пользовательского интерфейса  

 В [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] API не используются логические координаты. Следующие методы и свойства либо возвращают физические координаты, либо принимают их в качестве параметров.  
  
- <xref:System.Windows.Automation.AutomationElement.GetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.TryGetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.ClickablePointProperty>  
  
- <xref:System.Windows.Automation.AutomationElement.FromPoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.AutomationElementInformation.BoundingRectangle%2A>  
  
 По умолчанию клиентское приложение автоматизации пользовательского интерфейса, работающее в среде без 96 dpi, не сможет получить правильные результаты из этих методов и свойств. Например, поскольку положение курсора определяется в логических координатах, клиент не может просто передать эти координаты в метод <xref:System.Windows.Automation.AutomationElement.FromPoint%2A> , чтобы получить элемент, находящийся под курсором. Кроме того, такое приложение не сможет правильно разместить окна за пределами клиентской области.  
  
 Решение состоит из двух частей.  
  
1. Во-первых, сделайте так, чтобы клиентское приложение было ориентировано на dpi. Для этого вызовите функцию Win32 `SetProcessDPIAware` при запуске. В управляемом коде следующее объявление сделает эту функцию доступной.  
  
     [!code-csharp[Highlighter#101](../../../samples/snippets/csharp/VS_Snippets_Wpf/Highlighter/CSharp/NativeMethods.cs#101)]
     [!code-vb[Highlighter#101](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/Highlighter/VisualBasic/NativeMethods.vb#101)]  
  
     Эта функция выполняет весь процесс, учитывающий dpi, что означает, что все окна, принадлежащие процессу, не масштабируются. Например, в [образце маркера](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter)четыре окна, составляющие прямоугольник выделения, расположены в физических координатах, полученных из модели автоматизации пользовательского интерфейса, а не логических координат. Если в примере не учитывается dpi, выделение будет выводиться по логическим координатам на рабочем столе, что привело бы к неправильному размещению в среде, отличной от 96 dpi.  
  
2. Чтобы получить координаты курсора, вызовите функцию Win32 `GetPhysicalCursorPos` . В следующем примере показано, как объявлять и использовать эту функцию.  
  
     [!code-csharp[UIAClient_snip#185](../../../samples/snippets/csharp/VS_Snippets_Wpf/UIAClient_snip/CSharp/ClientForm.cs#185)]
     [!code-vb[UIAClient_snip#185](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UIAClient_snip/VisualBasic/ClientForm.vb#185)]  
  
> [!CAUTION]
> Не используйте <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType>. Поведение этого свойства вне клиентских окон в масштабируемой среде не определено.  
  
 Если приложение выполняет прямое межпроцессное взаимодействие с приложениями, не поддерживающими разрешение dpi, возможно преобразование между логическими и физическими координатами с помощью функций Win32 `PhysicalToLogicalPoint` и `LogicalToPhysicalPoint` .  
  
## <a name="see-also"></a>См. также

- [Highlighter Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter)
