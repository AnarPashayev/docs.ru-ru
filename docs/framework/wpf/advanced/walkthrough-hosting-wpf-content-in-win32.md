---
title: Пошаговое руководство. Размещение содержимого WPF в Win32
ms.date: 03/30/2017
dev_langs:
- cpp
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
ms.assetid: 38ce284a-4303-46dd-b699-c9365b22a7dc
ms.openlocfilehash: 01ac0e2cafc704b64634f1fb36145387b49c34a0
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64650785"
---
# <a name="walkthrough-hosting-wpf-content-in-win32"></a><span data-ttu-id="2603e-102">Пошаговое руководство. Размещение содержимого WPF в Win32</span><span class="sxs-lookup"><span data-stu-id="2603e-102">Walkthrough: Hosting WPF Content in Win32</span></span>
<span data-ttu-id="2603e-103">Служба [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] предоставляет среду с широкими возможностями для создания приложений.</span><span class="sxs-lookup"><span data-stu-id="2603e-103">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] provides a rich environment for creating applications.</span></span> <span data-ttu-id="2603e-104">Однако если вы существенно потратились на код [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)], то добавление функциональности [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в ваше приложение может быть более эффективно, чем переписывание исходного кода.</span><span class="sxs-lookup"><span data-stu-id="2603e-104">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to add [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] functionality to your application rather than rewriting your original code.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="2603e-105">предоставляет простой механизм для размещения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-105">provides a straightforward mechanism for hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span>  
  
 <span data-ttu-id="2603e-106">Этом руководстве описывается создание примера приложения, [размещения содержимого WPF в окне Win32](https://go.microsoft.com/fwlink/?LinkID=160004), в котором узлы [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-106">This tutorial describes how to write a sample application, [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004), that hosts [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="2603e-107">Вы можете расширить этот пример для размещения любого окна [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-107">You can extend this sample to host any [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="2603e-108">Поскольку этот пример включает смешанный управляемый и неуправляемый код, приложение создается на [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-108">Because it involves mixing managed and unmanaged code, the application is written in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span>  

<a name="requirements"></a>   
## <a name="requirements"></a><span data-ttu-id="2603e-109">Требования</span><span class="sxs-lookup"><span data-stu-id="2603e-109">Requirements</span></span>  
 <span data-ttu-id="2603e-110">В этом учебнике предполагается, что вы знакомы с основами программирования в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-110">This tutorial assumes a basic familiarity with both [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming.</span></span> <span data-ttu-id="2603e-111">Основные сведения о [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] программирования, см. в разделе [Приступая к работе](../getting-started/index.md).</span><span class="sxs-lookup"><span data-stu-id="2603e-111">For a basic introduction to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming, see [Getting Started](../getting-started/index.md).</span></span> <span data-ttu-id="2603e-112">Общие сведения о [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] программирования, следует ссылаться на любой из многочисленных книг по этой теме, в частности *программирования Windows* Чарльза Петцольда.</span><span class="sxs-lookup"><span data-stu-id="2603e-112">For an introduction to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming, you should reference any of the numerous books on the subject, in particular *Programming Windows* by Charles Petzold.</span></span>  
  
 <span data-ttu-id="2603e-113">Так как пример, сопровождающий этот учебник, реализован в [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], это руководство предполагает знакомство с использованием [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] программу [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] а также понимание программирования управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="2603e-113">Because the sample that accompanies this tutorial is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], this tutorial assumes familiarity with the use of [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] to program the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] plus an understanding of managed code programming.</span></span> <span data-ttu-id="2603e-114">Знакомство с [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] желательно, но не обязательно.</span><span class="sxs-lookup"><span data-stu-id="2603e-114">Familiarity with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] is helpful but not essential.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2603e-115">Этот учебник включает ряд примеров кода из связанного образца приложения.</span><span class="sxs-lookup"><span data-stu-id="2603e-115">This tutorial includes a number of code examples from the associated sample.</span></span> <span data-ttu-id="2603e-116">Однако для удобства чтения он не содержит полный пример кода.</span><span class="sxs-lookup"><span data-stu-id="2603e-116">However, for readability, it does not include the complete sample code.</span></span> <span data-ttu-id="2603e-117">Полный образец кода, см. в разделе [размещение содержимого WPF в окне Win32](https://go.microsoft.com/fwlink/?LinkID=160004).</span><span class="sxs-lookup"><span data-stu-id="2603e-117">For the complete sample code, see [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004).</span></span>  
  
<a name="basic_procedure"></a>   
## <a name="the-basic-procedure"></a><span data-ttu-id="2603e-118">Основная процедура</span><span class="sxs-lookup"><span data-stu-id="2603e-118">The Basic Procedure</span></span>  
 <span data-ttu-id="2603e-119">В этом разделе описаны основные процедуру, используемую для узла [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-119">This section outlines the basic procedure you use to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="2603e-120">В остальных разделах подробно описывается каждый шаг.</span><span class="sxs-lookup"><span data-stu-id="2603e-120">The remaining sections explain the details of each step.</span></span>  
  
 <span data-ttu-id="2603e-121">Ключом к размещению [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окно <xref:System.Windows.Interop.HwndSource> класса.</span><span class="sxs-lookup"><span data-stu-id="2603e-121">The key to hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="2603e-122">Этот класс заключает [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окно, в котором она должна быть включена в ваш [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] как дочернего окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-122">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, allowing it to be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="2603e-123">Следующий подход объединяет [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] и [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в одном приложении.</span><span class="sxs-lookup"><span data-stu-id="2603e-123">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1. <span data-ttu-id="2603e-124">Реализуйте вашей [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое в виде управляемого класса.</span><span class="sxs-lookup"><span data-stu-id="2603e-124">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a managed class.</span></span>  
  
2. <span data-ttu-id="2603e-125">Реализуйте приложение [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] с помощью [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-125">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="2603e-126">Если вы начинаете с существующего приложения и неуправляемого кода [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)], то обычно можете позволить приложению вызывать управляемый код, изменив параметры проекта, чтобы включить флаг компилятора `/clr`.</span><span class="sxs-lookup"><span data-stu-id="2603e-126">If you are starting with an existing application and unmanaged [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] code, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag.</span></span>  
  
3. <span data-ttu-id="2603e-127">Установите в качестве потоковой модели однопотоковое подразделение (STA).</span><span class="sxs-lookup"><span data-stu-id="2603e-127">Set the threading model to single-threaded apartment (STA).</span></span>  
  
4. <span data-ttu-id="2603e-128">Обрабатывать [WM_CREATE](/windows/desktop/winmsg/wm-create)уведомления в процедуре окна и выполните следующее:</span><span class="sxs-lookup"><span data-stu-id="2603e-128">Handle the [WM_CREATE](/windows/desktop/winmsg/wm-create)notification in your window procedure and do the following:</span></span>  
  
    1. <span data-ttu-id="2603e-129">Создайте новый объект <xref:System.Windows.Interop.HwndSource> с родительским окном в качестве его параметра `parent`.</span><span class="sxs-lookup"><span data-stu-id="2603e-129">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window as its `parent` parameter.</span></span>  
  
    2. <span data-ttu-id="2603e-130">Создайте экземпляр вашего класса содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-130">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3. <span data-ttu-id="2603e-131">Назначьте ссылку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] объект содержимого <xref:System.Windows.Interop.HwndSource.RootVisual%2A> свойство <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="2603e-131">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>  
  
    4. <span data-ttu-id="2603e-132">Получите HWND для содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-132">Get the HWND for the content.</span></span> <span data-ttu-id="2603e-133">Свойство <xref:System.Windows.Interop.HwndSource.Handle%2A> объекта <xref:System.Windows.Interop.HwndSource> содержит дескриптор окна (HWND).</span><span class="sxs-lookup"><span data-stu-id="2603e-133">The <xref:System.Windows.Interop.HwndSource.Handle%2A> property of the <xref:System.Windows.Interop.HwndSource> object contains the window handle (HWND).</span></span> <span data-ttu-id="2603e-134">Чтобы получить HWND, который можно использовать в неуправляемой части приложения, приведите `Handle.ToPointer()` к HWND.</span><span class="sxs-lookup"><span data-stu-id="2603e-134">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
5. <span data-ttu-id="2603e-135">Реализуйте управляемый класс, содержащий статическое поле для хранения ссылки на ваше содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-135">Implement a managed class that contains a static field to hold a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-136">Этот класс позволяет получить ссылку на содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] из вашего кода [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-136">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
6. <span data-ttu-id="2603e-137">Назначьте содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] этому статическому полю.</span><span class="sxs-lookup"><span data-stu-id="2603e-137">Assign the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the static field.</span></span>  
  
7. <span data-ttu-id="2603e-138">Получайте уведомления от [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого путем присоединения обработчика к одному или нескольким из [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] события.</span><span class="sxs-lookup"><span data-stu-id="2603e-138">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events.</span></span>  
  
8. <span data-ttu-id="2603e-139">Взаимодействуйте с содержимым [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] с помощью ссылки, которую вы сохранили в статическом поле, для задания свойств и т. д.</span><span class="sxs-lookup"><span data-stu-id="2603e-139">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by using the reference that you stored in the static field to set properties, and so on.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2603e-140">Можно также использовать [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] для реализации вашей [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-140">You can also use [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] to implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-141">Однако его необходимо компилировать отдельно как [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] и ссылаться на эту [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] из своего приложения [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-141">However, you will have to compile it separately as a [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] and reference that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="2603e-142">Оставшаяся часть процедуры аналогична описанной выше.</span><span class="sxs-lookup"><span data-stu-id="2603e-142">The remainder of the procedure is similar to that outlined above.</span></span>

<a name="implementing_the_application"></a>
## <a name="implementing-the-host-application"></a><span data-ttu-id="2603e-143">Реализация ведущего приложения</span><span class="sxs-lookup"><span data-stu-id="2603e-143">Implementing the Host Application</span></span>
 <span data-ttu-id="2603e-144">В этом разделе описывается размещение [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в базовом [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] приложения.</span><span class="sxs-lookup"><span data-stu-id="2603e-144">This section describes how to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="2603e-145">Само содержимое реализуется в [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] как управляемый класс.</span><span class="sxs-lookup"><span data-stu-id="2603e-145">The content itself is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] as a managed class.</span></span> <span data-ttu-id="2603e-146">Большей частью это просто программирование [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-146">For the most part, it is straightforward [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming.</span></span> <span data-ttu-id="2603e-147">Ключевые аспекты реализации содержимого рассматриваются в [реализация содержимого WPF](#implementing_the_wpf_page).</span><span class="sxs-lookup"><span data-stu-id="2603e-147">The key aspects of the content implementation are discussed in [Implementing the WPF Content](#implementing_the_wpf_page).</span></span>

<a name="autoNestedSectionsOUTLINE1"></a>
- [<span data-ttu-id="2603e-148">Базовое приложение</span><span class="sxs-lookup"><span data-stu-id="2603e-148">The Basic Application</span></span>](#the_basic_application)

- [<span data-ttu-id="2603e-149">Размещение содержимого WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-149">Hosting the WPF Content</span></span>](#hosting_the_wpf_page)

- [<span data-ttu-id="2603e-150">Хранение ссылки на содержимое WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-150">Holding a Reference to the WPF Content</span></span>](#holding_a_reference)

- [<span data-ttu-id="2603e-151">Взаимодействие с содержимым WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-151">Communicating with the WPF Content</span></span>](#communicating_with_the_page)

<a name="the_basic_application"></a>
### <a name="the-basic-application"></a><span data-ttu-id="2603e-152">Базовое приложение</span><span class="sxs-lookup"><span data-stu-id="2603e-152">The Basic Application</span></span>
 <span data-ttu-id="2603e-153">Отправной точкой для ведущего приложения было создание шаблона Visual Studio 2005.</span><span class="sxs-lookup"><span data-stu-id="2603e-153">The starting point for the host application was to create a Visual Studio 2005 template.</span></span>

1. <span data-ttu-id="2603e-154">Откройте Visual Studio 2005 и выберите **новый проект** из **файл** меню.</span><span class="sxs-lookup"><span data-stu-id="2603e-154">Open Visual Studio 2005, and select **New Project** from the **File** menu.</span></span>

2. <span data-ttu-id="2603e-155">Выберите **Win32** из списка [!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)] типы проектов.</span><span class="sxs-lookup"><span data-stu-id="2603e-155">Select **Win32** from the list of [!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)] project types.</span></span> <span data-ttu-id="2603e-156">Если язык по умолчанию не [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], вы найдете эти типы проектов в разделе **другие языки**.</span><span class="sxs-lookup"><span data-stu-id="2603e-156">If your default language is not [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], you will find these project types under **Other Languages**.</span></span>

3. <span data-ttu-id="2603e-157">Выберите **проект Win32** шаблон, задайте имя для проекта и нажмите кнопку **ОК** для запуска **мастер приложений Win32**.</span><span class="sxs-lookup"><span data-stu-id="2603e-157">Select a **Win32 Project** template, assign a name to the project and click **OK** to launch the **Win32 Application Wizard**.</span></span>

4. <span data-ttu-id="2603e-158">Примите параметры мастера по умолчанию и нажмите кнопку **Готово** для запуска проекта.</span><span class="sxs-lookup"><span data-stu-id="2603e-158">Accept the wizard's default settings and click **Finish** to start the project.</span></span>

 <span data-ttu-id="2603e-159">Этот шаблон создает базовое приложение [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], включая:</span><span class="sxs-lookup"><span data-stu-id="2603e-159">The template creates a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application, including:</span></span>

- <span data-ttu-id="2603e-160">точку входа для приложения;</span><span class="sxs-lookup"><span data-stu-id="2603e-160">An entry point for the application.</span></span>

- <span data-ttu-id="2603e-161">окно со связанной процедурой окна (WndProc);</span><span class="sxs-lookup"><span data-stu-id="2603e-161">A window, with an associated window procedure (WndProc).</span></span>

- <span data-ttu-id="2603e-162">Меню с **файл** и **помочь** заголовки.</span><span class="sxs-lookup"><span data-stu-id="2603e-162">A menu with **File** and **Help** headings.</span></span> <span data-ttu-id="2603e-163">**Файл** меню имеет **выхода** элемента, который закрывает приложение.</span><span class="sxs-lookup"><span data-stu-id="2603e-163">The **File** menu has an **Exit** item that closes the application.</span></span> <span data-ttu-id="2603e-164">**Помочь** меню имеет **о** элемента, который запускает простое диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="2603e-164">The **Help** menu has an **About** item that launches a simple dialog box.</span></span>

 <span data-ttu-id="2603e-165">Прежде чем приступить к созданию кода для узла [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого, необходимо внести два изменения в этот базовый шаблон.</span><span class="sxs-lookup"><span data-stu-id="2603e-165">Before you start writing code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, you need to make two modifications to the basic template.</span></span>

 <span data-ttu-id="2603e-166">Сначала следует скомпилировать проект как управляемый код.</span><span class="sxs-lookup"><span data-stu-id="2603e-166">The first is to compile the project as managed code.</span></span> <span data-ttu-id="2603e-167">По умолчанию проект компилируется как неуправляемый код.</span><span class="sxs-lookup"><span data-stu-id="2603e-167">By default, the project compiles as unmanaged code.</span></span> <span data-ttu-id="2603e-168">Однако поскольку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] реализуется в управляемом коде, проект должен быть скомпилирован соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="2603e-168">However, because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is implemented in managed code, the project must be compiled accordingly.</span></span>

1. <span data-ttu-id="2603e-169">Щелкните правой кнопкой мыши имя проекта в **обозревателе решений** и выберите **свойства** в контекстном меню, чтобы запустить **страницы свойств** диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="2603e-169">Right-click the project name in **Solution Explorer** and select **Properties** from the context menu to launch the **Property Pages** dialog box.</span></span>

2. <span data-ttu-id="2603e-170">Выберите **свойства конфигурации** в представлении дерева в левой области.</span><span class="sxs-lookup"><span data-stu-id="2603e-170">Select **Configuration Properties** from the tree view in the left pane.</span></span>

3. <span data-ttu-id="2603e-171">Выберите **среда CLR** поддержку от **проекта по умолчанию** списка в правой области.</span><span class="sxs-lookup"><span data-stu-id="2603e-171">Select **Common Language Runtime** support from the **Project Defaults** list in the right pane.</span></span>

4. <span data-ttu-id="2603e-172">Выберите **Поддержка Common Language Runtime (/ clr)** из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="2603e-172">Select **Common Language Runtime Support (/clr)** from the drop-down list box.</span></span>

> [!NOTE]
>  <span data-ttu-id="2603e-173">Этот флаг компилятора позволяет использовать управляемый код в приложении, но ваш неуправляемый код будет продолжать компилироваться как раньше.</span><span class="sxs-lookup"><span data-stu-id="2603e-173">This compiler flag allows you to use managed code in your application, but your unmanaged code will still compile as before.</span></span>

 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="2603e-174">использует потоковую модель однопотокового подразделения (STA).</span><span class="sxs-lookup"><span data-stu-id="2603e-174">uses the single-threaded apartment (STA) threading model.</span></span> <span data-ttu-id="2603e-175">Чтобы правильно работать с [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого кода, вам необходимо установить потоковой модели приложения в STA путем применения атрибута к точке входа.</span><span class="sxs-lookup"><span data-stu-id="2603e-175">In order to work properly with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content code, you must set the application's threading model to STA by applying an attribute to the entry point.</span></span>

 [!code-cpp[Win32HostingWPFPage#WinMain](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#winmain)]

<a name="hosting_the_wpf_page"></a>
### <a name="hosting-the-wpf-content"></a><span data-ttu-id="2603e-176">Размещение содержимого WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-176">Hosting the WPF Content</span></span>
 <span data-ttu-id="2603e-177">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Содержимое является простым приложением ввода адреса.</span><span class="sxs-lookup"><span data-stu-id="2603e-177">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is a simple address entry application.</span></span> <span data-ttu-id="2603e-178">Оно состоит из нескольких элементов управления <xref:System.Windows.Controls.TextBox> для получения имени пользователя, адреса и т. д.</span><span class="sxs-lookup"><span data-stu-id="2603e-178">It consists of several <xref:System.Windows.Controls.TextBox> controls to take user name, address, and so on.</span></span> <span data-ttu-id="2603e-179">Существует также два <xref:System.Windows.Controls.Button> элементов управления, **ОК** и **отменить**.</span><span class="sxs-lookup"><span data-stu-id="2603e-179">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**.</span></span> <span data-ttu-id="2603e-180">Когда пользователь щелкает **ОК**, кнопки <xref:System.Windows.Controls.Primitives.ButtonBase.Click> обработчик событий собирает данные из <xref:System.Windows.Controls.TextBox> элементы управления, назначает его соответствующим свойствам и вызывает пользовательское событие, `OnButtonClicked`.</span><span class="sxs-lookup"><span data-stu-id="2603e-180">When the user clicks **OK**, the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler collects the data from the <xref:System.Windows.Controls.TextBox> controls, assigns it to corresponding properties, and raises a custom event, `OnButtonClicked`.</span></span> <span data-ttu-id="2603e-181">Когда пользователь щелкает **отменить**, обработчик просто вызывает `OnButtonClicked`.</span><span class="sxs-lookup"><span data-stu-id="2603e-181">When the user clicks **Cancel**, the handler simply raises `OnButtonClicked`.</span></span> <span data-ttu-id="2603e-182">Объект аргумента события для `OnButtonClicked` содержит логическое поле, которое указывает, какая кнопка была нажата.</span><span class="sxs-lookup"><span data-stu-id="2603e-182">The event argument object for `OnButtonClicked` contains a Boolean field that indicates which button was clicked.</span></span>

 <span data-ttu-id="2603e-183">Код для размещения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое реализуется в обработчике [WM_CREATE](/windows/desktop/winmsg/wm-create) уведомления в главном окне.</span><span class="sxs-lookup"><span data-stu-id="2603e-183">The code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in a handler for the [WM_CREATE](/windows/desktop/winmsg/wm-create) notification on the host window.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCreate](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcreate)]

 <span data-ttu-id="2603e-184">`GetHwnd` Метод принимает сведения о размере и позиции, а также родительский дескриптор окна и возвращает дескриптор окна размещенного [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-184">The `GetHwnd` method takes size and position information plus the parent window handle and returns the window handle of the hosted [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

> [!NOTE]
>  <span data-ttu-id="2603e-185">Нельзя использовать директиву `#using` для пространства имен `System::Windows::Interop`.</span><span class="sxs-lookup"><span data-stu-id="2603e-185">You cannot use a `#using` directive for the `System::Windows::Interop` namespace.</span></span> <span data-ttu-id="2603e-186">Иначе будет создан конфликт имен между структурой <xref:System.Windows.Interop.MSG> в этом пространстве имен и структурой MSG, объявленной в winuser.h.</span><span class="sxs-lookup"><span data-stu-id="2603e-186">Doing so creates a name collision between the <xref:System.Windows.Interop.MSG> structure in that namespace and the MSG structure declared in winuser.h.</span></span> <span data-ttu-id="2603e-187">Вместо этого необходимо использовать полные имена для доступа к содержимому этого пространства имен.</span><span class="sxs-lookup"><span data-stu-id="2603e-187">You must instead use fully-qualified names to access the contents of that namespace.</span></span>

 [!code-cpp[Win32HostingWPFPage#GetHwnd](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#gethwnd)]

 <span data-ttu-id="2603e-188">Нельзя разместить [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое непосредственно в окне приложения.</span><span class="sxs-lookup"><span data-stu-id="2603e-188">You cannot host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content directly in your application window.</span></span> <span data-ttu-id="2603e-189">Вместо этого сначала создайте объект <xref:System.Windows.Interop.HwndSource>, который должен включать в себя содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-189">Instead, you first create an <xref:System.Windows.Interop.HwndSource> object to wrap the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-190">Этот объект по сути является окном, предназначенным для размещения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-190">This object is basically a window that is designed to host a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-191">Вы размещаете <xref:System.Windows.Interop.HwndSource> объекта в родительском окне, создав его в качестве дочернего элемента [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] окно, которое является частью приложения.</span><span class="sxs-lookup"><span data-stu-id="2603e-191">You host the <xref:System.Windows.Interop.HwndSource> object in the parent window by creating it as a child of a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window that is part of your application.</span></span> <span data-ttu-id="2603e-192">Параметры конструктора <xref:System.Windows.Interop.HwndSource> содержат в основном те же сведения, которые будут передаваться в CreateWindow при создании дочернего окна [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-192">The <xref:System.Windows.Interop.HwndSource> constructor parameters contain much the same information that you would pass to CreateWindow when you create a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] child window.</span></span>

 <span data-ttu-id="2603e-193">Далее необходимо создать экземпляр [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] объекта содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-193">You next create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="2603e-194">В этом случае содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] реализуется как отдельный класс `WPFPage`, использующий [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-194">In this case, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented as a separate class, `WPFPage`, using [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="2603e-195">Можно также реализовать содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-195">You could also implement the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content with [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="2603e-196">Тем не менее, для этого необходимо настроить отдельный проект и построить [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое в виде [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-196">However, to do so you need to set up a separate project and build the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)].</span></span> <span data-ttu-id="2603e-197">Вы можете добавить ссылку на эту [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] в свой проект и использовать эту ссылку для создания экземпляра содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-197">You can add a reference to that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] to your project, and use that reference to create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

 <span data-ttu-id="2603e-198">Отобразить [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого в вашем дочернем окне, назначьте ссылку [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого <xref:System.Windows.Interop.HwndSource.RootVisual%2A> свойство <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="2603e-198">You display the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in your child window by assigning a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>

 <span data-ttu-id="2603e-199">Следующая строка кода присоединяет обработчик событий `WPFButtonClicked` к событию [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого `OnButtonClicked`.</span><span class="sxs-lookup"><span data-stu-id="2603e-199">The next line of code attaches an event handler, `WPFButtonClicked`, to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content `OnButtonClicked` event.</span></span> <span data-ttu-id="2603e-200">Этот обработчик вызывается, когда пользователь щелкает **ОК** или **отменить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="2603e-200">This handler is called when the user clicks the **OK** or **Cancel** button.</span></span> <span data-ttu-id="2603e-201">См. в разделе [взаимодействие с содержимым](#communicating_with_the_page) дальнейшее обсуждение этого обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="2603e-201">See [communicating_with_the_WPF content](#communicating_with_the_page) for further discussion of this event handler.</span></span>

 <span data-ttu-id="2603e-202">В последней строке кода показан возврат дескриптора окна (HWND), который связан с объектом <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="2603e-202">The final line of code shown returns the window handle (HWND) that is associated with the <xref:System.Windows.Interop.HwndSource> object.</span></span> <span data-ttu-id="2603e-203">Вы можете использовать этот дескриптор из своего кода [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] для отправки сообщений в размещенное окно, хотя в этом примере так не делается.</span><span class="sxs-lookup"><span data-stu-id="2603e-203">You can use this handle from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code to send messages to the hosted window, although the sample does not do so.</span></span> <span data-ttu-id="2603e-204">Объект <xref:System.Windows.Interop.HwndSource> инициирует событие каждый раз при получении сообщения.</span><span class="sxs-lookup"><span data-stu-id="2603e-204">The <xref:System.Windows.Interop.HwndSource> object raises an event every time it receives a message.</span></span> <span data-ttu-id="2603e-205">Для обработки сообщений вызовите метод <xref:System.Windows.Interop.HwndSource.AddHook%2A>, чтобы присоединить обработчик сообщений, а затем обрабатывать сообщения в этом обработчике.</span><span class="sxs-lookup"><span data-stu-id="2603e-205">To process the messages, call the <xref:System.Windows.Interop.HwndSource.AddHook%2A> method to attach a message handler and then process the messages in that handler.</span></span>

<a name="holding_a_reference"></a>
### <a name="holding-a-reference-to-the-wpf-content"></a><span data-ttu-id="2603e-206">Хранение ссылки на содержимое WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-206">Holding a Reference to the WPF Content</span></span>
 <span data-ttu-id="2603e-207">Для многих приложений потребуется взаимодействовать с содержимым [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] позднее.</span><span class="sxs-lookup"><span data-stu-id="2603e-207">For many applications, you will want to communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content later.</span></span> <span data-ttu-id="2603e-208">Например, может возникнуть необходимость изменить свойства содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] или разместить в объекте <xref:System.Windows.Interop.HwndSource> другое содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-208">For example, you might want to modify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, or perhaps have the <xref:System.Windows.Interop.HwndSource> object host different [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-209">Для этого потребуется ссылка на объект <xref:System.Windows.Interop.HwndSource> или содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-209">To do this, you need a reference to the <xref:System.Windows.Interop.HwndSource> object or the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-210">Объект <xref:System.Windows.Interop.HwndSource> и связанное с ним содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] остаются в памяти до уничтожения дескриптора окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-210">The <xref:System.Windows.Interop.HwndSource> object and its associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content remain in memory until you destroy the window handle.</span></span> <span data-ttu-id="2603e-211">Однако переменная, которая назначается объекту <xref:System.Windows.Interop.HwndSource>, выйдет из области действия сразу после возврата из процедуры окна.</span><span class="sxs-lookup"><span data-stu-id="2603e-211">However, the variable you assign to the <xref:System.Windows.Interop.HwndSource> object will go out of scope as soon as you return from the window procedure.</span></span> <span data-ttu-id="2603e-212">Обычный способ решения этой проблемы с приложениями [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] заключается в использовании статической или глобальной переменной.</span><span class="sxs-lookup"><span data-stu-id="2603e-212">The customary way to handle this issue with [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications is to use a static or global variable.</span></span> <span data-ttu-id="2603e-213">К сожалению, нельзя назначать управляемый объект таким типам переменных.</span><span class="sxs-lookup"><span data-stu-id="2603e-213">Unfortunately, you cannot assign a managed object to those types of variables.</span></span> <span data-ttu-id="2603e-214">Вы можете назначить дескриптор окна, связанный с объектом <xref:System.Windows.Interop.HwndSource>, глобальной или статической переменной, но которая не предоставляет доступ к самому объекту.</span><span class="sxs-lookup"><span data-stu-id="2603e-214">You can assign the window handle associated with <xref:System.Windows.Interop.HwndSource> object to a global or static variable, but that doe not provide access to the object itself.</span></span>

 <span data-ttu-id="2603e-215">Самым простым решением этой проблемы является реализация управляемого класса, который содержит набор статических полей для хранения ссылок на любые управляемые объекты, к которым требуется доступ.</span><span class="sxs-lookup"><span data-stu-id="2603e-215">The simplest solution to this issue is to implement a managed class that contains a set of static fields to hold references to any managed objects that you need access to.</span></span> <span data-ttu-id="2603e-216">В данном примере используется класс `WPFPageHost` для хранения ссылки на содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], а также начальные значения его свойств, которые могут быть изменены пользователем позднее.</span><span class="sxs-lookup"><span data-stu-id="2603e-216">The sample uses the `WPFPageHost` class to hold a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, plus the initial values of a number of its properties that might be changed later by the user.</span></span> <span data-ttu-id="2603e-217">Это определяется в заголовке.</span><span class="sxs-lookup"><span data-stu-id="2603e-217">This is defined in the header.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageHost](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.h#wpfpagehost)]

 <span data-ttu-id="2603e-218">В последней части `GetHwnd` функция присваивает значения этим полям для последующего использования, пока `myPage` остается в области.</span><span class="sxs-lookup"><span data-stu-id="2603e-218">The latter part of the `GetHwnd` function assigns values to those fields for later use while `myPage` is still in scope.</span></span>

<a name="communicating_with_the_page"></a>
### <a name="communicating-with-the-wpf-content"></a><span data-ttu-id="2603e-219">Взаимодействие с содержимым WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-219">Communicating with the WPF Content</span></span>
 <span data-ttu-id="2603e-220">Существует два типа взаимодействия с содержимым [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-220">There are two types of communication with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-221">Приложение получает сведения из [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого, когда пользователь щелкает **ОК** или **отменить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="2603e-221">The application receives information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content when the user clicks the **OK** or **Cancel** buttons.</span></span> <span data-ttu-id="2603e-222">Приложение также имеет [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], в котором пользователь может изменять изменять различные свойства содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], такие как цвет фона или размер шрифта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2603e-222">The application also has a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that allows the user to change various [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, such as the background color or default font size.</span></span>

 <span data-ttu-id="2603e-223">Как упоминалось выше, когда пользователь нажимает одну из кнопок, содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] вызывает событие `OnButtonClicked`.</span><span class="sxs-lookup"><span data-stu-id="2603e-223">As mentioned above, when the user clicks either button the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content raises an `OnButtonClicked` event.</span></span> <span data-ttu-id="2603e-224">Приложение присоединяет обработчик к этому событию, чтобы получать эти уведомления.</span><span class="sxs-lookup"><span data-stu-id="2603e-224">The application attaches a handler to this event to receive these notifications.</span></span> <span data-ttu-id="2603e-225">Если **ОК** была нажата кнопка, обработчик возвращает сведения о пользователе из [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого и отображает его в наборе статических элементов управления.</span><span class="sxs-lookup"><span data-stu-id="2603e-225">If the **OK** button was clicked, the handler gets the user information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content and displays it in a set of static controls.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wpfbuttonclicked)]

 <span data-ttu-id="2603e-226">Обработчик получает объект аргумента [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] пользовательского события из содержимого `MyPageEventArgs`.</span><span class="sxs-lookup"><span data-stu-id="2603e-226">The handler receives a custom event argument object from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, `MyPageEventArgs`.</span></span> <span data-ttu-id="2603e-227">Объекта `IsOK` свойству `true` Если **ОК** была нажата, и `false` Если **отменить** была нажата кнопка.</span><span class="sxs-lookup"><span data-stu-id="2603e-227">The object's `IsOK` property is set to `true` if the **OK** button was clicked, and `false` if the **Cancel** button was clicked.</span></span>

 <span data-ttu-id="2603e-228">Если **ОК** была нажата кнопка, обработчик получает ссылку на [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого из класса контейнера.</span><span class="sxs-lookup"><span data-stu-id="2603e-228">If the **OK** button was clicked, the handler gets a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from the container class.</span></span> <span data-ttu-id="2603e-229">Затем он собирает сведения о пользователе, которые хранятся в соответствующих свойствах содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], и использует статические элементы управления для отображения этих сведений в родительском окне.</span><span class="sxs-lookup"><span data-stu-id="2603e-229">It then collects the user information that is held by the associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties and uses the static controls to display the information on the parent window.</span></span> <span data-ttu-id="2603e-230">Поскольку данные содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] хранятся в виде управляемых строк, они должны быть маршалированы для использования элементом управления [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-230">Because the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content data is in the form of a managed string, it has to be marshaled for use by a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control.</span></span> <span data-ttu-id="2603e-231">Если **отменить** была нажата кнопка, обработчик удаляет данные из статических элементов управления.</span><span class="sxs-lookup"><span data-stu-id="2603e-231">If the **Cancel** button was clicked, the handler clears the data from the static controls.</span></span>

 <span data-ttu-id="2603e-232">Приложение [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] предоставляет набор переключателей, с помощью которых пользователь может изменять цвет фона для содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и некоторые свойства, связанные со шрифтами.</span><span class="sxs-lookup"><span data-stu-id="2603e-232">The application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] provides a set of radio buttons that allow the user to modify the background color of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and several font-related properties.</span></span> <span data-ttu-id="2603e-233">Следующий пример представляет выдержку из процедуры окна приложения (WndProc), содержащую обработку его сообщения, которая устанавливает разные свойства в различных сообщениях, включая цвет фона.</span><span class="sxs-lookup"><span data-stu-id="2603e-233">The following example is an excerpt from the application's window procedure (WndProc) and its message handling that sets various properties on different messages, including the background color.</span></span> <span data-ttu-id="2603e-234">Остальные примеры похожи и не приводятся.</span><span class="sxs-lookup"><span data-stu-id="2603e-234">The others are similar, and are not shown.</span></span> <span data-ttu-id="2603e-235">Подробные сведения и контекст см. в полном примере.</span><span class="sxs-lookup"><span data-stu-id="2603e-235">See the complete sample for details and context.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCommandToBG](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcommandtobg)]

 <span data-ttu-id="2603e-236">Чтобы задать цвет фона, получите ссылку на содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] (`hostedPage`) из `WPFPageHost` и установите в свойстве цвета фона соответствующий цвет.</span><span class="sxs-lookup"><span data-stu-id="2603e-236">To set the background color, get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (`hostedPage`) from `WPFPageHost` and set the background color property to the appropriate color.</span></span> <span data-ttu-id="2603e-237">В примере используется три варианта цвета: исходный цвет, светло-зеленый и светло-оранжевый.</span><span class="sxs-lookup"><span data-stu-id="2603e-237">The sample uses three color options: the original color, light green, or light salmon.</span></span> <span data-ttu-id="2603e-238">Исходный цвет фона хранится в виде статического поля в классе `WPFPageHost`.</span><span class="sxs-lookup"><span data-stu-id="2603e-238">The original background color is stored as a static field in the `WPFPageHost` class.</span></span> <span data-ttu-id="2603e-239">Чтобы задать другие два цвета, создайте новый объект <xref:System.Windows.Media.SolidColorBrush> и передайте в конструктор значение статического цвета из объекта <xref:System.Windows.Media.Colors>.</span><span class="sxs-lookup"><span data-stu-id="2603e-239">To set the other two, you create a new <xref:System.Windows.Media.SolidColorBrush> object and pass the constructor a static colors value from the <xref:System.Windows.Media.Colors> object.</span></span>

<a name="implementing_the_wpf_page"></a>
## <a name="implementing-the-wpf-page"></a><span data-ttu-id="2603e-240">Реализация страницы WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-240">Implementing the WPF Page</span></span>
 <span data-ttu-id="2603e-241">Вы можете размещать и использовать [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого без каких-либо знаний о фактической реализации.</span><span class="sxs-lookup"><span data-stu-id="2603e-241">You can host and use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content without any knowledge of the actual implementation.</span></span> <span data-ttu-id="2603e-242">Если [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое было упаковано в отдельную [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)], его можно встроить в любом [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] языка.</span><span class="sxs-lookup"><span data-stu-id="2603e-242">If the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content had been packaged in a separate [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)], it could have been built in any [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] language.</span></span> <span data-ttu-id="2603e-243">Ниже приведено краткое пошаговое описание реализации [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], которая используется в данном примере.</span><span class="sxs-lookup"><span data-stu-id="2603e-243">Following is a brief walkthrough of the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] implementation that is used in the sample.</span></span> <span data-ttu-id="2603e-244">Этот подраздел состоит из следующих подразделов.</span><span class="sxs-lookup"><span data-stu-id="2603e-244">This section contains the following subsections.</span></span>

<a name="autoNestedSectionsOUTLINE2"></a>
- [<span data-ttu-id="2603e-245">Макет</span><span class="sxs-lookup"><span data-stu-id="2603e-245">Layout</span></span>](#page_layout)

- [<span data-ttu-id="2603e-246">Возврат данных в главное окно</span><span class="sxs-lookup"><span data-stu-id="2603e-246">Returning the Data to the Host Window</span></span>](#returning_data_to_window)

- [<span data-ttu-id="2603e-247">Установка свойств WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-247">Setting the WPF Properties</span></span>](#set_page_properties)

<a name="page_layout"></a>
### <a name="layout"></a><span data-ttu-id="2603e-248">Макет</span><span class="sxs-lookup"><span data-stu-id="2603e-248">Layout</span></span>
 <span data-ttu-id="2603e-249">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Элементов в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое состоят из пяти <xref:System.Windows.Controls.TextBox> элементы управления, связанных с <xref:System.Windows.Controls.Label> элементов управления: Имя, адрес, городе, штате и Zip.</span><span class="sxs-lookup"><span data-stu-id="2603e-249">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content consist of five <xref:System.Windows.Controls.TextBox> controls, with associated <xref:System.Windows.Controls.Label> controls: Name, Address, City, State, and Zip.</span></span> <span data-ttu-id="2603e-250">Существует также два <xref:System.Windows.Controls.Button> элементов управления, **ОК** и **Отмена**</span><span class="sxs-lookup"><span data-stu-id="2603e-250">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**</span></span>

 <span data-ttu-id="2603e-251">Содержимое [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] реализовано в классе `WPFPage`.</span><span class="sxs-lookup"><span data-stu-id="2603e-251">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in the `WPFPage` class.</span></span> <span data-ttu-id="2603e-252">Макет обрабатывается с помощью элемента макета <xref:System.Windows.Controls.Grid>.</span><span class="sxs-lookup"><span data-stu-id="2603e-252">Layout is handled with a <xref:System.Windows.Controls.Grid> layout element.</span></span> <span data-ttu-id="2603e-253">Этот класс наследует от <xref:System.Windows.Controls.Grid>, который фактически делает его корневым элементом содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2603e-253">The class inherits from <xref:System.Windows.Controls.Grid>, which effectively makes it the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content root element.</span></span>

 <span data-ttu-id="2603e-254">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Содержимого конструктор принимает требуемые ширину и высоту и размеры <xref:System.Windows.Controls.Grid> соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="2603e-254">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content constructor takes the required width and height, and sizes the <xref:System.Windows.Controls.Grid> accordingly.</span></span> <span data-ttu-id="2603e-255">Затем он определяет базовый макет, создавая набор <xref:System.Windows.Controls.ColumnDefinition> и <xref:System.Windows.Controls.RowDefinition> объектов и добавления их в <xref:System.Windows.Controls.Grid> базовый объект <xref:System.Windows.Controls.Grid.ColumnDefinitions%2A> и <xref:System.Windows.Controls.Grid.RowDefinitions%2A> коллекций, соответственно.</span><span class="sxs-lookup"><span data-stu-id="2603e-255">It then defines the basic layout by creating a set of <xref:System.Windows.Controls.ColumnDefinition> and <xref:System.Windows.Controls.RowDefinition> objects and adding them to the <xref:System.Windows.Controls.Grid> object base <xref:System.Windows.Controls.Grid.ColumnDefinitions%2A> and <xref:System.Windows.Controls.Grid.RowDefinitions%2A> collections, respectively.</span></span> <span data-ttu-id="2603e-256">Это задает сетку из пяти строк и семи столбцов с размерами, определяемыми содержимым ячеек.</span><span class="sxs-lookup"><span data-stu-id="2603e-256">This defines a grid of five rows and seven columns, with the dimensions determined by the contents of the cells.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorToGridDef](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortogriddef)]

 <span data-ttu-id="2603e-257">Затем конструктор добавляет элементы [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] в объект <xref:System.Windows.Controls.Grid>.</span><span class="sxs-lookup"><span data-stu-id="2603e-257">Next, the constructor adds the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to the <xref:System.Windows.Controls.Grid>.</span></span> <span data-ttu-id="2603e-258">Первый элемент — это текст заголовка, который является элементом управления <xref:System.Windows.Controls.Label>, выравниваемым по центру в первой строке сетки.</span><span class="sxs-lookup"><span data-stu-id="2603e-258">The first element is the title text, which is a <xref:System.Windows.Controls.Label> control that is centered in the first row of the grid.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorTitle](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortitle)]

 <span data-ttu-id="2603e-259">Следующая строка содержит элемент управления <xref:System.Windows.Controls.Label> «Имя» и связанный с ним элемент управления <xref:System.Windows.Controls.TextBox>.</span><span class="sxs-lookup"><span data-stu-id="2603e-259">The next row contains the Name <xref:System.Windows.Controls.Label> control and its associated <xref:System.Windows.Controls.TextBox> control.</span></span> <span data-ttu-id="2603e-260">Так как тот же код используется для каждой пары «метка/текстовое поле», он помещается в пару закрытых методов и используется для всех пяти пар «метка/текстовое поле».</span><span class="sxs-lookup"><span data-stu-id="2603e-260">Because the same code is used for each label/textbox pair, it is placed in a pair of private methods and used for all five label/textbox pairs.</span></span> <span data-ttu-id="2603e-261">Эти методы создают соответствующий элемент управления и вызывают класс <xref:System.Windows.Controls.Grid> статического метода <xref:System.Windows.Controls.Grid.SetColumn%2A> и методы <xref:System.Windows.Controls.Grid.SetRow%2A> для размещения элементов управления в соответствующую ячейку.</span><span class="sxs-lookup"><span data-stu-id="2603e-261">The methods create the appropriate control, and call the <xref:System.Windows.Controls.Grid> class static <xref:System.Windows.Controls.Grid.SetColumn%2A> and <xref:System.Windows.Controls.Grid.SetRow%2A> methods to place the controls in the appropriate cell.</span></span> <span data-ttu-id="2603e-262">После создания элемента управления в примере вызывается метод <xref:System.Windows.Controls.UIElementCollection.Add%2A> в свойстве <xref:System.Windows.Controls.Panel.Children%2A> объекта <xref:System.Windows.Controls.Grid> для добавления элемента управления в сетку.</span><span class="sxs-lookup"><span data-stu-id="2603e-262">After the control is created, the sample calls the <xref:System.Windows.Controls.UIElementCollection.Add%2A> method on the <xref:System.Windows.Controls.Panel.Children%2A> property of the <xref:System.Windows.Controls.Grid> to add the control to the grid.</span></span> <span data-ttu-id="2603e-263">Для добавления оставшихся пар «метка/текстовое поле» используется аналогичный код.</span><span class="sxs-lookup"><span data-stu-id="2603e-263">The code to add the remaining label/textbox pairs is similar.</span></span> <span data-ttu-id="2603e-264">Подробности см. в примере кода.</span><span class="sxs-lookup"><span data-stu-id="2603e-264">See the sample code for details.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorName](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorname)]

 <span data-ttu-id="2603e-265">Реализация этих двух методов выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2603e-265">The implementation of the two methods is as follows:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCreateHelpers](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagecreatehelpers)]

 <span data-ttu-id="2603e-266">Наконец, в этом примере добавляется **ОК** и **отменить** кнопки и присоединяет обработчик событий к их <xref:System.Windows.Controls.Primitives.ButtonBase.Click> события.</span><span class="sxs-lookup"><span data-stu-id="2603e-266">Finally, the sample adds the **OK** and **Cancel** buttons and attaches an event handler to their <xref:System.Windows.Controls.Primitives.ButtonBase.Click> events.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorButtonsEvents](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorbuttonsevents)]

<a name="returning_data_to_window"></a>
### <a name="returning-the-data-to-the-host-window"></a><span data-ttu-id="2603e-267">Возврат данных в главное окно</span><span class="sxs-lookup"><span data-stu-id="2603e-267">Returning the Data to the Host Window</span></span>
 <span data-ttu-id="2603e-268">При нажатии одной из кнопок вызывается ее событие <xref:System.Windows.Controls.Primitives.ButtonBase.Click>.</span><span class="sxs-lookup"><span data-stu-id="2603e-268">When either button is clicked, its <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is raised.</span></span> <span data-ttu-id="2603e-269">Главное окно может просто присоединять обработчики к этим событиям и получать данные напрямую из элементов управления <xref:System.Windows.Controls.TextBox>.</span><span class="sxs-lookup"><span data-stu-id="2603e-269">The host window could simply attach handlers to these events and get the data directly from the <xref:System.Windows.Controls.TextBox> controls.</span></span> <span data-ttu-id="2603e-270">В примере используется несколько менее прямой подход.</span><span class="sxs-lookup"><span data-stu-id="2603e-270">The sample uses a somewhat less direct approach.</span></span> <span data-ttu-id="2603e-271">Он обрабатывает <xref:System.Windows.Controls.Primitives.ButtonBase.Click> в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] контента, а затем вызывает пользовательское событие `OnButtonClicked`для уведомления [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-271">It handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and then raises a custom event `OnButtonClicked`, to notify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="2603e-272">Это позволяет [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимого выполнить некоторую проверку параметров перед уведомлением узла.</span><span class="sxs-lookup"><span data-stu-id="2603e-272">This allows the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to do some parameter validation before notifying the host.</span></span> <span data-ttu-id="2603e-273">Обработчик получает текст из элементов управления <xref:System.Windows.Controls.TextBox> и назначает его общим свойствам, из которых узел может получать сведения.</span><span class="sxs-lookup"><span data-stu-id="2603e-273">The handler gets the text from the <xref:System.Windows.Controls.TextBox> controls and assigns it to public properties, from which the host can retrieve the information.</span></span>

 <span data-ttu-id="2603e-274">Объявление события в WPFPage.h:</span><span class="sxs-lookup"><span data-stu-id="2603e-274">The event declaration, in WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageEventDecl](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpageeventdecl)]

 <span data-ttu-id="2603e-275">Обработчик событий <xref:System.Windows.Controls.Primitives.ButtonBase.Click> в WPFPage.cpp:</span><span class="sxs-lookup"><span data-stu-id="2603e-275">The <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler, in WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagebuttonclicked)]

<a name="set_page_properties"></a>
### <a name="setting-the-wpf-properties"></a><span data-ttu-id="2603e-276">Установка свойств WPF</span><span class="sxs-lookup"><span data-stu-id="2603e-276">Setting the WPF Properties</span></span>
 <span data-ttu-id="2603e-277">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] Узла позволяет пользователю изменять разные [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] свойства содержимого.</span><span class="sxs-lookup"><span data-stu-id="2603e-277">The [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] host allows the user to change several [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties.</span></span> <span data-ttu-id="2603e-278">Со стороны [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] это просто изменение свойств.</span><span class="sxs-lookup"><span data-stu-id="2603e-278">From the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] side, it is simply a matter of changing the properties.</span></span> <span data-ttu-id="2603e-279">Реализация в классе содержимого [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] несколько более сложная, поскольку нет одного глобального свойства, которое управляет шрифтами для всех элементов управления.</span><span class="sxs-lookup"><span data-stu-id="2603e-279">The implementation in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class is somewhat more complicated, because there is no single global property that controls the fonts for all controls.</span></span> <span data-ttu-id="2603e-280">Вместо этого для каждого элемента управления изменяется соответствующее свойство в методах доступа set этого свойства.</span><span class="sxs-lookup"><span data-stu-id="2603e-280">Instead, the appropriate property for each control is changed in the properties' set accessors.</span></span> <span data-ttu-id="2603e-281">В следующем примере показано код `DefaultFontFamily` свойство.</span><span class="sxs-lookup"><span data-stu-id="2603e-281">The following example shows the code for the `DefaultFontFamily` property.</span></span> <span data-ttu-id="2603e-282">Задание свойства вызывает закрытый метод, который в свою очередь устанавливает свойства <xref:System.Windows.Controls.Control.FontFamily%2A> для различных элементов управления.</span><span class="sxs-lookup"><span data-stu-id="2603e-282">Setting the property calls a private method that in turn sets the <xref:System.Windows.Controls.Control.FontFamily%2A> properties for the various controls.</span></span>

 <span data-ttu-id="2603e-283">Из WPFPage.h:</span><span class="sxs-lookup"><span data-stu-id="2603e-283">From WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageFontFamilyProperty](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpagefontfamilyproperty)]

 <span data-ttu-id="2603e-284">Из WPFPage.cpp:</span><span class="sxs-lookup"><span data-stu-id="2603e-284">From WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageSetFontFamily](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagesetfontfamily)]

## <a name="see-also"></a><span data-ttu-id="2603e-285">См. также</span><span class="sxs-lookup"><span data-stu-id="2603e-285">See also</span></span>

- <xref:System.Windows.Interop.HwndSource>
- [<span data-ttu-id="2603e-286">Взаимодействие WPF и Win32</span><span class="sxs-lookup"><span data-stu-id="2603e-286">WPF and Win32 Interoperation</span></span>](wpf-and-win32-interoperation.md)
