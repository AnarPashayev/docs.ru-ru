---
title: Общие сведения о перенаправленных событиях
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- attached events [WPF]
- grouped button set [WPF]
- routed events [WPF]
- events [WPF], routed
- tunneling [WPF]
- events [WPF], attached
- routing strategies for events [WPF]
- button set [WPF], grouped
- bubbling [WPF]
ms.assetid: 1a2189ae-13b4-45b0-b12c-8de2e49c29d2
ms.openlocfilehash: a6baf073e25635f0a6dd666d681d8bc641128ea0
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59330458"
---
# <a name="routed-events-overview"></a><span data-ttu-id="e6602-102">Общие сведения о перенаправленных событиях</span><span class="sxs-lookup"><span data-stu-id="e6602-102">Routed Events Overview</span></span>
<span data-ttu-id="e6602-103">В этом разделе описывается понятие перенаправленных событий в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6602-103">This topic describes the concept of routed events in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span></span> <span data-ttu-id="e6602-104">Здесь определяется терминология перенаправленных событий, описывается, как перенаправленные события маршрутизируются через дерево элементов, кратко описываются способы обработки перенаправленных событий, а также способы создания пользовательских перенаправленных событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-104">The topic defines routed events terminology, describes how routed events are routed through a tree of elements, summarizes how you handle routed events, and introduces how to create your own custom routed events.</span></span>
  
<a name="prerequisites"></a>   
## <a name="prerequisites"></a><span data-ttu-id="e6602-105">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="e6602-105">Prerequisites</span></span>  
 <span data-ttu-id="e6602-106">Этот раздел предполагает наличие базовых знаний о [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] и объектно-ориентированном программировании,а также представление о связях между элементами [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="e6602-106">This topic assumes that you have basic knowledge of the [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] and object-oriented programming, as well as the concept of how the relationships between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements can be conceptualized as a tree.</span></span> <span data-ttu-id="e6602-107">Чтобы выполнить примеры в этом разделе, следует также понимать [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] и знать, как писать простые приложения или страницы [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6602-107">In order to follow the examples in this topic, you should also understand [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] and know how to write very basic [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications or pages.</span></span> <span data-ttu-id="e6602-108">Дополнительные сведения см. в разделе [Пошаговое руководство: Создание первого классического приложения WPF](../getting-started/walkthrough-my-first-wpf-desktop-application.md) и [Обзор XAML (WPF)](xaml-overview-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-108">For more information, see [Walkthrough: My first WPF desktop application](../getting-started/walkthrough-my-first-wpf-desktop-application.md) and [XAML Overview (WPF)](xaml-overview-wpf.md).</span></span>  
  
<a name="routing"></a>   
## <a name="what-is-a-routed-event"></a><span data-ttu-id="e6602-109">Что такое перенаправленное событие?</span><span class="sxs-lookup"><span data-stu-id="e6602-109">What Is a Routed Event?</span></span>  
 <span data-ttu-id="e6602-110">Перенаправленные события можно рассматривать с точки зрения функциональности или реализации.</span><span class="sxs-lookup"><span data-stu-id="e6602-110">You can think about routed events either from a functional or implementation perspective.</span></span> <span data-ttu-id="e6602-111">Здесь приводятся оба определения, чтобы пользователи могли выбрать наиболее подходящее для себя.</span><span class="sxs-lookup"><span data-stu-id="e6602-111">Both definitions are presented here, because some people find one or the other definition more useful.</span></span>  
  
 <span data-ttu-id="e6602-112">Функциональное определение: Перенаправленное событие — это тип события, которое может вызывать обработчики нескольких слушателей в дереве элементов, а не только объект, который вызвал событие.</span><span class="sxs-lookup"><span data-stu-id="e6602-112">Functional definition: A routed event is a type of event that can invoke handlers on multiple listeners in an element tree, rather than just on the object that raised the event.</span></span>  
  
 <span data-ttu-id="e6602-113">Определение реализации: Перенаправленное событие — [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] событий, поддерживаемый экземпляр <xref:System.Windows.RoutedEvent> класса и обрабатывается [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] системой событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-113">Implementation definition: A routed event is a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event that is backed by an instance of the <xref:System.Windows.RoutedEvent> class and is processed by the [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] event system.</span></span>  
  
 <span data-ttu-id="e6602-114">Обычно в приложении [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержится много элементов.</span><span class="sxs-lookup"><span data-stu-id="e6602-114">A typical [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application contains many elements.</span></span> <span data-ttu-id="e6602-115">В зависимости от того, созданы элементы в коде или объявлены в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], они связаны в дереве элементов друг с другом.</span><span class="sxs-lookup"><span data-stu-id="e6602-115">Whether created in code or declared in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], these elements exist in an element tree relationship to each other.</span></span> <span data-ttu-id="e6602-116">Маршрут события может проходить в одном из двух направлений в зависимости от определения события, но обычно маршрут проходит от исходного элемента и затем "всплывает" вверх по дереву элементов до тех пор, пока не достигнет корневого элемента дерева (как правило, страница или окно).</span><span class="sxs-lookup"><span data-stu-id="e6602-116">The event route can travel in one of two directions depending on the event definition, but generally the route travels from the source element and then "bubbles" upward through the element tree until it reaches the element tree root (typically a page or a window).</span></span> <span data-ttu-id="e6602-117">Концепция всплывания может быть знакома, если имеется опыт работы с моделью DHTML-объектов.</span><span class="sxs-lookup"><span data-stu-id="e6602-117">This bubbling concept might be familiar to you if you have worked with the DHTML object model previously.</span></span>  
  
 <span data-ttu-id="e6602-118">Рассмотрим следующее простое дерево элементов.</span><span class="sxs-lookup"><span data-stu-id="e6602-118">Consider the following simple element tree:</span></span>  
  
 [!code-xaml[EventOvwSupport#GroupButton](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#groupbutton)]  
  
 <span data-ttu-id="e6602-119">Это дерево элементов выглядит примерно следующим образом.</span><span class="sxs-lookup"><span data-stu-id="e6602-119">This element tree produces something like the following:</span></span>  
  
 <span data-ttu-id="e6602-120">![Кнопки "Да", "Нет" и "Отмена"](./media/routedevent-ovw-1.gif "RoutedEvent_ovw_1")</span><span class="sxs-lookup"><span data-stu-id="e6602-120">![Yes, No, and Cancel buttons](./media/routedevent-ovw-1.gif "RoutedEvent_ovw_1")</span></span>  
  
 <span data-ttu-id="e6602-121">В этом упрощенном дереве элементов источником <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событий является одним из <xref:System.Windows.Controls.Button> элементов и какое <xref:System.Windows.Controls.Button> была нажата — первый элемент, который имеет возможность обработать событие.</span><span class="sxs-lookup"><span data-stu-id="e6602-121">In this simplified element tree, the source of a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is one of the <xref:System.Windows.Controls.Button> elements, and whichever <xref:System.Windows.Controls.Button> was clicked is the first element that has the opportunity to handle the event.</span></span> <span data-ttu-id="e6602-122">Но если обработчик не присоединен к <xref:System.Windows.Controls.Button> действует на событие, а затем будет всплывать вверх до <xref:System.Windows.Controls.Button> родительского элемента в дереве элементов, который является <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="e6602-122">But if no handler attached to the <xref:System.Windows.Controls.Button> acts on the event, then the event will bubble upwards to the <xref:System.Windows.Controls.Button> parent in the element tree, which is the <xref:System.Windows.Controls.StackPanel>.</span></span> <span data-ttu-id="e6602-123">Потенциально событие может передаваться к <xref:System.Windows.Controls.Border>, а затем за пределы границы к корневой странице дерева элементов (не показано).</span><span class="sxs-lookup"><span data-stu-id="e6602-123">Potentially, the event bubbles to <xref:System.Windows.Controls.Border>, and then beyond to the page root of the element tree (not shown).</span></span>  
  
 <span data-ttu-id="e6602-124">Другими словами, маршрутом события для данного <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событие:</span><span class="sxs-lookup"><span data-stu-id="e6602-124">In other words, the event route for this <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is:</span></span>  
  
 <span data-ttu-id="e6602-125">Button-->StackPanel-->Border-->...</span><span class="sxs-lookup"><span data-stu-id="e6602-125">Button-->StackPanel-->Border-->...</span></span>  
  
### <a name="top-level-scenarios-for-routed-events"></a><span data-ttu-id="e6602-126">Сценарии верхнего уровня для перенаправленных событий</span><span class="sxs-lookup"><span data-stu-id="e6602-126">Top-level Scenarios for Routed Events</span></span>  
 <span data-ttu-id="e6602-127">Ниже приведен краткий обзор сценариев, определяющих концепцию перенаправления событий и то, почему обычного события [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] не было достаточно для осуществления этих сценариев.</span><span class="sxs-lookup"><span data-stu-id="e6602-127">The following is a brief summary of the scenarios that motivated the routed event concept, and why a typical [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event was not adequate for these scenarios:</span></span>  
  
 <span data-ttu-id="e6602-128">**Составление элемента управления и инкапсуляция.** Различные элементы управления в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] имеют расширенную модель содержимого.</span><span class="sxs-lookup"><span data-stu-id="e6602-128">**Control composition and encapsulation:** Various controls in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] have a rich content model.</span></span> <span data-ttu-id="e6602-129">Например, можно поместить изображение внутри <xref:System.Windows.Controls.Button>, что эффективно расширит визуальное дерево кнопки.</span><span class="sxs-lookup"><span data-stu-id="e6602-129">For example, you can place an image inside of a <xref:System.Windows.Controls.Button>, which effectively extends the visual tree of the button.</span></span> <span data-ttu-id="e6602-130">Тем не менее добавленное изображение не должно отключать проверку нажатия, которая позволяет кнопке реагировать на <xref:System.Windows.Controls.Primitives.ButtonBase.Click> ее содержимого, даже если пользователь нажимает пиксели, которые технически являются частью изображения.</span><span class="sxs-lookup"><span data-stu-id="e6602-130">However, the added image must not break the hit-testing behavior that causes a button to respond to a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> of its content, even if the user clicks on pixels that are technically part of the image.</span></span>  
  
 <span data-ttu-id="e6602-131">**Точки присоединения обработчика:** В [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], придется присоединить один обработчик несколько раз для обработки событий, которые могут возникнуть из нескольких элементов.</span><span class="sxs-lookup"><span data-stu-id="e6602-131">**Singular handler attachment points:** In [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], you would have to attach the same handler multiple times to process events that could be raised from multiple elements.</span></span> <span data-ttu-id="e6602-132">Перенаправленные события позволяют присоединить обработчик только один раз, как было показано в предыдущем примере, и при необходимости использовать логику обработки для определения места возникновения события.</span><span class="sxs-lookup"><span data-stu-id="e6602-132">Routed events enable you to attach that handler only once, as was shown in the previous example, and use handler logic to determine where the event came from if necessary.</span></span> <span data-ttu-id="e6602-133">Например, это может быть обработчиком для ранее показанного [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6602-133">For instance, this might be the handler for the previously shown [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]:</span></span>  
  
 [!code-csharp[EventOvwSupport#GroupButtonCodeBehind](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#groupbuttoncodebehind)]
 [!code-vb[EventOvwSupport#GroupButtonCodeBehind](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#groupbuttoncodebehind)]  
  
 <span data-ttu-id="e6602-134">**Обработка классов:** Перенаправленные события разрешают использовать статический обработчик, который определен в классе.</span><span class="sxs-lookup"><span data-stu-id="e6602-134">**Class handling:** Routed events permit a static handler that is defined by the class.</span></span> <span data-ttu-id="e6602-135">Этот обработчик классов может обрабатывать событие раньше любого вложенного обработчика экземпляров.</span><span class="sxs-lookup"><span data-stu-id="e6602-135">This class handler has the opportunity to handle an event before any attached instance handlers can.</span></span>  
  
 <span data-ttu-id="e6602-136">**Ссылка на событие без отражения:** Определенных методов кода и исправлений требуется Идентификация определенного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-136">**Referencing an event without reflection:** Certain code and markup techniques require a way to identify a specific event.</span></span> <span data-ttu-id="e6602-137">Перенаправленное событие создает <xref:System.Windows.RoutedEvent> поле идентификатора, который обеспечивает надежный метод идентификации события, не требует статического отражения или выполнения отражения.</span><span class="sxs-lookup"><span data-stu-id="e6602-137">A routed event creates a <xref:System.Windows.RoutedEvent> field as an identifier, which provides a robust event identification technique that does not require static or run-time reflection.</span></span>  
  
### <a name="how-routed-events-are-implemented"></a><span data-ttu-id="e6602-138">Реализация перенаправленных событий</span><span class="sxs-lookup"><span data-stu-id="e6602-138">How Routed Events Are Implemented</span></span>  
 <span data-ttu-id="e6602-139">Перенаправленное событие — [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] событий, поддерживаемый экземпляр <xref:System.Windows.RoutedEvent> класса и зарегистрирована [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] системой событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-139">A routed event is a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event that is backed by an instance of the <xref:System.Windows.RoutedEvent> class and registered with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event system.</span></span> <span data-ttu-id="e6602-140"><xref:System.Windows.RoutedEvent> Экземпляр, полученный из регистрации обычно сохраняется в качестве `public` `static` `readonly` члена класса, который регистрирует и таким образом «владеет» перенаправленным поля.</span><span class="sxs-lookup"><span data-stu-id="e6602-140">The <xref:System.Windows.RoutedEvent> instance obtained from registration is typically retained as a `public` `static` `readonly` field member of the class that registers and thus "owns" the routed event.</span></span> <span data-ttu-id="e6602-141">Соединение с событием [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] с таким же именем (которое иногда называется событием программы-оболочки) выполняется путем переопределения реализаций `add` и `remove` для события [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6602-141">The connection to the identically named [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event (which is sometimes termed the "wrapper" event) is accomplished by overriding the `add` and `remove` implementations for the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event.</span></span> <span data-ttu-id="e6602-142">Как правило, `add` и `remove` остаются неявными по умолчанию и используют соответствующий синтаксис события определенного языка для добавления и удаления обработчиков события.</span><span class="sxs-lookup"><span data-stu-id="e6602-142">Ordinarily, the `add` and `remove` are left as an implicit default that uses the appropriate language-specific event syntax for adding and removing handlers of that event.</span></span> <span data-ttu-id="e6602-143">Механизм подключения и резервирования перенаправленного события похож как свойство зависимостей является [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] свойство, поддерживаемый <xref:System.Windows.DependencyProperty> класса и зарегистрирована [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] системы свойств.</span><span class="sxs-lookup"><span data-stu-id="e6602-143">The routed event backing and connection mechanism is conceptually similar to how a dependency property is a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] property that is backed by the <xref:System.Windows.DependencyProperty> class and registered with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property system.</span></span>  
  
 <span data-ttu-id="e6602-144">В следующем примере показано объявление пользовательского `Tap` перенаправленного события, включая регистрацию и использование <xref:System.Windows.RoutedEvent> поле идентификатора и `add` и `remove` реализации для `Tap` [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-144">The following example shows the declaration for a custom `Tap` routed event, including the registration and exposure of the <xref:System.Windows.RoutedEvent> identifier field and the `add` and `remove` implementations for the `Tap` [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event.</span></span>  
  
 [!code-csharp[RoutedEventCustom#AddRemoveHandler](~/samples/snippets/csharp/VS_Snippets_Wpf/RoutedEventCustom/CSharp/SDKSampleLibrary/class1.cs#addremovehandler)]
 [!code-vb[RoutedEventCustom#AddRemoveHandler](~/samples/snippets/visualbasic/VS_Snippets_Wpf/RoutedEventCustom/VB/SDKSampleLibrary/Class1.vb#addremovehandler)]  
  
### <a name="routed-event-handlers-and-xaml"></a><span data-ttu-id="e6602-145">Обработчики перенаправленных событий и XAML</span><span class="sxs-lookup"><span data-stu-id="e6602-145">Routed Event Handlers and XAML</span></span>  
 <span data-ttu-id="e6602-146">Чтобы добавить обработчик для события с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], следует объявить имя события как атрибут для элемента, который является прослушивателем событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-146">To add a handler for an event using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], you declare the event name as an attribute on the element that is an event listener.</span></span> <span data-ttu-id="e6602-147">Значением атрибута является имя метода реализуемого обработчика, который должен существовать в разделяемом классе файла кода программной части.</span><span class="sxs-lookup"><span data-stu-id="e6602-147">The value of the attribute is the name of your implemented handler method, which must exist in the partial class of the code-behind file.</span></span>  
  
 [!code-xaml[EventOvwSupport#SimplestSyntax](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#simplestsyntax)]  
  
 <span data-ttu-id="e6602-148">Синтаксис языка [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] для добавления стандартных обработчиков событий [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] одинаков для добавления обработчиков перенаправленных событий, так как на самом деле обработчики добавляются к программе-оболочке события [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)], которая содержит реализацию перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-148">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] syntax for adding standard [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event handlers is the same for adding routed event handlers, because you are really adding handlers to the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event wrapper, which has a routed event implementation underneath.</span></span> <span data-ttu-id="e6602-149">Дополнительные сведения о добавлении обработчиков событий в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] см. в разделе [Общие сведения о языке XAML (WPF)](xaml-overview-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-149">For more information about adding event handlers in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], see [XAML Overview (WPF)](xaml-overview-wpf.md).</span></span>  
  
<a name="routing_strategies"></a>   
## <a name="routing-strategies"></a><span data-ttu-id="e6602-150">Стратегии маршрутизации</span><span class="sxs-lookup"><span data-stu-id="e6602-150">Routing Strategies</span></span>  
 <span data-ttu-id="e6602-151">Перенаправленные события используют одну из трех стратегий маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="e6602-151">Routed events use one of three routing strategies:</span></span>  
  
-   <span data-ttu-id="e6602-152">**Восходящая маршрутизация:** Вызываются обработчики событий в источник событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-152">**Bubbling:** Event handlers on the event source are invoked.</span></span> <span data-ttu-id="e6602-153">Перенаправленное событие затем следует к родительским элементам до достижения корневого элемента дерева.</span><span class="sxs-lookup"><span data-stu-id="e6602-153">The routed event then routes to successive parent elements until reaching the element tree root.</span></span> <span data-ttu-id="e6602-154">Большинство перенаправленных событий используют стратегию восходящей маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="e6602-154">Most routed events use the bubbling routing strategy.</span></span> <span data-ttu-id="e6602-155">События восходящей маршрутизации обычно используются для получения отчета об изменении входных данных или состояния от различных элементов управления или других элементов пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e6602-155">Bubbling routed events are generally used to report input or state changes from distinct controls or other UI elements.</span></span>  
  
-   <span data-ttu-id="e6602-156">**Direct:** Только элемент-источник события имеет возможность вызывать обработчики в ответ.</span><span class="sxs-lookup"><span data-stu-id="e6602-156">**Direct:** Only the source element itself is given the opportunity to invoke handlers in response.</span></span> <span data-ttu-id="e6602-157">Это является аналогом "маршрутизации", которая используется [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] для события.</span><span class="sxs-lookup"><span data-stu-id="e6602-157">This is analogous to the "routing" that [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] uses for events.</span></span> <span data-ttu-id="e6602-158">Тем не менее, в отличие от стандартного [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] событий, прямые перенаправленные события поддерживают обработку классов (обработка классов объясняется в следующем разделе) и может использоваться <xref:System.Windows.EventSetter> и <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="e6602-158">However, unlike a standard [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event, direct routed events support class handling (class handling is explained in an upcoming section) and can be used by <xref:System.Windows.EventSetter> and <xref:System.Windows.EventTrigger>.</span></span>  
  
-   <span data-ttu-id="e6602-159">**Туннелирование:** Изначально вызываются обработчики событий в корневого элемента дерева.</span><span class="sxs-lookup"><span data-stu-id="e6602-159">**Tunneling:** Initially, event handlers at the element tree root are invoked.</span></span> <span data-ttu-id="e6602-160">Перенаправленное событие затем передается по маршруту через последовательные дочерние элементы к узловому элементу, который является источником перенаправленного события (элементом, вызвавшим перенаправленное событие).</span><span class="sxs-lookup"><span data-stu-id="e6602-160">The routed event then travels a route through successive child elements along the route, towards the node element that is the routed event source (the element that raised the routed event).</span></span> <span data-ttu-id="e6602-161">Нисходящая маршрутизация событий часто используется или обрабатывается как часть композиции для элемента управления таким образом, что события из составных частей композиции могут намеренно подавляться или заменяться событиями, которые определены для полного контроля.</span><span class="sxs-lookup"><span data-stu-id="e6602-161">Tunneling routed events are often used or handled as part of the compositing for a control, such that events from composite parts can be deliberately suppressed or replaced by events that are specific to the complete control.</span></span> <span data-ttu-id="e6602-162">Входные события, которые содержатся в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], часто реализуются в виде пары нисходящей и восходящей маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="e6602-162">Input events provided in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] often come implemented as a tunneling/bubbling pair.</span></span> <span data-ttu-id="e6602-163">События нисходящей маршрутизации также иногда называют событиями предварительного просмотра по причине используемого для пар соглашения об именах.</span><span class="sxs-lookup"><span data-stu-id="e6602-163">Tunneling events are also sometimes referred to as Preview events, because of a naming convention that is used for the pairs.</span></span>  
  
<a name="why_use"></a>   
## <a name="why-use-routed-events"></a><span data-ttu-id="e6602-164">Зачем использовать перенаправленные события?</span><span class="sxs-lookup"><span data-stu-id="e6602-164">Why Use Routed Events?</span></span>  
 <span data-ttu-id="e6602-165">Разработчикам приложений не всегда необходимо знать, реализуется ли обрабатываемое событие как перенаправленное.</span><span class="sxs-lookup"><span data-stu-id="e6602-165">As an application developer, you do not always need to know or care that the event you are handling is implemented as a routed event.</span></span> <span data-ttu-id="e6602-166">Перенаправленные события имеют особое поведение, но такое событие остается невидимым, если обрабатывается в элементе, где оно возникает.</span><span class="sxs-lookup"><span data-stu-id="e6602-166">Routed events have special behavior, but that behavior is largely invisible if you are handling an event on the element where it is raised.</span></span>  
  
 <span data-ttu-id="e6602-167">Перенаправленные события являются мощным инструментом при использовании их в одном из предлагаемых сценариев: при определении общих обработчиков для общего корня, при композиции собственного элемента управления или при определении собственного класса пользовательского элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e6602-167">Where routed events become powerful is if you use any of the suggested scenarios: defining common handlers at a common root, compositing your own control, or defining your own custom control class.</span></span>  
  
 <span data-ttu-id="e6602-168">Прослушиватели перенаправленных событий и источники перенаправленных событий не требуются для совместного использования общего события в их иерархии.</span><span class="sxs-lookup"><span data-stu-id="e6602-168">Routed event listeners and routed event sources do not need to share a common event in their hierarchy.</span></span> <span data-ttu-id="e6602-169">Любой <xref:System.Windows.UIElement> или <xref:System.Windows.ContentElement> может быть прослушивателем перенаправленных событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-169">Any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> can be an event listener for any routed event.</span></span> <span data-ttu-id="e6602-170">Таким образом, можно использовать полный набор перенаправленных событий, доступных во всем рабочем [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] как концептуальный "интерфейс", посредством чего разнородные элементы в приложении могут обмениваться данными о событиях.</span><span class="sxs-lookup"><span data-stu-id="e6602-170">Therefore, you can use the full set of routed events available throughout the working [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] set as a conceptual "interface" whereby disparate elements in the application can exchange event information.</span></span> <span data-ttu-id="e6602-171">Эта концепция "интерфейса" для перенаправленных событий особенно применима для событий ввода.</span><span class="sxs-lookup"><span data-stu-id="e6602-171">This "interface" concept for routed events is particularly applicable for input events.</span></span>  
  
 <span data-ttu-id="e6602-172">Перенаправленные события могут также использоваться для связи элементов дерева, так как данные событий сохраняются для каждого элемента в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-172">Routed events can also be used to communicate through the element tree, because the event data for the event is perpetuated to each element in the route.</span></span> <span data-ttu-id="e6602-173">Один элемент может изменить что-либо в данных события, и это изменение будет доступно для следующего элемента в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-173">One element could change something in the event data, and that change would be available to the next element in the route.</span></span>  
  
 <span data-ttu-id="e6602-174">Помимо маршрутизации, существуют еще две причины реализации события [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] в качестве перенаправленного события вместо стандартного события [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6602-174">Other than the routing aspect, there are two other reasons that any given [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event might be implemented as a routed event instead of a standard [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] event.</span></span> <span data-ttu-id="e6602-175">При реализации собственных событий рекомендуется учитывать приведенные далее принципы.</span><span class="sxs-lookup"><span data-stu-id="e6602-175">If you are implementing your own events, you might also consider these principles:</span></span>  
  
-   <span data-ttu-id="e6602-176">Определенные [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Стилизация и использование шаблонов функции, такие как <xref:System.Windows.EventSetter> и <xref:System.Windows.EventTrigger> требуется указанное событие было перенаправленным.</span><span class="sxs-lookup"><span data-stu-id="e6602-176">Certain [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] styling and templating features such as <xref:System.Windows.EventSetter> and <xref:System.Windows.EventTrigger> require the referenced event to be a routed event.</span></span> <span data-ttu-id="e6602-177">Это сценарий идентификатора события, упомянутого выше.</span><span class="sxs-lookup"><span data-stu-id="e6602-177">This is the event identifier scenario mentioned earlier.</span></span>  
  
-   <span data-ttu-id="e6602-178">Перенаправленные события поддерживают механизм обработки классов, в силу чего класс может указывать статические методы, имеющие возможность обрабатывать перенаправленные события до того, как любой зарегистрированный обработчик экземпляров сможет получить к ним доступ.</span><span class="sxs-lookup"><span data-stu-id="e6602-178">Routed events support a class handling mechanism whereby the class can specify static methods that have the opportunity to handle routed events before any registered instance handlers can access them.</span></span> <span data-ttu-id="e6602-179">Это очень полезно при разработке элемента управления, поскольку класс может управляться с помощью событий, что не может быть случайно подавлено обработкой события в экземпляре.</span><span class="sxs-lookup"><span data-stu-id="e6602-179">This is very useful in control design, because your class can enforce event-driven class behaviors that cannot be accidentally suppressed by handling an event on an instance.</span></span>  
  
 <span data-ttu-id="e6602-180">Каждое из описанных выше рассуждений рассматривается в отдельной части этого раздела.</span><span class="sxs-lookup"><span data-stu-id="e6602-180">Each of the above considerations is discussed in a separate section of this topic.</span></span>  
  
<a name="event_handing"></a>   
## <a name="adding-and-implementing-an-event-handler-for-a-routed-event"></a><span data-ttu-id="e6602-181">Добавление и реализация обработчика событий для перенаправленного события</span><span class="sxs-lookup"><span data-stu-id="e6602-181">Adding and Implementing an Event Handler for a Routed Event</span></span>  
 <span data-ttu-id="e6602-182">Чтобы добавить обработчик событий в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], просто добавьте имя события в элемент как атрибут и установите значение атрибута в качестве имени обработчика событий, который реализует соответствующий делегат, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="e6602-182">To add an event handler in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], you simply add the event name to an element as an attribute and set the attribute value as the name of the event handler that implements an appropriate delegate, as in the following example.</span></span>  
  
 [!code-xaml[EventOvwSupport#SimplestSyntax](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#simplestsyntax)]  
  
 `b1SetColor` <span data-ttu-id="e6602-183">— имя реализуемого обработчика, который содержит код, который обрабатывает <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-183">is the name of the implemented handler that contains the code that handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event.</span></span> `b1SetColor` <span data-ttu-id="e6602-184">должен иметь ту же сигнатуру, что <xref:System.Windows.RoutedEventHandler> делегат, который является делегатом обработчика событий для <xref:System.Windows.Controls.Primitives.ButtonBase.Click> событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-184">must have the same signature as the <xref:System.Windows.RoutedEventHandler> delegate, which is the event handler delegate for the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event.</span></span> <span data-ttu-id="e6602-185">Первый параметр всех делегатов обработчиков перенаправленных событий указывает элемент, к которому добавляется обработчик событий, а второй параметр указывает данные для события.</span><span class="sxs-lookup"><span data-stu-id="e6602-185">The first parameter of all routed event handler delegates specifies the element to which the event handler is added, and the second parameter specifies the data for the event.</span></span>  
  
[!code-csharp[EventOvwSupport#SimpleHandlerA](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#simplehandlera)]
[!code-vb[EventOvwSupport#SimpleHandlerA](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#simplehandlera)]  
  
 <xref:System.Windows.RoutedEventHandler> <span data-ttu-id="e6602-186">является делегатом обработчика перенаправленных событий basic.</span><span class="sxs-lookup"><span data-stu-id="e6602-186">is the basic routed event handler delegate.</span></span> <span data-ttu-id="e6602-187">Для перенаправленных событий, которые являются специализированными для определенных элементов управления или скриптов, делегаты, которые используются для обработчиков перенаправленных событий, также могут быть более специализированными, чтобы они могли передавать определенные данные события.</span><span class="sxs-lookup"><span data-stu-id="e6602-187">For routed events that are specialized for certain controls or scenarios, the delegates to use for the routed event handlers also might become more specialized, so that they can transmit specialized event data.</span></span> <span data-ttu-id="e6602-188">Например, в общем сценарии ввода можно обработать <xref:System.Windows.UIElement.DragEnter> перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-188">For instance, in a common input scenario, you might handle a <xref:System.Windows.UIElement.DragEnter> routed event.</span></span> <span data-ttu-id="e6602-189">Обработчик должен реализовывать <xref:System.Windows.DragEventHandler> делегировать.</span><span class="sxs-lookup"><span data-stu-id="e6602-189">Your handler should implement the <xref:System.Windows.DragEventHandler> delegate.</span></span> <span data-ttu-id="e6602-190">С помощью наиболее конкретного делегата, можно обработать <xref:System.Windows.DragEventArgs> в обработчике событий и прочитать <xref:System.Windows.DragEventArgs.Data%2A> свойство, которое содержит полезные данные буфера обмена операции перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="e6602-190">By using the most specific delegate, you can process the <xref:System.Windows.DragEventArgs> in the handler and read the <xref:System.Windows.DragEventArgs.Data%2A> property, which contains the clipboard payload of the drag operation.</span></span>  
  
 <span data-ttu-id="e6602-191">Полный пример добавления обработчика событий к элементу с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] см. в разделе [Обработка перенаправленных событий](how-to-handle-a-routed-event.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-191">For a complete example of how to add an event handler to an element using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], see [Handle a Routed Event](how-to-handle-a-routed-event.md).</span></span>  
  
 <span data-ttu-id="e6602-192">Добавить обработчик для перенаправленного события в приложении, созданном в коде, достаточно просто.</span><span class="sxs-lookup"><span data-stu-id="e6602-192">Adding a handler for a routed event in an application that is created in code is straightforward.</span></span> <span data-ttu-id="e6602-193">Обработчики перенаправленных событий всегда можно добавлять с помощью вспомогательного метода <xref:System.Windows.UIElement.AddHandler%2A> (который является тот же метод, который вызывает резервной копией для `add`.) Однако существующие перенаправленные события  [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] обычно имеют резервную реализацию `add` и логику `remove`, позволяющую добавлять обработчики перенаправленных событий с помощью синтаксиса событий для определенного языка, являющегося более понятным, чем вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="e6602-193">Routed event handlers can always be added through a helper method <xref:System.Windows.UIElement.AddHandler%2A> (which is the same method that the existing backing calls for `add`.) However, existing [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] routed events generally have backing implementations of `add` and `remove` logic that allow the handlers for routed events to be added by a language-specific event syntax, which is more intuitive syntax than the helper method.</span></span> <span data-ttu-id="e6602-194">Ниже приведен пример использования вспомогательного метода.</span><span class="sxs-lookup"><span data-stu-id="e6602-194">The following is an example usage of the helper method:</span></span>  
  
 [!code-csharp[EventOvwSupport#AddHandlerCode](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#addhandlercode)]
 [!code-vb[EventOvwSupport#AddHandlerCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#addhandlercode)]  
  
 <span data-ttu-id="e6602-195">В следующем примере показан C# синтаксис оператора (Visual Basic имеет немного другой синтаксис оператора из-за обработки разыменовывания):</span><span class="sxs-lookup"><span data-stu-id="e6602-195">The next example shows the C# operator syntax (Visual Basic has slightly different operator syntax because of its handling of dereferencing):</span></span>  
  
 [!code-csharp[EventOvwSupport#AddHandlerPlusEquals](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#addhandlerplusequals)]
 [!code-vb[EventOvwSupport#AddHandlerPlusEquals](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#addhandlerplusequals)]  
  
 <span data-ttu-id="e6602-196">Пример добавления обработчика событий в коде см. в разделе [Добавление обработчика событий с помощью кода](how-to-add-an-event-handler-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-196">For an example of how to add an event handler in code, see [Add an Event Handler Using Code](how-to-add-an-event-handler-using-code.md).</span></span>  
  
 <span data-ttu-id="e6602-197">Если вы используете Visual Basic, можно также использовать `Handles` ключевое слово, чтобы добавить обработчик как часть объявлений обработчика.</span><span class="sxs-lookup"><span data-stu-id="e6602-197">If you are using Visual Basic, you can also use the `Handles` keyword to add handlers as part of the handler declarations.</span></span> <span data-ttu-id="e6602-198">Дополнительные сведения см. в разделе [Обработка событий в Visual Basic и WPF](visual-basic-and-wpf-event-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-198">For more information, see [Visual Basic and WPF Event Handling](visual-basic-and-wpf-event-handling.md).</span></span>  
  
<a name="concept_handled"></a>   
### <a name="the-concept-of-handled"></a><span data-ttu-id="e6602-199">Концепция обработанных событий</span><span class="sxs-lookup"><span data-stu-id="e6602-199">The Concept of Handled</span></span>  
 <span data-ttu-id="e6602-200">Все перенаправленные события совместно используют общий базовый класс данных события, <xref:System.Windows.RoutedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="e6602-200">All routed events share a common event data base class, <xref:System.Windows.RoutedEventArgs>.</span></span> <xref:System.Windows.RoutedEventArgs> <span data-ttu-id="e6602-201">Определяет <xref:System.Windows.RoutedEventArgs.Handled%2A> свойство, которое принимает логическое значение.</span><span class="sxs-lookup"><span data-stu-id="e6602-201">defines the <xref:System.Windows.RoutedEventArgs.Handled%2A> property, which takes a Boolean value.</span></span> <span data-ttu-id="e6602-202">Цель <xref:System.Windows.RoutedEventArgs.Handled%2A> свойство является включение любой обработчик событий в маршруте мог отметить перенаправленное событие как *обрабатываются*, его значение <xref:System.Windows.RoutedEventArgs.Handled%2A> для `true`.</span><span class="sxs-lookup"><span data-stu-id="e6602-202">The purpose of the <xref:System.Windows.RoutedEventArgs.Handled%2A> property is to enable any event handler along the route to mark the routed event as *handled*, by setting the value of <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span> <span data-ttu-id="e6602-203">После обработки обработчиком в одном элементе в маршруте совместно используемые данные события снова предоставляются каждому прослушивателю в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-203">After being processed by the handler at one element along the route, the shared event data is again reported to each listener along the route.</span></span>  
  
 <span data-ttu-id="e6602-204">Значение <xref:System.Windows.RoutedEventArgs.Handled%2A> влияет на перенаправленное событие сообщил или обрабатываются во время их передачи дальнейшего в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-204">The value of <xref:System.Windows.RoutedEventArgs.Handled%2A> affects how a routed event is reported or processed as it travels further along the route.</span></span> <span data-ttu-id="e6602-205">Если <xref:System.Windows.RoutedEventArgs.Handled%2A> является `true` событий данные для перенаправленного события, а затем обработчики, которые прослушивают перенаправляемые события на другие элементы, обычно больше не вызываются для этого конкретного экземпляра события.</span><span class="sxs-lookup"><span data-stu-id="e6602-205">If <xref:System.Windows.RoutedEventArgs.Handled%2A> is `true` in the event data for a routed event, then handlers that listen for that routed event on other elements are generally no longer invoked for that particular event instance.</span></span> <span data-ttu-id="e6602-206">Это справедливо как для обработчиков, присоединенных к [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], так и для обработчиков, добавленных с помощью синтаксиса присоединения обработчика событий конкретного языка, например `+=` или `Handles`.</span><span class="sxs-lookup"><span data-stu-id="e6602-206">This is true both for handlers attached in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and for handlers added by language-specific event handler attachment syntaxes such as `+=` or `Handles`.</span></span> <span data-ttu-id="e6602-207">Для наиболее общих сценариев обработки Пометка события как обработанного путем присвоения <xref:System.Windows.RoutedEventArgs.Handled%2A> для `true` будет «stop» нисходящую или восходящую маршрутизацию событий, а также для любого события, которое обрабатывается в точке маршрута обработчиком классов маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="e6602-207">For most common handler scenarios, marking an event as handled by setting <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` will "stop" routing for either a tunneling route or a bubbling route, and also for any event that is handled at a point in the route by a class handler.</span></span>  
  
 <span data-ttu-id="e6602-208">Тем не менее, отсутствует «handledEventsToo» механизм, посредством которого прослушиватели могут по-прежнему запускать обработчики в ответ на перенаправляемые события где <xref:System.Windows.RoutedEventArgs.Handled%2A> является `true` в данных события.</span><span class="sxs-lookup"><span data-stu-id="e6602-208">However, there is a "handledEventsToo" mechanism whereby listeners can still run handlers in response to routed events where <xref:System.Windows.RoutedEventArgs.Handled%2A> is `true` in the event data.</span></span> <span data-ttu-id="e6602-209">Другими словами, маршрут события в действительности не останавливается при пометке события в данных события как обработанного.</span><span class="sxs-lookup"><span data-stu-id="e6602-209">In other words, the event route is not truly stopped by marking the event data as handled.</span></span> <span data-ttu-id="e6602-210">Механизм handledEventsToo можно использовать только в коде или в <xref:System.Windows.EventSetter>:</span><span class="sxs-lookup"><span data-stu-id="e6602-210">You can only use the handledEventsToo mechanism in code, or in an <xref:System.Windows.EventSetter>:</span></span>  
  
-   <span data-ttu-id="e6602-211">В коде, вместо того чтобы использовать синтаксис события определенного языка, который работает для общих [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] события, вызывать [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] метод <xref:System.Windows.UIElement.AddHandler%28System.Windows.RoutedEvent%2CSystem.Delegate%2CSystem.Boolean%29> для добавления обработчика.</span><span class="sxs-lookup"><span data-stu-id="e6602-211">In code, instead of using a language-specific event syntax that works for general [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] events, call the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] method <xref:System.Windows.UIElement.AddHandler%28System.Windows.RoutedEvent%2CSystem.Delegate%2CSystem.Boolean%29> to add your handler.</span></span> <span data-ttu-id="e6602-212">Задайте для `handledEventsToo` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="e6602-212">Specify the value of `handledEventsToo` as `true`.</span></span>  
  
-   <span data-ttu-id="e6602-213">В <xref:System.Windows.EventSetter>, задайте <xref:System.Windows.EventSetter.HandledEventsToo%2A> атрибут, который будет `true`.</span><span class="sxs-lookup"><span data-stu-id="e6602-213">In an <xref:System.Windows.EventSetter>, set the <xref:System.Windows.EventSetter.HandledEventsToo%2A> attribute to be `true`.</span></span>  
  
 <span data-ttu-id="e6602-214">Помимо поведения, <xref:System.Windows.RoutedEventArgs.Handled%2A> создает состояние в маршрутизированных событиях, концепция <xref:System.Windows.RoutedEventArgs.Handled%2A> влияет на том, как должны разрабатываться приложение и написать код обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-214">In addition to the behavior that <xref:System.Windows.RoutedEventArgs.Handled%2A> state produces in routed events, the concept of <xref:System.Windows.RoutedEventArgs.Handled%2A> has implications for how you should design your application and write the event handler code.</span></span> <span data-ttu-id="e6602-215">Можно представить <xref:System.Windows.RoutedEventArgs.Handled%2A> как простой протокол, предоставляемый перенаправленными событиями.</span><span class="sxs-lookup"><span data-stu-id="e6602-215">You can conceptualize <xref:System.Windows.RoutedEventArgs.Handled%2A> as being a simple protocol that is exposed by routed events.</span></span> <span data-ttu-id="e6602-216">Способы использования этого протокола является, однако концептуальное проектирование как значение <xref:System.Windows.RoutedEventArgs.Handled%2A> предназначен для использования выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e6602-216">Exactly how you use this protocol is up to you, but the conceptual design for how the value of <xref:System.Windows.RoutedEventArgs.Handled%2A> is intended to be used is as follows:</span></span>  
  
-   <span data-ttu-id="e6602-217">Если перенаправленное событие помечено как обработанное, то затем его не требуется снова обрабатывать другими элементами в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-217">If a routed event is marked as handled, then it does not need to be handled again by other elements along that route.</span></span>  
  
-   <span data-ttu-id="e6602-218">Если перенаправленное событие не помечено как обработанное, то либо не регистрировал обработчик или обработчики, которые были зарегистрированных разрешили использовать данные события и установили отказались другой прослушиватель, более ранний в маршруте <xref:System.Windows.RoutedEventArgs.Handled%2A> для `true`.</span><span class="sxs-lookup"><span data-stu-id="e6602-218">If a routed event is not marked as handled, then other listeners that were earlier along the route have chosen either not to register a handler, or the handlers that were registered chose not to manipulate the event data and set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span> <span data-ttu-id="e6602-219">(Или, возможно, текущий прослушиватель является первой точкой в маршруте.) Обработчики на текущем прослушивателе имеют три возможных варианта действий.</span><span class="sxs-lookup"><span data-stu-id="e6602-219">(Or, it is of course possible that the current listener is the first point in the route.) Handlers on the current listener now have three possible courses of action:</span></span>  
  
    -   <span data-ttu-id="e6602-220">Не выполнять никаких действий. Событие остается необработанным и переходит к следующему прослушивателю.</span><span class="sxs-lookup"><span data-stu-id="e6602-220">Take no action at all; the event remains unhandled, and the event routes to the next listener.</span></span>  
  
    -   <span data-ttu-id="e6602-221">Выполнить код в ответ на событие, при этом убедиться, что выполненное действие не было достаточно существенным, чтобы пометить событие как обработанное.</span><span class="sxs-lookup"><span data-stu-id="e6602-221">Execute code in response to the event, but make the determination that the action taken was not substantial enough to warrant marking the event as handled.</span></span> <span data-ttu-id="e6602-222">Событие перенаправляется к следующему прослушивателю.</span><span class="sxs-lookup"><span data-stu-id="e6602-222">The event routes to the next listener.</span></span>  
  
    -   <span data-ttu-id="e6602-223">Выполнить кода в ответ на событие.</span><span class="sxs-lookup"><span data-stu-id="e6602-223">Execute code in response to the event.</span></span> <span data-ttu-id="e6602-224">Пометить событие как обработанное в данных события, передаваемых обработчику, потому что предпринятое действие считается достаточно существенным, чтобы пометить событие как обработанное.</span><span class="sxs-lookup"><span data-stu-id="e6602-224">Mark the event as handled in the event data passed to the handler, because the action taken was deemed substantial enough to warrant marking as handled.</span></span> <span data-ttu-id="e6602-225">Событие перенаправляется к следующему прослушивателю, но с <xref:System.Windows.RoutedEventArgs.Handled%2A> = `true` в его данных события, поэтому только `handledEventsToo` прослушиватели имеют возможность вызвать следующие обработчики.</span><span class="sxs-lookup"><span data-stu-id="e6602-225">The event still routes to the next listener, but with <xref:System.Windows.RoutedEventArgs.Handled%2A>=`true` in its event data, so only `handledEventsToo` listeners have the opportunity to invoke further handlers.</span></span>  
  
 <span data-ttu-id="e6602-226">Этот концептуальный проект подкреплен описанным ранее поведением при маршрутизации: более сложным (хотя и возможным для кода и стилей) является присоединение обработчиков для перенаправленных событий, которые вызываются, даже если предыдущий обработчик маршрута уже установил <xref:System.Windows.RoutedEventArgs.Handled%2A>для `true`.</span><span class="sxs-lookup"><span data-stu-id="e6602-226">This conceptual design is reinforced by the routing behavior mentioned earlier: it is more difficult (although still possible in code or styles) to attach handlers for routed events that are invoked even if a previous handler along the route has already set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span>  
  
 <span data-ttu-id="e6602-227">Дополнительные сведения о <xref:System.Windows.RoutedEventArgs.Handled%2A>, обработка класса перенаправленных событий и рекомендации о том, когда необходимо помечать перенаправленное событие как <xref:System.Windows.RoutedEventArgs.Handled%2A>, см. в разделе [маркировка перенаправленных событий как обработанных и обработка классов](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-227">For more information about <xref:System.Windows.RoutedEventArgs.Handled%2A>, class handling of routed events, and recommendations about when it is appropriate to mark a routed event as <xref:System.Windows.RoutedEventArgs.Handled%2A>, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>  
  
 <span data-ttu-id="e6602-228">В приложениях весьма распространена обработка только перенаправляемого по восходящей события в объекте, который вызывал его, независимо от характеристик маршрутизации события.</span><span class="sxs-lookup"><span data-stu-id="e6602-228">In applications, it is quite common to just handle a bubbling routed event on the object that raised it, and not be concerned with the event's routing characteristics at all.</span></span> <span data-ttu-id="e6602-229">Однако все же рекомендуется помечать перенаправленное событие как обработанное в данных события, чтобы избежать непредвиденных побочных эффектов на случай, если элемент, который далее следует в дереве элементов, имеет вложенный обработчик для этого же перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-229">However, it is still a good practice to mark the routed event as handled in the event data, to prevent unanticipated side effects just in case an element that is further up the element tree also has a handler attached for that same routed event.</span></span>  
  
<a name="class_handlers"></a>   
## <a name="class-handlers"></a><span data-ttu-id="e6602-230">Обработчики классов</span><span class="sxs-lookup"><span data-stu-id="e6602-230">Class Handlers</span></span>  
 <span data-ttu-id="e6602-231">При определении класса, производного каким-либо образом из <xref:System.Windows.DependencyObject>, можно также определить и присоединить обработчик класса для перенаправленного события, который является объявленным или унаследованным элементом события класса.</span><span class="sxs-lookup"><span data-stu-id="e6602-231">If you are defining a class that derives in some way from <xref:System.Windows.DependencyObject>, you can also define and attach a class handler for a routed event that is a declared or inherited event member of your class.</span></span> <span data-ttu-id="e6602-232">Обработчики классов вызываются ранее любого обработчика прослушивателей экземпляров, присоединенного к экземпляру этого класса, всякий раз, когда перенаправленное событие встречает экземпляр элемента в своем маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-232">Class handlers are invoked before any instance listener handlers that are attached to an instance of that class, whenever a routed event reaches an element instance in its route.</span></span>  
  
 <span data-ttu-id="e6602-233">Некоторые элементы управления [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] имеют внутреннюю обработку классов для некоторых перенаправленных событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-233">Some [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] controls have inherent class handling for certain routed events.</span></span> <span data-ttu-id="e6602-234">Может показаться, что перенаправленное событие не возникает никогда, но на самом деле оно обрабатывается классом и перенаправленное событие по-прежнему может потенциально обрабатываться с помощью обработчиков экземпляров при использовании определенных методов.</span><span class="sxs-lookup"><span data-stu-id="e6602-234">This might give the outward appearance that the routed event is not ever raised, but in reality it is being class handled, and the routed event can potentially still be handled by your instance handlers if you use certain techniques.</span></span> <span data-ttu-id="e6602-235">Кроме того, многие базовые классы и элементы управления предоставляют виртуальные методы, которые могут быть использованы для переопределения поведения при обработке классов.</span><span class="sxs-lookup"><span data-stu-id="e6602-235">Also, many base classes and controls expose virtual methods that can be used to override class handling behavior.</span></span> <span data-ttu-id="e6602-236">Дополнительные сведения о том, как обрабатывать нежелательные классы и как определить обработку собственного класса в пользовательском классе, см. в разделе [Маркировка перенаправленных событий как обработанных и обработка классов](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-236">For more information both on how to work around undesired class handling and on defining your own class handling in a custom class, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>  
  
<a name="attached_events"></a>   
## <a name="attached-events-in-wpf"></a><span data-ttu-id="e6602-237">Вложенные события в WPF</span><span class="sxs-lookup"><span data-stu-id="e6602-237">Attached Events in WPF</span></span>  
 <span data-ttu-id="e6602-238">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] также определяет специальный тип события, называемого *вложенным событием*.</span><span class="sxs-lookup"><span data-stu-id="e6602-238">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] language also defines a special type of event called an *attached event*.</span></span> <span data-ttu-id="e6602-239">Вложенное событие позволяет добавлять обработчик для конкретного события в произвольный элемент.</span><span class="sxs-lookup"><span data-stu-id="e6602-239">An attached event enables you to add a handler for a particular event to an arbitrary element.</span></span> <span data-ttu-id="e6602-240">Элементу, обрабатывающему событие, не требуется определять или наследовать вложенное событие, и ни объект, который потенциально может вызвать событие, ни экземпляр обработки места назначения не должны определять или каким-либо иным способом владеть этим событием в качестве элемента класса.</span><span class="sxs-lookup"><span data-stu-id="e6602-240">The element handling the event need not define or inherit the attached event, and neither the object potentially raising the event nor the destination handling instance must define or otherwise "own" that event as a class member.</span></span>  
  
 <span data-ttu-id="e6602-241">Система ввода [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] широко использует вложенные события.</span><span class="sxs-lookup"><span data-stu-id="e6602-241">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] input system uses attached events extensively.</span></span> <span data-ttu-id="e6602-242">Однако практически все эти вложенные события перенаправляются через базовые элементы.</span><span class="sxs-lookup"><span data-stu-id="e6602-242">However, nearly all of these attached events are forwarded through base elements.</span></span> <span data-ttu-id="e6602-243">События ввода затем отображаются как эквивалент невложенных перенаправленных событий, которые являются членами класса базового элемента.</span><span class="sxs-lookup"><span data-stu-id="e6602-243">The input events then appear as equivalent non-attached routed events that are members of the base element class.</span></span> <span data-ttu-id="e6602-244">К примеру, присоединенное событие основной <xref:System.Windows.Input.Mouse.MouseDown?displayProperty=nameWithType> может намного легче обрабатываться на любой заданной <xref:System.Windows.UIElement> с помощью <xref:System.Windows.UIElement.MouseDown> об этом <xref:System.Windows.UIElement> вместо работы с синтаксисом присоединенных событий, либо в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] или кода.</span><span class="sxs-lookup"><span data-stu-id="e6602-244">For instance, the underlying attached event <xref:System.Windows.Input.Mouse.MouseDown?displayProperty=nameWithType> can more easily be handled on any given <xref:System.Windows.UIElement> by using <xref:System.Windows.UIElement.MouseDown> on that <xref:System.Windows.UIElement> rather than dealing with attached event syntax either in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] or code.</span></span>  
  
 <span data-ttu-id="e6602-245">Дополнительные сведения о вложенных событиях в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] см. в разделе [Общие сведения о вложенных событиях](attached-events-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-245">For more information about attached events in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Attached Events Overview](attached-events-overview.md).</span></span>  
  
<a name="Qualifying_Event_Names_in_XAML_for_Anticipated_Routing"></a>   
## <a name="qualified-event-names-in-xaml"></a><span data-ttu-id="e6602-246">Полные имена событий в XAML</span><span class="sxs-lookup"><span data-stu-id="e6602-246">Qualified Event Names in XAML</span></span>  
 <span data-ttu-id="e6602-247">Другой синтаксис напоминает синаксис *typename*. *EventName* вложенного события, но он не является синтаксисом вложенного события при присоединении обработчиков для перенаправленных событий, вызываемых дочерними элементами.</span><span class="sxs-lookup"><span data-stu-id="e6602-247">Another syntax usage that resembles *typename*.*eventname* attached event syntax but is not strictly speaking an attached event usage is when you attach handlers for routed events that are raised by child elements.</span></span> <span data-ttu-id="e6602-248">Обработчики присоединяются в общем родительском элементе, чтобы воспользоваться преимуществами маршрутизации событий, несмотря на то что общий родительский элемент может не иметь соответствующего перенаправленного события в качестве члена.</span><span class="sxs-lookup"><span data-stu-id="e6602-248">You attach the handlers to a common parent, to take advantage of event routing, even though the common parent might not have the relevant routed event as a member.</span></span> <span data-ttu-id="e6602-249">Рассмотрим этот пример еще раз.</span><span class="sxs-lookup"><span data-stu-id="e6602-249">Consider this example again:</span></span>  
  
 [!code-xaml[EventOvwSupport#GroupButton](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#groupbutton)]  
  
 <span data-ttu-id="e6602-250">Здесь является прослушивателем родительского элемента, где добавляется обработчик <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="e6602-250">Here, the parent element listener where the handler is added is a <xref:System.Windows.Controls.StackPanel>.</span></span> <span data-ttu-id="e6602-251">Тем не менее, она добавляет обработчик для перенаправленного события, который был объявлен и будет вызываться <xref:System.Windows.Controls.Button> класс (<xref:System.Windows.Controls.Primitives.ButtonBase> на самом деле, но доступен для <xref:System.Windows.Controls.Button> через наследование).</span><span class="sxs-lookup"><span data-stu-id="e6602-251">However, it is adding a handler for a routed event that was declared and will be raised by the <xref:System.Windows.Controls.Button> class (<xref:System.Windows.Controls.Primitives.ButtonBase> actually, but available to <xref:System.Windows.Controls.Button> through inheritance).</span></span> <xref:System.Windows.Controls.Button> <span data-ttu-id="e6602-252">«владеет» событием, но система перенаправленных событий позволяет обработчикам любого перенаправленного события быть присоединенными к любому <xref:System.Windows.UIElement> или <xref:System.Windows.ContentElement> прослушиватель экземпляра, в противном случае может присоединить прослушиватели для [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-252">"owns" the event, but the routed event system permits handlers for any routed event to be attached to any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> instance listener that could otherwise attach listeners for a [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] event.</span></span> <span data-ttu-id="e6602-253">Пространством имен xmlns по умолчанию для этих полных имен атрибутов событий обычно является пространство имен xmlns [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] по умолчанию, но можно также указать префиксные пространства имен для пользовательских перенаправленных событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-253">The default xmlns namespace for these qualified event attribute names is typically the default [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] xmlns namespace, but you can also specify prefixed namespaces for custom routed events.</span></span> <span data-ttu-id="e6602-254">Дополнительные сведения о xmlns см. в разделе [Пространства имен XAML и сопоставление пространств имен для WPF XAML](xaml-namespaces-and-namespace-mapping-for-wpf-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-254">For more information about xmlns, see [XAML Namespaces and Namespace Mapping for WPF XAML](xaml-namespaces-and-namespace-mapping-for-wpf-xaml.md).</span></span>  
  
<a name="how_event_processing_works"></a>   
## <a name="wpf-input-events"></a><span data-ttu-id="e6602-255">События ввода WPF</span><span class="sxs-lookup"><span data-stu-id="e6602-255">WPF Input Events</span></span>  
 <span data-ttu-id="e6602-256">Перенаправленные события в платформе [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] часто применяются для событий ввода.</span><span class="sxs-lookup"><span data-stu-id="e6602-256">One frequent application of routed events within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] platform is for input events.</span></span> <span data-ttu-id="e6602-257">В [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] имена перенаправляемых по нисходящей событий по соглашению указываются с префиксом Preview.</span><span class="sxs-lookup"><span data-stu-id="e6602-257">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], tunneling routed events names are prefixed with the word "Preview" by convention.</span></span> <span data-ttu-id="e6602-258">События ввода часто возникают попарно, одно маршрутизируется по восходящей, другое — по нисходящей.</span><span class="sxs-lookup"><span data-stu-id="e6602-258">Input events often come in pairs, with one being the bubbling event and the other being the tunneling event.</span></span> <span data-ttu-id="e6602-259">Например <xref:System.Windows.ContentElement.KeyDown> событий и <xref:System.Windows.ContentElement.PreviewKeyDown> событий имеют одинаковую сигнатуру, при этом первое является событием восходящей маршрутизации ввода, а второе — по нисходящей событий ввода.</span><span class="sxs-lookup"><span data-stu-id="e6602-259">For example, the <xref:System.Windows.ContentElement.KeyDown> event and the <xref:System.Windows.ContentElement.PreviewKeyDown> event have the same signature, with the former being the bubbling input event and the latter being the tunneling input event.</span></span> <span data-ttu-id="e6602-260">Иногда события ввода имеют только восходящую или, возможно, только прямую маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="e6602-260">Occasionally, input events only have a bubbling version, or perhaps only a direct routed version.</span></span> <span data-ttu-id="e6602-261">В документации в разделах, посвященных перенаправленным событиям, содержатся перекрестные ссылки на аналогичные перенаправленные события с альтернативной стратегией маршрутизации, если такие перенаправленные события существуют, и ссылки на разделы документации для уточнения стратегии маршрутизации каждого перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-261">In the documentation, routed event topics cross-reference similar routed events with alternative routing strategies if such routed events exist, and sections in the managed reference pages clarify the routing strategy of each routed event.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="e6602-262">входные события, возникающие попарно, реализуются так, что одно действие пользователя из входных данных, таких как нажатие кнопки мыши, последовательно вызовет оба перенаправленные события пары.</span><span class="sxs-lookup"><span data-stu-id="e6602-262">input events that come in pairs are implemented so that a single user action from input, such as a mouse button press, will raise both routed events of the pair in sequence.</span></span> <span data-ttu-id="e6602-263">Сначала вызывается событие, которое маршрутизируется по нисходящей.</span><span class="sxs-lookup"><span data-stu-id="e6602-263">First, the tunneling event is raised and travels its route.</span></span> <span data-ttu-id="e6602-264">Затем вызывается событие, которое маршрутизируется по восходящей.</span><span class="sxs-lookup"><span data-stu-id="e6602-264">Then the bubbling event is raised and travels its route.</span></span> <span data-ttu-id="e6602-265">Два события буквально совместно используют тот же экземпляр данных события, так как <xref:System.Windows.UIElement.RaiseEvent%2A> вызов метода в реализующем классе восходящей маршрутизации событие, которое ожидает передачи данных для данных события, события и повторно использует его для новых вызываемых событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-265">The two events literally share the same event data instance, because the <xref:System.Windows.UIElement.RaiseEvent%2A> method call in the implementing class that raises the bubbling event listens for the event data from the tunneling event and reuses it in the new raised event.</span></span> <span data-ttu-id="e6602-266">Прослушиватели с обработчиками для события, маршрутизирующегося по нисходящей, могут первыми пометить перенаправленное событие как обработанное (сначала обработчики классов, затем обработчики экземпляров).</span><span class="sxs-lookup"><span data-stu-id="e6602-266">Listeners with handlers for the tunneling event have the first opportunity to mark the routed event handled (class handlers first, then instance handlers).</span></span> <span data-ttu-id="e6602-267">Если элемент при нисходящей маршрутизации отметил перенаправленное событие как обработанное, уже обработанные данные события отправляются для события, маршрутизирующегося по восходящей, и типичные обработчики, вложенные для эквивалентных маршрутизируемых по восходящей событий, не будут вызываться.</span><span class="sxs-lookup"><span data-stu-id="e6602-267">If an element along the tunneling route marked the routed event as handled, the already-handled event data is sent on for the bubbling event, and typical handlers attached for the equivalent bubbling input events will not be invoked.</span></span> <span data-ttu-id="e6602-268">Внешне это будет выглядеть так, как будто обработанное маршрутизируемое по восходящей событие и не вызывалось.</span><span class="sxs-lookup"><span data-stu-id="e6602-268">To outward appearances it will be as if the handled bubbling event has not even been raised.</span></span> <span data-ttu-id="e6602-269">Поведение при обработке полезно использовать при композиции элементов управления, где требуется, чтобы конечный элемент управления (а не его составные части) создавал отчеты о событиях проверки нажатия при вводе или событиях ввода на основе фокуса.</span><span class="sxs-lookup"><span data-stu-id="e6602-269">This handling behavior is useful for control compositing, where you might want all hit-test based input events or focus-based input events to be reported by your final control, rather than its composite parts.</span></span> <span data-ttu-id="e6602-270">Конечный элемент управления находится ближе к корневому элементу в композиции и поэтому имеет возможность обработать событие, передаваемое по нисходящей, первым и, возможно, "заменить" это перенаправленное событие более подходящим для данного элемента управления как часть кода, которая резервирует класс элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e6602-270">The final control element is closer to the root in the compositing, and therefore has the opportunity to class handle the tunneling event first and perhaps to "replace" that routed event with a more control-specific event, as part of the code that backs the control class.</span></span>  
  
 <span data-ttu-id="e6602-271">В качестве иллюстрации того, как обрабатываются события ввода, рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="e6602-271">As an illustration of how input event processing works, consider the following input event example.</span></span> <span data-ttu-id="e6602-272">На следующем рисунке дерева `leaf element #2` является источником событий `PreviewMouseDown` и `MouseDown`.</span><span class="sxs-lookup"><span data-stu-id="e6602-272">In the following tree illustration, `leaf element #2` is the source of both a `PreviewMouseDown` and then a `MouseDown` event.</span></span>  
  
 <span data-ttu-id="e6602-273">![Схема маршрутизации события](./media/wcsdkcoreinputevents.png "wcsdkCoreInputEvents")</span><span class="sxs-lookup"><span data-stu-id="e6602-273">![Event routing diagram](./media/wcsdkcoreinputevents.png "wcsdkCoreInputEvents")</span></span>  
<span data-ttu-id="e6602-274">Восходящая и нисходящая маршрутизация событий ввода</span><span class="sxs-lookup"><span data-stu-id="e6602-274">Input Event Bubbling and Tunneling</span></span>  
  
 <span data-ttu-id="e6602-275">Порядок обработки событий выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="e6602-275">The order of event processing is as follows:</span></span>  
  
1. `PreviewMouseDown` <span data-ttu-id="e6602-276">(нисходящее) на корневом элементе.</span><span class="sxs-lookup"><span data-stu-id="e6602-276">(tunnel) on root element.</span></span>  
  
2. `PreviewMouseDown` <span data-ttu-id="e6602-277">(нисходящее) на промежуточном элементе #1.</span><span class="sxs-lookup"><span data-stu-id="e6602-277">(tunnel) on intermediate element #1.</span></span>  
  
3. `PreviewMouseDown` <span data-ttu-id="e6602-278">(нисходящее) на исходном элементе #2.</span><span class="sxs-lookup"><span data-stu-id="e6602-278">(tunnel) on source element #2.</span></span>  
  
4. `MouseDown` <span data-ttu-id="e6602-279">(всплывающее) на исходном элементе #2.</span><span class="sxs-lookup"><span data-stu-id="e6602-279">(bubble) on source element #2.</span></span>  
  
5. `MouseDown` <span data-ttu-id="e6602-280">(всплывающее) на промежуточном элементе #1.</span><span class="sxs-lookup"><span data-stu-id="e6602-280">(bubble) on intermediate element #1.</span></span>  
  
6. `MouseDown` <span data-ttu-id="e6602-281">(всплывающее) на корневом элементе.</span><span class="sxs-lookup"><span data-stu-id="e6602-281">(bubble) on root element.</span></span>  
  
 <span data-ttu-id="e6602-282">Делегат обработчика перенаправленных событий содержит ссылки на два объекта: объект, который вызвал событие, и объект, в котором был вызван обработчик.</span><span class="sxs-lookup"><span data-stu-id="e6602-282">A routed event handler delegate provides references to two objects: the object that raised the event and the object where the handler was invoked.</span></span> <span data-ttu-id="e6602-283">Объект, в котором был вызван обработчик, указывается с помощью параметра `sender`.</span><span class="sxs-lookup"><span data-stu-id="e6602-283">The object where the handler was invoked is the object reported by the `sender` parameter.</span></span> <span data-ttu-id="e6602-284">Объект, где было вызвано событие сообщает <xref:System.Windows.RoutedEventArgs.Source%2A> свойство в данных события.</span><span class="sxs-lookup"><span data-stu-id="e6602-284">The object where the event was first raised is reported by the <xref:System.Windows.RoutedEventArgs.Source%2A> property in the event data.</span></span> <span data-ttu-id="e6602-285">Перенаправленное событие может по-прежнему возникает и обрабатывается один и тот же объект, в этом случае `sender` и <xref:System.Windows.RoutedEventArgs.Source%2A> идентичны (это происходит на этапах 3 и 4, в примере обработки).</span><span class="sxs-lookup"><span data-stu-id="e6602-285">A routed event can still be raised and handled by the same object, in which case `sender` and <xref:System.Windows.RoutedEventArgs.Source%2A> are identical (this is the case with Steps 3 and 4 in the event processing example list).</span></span>  
  
 <span data-ttu-id="e6602-286">Из-за нисходящей и восходящей маршрутизации родительские элементы получают события ввода, где <xref:System.Windows.RoutedEventArgs.Source%2A> является одним из их дочерних элементов.</span><span class="sxs-lookup"><span data-stu-id="e6602-286">Because of tunneling and bubbling, parent elements receive input events where the <xref:System.Windows.RoutedEventArgs.Source%2A> is one of their child elements.</span></span> <span data-ttu-id="e6602-287">При очень важно знать, что такое исходного элемента, можно определить исходный элемент, обратившись к <xref:System.Windows.RoutedEventArgs.Source%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="e6602-287">When it is important to know what the source element is, you can identify the source element by accessing the <xref:System.Windows.RoutedEventArgs.Source%2A> property.</span></span>  
  
 <span data-ttu-id="e6602-288">Как правило когда событие ввода помечено <xref:System.Windows.RoutedEventArgs.Handled%2A>, дополнительные обработчики не вызываются.</span><span class="sxs-lookup"><span data-stu-id="e6602-288">Usually, once the input event is marked <xref:System.Windows.RoutedEventArgs.Handled%2A>, further handlers are not invoked.</span></span> <span data-ttu-id="e6602-289">Обычно события ввода помечаются как обработанные сразу же после вызова обработчика, который при обработке события ввода опирается на логику приложения.</span><span class="sxs-lookup"><span data-stu-id="e6602-289">Typically, you should mark input events as handled as soon as a handler is invoked that addresses your application-specific logical handling of the meaning of the input event.</span></span>  
  
 <span data-ttu-id="e6602-290">Исключением из общего правила о <xref:System.Windows.RoutedEventArgs.Handled%2A> обработчики событий, зарегистрированные для намеренного игнорирования ввода находится в состоянии <xref:System.Windows.RoutedEventArgs.Handled%2A> состояние данных событий будет по-прежнему вызываться в маршруте.</span><span class="sxs-lookup"><span data-stu-id="e6602-290">The exception to this general statement about <xref:System.Windows.RoutedEventArgs.Handled%2A> state is that input event handlers that are registered to deliberately ignore <xref:System.Windows.RoutedEventArgs.Handled%2A> state of the event data would still be invoked along either route.</span></span> <span data-ttu-id="e6602-291">Дополнительные сведения см. в разделах [События предварительного просмотра](preview-events.md) или [Маркировка перенаправленных событий как обработанных и обработка классов](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-291">For more information, see [Preview Events](preview-events.md) or [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>  
  
 <span data-ttu-id="e6602-292">Модель общего использования данных события при нисходящей и восходящей маршрутизации и последовательный вызов сначала нисходящих, а потом всплывающих событий не обязательно выполняются для всех перенаправленных событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-292">The shared event data model between tunneling and bubbling events, and the sequential raising of first tunneling then bubbling events, is not a concept that is generally true for all routed events.</span></span> <span data-ttu-id="e6602-293">Такое поведение реализуется в зависимости от того, как устройства ввода [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] вызывают или соединяют пары событий ввода.</span><span class="sxs-lookup"><span data-stu-id="e6602-293">That behavior is specifically implemented by how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] input devices choose to raise and connect the input event pairs.</span></span> <span data-ttu-id="e6602-294">Дополнительным сценарием является реализация собственных событий ввода, но эту модель также можно реализовывать для собственных событий ввода.</span><span class="sxs-lookup"><span data-stu-id="e6602-294">Implementing your own input events is an advanced scenario, but you might choose to follow that model for your own input events also.</span></span>  
  
 <span data-ttu-id="e6602-295">В определенных классах обработка классов используется для определенных событий ввода, как правило, с целью переопределения значения событий ввода, вызываемых пользователем, и вызова новых событий.</span><span class="sxs-lookup"><span data-stu-id="e6602-295">Certain classes choose to class-handle certain input events, usually with the intent of redefining what a particular user-driven input event means within that control and raising a new event.</span></span> <span data-ttu-id="e6602-296">Дополнительные сведения см. в разделе [Маркировка перенаправленных событий как обработанных и обработка классов](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-296">For more information, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>  
  
 <span data-ttu-id="e6602-297">Дополнительные сведения о вводе данных и о том, как ввод данных и события взаимодействуют в обычных сценариях приложения, см. в разделе [Общие сведения о входных данных](input-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-297">For more information on input and how input and events interact in typical application scenarios, see [Input Overview](input-overview.md).</span></span>  
  
<a name="events_styles"></a>   
## <a name="eventsetters-and-eventtriggers"></a><span data-ttu-id="e6602-298">EventSetters и EventTriggers</span><span class="sxs-lookup"><span data-stu-id="e6602-298">EventSetters and EventTriggers</span></span>  
 <span data-ttu-id="e6602-299">В стилях, можно включить какой-либо предопределенный [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] обработки синтаксис в разметке с помощью событий <xref:System.Windows.EventSetter>.</span><span class="sxs-lookup"><span data-stu-id="e6602-299">In styles, you can include some pre-declared [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] event handling syntax in the markup by using an <xref:System.Windows.EventSetter>.</span></span> <span data-ttu-id="e6602-300">При применении стиля указанный обработчик добавляется в экземпляр стиля.</span><span class="sxs-lookup"><span data-stu-id="e6602-300">When the style is applied, the referenced handler is added to the styled instance.</span></span> <span data-ttu-id="e6602-301">Можно объявить <xref:System.Windows.EventSetter> только для перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="e6602-301">You can declare an <xref:System.Windows.EventSetter> only for a routed event.</span></span> <span data-ttu-id="e6602-302">Пример.</span><span class="sxs-lookup"><span data-stu-id="e6602-302">The following is an example.</span></span> <span data-ttu-id="e6602-303">Обратите внимание, что указанный метод `b1SetColor` находится в файле кода программной части.</span><span class="sxs-lookup"><span data-stu-id="e6602-303">Note that the `b1SetColor` method referenced here is in a code-behind file.</span></span>  
  
 [!code-xaml[EventOvwSupport#XAML2](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/page2.xaml#xaml2)]  
  
 <span data-ttu-id="e6602-304">— Это преимущество, что стиль является скорее всего, содержать много другой информации, которая могла бы применяться к любой кнопке в приложении, и необходимости <xref:System.Windows.EventSetter> быть частью этого стиля способствует повторному использованию кода даже на уровне разметки.</span><span class="sxs-lookup"><span data-stu-id="e6602-304">The advantage gained here is that the style is likely to contain a great deal of other information that could apply to any button in your application, and having the <xref:System.Windows.EventSetter> be part of that style promotes code reuse even at the markup level.</span></span> <span data-ttu-id="e6602-305">Кроме того <xref:System.Windows.EventSetter> отделяет имена методов для обработчиков один шаг вперед от Общие приложения и страницы разметки.</span><span class="sxs-lookup"><span data-stu-id="e6602-305">Also, an <xref:System.Windows.EventSetter> abstracts method names for handlers one step further away from the general application and page markup.</span></span>  
  
 <span data-ttu-id="e6602-306">Другим особым синтаксисом, который сочетает перенаправленных событий и анимации возможности [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="e6602-306">Another specialized syntax that combines the routed event and animation features of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is an <xref:System.Windows.EventTrigger>.</span></span> <span data-ttu-id="e6602-307">Как и в <xref:System.Windows.EventSetter>, только перенаправленные события могут использоваться для <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="e6602-307">As with <xref:System.Windows.EventSetter>, only routed events may be used for an <xref:System.Windows.EventTrigger>.</span></span> <span data-ttu-id="e6602-308">Как правило <xref:System.Windows.EventTrigger> объявляется как часть стиля, но <xref:System.Windows.EventTrigger> также могут быть объявлены на уровне элементов страницы как часть <xref:System.Windows.FrameworkElement.Triggers%2A> коллекции, или в <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="e6602-308">Typically, an <xref:System.Windows.EventTrigger> is declared as part of a style, but an <xref:System.Windows.EventTrigger> can also be declared on page-level elements as part of the <xref:System.Windows.FrameworkElement.Triggers%2A> collection, or in a <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="e6602-309"><xref:System.Windows.EventTrigger> Позволяет указать <xref:System.Windows.Media.Animation.Storyboard> что запускается каждый раз, когда перенаправленное событие встречает на своем маршруте элемент, который объявляет <xref:System.Windows.EventTrigger> для этого события.</span><span class="sxs-lookup"><span data-stu-id="e6602-309">An <xref:System.Windows.EventTrigger> enables you to specify a <xref:System.Windows.Media.Animation.Storyboard> that runs whenever a routed event reaches an element in its route that declares an <xref:System.Windows.EventTrigger> for that event.</span></span> <span data-ttu-id="e6602-310">Преимущество <xref:System.Windows.EventTrigger> просто обработав событие, и для запуска существующей раскадровки том, что <xref:System.Windows.EventTrigger> обеспечивает лучший контроль над раскадровкой и его поведение во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="e6602-310">The advantage of an <xref:System.Windows.EventTrigger> over just handling the event and causing it to start an existing storyboard is that an <xref:System.Windows.EventTrigger> provides better control over the storyboard and its run-time behavior.</span></span> <span data-ttu-id="e6602-311">Дополнительные сведения см. в разделе [Использование триггеров событий для управления раскадровкой после ее запуска](../graphics-multimedia/how-to-use-event-triggers-to-control-a-storyboard-after-it-starts.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-311">For more information, see [Use Event Triggers to Control a Storyboard After It Starts](../graphics-multimedia/how-to-use-event-triggers-to-control-a-storyboard-after-it-starts.md).</span></span>  
  
<a name="more_about"></a>   
## <a name="more-about-routed-events"></a><span data-ttu-id="e6602-312">Дополнительные сведения о перенаправленных событиях</span><span class="sxs-lookup"><span data-stu-id="e6602-312">More About Routed Events</span></span>  
 <span data-ttu-id="e6602-313">В этом разделе перенаправленные события рассматриваются, главным образом, с точки зрения описания основных понятий. Также приводится руководство по тому, как и когда следует отвечать на перенаправляемые события, которые уже существуют в различных базовых элементах и элементах управления.</span><span class="sxs-lookup"><span data-stu-id="e6602-313">This topic mainly discusses routed events from the perspective of describing the basic concepts and offering guidance on how and when to respond to the routed events that are already present in the various base elements and controls.</span></span> <span data-ttu-id="e6602-314">Однако можно создать собственное перенаправленное событие на пользовательском классе вместе со всей необходимой поддержкой, такой как особые для этого события классы данных и делегаты.</span><span class="sxs-lookup"><span data-stu-id="e6602-314">However, you can create your own routed event on your custom class along with all the necessary support, such as specialized event data classes and delegates.</span></span> <span data-ttu-id="e6602-315">Владельцем перенаправленного события может быть любой класс, но перенаправленные события должны вызываться и обрабатываться <xref:System.Windows.UIElement> или <xref:System.Windows.ContentElement> производные классы для практического.</span><span class="sxs-lookup"><span data-stu-id="e6602-315">The routed event owner can be any class, but routed events must be raised by and handled by <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> derived classes in order to be useful.</span></span> <span data-ttu-id="e6602-316">Дополнительные сведения о пользовательских событиях см. в разделе [Создание пользовательских событий маршрутизации](how-to-create-a-custom-routed-event.md).</span><span class="sxs-lookup"><span data-stu-id="e6602-316">For more information about custom events, see [Create a Custom Routed Event](how-to-create-a-custom-routed-event.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6602-317">См. также</span><span class="sxs-lookup"><span data-stu-id="e6602-317">See also</span></span>

- <xref:System.Windows.EventManager>
- <xref:System.Windows.RoutedEvent>
- <xref:System.Windows.RoutedEventArgs>
- [<span data-ttu-id="e6602-318">Маркировка перенаправленных событий как обработанных и обработка классов</span><span class="sxs-lookup"><span data-stu-id="e6602-318">Marking Routed Events as Handled, and Class Handling</span></span>](marking-routed-events-as-handled-and-class-handling.md)
- [<span data-ttu-id="e6602-319">Общие сведения о входных данных</span><span class="sxs-lookup"><span data-stu-id="e6602-319">Input Overview</span></span>](input-overview.md)
- [<span data-ttu-id="e6602-320">Общие сведения о системе команд</span><span class="sxs-lookup"><span data-stu-id="e6602-320">Commanding Overview</span></span>](commanding-overview.md)
- [<span data-ttu-id="e6602-321">Пользовательские свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="e6602-321">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="e6602-322">Деревья в WPF</span><span class="sxs-lookup"><span data-stu-id="e6602-322">Trees in WPF</span></span>](trees-in-wpf.md)
- [<span data-ttu-id="e6602-323">Шаблоны слабых событий</span><span class="sxs-lookup"><span data-stu-id="e6602-323">Weak Event Patterns</span></span>](weak-event-patterns.md)
