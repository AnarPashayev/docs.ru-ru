---
title: Пользовательские свойства зависимостей
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- implementing [WPF], wrappers
- registering properties [WPF]
- properties [WPF], metadata
- metadata [WPF], for properties
- custom dependency properties [WPF]
- properties [WPF], registering
- wrappers [WPF], implementing
- dependency properties [WPF], custom
ms.assetid: e6bfcfac-b10d-4f58-9f77-a864c2a2938f
ms.openlocfilehash: 27554d7e0a7e980d240e0609fe0561c2138f0aa1
ms.sourcegitcommit: d6e27023aeaffc4b5a3cb4b88685018d6284ada4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2019
ms.locfileid: "67664061"
---
# <a name="custom-dependency-properties"></a><span data-ttu-id="2946c-102">Пользовательские свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-102">Custom Dependency Properties</span></span>

<span data-ttu-id="2946c-103">В этом разделе описываются основания для создания настраиваемых свойств зависимостей для приложений [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], а также этапы и некоторые варианты реализации, которые могут повысить производительность, удобство использования и универсальность свойств.</span><span class="sxs-lookup"><span data-stu-id="2946c-103">This topic describes the reasons that [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] application developers and component authors might want to create custom dependency property, and describes the implementation steps as well as some implementation options that can improve performance, usability, or versatility of the property.</span></span>

<a name="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="2946c-104">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="2946c-104">Prerequisites</span></span>

<span data-ttu-id="2946c-105">Предполагается, что вы имеете представление о свойствах зависимостей с точки зрения потребителя существующих свойств зависимостей в классах [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и ознакомились с разделом [Общие сведения о свойствах зависимостей](dependency-properties-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-105">This topic assumes that you understand dependency properties from the perspective of a consumer of existing dependency properties on [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] classes, and have read the [Dependency Properties Overview](dependency-properties-overview.md) topic.</span></span> <span data-ttu-id="2946c-106">Чтобы выполнить примеры в этом разделе, следует также иметь представление о [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] и написании простых приложений [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-106">In order to follow the examples in this topic, you should also understand [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] and know how to write [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications.</span></span>

<a name="whatis"></a>

## <a name="what-is-a-dependency-property"></a><span data-ttu-id="2946c-107">Что такое свойство зависимостей?</span><span class="sxs-lookup"><span data-stu-id="2946c-107">What Is a Dependency Property?</span></span>

<span data-ttu-id="2946c-108">Реализовать поведение, аналогичное свойству [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)], для поддержки стилизации, привязки данных, наследования, анимации и значений по умолчанию можно путем реализации его как свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-108">You can enable what would otherwise be a [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] property to support styling, data binding, inheritance, animations, and default values by implementing it as a dependency property.</span></span> <span data-ttu-id="2946c-109">Свойства зависимостей являются свойствами, которые зарегистрированы в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] системы свойств путем вызова <xref:System.Windows.DependencyProperty.Register%2A> метод (или <xref:System.Windows.DependencyProperty.RegisterReadOnly%2A>), и снабжаются <xref:System.Windows.DependencyProperty> поле идентификатора.</span><span class="sxs-lookup"><span data-stu-id="2946c-109">Dependency properties are properties that are registered with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property system by calling the <xref:System.Windows.DependencyProperty.Register%2A> method (or <xref:System.Windows.DependencyProperty.RegisterReadOnly%2A>), and that are backed by a <xref:System.Windows.DependencyProperty> identifier field.</span></span> <span data-ttu-id="2946c-110">Свойства зависимостей могут использоваться только <xref:System.Windows.DependencyObject> типов, но <xref:System.Windows.DependencyObject> находится достаточно высоко в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] иерархии классов, поэтому большинство классов, доступных в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] могут поддерживать свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-110">Dependency properties can be used only by <xref:System.Windows.DependencyObject> types, but <xref:System.Windows.DependencyObject> is quite high in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] class hierarchy, so the majority of classes available in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] can support dependency properties.</span></span> <span data-ttu-id="2946c-111">Дополнительные сведения о свойствах зависимостей и некоторых терминах и соглашениях, используемых для их описания в этом [!INCLUDE[TLA2#tla_sdk](../../../../includes/tla2sharptla-sdk-md.md)], см. в разделе [Общие сведения о свойствах зависимостей](dependency-properties-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-111">For more information about dependency properties and some of the terminology and conventions used for describing them in this [!INCLUDE[TLA2#tla_sdk](../../../../includes/tla2sharptla-sdk-md.md)], see [Dependency Properties Overview](dependency-properties-overview.md).</span></span>

<a name="example_dp"></a>

## <a name="examples-of-dependency-properties"></a><span data-ttu-id="2946c-112">Примеры свойств зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-112">Examples of Dependency Properties</span></span>

<span data-ttu-id="2946c-113">Примеры свойств зависимостей, реализуемых в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] классы включают <xref:System.Windows.Controls.Control.Background%2A> свойство, <xref:System.Windows.FrameworkElement.Width%2A> свойство и <xref:System.Windows.Controls.TextBox.Text%2A> свойство среди многих других.</span><span class="sxs-lookup"><span data-stu-id="2946c-113">Examples of dependency properties that are implemented on [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] classes include the <xref:System.Windows.Controls.Control.Background%2A> property, the <xref:System.Windows.FrameworkElement.Width%2A> property, and the <xref:System.Windows.Controls.TextBox.Text%2A> property, among many others.</span></span> <span data-ttu-id="2946c-114">Каждое свойство зависимости, предоставленное классом имеет соответствующий открытое статическое поле типа <xref:System.Windows.DependencyProperty> на том же классе.</span><span class="sxs-lookup"><span data-stu-id="2946c-114">Each dependency property exposed by a class has a corresponding public static field of type <xref:System.Windows.DependencyProperty> exposed on that same class.</span></span> <span data-ttu-id="2946c-115">Это идентификатор для свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-115">This is the identifier for the dependency property.</span></span> <span data-ttu-id="2946c-116">Идентификатор именуется по следующему соглашению: имя свойства зависимостей, за которым следует строка `Property`.</span><span class="sxs-lookup"><span data-stu-id="2946c-116">The identifier is named using a convention: the name of the dependency property with the string `Property` appended to it.</span></span> <span data-ttu-id="2946c-117">Например, соответствующий <xref:System.Windows.DependencyProperty> поле идентификатора для <xref:System.Windows.Controls.Control.Background%2A> свойство <xref:System.Windows.Controls.Control.BackgroundProperty>.</span><span class="sxs-lookup"><span data-stu-id="2946c-117">For example, the corresponding <xref:System.Windows.DependencyProperty> identifier field for the <xref:System.Windows.Controls.Control.Background%2A> property is <xref:System.Windows.Controls.Control.BackgroundProperty>.</span></span> <span data-ttu-id="2946c-118">Идентификатор хранит сведения о свойстве зависимостей, как она была зарегистрирована, а затем идентификатор позже используется для других операций, в которых участвует свойство зависимостей, например, вызов <xref:System.Windows.DependencyObject.SetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="2946c-118">The identifier stores the information about the dependency property as it was registered, and the identifier is then used later for other operations involving the dependency property, such as calling <xref:System.Windows.DependencyObject.SetValue%2A>.</span></span>

<span data-ttu-id="2946c-119">Как упоминалось в разделе [Общие сведения о свойствах зависимостей](dependency-properties-overview.md), все свойства зависимостей в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] (за исключением наиболее присоединенных свойств) также являются свойствами [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] из-за реализации "оболочки".</span><span class="sxs-lookup"><span data-stu-id="2946c-119">As mentioned in the [Dependency Properties Overview](dependency-properties-overview.md), all dependency properties in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] (except most attached properties) are also [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] properties because of the "wrapper" implementation.</span></span> <span data-ttu-id="2946c-120">Таким образом, из кода можно получать или задавать свойства зависимостей путем вызова методов доступа [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)], определяющих оболочки таким же образом, как и для других свойств [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-120">Therefore, from code, you can get or set dependency properties by calling [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] accessors that define the wrappers in the same manner that you would use other [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] properties.</span></span> <span data-ttu-id="2946c-121">Как потребитель созданных свойств зависимостей, вы обычно не используете <xref:System.Windows.DependencyObject> методы <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A>, которые являются точки подключения к базовой системе свойств.</span><span class="sxs-lookup"><span data-stu-id="2946c-121">As a consumer of established dependency properties, you do not typically use the <xref:System.Windows.DependencyObject> methods <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A>, which are the connection point to the underlying property system.</span></span> <span data-ttu-id="2946c-122">Вместо этого существующая реализация [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] уже будет вызван свойства <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> в `get` и `set` реализации оболочки свойства, соответствующим образом используя поле идентификатора .</span><span class="sxs-lookup"><span data-stu-id="2946c-122">Rather, the existing implementation of the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] properties will have already called <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A> within the `get` and `set` wrapper implementations of the property, using the identifier field appropriately.</span></span> <span data-ttu-id="2946c-123">При собственной реализации настраиваемого свойства зависимостей вы будете определять оболочку аналогичным образом.</span><span class="sxs-lookup"><span data-stu-id="2946c-123">If you are implementing a custom dependency property yourself, then you will be defining the wrapper in a similar way.</span></span>

<a name="backing_with_dp"></a>

## <a name="when-should-you-implement-a-dependency-property"></a><span data-ttu-id="2946c-124">Почему требуется реализовывать свойство зависимостей?</span><span class="sxs-lookup"><span data-stu-id="2946c-124">When Should You Implement a Dependency Property?</span></span>

<span data-ttu-id="2946c-125">При реализации свойства в классе, до тех пор, пока ваш класс является производным от <xref:System.Windows.DependencyObject>, вы можете снабдить свое свойство с <xref:System.Windows.DependencyProperty> идентификатор и, следовательно, чтобы сделать его свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-125">When you implement a property on a class, so long as your class derives from <xref:System.Windows.DependencyObject>, you have the option to back your property with a <xref:System.Windows.DependencyProperty> identifier and thus to make it a dependency property.</span></span> <span data-ttu-id="2946c-126">Назначение свойства свойством зависимостей не всегда требуется и не всегда уместно и зависит от конкретной ситуации.</span><span class="sxs-lookup"><span data-stu-id="2946c-126">Having your property be a dependency property is not always necessary or appropriate, and will depend on your scenario needs.</span></span> <span data-ttu-id="2946c-127">В некоторых случаях достаточно просто снабдить свойство закрытым полем.</span><span class="sxs-lookup"><span data-stu-id="2946c-127">Sometimes, the typical technique of backing your property with a private field is adequate.</span></span> <span data-ttu-id="2946c-128">Тем не менее реализовать свойство как свойство зависимостей потребуется, если свойство должно поддерживать одну или несколько из следующих возможностей [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-128">However, you should implement your property as a dependency property whenever you want your property to support one or more of the following [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] capabilities:</span></span>

- <span data-ttu-id="2946c-129">Требуется, чтобы свойство было задаваемым в стиле.</span><span class="sxs-lookup"><span data-stu-id="2946c-129">You want your property to be settable in a style.</span></span> <span data-ttu-id="2946c-130">Более подробную информацию см. в разделе [Стилизация и использование шаблонов](../controls/styling-and-templating.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-130">For more information, see [Styling and Templating](../controls/styling-and-templating.md).</span></span>

- <span data-ttu-id="2946c-131">Требуется, чтобы свойство поддерживало привязку данных.</span><span class="sxs-lookup"><span data-stu-id="2946c-131">You want your property to support data binding.</span></span> <span data-ttu-id="2946c-132">Дополнительные сведения о свойствах зависимостей привязки данных см. в разделе [Привязка свойств двух элементов управления](../data/how-to-bind-the-properties-of-two-controls.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-132">For more information about data binding dependency properties, see [Bind the Properties of Two Controls](../data/how-to-bind-the-properties-of-two-controls.md).</span></span>

- <span data-ttu-id="2946c-133">Требуется, чтобы свойство было задаваемым с помощью динамической ссылки ресурса.</span><span class="sxs-lookup"><span data-stu-id="2946c-133">You want your property to be settable with a dynamic resource reference.</span></span> <span data-ttu-id="2946c-134">Дополнительные сведения см. в разделе [Ресурсы XAML](xaml-resources.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-134">For more information, see [XAML Resources](xaml-resources.md).</span></span>

- <span data-ttu-id="2946c-135">Требуется настроить автоматическое наследование значения свойства из родительского элемента в дереве элементов.</span><span class="sxs-lookup"><span data-stu-id="2946c-135">You want to inherit a property value automatically from a parent element in the element tree.</span></span> <span data-ttu-id="2946c-136">В этом случае регистрация <xref:System.Windows.DependencyProperty.RegisterAttached%2A> метод, даже при создании оболочки свойства для [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] доступа.</span><span class="sxs-lookup"><span data-stu-id="2946c-136">In this case, register with the <xref:System.Windows.DependencyProperty.RegisterAttached%2A> method, even if you also create a property wrapper for [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] access.</span></span> <span data-ttu-id="2946c-137">Дополнительные сведения см. в разделе [Наследование значения свойства](property-value-inheritance.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-137">For more information, see [Property Value Inheritance](property-value-inheritance.md).</span></span>

- <span data-ttu-id="2946c-138">Требуется, чтобы свойство поддерживало анимацию.</span><span class="sxs-lookup"><span data-stu-id="2946c-138">You want your property to be animatable.</span></span> <span data-ttu-id="2946c-139">Более подробную информацию см. в разделе [Общие сведения об эффектах анимации](../graphics-multimedia/animation-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-139">For more information, see [Animation Overview](../graphics-multimedia/animation-overview.md).</span></span>

- <span data-ttu-id="2946c-140">Требуется, чтобы система свойств сообщала об изменении предыдущего значения свойства действиями, выполняемыми системой свойств, окружением или пользователем, или путем чтения и использования стилей.</span><span class="sxs-lookup"><span data-stu-id="2946c-140">You want the property system to report when the previous value of the property has been changed by actions taken by the property system, the environment, or the user, or by reading and using styles.</span></span> <span data-ttu-id="2946c-141">Используя метаданные свойства, свойство может указывать метод обратного вызова, который будет вызываться каждый раз, когда система свойств определит, что значение свойства было однозначно изменено.</span><span class="sxs-lookup"><span data-stu-id="2946c-141">By using property metadata, your property can specify a callback method that will be invoked each time the property system determines that your property value was definitively changed.</span></span> <span data-ttu-id="2946c-142">Связанным понятием является приведение значения свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-142">A related concept is property value coercion.</span></span> <span data-ttu-id="2946c-143">Дополнительные сведения см. в разделе [Проверка и обратные вызовы свойства зависимостей](dependency-property-callbacks-and-validation.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-143">For more information, see [Dependency Property Callbacks and Validation](dependency-property-callbacks-and-validation.md).</span></span>

- <span data-ttu-id="2946c-144">Требуется использовать установленные соглашения о метаданных, которые также используются процессами [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], такими как передача сведений о том, нужно ли системе макета перестраивать визуальные компоненты элемента при изменении значения свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-144">You want to use established metadata conventions that are also used by [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] processes, such as reporting whether changing a property value should require the layout system to recompose the visuals for an element.</span></span> <span data-ttu-id="2946c-145">Или требуется возможность использовать переопределения метаданных таким образом, чтобы производные классы могли изменять основанные на метаданных характеристики, такие как значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2946c-145">Or you want to be able to use metadata overrides so that derived classes can change metadata-based characteristics such as the default value.</span></span>

- <span data-ttu-id="2946c-146">Требуется, чтобы свойства пользовательского элемента управления для получения конструктора WPF для Visual Studio поддерживают, например **свойства** редактирование окна.</span><span class="sxs-lookup"><span data-stu-id="2946c-146">You want properties of a custom control to receive Visual Studio WPF Designer support, such as **Properties** window editing.</span></span> <span data-ttu-id="2946c-147">Дополнительные сведения см. в разделе [Общие сведения о разработке элементов управления](../controls/control-authoring-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-147">For more information, see [Control Authoring Overview](../controls/control-authoring-overview.md).</span></span>

<span data-ttu-id="2946c-148">Рекомендуется рассмотреть возможность реализации сценариев путем переопределения метаданных существующего свойства зависимостей, вместо реализации совершенно нового свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-148">When you examine these scenarios, you should also consider whether you can achieve your scenario by overriding the metadata of an existing dependency property, rather than implementing a completely new property.</span></span> <span data-ttu-id="2946c-149">Практическая польза переопределения метаданных зависит от сценария и того, насколько этот сценарий схож с реализацией существующих свойств зависимостей и классов [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-149">Whether a metadata override is practical depends on your scenario and how closely that scenario resembles the implementation in existing [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] dependency properties and classes.</span></span> <span data-ttu-id="2946c-150">Дополнительные сведения о переопределении метаданных для существующих свойств см. в разделе [Метаданные свойств зависимостей](dependency-property-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-150">For more information about overriding metadata on existing properties, see [Dependency Property Metadata](dependency-property-metadata.md).</span></span>

<a name="checklist"></a>

## <a name="checklist-for-defining-a-dependency-property"></a><span data-ttu-id="2946c-151">Контрольный список определения свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-151">Checklist for Defining a Dependency Property</span></span>

<span data-ttu-id="2946c-152">Определение свойства зависимостей состоит из четырех различных понятий.</span><span class="sxs-lookup"><span data-stu-id="2946c-152">Defining a dependency property consists of four distinct concepts.</span></span> <span data-ttu-id="2946c-153">Эти понятия не обязательно являются строгими этапами процедуры, так как некоторые из них в итоге объединяются в одну строку кода в реализации.</span><span class="sxs-lookup"><span data-stu-id="2946c-153">These concepts are not necessarily strict procedural steps, because some of these end up being combined as single lines of code in the implementation:</span></span>

- <span data-ttu-id="2946c-154">(Необязательно.) Создайте метаданные для свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-154">(Optional) Create property metadata for the dependency property.</span></span>

- <span data-ttu-id="2946c-155">Зарегистрируйте имя свойства в системе свойств, указав тип владельца и тип значения свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-155">Register the property name with the property system, specifying an owner type and the type of the property value.</span></span> <span data-ttu-id="2946c-156">Также укажите метаданные свойства, если они используются.</span><span class="sxs-lookup"><span data-stu-id="2946c-156">Also specify the property metadata, if used.</span></span>

- <span data-ttu-id="2946c-157">Определение <xref:System.Windows.DependencyProperty> идентификатор, что `public` `static` `readonly` поля в типе владельца.</span><span class="sxs-lookup"><span data-stu-id="2946c-157">Define a <xref:System.Windows.DependencyProperty> identifier as a `public` `static` `readonly` field on the owner type.</span></span>

- <span data-ttu-id="2946c-158">Определите свойство-"оболочку" [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)], имя которого соответствует имени свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-158">Define a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] "wrapper" property whose name matches the name of the dependency property.</span></span> <span data-ttu-id="2946c-159">Реализуйте методы доступа `get` и `set` свойства-"оболочки" [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] для подключения к свойству зависимостей, которое оно поддерживает.</span><span class="sxs-lookup"><span data-stu-id="2946c-159">Implement the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] "wrapper" property's `get` and `set` accessors to connect with the dependency property that backs it.</span></span>

<a name="registering"></a>

### <a name="registering-the-property-with-the-property-system"></a><span data-ttu-id="2946c-160">Регистрация свойства в системе свойств</span><span class="sxs-lookup"><span data-stu-id="2946c-160">Registering the Property with the Property System</span></span>

<span data-ttu-id="2946c-161">Чтобы назначить свойство свойством зависимостей, необходимо зарегистрировать это свойство в таблице, обслуживаемой системой свойств, и предоставить ему уникальный идентификатор, используемый в качестве квалификатора для последующих операций системы свойств.</span><span class="sxs-lookup"><span data-stu-id="2946c-161">In order for your property to be a dependency property, you must register that property into a table maintained by the property system, and give it a unique identifier that is used as the qualifier for later property system operations.</span></span> <span data-ttu-id="2946c-162">Эти операции могут быть внутренними операциями или вашим собственным кодом, вызывающим систему свойств [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-162">These operations might be internal operations, or your own code calling property system [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)].</span></span> <span data-ttu-id="2946c-163">Чтобы зарегистрировать свойство, вызовите <xref:System.Windows.DependencyProperty.Register%2A> метод в теле класса (внутри класса, но вне определения любого из членов).</span><span class="sxs-lookup"><span data-stu-id="2946c-163">To register the property, you call the <xref:System.Windows.DependencyProperty.Register%2A> method within the body of your class (inside the class, but outside of any member definitions).</span></span> <span data-ttu-id="2946c-164">Поле идентификатора также предоставляется <xref:System.Windows.DependencyProperty.Register%2A> вызова метода, в качестве возвращаемого значения.</span><span class="sxs-lookup"><span data-stu-id="2946c-164">The identifier field is also provided by the <xref:System.Windows.DependencyProperty.Register%2A> method call, as the return value.</span></span> <span data-ttu-id="2946c-165">Причина, <xref:System.Windows.DependencyProperty.Register%2A> вызов выполняется за пределами другого элемента определения обусловлено это возвращаемое значение используется для назначения и создания `public` `static` `readonly` поле типа <xref:System.Windows.DependencyProperty> как часть класса.</span><span class="sxs-lookup"><span data-stu-id="2946c-165">The reason that the <xref:System.Windows.DependencyProperty.Register%2A> call is done outside of other member definitions is because you use this return value to assign and create a `public` `static` `readonly` field of type <xref:System.Windows.DependencyProperty> as part of your class.</span></span> <span data-ttu-id="2946c-166">Это поле становится идентификатором для вашего свойства зависимостей.</span><span class="sxs-lookup"><span data-stu-id="2946c-166">This field becomes the identifier for your dependency property.</span></span>

[!code-csharp[WPFAquariumSln#RegisterAG](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFAquariumSln/CSharp/WPFAquariumObjects/Class1.cs#registerag)]
[!code-vb[WPFAquariumSln#RegisterAG](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFAquariumSln/visualbasic/wpfaquariumobjects/class1.vb#registerag)]

<a name="nameconventions"></a>

### <a name="dependency-property-name-conventions"></a><span data-ttu-id="2946c-167">Соглашения об именовании свойств зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-167">Dependency Property Name Conventions</span></span>

<span data-ttu-id="2946c-168">Существуют установленные соглашения об именовании, касающиеся свойств зависимостей, которым необходимо следовать, если ситуация не является исключительной.</span><span class="sxs-lookup"><span data-stu-id="2946c-168">There are established naming conventions regarding dependency properties that you must follow in all but exceptional circumstances.</span></span>

<span data-ttu-id="2946c-169">Само свойство зависимости будет иметь базовое имя, «AquariumGraphic» пример, в котором задается как первый параметр <xref:System.Windows.DependencyProperty.Register%2A>.</span><span class="sxs-lookup"><span data-stu-id="2946c-169">The dependency property itself will have a basic name, "AquariumGraphic" as in this example, which is given as the first parameter of <xref:System.Windows.DependencyProperty.Register%2A>.</span></span> <span data-ttu-id="2946c-170">Это имя должно быть уникальным в пределах каждого регистрирующего типа.</span><span class="sxs-lookup"><span data-stu-id="2946c-170">That name must be unique within each registering type.</span></span> <span data-ttu-id="2946c-171">Считается, что свойства зависимостей, наследуемые через базовые типы, уже являются частью регистрирующего типа: имена наследуемых свойств нельзя зарегистрировать повторно.</span><span class="sxs-lookup"><span data-stu-id="2946c-171">Dependency properties inherited through base types are considered to be already part of the registering type; names of inherited properties cannot be registered again.</span></span> <span data-ttu-id="2946c-172">Однако существует способ добавления класса как владельца свойства зависимостей даже в том случае, если это свойство зависимостей не наследуется. Дополнительные сведения см. в разделе [Метаданные свойств зависимостей](dependency-property-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-172">However, there is a technique for adding a class as owner of a dependency property even when that dependency property is not inherited; for details, see [Dependency Property Metadata](dependency-property-metadata.md).</span></span>

<span data-ttu-id="2946c-173">При создании поля идентификатора назовите это поле по зарегистрированному имени свойства, добавив суффикс `Property`.</span><span class="sxs-lookup"><span data-stu-id="2946c-173">When you create the identifier field, name this field by the name of the property as you registered it, plus the suffix `Property`.</span></span> <span data-ttu-id="2946c-174">Это поле является идентификатором для свойства зависимостей, и он будет использоваться позже в качестве входных данных для <xref:System.Windows.DependencyObject.SetValue%2A> и <xref:System.Windows.DependencyObject.GetValue%2A> разрешить вызовы, которые будут выполняться в оболочках, при других кода доступ к свойству через ваш код доступе любого внешнего кода вы , системой свойств и, вероятно, [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] процессоров.</span><span class="sxs-lookup"><span data-stu-id="2946c-174">This field is your identifier for the dependency property, and it will be used later as an input for the <xref:System.Windows.DependencyObject.SetValue%2A> and <xref:System.Windows.DependencyObject.GetValue%2A> calls you will make in the wrappers, by any other code access to the property by your own code, by any external code access you allow, by the property system, and potentially by [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processors.</span></span>

> [!NOTE]
> <span data-ttu-id="2946c-175">Определение свойства зависимостей в теле класса является обычной реализацией, однако его также можно определить в статическом конструкторе класса.</span><span class="sxs-lookup"><span data-stu-id="2946c-175">Defining the dependency property in the class body is the typical implementation, but it is also possible to define a dependency property in the class static constructor.</span></span> <span data-ttu-id="2946c-176">Этот подход может оказаться целесообразным, если для инициализации свойства зависимостей требуется несколько строк кода.</span><span class="sxs-lookup"><span data-stu-id="2946c-176">This approach might make sense if you need more than one line of code to initialize the dependency property.</span></span>

<a name="wrapper1"></a>

### <a name="implementing-the-wrapper"></a><span data-ttu-id="2946c-177">Реализация "оболочки"</span><span class="sxs-lookup"><span data-stu-id="2946c-177">Implementing the "Wrapper"</span></span>

<span data-ttu-id="2946c-178">Реализация оболочки должна вызывать <xref:System.Windows.DependencyObject.GetValue%2A> в `get` реализации, и <xref:System.Windows.DependencyObject.SetValue%2A> в `set` (исходный вызов регистрации и поле показанная здесь реализация слишком для ясности).</span><span class="sxs-lookup"><span data-stu-id="2946c-178">Your wrapper implementation should call <xref:System.Windows.DependencyObject.GetValue%2A> in the `get` implementation, and <xref:System.Windows.DependencyObject.SetValue%2A> in the `set` implementation (the original registration call and field are shown here too for clarity).</span></span>

<span data-ttu-id="2946c-179">В все, кроме исключительных обстоятельствах реализации оболочки должны выполнять только <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> действия, соответственно.</span><span class="sxs-lookup"><span data-stu-id="2946c-179">In all but exceptional circumstances, your wrapper implementations should perform only the <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A> actions, respectively.</span></span> <span data-ttu-id="2946c-180">Причина этого обсуждается в разделе [Загрузка кода XAML и свойства зависимостей](xaml-loading-and-dependency-properties.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-180">The reason for this is discussed in the topic [XAML Loading and Dependency Properties](xaml-loading-and-dependency-properties.md).</span></span>

<span data-ttu-id="2946c-181">Все существующие открытые свойства зависимостей, предоставляемые для классов [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], используют эту простую модель реализации оболочки. Основные сложности обработки свойств зависимостей определяются наследуемым поведением системы свойств или реализацией через другие понятия, такие как приведение или обратные вызовы изменения свойства через метаданные свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-181">All existing public dependency properties that are provided on the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] classes use this simple wrapper implementation model; most of the complexity of how dependency properties work is either inherently a behavior of the property system, or is implemented through other concepts such as coercion or property change callbacks through property metadata.</span></span>

[!code-csharp[WPFAquariumSln#AGWithWrapper](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFAquariumSln/CSharp/WPFAquariumObjects/Class1.cs#agwithwrapper)]
[!code-vb[WPFAquariumSln#AGWithWrapper](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFAquariumSln/visualbasic/wpfaquariumobjects/class1.vb#agwithwrapper)]

<span data-ttu-id="2946c-182">Опять же, по соглашению, имя свойства-оболочки должно быть совпадает с именем, выбранным и заданным в качестве первого параметра <xref:System.Windows.DependencyProperty.Register%2A> вызов, который зарегистрировал свойство.</span><span class="sxs-lookup"><span data-stu-id="2946c-182">Again, by convention, the name of the wrapper property must be the same as the name chosen and given as first parameter of the <xref:System.Windows.DependencyProperty.Register%2A> call that registered the property.</span></span> <span data-ttu-id="2946c-183">Если свойство не следует соглашению, это не обязательно ведет к его неработоспособности, однако будет наблюдаться несколько серьезных проблем.</span><span class="sxs-lookup"><span data-stu-id="2946c-183">If your property does not follow the convention, this does not necessarily disable all possible uses, but you will encounter several notable issues:</span></span>

- <span data-ttu-id="2946c-184">Не будут работать определенные аспекты стилей и шаблонов.</span><span class="sxs-lookup"><span data-stu-id="2946c-184">Certain aspects of styles and templates will not work.</span></span>

- <span data-ttu-id="2946c-185">Большинство инструментов и конструкторов полагается на соглашения об именовании для правильной сериализации [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], а также для предоставления помощи разработчику на уровне свойств.</span><span class="sxs-lookup"><span data-stu-id="2946c-185">Most tools and designers must rely on the naming conventions to properly serialize [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], or to provide designer environment assistance at a per-property level.</span></span>

- <span data-ttu-id="2946c-186">Текущая реализация загрузчика [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] полностью обходит оболочки и основывается на соглашении об именовании при обработке значений атрибутов.</span><span class="sxs-lookup"><span data-stu-id="2946c-186">The current implementation of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] loader bypasses the wrappers entirely, and relies on the naming convention when processing attribute values.</span></span> <span data-ttu-id="2946c-187">Дополнительные сведения см. в разделе [Загрузка кода XAML и свойства зависимостей](xaml-loading-and-dependency-properties.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-187">For more information, see [XAML Loading and Dependency Properties](xaml-loading-and-dependency-properties.md).</span></span>

<a name="metadata"></a>

### <a name="property-metadata-for-a-new-dependency-property"></a><span data-ttu-id="2946c-188">Метаданные свойства для нового свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-188">Property Metadata for a New Dependency Property</span></span>

<span data-ttu-id="2946c-189">При регистрации свойства зависимостей через систему свойств создается объект метаданных, который хранит характеристики свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-189">When you register a dependency property, the registration through the property system creates a metadata object that stores property characteristics.</span></span> <span data-ttu-id="2946c-190">Многие из этих характеристик имеют значения по умолчанию, заданные в случае, если данное свойство зарегистрировано с помощью простых сигнатур <xref:System.Windows.DependencyProperty.Register%2A>.</span><span class="sxs-lookup"><span data-stu-id="2946c-190">Many of these characteristics have defaults that are set if the property is registered with the simple signatures of <xref:System.Windows.DependencyProperty.Register%2A>.</span></span> <span data-ttu-id="2946c-191">Другие сигнатуры <xref:System.Windows.DependencyProperty.Register%2A> позволяют указывать метаданные, требуемые при регистрации свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-191">Other signatures of <xref:System.Windows.DependencyProperty.Register%2A> allow you to specify the metadata that you want as you register the property.</span></span> <span data-ttu-id="2946c-192">Как правило, метаданные, задаваемые для свойства зависимостей, предполагают предоставление значений по умолчанию, применяемых для новых экземпляров, которые используют свойство.</span><span class="sxs-lookup"><span data-stu-id="2946c-192">The most common metadata given for dependency properties is to give them a default value that is applied on new instances that use the property.</span></span>

<span data-ttu-id="2946c-193">При создании свойства зависимостей, которое существует в производном классе <xref:System.Windows.FrameworkElement>, можно использовать более специализированный класс метаданных <xref:System.Windows.FrameworkPropertyMetadata> вместо базового <xref:System.Windows.PropertyMetadata> класса.</span><span class="sxs-lookup"><span data-stu-id="2946c-193">If you are creating a dependency property that exists on a derived class of <xref:System.Windows.FrameworkElement>, you can use the more specialized metadata class <xref:System.Windows.FrameworkPropertyMetadata> rather than the base <xref:System.Windows.PropertyMetadata> class.</span></span> <span data-ttu-id="2946c-194">Конструктор <xref:System.Windows.FrameworkPropertyMetadata> класс имеет несколько сигнатур, в котором можно указать различные характеристики метаданных в сочетании.</span><span class="sxs-lookup"><span data-stu-id="2946c-194">The constructor for the <xref:System.Windows.FrameworkPropertyMetadata> class has several signatures where you can specify various metadata characteristics in combination.</span></span> <span data-ttu-id="2946c-195">Если вы хотите указать только значение по умолчанию, используйте сигнатуру, которая принимает один параметр типа <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="2946c-195">If you want to specify the default value only, use the signature that takes a single parameter of type <xref:System.Object>.</span></span> <span data-ttu-id="2946c-196">Передайте этот параметр объекта как значение по умолчанию определенного типа, для свойства (предоставленное значение по умолчанию должен быть типом, указанным как `propertyType` параметр в <xref:System.Windows.DependencyProperty.Register%2A> вызова).</span><span class="sxs-lookup"><span data-stu-id="2946c-196">Pass that object parameter as a type-specific default value for your property (the default value provided must be the type you provided as the `propertyType` parameter in the <xref:System.Windows.DependencyProperty.Register%2A> call).</span></span>

<span data-ttu-id="2946c-197">Для <xref:System.Windows.FrameworkPropertyMetadata>, можно также указать флаги параметров метаданных для свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-197">For <xref:System.Windows.FrameworkPropertyMetadata>, you can also specify metadata option flags for your property.</span></span> <span data-ttu-id="2946c-198">Эти флаги преобразуются в дискретные свойства в метаданных свойства после регистрации и используются для передачи определенных условных объектов в другие процессы, например в обработчик макетов.</span><span class="sxs-lookup"><span data-stu-id="2946c-198">These flags are converted into discrete properties on the property metadata after registration and are used to communicate certain conditionals to other processes such as the layout engine.</span></span>

#### <a name="setting-appropriate-metadata-flags"></a><span data-ttu-id="2946c-199">Задание соответствующих флагов метаданных</span><span class="sxs-lookup"><span data-stu-id="2946c-199">Setting Appropriate Metadata Flags</span></span>

- <span data-ttu-id="2946c-200">Если свойство (или изменения в его значении) влияет на [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)], и в частности затрагивает как система макета размер или отрисовку элемента на странице, задайте одно или несколько из следующих флагов: <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsMeasure>, <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsArrange>, <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsRender>.</span><span class="sxs-lookup"><span data-stu-id="2946c-200">If your property (or changes in its value) affects the [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)], and in particular affects how the layout system should size or render your element in a page, set one or more of the following flags: <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsMeasure>, <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsArrange>, <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsRender>.</span></span>

  - <span data-ttu-id="2946c-201"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsMeasure> Указывает, что изменение этого свойства требует изменения для [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] подготовки отчетов, где содержащего его объекта может потребовать больше или меньше места в родительском элементе.</span><span class="sxs-lookup"><span data-stu-id="2946c-201"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsMeasure> indicates that a change to this property requires a change to [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] rendering where the containing object might require more or less space within the parent.</span></span> <span data-ttu-id="2946c-202">Например, этот флаг следует задать для свойства "Ширина".</span><span class="sxs-lookup"><span data-stu-id="2946c-202">For example, a "Width" property should have this flag set.</span></span>

  - <span data-ttu-id="2946c-203"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsArrange> Указывает, что изменение этого свойства требует изменения для [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] отрисовки, обычно не требует изменения в выделенном пространстве, однако означает, что изменилось размещение в пространстве.</span><span class="sxs-lookup"><span data-stu-id="2946c-203"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsArrange> indicates that a change to this property requires a change to [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] rendering that typically does not require a change in the dedicated space, but does indicate that the positioning within the space has changed.</span></span> <span data-ttu-id="2946c-204">Например, этот флаг следует задать для свойства "Выравнивание".</span><span class="sxs-lookup"><span data-stu-id="2946c-204">For example, an "Alignment" property should have this flag set.</span></span>

  - <span data-ttu-id="2946c-205"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsRender> Указывает, что произошло некоторое другое изменение, не повлияет на макет и измерение, но требуют повторной визуализации.</span><span class="sxs-lookup"><span data-stu-id="2946c-205"><xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsRender> indicates that some other change has occurred that will not affect layout and measure, but does require another render.</span></span> <span data-ttu-id="2946c-206">Примером будет свойство, изменяющее цвет существующего элемента, например "Фон".</span><span class="sxs-lookup"><span data-stu-id="2946c-206">An example would be a property that changes a color of an existing element, such as "Background".</span></span>

  - <span data-ttu-id="2946c-207">Эти флаги часто используются в качестве протокола в метаданных для собственных реализаций переопределения системы свойств или обратных вызовов макета.</span><span class="sxs-lookup"><span data-stu-id="2946c-207">These flags are often used as a protocol in metadata for your own override implementations of property system or layout callbacks.</span></span> <span data-ttu-id="2946c-208">Например, возможно, <xref:System.Windows.DependencyObject.OnPropertyChanged%2A> обратного вызова, который будет вызывать <xref:System.Windows.UIElement.InvalidateArrange%2A> Если любое свойство экземпляра сообщает об изменении значения и имеет <xref:System.Windows.FrameworkPropertyMetadata.AffectsArrange%2A> как `true` в своих метаданных.</span><span class="sxs-lookup"><span data-stu-id="2946c-208">For instance, you might have an <xref:System.Windows.DependencyObject.OnPropertyChanged%2A> callback that will call <xref:System.Windows.UIElement.InvalidateArrange%2A> if any property of the instance reports a value change and has <xref:System.Windows.FrameworkPropertyMetadata.AffectsArrange%2A> as `true` in its metadata.</span></span>

- <span data-ttu-id="2946c-209">Некоторые свойства могут влиять на характеристики отрисовки содержащего их родительского элемента указанными выше способами и помимо изменений в обязательном размере, упомянутых выше.</span><span class="sxs-lookup"><span data-stu-id="2946c-209">Some properties may affect the rendering characteristics of the containing parent element, in ways above and beyond the changes in required size mentioned above.</span></span> <span data-ttu-id="2946c-210">Например, <xref:System.Windows.Documents.Paragraph.MinOrphanLines%2A> свойства, используемого в модели потокового документа, где изменения этого свойства можно изменять общую отрисовку документа нефиксированного формата, содержащего абзац.</span><span class="sxs-lookup"><span data-stu-id="2946c-210">An example is the <xref:System.Windows.Documents.Paragraph.MinOrphanLines%2A> property used in the flow document model, where changes to that property can change the overall rendering of the flow document that contains the paragraph.</span></span> <span data-ttu-id="2946c-211">Используйте <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsParentArrange> или <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsParentMeasure> для определения аналогичных случаев в ваших собственных свойствах.</span><span class="sxs-lookup"><span data-stu-id="2946c-211">Use <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsParentArrange> or <xref:System.Windows.FrameworkPropertyMetadataOptions.AffectsParentMeasure> to identify similar cases in your own properties.</span></span>

- <span data-ttu-id="2946c-212">По умолчанию свойства зависимостей поддерживают привязку данных.</span><span class="sxs-lookup"><span data-stu-id="2946c-212">By default, dependency properties support data binding.</span></span> <span data-ttu-id="2946c-213">Вы можете специально отключить привязку данных для случаев, когда отсутствует практический смысл в привязке данных или когда быстродействие в привязке данных для больших объектов становится проблемой.</span><span class="sxs-lookup"><span data-stu-id="2946c-213">You can deliberately disable data binding, for cases where there is no realistic scenario for data binding, or where performance in data binding for a large object is recognized as a problem.</span></span>

- <span data-ttu-id="2946c-214">По умолчанию, привязка данных <xref:System.Windows.Data.Binding.Mode%2A> для значений по умолчанию свойства зависимостей для <xref:System.Windows.Data.BindingMode.OneWay>.</span><span class="sxs-lookup"><span data-stu-id="2946c-214">By default, data binding <xref:System.Windows.Data.Binding.Mode%2A> for dependency properties defaults to <xref:System.Windows.Data.BindingMode.OneWay>.</span></span> <span data-ttu-id="2946c-215">Можно всегда изменить привязки на <xref:System.Windows.Data.BindingMode.TwoWay> каждого экземпляра привязки; Дополнительные сведения см. в разделе [Указание направления привязки](../data/how-to-specify-the-direction-of-the-binding.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-215">You can always change the binding to be <xref:System.Windows.Data.BindingMode.TwoWay> per binding instance; for details, see [Specify the Direction of the Binding](../data/how-to-specify-the-direction-of-the-binding.md).</span></span> <span data-ttu-id="2946c-216">Но как автор свойства зависимостей, можно использовать свойство <xref:System.Windows.Data.BindingMode.TwoWay> режима привязки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2946c-216">But as the dependency property author, you can choose to make the property use <xref:System.Windows.Data.BindingMode.TwoWay> binding mode by default.</span></span> <span data-ttu-id="2946c-217">Примером существующего свойства зависимости является <xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A?displayProperty=nameWithType>; сценарий для этого свойства является то, что <xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A> параметр логики и компоновки <xref:System.Windows.Controls.MenuItem> взаимодействовать со стилями темы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2946c-217">An example of an existing dependency property is <xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A?displayProperty=nameWithType>; the scenario for this property is that the <xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A> setting logic and the compositing of <xref:System.Windows.Controls.MenuItem> interact with the default theme style.</span></span> <span data-ttu-id="2946c-218"><xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A> Свойство логики изначально использует привязку данных для поддержания состояния свойства в соответствии с другими свойствами состояния и вызовы методов.</span><span class="sxs-lookup"><span data-stu-id="2946c-218">The <xref:System.Windows.Controls.MenuItem.IsSubmenuOpen%2A> property logic uses data binding natively to maintain the state of the property in accordance to other state properties and method calls.</span></span> <span data-ttu-id="2946c-219">Другим примером свойства, которое привязывает <xref:System.Windows.Data.BindingMode.TwoWay> по умолчанию является <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2946c-219">Another example property that binds <xref:System.Windows.Data.BindingMode.TwoWay> by default is <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="2946c-220">Можно также включить наследование свойств в пользовательское свойство зависимости, задав <xref:System.Windows.FrameworkPropertyMetadataOptions.Inherits> флаг.</span><span class="sxs-lookup"><span data-stu-id="2946c-220">You can also enable property inheritance in a custom dependency property by setting the <xref:System.Windows.FrameworkPropertyMetadataOptions.Inherits> flag.</span></span> <span data-ttu-id="2946c-221">Наследование свойств удобно для ситуации, когда родительские и дочерние элементы имеют общее свойство и для дочерних элементов имеет смысл задать то же значение свойства, что и в родительском элементе.</span><span class="sxs-lookup"><span data-stu-id="2946c-221">Property inheritance is useful for a scenario where parent elements and child elements have a property in common, and it makes sense for the child elements to have that particular property value set to the same value as the parent set it.</span></span> <span data-ttu-id="2946c-222">Примером наследуемого свойства является <xref:System.Windows.FrameworkElement.DataContext%2A>, который используется для операций привязки, чтобы включить важный сценарий «основной-подробности» для представления данных.</span><span class="sxs-lookup"><span data-stu-id="2946c-222">An example inheritable property is <xref:System.Windows.FrameworkElement.DataContext%2A>, which is used for binding operations to enable the important master-detail scenario for data presentation.</span></span> <span data-ttu-id="2946c-223">Благодаря <xref:System.Windows.FrameworkElement.DataContext%2A> наследуемые, дочерние элементы наследуют контекст данных также.</span><span class="sxs-lookup"><span data-stu-id="2946c-223">By making <xref:System.Windows.FrameworkElement.DataContext%2A> inheritable, any child elements inherit that data context also.</span></span> <span data-ttu-id="2946c-224">Благодаря наследованию значения свойства вы можете указать контекст данных в корне приложения или страницы и вам не потребуется уточнять его для привязок во всех возможных дочерних элементах.</span><span class="sxs-lookup"><span data-stu-id="2946c-224">Because of property value inheritance, you can specify a data context at the page or application root, and do not need to respecify it for bindings in all possible child elements.</span></span> <span data-ttu-id="2946c-225"><xref:System.Windows.FrameworkElement.DataContext%2A> также представляет собой хороший пример, чтобы продемонстрировать, что наследование переопределяет значение по умолчанию, но может всегда быть локально установлено для любого конкретного дочернего элемента. Дополнительные сведения см. в разделе [использование шаблона «основной-подробности» с иерархическими данными](../data/how-to-use-the-master-detail-pattern-with-hierarchical-data.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-225"><xref:System.Windows.FrameworkElement.DataContext%2A> is also a good example to illustrate that inheritance overrides the default value, but it can always be set locally on any particular child element; for details, see [Use the Master-Detail Pattern with Hierarchical Data](../data/how-to-use-the-master-detail-pattern-with-hierarchical-data.md).</span></span> <span data-ttu-id="2946c-226">Наследование значения свойства может влиять на производительность, и таким образом, его следует использовать с осторожностью. Дополнительные сведения см. в разделе [Наследование значения свойства](property-value-inheritance.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-226">Property value inheritance does have a possible performance cost, and thus should be used sparingly; for details, see [Property Value Inheritance](property-value-inheritance.md).</span></span>

- <span data-ttu-id="2946c-227">Задайте <xref:System.Windows.FrameworkPropertyMetadataOptions.Journal> флаг, указывающий, если свойство зависимостей должны обнаруживаться или использоваться службами ведения журнала переходов.</span><span class="sxs-lookup"><span data-stu-id="2946c-227">Set the <xref:System.Windows.FrameworkPropertyMetadataOptions.Journal> flag to indicate if your dependency property should be detected or used by navigation journaling services.</span></span> <span data-ttu-id="2946c-228">Пример — <xref:System.Windows.Controls.Primitives.Selector.SelectedIndex%2A> свойство; любой элемент, выбранный в выделенной области элемента управления должны сохраняться при навигации по истории ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="2946c-228">An example is the <xref:System.Windows.Controls.Primitives.Selector.SelectedIndex%2A> property; any item selected in a selection control should be persisted when the journaling history is navigated.</span></span>

<a name="RODP"></a>

## <a name="read-only-dependency-properties"></a><span data-ttu-id="2946c-229">Свойства зависимости "только для чтения"</span><span class="sxs-lookup"><span data-stu-id="2946c-229">Read-Only Dependency Properties</span></span>

<span data-ttu-id="2946c-230">Можно определить свойство зависимости, которое доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="2946c-230">You can define a dependency property that is read-only.</span></span> <span data-ttu-id="2946c-231">Однако ситуации для такого использования немного отличаются, как и процедура регистрации свойства в системе свойств и предоставление идентификатора.</span><span class="sxs-lookup"><span data-stu-id="2946c-231">However, the scenarios for why you might define your property as read-only are somewhat different, as is the procedure for registering them with the property system and exposing the identifier.</span></span> <span data-ttu-id="2946c-232">Дополнительные сведения см. в разделе [Свойства зависимостей "только для чтения"](read-only-dependency-properties.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-232">For more information, see [Read-Only Dependency Properties](read-only-dependency-properties.md).</span></span>

<a name="CTDP"></a>

## <a name="collection-type-dependency-properties"></a><span data-ttu-id="2946c-233">Свойства зависимостей типа коллекция</span><span class="sxs-lookup"><span data-stu-id="2946c-233">Collection-Type Dependency Properties</span></span>

<span data-ttu-id="2946c-234">Свойства зависимостей типа коллекции имеют некоторые дополнительные проблемы при реализации, которые необходимо учитывать.</span><span class="sxs-lookup"><span data-stu-id="2946c-234">Collection-type dependency properties have some additional implementation issues to consider.</span></span> <span data-ttu-id="2946c-235">Подробности см. в разделе [Свойства зависимостей типа коллекции](collection-type-dependency-properties.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-235">For details, see [Collection-Type Dependency Properties](collection-type-dependency-properties.md).</span></span>

<a name="SecurityC"></a>

## <a name="dependency-property-security-considerations"></a><span data-ttu-id="2946c-236">Замечания по безопасности свойств зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-236">Dependency Property Security Considerations</span></span>

<span data-ttu-id="2946c-237">Свойства зависимостей должны объявляться как открытые свойства.</span><span class="sxs-lookup"><span data-stu-id="2946c-237">Dependency properties should be declared as public properties.</span></span> <span data-ttu-id="2946c-238">Поля идентификаторов свойств зависимостей должны объявляться как открытые статические поля.</span><span class="sxs-lookup"><span data-stu-id="2946c-238">Dependency property identifier fields should be declared as public static fields.</span></span> <span data-ttu-id="2946c-239">Даже при попытке объявить другие уровни доступа (например, защищенный) к свойству зависимостей всегда можно обращаться через идентификатор в сочетании с [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] системы свойств.</span><span class="sxs-lookup"><span data-stu-id="2946c-239">Even if you attempt to declare other access levels (such as protected), a dependency property can always be accessed through the identifier in combination with the property system [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)].</span></span> <span data-ttu-id="2946c-240">Даже защищенное поле идентификатора потенциально доступно из-за метаданных reporting или определения значения [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] , которые являются частью системы свойств, таких как <xref:System.Windows.LocalValueEnumerator>.</span><span class="sxs-lookup"><span data-stu-id="2946c-240">Even a protected identifier field is potentially accessible because of metadata reporting or value determination [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that are part of the property system, such as <xref:System.Windows.LocalValueEnumerator>.</span></span> <span data-ttu-id="2946c-241">Дополнительные сведения см. в разделе [Безопасность свойств зависимостей](dependency-property-security.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-241">For more information, see [Dependency Property Security](dependency-property-security.md).</span></span>

<a name="DPCtor"></a>

## <a name="dependency-properties-and-class-constructors"></a><span data-ttu-id="2946c-242">Свойства зависимостей и конструкторы класса</span><span class="sxs-lookup"><span data-stu-id="2946c-242">Dependency Properties and Class Constructors</span></span>

<span data-ttu-id="2946c-243">Есть общий принцип в программировании управляемого кода (он часто принудительно применяется средствами анализа кода, такими как FxCop), подразумевающий, что конструкторы класса не должны вызывать виртуальные методы.</span><span class="sxs-lookup"><span data-stu-id="2946c-243">There is a general principle in managed code programming (often enforced by code analysis tools such as FxCop) that class constructors should not call virtual methods.</span></span> <span data-ttu-id="2946c-244">Этот принцип обусловлен тем, что конструкторы могут быть вызваны в качестве базовой инициализации конструктора производного класса, а ввод виртуального метода через конструктор может произойти в состоянии неполной инициализации конструируемого экземпляра объекта.</span><span class="sxs-lookup"><span data-stu-id="2946c-244">This is because constructors can be called as base initialization of a derived class constructor, and entering the virtual method through the constructor might occur at an incomplete initialization state of the object instance being constructed.</span></span> <span data-ttu-id="2946c-245">При наследовании от любого класса, который уже является производным от <xref:System.Windows.DependencyObject>, следует иметь в виду, что сама система свойств вызывает и предоставляет виртуальные методы.</span><span class="sxs-lookup"><span data-stu-id="2946c-245">When you derive from any class that already derives from <xref:System.Windows.DependencyObject>, you should be aware that the property system itself calls and exposes virtual methods internally.</span></span> <span data-ttu-id="2946c-246">Эти виртуальные методы являются частью служб системы свойств [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2946c-246">These virtual methods are part of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property system services.</span></span> <span data-ttu-id="2946c-247">Переопределение методов позволяет производным классам участвовать в определении значения.</span><span class="sxs-lookup"><span data-stu-id="2946c-247">Overriding the methods enables derived classes to participate in value determination.</span></span> <span data-ttu-id="2946c-248">Чтобы избежать потенциальных проблем при инициализации среды выполнения, не задавайте значения свойств зависимостей в конструкторах классов (если только вы не следуете конкретному шаблону конструктора).</span><span class="sxs-lookup"><span data-stu-id="2946c-248">To avoid potential issues with runtime initialization, you should not set dependency property values within constructors of classes, unless you follow a very specific constructor pattern.</span></span> <span data-ttu-id="2946c-249">Подробнее см. в разделе [Шаблоны безопасного конструктора для DependencyObjects](safe-constructor-patterns-for-dependencyobjects.md).</span><span class="sxs-lookup"><span data-stu-id="2946c-249">For details, see [Safe Constructor Patterns for DependencyObjects](safe-constructor-patterns-for-dependencyobjects.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="2946c-250">См. также</span><span class="sxs-lookup"><span data-stu-id="2946c-250">See also</span></span>

- [<span data-ttu-id="2946c-251">Общие сведения о свойствах зависимости</span><span class="sxs-lookup"><span data-stu-id="2946c-251">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="2946c-252">Метаданные свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-252">Dependency Property Metadata</span></span>](dependency-property-metadata.md)
- [<span data-ttu-id="2946c-253">Общие сведения о разработке элементов управления</span><span class="sxs-lookup"><span data-stu-id="2946c-253">Control Authoring Overview</span></span>](../controls/control-authoring-overview.md)
- [<span data-ttu-id="2946c-254">Свойства зависимостей типа коллекции</span><span class="sxs-lookup"><span data-stu-id="2946c-254">Collection-Type Dependency Properties</span></span>](collection-type-dependency-properties.md)
- [<span data-ttu-id="2946c-255">Безопасность свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-255">Dependency Property Security</span></span>](dependency-property-security.md)
- [<span data-ttu-id="2946c-256">Загрузка кода XAML и свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="2946c-256">XAML Loading and Dependency Properties</span></span>](xaml-loading-and-dependency-properties.md)
- [<span data-ttu-id="2946c-257">Шаблоны безопасного конструктора для DependencyObjects</span><span class="sxs-lookup"><span data-stu-id="2946c-257">Safe Constructor Patterns for DependencyObjects</span></span>](safe-constructor-patterns-for-dependencyobjects.md)
