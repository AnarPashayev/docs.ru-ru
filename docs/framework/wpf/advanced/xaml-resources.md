---
title: Ресурсы XAML
ms.date: 03/30/2017
helpviewer_keywords:
- reusing resources [WPF]
- resources [WPF], reusing
- reusing commonly defined objects [WPF]
- XAML [WPF], reusing resources
ms.assetid: 91580b89-a0a8-4889-aecb-fddf8e63175f
ms.openlocfilehash: 738a4f397b1677b867126c7bb439b027f951baa0
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2019
ms.locfileid: "69958822"
---
# <a name="xaml-resources"></a>Ресурсы XAML
Ресурс — это объект, который можно повторно использовать в разных местах приложения. Примерами ресурсов являются кисти и стили. В этом обзоре описывается использование ресурсов в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]. Вы также можете создавать ресурсы и получать к ним доступ с помощью кода или взаимозаменяемости между [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]кодом и. Дополнительные сведения см. в разделе [ресурсы и код](resources-and-code.md).  
  
> [!NOTE]
> Файлы ресурсов, описанные в этом разделе, отличаются от файлов ресурсов, описанных в [ресурсах, содержимом и файлах данных приложения WPF,](../app-development/wpf-application-resource-content-and-data-files.md) а не на внедренных или связанных ресурсах, описанных в статье [Управление ресурсами приложения (.NET). ](/visualstudio/ide/managing-application-resources-dotnet).  

<a name="usingresources"></a>   
## <a name="using-resources-in-xaml"></a>Использование ресурсов в XAML  
 В следующем примере определяется <xref:System.Windows.Media.SolidColorBrush> как ресурс в корневом элементе страницы. Затем этот пример ссылается на ресурс и использует его для задания свойств нескольких дочерних элементов, включая <xref:System.Windows.Shapes.Ellipse> <xref:System.Windows.Controls.TextBlock>, и <xref:System.Windows.Controls.Button>.  
  
 [!code-xaml[FEResourceSH_snip#XAML](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page1.xaml#xaml)]  
  
 Каждый элемент уровня среды<xref:System.Windows.FrameworkElement> (или <xref:System.Windows.FrameworkContentElement>) имеет <xref:System.Windows.FrameworkElement.Resources%2A> свойство, которое является <xref:System.Windows.ResourceDictionary>свойством, содержащим ресурсы (как), которые определяет ресурс. Вы можете определить ресурсы в любом элементе. Однако чаще всего ресурсы определяются в корневом элементе, который находится <xref:System.Windows.Controls.Page> в примере.  
  
 Каждый ресурс в словаре ресурсов должен иметь уникальный ключ. При определении ресурсов в разметке уникальный ключ назначается с помощью [директивы x:Key](../../xaml-services/x-key-directive.md). Как правило, ключ является строкой. Однако можно задать его как другой тип объекта с помощью соответствующих расширений разметки. Нестроковые ключи для ресурсов используются в определенных функциональных областях в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], особенно для стилей, ресурсов компонентов и стилей данных.  
  
 После определения ресурса можно ссылаться на ресурс, который должен быть использован для значения свойства, с помощью синтаксиса расширения разметки ресурсов, задающего имя ключа, например:  
  
 [!code-xaml[FEResourceSH_snip#KeyNameUsage](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page2.xaml#keynameusage)]  
  
 В предыдущем примере [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] , когда загрузчик обрабатывает значение `{StaticResource MyBrush}` <xref:System.Windows.Controls.Control.Background%2A> свойства в <xref:System.Windows.Controls.Button>, логика поиска ресурсов сначала проверяет словарь ресурсов для <xref:System.Windows.Controls.Button> элемента. Если <xref:System.Windows.Controls.Button> не имеет определения ключа `MyBrush` ресурса (это не значит, что его коллекция ресурсов пуста), уточняющий запрос <xref:System.Windows.Controls.Button>проверяет родительский элемент, который имеет значение <xref:System.Windows.Controls.Page>. Таким словами, при определении ресурса в <xref:System.Windows.Controls.Page> корневом элементе все элементы в логическом дереве <xref:System.Windows.Controls.Page> объекта могут получить к нему доступ, и вы можете повторно использовать тот же ресурс для установки значения <xref:System.Type> любого свойства, которое принимает, что ресурс соответствующий. В предыдущем примере один и тот же `MyBrush` ресурс задает два разных свойства: свойства <xref:System.Windows.Controls.Control.Background%2A> <xref:System.Windows.Controls.Button>и <xref:System.Windows.Shapes.Shape.Fill%2A> <xref:System.Windows.Shapes.Rectangle>объекта.  
  
<a name="staticdynamic"></a>   
## <a name="static-and-dynamic-resources"></a>Статические и динамические ресурсы  
 Ресурс может использоваться как статический или динамический ресурс. Это можно сделать с помощью [расширения разметки StaticResource](staticresource-markup-extension.md) или [расширения разметки DynamicResource](dynamicresource-markup-extension.md). Расширение разметки — это функция [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] , позволяющая указать ссылку на объект, разлучив расширение разметки на обработку строки атрибута и возвращая объект [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] загрузчику. Дополнительные сведения о поведении расширения разметки см. в разделе [расширения разметки и XAML WPF](markup-extensions-and-wpf-xaml.md).  
  
 При использовании расширения разметки обычно предоставляют один или несколько параметров в виде строки; они обрабатываются этим расширением разметки, а не в контексте задаваемого свойства. [Расширение разметки StaticResource](staticresource-markup-extension.md) обрабатывает ключ путем поиска значения для этого ключа во всех доступных словарях ресурсов. Это происходит во время загрузки, которая является моментом времени, когда процессу загрузки необходимо присвоить значение свойству, которое принимает ссылку на статический ресурс. Вместо этого [расширение разметки DynamicResource](dynamicresource-markup-extension.md) обрабатывает ключ путем создания выражения, и это выражение остается невычисленным до тех пор, пока приложение не будет запущено, когда выражение вычисляется и предоставляет значение.  
  
 Приведенные ниже соображения могут повлиять на выбор использования ссылки на статический или динамический ресурс.  
  
- Общая схема создания ресурсов для приложения (на странице в приложении, свободно [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], в сборке только ресурсов).  
  
- Является ли обновление ресурсов в режиме реального времени частью требований приложения.  
  
- Соответствующее поведение подстановки этого ссылочного типа ресурса.  
  
- Конкретное свойство или тип ресурса и собственное поведение этих типов.  
  
### <a name="static-resources"></a>Статические ресурсы  
 Ссылки на статические ресурсы лучше всего использовать в указанных ниже случаях.  
  
- Когда структура приложения концентрирует большую часть его ресурсов в словарях ресурсов уровня страницы или приложения. Ссылки на статические ресурсы не обрабатываются повторно в зависимости от поведения во время выполнения, например при перезагрузке страницы. Таким образом, можно получить выигрыш в производительности благодаря отсутствию большого количества динамических ссылок на ресурсы, когда согласно структуре ресурсов и приложения в них нет необходимости.  
  
- Вы устанавливаете значение свойства, которое не находится в <xref:System.Windows.DependencyObject> <xref:System.Windows.Freezable>или.  
  
- При создании словаря ресурсов, который будет скомпилирован в DLL и либо упакован как часть приложения, либо совместно использоваться приложениями.  
  
- При создании темы для пользовательского элемента управления и определении ресурсов, используемых в темах. В этом случае обычно не требуется подстановка ссылок на динамические ресурсы. Вместо этого требуется подстановка ссылок на статические ресурсы, чтобы подстановка была прогнозируемой и самодостаточной для темы. При использовании ссылки на динамический ресурс даже ссылка в теме остается необработанной до времени выполнения и есть вероятность того, что при применении темы некоторые локальные элементы переопределят ключ, на который тема пытается сослаться, и локальный элемент окажется перед темой при подстановке. Если такое случится, тема будет работать не так, как ожидалось.  
  
- При использовании ресурсов для задания большого количества свойств зависимостей. Свойства зависимостей обладают эффективным кэшированием значений, обеспечиваемым системой свойств, поэтому, если предоставить свойству зависимости значение, которое может быть вычислено во время загрузки, свойству не потребуется проверять пересчитанное выражение и оно сможет вернуть последнее фактическое значение. Этот метод может обеспечить выигрыш в производительности.  
  
- Необходимо изменить базовый ресурс для всех потребителей или сохранить отдельные экземпляры, доступные для записи, для каждого потребителя с помощью [атрибута x:Shared](../../xaml-services/x-shared-attribute.md).  
  
#### <a name="static-resource-lookup-behavior"></a>Поведение подстановки статического ресурса  
  
1. Процесс подстановки ищет запрошенный ключ в словаре ресурсов, определенном элементом, который устанавливает это свойство.  
  
2. Затем процесс подстановки обходит логическое дерево снизу вверх до родительского элемента и его словаря ресурсов. Это продолжается до тех пор, пока не будет достигнут корневой элемент.  
  
3. Далее проверяются ресурсы приложения. Ресурсы приложения — это ресурсы в словаре ресурсов, определяемые <xref:System.Windows.Application> объектом [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] для приложения.  
  
 Ссылки на статический ресурс из словаря ресурсов должны указывать на ресурс, уже определенный лексически до ссылки на ресурс. Опережающие ссылки не могут быть разрешены ссылкой на статический ресурс. По этой причине, если используются ссылки на статический ресурс, нужно так разрабатывать структуру словаря ресурсов, чтобы ресурсы, предназначенные для использования ресурсами, определялись в начале каждого соответствующего словаря ресурсов или около него.  
  
 Поиск статических ресурсов можно расширить на темы или в системные ресурсы, но это поддерживается только потому, [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] что загрузчик откладывает запрос. Задержка необходима, чтобы тема среды выполнения в момент загрузки страницы правильно применялась к приложению. Однако не рекомендуется использование ссылок на статические ресурсы для ключей, которые существуют только в теме или как системные ресурсы. Это происходит потому, что такие ссылки не будут повторно обработаны при изменении темы пользователем в режиме реального времени. Ссылки на динамические ресурсы более надежны при запросе темы или системных ресурсов. Исключением является случай, когда элемент темы сам запрашивает другой ресурс. Такие ссылки должны быть статическими по причинам, упомянутым выше.  
  
 Поведение исключения, если ссылка на статический ресурс не найдена, варьируется. Если ресурс был задержан, то исключение возникнет во время выполнения. Если ресурс не был задержан, исключение возникнет во время загрузки.  
  
### <a name="dynamic-resources"></a>Динамические ресурсы  
 Динамические ресурсы лучше всего подходят для указанных ниже случаев.  
  
- Когда значение ресурса зависит от условий, не известных до времени выполнения. Сюда входят системные ресурсы или ресурсы, которые в противном случае задаются пользователем. Например, можно создать значения Setter, которые ссылаются на системные свойства, предоставляемые <xref:System.Windows.SystemColors>, <xref:System.Windows.SystemFonts>или <xref:System.Windows.SystemParameters>. Эти значения являются действительно динамическими, так как они в конечном счете берутся из среды выполнения пользователя и операционной системы. Кроме того, возможны темы уровня приложения, которые могут изменяться, когда при доступе к ресурсу уровня страницы также необходимо отследить изменения.  
  
- При создании стилей темы или ссылке на них для пользовательского элемента управления.  
  
- Предполагается настраивать содержимое объекта <xref:System.Windows.ResourceDictionary> во время существования приложения.  
  
- Когда имеется сложная структура ресурсов с взаимозависимостями, где могут потребоваться опережающие ссылки. Ссылки на статические ресурсы не поддерживают прямые ссылки, но ссылки на динамические ресурсы поддерживают их, так как ресурс не должен оцениваться до времени выполнения, а пересылка ссылок, следовательно, не является подходящим понятием.  
  
- При ссылке на особенно большой с точки зрения компиляции или рабочего множества ресурс, если он может не использоваться немедленно при загрузке страницы. Ссылки на статические ресурсы всегда [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] загружаются с момента загрузки страницы, однако ссылка на динамический ресурс не загружается, пока она не будет фактически использована.  
  
- При создании стиля, где значения для метода задания могут браться из других значений, на которые влияют темы или другие пользовательские параметры.  
  
- Когда ресурсы применяются к элементам, для которых во время существования приложения может быть изменен порядок наследования в логическом дереве. Изменение родительского элемента также потенциально изменяет область подстановки ресурса, так что, если необходим пересчет ресурса в новой области элемента с измененным порядком наследования, всегда следует использовать ссылку на динамический ресурс.  
  
#### <a name="dynamic-resource-lookup-behavior"></a>Поведение подстановки динамического ресурса  
 Поведение поиска ресурсов для ссылки на динамический ресурс параллельно выполняет поиск в коде при вызове метода <xref:System.Windows.FrameworkElement.FindResource%2A> или. <xref:System.Windows.FrameworkElement.SetResourceReference%2A>  
  
1. Процесс подстановки ищет запрошенный ключ в словаре ресурсов, определенном элементом, который устанавливает это свойство.  
  
    - Если элемент определяет <xref:System.Windows.FrameworkElement.Style%2A> свойство <xref:System.Windows.Style.Resources%2A> , проверяется словарь <xref:System.Windows.Style> в.  
  
    - Если элемент определяет <xref:System.Windows.Controls.Control.Template%2A> свойство <xref:System.Windows.FrameworkTemplate.Resources%2A> , проверяется словарь <xref:System.Windows.FrameworkTemplate> в.  
  
2. Затем процесс подстановки обходит логическое дерево снизу вверх до родительского элемента и его словаря ресурсов. Это продолжается до тех пор, пока не будет достигнут корневой элемент.  
  
3. Далее проверяются ресурсы приложения. Ресурсы приложения — это ресурсы в словаре ресурсов, определяемые <xref:System.Windows.Application> объектом [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] для приложения.  
  
4. Для текущей активной темы проверяется словарь ресурсов темы. Если тема изменяется во время выполнения, значение будет повторно вычислено.  
  
5. Проверяются системные ресурсы.  
  
 Поведение исключения (если таковое имеется) варьируется.  
  
- Если ресурс был запрошен <xref:System.Windows.FrameworkElement.FindResource%2A> вызовом и не найден, возникает исключение.  
  
- Если ресурс был запрошен <xref:System.Windows.FrameworkElement.TryFindResource%2A> вызовом и не найден, исключение не возникает, но возвращается `null`значение. Если задаваемое свойство не принимается `null`, то по-прежнему может возникнуть более подробное исключение (это зависит от устанавливаемого свойства).  
  
- Если ресурс был запрошен ссылкой на динамический ресурс в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]и не найден, то поведение зависит от общей системы свойств, но общее поведение имеет значение, как если бы на уровне, где существует ресурс, не происходила операция установки свойства. Например, при попытке задать фон для отдельного элемента кнопки с помощью ресурса, который не может быть вычислен, не происходит задания значения, но фактическое значение по-прежнему может быть получено от других членов системы свойств и приоритета значения. Например, значение фона может по-прежнему браться из локально определенного стиля кнопки или из стиля темы. Для свойств, не определенных стилями темы, после неудавшейся попытки обработки ресурса фактическое значение может браться из значения по умолчанию в метаданных свойства.  
  
#### <a name="restrictions"></a>Ограничения  
 Для ссылок на динамические ресурсы есть некоторые важные ограничения. Должно выполняться по крайней мере одно из указанных ниже условий.  
  
- Устанавливаемое свойство должно быть свойством в <xref:System.Windows.FrameworkElement> или. <xref:System.Windows.FrameworkContentElement> Это свойство должно быть зарезервировано <xref:System.Windows.DependencyProperty>.  
  
- Ссылка на значение в <xref:System.Windows.Style>. <xref:System.Windows.Setter>  
  
- Устанавливаемое свойство должно быть свойством <xref:System.Windows.Freezable> в, которое предоставляется как значение <xref:System.Windows.FrameworkElement> свойства <xref:System.Windows.Setter> или <xref:System.Windows.FrameworkContentElement> либо значение.  
  
 Так как устанавливаемое свойство должно быть <xref:System.Windows.DependencyProperty> свойством или <xref:System.Windows.Freezable> , большинство изменений свойств может распространяться на пользовательский интерфейс, так как изменение свойства (измененное значение динамического ресурса) подтверждается системой свойств. Большинство элементов управления включают логику, которая будет принудительно выполнять другой макет <xref:System.Windows.DependencyProperty> элемента управления, если изменяется и это свойство может повлиять на макет. Однако не все свойства, имеющие [расширение разметки DynamicResource](dynamicresource-markup-extension.md) в качестве значения, гарантированно предоставляют значение таким образом, что они обновляются в пользовательском интерфейсе в режиме реального времени. Функциональные возможности по-прежнему могут отличаться в зависимости от свойства, типа, которому принадлежит свойство, или даже логической структуры приложения.  
  
<a name="stylesimplicitkeys"></a>   
## <a name="styles-datatemplates-and-implicit-keys"></a>Стили, DataTemplates и неявные ключи  
 Ранее было указано, что все элементы в <xref:System.Windows.ResourceDictionary> должны иметь ключ. Однако это не означает, что все ресурсы должны иметь явный `x:Key`. Некоторые типы объектов поддерживают неявный ключ, если он определен как ресурс, где значение ключа связано со значением другого свойства. Это называется неявным ключом, в то время как `x:Key` атрибут является явным ключом. Любой неявный ключ можно перезаписать, указав явный ключ.  
  
 Одним из очень важных сценариев для ресурсов является определение <xref:System.Windows.Style>. Фактически, <xref:System.Windows.Style> в словаре ресурсов почти всегда определяется как запись, поскольку стили изначально предназначены для повторного использования. Дополнительные сведения о стилях см. в разделе [Стилизация и использование шаблонов](../controls/styling-and-templating.md).  
  
 С помощью неявного ключа можно создавать стили для элементов управления либо ссылаться на них. Стили темы, определяющие внешний вид элемента управления по умолчанию, используют этот неявный ключ. Неявным ключом с точки зрения запроса является <xref:System.Type> сам элемент управления. Неявным ключом с точки зрения определения ресурса является <xref:System.Windows.Style.TargetType%2A> стиль. Поэтому при создании тем для пользовательских элементов управления и создании стилей, взаимодействующих с существующими стилями тем, не нужно указывать директиву [x:Key](../../xaml-services/x-key-directive.md) для этого <xref:System.Windows.Style>. А если требуется использовать стили из тем, то вообще не нужно задавать стиль. Например, следующее определение стиля работает, даже если <xref:System.Windows.Style> ресурс не имеет ключа:  
  
 [!code-xaml[FEResourceSH_snip#ImplicitStyle](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page2.xaml#implicitstyle)]  
  
 У этого стиля действительно есть ключ: неявный ключ `typeof(`. <xref:System.Windows.Controls.Button> `)` В разметке можно указать <xref:System.Windows.Style.TargetType%2A> непосредственно в качестве имени типа (или при необходимости можно использовать [{x:Type...}](../../xaml-services/x-type-markup-extension.md) для возврата <xref:System.Type>.  
  
 С помощью механизмов тематического стиля по умолчанию [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], используемых в, этот стиль применяется <xref:System.Windows.Controls.Button> в качестве стиля среды выполнения на странице, даже если <xref:System.Windows.Controls.Button> он не пытается указать <xref:System.Windows.FrameworkElement.Style%2A> свойство или конкретный ресурс. Ссылка на стиль. Ваш стиль, определенный на странице, находится выше в последовательности поиска, чем стиль словаря темы, используя тот же ключ, что и стиль словаря темы. Можно просто указать `<Button>Hello</Button>` в любом месте страницы, и стиль, определенный `Button` в параметре <xref:System.Windows.Style.TargetType%2A> , будет применен к этой кнопке. При необходимости вы по-прежнему можете явным образом создать ключ для стиля с тем же значением <xref:System.Windows.Style.TargetType%2A>типа, что и для ясности в разметке, но это необязательно.  
  
 Неявные ключи для стилей не применяются к элементу <xref:System.Windows.FrameworkElement.OverridesDefaultStyle%2A> управления `true` , если имеет значение <xref:System.Windows.FrameworkElement.OverridesDefaultStyle%2A> (также обратите внимание, что может быть задано как часть собственного поведения для класса элемента управления, а не явно на экземпляре элемента управления). Кроме того, для поддержки неявных ключей в сценариях производных классов элемент управления <xref:System.Windows.FrameworkElement.DefaultStyleKey%2A> должен переопределяться (все существующие элементы [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] управления, предоставленные как часть этого). Дополнительные сведения о стилях, темах и проектировании элементов управления см. в разделе [рекомендации по проектированию элементов управления стили](../controls/guidelines-for-designing-stylable-controls.md).  
  
 <xref:System.Windows.DataTemplate>также имеет неявный ключ. Неявный ключ для <xref:System.Windows.DataTemplate> <xref:System.Windows.DataTemplate.DataType%2A> — это значение свойства. <xref:System.Windows.DataTemplate.DataType%2A>также можно указать как имя типа, а не явно использовать [{x:Type...}](../../xaml-services/x-type-markup-extension.md). Дополнительные сведения см. в разделе [Общие сведения о шаблонах данных](../data/data-templating-overview.md).  
  
## <a name="see-also"></a>См. также

- <xref:System.Windows.ResourceDictionary>
- [Ресурсы приложений](optimizing-performance-application-resources.md)
- [Ресурсы и код](resources-and-code.md)
- [Определение и создание ссылки на ресурс](how-to-define-and-reference-a-resource.md)
- [Общие сведения об управлении приложением](../app-development/application-management-overview.md)
- [Расширение разметки x:Type](../../xaml-services/x-type-markup-extension.md)
- [Расширение разметки StaticResource](staticresource-markup-extension.md)
- [Расширение разметки DynamicResource](dynamicresource-markup-extension.md)
