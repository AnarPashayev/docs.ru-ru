---
title: Сериализация и хранение документов
ms.date: 03/30/2017
helpviewer_keywords:
- 'serialization of documents [WPF], , '
- documents [WPF], storage
- documents [WPF], serialization
ms.assetid: 4839cd87-e206-4571-803f-0200098ad37b
ms.openlocfilehash: 6703825d4453b2e0e65036fa2d9c856139ee473c
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2020
ms.locfileid: "77094570"
---
# <a name="document-serialization-and-storage"></a>Сериализация и хранение документов

Microsoft .NET Framework предоставляет мощную среду для создания и отображения документов высокого качества.  Улучшенные функции, поддерживающие как фиксированные документы, так и документы Flow, расширенные элементы управления просмотром вместе с мощными возможностями двухмерной и трехмерной графики, позволяют .NET Framework приложения на новый уровень качества и удобства работы пользователей.  Возможность гибкого управления представлением документа в памяти является ключевой функцией .NET Framework, а также возможность эффективного сохранения и загрузки документов из хранилища данных — это почти все необходимое приложение.  Процесс преобразования документа из внутреннего представления в памяти во внешнее хранилище данных называется сериализацией.  Обратный процесс чтения хранилища данных и воссоздания исходного экземпляра в памяти называется десериализацией.

<a name="AboutSerialization"></a>

## <a name="about-document-serialization"></a>О сериализации документов

В идеальном случае процесс сериализации и десериализации документа из памяти и в память прозрачен для приложения.  Приложение вызывает метод write сериализатора для сохранения документа, в то время как метод read десериализатора осуществляет доступ к хранилищу данных и воссоздает исходный экземпляр в памяти.  Как правило, формат хранения данных не имеет значения для приложения при условии, что в процессе сериализации и десериализации воссоздается документ в исходной форме.

Приложения часто предоставляют несколько параметров сериализации, которые позволяют пользователям сохранять документы на другом носителе или в другом формате.  Например, приложение может предложить варианты "Сохранить как" для сохранения документа в файл на диске, базу данных или веб-службу.  Аналогичным образом разные сериализаторы могут сохранять документ в различных форматах, например в HTML, RTF, XML, XPS или в ином стороннем формате.  Для приложения сериализация определяет интерфейс, который изолирует сведения о носителе в реализации каждого определенного сериализатора.  Помимо преимуществ инкапсуляции сведений о хранилище, интерфейсы API .NET Framework <xref:System.Windows.Documents.Serialization> предоставляют несколько других важных функций.

### <a name="features-of-net-framework-30-document-serializers"></a>Компоненты сериализаторов документов .NET Framework 3.0

- Прямой доступ к высокоуровневым объектам документа (логическое дерево и визуальные элементы) позволяет эффективно хранить разделенное на страницы содержимое, двухмерные и трехмерные элементы, изображения, мультимедиа, гиперссылки, аннотации и другое содержимое поддержки.

- Синхронные и асинхронные операции.

- Поддержка сериализаторов подключаемых модулей с расширенными возможностями:

  - Доступ на уровне системы для использования всеми приложениями .NET Framework.

  - Удобное обнаружение подключаемых модулей приложения.

  - Простое развертывание, установка и обновление пользовательских подключаемых модулей сторонних производителей.

  - Поддержка интерфейса пользователя для пользовательских параметров и настроек среды выполнения.

### <a name="xps-print-path"></a>Способ печати XPS

Путь печати Microsoft .NET Framework XPS также предоставляет расширяемый механизм для записи документов с помощью вывода на печать.  XPS выступает в качестве формата файла документа и является собственным форматом очереди печати для Windows Vista.  Документы XPS можно отправлять непосредственно на совместимые с XPS принтеры без необходимости преобразования их в промежуточный формат.  См. дополнительные сведения о параметрах и возможностях вывода пути печати в разделе [Общие сведения о печати](printing-overview.md).

<a name="PluginSerializers"></a>

## <a name="plug-in-serializers"></a>Подключаемые сериализаторы

<xref:System.Windows.Documents.Serialization> интерфейсы API обеспечивают поддержку подключаемых сериализаторов и связанных сериализаторов, устанавливаемых отдельно от приложения, привязки во время выполнения и доступ к которым осуществляется с помощью механизма обнаружения <xref:System.Windows.Documents.Serialization.SerializerProvider>.  Подключаемые сериализаторы обеспечивают расширенные преимущества для простоты развертывания и использования в масштабах системы.  Связанные сериализаторы также могут быть реализованы для сред с частичным доверием, таких как приложения браузера XAML (XBAP), где недоступны подключаемые сериализаторы.  Связанные сериализаторы, основанные на производной реализации класса <xref:System.Windows.Documents.Serialization.SerializerWriter>, компилируются и связываются непосредственно с приложением.  Подключаемые и связанные сериализаторы функционируют через идентичные открытые методы и события, упрощающие использование любого из этих типов сериализаторов (или обоих типов) в приложении.

Подключаемые сериализаторы помогают разработчикам приложений, обеспечивая расширяемость новых проектируемых систем хранения и файловых форматов и избавляя от необходимости создавать код напрямую для каждого потенциального формата во время создания.  Подключаемые сериализаторы помогают и сторонним разработчикам, предоставляя стандартизированные средства развертывания, установки и обновления доступных системе подключаемых модулей для пользовательских или собственных форматов файлов.

### <a name="using-a-plug-in-serializer"></a>Использование подключаемого сериализатора

Использовать подключаемые сериализаторы достаточно просто.  Класс <xref:System.Windows.Documents.Serialization.SerializerProvider> перечисляет объект <xref:System.Windows.Documents.Serialization.SerializerDescriptor> для каждого подключаемого модуля, установленного в системе.  Свойство <xref:System.Windows.Documents.Serialization.SerializerDescriptor.IsLoadable%2A> фильтрует установленные подключаемые модули на основе текущей конфигурации и проверяет возможность загрузки и использования сериализатора приложением.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor> также предоставляет другие свойства, такие как <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DisplayName%2A> и <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DefaultFileExtension%2A>, которые приложение может использовать для запроса пользователя при выборе сериализатора для доступного формата вывода.  Подключаемый модуль сериализатора по умолчанию для XPS предоставляется с .NET Framework и всегда перечисляется.  После того как пользователь выберет формат вывода, метод <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> используется для создания <xref:System.Windows.Documents.Serialization.SerializerWriter> для конкретного формата.  Затем можно вызвать метод <xref:System.Windows.Documents.Serialization.SerializerWriter.Write%2A?displayProperty=nameWithType>, чтобы вывести поток документа в хранилище данных.

В следующем примере показано приложение, использующее метод <xref:System.Windows.Documents.Serialization.SerializerProvider> в свойстве "Плугинфилефилтер".  Плугинфилефилтер перечисляет установленные подключаемые модули и создает строку фильтра с доступными параметрами файла для <xref:Microsoft.Win32.SaveFileDialog>.

[!code-csharp[DocumentSerialize#DocSerializeFileFilter](~/samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializefilefilter)]

После выбора имени выходного файла пользователем в следующем примере показано использование метода <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> для сохранения заданного документа в указанном формате.

[!code-csharp[DocumentSerialize#DocSerializePlugIn](~/samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializeplugin)]

<a name="InstallingPluginSerializers"></a>

### <a name="installing-plug-in-serializers"></a>Установка подключаемых сериализаторов

Класс <xref:System.Windows.Documents.Serialization.SerializerProvider> предоставляет интерфейс приложения верхнего уровня для обнаружения подключаемого сериализатора и доступа к нему.  <xref:System.Windows.Documents.Serialization.SerializerProvider> находит и предоставляет приложению список сериализаторов, установленных и доступных в системе.  Особенности установленных сериализаторов определяются через параметры реестра.  Подключаемые сериализаторы можно добавлять в реестр с помощью метода <xref:System.Windows.Documents.Serialization.SerializerProvider.RegisterSerializer%2A>. Если .NET Framework еще не установлен, сценарий установки подключаемого модуля может напрямую задать сами значения реестра.  Метод <xref:System.Windows.Documents.Serialization.SerializerProvider.UnregisterSerializer%2A> можно использовать для удаления ранее установленного подключаемого модуля, или параметры реестра можно сбросить аналогично сценарию удаления.

### <a name="creating-a-plug-in-serializer"></a>Создание подключаемого сериализатора

Подключаемые и связанные сериализаторы используют одинаковые предоставленные открытые методы и события, и их также можно настроить для синхронной и асинхронной работы.  Для создания подключаемого сериализатора, как правило, требуется выполнить три шага.

1. Реализация и отладка сериализатора сначала в виде связанного сериализатора.  Изначально создание сериализатора, скомпилированного и связанного непосредственно в тестовом приложении, предоставляет полный доступ к точкам останова и другим полезным для тестирования отладочным службам.

2. После полного тестирования сериализатора добавляется интерфейс <xref:System.Windows.Documents.Serialization.ISerializerFactory> для создания подключаемого модуля.  Интерфейс <xref:System.Windows.Documents.Serialization.ISerializerFactory> допускает полный доступ ко всем .NET Framework объектам, включая логическое дерево, <xref:System.Windows.UIElement> объекты, <xref:System.Windows.Documents.IDocumentPaginatorSource>и <xref:System.Windows.Media.Visual> элементы.  Кроме того <xref:System.Windows.Documents.Serialization.ISerializerFactory> предоставляет одинаковые синхронные и асинхронные методы и события, используемые связанными сериализаторами.  Поскольку на вывод крупных документов может потребоваться время, рекомендуется использовать асинхронные операции, чтобы сохранить возможность взаимодействия с пользователем и предоставить возможность отмены, если с источником данных произойдет проблема.

3. После создания подключаемого сериализатора сценарий установки реализуется для распространения и установки (и удаления) подключаемого модуля (см. [Установка подключаемых сериализаторов](#InstallingPluginSerializers) выше).

## <a name="see-also"></a>См. также раздел

- <xref:System.Windows.Documents.Serialization>
- <xref:System.Windows.Xps.XpsDocumentWriter>
- <xref:System.Windows.Xps.Packaging.XpsDocument>
- [Документы в WPF](documents-in-wpf.md)
- [Общие сведения о печати](printing-overview.md)
- [Спецификация XML Paper](https://www.ecma-international.org/activities/XML%20Paper%20Specification/XPS%20Standard%20WD%201.6.pdf)
