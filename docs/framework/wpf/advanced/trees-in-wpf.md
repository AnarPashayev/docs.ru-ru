---
title: Деревья
ms.date: 03/30/2017
helpviewer_keywords:
- logical tree [WPF]
- element tree [WPF]
- visual tree [WPF]
ms.assetid: e83f25e5-d66b-4fc7-92d2-50130c9a6649
ms.openlocfilehash: d4b17c34fb33f73ca1c173bebc8f94ddac5b1942
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76746575"
---
# <a name="trees-in-wpf"></a><span data-ttu-id="4da86-102">Деревья в WPF</span><span class="sxs-lookup"><span data-stu-id="4da86-102">Trees in WPF</span></span>
<span data-ttu-id="4da86-103">Во многих технологиях элементы и компоненты организованы в форме древовидной структуры, и разработчики могут напрямую управлять узлами объекта в дереве, чтобы повлиять на визуализацию или поведение приложения.</span><span class="sxs-lookup"><span data-stu-id="4da86-103">In many technologies, elements and components are organized in a tree structure where developers directly manipulate the object nodes in the tree to affect the rendering or behavior of an application.</span></span> <span data-ttu-id="4da86-104">В [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] часто используется несколько метафор древовидных структур, чтобы определить отношения между программными элементами.</span><span class="sxs-lookup"><span data-stu-id="4da86-104">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] also uses several tree structure metaphors to define relationships between program elements.</span></span> <span data-ttu-id="4da86-105">Для большей части WPF разработчики могут создать приложение в коде или определить части приложения в XAML и при этом концептуально думать о метафоре дерева объектов, но для этого им потребуется вызвать определенный интерфейс API или использовать конкретную разметку, а не интерфейс API управления деревом некоторых общих объектов, какой можно использовать в XML DOM.</span><span class="sxs-lookup"><span data-stu-id="4da86-105">For the most part WPF developers can create an application in code or define portions of the application in XAML while thinking conceptually about the object tree metaphor, but will be calling specific API or using specific markup to do so rather than some general object tree manipulation API such as you might use in XML DOM.</span></span> <span data-ttu-id="4da86-106">WPF предоставляет два вспомогательных класса, которые предоставляют представление метафор дерева <xref:System.Windows.LogicalTreeHelper> и <xref:System.Windows.Media.VisualTreeHelper>.</span><span class="sxs-lookup"><span data-stu-id="4da86-106">WPF exposes two helper classes that provide a tree metaphor view, <xref:System.Windows.LogicalTreeHelper> and <xref:System.Windows.Media.VisualTreeHelper>.</span></span> <span data-ttu-id="4da86-107">Термины "логическое дерево" и "визуальное дерево" также используются в документации WPF, поскольку эти же деревья помогают понять поведение определенных ключевых функций WPF.</span><span class="sxs-lookup"><span data-stu-id="4da86-107">The terms visual tree and logical tree are also used in the WPF documentation because these same trees are useful for understanding the behavior of certain key WPF features.</span></span> <span data-ttu-id="4da86-108">В этом разделе определяются представления визуального дерева и логического дерева, обсуждаются отношения этих деревьев к общей концепции дерева объектов, а также представлены <xref:System.Windows.LogicalTreeHelper> и <xref:System.Windows.Media.VisualTreeHelper>s.</span><span class="sxs-lookup"><span data-stu-id="4da86-108">This topic defines what the visual tree and logical tree represent, discusses how such trees relate to an overall object tree concept, and introduces <xref:System.Windows.LogicalTreeHelper> and <xref:System.Windows.Media.VisualTreeHelper>s.</span></span>  

<a name="element_tree"></a>   
## <a name="trees-in-wpf"></a><span data-ttu-id="4da86-109">Деревья в WPF</span><span class="sxs-lookup"><span data-stu-id="4da86-109">Trees in WPF</span></span>  
 <span data-ttu-id="4da86-110">Самой полной древовидной структурой в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является дерево объектов.</span><span class="sxs-lookup"><span data-stu-id="4da86-110">The most complete tree structure in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is the object tree.</span></span> <span data-ttu-id="4da86-111">При определении страницы приложения в [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] и последующей загрузке [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] древовидная структура создается на основе отношений вложенности элементов в разметке.</span><span class="sxs-lookup"><span data-stu-id="4da86-111">If you define an application page in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and then load the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], the tree structure is created based on the nesting relationships of the elements in the markup.</span></span> <span data-ttu-id="4da86-112">При определении приложения или части приложения в коде древовидная структура создается в зависимости от того, как присваиваются значения свойствам, которые реализуют модель содержимого для данного объекта.</span><span class="sxs-lookup"><span data-stu-id="4da86-112">If you define an application or a portion of the application in code, then the tree structure is created based on how you assign property values for properties that implement the content model for a given object.</span></span> <span data-ttu-id="4da86-113">В [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] существует два способа концептуализации и передачи в открытый интерфейс API полного дерева объектов: в виде логического дерева и в виде визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-113">In [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], there are two ways that the complete object tree is conceptualized and can be reported to its public API: as the logical tree and as the visual tree.</span></span> <span data-ttu-id="4da86-114">Различия между логическими деревьями и визуальными деревьями не всегда важны, но иногда они могут вызвать проблемы с некоторыми подсистемами [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и повлиять на изменения, внесенные в разметку или код.</span><span class="sxs-lookup"><span data-stu-id="4da86-114">The distinctions between logical tree and visual tree are not always necessarily important, but they can occasionally cause issues with certain [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] subsystems and affect choices you make in markup or code.</span></span>  
  
 <span data-ttu-id="4da86-115">Несмотря на то, что управление логическим деревом или визуальным деревом не всегда происходит напрямую, понимание концепций взаимодействия деревьев позволяет понять WPF как технологию.</span><span class="sxs-lookup"><span data-stu-id="4da86-115">Even though you do not always manipulate either the logical tree or the visual tree directly, understanding the concepts of how the trees interact is useful for understanding WPF as a technology.</span></span> <span data-ttu-id="4da86-116">Рассмотрение WPF как некоторой метафоры дерева также важно для понимания того, как в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] осуществляется наследование свойств и маршрутизация событий.</span><span class="sxs-lookup"><span data-stu-id="4da86-116">Thinking of WPF as a tree metaphor of some kind is also crucial to understanding how property inheritance and event routing work in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4da86-117">Поскольку дерево объектов — это более широкое понятие, чем фактический интерфейс API, еще одним способом представить себе концепцию является граф объекта.</span><span class="sxs-lookup"><span data-stu-id="4da86-117">Because the object tree is more of a concept than an actual API, another way to think of the concept is as an object graph.</span></span> <span data-ttu-id="4da86-118">На практике отношения между объектами можно наблюдать во время выполнения, когда метафора дерева разделяется.</span><span class="sxs-lookup"><span data-stu-id="4da86-118">In practice, there are relationships between objects at run time where the tree metaphor will break down.</span></span> <span data-ttu-id="4da86-119">Тем не менее, особенно в пользовательском интерфейсе, определенном XAML, метафора дерева достаточно релевантна, и в большей части документации WPF используется термин "дерево объекта" при ссылке на это общее понятие.</span><span class="sxs-lookup"><span data-stu-id="4da86-119">Nevertheless, particularly with XAML-defined UI, the tree metaphor is relevant enough that most WPF documentation will use the term object tree when referencing this general concept.</span></span>  
  
<a name="logical_tree"></a>   
## <a name="the-logical-tree"></a><span data-ttu-id="4da86-120">Логическое дерево</span><span class="sxs-lookup"><span data-stu-id="4da86-120">The Logical Tree</span></span>  
 <span data-ttu-id="4da86-121">В [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] содержимое добавляется в элементы пользовательского интерфейса путем задания свойств объектов, которые поддерживают эти элементы.</span><span class="sxs-lookup"><span data-stu-id="4da86-121">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], you add content to UI elements by setting properties of the objects that back those elements.</span></span> <span data-ttu-id="4da86-122">Например, можно добавить элементы в элемент управления <xref:System.Windows.Controls.ListBox>, управляя его свойством <xref:System.Windows.Controls.ItemsControl.Items%2A>.</span><span class="sxs-lookup"><span data-stu-id="4da86-122">For example, you add items to a <xref:System.Windows.Controls.ListBox> control by manipulating its <xref:System.Windows.Controls.ItemsControl.Items%2A> property.</span></span> <span data-ttu-id="4da86-123">При этом элементы помещаются в <xref:System.Windows.Controls.ItemCollection>, который является значением свойства <xref:System.Windows.Controls.ItemsControl.Items%2A>.</span><span class="sxs-lookup"><span data-stu-id="4da86-123">By doing this, you are placing items into the <xref:System.Windows.Controls.ItemCollection> that is the <xref:System.Windows.Controls.ItemsControl.Items%2A> property value.</span></span> <span data-ttu-id="4da86-124">Аналогичным образом, чтобы добавить объекты в <xref:System.Windows.Controls.DockPanel>, вы управляете его значением свойства <xref:System.Windows.Controls.Panel.Children%2A>.</span><span class="sxs-lookup"><span data-stu-id="4da86-124">Similarly, to add objects to a <xref:System.Windows.Controls.DockPanel>, you manipulate its <xref:System.Windows.Controls.Panel.Children%2A> property value.</span></span> <span data-ttu-id="4da86-125">Здесь вы добавляете объекты в <xref:System.Windows.Controls.UIElementCollection>.</span><span class="sxs-lookup"><span data-stu-id="4da86-125">Here, you are adding objects to the <xref:System.Windows.Controls.UIElementCollection>.</span></span> <span data-ttu-id="4da86-126">Пример кода см. в разделе [как добавить элемент динамически](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms752374(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="4da86-126">For a code example, see [How to: Add an Element Dynamically](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms752374(v=vs.100)).</span></span>  
  
 <span data-ttu-id="4da86-127">В [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]при помещении элементов списка в <xref:System.Windows.Controls.ListBox> или элементы управления или другие элементы пользовательского интерфейса в <xref:System.Windows.Controls.DockPanel>также используются свойства <xref:System.Windows.Controls.ItemsControl.Items%2A> и <xref:System.Windows.Controls.Panel.Children%2A> явно или неявно, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="4da86-127">In [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)], when you place list items in a <xref:System.Windows.Controls.ListBox> or controls or other UI elements in a <xref:System.Windows.Controls.DockPanel>, you also use the <xref:System.Windows.Controls.ItemsControl.Items%2A> and <xref:System.Windows.Controls.Panel.Children%2A> properties, either explicitly or implicitly, as in the following example.</span></span>  
  
 [!code-xaml[TreeOvwsSupport#AllCode](~/samples/snippets/csharp/VS_Snippets_Wpf/TreeOvwsSupport/CS/page1.xaml#allcode)]  
  
 <span data-ttu-id="4da86-128">Если бы этот XAML обрабатывался как XML в объектной модели документов, и если бы были включены теги, закомментированные как неявные (были бы допустимы), полученное дерево XML DOM включало бы элементы для `<ListBox.Items>` и другие неявные элементы.</span><span class="sxs-lookup"><span data-stu-id="4da86-128">If you were to process this XAML as XML under a document object model, and if you had included the tags commented out as implicit (which would have been legal), then the resulting XML DOM tree would have included elements for `<ListBox.Items>` and the other implicit items.</span></span> <span data-ttu-id="4da86-129">Но XAML не выполняет такую обработку при чтении разметки и записи в объекты, полученный граф объекта не включает `ListBox.Items` в буквальном смысле.</span><span class="sxs-lookup"><span data-stu-id="4da86-129">But XAML does not process that way when you read the markup and write to objects, the resulting object graph does not literally include `ListBox.Items`.</span></span> <span data-ttu-id="4da86-130">Однако у него есть свойство <xref:System.Windows.Controls.ListBox> с именем `Items`, содержащее <xref:System.Windows.Controls.ItemCollection>, которое <xref:System.Windows.Controls.ItemCollection> инициализировано, но является пустым при обработке <xref:System.Windows.Controls.ListBox> XAML.</span><span class="sxs-lookup"><span data-stu-id="4da86-130">It does however have a <xref:System.Windows.Controls.ListBox> property named `Items` that contains a <xref:System.Windows.Controls.ItemCollection>, and that <xref:System.Windows.Controls.ItemCollection> is initialized but empty when the <xref:System.Windows.Controls.ListBox> XAML is processed.</span></span> <span data-ttu-id="4da86-131">Затем каждый дочерний элемент объекта, существующий как содержимое для <xref:System.Windows.Controls.ListBox>, добавляется в <xref:System.Windows.Controls.ItemCollection> вызовами синтаксического анализатора в `ItemCollection.Add`.</span><span class="sxs-lookup"><span data-stu-id="4da86-131">Then, each child object element that exists as content for the <xref:System.Windows.Controls.ListBox> is added to the <xref:System.Windows.Controls.ItemCollection> by parser calls to `ItemCollection.Add`.</span></span> <span data-ttu-id="4da86-132">Этот пример обработки XAML в дереве объектов на первый взгляд похож на пример, в котором созданное дерево объектов, по сути, является логическим деревом.</span><span class="sxs-lookup"><span data-stu-id="4da86-132">This example of processing XAML into an object tree is so far seemingly an example where the created object tree is basically the logical tree.</span></span>  
  
 <span data-ttu-id="4da86-133">Однако логическое дерево не является всей диаграммой объектов, которая существует для пользовательского интерфейса приложения во время выполнения, даже при использовании неявных элементов синтаксиса XAML. Основная причина этого — визуальные элементы и шаблоны.</span><span class="sxs-lookup"><span data-stu-id="4da86-133">However, the logical tree is not the entire object graph that exists for your application UI at run time, even with the XAML implicit syntax items factored out. The main reason for this is visuals and templates.</span></span> <span data-ttu-id="4da86-134">Например, рассмотрим <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="4da86-134">For example, consider the <xref:System.Windows.Controls.Button>.</span></span> <span data-ttu-id="4da86-135">Логическое дерево сообщает об объекте <xref:System.Windows.Controls.Button>, а также его строке `Content`.</span><span class="sxs-lookup"><span data-stu-id="4da86-135">The logical tree reports the <xref:System.Windows.Controls.Button> object and also its string `Content`.</span></span> <span data-ttu-id="4da86-136">Но в дереве объектов времени выполнения имеется больше сведений об этой кнопке.</span><span class="sxs-lookup"><span data-stu-id="4da86-136">But there is more to this button in the run-time object tree.</span></span> <span data-ttu-id="4da86-137">В частности, кнопка отображается на экране только в том виде, в котором был применен определенный шаблон элемента управления <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="4da86-137">In particular, the button only appears on screen the way it does because a specific <xref:System.Windows.Controls.Button> control template was applied.</span></span> <span data-ttu-id="4da86-138">Визуальные элементы, поступающие из примененного шаблона (например, определенные шаблоном <xref:System.Windows.Controls.Border> темно-серого вокруг визуальной кнопки), не передаются в логическое дерево, даже если во время выполнения отображается логическое дерево (например, обработка события ввода из видимого пользовательского интерфейса и последующее чтение логического дерева).</span><span class="sxs-lookup"><span data-stu-id="4da86-138">The visuals that come from an applied template (such as the template-defined <xref:System.Windows.Controls.Border> of dark gray around the visual button) are not reported in the logical tree, even if you are looking at the logical tree during run time (such as handling an input event from the visible UI and then reading the logical tree).</span></span> <span data-ttu-id="4da86-139">Чтобы найти визуальные элементы шаблона, необходимо проверить визуальное дерево.</span><span class="sxs-lookup"><span data-stu-id="4da86-139">To find the template visuals, you would instead need to examine the visual tree.</span></span>  
  
 <span data-ttu-id="4da86-140">Дополнительные сведения о сопоставлении синтаксиса [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с созданным графом объекта и неявным синтаксисом в XAML см. в разделе [Подробное описание синтаксиса XAML](xaml-syntax-in-detail.md) или [Общие сведения о языке XAML (WPF)](xaml-overview-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-140">For more information about how [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] syntax maps to the created object graph, and implicit syntax in XAML, see [XAML Syntax In Detail](xaml-syntax-in-detail.md) or [XAML Overview (WPF)](xaml-overview-wpf.md).</span></span>  
  
<a name="tree_property_inheritance_event_routing"></a>   
### <a name="the-purpose-of-the-logical-tree"></a><span data-ttu-id="4da86-141">Назначение логического дерева</span><span class="sxs-lookup"><span data-stu-id="4da86-141">The Purpose of the Logical Tree</span></span>  
 <span data-ttu-id="4da86-142">Логическое дерево существует для того, чтобы модели содержимого имели возможность пройти по своим доступным дочерним объектам, а также для их расширяемости.</span><span class="sxs-lookup"><span data-stu-id="4da86-142">The logical tree exists so that content models can readily iterate over their possible child objects, and so that content models can be extensible.</span></span> <span data-ttu-id="4da86-143">Кроме того, логическое дерево предоставляет оболочку для некоторых уведомлений, например при загрузке всех объектов логического дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-143">Also, the logical tree provides a framework for certain notifications, such as when all objects in the logical tree are loaded.</span></span> <span data-ttu-id="4da86-144">По существу, логическое дерево является подобием графа объекта времени выполнения на уровне оболочки, исключающего визуальные элементы, но подходит для большинства операций запросов для собственной композиции приложения времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="4da86-144">Basically, the logical tree is an approximation of a run time object graph at the framework level, which excludes visuals, but is adequate for many querying operations against your own run time application's composition.</span></span>  
  
 <span data-ttu-id="4da86-145">Кроме того, как статические, так и динамические ссылки на ресурсы разрешаются путем поиска по логическому дереву <xref:System.Windows.FrameworkElement.Resources%2A> коллекций в первоначальном запрашивающем объекте, а затем продолжается логическое дерево и выполняется проверка каждого <xref:System.Windows.FrameworkElement> (или <xref:System.Windows.FrameworkContentElement>) для другого `Resources`ного значения, содержащего <xref:System.Windows.ResourceDictionary>, возможно, с помощью этого ключа.</span><span class="sxs-lookup"><span data-stu-id="4da86-145">In addition, both static and dynamic resource references are resolved by looking upwards through the logical tree for <xref:System.Windows.FrameworkElement.Resources%2A> collections on the initial requesting object, and then continuing up the logical tree and checking each <xref:System.Windows.FrameworkElement> (or <xref:System.Windows.FrameworkContentElement>) for another `Resources` value that contains a <xref:System.Windows.ResourceDictionary>, possibly containing that key.</span></span> <span data-ttu-id="4da86-146">Логическое дерево используется для просмотра ресурсов при наличии логического дерева и визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-146">The logical tree is used for resource lookup when both the logical tree and the visual tree are present.</span></span> <span data-ttu-id="4da86-147">Дополнительные сведения о словарях ресурсов и поиске см. в разделе [Общие сведения о ресурсах](../../../desktop-wpf/fundamentals/xaml-resources-define.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-147">For more information on resource dictionaries and lookup, see [XAML Resources](../../../desktop-wpf/fundamentals/xaml-resources-define.md).</span></span>  
  
<a name="composition"></a>   
### <a name="composition-of-the-logical-tree"></a><span data-ttu-id="4da86-148">Композиция логического дерева</span><span class="sxs-lookup"><span data-stu-id="4da86-148">Composition of the Logical Tree</span></span>  
 <span data-ttu-id="4da86-149">Логическое дерево определяется на уровне платформы WPF. Это означает, что базовый элемент WPF, который наиболее важен для операций логического дерева, либо <xref:System.Windows.FrameworkElement>, либо <xref:System.Windows.FrameworkContentElement>.</span><span class="sxs-lookup"><span data-stu-id="4da86-149">The logical tree is defined at the WPF framework-level, which means that the WPF base element that is most relevant for logical tree operations is either <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement>.</span></span> <span data-ttu-id="4da86-150">Однако, как можно увидеть, если фактически используется API <xref:System.Windows.LogicalTreeHelper>, логическое дерево иногда содержит узлы, которые не <xref:System.Windows.FrameworkElement> или <xref:System.Windows.FrameworkContentElement>.</span><span class="sxs-lookup"><span data-stu-id="4da86-150">However, as you can see if you actually use the <xref:System.Windows.LogicalTreeHelper> API, the logical tree sometimes contains nodes that are not either <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement>.</span></span> <span data-ttu-id="4da86-151">Например, логическое дерево сообщает значение <xref:System.Windows.Controls.TextBlock.Text%2A> <xref:System.Windows.Controls.TextBlock>, которое является строкой.</span><span class="sxs-lookup"><span data-stu-id="4da86-151">For instance, the logical tree reports the <xref:System.Windows.Controls.TextBlock.Text%2A> value of a <xref:System.Windows.Controls.TextBlock>, which is a string.</span></span>  
  
<a name="override_logical_tree"></a>   
### <a name="overriding-the-logical-tree"></a><span data-ttu-id="4da86-152">Переопределение логического дерева</span><span class="sxs-lookup"><span data-stu-id="4da86-152">Overriding the Logical Tree</span></span>  
 <span data-ttu-id="4da86-153">Авторы расширенного элемента управления могут переопределить логическое дерево путем переопределения нескольких интерфейсов API, определяющих, как общий объект или модель содержимого добавляют или удаляют объекты в логическом дереве.</span><span class="sxs-lookup"><span data-stu-id="4da86-153">Advanced control authors can override the logical tree by overriding several APIs that define how a general object or content model adds or removes objects within the logical tree.</span></span> <span data-ttu-id="4da86-154">Пример переопределения логического дерева содержится в разделе [Переопределение логического дерева](how-to-override-the-logical-tree.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-154">For an example of how to override the logical tree, see [Override the Logical Tree](how-to-override-the-logical-tree.md).</span></span>  
  
<a name="pvi"></a>   
### <a name="property-value-inheritance"></a><span data-ttu-id="4da86-155">Наследование значения свойства</span><span class="sxs-lookup"><span data-stu-id="4da86-155">Property Value Inheritance</span></span>  
 <span data-ttu-id="4da86-156">Наследование значения свойств действует через гибридное дерево.</span><span class="sxs-lookup"><span data-stu-id="4da86-156">Property value inheritance operates through a hybrid tree.</span></span> <span data-ttu-id="4da86-157">Фактические метаданные, содержащие свойство <xref:System.Windows.FrameworkPropertyMetadata.Inherits%2A>, которое позволяет наследование свойств, — это класс <xref:System.Windows.FrameworkPropertyMetadata> уровня среды WPF.</span><span class="sxs-lookup"><span data-stu-id="4da86-157">The actual metadata that contains the <xref:System.Windows.FrameworkPropertyMetadata.Inherits%2A> property that enables property inheritance is the WPF framework-level <xref:System.Windows.FrameworkPropertyMetadata> class.</span></span> <span data-ttu-id="4da86-158">Таким образом, как родитель, содержащий исходное значение, так и дочерний объект, который наследует это значение, должны быть <xref:System.Windows.FrameworkElement> или <xref:System.Windows.FrameworkContentElement>, и они должны быть частью некоторого логического дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-158">Therefore, both the parent that holds the original value and the child object that inherits that value must both be <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement>, and they must both be part of some logical tree.</span></span> <span data-ttu-id="4da86-159">Однако для существующих свойств WPF, поддерживающих наследование свойств, наследование значений свойств способно принять промежуточный объект, которого нет в логическом дереве.</span><span class="sxs-lookup"><span data-stu-id="4da86-159">However, for existing WPF properties that support property inheritance, property value inheritance is able to perpetuate through an intervening object that is not in the logical tree.</span></span> <span data-ttu-id="4da86-160">Как правило, это распространяется на элементы шаблона, использующие все унаследованные значения свойств, заданные как в экземпляре, который является шаблоном, так и на более высоких уровнях композиции уровня страницы и, следовательно, выше в логическом дереве.</span><span class="sxs-lookup"><span data-stu-id="4da86-160">Mainly this is relevant for having template elements use any inherited property values set either on the instance that is templated, or at still higher levels of page-level composition and therefore higher in the logical tree.</span></span> <span data-ttu-id="4da86-161">Чтобы наследование значений свойств осуществлялось согласованно в таких пределах, наследуемое свойство должно быть зарегистрировано как вложенное свойство, кроме того, необходимо следовать этому шаблону, если требуется определить пользовательское свойство зависимостей с поведением наследования свойств.</span><span class="sxs-lookup"><span data-stu-id="4da86-161">In order for property value inheritance to work consistently across such a boundary, the inheriting property must be registered as an attached property, and you should follow this pattern if you intend to define a custom dependency property with property inheritance behavior.</span></span> <span data-ttu-id="4da86-162">Точное дерево, используемое для наследования свойств, не может быть полностью предсказано вспомогательным служебным методом класса даже во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="4da86-162">The exact tree used for property inheritance cannot be entirely anticipated by a helper class utility method, even at run time.</span></span> <span data-ttu-id="4da86-163">Дополнительные сведения см. в разделе [Наследование значения свойства](property-value-inheritance.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-163">For more information, see [Property Value Inheritance](property-value-inheritance.md).</span></span>  
  
<a name="two_trees"></a>   
## <a name="the-visual-tree"></a><span data-ttu-id="4da86-164">Визуальное дерево</span><span class="sxs-lookup"><span data-stu-id="4da86-164">The Visual Tree</span></span>  
 <span data-ttu-id="4da86-165">В дополнение к концепции логического дерева в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] также существует концепция визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-165">In addition to the concept of the logical tree, there is also the concept of the visual tree in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span> <span data-ttu-id="4da86-166">Визуальное дерево описывает структуру визуальных объектов, представленных базовым классом <xref:System.Windows.Media.Visual>.</span><span class="sxs-lookup"><span data-stu-id="4da86-166">The visual tree describes the structure of visual objects, as represented by the <xref:System.Windows.Media.Visual> base class.</span></span> <span data-ttu-id="4da86-167">При написании шаблона для элемента управления следует определить или переопределить визуальное дерево, применяемое для данного элемента управления.</span><span class="sxs-lookup"><span data-stu-id="4da86-167">When you write a template for a control, you are defining or redefining the visual tree that applies for that control.</span></span> <span data-ttu-id="4da86-168">Визуальное дерево также представляет интерес для разработчиков, заинтересованных в контроле рисования на нижнем уровне по соображениям производительности и оптимизации.</span><span class="sxs-lookup"><span data-stu-id="4da86-168">The visual tree is also of interest to developers who want lower-level control over drawing for performance and optimization reasons.</span></span> <span data-ttu-id="4da86-169">Слабым местом визуального дерева как части программирования стандартных приложений [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является то, что маршруты событий для перенаправленного события в большинстве случаев проходят по визуальному дереву, а не по логическому.</span><span class="sxs-lookup"><span data-stu-id="4da86-169">One exposure of the visual tree as part of conventional [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application programming is that event routes for a routed event mostly travel along the visual tree, not the logical tree.</span></span> <span data-ttu-id="4da86-170">Эта тонкость поведения перенаправленного события может быть не очевидна, если вы не являетесь автором элемента управления.</span><span class="sxs-lookup"><span data-stu-id="4da86-170">This subtlety of routed event behavior might not be immediately apparent unless you are a control author.</span></span> <span data-ttu-id="4da86-171">Маршрутизация событий по визуальному дереву позволяет элементам управления, которые реализуют композицию на визуальном уровне, обрабатывать события или создавать установщики событий.</span><span class="sxs-lookup"><span data-stu-id="4da86-171">Routing events through the visual tree enables controls that implement composition at the visual level to handle events or create event setters.</span></span>  
  
<a name="trees_content"></a>   
## <a name="trees-content-elements-and-content-hosts"></a><span data-ttu-id="4da86-172">Деревья, элементы содержимого и узлы содержимого</span><span class="sxs-lookup"><span data-stu-id="4da86-172">Trees, Content Elements, and Content Hosts</span></span>  
 <span data-ttu-id="4da86-173">Элементы содержимого (классы, производные от <xref:System.Windows.ContentElement>) не являются частью визуального дерева; они не наследуют от <xref:System.Windows.Media.Visual> и не имеют визуального представления.</span><span class="sxs-lookup"><span data-stu-id="4da86-173">Content elements (classes that derive from <xref:System.Windows.ContentElement>) are not part of the visual tree; they do not inherit from <xref:System.Windows.Media.Visual> and do not have a visual representation.</span></span> <span data-ttu-id="4da86-174">Для отображения в пользовательском интерфейсе <xref:System.Windows.ContentElement> должны размещаться на узле содержимого, который является и <xref:System.Windows.Media.Visual>, и участником логического дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-174">In order to appear in a UI at all, a <xref:System.Windows.ContentElement> must be hosted in a content host that is both a <xref:System.Windows.Media.Visual> and a logical tree participant.</span></span> <span data-ttu-id="4da86-175">Обычно такой объект является <xref:System.Windows.FrameworkElement>ом.</span><span class="sxs-lookup"><span data-stu-id="4da86-175">Usually such an object is a <xref:System.Windows.FrameworkElement>.</span></span> <span data-ttu-id="4da86-176">Можно представить сайт содержимого в качестве "обозревателя" содержимого, который выбирает способ отображения содержимого в пределах области экрана, управляемой сайтом.</span><span class="sxs-lookup"><span data-stu-id="4da86-176">You can conceptualize that the content host is somewhat like a "browser" for the content and chooses how to display that content within the screen region that the host controls.</span></span> <span data-ttu-id="4da86-177">При размещении содержимого оно может стать участником некоторых процессов дерева, которые обычно связаны с визуальным деревом.</span><span class="sxs-lookup"><span data-stu-id="4da86-177">When the content is hosted, the content can be made a participant in certain tree processes that are normally associated with the visual tree.</span></span> <span data-ttu-id="4da86-178">Как правило, класс узла <xref:System.Windows.FrameworkElement> включает код реализации, который добавляет любые размещенные <xref:System.Windows.ContentElement> в маршрут событий через подузлы логического дерева содержимого, даже если размещенное содержимое не является частью истинного визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-178">Generally, the <xref:System.Windows.FrameworkElement> host class includes implementation code that adds any hosted <xref:System.Windows.ContentElement> to the event route through subnodes of the content logical tree, even though the hosted content is not part of the true visual tree.</span></span> <span data-ttu-id="4da86-179">Это необходимо для того, чтобы в <xref:System.Windows.ContentElement> можно было разослать перенаправленное событие, которое будет маршрутизироваться к любому элементу, отличному от самого себя.</span><span class="sxs-lookup"><span data-stu-id="4da86-179">This is necessary so that a <xref:System.Windows.ContentElement> can source a routed event that routes to any element other than itself.</span></span>  
  
<a name="tree_traversal"></a>   
## <a name="tree-traversal"></a><span data-ttu-id="4da86-180">Прохождение по дереву</span><span class="sxs-lookup"><span data-stu-id="4da86-180">Tree Traversal</span></span>  
 <span data-ttu-id="4da86-181">Класс <xref:System.Windows.LogicalTreeHelper> предоставляет методы <xref:System.Windows.LogicalTreeHelper.GetChildren%2A>, <xref:System.Windows.LogicalTreeHelper.GetParent%2A>и <xref:System.Windows.LogicalTreeHelper.FindLogicalNode%2A> для обхода логического дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-181">The <xref:System.Windows.LogicalTreeHelper> class provides the <xref:System.Windows.LogicalTreeHelper.GetChildren%2A>, <xref:System.Windows.LogicalTreeHelper.GetParent%2A>, and <xref:System.Windows.LogicalTreeHelper.FindLogicalNode%2A> methods for logical tree traversal.</span></span> <span data-ttu-id="4da86-182">В большинстве случаев не следует проходить по логическому дереву существующих элементов управления, так как эти элементы управления почти всегда предоставляют свои логические дочерние элементы в качестве выделенного свойства коллекции, которое поддерживает доступ к коллекции, например `Add`, индексатор и т. д.</span><span class="sxs-lookup"><span data-stu-id="4da86-182">In most cases, you should not have to traverse the logical tree of existing controls, because these controls almost always expose their logical child elements as a dedicated collection property that supports collection access such as `Add`, an indexer, and so on.</span></span> <span data-ttu-id="4da86-183">Обход дерева в основном является сценарием, используемым авторами элементов управления, которые не являются производными от предполагаемых шаблонов элементов управления, таких как <xref:System.Windows.Controls.ItemsControl> или <xref:System.Windows.Controls.Panel>, где свойства коллекции уже определены, и кто планирует предоставить собственную поддержку свойств коллекции.</span><span class="sxs-lookup"><span data-stu-id="4da86-183">Tree traversal is mainly a scenario that is used by control authors who choose not to derive from intended control patterns such as <xref:System.Windows.Controls.ItemsControl> or <xref:System.Windows.Controls.Panel> where collection properties are already defined, and who intend to provide their own collection property support.</span></span>  
  
 <span data-ttu-id="4da86-184">Визуальное дерево также поддерживает вспомогательный класс для обхода визуального дерева, <xref:System.Windows.Media.VisualTreeHelper>.</span><span class="sxs-lookup"><span data-stu-id="4da86-184">The visual tree also supports a helper class for visual tree traversal, <xref:System.Windows.Media.VisualTreeHelper>.</span></span> <span data-ttu-id="4da86-185">Визуальное дерево недоступно для свойств, зависящих от элемента управления, поэтому класс <xref:System.Windows.Media.VisualTreeHelper> является рекомендуемым способом обхода визуального дерева, если это необходимо для сценария программирования.</span><span class="sxs-lookup"><span data-stu-id="4da86-185">The visual tree is not exposed as conveniently through control-specific properties, so the <xref:System.Windows.Media.VisualTreeHelper> class is the recommended way to traverse the visual tree if that is necessary for your programming scenario.</span></span> <span data-ttu-id="4da86-186">Дополнительные сведения см. в разделе [Общие сведения об отрисовке графики в WPF](../graphics-multimedia/wpf-graphics-rendering-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-186">For more information, see [WPF Graphics Rendering Overview](../graphics-multimedia/wpf-graphics-rendering-overview.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4da86-187">Иногда необходимо проверять визуальное дерево применяемого шаблона.</span><span class="sxs-lookup"><span data-stu-id="4da86-187">Sometimes it is necessary to examine the visual tree of an applied template.</span></span> <span data-ttu-id="4da86-188">Необходимо соблюдать осторожность при использовании этого метода.</span><span class="sxs-lookup"><span data-stu-id="4da86-188">You should be careful when using this technique.</span></span> <span data-ttu-id="4da86-189">Даже если вы просматриваете визуальное дерево для элемента управления, в котором вы определили шаблон, потребители элемента управления всегда могут изменить шаблон, установив свойство <xref:System.Windows.Controls.Control.Template%2A> для экземпляров, и даже конечный пользователь может повлиять на примененный шаблон, изменив тему системы.</span><span class="sxs-lookup"><span data-stu-id="4da86-189">Even if you are traversing a visual tree for a control where you define the template, consumers of your control can always change the template by setting the <xref:System.Windows.Controls.Control.Template%2A> property on instances, and even the end user can influence the applied template by changing the system theme.</span></span>  
  
<a name="routes"></a>   
## <a name="routes-for-routed-events-as-a-tree"></a><span data-ttu-id="4da86-190">Маршруты для маршрутизируемых событий как "дерево"</span><span class="sxs-lookup"><span data-stu-id="4da86-190">Routes for Routed Events as a "Tree"</span></span>  
 <span data-ttu-id="4da86-191">Как уже отмечалось ранее, маршрут любого заданного перенаправленного события проходит по одному предопределенному пути дерева, представляющего собой гибрид представлений визуального и логического деревьев.</span><span class="sxs-lookup"><span data-stu-id="4da86-191">As mentioned before, the route of any given routed event travels along a single and predetermined path of a tree that is a hybrid of the visual and logical tree representations.</span></span> <span data-ttu-id="4da86-192">Маршрут события может проходить как по восходящей, так и по нисходящий в пределах дерева в зависимости от того, имеет ли перенаправленное событие нисходящую или восходящую маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="4da86-192">The event route can travel either in the up or down directions within the tree depending on whether it is a tunneling or bubbling routed event.</span></span> <span data-ttu-id="4da86-193">Концепция маршрута события не имеет непосредственного вспомогательного класса, который может быть использован для "прохода" маршрута события независимо от вызова фактически перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="4da86-193">The event route concept does not have a directly supporting helper class that could be used to "walk" the event route independently of raising an event that actually routes.</span></span> <span data-ttu-id="4da86-194">Существует класс, представляющий маршрут, <xref:System.Windows.EventRoute>, но методы этого класса обычно предназначены только для внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="4da86-194">There is a class that represents the route, <xref:System.Windows.EventRoute>, but the methods of that class are generally for internal use only.</span></span>  
  
<a name="resourcesandtrees"></a>   
## <a name="resource-dictionaries-and-trees"></a><span data-ttu-id="4da86-195">Словари и деревья ресурсов</span><span class="sxs-lookup"><span data-stu-id="4da86-195">Resource Dictionaries and Trees</span></span>  
 <span data-ttu-id="4da86-196">Поиск по словарю ресурсов для всех `Resources`, определенных на странице, обычно проходит по логическому дереву.</span><span class="sxs-lookup"><span data-stu-id="4da86-196">Resource dictionary lookup for all `Resources` defined in a page traverses basically the logical tree.</span></span> <span data-ttu-id="4da86-197">Объекты, которые не входят в логическое дерево, могут ссылаться на ресурсы с ключом, но последовательность поиска ресурса начинается с той точки, где объект подключен к логическому дереву.</span><span class="sxs-lookup"><span data-stu-id="4da86-197">Objects that are not in the logical tree can reference keyed resources, but the resource lookup sequence begins at the point where that object is connected to the logical tree.</span></span> <span data-ttu-id="4da86-198">В WPF только логические узлы дерева могут иметь свойство `Resources`, которое содержит <xref:System.Windows.ResourceDictionary>, поэтому нет смысла перемещаться по визуальному дереву при поиске ключевых ресурсов из <xref:System.Windows.ResourceDictionary>.</span><span class="sxs-lookup"><span data-stu-id="4da86-198">In WPF, only logical tree nodes can have a `Resources` property that contains a <xref:System.Windows.ResourceDictionary>, therefore there is no benefit in traversing the visual tree looking for keyed resources from a <xref:System.Windows.ResourceDictionary>.</span></span>  
  
 <span data-ttu-id="4da86-199">В то же время поиск ресурсов также можно расширить за пределы логического дерева.</span><span class="sxs-lookup"><span data-stu-id="4da86-199">However, resource lookup can also extend beyond the immediate logical tree.</span></span> <span data-ttu-id="4da86-200">Для разметки приложения поиск ресурсов можно затем продолжить в словарях ресурсов на уровне приложений, поддержке тем и значениях системы, на которые ссылаются как на статические свойства или ключи.</span><span class="sxs-lookup"><span data-stu-id="4da86-200">For application markup, the resource lookup can then continue onward to application-level resource dictionaries and then to theme support and system values that are referenced as static properties or keys.</span></span> <span data-ttu-id="4da86-201">Сами темы также могут ссылаться на системные значения вне логического дерева тем, если ссылки на ресурсы являются динамическими.</span><span class="sxs-lookup"><span data-stu-id="4da86-201">Themes themselves can also reference system values outside of the theme logical tree if the resource references are dynamic.</span></span> <span data-ttu-id="4da86-202">Дополнительные сведения о словарях ресурсов и логике поиска см. в разделе [Ресурсы XAML](../../../desktop-wpf/fundamentals/xaml-resources-define.md).</span><span class="sxs-lookup"><span data-stu-id="4da86-202">For more information on resource dictionaries and the lookup logic, see [XAML Resources](../../../desktop-wpf/fundamentals/xaml-resources-define.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4da86-203">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="4da86-203">See also</span></span>

- [<span data-ttu-id="4da86-204">Общие сведения о входных данных</span><span class="sxs-lookup"><span data-stu-id="4da86-204">Input Overview</span></span>](input-overview.md)
- [<span data-ttu-id="4da86-205">Общие сведения об отрисовке графики в WPF</span><span class="sxs-lookup"><span data-stu-id="4da86-205">WPF Graphics Rendering Overview</span></span>](../graphics-multimedia/wpf-graphics-rendering-overview.md)
- [<span data-ttu-id="4da86-206">Общие сведения о перенаправленных событиях</span><span class="sxs-lookup"><span data-stu-id="4da86-206">Routed Events Overview</span></span>](routed-events-overview.md)
- [<span data-ttu-id="4da86-207">Инициализация для объектных элементов, которые не находятся в дереве объектов</span><span class="sxs-lookup"><span data-stu-id="4da86-207">Initialization for Object Elements Not in an Object Tree</span></span>](initialization-for-object-elements-not-in-an-object-tree.md)
- [<span data-ttu-id="4da86-208">Архитектура WPF</span><span class="sxs-lookup"><span data-stu-id="4da86-208">WPF Architecture</span></span>](wpf-architecture.md)
