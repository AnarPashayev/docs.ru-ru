---
title: Практическое руководство. Реализация проверки с помощью элемента управления DataGrid
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- DataGrid [WPF], validation
- validation [WPF], DataGrid
ms.assetid: ec6078a8-1e42-4648-b414-f4348e81bda1
ms.openlocfilehash: 38b4c9cd7679f0d8da9b18fb5bd6bb729d33ed54
ms.sourcegitcommit: 62285ec11fa8e8424bab00511a90760c60e63c95
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2020
ms.locfileid: "81646091"
---
# <a name="how-to-implement-validation-with-the-datagrid-control"></a><span data-ttu-id="de350-102">Практическое руководство. Реализация проверки с помощью элемента управления DataGrid</span><span class="sxs-lookup"><span data-stu-id="de350-102">How to: Implement Validation with the DataGrid Control</span></span>
<span data-ttu-id="de350-103">Элемент <xref:System.Windows.Controls.DataGrid> управления позволяет выполнять проверку как на уровне ячейки, так и на уровне строки.</span><span class="sxs-lookup"><span data-stu-id="de350-103">The <xref:System.Windows.Controls.DataGrid> control enables you to perform validation at both the cell and row level.</span></span> <span data-ttu-id="de350-104">При проверке уровня ячейки вы проверяете отдельные свойства связанного объекта данных, когда пользователь обновляет значение.</span><span class="sxs-lookup"><span data-stu-id="de350-104">With cell-level validation, you validate individual properties of a bound data object when a user updates a value.</span></span> <span data-ttu-id="de350-105">При проверке уровня строки проверяется целые объекты данных при фиксации пользователем изменений в строку.</span><span class="sxs-lookup"><span data-stu-id="de350-105">With row-level validation, you validate entire data objects when a user commits changes to a row.</span></span> <span data-ttu-id="de350-106">Вы также можете предоставить индивидуальную визуальную обратную связь <xref:System.Windows.Controls.DataGrid> для ошибок проверки, или использовать визуальную обратную связь по умолчанию, которую обеспечивает элемент управления.</span><span class="sxs-lookup"><span data-stu-id="de350-106">You can also provide customized visual feedback for validation errors, or use the default visual feedback that the <xref:System.Windows.Controls.DataGrid> control provides.</span></span>  
  
 <span data-ttu-id="de350-107">Следующие процедуры описывают, как <xref:System.Windows.Controls.DataGrid> применять правила проверки к привязки и настроить визуальную обратную связь.</span><span class="sxs-lookup"><span data-stu-id="de350-107">The following procedures describe how to apply validation rules to <xref:System.Windows.Controls.DataGrid> bindings and customize the visual feedback.</span></span>  
  
### <a name="to-validate-individual-cell-values"></a><span data-ttu-id="de350-108">Для проверки значений отдельных ячеек</span><span class="sxs-lookup"><span data-stu-id="de350-108">To validate individual cell values</span></span>  
  
- <span data-ttu-id="de350-109">Укажите одно или несколько правил проверки на привязке, используемой с столбецом.</span><span class="sxs-lookup"><span data-stu-id="de350-109">Specify one or more validation rules on the binding used with a column.</span></span> <span data-ttu-id="de350-110">Это похоже на проверку данных в простых элементах управления, как описано в [обзоре связывания данных.](../../../desktop-wpf/data/data-binding-overview.md)</span><span class="sxs-lookup"><span data-stu-id="de350-110">This is similar to validating data in simple controls, as described in [Data Binding Overview](../../../desktop-wpf/data/data-binding-overview.md).</span></span>  
  
     <span data-ttu-id="de350-111">В следующем примере <xref:System.Windows.Controls.DataGrid> показан элемент управления с четырьмя столбцов, связанными с различными свойствами бизнес-объекта.</span><span class="sxs-lookup"><span data-stu-id="de350-111">The following example shows a <xref:System.Windows.Controls.DataGrid> control with four columns bound to different properties of a business object.</span></span> <span data-ttu-id="de350-112">Три столбца указывают <xref:System.Windows.Controls.ExceptionValidationRule> свойство. <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> `true`</span><span class="sxs-lookup"><span data-stu-id="de350-112">Three of the columns specify the <xref:System.Windows.Controls.ExceptionValidationRule> by setting the <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> property to `true`.</span></span>  
  
     [!code-xaml[DataGrid_Validation#BasicXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/window1.xaml#basicxaml)]  
  
     <span data-ttu-id="de350-113">Когда пользователь вводит недействительное значение (например, нецелый в столбце идентификатора курса), вокруг ячейки появляется красная граница.</span><span class="sxs-lookup"><span data-stu-id="de350-113">When a user enters an invalid value (such as a non-integer in the Course ID column), a red border appears around the cell.</span></span> <span data-ttu-id="de350-114">Вы можете изменить эту обратную связь проверки по умолчанию, описанную в следующей процедуре.</span><span class="sxs-lookup"><span data-stu-id="de350-114">You can change this default validation feedback as described in the following procedure.</span></span>  
  
### <a name="to-customize-cell-validation-feedback"></a><span data-ttu-id="de350-115">Настройка обратной связи с проверкой ячейки</span><span class="sxs-lookup"><span data-stu-id="de350-115">To customize cell validation feedback</span></span>  
  
- <span data-ttu-id="de350-116">Установите <xref:System.Windows.Controls.DataGridBoundColumn.EditingElementStyle%2A> свойство столбца в стиль, подходящий для управления редактированием столбца.</span><span class="sxs-lookup"><span data-stu-id="de350-116">Set the column's <xref:System.Windows.Controls.DataGridBoundColumn.EditingElementStyle%2A> property to a style appropriate for the column's editing control.</span></span> <span data-ttu-id="de350-117">Поскольку элементы управления редактированием создаются <xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType> во время выполнения, вы не можете использовать прикрепленное свойство, как это было бы с простыми элементами управления.</span><span class="sxs-lookup"><span data-stu-id="de350-117">Because the editing controls are created at run time, you cannot use the <xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType> attached property like you would with simple controls.</span></span>  
  
     <span data-ttu-id="de350-118">Следующий пример обновляет предыдущий пример, добавляя стиль ошибки, разделяемый тремя столбцами, с правилами проверки.</span><span class="sxs-lookup"><span data-stu-id="de350-118">The following example updates the previous example by adding an error style shared by the three columns with validation rules.</span></span> <span data-ttu-id="de350-119">Когда пользователь вводит недействительное значение, стиль изменяет цвет фона ячейки и добавляет ToolTip.</span><span class="sxs-lookup"><span data-stu-id="de350-119">When a user enters an invalid value, the style changes the cell background color and adds a ToolTip.</span></span> <span data-ttu-id="de350-120">Обратите внимание на использование триггера, чтобы определить, есть ли ошибка проверки.</span><span class="sxs-lookup"><span data-stu-id="de350-120">Note the use of a trigger to determine whether there is a validation error.</span></span> <span data-ttu-id="de350-121">Это необходимо, поскольку в настоящее время нет выделенного шаблона ошибок для ячеек.</span><span class="sxs-lookup"><span data-stu-id="de350-121">This is required because there is currently no dedicated error template for cells.</span></span>  
  
     [!code-xaml[DataGrid_Validation#CellValidationXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml#cellvalidationxaml)]  
  
     <span data-ttu-id="de350-122">Можно реализовать более обширную настройку, заменив используемую <xref:System.Windows.Controls.DataGridColumn.CellStyle%2A> столбец.</span><span class="sxs-lookup"><span data-stu-id="de350-122">You can implement more extensive customization by replacing the <xref:System.Windows.Controls.DataGridColumn.CellStyle%2A> used by the column.</span></span>  
  
### <a name="to-validate-multiple-values-in-a-single-row"></a><span data-ttu-id="de350-123">Для проверки нескольких значений в одной строке</span><span class="sxs-lookup"><span data-stu-id="de350-123">To validate multiple values in a single row</span></span>  
  
1. <span data-ttu-id="de350-124">Реализация <xref:System.Windows.Controls.ValidationRule> подкласса, проверяющий несколько свойств связанного объекта данных.</span><span class="sxs-lookup"><span data-stu-id="de350-124">Implement a <xref:System.Windows.Controls.ValidationRule> subclass that checks multiple properties of the bound data object.</span></span> <span data-ttu-id="de350-125">При <xref:System.Windows.Controls.ValidationRule.Validate%2A> реализации метода `value` отбросьте значение параметра в <xref:System.Windows.Data.BindingGroup> экземпляр.</span><span class="sxs-lookup"><span data-stu-id="de350-125">In your <xref:System.Windows.Controls.ValidationRule.Validate%2A> method implementation, cast the `value` parameter value to a <xref:System.Windows.Data.BindingGroup> instance.</span></span> <span data-ttu-id="de350-126">Затем можно получить доступ к <xref:System.Windows.Data.BindingGroup.Items%2A> объекту данных через свойство.</span><span class="sxs-lookup"><span data-stu-id="de350-126">You can then access the data object through the <xref:System.Windows.Data.BindingGroup.Items%2A> property.</span></span>  
  
     <span data-ttu-id="de350-127">Следующий пример демонстрирует этот процесс, `StartDate` чтобы проверить, является ли значение свойства для `Course` объекта раньше, чем его `EndDate` значение свойства.</span><span class="sxs-lookup"><span data-stu-id="de350-127">The following example demonstrates this process to validate whether the `StartDate` property value for a `Course` object is earlier than its `EndDate` property value.</span></span>  
  
     [!code-csharp[DataGrid_Validation#CourseValidationRule](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml.cs#coursevalidationrule)]
     [!code-vb[DataGrid_Validation#CourseValidationRule](~/samples/snippets/visualbasic/VS_Snippets_Wpf/datagrid_validation/vb/mainwindow.xaml.vb#coursevalidationrule)]  
  
2. <span data-ttu-id="de350-128">Добавьте правило проверки <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A?displayProperty=nameWithType> в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="de350-128">Add the validation rule to the <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A?displayProperty=nameWithType> collection.</span></span> <span data-ttu-id="de350-129">Свойство <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A> обеспечивает прямой <xref:System.Windows.Data.BindingGroup.ValidationRules%2A> доступ <xref:System.Windows.Data.BindingGroup> к свойству экземпляра, который группирует все привязки, используемые элементом управления.</span><span class="sxs-lookup"><span data-stu-id="de350-129">The <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A> property provides direct access to the <xref:System.Windows.Data.BindingGroup.ValidationRules%2A> property of a <xref:System.Windows.Data.BindingGroup> instance that groups all the bindings used by the control.</span></span>  
  
     <span data-ttu-id="de350-130">Следующий пример <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A> приводит свойство в XAML.</span><span class="sxs-lookup"><span data-stu-id="de350-130">The following example sets the <xref:System.Windows.Controls.DataGrid.RowValidationRules%2A> property in XAML.</span></span> <span data-ttu-id="de350-131">Свойство <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> настроено <xref:System.Windows.Controls.ValidationStep.UpdatedValue> на то, чтобы проверка происходила только после обновления связанного объекта данных.</span><span class="sxs-lookup"><span data-stu-id="de350-131">The <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> property is set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> so that the validation occurs only after the bound data object is updated.</span></span>  
  
     [!code-xaml[DataGrid_Validation#RowValidationRulesXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml#rowvalidationrulesxaml)]  
  
     <span data-ttu-id="de350-132">Когда пользователь указывает дату окончания, которая раньше даты начала, красный восклицательный знак (!) появляется в заголовке строки.</span><span class="sxs-lookup"><span data-stu-id="de350-132">When a user specifies an end date that is earlier than the start date, a red exclamation mark (!) appears in the row header.</span></span> <span data-ttu-id="de350-133">Вы можете изменить эту обратную связь проверки по умолчанию, описанную в следующей процедуре.</span><span class="sxs-lookup"><span data-stu-id="de350-133">You can change this default validation feedback as described in the following procedure.</span></span>  
  
### <a name="to-customize-row-validation-feedback"></a><span data-ttu-id="de350-134">Настройка обратной связи с проверкой строки</span><span class="sxs-lookup"><span data-stu-id="de350-134">To customize row validation feedback</span></span>  
  
- <span data-ttu-id="de350-135">Задайте свойство <xref:System.Windows.Controls.DataGrid.RowValidationErrorTemplate%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="de350-135">Set the <xref:System.Windows.Controls.DataGrid.RowValidationErrorTemplate%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="de350-136">Это свойство позволяет настроить отзывы о <xref:System.Windows.Controls.DataGrid> проверке строки для отдельных элементов управления.</span><span class="sxs-lookup"><span data-stu-id="de350-136">This property enables you to customize row validation feedback for individual <xref:System.Windows.Controls.DataGrid> controls.</span></span> <span data-ttu-id="de350-137">Вы также можете повлиять на несколько элементов управления, используя неявный стиль строки для установки <xref:System.Windows.Controls.DataGridRow.ValidationErrorTemplate%2A?displayProperty=nameWithType> свойства.</span><span class="sxs-lookup"><span data-stu-id="de350-137">You can also affect multiple controls by using an implicit row style to set the <xref:System.Windows.Controls.DataGridRow.ValidationErrorTemplate%2A?displayProperty=nameWithType> property.</span></span>  
  
     <span data-ttu-id="de350-138">Следующий пример заменяет обратную связь проверки строки по умолчанию более заметным индикатором.</span><span class="sxs-lookup"><span data-stu-id="de350-138">The following example replaces the default row validation feedback with a more visible indicator.</span></span> <span data-ttu-id="de350-139">Когда пользователь вводит недействительное значение, в заголовке строки появляется красный круг с белым восклицательным знаком.</span><span class="sxs-lookup"><span data-stu-id="de350-139">When a user enters an invalid value, a red circle with a white exclamation mark appears in the row header.</span></span> <span data-ttu-id="de350-140">Это происходит как для ошибок проверки строки и ячейки.</span><span class="sxs-lookup"><span data-stu-id="de350-140">This occurs for both row and cell validation errors.</span></span> <span data-ttu-id="de350-141">Связанное сообщение об ошибке отображается в ToolTip.</span><span class="sxs-lookup"><span data-stu-id="de350-141">The associated error message is displayed in a ToolTip.</span></span>  
  
     [!code-xaml[DataGrid_Validation#RowValidationFeedbackXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml#rowvalidationfeedbackxaml)]  
  
## <a name="example"></a><span data-ttu-id="de350-142">Пример</span><span class="sxs-lookup"><span data-stu-id="de350-142">Example</span></span>  
 <span data-ttu-id="de350-143">Следующий пример обеспечивает полную демонстрацию для проверки ячейки и строки.</span><span class="sxs-lookup"><span data-stu-id="de350-143">The following example provides a complete demonstration for cell and row validation.</span></span> <span data-ttu-id="de350-144">Класс `Course` предоставляет объект выборочных данных, который реализуется для поддержки <xref:System.ComponentModel.IEditableObject> транзакций.</span><span class="sxs-lookup"><span data-stu-id="de350-144">The `Course` class provides a sample data object that implements <xref:System.ComponentModel.IEditableObject> to support transactions.</span></span> <span data-ttu-id="de350-145">Контроль <xref:System.Windows.Controls.DataGrid> взаимодействует <xref:System.ComponentModel.IEditableObject> с, чтобы позволить пользователям вернуть изменения, нажав ESC.</span><span class="sxs-lookup"><span data-stu-id="de350-145">The <xref:System.Windows.Controls.DataGrid> control interacts with <xref:System.ComponentModel.IEditableObject> to enable users to revert changes by pressing ESC.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="de350-146">Если вы используете Visual Basic, в первой строке MainWindow.xaml, замените `x:Class="DataGridValidation.MainWindow"` `x:Class="MainWindow"`на .</span><span class="sxs-lookup"><span data-stu-id="de350-146">If you are using Visual Basic, in the first line of MainWindow.xaml, replace `x:Class="DataGridValidation.MainWindow"` with `x:Class="MainWindow"`.</span></span>  
  
 <span data-ttu-id="de350-147">Чтобы проверить проверку, попробуйте следующее:</span><span class="sxs-lookup"><span data-stu-id="de350-147">To test the validation, try the following:</span></span>  
  
- <span data-ttu-id="de350-148">В столбце ИДЕНтификатор курса введите значение, не входявное.</span><span class="sxs-lookup"><span data-stu-id="de350-148">In the Course ID column, enter a non-integer value.</span></span>  
  
- <span data-ttu-id="de350-149">В столбце «Дата окончания» введите дату, которая раньше даты начала.</span><span class="sxs-lookup"><span data-stu-id="de350-149">In the End Date column, enter a date that is earlier than the Start Date.</span></span>  
  
- <span data-ttu-id="de350-150">Удалите значение в идентификаторе курса, дате начала или дате окончания.</span><span class="sxs-lookup"><span data-stu-id="de350-150">Delete the value in Course ID, Start Date, or End Date.</span></span>  
  
- <span data-ttu-id="de350-151">Чтобы отменить недействительное значение ячейки, поместите курсор обратно в ячейку и нажмите клавишу ESC.</span><span class="sxs-lookup"><span data-stu-id="de350-151">To undo an invalid cell value, put the cursor back in the cell and press the ESC key.</span></span>  
  
- <span data-ttu-id="de350-152">Чтобы отменить изменения для всей строки, когда текущая ячейка находится в режиме изменения, нажмите ключ ESC дважды.</span><span class="sxs-lookup"><span data-stu-id="de350-152">To undo changes for an entire row when the current cell is in edit mode, press the ESC key twice.</span></span>  
  
- <span data-ttu-id="de350-153">При возникновении ошибки проверки переместите указатель мыши по индикатору в заголовке строки, чтобы увидеть связанное сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="de350-153">When a validation error occurs, move your mouse pointer over the indicator in the row header to see the associated error message.</span></span>  
  
 [!code-csharp[DataGrid_Validation#FullCode](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml.cs#fullcode)]
 [!code-vb[DataGrid_Validation#FullCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/datagrid_validation/vb/mainwindow.xaml.vb#fullcode)]  
  
 [!code-xaml[DataGrid_Validation#FullXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/datagrid_validation/cs/mainwindow.xaml#fullxaml)]  
  
## <a name="see-also"></a><span data-ttu-id="de350-154">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="de350-154">See also</span></span>

- <xref:System.Windows.Controls.DataGrid>
- [<span data-ttu-id="de350-155">DataGrid</span><span class="sxs-lookup"><span data-stu-id="de350-155">DataGrid</span></span>](datagrid.md)
- [<span data-ttu-id="de350-156">Связывание данных</span><span class="sxs-lookup"><span data-stu-id="de350-156">Data Binding</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="de350-157">Реализация обязательной проверки</span><span class="sxs-lookup"><span data-stu-id="de350-157">Implement Binding Validation</span></span>](../data/how-to-implement-binding-validation.md)
- [<span data-ttu-id="de350-158">Реализация логики проверки на пользовательских объектах</span><span class="sxs-lookup"><span data-stu-id="de350-158">Implement Validation Logic on Custom Objects</span></span>](../data/how-to-implement-validation-logic-on-custom-objects.md)
