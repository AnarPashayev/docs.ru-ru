---
title: Проверка попадания на визуальном уровне
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- hit testing functionality [WPF]
- visual layer [WPF], hit testing functionality
ms.assetid: b1a64b61-14be-4d75-b89a-5c67bebb2c7b
ms.openlocfilehash: 28ae983923c985050ac589166023e483721028d3
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77452621"
---
# <a name="hit-testing-in-the-visual-layer"></a><span data-ttu-id="c70c5-102">Проверка попадания на визуальном уровне</span><span class="sxs-lookup"><span data-stu-id="c70c5-102">Hit Testing in the Visual Layer</span></span>
<span data-ttu-id="c70c5-103">В этом разделе приведены общие сведения о функции проверки попадания, предоставляемой на визуальном уровне.</span><span class="sxs-lookup"><span data-stu-id="c70c5-103">This topic provides an overview of hit testing functionality provided by the visual layer.</span></span> <span data-ttu-id="c70c5-104">Поддержка проверки попадания позволяет определить, попадает ли геометрическое значение или точка в отображаемое содержимое <xref:System.Windows.Media.Visual>, что позволяет реализовать поведение пользовательского интерфейса, например прямоугольник выделения, для выбора нескольких объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-104">Hit testing support allows you to determine whether a geometry or point value falls within the rendered content of a <xref:System.Windows.Media.Visual>, allowing you to implement user interface behavior such as a selection rectangle to select multiple objects.</span></span>  

<a name="hit_testing_scenarios"></a>   
## <a name="hit-testing-scenarios"></a><span data-ttu-id="c70c5-105">Сценарии проверки попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-105">Hit Testing Scenarios</span></span>  
 <span data-ttu-id="c70c5-106">Класс <xref:System.Windows.UIElement> предоставляет метод <xref:System.Windows.UIElement.InputHitTest%2A>, который позволяет выполнять проверку на элементе, используя заданное значение координаты.</span><span class="sxs-lookup"><span data-stu-id="c70c5-106">The <xref:System.Windows.UIElement> class provides the <xref:System.Windows.UIElement.InputHitTest%2A> method, which allows you to hit test against an element using a given coordinate value.</span></span> <span data-ttu-id="c70c5-107">Во многих случаях метод <xref:System.Windows.UIElement.InputHitTest%2A> предоставляет требуемые функции для реализации проверки попадания элементов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-107">In many cases, the <xref:System.Windows.UIElement.InputHitTest%2A> method provides the desired functionality for implementing hit testing of elements.</span></span> <span data-ttu-id="c70c5-108">Однако существует несколько сценариев, в которых может потребоваться реализация проверки попадания на визуальном уровне.</span><span class="sxs-lookup"><span data-stu-id="c70c5-108">However, there are several scenarios in which you may need to implement hit testing at the visual layer.</span></span>  
  
- <span data-ttu-id="c70c5-109">Проверка нажатия для объектов, не относящихся к<xref:System.Windows.UIElement>: это происходит при проверке попадания на объекты, не являющиеся<xref:System.Windows.UIElement>, например <xref:System.Windows.Media.DrawingVisual> или графические объекты.</span><span class="sxs-lookup"><span data-stu-id="c70c5-109">Hit testing against non-<xref:System.Windows.UIElement> objects: This applies if you are hit testing non-<xref:System.Windows.UIElement> objects, such as <xref:System.Windows.Media.DrawingVisual> or graphics objects.</span></span>  
  
- <span data-ttu-id="c70c5-110">Проверка попадания с использованием геометрического объекта: это применимо, если нужно проверить попадание с использованием геометрического объекта, а не значения координат точки.</span><span class="sxs-lookup"><span data-stu-id="c70c5-110">Hit testing using a geometry: This applies if you need to hit test using a geometry object rather than the coordinate value of a point.</span></span>  
  
- <span data-ttu-id="c70c5-111">Проверка попадания для нескольких объектов: это применимо, когда нужно проверить попадание для нескольких объектов, например перекрывающихся объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-111">Hit testing against multiple objects: This applies when you need to hit test against multiple objects, such as overlapping objects.</span></span> <span data-ttu-id="c70c5-112">Можно получить результаты для всех визуальных объектов, пересекающих геометрический объект или точку, а не только для первого из них.</span><span class="sxs-lookup"><span data-stu-id="c70c5-112">You can get results for all visuals intersecting a geometry or point, not just the first one.</span></span>  
  
- <span data-ttu-id="c70c5-113">Пропуск политики проверки попадания <xref:System.Windows.UIElement>: это применимо, если необходимо пропустить политику проверки попадания <xref:System.Windows.UIElement>, которая учитывает такие факторы, как недоступность или невидимость элемента.</span><span class="sxs-lookup"><span data-stu-id="c70c5-113">Ignoring <xref:System.Windows.UIElement> hit testing policy: This applies when you need to ignore the <xref:System.Windows.UIElement> hit testing policy, which takes into consideration such factors as whether an element is disabled or invisible.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c70c5-114">Пример полного кода, иллюстрирующего проверку попадания на визуальном уровне, см. в разделе [Пример проверки попадания с помощью DrawingVisuals](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual) и [Пример взаимодействия проверки попадания с Win32](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting).</span><span class="sxs-lookup"><span data-stu-id="c70c5-114">For a complete code sample illustrating hit testing at the visual layer, see [Hit Test Using DrawingVisuals Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual) and [Hit Test with Win32 Interoperation Sample](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting).</span></span>  
  
<a name="hit_testing_support"></a>   
## <a name="hit-testing-support"></a><span data-ttu-id="c70c5-115">Поддержка проверки попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-115">Hit Testing Support</span></span>  
 <span data-ttu-id="c70c5-116">Назначение методов <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> в классе <xref:System.Windows.Media.VisualTreeHelper> заключается в том, чтобы определить, находится ли геометрический объект или координата точки в отображаемом содержимом данного объекта, например элемент управления или графический элемент.</span><span class="sxs-lookup"><span data-stu-id="c70c5-116">The purpose of the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> methods in the <xref:System.Windows.Media.VisualTreeHelper> class is to determine whether a geometry or point coordinate value is within the rendered content of a given object, such as a control or graphic element.</span></span> <span data-ttu-id="c70c5-117">Например, можно использовать проверку попадания для определения, попадает ли щелчок мышью в ограничивающем прямоугольнике объекта в границы фигуры круга.</span><span class="sxs-lookup"><span data-stu-id="c70c5-117">For example, you could use hit testing to determine whether a mouse click within the bounding rectangle of an object falls within the geometry of a circle.</span></span> <span data-ttu-id="c70c5-118">Можно также переопределить реализацию проверки попадания по умолчанию для выполнения собственных вычислений по проверке попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-118">You can also choose to override the default implementation of hit testing to perform your own custom hit test calculations.</span></span>  
  
 <span data-ttu-id="c70c5-119">На следующем рисунке показана связь между областью не прямоугольного объекта и ограничивающим его прямоугольником.</span><span class="sxs-lookup"><span data-stu-id="c70c5-119">The following illustration shows the relationship between a non-rectangular object's region and its bounding rectangle.</span></span>  
  
 <span data-ttu-id="c70c5-120">![Допустимая область проверки попадания](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span><span class="sxs-lookup"><span data-stu-id="c70c5-120">![Diagram of valid hit test region](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span></span>  
<span data-ttu-id="c70c5-121">Допустимая область проверки попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-121">Diagram of valid hit test region</span></span>  
  
<a name="hit_testing_and_z-order"></a>   
## <a name="hit-testing-and-z-order"></a><span data-ttu-id="c70c5-122">Проверка попадания и порядок по оси Z</span><span class="sxs-lookup"><span data-stu-id="c70c5-122">Hit Testing and Z-Order</span></span>  
 <span data-ttu-id="c70c5-123">Визуальный уровень [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] поддерживает проверку попадания для всех объектов, в которых находится точка или геометрическая фигура, а не только для самого верхнего.</span><span class="sxs-lookup"><span data-stu-id="c70c5-123">The [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] visual layer supports hit testing against all objects under a point or geometry, not just the top-most object.</span></span> <span data-ttu-id="c70c5-124">Результаты возвращаются в порядке по оси z.</span><span class="sxs-lookup"><span data-stu-id="c70c5-124">Results are returned in z-order.</span></span> <span data-ttu-id="c70c5-125">Однако визуальный объект, который передается в качестве параметра методу <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>, определяет, какая часть визуального дерева будет проверять нажатие.</span><span class="sxs-lookup"><span data-stu-id="c70c5-125">However, the visual object that you pass as the parameter to the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method determines which portion of the visual tree that will be hit test.</span></span> <span data-ttu-id="c70c5-126">Можно проверять на попадание все визуальное дерево или любую его часть.</span><span class="sxs-lookup"><span data-stu-id="c70c5-126">You can hit test against the entire visual tree, or any portion of it.</span></span>  
  
 <span data-ttu-id="c70c5-127">На следующем рисунке объект-круг расположен поверх объектов квадрат и треугольник.</span><span class="sxs-lookup"><span data-stu-id="c70c5-127">In the following illustration, the circle object is on top of both the square and triangle objects.</span></span> <span data-ttu-id="c70c5-128">Если вы заинтересованы только в проверке нажатия визуального объекта, значение z-порядка которого является самым верхним, можно задать перечисление проверки попадания визуальных элементов, чтобы возвратить <xref:System.Windows.Media.HitTestResultBehavior.Stop> из <xref:System.Windows.Media.HitTestResultCallback>, чтобы предотвратить обход проверки попадания после первого элемента.</span><span class="sxs-lookup"><span data-stu-id="c70c5-128">If you are only interested in hit testing the visual object whose z-order value is top-most, you can set the visual hit test enumeration to return <xref:System.Windows.Media.HitTestResultBehavior.Stop> from the <xref:System.Windows.Media.HitTestResultCallback> to stop the hit test traversal after the first item.</span></span>  
  
 <span data-ttu-id="c70c5-129">![Порядок по оси Z для визуального дерева](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span><span class="sxs-lookup"><span data-stu-id="c70c5-129">![Diagram of the z&#45;order of a visual tree](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span></span>  
<span data-ttu-id="c70c5-130">Z-порядок для визуального дерева</span><span class="sxs-lookup"><span data-stu-id="c70c5-130">Diagram of the z-order of a visual tree</span></span>  
  
 <span data-ttu-id="c70c5-131">Если требуется перечислить все визуальные объекты в определенной точке или геометрии, возвращайте <xref:System.Windows.Media.HitTestResultBehavior.Continue> из <xref:System.Windows.Media.HitTestResultCallback>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-131">If you want to enumerate all visual objects under a specific point or geometry, return <xref:System.Windows.Media.HitTestResultBehavior.Continue> from the <xref:System.Windows.Media.HitTestResultCallback>.</span></span> <span data-ttu-id="c70c5-132">Это означает, что можно выполнять проверку попадания для визуальных объектов, которые находятся под другими объектами, даже если они полностью не видны.</span><span class="sxs-lookup"><span data-stu-id="c70c5-132">This means you can hit test for visual objects that are beneath other objects, even if they are wholly obscured.</span></span> <span data-ttu-id="c70c5-133">Более подробные сведения см. в примере кода в разделе «Использование обратного вызова результатов проверки попадания».</span><span class="sxs-lookup"><span data-stu-id="c70c5-133">See the sample code in the section "Using a Hit Test Results Callback" for more information.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c70c5-134">Проверку попадания можно выполнять и для прозрачного визуального объекта.</span><span class="sxs-lookup"><span data-stu-id="c70c5-134">A visual object that is transparent can also be hit test.</span></span>  
  
<a name="using_default_hit_testing"></a>   
## <a name="using-default-hit-testing"></a><span data-ttu-id="c70c5-135">Проверка попадания по умолчанию</span><span class="sxs-lookup"><span data-stu-id="c70c5-135">Using Default Hit Testing</span></span>  
 <span data-ttu-id="c70c5-136">Можно определить, находится ли точка в пределах геометрии визуального объекта, используя метод <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>, чтобы указать визуальный объект и значение координаты точки для проверки.</span><span class="sxs-lookup"><span data-stu-id="c70c5-136">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify a visual object and a point coordinate value to test against.</span></span> <span data-ttu-id="c70c5-137">Параметр-визуальный объект определяет начальную точку в визуальном дереве для поиска при проверке попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-137">The visual object parameter identifies the starting point in the visual tree for the hit test search.</span></span> <span data-ttu-id="c70c5-138">Если визуальный объект находится в визуальном дереве, геометрический элемент которого содержит координаты, то для него задается свойство <xref:System.Windows.Media.HitTestResult.VisualHit%2A> объекта <xref:System.Windows.Media.HitTestResult>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-138">If a visual object is found in the visual tree whose geometry contains the coordinate, it is set to the <xref:System.Windows.Media.HitTestResult.VisualHit%2A> property of a <xref:System.Windows.Media.HitTestResult> object.</span></span> <span data-ttu-id="c70c5-139">Затем <xref:System.Windows.Media.HitTestResult> возвращается из метода <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-139">The <xref:System.Windows.Media.HitTestResult> is then returned from the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span> <span data-ttu-id="c70c5-140">Если точка не содержится в визуальном поддереве, для которого выполняется проверка попадания, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> возвращает `null`.</span><span class="sxs-lookup"><span data-stu-id="c70c5-140">If the point is not contained with the visual sub-tree you are hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> returns `null`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c70c5-141">Проверка попадания по умолчанию всегда возвращает самый верхний объект по оси Z.</span><span class="sxs-lookup"><span data-stu-id="c70c5-141">Default hit testing always returns the top-most object in the z-order.</span></span> <span data-ttu-id="c70c5-142">Чтобы определить все визуальные объекты, даже те, которые могут быть частично или полностью перекрыты, используйте обратный вызов результатов проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-142">In order to identify all visual objects, even those that may be partly or wholly obscured, use a hit test result callback.</span></span>  
  
 <span data-ttu-id="c70c5-143">Значение координаты, передаваемое в качестве параметра точки для метода <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>, должно быть относительно пространства координат визуального объекта, для которого выполняется проверка попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-143">The coordinate value you pass as the point parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method has to be relative to the coordinate space of the visual object you are hit testing against.</span></span> <span data-ttu-id="c70c5-144">Например, при наличии вложенных визуальных объектов, определенных в точке (100, 100) пространства координат родительского элемента, проверка попадания дочернего визуального объекта в (0, 0) эквивалентно проверке попадания в точке (100, 100) в пространстве координат родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="c70c5-144">For example, if you have nested visual objects defined at (100, 100) in the parent's coordinate space, then hit testing a child visual at (0, 0) is equivalent to hit testing at (100, 100) in the parent's coordinate space.</span></span>  
  
 <span data-ttu-id="c70c5-145">В следующем коде показано, как настроить обработчики событий мыши для объекта <xref:System.Windows.UIElement>, который используется для записи событий, используемых для проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-145">The following code shows how to set up mouse event handlers for a <xref:System.Windows.UIElement> object that is used to capture events used for hit testing.</span></span>  
  
 [!code-csharp[HitTestingOverview#100](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#100)]
 [!code-vb[HitTestingOverview#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#100)]  
  
### <a name="how-the-visual-tree-affects-hit-testing"></a><span data-ttu-id="c70c5-146">Влияние визуального дерева на проверку попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-146">How the Visual Tree Affects Hit Testing</span></span>  
 <span data-ttu-id="c70c5-147">Начальная точка в визуальном дереве определяет, какие объекты возвращаются во время перечисления объектов проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-147">The starting point in the visual tree determines which objects are returned during the hit test enumeration of objects.</span></span> <span data-ttu-id="c70c5-148">Если есть несколько объектов, для которых нужно выполнить проверку попадания, визуальные объект, используемый в качестве начальной точки в визуальном дереве, должен быть общим предком всех интересующих объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-148">If you have multiple objects you want to hit test, the visual object used as the starting point in the visual tree must be the common ancestor of all objects of interest.</span></span> <span data-ttu-id="c70c5-149">Например если нужно выполнить проверку попадания и для элемента-кнопки и для визуального объекта на следующем рисунке, необходимо установить начальную точку в визуальном дереве на их общего предка.</span><span class="sxs-lookup"><span data-stu-id="c70c5-149">For example, if you were interested in hit testing both the button element and drawing visual in the following diagram, you would have to set the starting point in the visual tree to the common ancestor of both.</span></span> <span data-ttu-id="c70c5-150">В этом случае элемент общим предком элемента-кнопки и визуального объекта является элемент canvas.</span><span class="sxs-lookup"><span data-stu-id="c70c5-150">In this case, the canvas element is the common ancestor of both the button element and the drawing visual.</span></span>  
  
 <span data-ttu-id="c70c5-151">![Иерархия визуального дерева](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span><span class="sxs-lookup"><span data-stu-id="c70c5-151">![Diagram of a visual tree hierarchy](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span></span>  
<span data-ttu-id="c70c5-152">Иерархия визуального дерева</span><span class="sxs-lookup"><span data-stu-id="c70c5-152">Diagram of a visual tree hierarchy</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c70c5-153">Свойство <xref:System.Windows.UIElement.IsHitTestVisible%2A> Возвращает или задает значение, которое определяет, может ли объект, производный от <xref:System.Windows.UIElement>, быть возвращен как результат проверки нажатия в какой-либо части его отображаемого содержимого.</span><span class="sxs-lookup"><span data-stu-id="c70c5-153">The <xref:System.Windows.UIElement.IsHitTestVisible%2A> property gets or sets a value that declares whether a <xref:System.Windows.UIElement>-derived object can possibly be returned as a hit test result from some portion of its rendered content.</span></span> <span data-ttu-id="c70c5-154">Это позволяет выборочно изменять визуальное дерево, чтобы определить, какие визуальные объекты участвуют в проверке попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-154">This allows you to selectively alter the visual tree to determine which visual objects are involved in a hit test.</span></span>  
  
<a name="using_a_hit_test_result_callback"></a>   
## <a name="using-a-hit-test-result-callback"></a><span data-ttu-id="c70c5-155">Использование обратного вызова результатов проверки попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-155">Using a Hit Test Result Callback</span></span>  
 <span data-ttu-id="c70c5-156">Можно перечислить в визуальном дереве все визуальные объекты, геометрия которых содержит заданное значение координат.</span><span class="sxs-lookup"><span data-stu-id="c70c5-156">You can enumerate all visual objects in a visual tree whose geometry contains a specified coordinate value.</span></span> <span data-ttu-id="c70c5-157">Это позволяет выделить все визуальные объекты, даже те, которые могут быть частично или полностью перекрыты другими визуальными объектами.</span><span class="sxs-lookup"><span data-stu-id="c70c5-157">This allows you to identify all visual objects, even those that may be partly or wholly obscured by other visual objects.</span></span> <span data-ttu-id="c70c5-158">Чтобы перечислить визуальные объекты в визуальном дереве, используйте метод <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> с функцией обратного вызова проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-158">To enumerate visual objects in a visual tree use the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method with a hit test callback function.</span></span> <span data-ttu-id="c70c5-159">Функция обратного вызова проверки попадания вызывается системой, если указанное значение координат содержится в визуальном объекте.</span><span class="sxs-lookup"><span data-stu-id="c70c5-159">The hit test callback function is called by the system when the coordinate value you specify is contained in a visual object.</span></span>  
  
 <span data-ttu-id="c70c5-160">Во время перечисления результатов проверки попадания не следует выполнять никакие операции по изменению визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="c70c5-160">During the hit test results enumeration, you should not perform any operation that modifies the visual tree.</span></span> <span data-ttu-id="c70c5-161">Добавление или удаление объектов визуального дерева во время его проверки может привести к непредсказуемому поведению.</span><span class="sxs-lookup"><span data-stu-id="c70c5-161">Adding or removing an object from the visual tree while it is being traversed can result in unpredictable behavior.</span></span> <span data-ttu-id="c70c5-162">Можно безопасно изменить визуальное дерево после того, как метод <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> возвращает.</span><span class="sxs-lookup"><span data-stu-id="c70c5-162">You can safely modify the visual tree after the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method returns.</span></span> <span data-ttu-id="c70c5-163">Для хранения значений во время перечисления результатов проверки попадания может потребоваться предоставить структуру данных, например <xref:System.Collections.ArrayList>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-163">You may want to provide a data structure, such as an <xref:System.Collections.ArrayList>, to store values during the hit test results enumeration.</span></span>  
  
 [!code-csharp[HitTestingOverview#101](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#101)]
 [!code-vb[HitTestingOverview#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#101)]  
  
 <span data-ttu-id="c70c5-164">Метод обратного вызова проверки попадания определяет действия, которые выполняются при определении проверки попадания для конкретного визуального объекта в визуальном дереве.</span><span class="sxs-lookup"><span data-stu-id="c70c5-164">The hit test callback method defines the actions you perform when a hit test is identified on a particular visual object in the visual tree.</span></span> <span data-ttu-id="c70c5-165">После выполнения действий возвращается значение <xref:System.Windows.Media.HitTestResultBehavior>, определяющее, следует ли продолжать перечисление любых других визуальных объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-165">After you perform the actions, you return a <xref:System.Windows.Media.HitTestResultBehavior> value that determines whether to continue the enumeration of any other visual objects or not.</span></span>  
  
 [!code-csharp[HitTestingOverview#102](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#102)]
 [!code-vb[HitTestingOverview#102](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#102)]  
  
> [!NOTE]
> <span data-ttu-id="c70c5-166">Порядок перечисления визуальных объектов попадания соответствует их координатам по оси Z.</span><span class="sxs-lookup"><span data-stu-id="c70c5-166">The order of enumeration of hit visual objects is by z-order.</span></span> <span data-ttu-id="c70c5-167">Первым перечисляется визуальный объект с самой большой координатой по оси Z.</span><span class="sxs-lookup"><span data-stu-id="c70c5-167">The visual object at the top-most z-order level is the first object enumerated.</span></span> <span data-ttu-id="c70c5-168">Остальные визуальные объекты перечисляются по убыванию значения координаты по оси Z.</span><span class="sxs-lookup"><span data-stu-id="c70c5-168">Any other visual objects enumerated are at decreasing z-order level.</span></span> <span data-ttu-id="c70c5-169">Этот порядок перечисления соответствует порядку отрисовки визуальных объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-169">This order of enumeration corresponds to the rendering order of the visuals.</span></span>  
  
 <span data-ttu-id="c70c5-170">Перечисление визуальных объектов можно в любое время в функции обратного вызова проверки попадания, возвращая <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-170">You can stop the enumeration of visual objects at any time in the hit test callback function by returning <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span></span>  
  
 [!code-csharp[HitTestingOverview#103](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#103)]
 [!code-vb[HitTestingOverview#103](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#103)]  
  
<a name="using_a_hit_test_filter_callback"></a>   
## <a name="using-a-hit-test-filter-callback"></a><span data-ttu-id="c70c5-171">Использование обратного вызова фильтра проверки попадания</span><span class="sxs-lookup"><span data-stu-id="c70c5-171">Using a Hit Test Filter Callback</span></span>  
 <span data-ttu-id="c70c5-172">Можно использовать необязательный фильтр проверки попадания для ограничения объектов, которые передаются в качестве результатов проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-172">You can use an optional hit test filter to restrict the objects that are passed on to the hit test results.</span></span> <span data-ttu-id="c70c5-173">Это позволяет пропустить части визуального дерева, которые не нужны для обработки в результатах проверки нажатия.</span><span class="sxs-lookup"><span data-stu-id="c70c5-173">This allows you to ignore parts of the visual tree that you are not interested in processing in your hit test results.</span></span> <span data-ttu-id="c70c5-174">Чтобы реализовать фильтр проверки попадания, необходимо определить функцию обратного вызова фильтра проверки попадания и передать ее в качестве значения параметра при вызове метода <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-174">To implement a hit test filter, you define a hit test filter callback function and pass it as a parameter value when you call the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#104](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#104)]
 [!code-vb[HitTestingOverview#104](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#104)]  
  
 <span data-ttu-id="c70c5-175">Если вы не хотите указывать функцию обратного вызова фильтра проверки попадания, передайте `null` значение в качестве параметра для метода <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-175">If you do not want to supply the optional hit test filter callback function, pass a `null` value as its parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#105](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#105)]
 [!code-vb[HitTestingOverview#105](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#105)]  
  
 <span data-ttu-id="c70c5-176">![Обрезка визуального дерева с помощью фильтра проверки попадания](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span><span class="sxs-lookup"><span data-stu-id="c70c5-176">![Pruning a visual tree using a hit test filter](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span></span>  
<span data-ttu-id="c70c5-177">Обрезка визуального дерева</span><span class="sxs-lookup"><span data-stu-id="c70c5-177">Pruning a visual tree</span></span>  
  
 <span data-ttu-id="c70c5-178">Функция обратного вызова фильтра проверки попадания позволяет перечислить все визуальные объекты, отображаемое содержимое которых содержит указанные координаты.</span><span class="sxs-lookup"><span data-stu-id="c70c5-178">The hit test filter callback function allows you to enumerate through all the visuals whose rendered content contains the coordinates you specify.</span></span> <span data-ttu-id="c70c5-179">Однако, может понадобиться пропустить отдельные части визуального дерева в функции обратного вызова результатов проверки нажатия.</span><span class="sxs-lookup"><span data-stu-id="c70c5-179">However, you may want to ignore certain branches of the visual tree that you are not interested in processing in your hit test results callback function.</span></span> <span data-ttu-id="c70c5-180">Возвращаемое значение функции обратного вызова фильтра проверки нажатия определяет, какой тип действия должен выполняться при перечислении визуальных объектов.</span><span class="sxs-lookup"><span data-stu-id="c70c5-180">The return value of the hit test filter callback function determines what type of action the enumeration of the visual objects should take.</span></span> <span data-ttu-id="c70c5-181">Например, при возврате значения <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>можно удалить текущий визуальный объект и его дочерние объекты из перечисления результатов проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-181">For example, if you return the value, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, you can remove the current visual object and its children from the hit test results enumeration.</span></span> <span data-ttu-id="c70c5-182">Это означает, что функция обратного вызова результатов проверки попадания не увидит эти объекты в перечислении.</span><span class="sxs-lookup"><span data-stu-id="c70c5-182">This means that the hit test results callback function will not see these objects in its enumeration.</span></span> <span data-ttu-id="c70c5-183">Обрезка визуального дерева объектов позволяет уменьшить объем обработки во время перечисления результатов проверки попадания.</span><span class="sxs-lookup"><span data-stu-id="c70c5-183">Pruning the visual tree of objects decreases the amount of processing during the hit test results enumeration pass.</span></span> <span data-ttu-id="c70c5-184">В следующем примере кода фильтр пропускает метки и их потомков и проверяет все остальные объекты.</span><span class="sxs-lookup"><span data-stu-id="c70c5-184">In the following code example, the filter skips labels and their descendants and hit tests everything else.</span></span>  
  
 [!code-csharp[HitTestingOverview#106](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#106)]
 [!code-vb[HitTestingOverview#106](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#106)]  
  
> [!NOTE]
> <span data-ttu-id="c70c5-185">Функция обратного вызова фильтра проверки попадания иногда вызывается в случаях, когда функция обратного вызова результатов проверки попадания не вызывается.</span><span class="sxs-lookup"><span data-stu-id="c70c5-185">The hit test filter callback will sometimes be called in cases where the hit test results callback is not called.</span></span>  
  
<a name="overriding_default_hit_testing"></a>   
## <a name="overriding-default-hit-testing"></a><span data-ttu-id="c70c5-186">Переопределение проверки попадания по умолчанию</span><span class="sxs-lookup"><span data-stu-id="c70c5-186">Overriding Default Hit Testing</span></span>  
 <span data-ttu-id="c70c5-187">Можно переопределить поддержку проверки попадания по умолчанию визуального объекта, переопределив метод <xref:System.Windows.Media.Visual.HitTestCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-187">You can override a visual object’s default hit testing support by overriding the <xref:System.Windows.Media.Visual.HitTestCore%2A> method.</span></span> <span data-ttu-id="c70c5-188">Это означает, что при вызове метода <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> вызывается переопределенная реализация <xref:System.Windows.Media.Visual.HitTestCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="c70c5-188">This means that when you invoke the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method, your overridden implementation of <xref:System.Windows.Media.Visual.HitTestCore%2A> is called.</span></span> <span data-ttu-id="c70c5-189">Переопределенный метод вызывается при попадании в ограничивающий прямоугольник визуального объекта, даже если координата не попадает в отображаемое содержимое визуального объекта.</span><span class="sxs-lookup"><span data-stu-id="c70c5-189">Your overridden method is called when a hit test falls within the bounding rectangle of the visual object, even if the coordinate falls outside the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#107](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#107)]
 [!code-vb[HitTestingOverview#107](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#107)]  
  
 <span data-ttu-id="c70c5-190">Иногда может понадобиться проверка попадания как для ограничивающего прямоугольника, так и для отображаемого содержимого визуального объекта.</span><span class="sxs-lookup"><span data-stu-id="c70c5-190">There may be times when you want to hit test against both the bounding rectangle and the rendered content of a visual object.</span></span> <span data-ttu-id="c70c5-191">Используя значение параметра `PointHitTestParameters` в переопределенном методе <xref:System.Windows.Media.Visual.HitTestCore%2A> в качестве параметра для <xref:System.Windows.Media.Visual.HitTestCore%2A>базового метода, можно выполнять действия в зависимости от попадания ограничивающего прямоугольника визуального объекта, а затем выполнять вторую проверку попадания для визуализированного содержимого визуального объекта.</span><span class="sxs-lookup"><span data-stu-id="c70c5-191">By using the `PointHitTestParameters` parameter value in your overridden <xref:System.Windows.Media.Visual.HitTestCore%2A> method as the parameter to the base method <xref:System.Windows.Media.Visual.HitTestCore%2A>, you can perform actions based on a hit of the bounding rectangle of a visual object, and then perform a second hit test against the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#108](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#108)]
 [!code-vb[HitTestingOverview#108](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#108)]  
  
## <a name="see-also"></a><span data-ttu-id="c70c5-192">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="c70c5-192">See also</span></span>

- <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>
- <xref:System.Windows.Media.HitTestResult>
- <xref:System.Windows.Media.HitTestResultCallback>
- <xref:System.Windows.Media.HitTestFilterCallback>
- <xref:System.Windows.UIElement.IsHitTestVisible%2A>
- [<span data-ttu-id="c70c5-193">Проверка нажатия с помощью примера DrawingVisuals</span><span class="sxs-lookup"><span data-stu-id="c70c5-193">Hit Test Using DrawingVisuals Sample</span></span>](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual)
- [<span data-ttu-id="c70c5-194">Проверка нажатия с помощью примера взаимодействия Win32</span><span class="sxs-lookup"><span data-stu-id="c70c5-194">Hit Test with Win32 Interoperation Sample</span></span>](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting)
- [<span data-ttu-id="c70c5-195">Проверка попадания геометрического объекта в визуальный объект</span><span class="sxs-lookup"><span data-stu-id="c70c5-195">Hit Test Geometry in a Visual</span></span>](how-to-hit-test-geometry-in-a-visual.md)
- [<span data-ttu-id="c70c5-196">Проверка попадания с использованием контейнера узла Win32</span><span class="sxs-lookup"><span data-stu-id="c70c5-196">Hit Test Using a Win32 Host Container</span></span>](how-to-hit-test-using-a-win32-host-container.md)
