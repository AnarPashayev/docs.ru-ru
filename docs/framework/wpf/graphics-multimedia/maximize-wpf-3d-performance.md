---
title: Максимально увеличить объем трехмерной производительности
ms.date: 03/30/2017
helpviewer_keywords:
- 3-D graphics [WPF]
ms.assetid: 4bcf949d-d92f-4d8d-8a9b-1e4c61b25bf6
ms.openlocfilehash: 414a4677a1e05cd69c382e35194328d6ce1bddf9
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76744593"
---
# <a name="maximize-wpf-3d-performance"></a>Достижение максимальной производительности WPF 3D
При использовании [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] для создания трехмерных элементов управления и включения трехмерных сцен в приложения важно учитывать оптимизацию производительности. В этом разделе представлен список трехмерных классов и свойств, которые влияют на производительность приложения, а также рекомендации по оптимизации производительности при их использовании.  
  
 В этом разделе предполагается углубленное понимание [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] трехмерных функций. Рекомендации в этом документе применимы к "уровню отрисовки 2" — примерно определено как оборудование, которое поддерживает построитель текстуры версии 2,0 и шейдер вершин версии 2,0. Дополнительные сведения см. в разделе [Уровни графической отрисовки](../advanced/graphics-rendering-tiers.md).  
  
## <a name="performance-impact-high"></a>Влияние на производительность: высокая  
  
|Идентификаторы|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Brush>|Скорость кисти (от самой быстрой к самой медленной):<br /><br /> <xref:System.Windows.Media.SolidColorBrush><br /><br /> <xref:System.Windows.Media.LinearGradientBrush><br /><br /> <xref:System.Windows.Media.ImageBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush> (кэшировано)<br /><br /> <xref:System.Windows.Media.VisualBrush> (кэшировано)<br /><br /> <xref:System.Windows.Media.RadialGradientBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush> (не кэшировано)<br /><br /> <xref:System.Windows.Media.VisualBrush> (не кэшировано)|  
|<xref:System.Windows.UIElement.ClipToBoundsProperty>|Установите `Viewport3D.ClipToBounds` в значение false, если нет необходимости [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] явным образом вырезать содержимое <xref:System.Windows.Controls.Viewport3D> в прямоугольник Viewport3D's. [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] обрезка с сглаживанием может быть очень высокой, и `ClipToBounds` по умолчанию включена (замедляют) на <xref:System.Windows.Controls.Viewport3D>.|  
|<xref:System.Windows.UIElement.IsHitTestVisible%2A>|Присвойте параметру `Viewport3D.IsHitTestVisible` значение false, если [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] не нужно учитывать содержимое <xref:System.Windows.Controls.Viewport3D> при проверке нажатия мышью.  Проверка нажатия трехмерного содержимого выполняется в программном обеспечении и может работать с большими сетками. в <xref:System.Windows.Controls.Viewport3D>по умолчанию <xref:System.Windows.UIElement.IsHitTestVisible%2A> включен (работает по скорости).|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D>|Создавайте разные модели, только если они нуждаются в различных материалах или преобразованиях.  В противном случае попробуйте объединить множество экземпляров <xref:System.Windows.Media.Media3D.GeometryModel3D> с теми же материалами и преобразованиями в несколько более крупных экземпляров <xref:System.Windows.Media.Media3D.GeometryModel3D> и <xref:System.Windows.Media.Media3D.MeshGeometry3D>.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Анимация в виде сетки — изменение отдельных вершин сетки на основе каждого кадра — не всегда эффективно в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].  Чтобы уменьшить влияние уведомлений об изменениях на производительность при изменении каждой вершины, отсоедините сетку от визуального дерева, прежде чем выполнять изменение каждой вершины.  После изменения сетки повторно присоедините ее к визуальному дереву.  Кроме того, старайтесь не сокращать размер сеток, которые будут анимированы таким образом.|  
|Трехмерное сглаживание|Чтобы увеличить скорость рендеринга, отключите многовыборочную выборку на <xref:System.Windows.Controls.Viewport3D>, установив для присоединенного свойства <xref:System.Windows.Media.RenderOptions.EdgeMode%2A> значение `Aliased`.  По умолчанию Трехмерное сглаживание включено в Windows с 4 примерами на пиксель.|  
|Текст|Динамический текст в трехмерной сцене (динамический, так как он находится в <xref:System.Windows.Media.DrawingBrush> или <xref:System.Windows.Media.VisualBrush>) может быть слишком высокой. Попробуйте использовать изображения текста (с помощью <xref:System.Windows.Media.Imaging.RenderTargetBitmap>), если текст не изменится.|  
|<xref:System.Windows.Media.TileBrush>|Если необходимо использовать <xref:System.Windows.Media.VisualBrush> или <xref:System.Windows.Media.DrawingBrush> в трехмерной сцене, так как содержимое кисти не является статическим, попробуйте выполнить кэширование кисти (установив для присоединенного свойства <xref:System.Windows.Media.RenderOptions.CachingHint%2A> значение `Cache`).  Задайте минимальные и максимальные пороги недействительности шкалы (с присоединенными свойствами <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMinimum%2A> и <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMaximum%2A>), чтобы кэшированные кисти не создавались слишком часто, сохраняя требуемый уровень качества.  По умолчанию <xref:System.Windows.Media.DrawingBrush> и <xref:System.Windows.Media.VisualBrush> не кэшируются, то есть каждый раз, когда все, что закрашено кистью, необходимо повторно визуализировать, все содержимое этой кисти сначала должно быть повторно подготовлено к промежуточной поверхности.|  
|<xref:System.Windows.Media.Effects.BitmapEffect>|<xref:System.Windows.Media.Effects.BitmapEffect> заставляет все затронутое содержимое подготавливаться к просмотру без аппаратного ускорения.  Для лучшей производительности не используйте <xref:System.Windows.Media.Effects.BitmapEffect>.|  
  
## <a name="performance-impact-medium"></a>Влияние на производительность: средний  
  
|Идентификаторы|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Если сетка определена как смежные треугольники с общими вершинами и эти вершины имеют одинаковое расположение, нормаль и координаты текстуры, определите каждую общую вершину только один раз, а затем определите треугольники по индексу с помощью <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>.|  
|<xref:System.Windows.Media.ImageBrush>|Старайтесь максимально сокращать размеры текстур при наличии явного контроля над размером (при использовании <xref:System.Windows.Media.Imaging.RenderTargetBitmap> и (или) <xref:System.Windows.Media.ImageBrush>).  Обратите внимание, что текстуры с низким разрешением могут уменьшить качество визуального элемента, поэтому попробуйте найти правильный баланс между качеством и производительностью.|  
|Непрозрачность|При отрисовке полупрозрачного трехмерного содержимого (такого как отражение) используйте свойства непрозрачности на кистях или материалах (с помощью <xref:System.Windows.Media.Brush.Opacity%2A> или <xref:System.Windows.Media.Media3D.DiffuseMaterial.Color%2A>) вместо создания отдельного полупрозрачного <xref:System.Windows.Controls.Viewport3D>, установив для `Viewport3D.Opacity` значение меньше 1.|  
|<xref:System.Windows.Controls.Viewport3D>|Сократите количество <xref:System.Windows.Controls.Viewport3D> объектов, которые вы используете в сцене.  Разместите многие трехмерные модели в одном элементе Viewport3D, а не создавайте отдельные экземпляры Viewport3D для каждой модели.|  
|<xref:System.Windows.Freezable>|Обычно полезно использовать <xref:System.Windows.Media.Media3D.MeshGeometry3D>, <xref:System.Windows.Media.Media3D.GeometryModel3D>, кисти и материалы.  Все являются многородительскими, так как они являются производными от `Freezable`.|  
|<xref:System.Windows.Freezable>|Вызовите метод <xref:System.Windows.Freezable.Freeze%2A> для объектов Freezable, когда их свойства останутся без изменений в приложении.  Замораживание может уменьшить рабочее множество и повысить скорость.|  
|<xref:System.Windows.Media.Brush>|Используйте <xref:System.Windows.Media.ImageBrush> вместо <xref:System.Windows.Media.VisualBrush> или <xref:System.Windows.Media.DrawingBrush>, когда содержимое кисти не изменится.  2D-содержимое можно преобразовать в <xref:System.Windows.Controls.Image> через <xref:System.Windows.Media.Imaging.RenderTargetBitmap>, а затем использовать в <xref:System.Windows.Media.ImageBrush>.|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A>|Не используйте <xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A>, если нет необходимости видеть задние грани <xref:System.Windows.Media.Media3D.GeometryModel3D>.|  
|<xref:System.Windows.Media.Media3D.Light>|Легкая скорость (от самой быстрой к самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.AmbientLight><br /><br /> <xref:System.Windows.Media.Media3D.DirectionalLight><br /><br /> <xref:System.Windows.Media.Media3D.PointLight><br /><br /> <xref:System.Windows.Media.Media3D.SpotLight>|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Попробуйте ограничить размеры сетки с учетом этих ограничений:<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>: 20 001 <xref:System.Windows.Media.Media3D.Point3D> экземпляров<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>: 60 003 <xref:System.Int32> экземпляров|  
|<xref:System.Windows.Media.Media3D.Material>|Скорость материала (от самой быстрой до самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.EmissiveMaterial><br /><br /> <xref:System.Windows.Media.Media3D.DiffuseMaterial><br /><br /> <xref:System.Windows.Media.Media3D.SpecularMaterial>|  
|<xref:System.Windows.Media.Brush>|[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 3D не отказывается от невидимых кистей (черные внешние кисти, четкие кисти и т. д.) согласованным образом.  Рассмотрите возможность опустить их из сцены.|  
|<xref:System.Windows.Media.Media3D.MaterialGroup>|Каждый <xref:System.Windows.Media.Media3D.Material> в <xref:System.Windows.Media.Media3D.MaterialGroup> вызывает другой проход отрисовки, поэтому, включая множество материалов, даже простые материалы, может значительно увеличить требования к заполнению GPU.  Сократите количество материалов в <xref:System.Windows.Media.Media3D.MaterialGroup>.|  
  
## <a name="performance-impact-low"></a>Влияние на производительность: низкое  
  
|Идентификаторы|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.Transform3DGroup>|Если анимация или привязка данных не нужна, вместо использования группы преобразования, содержащей несколько преобразований, используйте один <xref:System.Windows.Media.Media3D.MatrixTransform3D>, указав в качестве продукта все преобразования, которые в противном случае существуют в группе преобразования независимо друг от друга.|  
|<xref:System.Windows.Media.Media3D.Light>|Сократите число источников света в сцене. Слишком много источников света в сцене принуждает [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] к отрисовке программного обеспечения.  Ограничения — примерно 110 <xref:System.Windows.Media.Media3D.DirectionalLight> объектов, 70 <xref:System.Windows.Media.Media3D.PointLight> объектов или 40 <xref:System.Windows.Media.Media3D.SpotLight> объектов.|  
|<xref:System.Windows.Media.Media3D.ModelVisual3D>|Разделяйте перемещаемые объекты от статических объектов, поместив их в отдельные экземпляры <xref:System.Windows.Media.Media3D.ModelVisual3D>.  ModelVisual3D — это "более плотный", чем <xref:System.Windows.Media.Media3D.GeometryModel3D>, так как он кэширует преобразованные границы.  GeometryModel3D оптимизирована для модели; ModelVisual3D оптимизирована как узел сцены.  Используйте ModelVisual3D для размещения общих экземпляров GeometryModel3D в сцене.|  
|<xref:System.Windows.Media.Media3D.Light>|Сократите число попыток изменения числа источников света в сцене.  Каждое изменение счетчика освещения приводит к принудительному повторному созданию и повторной компиляции шейдера, если конфигурация ранее не существовала (и, таким же, потребовала кэширование шейдера).|  
|Светлый|Черные лампочки не будут видны, но они будут добавляться к времени визуализации. Рассмотрите возможность опустить их.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Чтобы максимально сокращать время создания больших коллекций в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], например <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>MeshGeometry3D's, <xref:System.Windows.Media.Media3D.MeshGeometry3D.Normals%2A>, <xref:System.Windows.Media.Media3D.MeshGeometry3D.TextureCoordinates%2A>и <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>, перед заполнением значения следует предварительно задать размер коллекций. Если это возможно, передайте конструкторам коллекций предварительно заполненные структуры данных, такие как массивы или списки.|  
  
## <a name="see-also"></a>См. также:

- [Обзор трехмерной графики](3-d-graphics-overview.md)
