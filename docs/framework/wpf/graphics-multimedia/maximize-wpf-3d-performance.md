---
title: Достижение максимальной производительности WPF 3D
ms.date: 03/30/2017
helpviewer_keywords:
- 3-D graphics [WPF]
ms.assetid: 4bcf949d-d92f-4d8d-8a9b-1e4c61b25bf6
ms.openlocfilehash: e1a90406423e36dd10b8b108e076fe73f99947f0
ms.sourcegitcommit: 77e33b682db39955e331b8e8eda4ef1925a24e78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2019
ms.locfileid: "70133852"
---
# <a name="maximize-wpf-3d-performance"></a>Достижение максимальной производительности WPF 3D
При использовании [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] для создания трехмерных элементов управления и включения трехмерных сцен в приложения важно учитывать оптимизацию производительности. В этом разделе представлен список трехмерных классов и свойств, которые влияют на производительность приложения, а также рекомендации по оптимизации производительности при их использовании.  
  
 В этом разделе предполагается углубленное [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] понимание трехмерных возможностей. Рекомендации в этом документе применимы к "уровню отрисовки 2" — примерно определено как оборудование, которое поддерживает построитель текстуры версии 2,0 и шейдер вершин версии 2,0. Дополнительные сведения см. в разделе [Уровни графической отрисовки](../advanced/graphics-rendering-tiers.md).  
  
## <a name="performance-impact-high"></a>Влияние на производительность: Высокий  
  
|Свойство.|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Brush>|Скорость кисти (от самой быстрой к самой медленной):<br /><br /> <xref:System.Windows.Media.SolidColorBrush><br /><br /> <xref:System.Windows.Media.LinearGradientBrush><br /><br /> <xref:System.Windows.Media.ImageBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush>сохранен<br /><br /> <xref:System.Windows.Media.VisualBrush>сохранен<br /><br /> <xref:System.Windows.Media.RadialGradientBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush>выгружаемом<br /><br /> <xref:System.Windows.Media.VisualBrush>выгружаемом|  
|<xref:System.Windows.UIElement.ClipToBoundsProperty>|Задайте `Viewport3D.ClipToBounds` значение false, если не требуется [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] явным образом <xref:System.Windows.Controls.Viewport3D> вырезать содержимое объекта в прямоугольник Viewport3D's. [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]Обрезка с сглаживанием может быть очень высокой и `ClipToBounds` <xref:System.Windows.Controls.Viewport3D>по умолчанию включена (по скорости).|  
|<xref:System.Windows.UIElement.IsHitTestVisible%2A>|Задайте `Viewport3D.IsHitTestVisible` значение false, если не нужно [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <xref:System.Windows.Controls.Viewport3D> учитывать содержимое при проверке нажатия мышью.  Проверка нажатия трехмерного содержимого выполняется в программном обеспечении и может работать с большими сетками. <xref:System.Windows.UIElement.IsHitTestVisible%2A>по умолчанию <xref:System.Windows.Controls.Viewport3D>включен (работает по скорости).|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D>|Создавайте разные модели, только если они нуждаются в различных материалах или преобразованиях.  В противном случае попробуйте объединить <xref:System.Windows.Media.Media3D.GeometryModel3D> множество экземпляров с теми же материалами и преобразованиями в несколько <xref:System.Windows.Media.Media3D.GeometryModel3D> <xref:System.Windows.Media.Media3D.MeshGeometry3D> больших экземпляров.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|«Сетчатая анимация» — изменение отдельных вершин сетки на основе каждого фрейма — не всегда эффективно в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].  Чтобы уменьшить влияние уведомлений об изменениях на производительность при изменении каждой вершины, отсоедините сетку от визуального дерева, прежде чем выполнять изменение каждой вершины.  После изменения сетки повторно присоедините ее к визуальному дереву.  Кроме того, старайтесь не сокращать размер сеток, которые будут анимированы таким образом.|  
|Трехмерное сглаживание|Чтобы увеличить скорость рендеринга, отключите многовыборочную <xref:System.Windows.Controls.Viewport3D> выборку, установив для <xref:System.Windows.Media.RenderOptions.EdgeMode%2A> `Aliased`присоединенного свойства значение.  По умолчанию Трехмерное сглаживание включено в Windows с 4 примерами на пиксель.|  
|Текст|Динамический текст в трехмерной сцене (динамический, так как он находится <xref:System.Windows.Media.DrawingBrush> в <xref:System.Windows.Media.VisualBrush>или) может быть слишком высокой. Попробуйте использовать изображения текста (с помощью <xref:System.Windows.Media.Imaging.RenderTargetBitmap>), если текст не изменится.|  
|<xref:System.Windows.Media.TileBrush>|Если <xref:System.Windows.Media.VisualBrush> необходимо использовать <xref:System.Windows.Media.DrawingBrush> или в трехмерной сцене, поскольку содержимое кисти не является статическим, попробуйте выполнить кэширование кисти ( `Cache`Присвоив присоединенному свойству <xref:System.Windows.Media.RenderOptions.CachingHint%2A> значение).  Задайте минимальные и максимальные пороговые значения для масштабирования шкалы (с присоединенными <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMinimum%2A> свойствами <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMaximum%2A>и), чтобы кэшированные кисти не создавались слишком часто, сохраняя требуемый уровень качества.  По умолчанию <xref:System.Windows.Media.DrawingBrush> и <xref:System.Windows.Media.VisualBrush> не кэшируются, то есть каждый раз, когда все, что закрашено с помощью кисти, необходимо повторно визуализировать, все содержимое этой кисти сначала должно быть повторно подготовлено к промежуточной поверхности.|  
|<xref:System.Windows.Media.Effects.BitmapEffect>|<xref:System.Windows.Media.Effects.BitmapEffect>принудительное отображение всех затронутых содержимого без аппаратного ускорения.  Для лучшей производительности не используйте <xref:System.Windows.Media.Effects.BitmapEffect>.|  
  
## <a name="performance-impact-medium"></a>Влияние на производительность: Среднее  
  
|Свойство.|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Если сетка определена как смежные треугольники с общими вершинами и эти вершины имеют одинаковое расположение, нормаль и координаты текстуры, определите каждую общую вершину только один раз, а затем определите треугольники с <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>помощью индекса.|  
|<xref:System.Windows.Media.ImageBrush>|Старайтесь максимально сокращать размеры текстур при наличии явного контроля над размером (при использовании <xref:System.Windows.Media.Imaging.RenderTargetBitmap> и/ <xref:System.Windows.Media.ImageBrush>или).  Обратите внимание, что текстуры с низким разрешением могут уменьшить качество визуального элемента, поэтому попробуйте найти правильный баланс между качеством и производительностью.|  
|Прозрачность|При отрисовке полупрозрачного трехмерного содержимого (такого как отражение) используйте свойства непрозрачности на кистях или материалах <xref:System.Windows.Media.Media3D.DiffuseMaterial.Color%2A>(с помощью <xref:System.Windows.Media.Brush.Opacity%2A> или) вместо создания отдельного <xref:System.Windows.Controls.Viewport3D> полупрозрачного `Viewport3D.Opacity` объекта, задав для значение меньше 1.|  
|<xref:System.Windows.Controls.Viewport3D>|Сократите количество <xref:System.Windows.Controls.Viewport3D> объектов, которые вы используете в сцене.  Разместите многие трехмерные модели в одном элементе Viewport3D, а не создавайте отдельные экземпляры Viewport3D для каждой модели.|  
|<xref:System.Windows.Freezable>|Обычно это полезно для многократного <xref:System.Windows.Media.Media3D.MeshGeometry3D>использования <xref:System.Windows.Media.Media3D.GeometryModel3D>,, кистей и материалов.  Все являются многородительскими, так как они являются `Freezable`производными от.|  
|<xref:System.Windows.Freezable>|Вызывайте <xref:System.Windows.Freezable.Freeze%2A> метод для объектов Freezable, если их свойства в приложении останутся неизменными.  Замораживание может уменьшить рабочее множество и повысить скорость.|  
|<xref:System.Windows.Media.Brush>|Используйте <xref:System.Windows.Media.ImageBrush> вместоили<xref:System.Windows.Media.DrawingBrush>, если содержимое кисти не изменится. <xref:System.Windows.Media.VisualBrush>  2D-содержимое можно преобразовать в <xref:System.Windows.Controls.Image> Via <xref:System.Windows.Media.Imaging.RenderTargetBitmap> <xref:System.Windows.Media.ImageBrush>, а затем использовать в.|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A>|Не используйте <xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A> , если нет необходимости видеть задние грани <xref:System.Windows.Media.Media3D.GeometryModel3D>.|  
|<xref:System.Windows.Media.Media3D.Light>|Легкая скорость (от самой быстрой к самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.AmbientLight><br /><br /> <xref:System.Windows.Media.Media3D.DirectionalLight><br /><br /> <xref:System.Windows.Media.Media3D.PointLight><br /><br /> <xref:System.Windows.Media.Media3D.SpotLight>|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Попробуйте ограничить размеры сетки с учетом этих ограничений:<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>: 20 001 <xref:System.Windows.Media.Media3D.Point3D> экземпляров<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>: 60 003 <xref:System.Int32> экземпляров|  
|<xref:System.Windows.Media.Media3D.Material>|Скорость материала (от самой быстрой до самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.EmissiveMaterial><br /><br /> <xref:System.Windows.Media.Media3D.DiffuseMaterial><br /><br /> <xref:System.Windows.Media.Media3D.SpecularMaterial>|  
|<xref:System.Windows.Media.Brush>|[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]3D не отказывается от невидимых кистей (черных внешних кистей, четких кистей и т. д.) согласованным образом.  Рассмотрите возможность опустить их из сцены.|  
|<xref:System.Windows.Media.Media3D.MaterialGroup>|<xref:System.Windows.Media.Media3D.Material> Каждая<xref:System.Windows.Media.Media3D.MaterialGroup> из них вызывает другой этап отрисовки, поэтому, например, многие материалы, даже простые материалы, могут значительно увеличить требования к заполнению GPU.  Сократите количество материалов в <xref:System.Windows.Media.Media3D.MaterialGroup>.|  
  
## <a name="performance-impact-low"></a>Влияние на производительность: Low  
  
|Свойство.|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.Transform3DGroup>|Если анимация или привязка данных не нужна, вместо использования группы преобразования, содержащей несколько преобразований, используйте одну <xref:System.Windows.Media.Media3D.MatrixTransform3D>, указав, что она является продуктом всех преобразований, которые в противном случае существуют в группе преобразования независимо друг от друга.|  
|<xref:System.Windows.Media.Media3D.Light>|Сократите число источников света в сцене. Слишком много источников света в сцене принудительно [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] переходят к отрисовке программного обеспечения.  К ограничениям относятся примерно <xref:System.Windows.Media.Media3D.DirectionalLight> 110 объектов, <xref:System.Windows.Media.Media3D.PointLight> 70 объектов или 40 <xref:System.Windows.Media.Media3D.SpotLight> объектов.|  
|<xref:System.Windows.Media.Media3D.ModelVisual3D>|Разделяйте перемещаемые объекты от статических объектов, поместив их в отдельные <xref:System.Windows.Media.Media3D.ModelVisual3D> экземпляры.  ModelVisual3D является "более тяжелым" <xref:System.Windows.Media.Media3D.GeometryModel3D> , чем, так как он кэширует преобразованные границы.  GeometryModel3D оптимизирована для модели; ModelVisual3D оптимизирована как узел сцены.  Используйте ModelVisual3D для размещения общих экземпляров GeometryModel3D в сцене.|  
|<xref:System.Windows.Media.Media3D.Light>|Сократите число попыток изменения числа источников света в сцене.  Каждое изменение счетчика освещения приводит к принудительному повторному созданию и повторной компиляции шейдера, если конфигурация ранее не существовала (и, таким же, потребовала кэширование шейдера).|  
|Светлый|Черные лампочки не будут видны, но они будут добавляться к времени визуализации. Рассмотрите возможность опустить их.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Чтобы максимально сокращать время создания больших коллекций в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], таких как MeshGeometry3D's <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>, <xref:System.Windows.Media.Media3D.MeshGeometry3D.Normals%2A> <xref:System.Windows.Media.Media3D.MeshGeometry3D.TextureCoordinates%2A>, и <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>, предварительно вычислить коллекции перед заполнением значения. Если это возможно, передайте конструкторам коллекций предварительно заполненные структуры данных, такие как массивы или списки.|  
  
## <a name="see-also"></a>См. также

- [Обзор трехмерной графики](3-d-graphics-overview.md)
