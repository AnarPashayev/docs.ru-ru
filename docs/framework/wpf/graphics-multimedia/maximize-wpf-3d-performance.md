---
title: Максимальная 3D-производительность
ms.date: 03/30/2017
helpviewer_keywords:
- 3D graphics [WPF]
ms.assetid: 4bcf949d-d92f-4d8d-8a9b-1e4c61b25bf6
ms.openlocfilehash: 3825ea8e57c6863e2ee654072efda623db21c2a8
ms.sourcegitcommit: 267d092663aba36b6b2ea853034470aea493bfae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/21/2020
ms.locfileid: "80112002"
---
# <a name="maximize-wpf-3d-performance"></a>Достижение максимальной производительности WPF 3D
При использовании [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 3D-элементов управления и включения 3D-сцен в приложения важно учитывать оптимизацию производительности. Эта тема содержит список 3D-классов и свойств, которые имеют последствия для приложения для производительности, а также рекомендации по оптимизации производительности при их использовании.  
  
 Эта тема предполагает расширенное [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] понимание 3D-функций. Предложения в этом документе относятся к "рендеринг уровень 2" - примерно определяется как аппаратное обеспечение, которое поддерживает пиксельной версии shader 2.0 и vertex shader версии 2.0. Для получения более подробной информации [см.](../advanced/graphics-rendering-tiers.md)  
  
## <a name="performance-impact-high"></a>Влияние производительности: высокий  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Brush>|Скорость чистки (самая быстрая):<br /><br /> <xref:System.Windows.Media.SolidColorBrush><br /><br /> <xref:System.Windows.Media.LinearGradientBrush><br /><br /> <xref:System.Windows.Media.ImageBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush>(кэшированный)<br /><br /> <xref:System.Windows.Media.VisualBrush>(кэшированный)<br /><br /> <xref:System.Windows.Media.RadialGradientBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush>(незасеченный)<br /><br /> <xref:System.Windows.Media.VisualBrush>(незасеченный)|  
|<xref:System.Windows.UIElement.ClipToBoundsProperty>|Установите `Viewport3D.ClipToBounds` на ложные всякий [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] раз, когда вам <xref:System.Windows.Controls.Viewport3D> не нужно иметь явно клип содержание прямоугольника Viewport3D в. [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]антиализасированное отсечение может быть очень медленным, и `ClipToBounds` включено (медленно) по умолчанию на <xref:System.Windows.Controls.Viewport3D>.|  
|<xref:System.Windows.UIElement.IsHitTestVisible%2A>|Установите `Viewport3D.IsHitTestVisible` на ложные всякий раз, когда вам не нужно [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] учитывать содержание <xref:System.Windows.Controls.Viewport3D> при выполнении мыши хит тестирования.  Хит тестирования 3D-контента осуществляется в программном обеспечении и может быть медленным с большими сетками. <xref:System.Windows.UIElement.IsHitTestVisible%2A>включен (медленно) по <xref:System.Windows.Controls.Viewport3D>умолчанию на .|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D>|Создавайте различные модели только тогда, когда они требуют различных материалов или преобразований.  В противном случае, <xref:System.Windows.Media.Media3D.GeometryModel3D> попробуйте объединить много экземпляров с теми же материалами и преобразует в несколько больших <xref:System.Windows.Media.Media3D.GeometryModel3D> и <xref:System.Windows.Media.Media3D.MeshGeometry3D> экземпляров.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Сетная анимация – изменение отдельных вертикатов сетки на основе на [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]кадровой основе – не всегда эффективно в.  Чтобы свести к минимуму влияние уведомлений об изменениях при изменении каждой вершины, отсоедините сетку от визуального дерева перед выполнением изменения в основе.  После того, как сетка была изменена, прикрепите ее к визуальному дереву.  Кроме того, постарайтесь свести к минимуму размер сетки, которые будут анимированы таким образом.|  
|3D Антилиазирование|Чтобы увеличить скорость рендеринга, отпустите <xref:System.Windows.Controls.Viewport3D> мультивыборку <xref:System.Windows.Media.RenderOptions.EdgeMode%2A> `Aliased`на, установив прикрепленное свойство.  По умолчанию 3D антиалиазирование включено на Windows с 4 образцами на пиксель.|  
|текст|Текст в реальном маштабе времени в 3D месте (живом потому что он в <xref:System.Windows.Media.DrawingBrush> или) <xref:System.Windows.Media.VisualBrush>может быть медленным. Попробуйте использовать изображения текста вместо <xref:System.Windows.Media.Imaging.RenderTargetBitmap>(через ) если текст не изменится.|  
|<xref:System.Windows.Media.TileBrush>|Если вы должны <xref:System.Windows.Media.VisualBrush> использовать <xref:System.Windows.Media.DrawingBrush> или в 3D-сцене, потому что содержание кисти не является <xref:System.Windows.Media.RenderOptions.CachingHint%2A> статичным, попробуйте кэшировать кисть (установка прилагаемого свойства). `Cache`  Установите пороги минимальной и максимальной шкалы <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMinimum%2A> недействительности (с прикрепленными свойствами и), <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMaximum%2A>чтобы кэшированные щетки не регенерировались слишком часто, сохраняя при этом желаемый уровень качества.  По <xref:System.Windows.Media.DrawingBrush> умолчанию <xref:System.Windows.Media.VisualBrush> и не кэшируются, а это означает, что каждый раз, когда что-то окрашено кистью, должно быть повторно передано, все содержимое кисти должно быть сначала переиздана на промежуточную поверхность.|  
|<xref:System.Windows.Media.Effects.BitmapEffect>|<xref:System.Windows.Media.Effects.BitmapEffect>заставляет все затронутые содержимое отображаться без аппаратного ускорения.  Для лучшей производительности, не используйте <xref:System.Windows.Media.Effects.BitmapEffect>.|  
  
## <a name="performance-impact-medium"></a>Влияние производительности: Средний  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Когда сетка определяется как примыкающий треугольники с общими вершинами и эти вершины имеют то же положение, нормальные и текстурные <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>координаты, определяют каждый общий вершина только один раз, а затем определить ваши треугольники по индексу с .|  
|<xref:System.Windows.Media.ImageBrush>|Попробуйте свести к минимуму размер текстуры, когда у <xref:System.Windows.Media.Imaging.RenderTargetBitmap> вас есть <xref:System.Windows.Media.ImageBrush>явный контроль над размером (когда вы используете и / или ).  Обратите внимание, что текстуры с более низким разрешением могут снизить качество изображения, поэтому постарайтесь найти правильный баланс между качеством и производительностью.|  
|Непрозрачность|При визуализации полупрозрачного 3D-контента (например, отражения) используйте <xref:System.Windows.Media.Brush.Opacity%2A> непрозрачные свойства на щетках или материалах (через или) <xref:System.Windows.Media.Media3D.DiffuseMaterial.Color%2A>вместо создания отдельного полупрозрачного, <xref:System.Windows.Controls.Viewport3D> установив `Viewport3D.Opacity` значение менее 1.|  
|<xref:System.Windows.Controls.Viewport3D>|Минимизировать <xref:System.Windows.Controls.Viewport3D> количество объектов, которые вы используете в сцене.  Поместите много 3D-моделей в один и тот же Viewport3D вместо создания отдельных экземпляров Viewport3D для каждой модели.|  
|<xref:System.Windows.Freezable>|Как правило, это полезно <xref:System.Windows.Media.Media3D.MeshGeometry3D> <xref:System.Windows.Media.Media3D.GeometryModel3D>для повторного использования,, кисти, и материалы.  Все они являются многородителямными, так `Freezable`как они являются производными от .|  
|<xref:System.Windows.Freezable>|Вызовите <xref:System.Windows.Freezable.Freeze%2A> метод Freezables, когда их свойства останутся неизменными в приложении.  Замораживание может уменьшить рабочий набор и увеличить скорость.|  
|<xref:System.Windows.Media.Brush>|Используйте <xref:System.Windows.Media.ImageBrush> <xref:System.Windows.Media.VisualBrush> вместо <xref:System.Windows.Media.DrawingBrush> или когда содержание кисти не изменится.  2D-контент можно преобразовать в <xref:System.Windows.Controls.Image> через, <xref:System.Windows.Media.Imaging.RenderTargetBitmap> а затем использовать в . <xref:System.Windows.Media.ImageBrush>|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A>|Не используйте, <xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A> если вы на самом деле <xref:System.Windows.Media.Media3D.GeometryModel3D>нужно, чтобы увидеть задние грани вашего .|  
|<xref:System.Windows.Media.Media3D.Light>|Скорость света (самая быстрая):<br /><br /> <xref:System.Windows.Media.Media3D.AmbientLight><br /><br /> <xref:System.Windows.Media.Media3D.DirectionalLight><br /><br /> <xref:System.Windows.Media.Media3D.PointLight><br /><br /> <xref:System.Windows.Media.Media3D.SpotLight>|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Старайтесь держать размеры сетки под этими ограничениями:<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>: 20 001 <xref:System.Windows.Media.Media3D.Point3D> экземпляр<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>: 60 003 <xref:System.Int32> экземпляров|  
|<xref:System.Windows.Media.Media3D.Material>|Скорость материала (самая быстрая):<br /><br /> <xref:System.Windows.Media.Media3D.EmissiveMaterial><br /><br /> <xref:System.Windows.Media.Media3D.DiffuseMaterial><br /><br /> <xref:System.Windows.Media.Media3D.SpecularMaterial>|  
|<xref:System.Windows.Media.Brush>|[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]3D не отказывается от невидимых кистей (черные кисти окружающей среды, четкие кисти и т.д.) в последовательной форме.  Рассмотрим опустить их из вашей сцены.|  
|<xref:System.Windows.Media.Media3D.MaterialGroup>|Каждый <xref:System.Windows.Media.Media3D.Material> <xref:System.Windows.Media.Media3D.MaterialGroup> в вызывает другой пропуск рендеринга, так что в том числе многие материалы, даже простые материалы, может значительно увеличить требования к заполнению вашего графического процессора.  Свести к минимуму <xref:System.Windows.Media.Media3D.MaterialGroup>количество материалов в вашем .|  
  
## <a name="performance-impact-low"></a>Влияние производительности: Низкий  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.Transform3DGroup>|Если вам не нужна анимация или привязка данных, вместо того, <xref:System.Windows.Media.Media3D.MatrixTransform3D>чтобы использовать группу преобразований, содержащую несколько преобразований, используйте одну, установив ее как продукт всех преобразований, которые в противном случае существовали бы независимо в группе преобразований.|  
|<xref:System.Windows.Media.Media3D.Light>|Свести к минимуму количество огней в вашей сцене. Слишком много огней [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] в сцене заставит вернуться к рендерингу программного обеспечения.  Пределы составляют примерно 110 <xref:System.Windows.Media.Media3D.DirectionalLight> объектов, 70 <xref:System.Windows.Media.Media3D.SpotLight> <xref:System.Windows.Media.Media3D.PointLight> объектов, или 40 объектов.|  
|<xref:System.Windows.Media.Media3D.ModelVisual3D>|Отделите движущиеся объекты <xref:System.Windows.Media.Media3D.ModelVisual3D> от статических объектов, поместив их в отдельные экземпляры.  ModelVisual3D "тяжелее", чем <xref:System.Windows.Media.Media3D.GeometryModel3D> потому, что он кэширует преобразованные границы.  GeometryModel3D оптимизирован а для модели; ModelVisual3D оптимизирован, чтобы быть узласцены.  Используйте ModelVisual3D, чтобы поместить общие экземпляры GeometryModel3D в сцену.|  
|<xref:System.Windows.Media.Media3D.Light>|Свести к минимуму количество изменений количества огней в сцене.  Каждое изменение количества света заставляет регенерацию и перекомпиляцию шейдера, если эта конфигурация существовала ранее (и, таким образом, кэшировала свой шейдер).|  
|Светлый|Черные огни не будут видны, но они добавят, чтобы сделать время; рассмотреть вопрос о том, чтобы опустить их.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Чтобы свести к минимуму [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]время строительства больших коллекций в <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A> <xref:System.Windows.Media.Media3D.MeshGeometry3D.Normals%2A>, <xref:System.Windows.Media.Media3D.MeshGeometry3D.TextureCoordinates%2A>таких <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>как MeshGeometry3D's , , , и , предварительно размер коллекции до значения населения. Если это возможно, передайте конструкторам коллекций предварительно заселенные структуры данных, такие как массивы или списки.|  
  
## <a name="see-also"></a>См. также раздел

- [3D Графика Обзор](3-d-graphics-overview.md)
