---
title: Стратегия безопасности платформы
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- platform security model [WPF]
- Common Language Runtime (CLR) security features
- operating system security model [WPF]
- Internet Explorer security features [WPF]
- Security-Critical method
- CLR security features [WPF]
- security model [WPF]
- security model [WPF], platform
- WPF [WPF], about security model
- Windows Presentation Foundation [WPF], about security model
- security model [WPF], operating system
ms.assetid: 2a39a054-3e2a-4659-bcb7-8bcea490ba31
ms.openlocfilehash: 258fcd7c51ea59de03fe60a4eeb9a82dd1c7efca
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79174606"
---
# <a name="wpf-security-strategy---platform-security"></a>Стратегия безопасности WPF — безопасность платформы
В то время как Windows Presentation Foundation (WPF) предоставляет различные службы безопасности, он также использует функции безопасности базовой платформы, которая включает в себя операционную систему, CLR и Internet Explorer. Эти слои объединяются, чтобы обеспечить WPF сильную, углубленной модели безопасности, которая пытается избежать какой-либо одной точки сбоя, как показано на следующем рисунке:  
  
 ![Диаграмма, отображая модель безопасности WPF.](./media/wpf-security-strategy-platform-security/windows-presentation-foundation-security.png)  
  
 Остальная часть этой темы обсуждает особенности в каждом из этих слоев, которые относятся к WPF конкретно.  

## <a name="operating-system-security"></a>Безопасность операционной системы  
Ядро Windows предоставляет несколько функций безопасности, которые составляют основу безопасности для всех приложений Windows, включая те, которые построены с WPF. В этой теме обсуждается широта этих функций безопасности, которые важны для WPF, а также то, как WPF интегрируется с ними для обеспечения дальнейшей защиты в глубину.  
  
### <a name="microsoft-windows-xp-service-pack-2-sp2"></a>Microsoft Windows XP с пакетом обновления 2 (SP2)  
 В дополнение к общему обзору и укреплению Windows, есть три ключевые особенности от Windows XP SP2, которые мы обсудим в этой теме:  
  
- Компиляция /GS  
  
- Обновление Microsoft Windows.  
  
#### <a name="gs-compilation"></a>Компиляция /GS  
 Windows XP SP2 обеспечивает защиту путем перекомпилинга многих основных системных библиотек, включая все зависимости WPF, таких как CLR, чтобы помочь уменьшить перерасход буфера. Это достигается путем использования параметра /GS с компилятором командной строки C/C++. Несмотря на то, что следует явно избегать переполнения буфера, компиляция /GS представляет пример глубокой защиты против потенциальных угроз, созданных случайно или злонамеренно.  
  
 Ранее переполнения буфера были причиной многих эксплойтов безопасности с высокой степенью воздействия. Переполнение буфера возникает, когда злоумышленник использует уязвимость кода, которая позволяет внедрить вредоносный код, выполняющий записи за границами буфера. Затем это позволяет злоумышленнику перехватить процесс, в котором выполняется код, путем перезаписи адреса возврата функции, чтобы вызвать выполнение кода злоумышленника. Результатом является вредоносный код, выполняющий произвольный код с привилегиями перехваченного процесса.  
  
 На высоком уровне флаг компилятора -GS защищает от некоторых потенциальных перерасходов буфера путем введения специального файла безопасности для защиты обратного адреса функции, которая имеет локальные строки буферов. После возврата функции cookie безопасности сравнивается со своим предыдущим значением. Если значение изменилось, то возможно, произошло переполнение буфера, и процесс будет остановлен с состоянием ошибки. Остановка процесса предотвращает выполнение потенциально вредоносного кода. Подробнее о ней читайте [в материале "GS" (Проверка безопасности буфера)](/cpp/build/reference/gs-buffer-security-check) для получения более подробной информации.  
  
 WPF составляется с флагом /GS, чтобы добавить еще один уровень защиты в приложения WPF.  
  
### <a name="windows-vista"></a>Windows Vista  
Пользователи WPF на Windows Vista получат дополнительные улучшения безопасности операционной системы, включая "Наименее привилегированный пользовательский доступ", проверку целостности кода и изоляцию привилегий.  
  
#### <a name="user-account-control-uac"></a>Контроль учетных записей (UAC)  
 Сегодня пользователи Windows, как правило, работают с привилегиями администратора, потому что многие приложения требуют их для установки или выполнения, или и то, и другое. Одним из примеров является возможность записи в реестр параметров приложения по умолчанию.  
  
 Работа с правами администратора в действительности означает, что приложения выполняются из процессов, которым предоставлены права администратора. Влияние этого на безопасность заключается в том, что любой вредоносный код, перехвативший процесс с правами администратора, автоматически наследует эти права, включая доступ к критически важным системным ресурсам.  
  
 Один из способов защиты от этой угрозы безопасности состоит в запуске приложений с наименьшим количеством требуемых им привилегий. Это известно как принцип наименьших привилегий, и является основной особенностью операционной системы Windows. Эта функция называется управление учетными записями пользователей (UAC), и используется Windows UAC двумя ключевыми способами:  
  
- Для запуска большинства приложений с правами UAC по умолчанию, даже если пользователь является администратором; только приложения, требующие привилегий администратора, будут выполняться с привилегиями администратора. Для запуска с привилегиями администратора приложения должны быть явно отмечены либо в своем манифесте приложения, либо как запись в политике безопасности.  
  
- Для обеспечения решений совместимости, таких как виртуализация. Например, многие приложения пытаются выполнять запись в места с ограниченным доступом, такие как C:\Program Files. Для приложений, выполняющихся в рамках UAC, существует альтернативное расположение, для записи в которое не требуются права администратора. Для приложений, работающих в рамках UAC, UAC виртуализирует расположение C:\Program Files, и таким образом приложения считают, что выполняют запись в это расположение, но на самом деле запись выполняется в другое, пользовательское расположение. Такой вид работы совместимости позволяет операционной системе запускать многие приложения, которые ранее не могли работать в UAC.  
  
#### <a name="code-integrity-checks"></a>Проверки целостности кода  
 Windows Vista включает в себя более глубокие проверки целостности кода, чтобы предотвратить впрыснутый вредоносный код в системные файлы или в ядро во время загрузки/запуска. Это выходит за рамки защиты системных файлов.  

### <a name="limited-rights-process-for-browser-hosted-applications"></a>Процесс с ограниченными правами для браузерных приложений  
 Приложения WPF, размещенные в браузере, выполняются в песочнице интернет-зоны. Интеграция WPF с Microsoft Internet Explorer расширяет эту защиту с дополнительной поддержкой.  
  
 Поскольку приложения для браузеров XAML (XBAPs), как правило, засытываются набором разрешений в зоне Интернета, удаление этих привилегий не наносит ущерба приложениям для браузеров XAML (XBAPs) с точки зрения совместимости. Вместо этого создается дополнительный уровень глубокой защиты; если изолированное приложение сможет использовать другие уровни и перехватить процесс, этот процесс будет иметь только ограниченные привилегии.  
  
 Смотрите [С помощью учетной записи пользователей с наименьшим и привилегированным поднимися.](https://docs.microsoft.com/previous-versions/tn-archive/cc700846%28v=technet.10%29)  
  
## <a name="common-language-runtime-security"></a>Безопасность среды CLR  
 Общее время выполнения языка (CLR) предлагает ряд ключевых преимуществ безопасности, которые включают проверку и проверку, безопасность доступа к коду (CAS) и критическую методологию безопасности.  

### <a name="validation-and-verification"></a>Проверка и верификация  
 Для обеспечения изоляции сборки и целостности CLR использует процесс проверки. Проверка CLR гарантирует, что сборки изолированы, исключив их формат портативного исполняемого (PE) файла для адресов, которые указывают вне сборки. Проверка CLR также проверяет целостность метаданных, встроенных в сборку.  
  
 Для обеспечения безопасности типов, помочь предотвратить общие проблемы безопасности (например, перерасход буфера), и включить песочницу через подпроцесс изоляции, CLR безопасности использует концепцию проверки.  
  
 Управляемые приложения компилируются в язык MSIL. Когда методы в управляемом приложении выполняются, его MSIL-файлы компилируются в машинный код с помощью JIT-компиляции. JIT-компиляция включает процесс верификации, который применяет много правил безопасности и надежности, обеспечивающих, что код:  
  
- не нарушает контракты типов;  
  
- не вызывает переполнение буфера;  
  
- не имеет бесконтрольный доступ к памяти.  
  
 Выполнение управляемого кода, который не соответствует правилам верификации, не разрешается, пока он не будет считаться надежным кодом.  
  
 Преимущество проверяемого кода является ключевой причиной, по которой WPF основывается на рамочном принципе .NET. При условии, что используется верифицируемый код, вероятность использования возможных уязвимостей значительно ниже.  
  
### <a name="code-access-security"></a>Управление доступом для кода  
 Клиентский компьютер предоставляет широкий спектр ресурсов, к которым может получить доступ управляемое приложение, включая файловую систему, реестр, службы печати, пользовательский интерфейс, отражение и переменные среды. Прежде чем управляемое приложение сможет получить доступ к любому из ресурсов на клиентской машине, для этого оно должно иметь разрешение .NET Framework. Разрешение в CAS является подклассом <xref:System.Security.CodeAccessPermission>; CAS реализует один подкласс для каждого ресурса, к которому могут получить доступ управляемые приложения.  
  
 Набор разрешений, которые управляемое приложение выдается CAS при его запуске, известен как набор разрешений и определяется доказательствами, предоставленными приложением. Для приложений WPF представлены доказательства, которые являются местоположением или зоной, из которой запускаются приложения. CAS определяет следующие зоны:  
  
- **Мой компьютер**. Приложения запускаются с клиентского компьютера (полное доверие).  
  
- **Локальная интрасеть**. Приложения запускаются из интрасети (частичное доверие).  
  
- **Интернет**. Приложения запускаются из Интернета (минимальное доверие).  
  
- **Доверенные веб-сайты**. Приложения, идентифицированные пользователем как доверенные (минимальное доверие).  
  
- **Веб-сайты без доверия**. Приложения, идентифицированные пользователем как ненадежные (без доверия).  
  
 Для каждой из этих зон CAS предоставляет заранее определенный набор разрешений, который включает разрешения, которые соответствуют уровню доверия, связанного с каждой из них. К ним относятся следующие объекты.  
  
- **FullTrust**. Для приложений, запущенных из зоны **My Computer.** Предоставляются все возможные разрешения.  
  
- **LocalIntranet**. Для приложений, запущенных из локальной зоны **Интранет.** Подмножество разрешений предоставляется для обеспечения среднего уровня доступа к ресурсам на клиентском компьютере, включая изолированное хранилище, неограниченный доступ к пользовательскому интерфейсу, неограниченный доступ к диалогам для работы с файлами, ограниченное отражение, ограниченный доступ к переменным среды. Разрешения для критически важных ресурсов, таких как реестр, не предоставляются.  
  
- **Интернет**. Для приложений, запущенных из **зоны Интернет** или **Доверенные сайты.** Подмножество разрешений предоставляется для обеспечения ограниченного доступа к ресурсам на клиентском компьютере, включая изолированное хранилище, только открытие файлов и ограниченный пользовательский интерфейс. По сути, этот набор разрешений изолирует приложения от клиентской машины.  
  
 Заявки, идентифицированные как из зоны **ненадежных сайтов,** не получают никаких разрешений CAS. Следовательно, для них не существует предопределенный набор разрешений.  
  
 Следующая цифра иллюстрирует взаимосвязь между зонами, наборами разрешений, разрешениями и ресурсами:  
  
 ![Диаграмма, отображая наборы разрешений CAS.](./media/wpf-security-strategy-platform-security/code-access-security-permissions-relationship.png)  
  
 Ограничения песочницы безопасности в зоне Интернета в равной степени распространяются на любой код, импортируемый XBAP из системной библиотеки, включая WPF. Это гарантирует, что каждый бит кода заблокирован, даже WPF. К сожалению, чтобы быть в состоянии выполнить, XBAP необходимо выполнить функциональность, которая требует больше разрешений, чем те, включенные в песочнице безопасности интернет-зоны.  
  
 Рассмотрим приложение XBAP, которое включает в себя следующую страницу:  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 Для выполнения этого XBAP базовый код WPF должен выполнять больше функциональных возможностей, чем доступно для вызова XBAP, в ключая:  
  
- Создание ручки окна (HWND) для рендеринга  
  
- диспетчеризацию сообщений;  
  
- загрузку шрифт Tahoma.  
  
 С точки зрения безопасности предоставление прямого доступа к любой из этих операций из изолированного приложения будет иметь катастрофические последствия.  
  
 К счастью, WPF удовлетворяет этой ситуации, позволяя этим операциям выполнять с повышенными привилегиями от имени приложения в песочнице. В то время как все операции WPF проверяются на ограниченных разрешениях безопасности интернет-зоны домена приложения XBAP, WPF (как и в других системных библиотеках) получает сярот, который включает все возможные разрешения.
  
 Это требует, чтобы WPF получал повышенные привилегии, предотвращая при этом, что эти привилегии регулируются набором разрешений в зоне Интернета домена хоста.  
  
 WPF делает это с помощью метода **Assert** разрешения. В следующем примере кода показано, как это происходит.  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 **Assert** существенно предотвращает неограниченные разрешения, требуемые WPF от ограничения разрешения интернет-зоны XBAP.  
  
 С точки зрения платформы, WPF отвечает за правильное использование **Assert;** неправильное использование **Assert** может позволить вредоносному коду повысить привилегии. Следовательно, важно, чтобы только вызов **Assert,** когда это необходимо, и обеспечить, чтобы ограничения песочницы остаются нетронутыми. Например, изолированному коду не разрешается открывать случайные файлы, но разрешается использовать шрифты. WPF позволяет приложениям с песочницей использовать функциональность шрифта, вызывая **Assert,** а для WPF читать файлы, которые, как известно, содержат эти шрифты от имени приложения в песочнице.  
  
### <a name="clickonce-deployment"></a>Развертывание ClickOnce  
 ClickOnce — это комплексная технология развертывания, которая включена в программу .NET Framework и интегрируется с Visual Studio (см. [безопасность и развертывание ClickOnce](/visualstudio/deployment/clickonce-security-and-deployment) для получения подробной информации). Автономные приложения WPF могут быть развернуты с помощью ClickOnce, в то время как браузерные приложения должны быть развернуты с ClickOnce.  
  
 Приложениям, развернутым с помощью ClickOnce, предоставляется дополнительный уровень безопасности по безопасности доступа к коду (CAS); по существу, ClickOnce развернутые приложения запрашивают разрешения, которые им нужны. Им предоставляются только разрешения, не расширяющие набор разрешений для зоны, в которой развертывается приложения. Уменьшая набор разрешений только до тех, которые необходимы, даже если они меньше, чем те, которые предусмотрены набором разрешений зоны запуска, количество ресурсов, к которым приложение имеет доступ, сводится к минимуму. Таким образом, уменьшается вероятность повреждений на клиентском компьютере в случае перехвата приложения.  
  
### <a name="security-critical-methodology"></a>Методология, критическая с точки зрения безопасности  
 Код WPF, который использует разрешения для включения песочницы в интернет-зоне для приложений XBAP, должен быть проведен в максимально возможной степени аудита и контроля безопасности. Чтобы облегчить это требование, .NET Framework предоставляет новую поддержку для управления кодом, который повышает привилегии. В частности, CLR позволяет определить код, который повышает <xref:System.Security.SecurityCriticalAttribute>привилегии и пометить его с ; любой код, <xref:System.Security.SecurityCriticalAttribute> не отмеченный, становится *прозрачным* с помощью этой методологии. В свою очередь, управляемому коду, который не помечен атрибутом <xref:System.Security.SecurityCriticalAttribute>, запрещено повышать привилегии.  
  
 Методология безопасности и критической позволяет организовать код WPF, который поднимает привилегии в *ядро, критическое для безопасности,* а остальная часть является прозрачной. Изолировать критически важный код позволяет инженерной группе WPF сфокусировать дополнительный анализ безопасности и элементауправления исходного элемента на критически важном ядре безопасности сверх стандартных методов безопасности (см. [Стратегию безопасности WPF - Security Engineering).](wpf-security-strategy-security-engineering.md)  
  
 Обратите внимание, что .NET Framework позволяет доверенному коду расширять песочницу интернет-зоны <xref:System.Security.AllowPartiallyTrustedCallersAttribute> XBAP, позволяя разработчикам писать управляемые сборки, которые отмечены (APTCA) и развернуты в кэше Глобальной ассамблеи пользователя (GAC). Пометка сборки атрибутом APTCA является исключительно важной операцией безопасности, так как позволяет вызывать эту сборку любому коду, включая вредоносный код из Интернета. При этом необходимо использовать особую осторожность и рекомендации, и пользователи должны указывать, что доверяют этому программному обеспечению, чтобы установить его.  
  
## <a name="microsoft-internet-explorer-security"></a>Безопасность Microsoft Internet Explorer  
 Помимо сокращения проблем безопасности и упрощения конфигурации безопасности, Microsoft Internet Explorer 6 (SP2) содержит несколько функций, которые повышают безопасность пользователей браузерных приложений XAML (XBAPs). Эти функции пытаются разрешить пользователям большую степень контроля над их работой в Интернете.  
  
 До IE6 SP2 пользователи могут быть предметом любого из следующих:  
  
- произвольно всплывающими окнами;  
  
- запутывающим перенаправлением скриптов;  
  
- многочисленными диалоговыми окнами безопасности на некоторых веб-сайтах.  
  
 В некоторых случаях ненадежные веб-сайты пытаются обмануть [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] пользователей, подделывая установку или неоднократно показывая диалоговый ящик установки Microsoft ActiveX, даже если пользователь, возможно, отменил его. Возможно, что с помощью этих методов значительное число пользователей обманным путем заставили принять неверные решения, что привело к установке шпионских программ.  
  
 IE6 SP2 включает в себя несколько функций для смягчения этих типов проблем, которые вращаются вокруг концепции инициирования пользователя. IE6 SP2 обнаруживает, когда пользователь нажал на ссылку или элемент страницы до действия, которое известно как *инициация пользователя,* и рассматривает его иначе, чем когда аналогичное действие вместо этого вызвано скриптом на странице. Например, IE6 SP2 включает в себя **блокировщик Pop-Up,** который обнаруживает, когда пользователь нажимает кнопку перед страницей, создавая всплывающее окно. Это позволяет IE6 SP2, чтобы большинство безобидных всплывающих окно, предотвращая всплывающие окно, что пользователи не просят и не хотят. Заблокированные всплывающие данные находятся в ловушке под новой **информационной панелью,** которая позволяет пользователю вручную переопределять блок и просматривать всплывающее окно.  
  
 Та же логика инициирования пользователей применяется и в запросах безопасности **Open**/**Save.** Диалоговых диалогов установки ActiveX всегда находятся в ловушке под информационным баром, если они не представляют собой обновление от ранее установленного элемента управления. Эти меры комбинируются для предоставления пользователям более безопасного и более управляемого взаимодействия, поскольку они защищаются от веб-сайтов, которые беспокоят их установкой нежелательного либо вредоносного программного обеспечения.  
  
 Эти функции также защищают клиентов, которые используют IE6 SP2 для просмотра веб-сайтов, которые позволяют им загружать и устанавливать приложения WPF. В частности, это связано с тем, что IE6 SP2 предлагает лучший пользовательский интерфейс, который снижает у пользователей возможность устанавливать вредоносные или коварные приложения независимо от того, какая технология была использована для его создания, включая WPF. WPF добавляет к этим средствам защиты с помощью ClickOnce для облегчения загрузки своих приложений через Интернет. Поскольку приложения для браузеров XAML (XBAPs) выполняются в песочнице безопасности в зоне Интернета, они могут быть беспрепятственно запущены. С другой стороны, автономные приложения WPF требуют полного доверия для выполнения. Для этих приложений ClickOnce будет отображать диалоговую коробку безопасности во время запуска, чтобы уведомить об использовании дополнительных требований к безопасности приложения. Тем не менее это должно быть инициировано пользователем, также будет управляться логикой, инициированной пользователем, и может быть отменено.  
  
 Internet Explorer 7 включает в себя и расширяет возможности безопасности IE6 SP2 в рамках постоянной приверженности безопасности.  
  
## <a name="see-also"></a>См. также раздел

- [Безопасность доступа к коду](../misc/code-access-security.md)
- [Безопасность](security-wpf.md)
- [WPF Частичная доверительная безопасность](wpf-partial-trust-security.md)
- [Стратегия безопасности WPF — проектирование безопасности](wpf-security-strategy-security-engineering.md)
