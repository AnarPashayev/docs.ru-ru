---
title: Стратегия безопасности платформы
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- platform security model [WPF]
- Common Language Runtime (CLR) security features
- operating system security model [WPF]
- Internet Explorer security features [WPF]
- Security-Critical method
- CLR security features [WPF]
- security model [WPF]
- security model [WPF], platform
- WPF [WPF], about security model
- Windows Presentation Foundation [WPF], about security model
- security model [WPF], operating system
ms.assetid: 2a39a054-3e2a-4659-bcb7-8bcea490ba31
ms.openlocfilehash: 1ef705fcf046af1f4136ddcf1b29f417c0d72c83
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76741851"
---
# <a name="wpf-security-strategy---platform-security"></a>Стратегия безопасности WPF — безопасность платформы
Хотя Windows Presentation Foundation (WPF) предоставляет разнообразные службы безопасности, он также использует функции безопасности базовой платформы, включая операционную систему, среду CLR и Internet Explorer. Эти слои объединяются для обеспечения комплексной модели безопасности с глубоким уровнем защиты, которая пытается избежать какой-либо единой точки отказа, как показано на следующем рисунке.  
  
 ![Схема, на которой показана модель безопасности WPF.](./media/wpf-security-strategy-platform-security/windows-presentation-foundation-security.png)  
  
 В оставшейся части этого раздела обсуждаются функции каждого из этих уровней, относящиеся к WPF.  

## <a name="operating-system-security"></a>Безопасность операционной системы  
Ядро Windows предоставляет несколько функций безопасности, образующих основу безопасности для всех приложений Windows, включая созданные с помощью WPF. В этом разделе обсуждаются эти функции безопасности, важные для WPF, а также способы интеграции WPF с ними для предоставления более глубокой защиты.  
  
### <a name="microsoft-windows-xp-service-pack-2-sp2"></a>Microsoft Windows XP с пакетом обновления 2 (SP2)  
 В дополнение к общей проверке и усилению возможностей Windows существует три основных функции [!INCLUDE[TLA2#tla_winxpsp2](../../../includes/tla2sharptla-winxpsp2-md.md)], которые мы будем обсуждать в этом разделе:  
  
- Компиляция /GS  
  
- Microsoft Центр обновления Windows.  
  
#### <a name="gs-compilation"></a>Компиляция /GS  
 [!INCLUDE[TLA2#tla_winxpsp2](../../../includes/tla2sharptla-winxpsp2-md.md)] обеспечивает защиту путем повторной компиляции многих основных системных библиотек, включая все зависимости WPF, такие как среда CLR, чтобы снизить вероятность переполнения буфера. Это достигается путем использования параметра /GS с компилятором командной строки C/C++. Несмотря на то, что следует явно избегать переполнения буфера, компиляция /GS представляет пример глубокой защиты против потенциальных угроз, созданных случайно или злонамеренно.  
  
 Ранее переполнения буфера были причиной многих эксплойтов безопасности с высокой степенью воздействия. Переполнение буфера возникает, когда злоумышленник использует уязвимость кода, которая позволяет внедрить вредоносный код, выполняющий записи за границами буфера. Затем это позволяет злоумышленнику перехватить процесс, в котором выполняется код, путем перезаписи адреса возврата функции, чтобы вызвать выполнение кода злоумышленника. Результатом является вредоносный код, выполняющий произвольный код с привилегиями перехваченного процесса.  
  
 На высоком уровне флаг компилятора-GS защищает от некоторых возможных переполнений буфера путем введения специального файла cookie безопасности для защиты адреса возврата функции, которая имеет локальные буферы строк. После возврата функции cookie безопасности сравнивается со своим предыдущим значением. Если значение изменилось, то возможно, произошло переполнение буфера, и процесс будет остановлен с состоянием ошибки. Остановка процесса предотвращает выполнение потенциально вредоносного кода. Дополнительные сведения см. в разделе [-GS (проверка безопасности буфера)](/cpp/build/reference/gs-buffer-security-check) .  
  
 WPF компилируется с флагом/GS, чтобы добавить еще один уровень защиты для приложений WPF.  
  
### <a name="windows-vista"></a>Windows Vista  
Пользователи WPF в Windows Vista получат преимущества дополнительных усовершенствований системы безопасности операционной системы, в том числе "доступ пользователей с минимальными правами доступа", проверки целостности кода и изоляцию привилегий.  
  
#### <a name="user-account-control-uac"></a>Контроль учетных записей (UAC)  
 Сегодня пользователи Windows, как правило, работают с правами администратора, так как многие приложения требуют их для установки или выполнения либо для того и другого. Одним из примеров является возможность записи в реестр параметров приложения по умолчанию.  
  
 Работа с правами администратора в действительности означает, что приложения выполняются из процессов, которым предоставлены права администратора. Влияние этого на безопасность заключается в том, что любой вредоносный код, перехвативший процесс с правами администратора, автоматически наследует эти права, включая доступ к критически важным системным ресурсам.  
  
 Один из способов защиты от этой угрозы безопасности состоит в запуске приложений с наименьшим количеством требуемых им привилегий. Это называется принципом наименьших привилегий и является основным компонентом операционной системы Windows. Эта функция называется контролем учетных записей пользователей (UAC) и используется Windows UAC двумя основными способами.  
  
- Для запуска большинства приложений с правами UAC по умолчанию, даже если пользователь является администратором; только приложения, требующие привилегий администратора, будут выполняться с привилегиями администратора. Для запуска с привилегиями администратора приложения должны быть явно отмечены либо в своем манифесте приложения, либо как запись в политике безопасности.  
  
- Для обеспечения решений совместимости, таких как виртуализация. Например, многие приложения пытаются выполнять запись в места с ограниченным доступом, такие как C:\Program Files. Для приложений, выполняющихся в рамках UAC, существует альтернативное расположение, для записи в которое не требуются права администратора. Для приложений, работающих в рамках UAC, UAC виртуализирует расположение C:\Program Files, и таким образом приложения считают, что выполняют запись в это расположение, но на самом деле запись выполняется в другое, пользовательское расположение. Такой вид работы совместимости позволяет операционной системе запускать многие приложения, которые ранее не могли работать в UAC.  
  
#### <a name="code-integrity-checks"></a>Проверки целостности кода  
 В состав Windows Vista входят более глубокие проверки целостности кода, позволяющие предотвратить внедрение вредоносного кода в системные файлы или в ядро во время загрузки или выполнения. Это выходит за рамки защиты системных файлов.  
   
### <a name="limited-rights-process-for-browser-hosted-applications"></a>Процесс с ограниченными правами для браузерных приложений  
 Приложения WPF, размещенные в браузере, выполняются в песочнице зоны Интернета. Интеграция WPF с Microsoft Internet Explorer расширяет эту защиту с помощью дополнительной поддержки.  
  
 Так как приложения браузера XAML (XBAP) обычно изолированы по набору разрешений зоны Интернета, удаление этих привилегий не несет вреда приложениям браузера XAML (XBAP) с точки зрения совместимости. Вместо этого создается дополнительный уровень глубокой защиты; если изолированное приложение сможет использовать другие уровни и перехватить процесс, этот процесс будет иметь только ограниченные привилегии.  
  
 См. раздел [Использование учетной записи пользователя с минимальными правами доступа](https://docs.microsoft.com/previous-versions/tn-archive/cc700846%28v=technet.10%29).  
  
## <a name="common-language-runtime-security"></a>Безопасность среды CLR  
 Среда CLR предоставляет ряд ключевых преимуществ безопасности, включая проверку и проверку, разграничение доступа кода (CAS) и методологию критической безопасности.  
    
### <a name="validation-and-verification"></a>Проверка и верификация  
 Чтобы обеспечить изоляцию и целостность сборок, среда CLR использует процесс проверки. Проверка CLR обеспечивает изолированность сборок путем проверки их формата переносимых исполняемых файлов (PE) для адресов, которые указываются за пределами сборки. Проверка CLR также проверяет целостность метаданных, внедренных в сборку.  
  
 Чтобы обеспечить безопасность типа, помочь предотвратить распространенные проблемы безопасности (например, переполнение буфера) и включить изолированную среду через изоляцию подпроцесса, безопасность среды CLR использует концепцию проверки.  
  
 Управляемые приложения компилируются в язык MSIL. Когда методы в управляемом приложении выполняются, его MSIL-файлы компилируются в машинный код с помощью JIT-компиляции. JIT-компиляция включает процесс верификации, который применяет много правил безопасности и надежности, обеспечивающих, что код:  
  
- не нарушает контракты типов;  
  
- не вызывает переполнение буфера;  
  
- не имеет бесконтрольный доступ к памяти.  
  
 Выполнение управляемого кода, который не соответствует правилам верификации, не разрешается, пока он не будет считаться надежным кодом.  
  
 Преимуществом проверяемого кода является основная причина, по которой WPF строится на .NET Framework. При условии, что используется верифицируемый код, вероятность использования возможных уязвимостей значительно ниже.  
  
### <a name="code-access-security"></a>Управление доступом для кода  
 Клиентский компьютер предоставляет широкий спектр ресурсов, к которым может получить доступ управляемое приложение, включая файловую систему, реестр, службы печати, пользовательский интерфейс, отражение и переменные среды. Прежде чем управляемое приложение сможет получить доступ к любому из ресурсов на клиентском компьютере, оно должно иметь .NET Framework разрешение. Разрешение в CAS является подклассом <xref:System.Security.CodeAccessPermission>; CAS реализует один подкласс для каждого ресурса, к которому могут обращаться управляемые приложения.  
  
 Набор разрешений, предоставляемый управляемым приложением CAS при запуске, называется набором разрешений и определяется свидетельством, предоставленным приложением. Для приложений WPF предоставляемое свидетельство — это расположение или зона, из которой запускаются приложения. CAS определяет следующие зоны:  
  
- **Мой компьютер**. Приложения запускаются с клиентского компьютера (полное доверие).  
  
- **Локальная интрасеть**. Приложения запускаются из интрасети (частичное доверие).  
  
- **Интернет**. Приложения запускаются из Интернета (минимальное доверие).  
  
- **Доверенные веб-сайты**. Приложения, идентифицированные пользователем как доверенные (минимальное доверие).  
  
- **Веб-сайты без доверия**. Приложения, идентифицированные пользователем как ненадежные (без доверия).  
  
 Для каждой из этих зон CAS предоставляет предопределенный набор разрешений, включающий разрешения, соответствующие уровню доверия, связанному с каждым из них. К ним относятся следующие объекты.  
  
- **FullTrust**. Для приложений, запускаемых из зоны **Мой компьютер** . Предоставляются все возможные разрешения.  
  
- **LocalIntranet**. Для приложений, запускаемых из зоны **местной интрасети** . Подмножество разрешений предоставляется для обеспечения среднего уровня доступа к ресурсам на клиентском компьютере, включая изолированное хранилище, неограниченный доступ к пользовательскому интерфейсу, неограниченный доступ к диалогам для работы с файлами, ограниченное отражение, ограниченный доступ к переменным среды. Разрешения для критически важных ресурсов, таких как реестр, не предоставляются.  
  
- **Интернет**. Для приложений, запускаемых из **Интернета** или из зоны **надежных узлов** . Подмножество разрешений предоставляется для обеспечения ограниченного доступа к ресурсам на клиентском компьютере, включая изолированное хранилище, только открытие файлов и ограниченный пользовательский интерфейс. По сути, этот набор разрешений изолирует приложения от клиентского компьютера.  
  
 Приложения, идентифицируемые из зоны **ненадежных сайтов** , не получают разрешения для CAS. Следовательно, для них не существует предопределенный набор разрешений.  
  
 На следующем рисунке показана связь между зонами, наборами разрешений, разрешениями и ресурсами.  
  
 ![Схема, показывающая наборы разрешений CAS.](./media/wpf-security-strategy-platform-security/code-access-security-permissions-relationship.png)  
  
 Ограничения песочницы безопасности зоны Интернета применяются одинаково к любому коду, который XBAP импортирует из системной библиотеки, включая WPF. Это гарантирует, что все биты кода заблокированы, даже WPF. К сожалению, чтобы обеспечить возможность выполнения, XBAP необходимо выполнить функции, требующие больше разрешений, чем те, которые включены в песочнице безопасности зоны Интернета.  
  
 Рассмотрим приложение XBAP, которое включает следующую страницу:  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 Для выполнения этого приложения XBAP базовый код WPF должен выполнять больше функциональных возможностей, чем доступно вызывающему XBAP, в том числе:  
  
- Создание дескриптора окна (HWND) для подготовки к просмотру  
  
- диспетчеризацию сообщений;  
  
- загрузку шрифт Tahoma.  
  
 С точки зрения безопасности предоставление прямого доступа к любой из этих операций из изолированного приложения будет иметь катастрофические последствия.  
  
 К счастью, WPF применяет эту ситуацию, разрешая выполнение этих операций с повышенными привилегиями от имени изолированного приложения. Хотя все операции WPF проверяются на соответствие ограниченным разрешениям безопасности зоны Интернета для домена приложения XBAP, WPF (как и в случае с другими системными библиотеками) предоставляет набор разрешений, включающий все возможные разрешения.
  
 Для этого необходимо, чтобы WPF получал повышенные привилегии и не мешал этим привилегиям управляться набором разрешений зоны Интернета в домене ведущего приложения.  
  
 WPF делает это с помощью метода **Assert** разрешения. В следующем примере кода показано, как это происходит.  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 **Утверждение** фактически предотвращает неограниченные разрешения, необходимые WPF, из разрешений зоны Интернета XBAP.  
  
 С точки зрения платформы WPF отвечает за правильное использование **Assert** ; неправильное использование **Assert** может позволить вредоносному коду повысить привилегии. Следовательно, важно вызвать **Assert** только при необходимости и убедиться, что ограничения песочницы остаются неизменными. Например, изолированному коду не разрешается открывать случайные файлы, но разрешается использовать шрифты. WPF позволяет изолированным приложениям использовать функции шрифтов путем вызова **Assert**, а для WPF — для чтения файлов, известных для хранения этих шрифтов от имени изолированного приложения.  
  
### <a name="clickonce-deployment"></a>развертывание ClickOnce  
 Технология ClickOnce является комплексной технологией развертывания, которая входит в состав .NET Framework и интегрируется с Visual Studio (Дополнительные сведения см. в статье о [безопасности и развертывании ClickOnce](/visualstudio/deployment/clickonce-security-and-deployment) ). Автономные приложения WPF можно развертывать с помощью ClickOnce, а приложения, размещенные в браузере, должны развертываться с помощью ClickOnce.  
  
 Приложения, развернутые с помощью ClickOnce, получают дополнительный уровень безопасности по сравнению с управлением доступом для кода (CAS); по сути, развернутые приложения ClickOnce запрашивают необходимые разрешения. Им предоставляются только разрешения, не расширяющие набор разрешений для зоны, в которой развертывается приложения. Уменьшая набор разрешений только теми, которые необходимы, даже если они меньше, чем предоставлено набором разрешений зоны запуска, количество ресурсов, к которым приложение имеет доступ, сокращается до минимального значения. Таким образом, уменьшается вероятность повреждений на клиентском компьютере в случае перехвата приложения.  
  
### <a name="security-critical-methodology"></a>Методология, критическая с точки зрения безопасности  
 Код WPF, использующий разрешения для включения песочницы зоны Интернета для приложений XBAP, должен быть сохранен в максимально возможной степени аудита и контроля безопасности. Чтобы упростить это требование, .NET Framework предоставляет новую поддержку для управления кодом, который повышает привилегии. В частности, среда CLR позволяет выявление кода, который повышает привилегии и помечает его с помощью <xref:System.Security.SecurityCriticalAttribute>; любой код, не помеченный <xref:System.Security.SecurityCriticalAttribute>, станет *прозрачным* при использовании этой методологии. В свою очередь, управляемому коду, который не помечен атрибутом <xref:System.Security.SecurityCriticalAttribute>, запрещено повышать привилегии.  
  
 Методология, критическая с точки зрения безопасности, позволяет организации кода WPF, который повышает привилегии, в *ядро критической безопасности*с оставшимся прозрачным значением. Изоляция кода, критичного с точки зрения безопасности, позволяет группе разработчиков WPF сосредоточиться на дополнительном анализе безопасности и системе управления версиями в ядре, критическом для безопасности, а также за пределами стандартных методов обеспечения безопасности (см. раздел [стратегия безопасности WPF — проектирование безопасности](wpf-security-strategy-security-engineering.md)).  
  
 Обратите внимание, что .NET Framework позволяет доверенному коду расширять песочницу зоны Интернета XBAP, позволяя разработчикам создавать управляемые сборки, помеченные <xref:System.Security.AllowPartiallyTrustedCallersAttribute> (APTCA) и развернутые в глобальном кэше сборок (GAC) пользователя. Пометка сборки атрибутом APTCA является исключительно важной операцией безопасности, так как позволяет вызывать эту сборку любому коду, включая вредоносный код из Интернета. При этом необходимо использовать особую осторожность и рекомендации, и пользователи должны указывать, что доверяют этому программному обеспечению, чтобы установить его.  
  
## <a name="microsoft-internet-explorer-security"></a>Безопасность Microsoft Internet Explorer  
 Помимо уменьшения проблем безопасности и упрощения настройки безопасности, Microsoft Internet Explorer 6 (SP2) содержит несколько функций, повышающих безопасность для пользователей приложений браузера XAML (XBAP). Эти функции пытаются разрешить пользователям большую степень контроля над их работой в Интернете.  
  
 До версии IE6 с пакетом обновления 2 (SP2) пользователи могут подвергаться любым из следующих способов:  
  
- произвольно всплывающими окнами;  
  
- запутывающим перенаправлением скриптов;  
  
- многочисленными диалоговыми окнами безопасности на некоторых веб-сайтах.  
  
 В некоторых случаях ненадежные веб-сайты попытаются обманным путем обманного [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] установки или повторного отображения диалогового окна установки Microsoft ActiveX, даже если пользователь мог его отменить. Возможно, что с помощью этих методов значительное число пользователей обманным путем заставили принять неверные решения, что привело к установке шпионских программ.  
  
 В пакете обновления IE6 SP2 имеется несколько функций для устранения проблем такого типа, которые связаны с концепцией инициации пользователей. Обозреватель IE6 SP2 обнаруживает, что пользователь щелкнул ссылку или элемент страницы перед действием, называемым *инициацией пользователя*, и обрабатывает его иначе, чем при запуске аналогичного действия сценарием на странице. Например, в обозревателе IE6 с пакетом обновления 2 (SP2) включается **блокирование всплывающих окон** , которое определяет, когда пользователь нажимает кнопку перед страницей, создающей всплывающее окно. Это позволяет IE6 с пакетом обновления 2 (SP2) разрешать большинство безвредных всплывающих окон и предотвращать всплывающие окна, которые пользователи не запрашивают и не хотят. Заблокированные всплывающие окна перехватываются на новой **панели информации**, что позволяет пользователю вручную переопределить блок и просмотреть всплывающее окно.  
  
 Та же логика инициации пользователей также применяется для **открытия**/**сохранения** запросов безопасности. Диалоговые окна установки ActiveX всегда перехватываются на панели информации, если они не представляют собой обновление ранее установленного элемента управления. Эти меры комбинируются для предоставления пользователям более безопасного и более управляемого взаимодействия, поскольку они защищаются от веб-сайтов, которые беспокоят их установкой нежелательного либо вредоносного программного обеспечения.  
  
 Эти функции также защищают клиентов, которые используют IE6 с пакетом обновления 2 (SP2), для перехода на веб-сайты, которые позволяют им скачивать и устанавливать приложения WPF. В частности, это связано с тем, что IE6 с пакетом обновления 2 (SP2) предлагает более удобный пользовательский интерфейс, который сокращает вероятность установки вредоносных или нелегальных приложений, независимо от того, какая технология использовалась для ее создания, включая WPF. WPF добавляет эти средства защиты с помощью ClickOnce для упрощения загрузки своих приложений через Интернет. Поскольку приложения браузера XAML (XBAP) выполняются в песочнице безопасности зоны Интернета, их можно легко запустить. С другой стороны, для выполнения автономных приложений WPF требуется полное доверие. Для этих приложений в процессе запуска ClickOnce будет отображать диалоговое окно безопасности для уведомления об использовании дополнительных требований к безопасности приложения. Тем не менее это должно быть инициировано пользователем, также будет управляться логикой, инициированной пользователем, и может быть отменено.  
  
 Internet Explorer 7 включает и расширяет возможности безопасности IE6 с пакетом обновления 2 (SP2) в рамках текущих обязательств по обеспечению безопасности.  
  
## <a name="see-also"></a>См. также раздел

- [Управление доступом для кода](../misc/code-access-security.md)
- [Безопасность](security-wpf.md)
- [Безопасность частичного доверия в WPF](wpf-partial-trust-security.md)
- [Стратегия безопасности WPF — проектирование безопасности](wpf-security-strategy-security-engineering.md)
