---
title: Построение приложения WPF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WPF application [WPF], building
ms.assetid: a58696fd-bdad-4b55-9759-136dfdf8b91c
ms.openlocfilehash: a5254de07029e53dd6b72bd2c096c38525a661b6
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2019
ms.locfileid: "69958710"
---
# <a name="building-a-wpf-application-wpf"></a><span data-ttu-id="e0a8c-102">Построение приложения WPF</span><span class="sxs-lookup"><span data-stu-id="e0a8c-102">Building a WPF Application (WPF)</span></span>

<span data-ttu-id="e0a8c-103">Приложения Windows Presentation Foundation (WPF) могут быть построены как .NET Framework исполняемые файлы (exe), библиотеки (. dll) или сочетание обоих типов сборок.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-103">Windows Presentation Foundation (WPF) applications can be built as .NET Framework executables (.exe), libraries (.dll), or a combination of both types of assemblies.</span></span> <span data-ttu-id="e0a8c-104">В этом разделе даются вводные сведения для построения приложений [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] и описываются основные шаги процесса построения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-104">This topic introduces how to build [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] applications and describes the key steps in the build process.</span></span>

<a name="Building_a_WPF_Application_using_Command_Line"></a>

## <a name="building-a-wpf-application"></a><span data-ttu-id="e0a8c-105">Построение приложения WPF</span><span class="sxs-lookup"><span data-stu-id="e0a8c-105">Building a WPF Application</span></span>

<span data-ttu-id="e0a8c-106">Приложения WPF можно компилировать следующими способами.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-106">A WPF application can be compiled in the following ways:</span></span>

- <span data-ttu-id="e0a8c-107">Из командной строки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-107">Command-line.</span></span> <span data-ttu-id="e0a8c-108">Приложение должно содержать только код (без XAML) и файл определения приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-108">The application must contain only code (no XAML) and an application definition file.</span></span> <span data-ttu-id="e0a8c-109">Дополнительные сведения см. в разделе [Построение из командной строки с помощью csc.exe](../../../csharp/language-reference/compiler-options/command-line-building-with-csc-exe.md) или [Построение из командной строки (Visual Basic)](../../../visual-basic/reference/command-line-compiler/building-from-the-command-line.md).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-109">For more information, see [Command-line Building With csc.exe](../../../csharp/language-reference/compiler-options/command-line-building-with-csc-exe.md) or [Building from the Command Line (Visual Basic)](../../../visual-basic/reference/command-line-compiler/building-from-the-command-line.md).</span></span>

- <span data-ttu-id="e0a8c-110">С помощью Microsoft Build Engine (MSBuild).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-110">Microsoft Build Engine (MSBuild).</span></span> <span data-ttu-id="e0a8c-111">Помимо кода и файлов XAML приложение должно содержать файл проекта MSBuild.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-111">In addition to the code and XAML files, the application must contain an MSBuild project file.</span></span> <span data-ttu-id="e0a8c-112">Дополнительные сведения см. в разделе "MSBuild".</span><span class="sxs-lookup"><span data-stu-id="e0a8c-112">For more information, see "MSBuild".</span></span>

- <span data-ttu-id="e0a8c-113">Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-113">Visual Studio.</span></span> <span data-ttu-id="e0a8c-114">Visual Studio — это интегрированная среда разработки, которая компилирует приложения WPF с помощью MSBuild и включает визуальный конструктор для создания пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-114">Visual Studio is an integrated development environment that compiles WPF applications with MSBuild and includes a visual designer for creating UI.</span></span> <span data-ttu-id="e0a8c-115">Дополнительные сведения см. в статьях [Создание кода и управление им с помощью Visual Studio](/visualstudio/ide/index-writing-code) и [Разработка XAML в Visual Studio](/visualstudio/designers/designing-xaml-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-115">For more information, see [Write and manage code using Visual Studio](/visualstudio/ide/index-writing-code) and [Design XAML in Visual Studio](/visualstudio/designers/designing-xaml-in-visual-studio).</span></span>

<a name="The_Windows_Presentation_Foundation_Build_Pipeline"></a>

## <a name="wpf-build-pipeline"></a><span data-ttu-id="e0a8c-116">Конвейер сборки WPF</span><span class="sxs-lookup"><span data-stu-id="e0a8c-116">WPF Build Pipeline</span></span>

<span data-ttu-id="e0a8c-117">Когда выполняется сборка проекта [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], вызывается сочетание целевых объектов, специфичных для языка и [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-117">When a [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] project is built, the combination of language-specific and [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]-specific targets are invoked.</span></span> <span data-ttu-id="e0a8c-118">Процесс выполнения этих целевых объектов называется конвейером сборки, и его ключевые шаги показаны на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-118">The process of executing these targets is called the build pipeline, and the key steps are illustrated by the following figure.</span></span>

<span data-ttu-id="e0a8c-119">![Процесс сборки WPF](./media/wpfbuildsystem-figure1.png "WPFBuildSystem_Figure1")</span><span class="sxs-lookup"><span data-stu-id="e0a8c-119">![WPF build process](./media/wpfbuildsystem-figure1.png "WPFBuildSystem_Figure1")</span></span>

<a name="Pre_Build_Initializations"></a>

### <a name="pre-build-initializations"></a><span data-ttu-id="e0a8c-120">Инициализации перед сборкой</span><span class="sxs-lookup"><span data-stu-id="e0a8c-120">Pre-Build Initializations</span></span>

<span data-ttu-id="e0a8c-121">Перед сборкой MSBuild определяет расположение важных средств и библиотек, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="e0a8c-121">Before building, MSBuild determines the location of important tools and libraries, including the following:</span></span>

- <span data-ttu-id="e0a8c-122">.NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-122">The .NET Framework.</span></span>

- <span data-ttu-id="e0a8c-123">Каталоги [!INCLUDE[TLA2#tla_wcsdk](../../../../includes/tla2sharptla-wcsdk-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-123">The [!INCLUDE[TLA2#tla_wcsdk](../../../../includes/tla2sharptla-wcsdk-md.md)] directories.</span></span>

- <span data-ttu-id="e0a8c-124">Расположение ссылочных сборок [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-124">The location of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] reference assemblies.</span></span>

- <span data-ttu-id="e0a8c-125">Свойство для путей поиска сборки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-125">The property for the assembly search paths.</span></span>

<span data-ttu-id="e0a8c-126">Первое расположение, где MSBuild ищет сборки, — это каталог ссылочной сборки (%ProgramFiles%\Reference\\assemblies\microsoft\framework\v3.0.).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-126">The first location where MSBuild searches for assemblies is the reference assembly directory (%ProgramFiles%\Reference Assemblies\Microsoft\Framework\v3.0\\).</span></span> <span data-ttu-id="e0a8c-127">На этом шаге процесс сборки также инициализирует различные свойства и группы элементов и выполняет все необходимые действия по очистке.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-127">During this step, the build process also initializes the various properties and item groups and performs any required cleanup work.</span></span>

<a name="Resolving_references"></a>

### <a name="resolving-references"></a><span data-ttu-id="e0a8c-128">Разрешение ссылок</span><span class="sxs-lookup"><span data-stu-id="e0a8c-128">Resolving References</span></span>

<span data-ttu-id="e0a8c-129">Процесс сборки находит и привязывает сборки, которые требуются для выполнения сборки проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-129">The build process locates and binds the assemblies required to build the application project.</span></span> <span data-ttu-id="e0a8c-130">Эта логика содержится в задаче `ResolveAssemblyReference`.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-130">This logic is contained in the `ResolveAssemblyReference` task.</span></span> <span data-ttu-id="e0a8c-131">Все сборки, объявленные как `Reference` в файле проекта, предоставляются в задачу вместе с информацией о путях поиска и метаданными в сборках, уже установленных в системе.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-131">All assemblies declared as `Reference` in the project file are provided to the task along with information on the search paths and metadata on assemblies already installed on the system.</span></span> <span data-ttu-id="e0a8c-132">Задача ищет сборки и использует метаданные установленной сборки для фильтрации этих основных сборок [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], которые не должны отображаться в манифестах выходных данных.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-132">The task looks up assemblies and uses the installed assembly's metadata to filter out those core [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] assemblies that need not show up in the output manifests.</span></span> <span data-ttu-id="e0a8c-133">Это позволяет избежать избыточных сведений в манифесте ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-133">This is done to avoid redundant information in the ClickOnce manifests.</span></span> <span data-ttu-id="e0a8c-134">Например, поскольку PresentationFramework. dll может считаться репрезентативным для приложения, построенного на, а [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] также для и более [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] , так как все сборки находятся в одном расположении на каждом компьютере с .NET Framework установлено, не нужно включать все сведения обо всех .NET Framework ссылок на сборки в манифестах.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-134">For example, since PresentationFramework.dll can be considered representative of an application built on and for the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] and moreover since all [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] assemblies exist at the same location on every machine that has the .NET Framework installed, there is no need to include all information on all .NET Framework reference assemblies in the manifests.</span></span>

<a name="Markup_Compilation___Pass_1"></a>

### <a name="markup-compilationpass-1"></a><span data-ttu-id="e0a8c-135">Компиляция разметки — шаг 1</span><span class="sxs-lookup"><span data-stu-id="e0a8c-135">Markup Compilation—Pass 1</span></span>

<span data-ttu-id="e0a8c-136">На этом шаге файлы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] анализируются и компилируются, чтобы в среде выполнения не тратилось время на анализ [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] и проверку значений свойств.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-136">In this step, [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files are parsed and compiled so that the runtime does not spend time parsing [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] and validating property values.</span></span> <span data-ttu-id="e0a8c-137">Скомпилированный файл [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] заранее размечен, так что во время выполнения его загрузка происходит гораздо быстрее, чем загрузка файла [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-137">The compiled [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file is pre-tokenized so that, at run time, loading it should be much faster than loading a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file.</span></span>

<span data-ttu-id="e0a8c-138">На этом шаге для каждого файла [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], который является элементом сборки `Page`, выполняются следующие действия.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-138">During this step, the following activities take place for every [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file that is a `Page` build item:</span></span>

1. <span data-ttu-id="e0a8c-139">Файл [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] анализируется компилятором разметки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-139">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file is parsed by the markup compiler.</span></span>

2. <span data-ttu-id="e0a8c-140">Для этого [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] создается скомпилированное представление и копируется в папку obj\Release.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-140">A compiled representation is created for that [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and copied to the obj\Release folder.</span></span>

3. <span data-ttu-id="e0a8c-141">Создается представление CodeDOM нового разделяемого класса и копируется в папку obj\Release.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-141">A CodeDOM representation of a new partial class is created and copied to the obj\Release folder.</span></span>

<span data-ttu-id="e0a8c-142">Кроме того, создается отдельный языковой файл кода для каждого файла [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-142">In addition, a language-specific code file is generated for every [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file.</span></span> <span data-ttu-id="e0a8c-143">Например, для страницы «страница кода. XAML» в проекте Visual Basic создается элемент «a. g. vb». для страницы "страница с. XAML" C# в проекте создается Page1.g.cs.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-143">For example, for a Page1.xaml page in a Visual Basic project, a Page1.g.vb is generated; for a Page1.xaml page in a C# project, a Page1.g.cs is generated.</span></span> <span data-ttu-id="e0a8c-144">".g" в имени файла указывает, что это файл созданного кода, который имеет объявление разделяемого класса для элемента верхнего уровня файла разметки (например, `Page` или `Window`).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-144">The ".g" in the file name indicates the file is generated code that has a partial class declaration for the top-level element of the markup file (such as `Page` or `Window`).</span></span> <span data-ttu-id="e0a8c-145">Класс объявляется с `partial` модификатором в C# (`Extends` в Visual Basic), чтобы указать еще одно объявление для класса в другом расположении, обычно в файле кода программной части Page1.XAML.cs.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-145">The class is declared with the `partial` modifier in C# (`Extends` in Visual Basic) to indicate there is another declaration for the class elsewhere, usually in the code-behind file Page1.xaml.cs.</span></span>

<span data-ttu-id="e0a8c-146">Разделяемый класс расширяется из соответствующего базового класса (например <xref:System.Windows.Controls.Page> , для страницы) и <xref:System.Windows.Markup.IComponentConnector?displayProperty=nameWithType> реализует интерфейс.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-146">The partial class extends from the appropriate base class (such as <xref:System.Windows.Controls.Page> for a page) and implements the <xref:System.Windows.Markup.IComponentConnector?displayProperty=nameWithType> interface.</span></span> <span data-ttu-id="e0a8c-147"><xref:System.Windows.Markup.IComponentConnector> Интерфейс имеет методы для инициализации компонента и подключения имен и событий к элементам в его содержимом.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-147">The <xref:System.Windows.Markup.IComponentConnector> interface has methods to initialize a component and connect names and events on elements in its content.</span></span> <span data-ttu-id="e0a8c-148">Следовательно, в созданном файле кода имеется реализация метода, подобная следующей:</span><span class="sxs-lookup"><span data-stu-id="e0a8c-148">Consequently, the generated code file has a method implementation like the following:</span></span>

```csharp
public void InitializeComponent() {
    if (_contentLoaded) {
        return;
    }
    _contentLoaded = true;
    System.Uri resourceLocater =
        new System.Uri(
            "window1.xaml",
            System.UriKind.RelativeOrAbsolute);
    System.Windows.Application.LoadComponent(this, resourceLocater);
}
```

```vb
Public Sub InitializeComponent() _

    If _contentLoaded Then
        Return
    End If

    _contentLoaded = True
    Dim resourceLocater As System.Uri = _
        New System.Uri("mainwindow.xaml", System.UriKind.Relative)

    System.Windows.Application.LoadComponent(Me, resourceLocater)

End Sub
```

<span data-ttu-id="e0a8c-149">По умолчанию компиляция разметки выполняется в том <xref:System.AppDomain> же виде, что и модуль MSBuild.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-149">By default, markup compilation runs in the same <xref:System.AppDomain> as the MSBuild engine.</span></span> <span data-ttu-id="e0a8c-150">Это обеспечивает значительный выигрыш в производительности.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-150">This provides significant performance gains.</span></span> <span data-ttu-id="e0a8c-151">Это поведение можно переключать с помощью свойства `AlwaysCompileMarkupFilesInSeparateDomain`.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-151">This behavior can be toggled with the `AlwaysCompileMarkupFilesInSeparateDomain` property.</span></span> <span data-ttu-id="e0a8c-152">Это имеет преимущество выгрузки всех ссылочных сборок путем выгрузки отдельного <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-152">This has the advantage of unloading all reference assemblies by unloading the separate <xref:System.AppDomain>.</span></span>

<a name="Pass_2_of_Markup_Compilation"></a>

### <a name="markup-compilationpass-2"></a><span data-ttu-id="e0a8c-153">Компиляция разметки — шаг 2</span><span class="sxs-lookup"><span data-stu-id="e0a8c-153">Markup Compilation—Pass 2</span></span>

<span data-ttu-id="e0a8c-154">Не все страницы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] компилируются на шаге 1 компиляции разметки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-154">Not all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages are compiled at during pass 1 of markup compilation.</span></span> <span data-ttu-id="e0a8c-155">Файлы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], имеющие локально определенные ссылки на типы (ссылки на типы, определенные где-либо в коде того же проекта), исключаются из компиляции на этом шаге.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-155">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files that have locally defined type references (references to types defined in code elsewhere in the same project) are exempt from compilation at this time.</span></span> <span data-ttu-id="e0a8c-156">Причина заключается в том, что эти локально определенные типы существуют только в источнике и еще не скомпилированы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-156">This is because those locally defined types exist only in source and have not yet been compiled.</span></span> <span data-ttu-id="e0a8c-157">Чтобы определить это, синтаксический анализатор использует эвристику, которая включает поиск элементов, таких как `x:Name`, в файле разметки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-157">In order to determine this, the parser uses heuristics that involve looking for items such as `x:Name` in the markup file.</span></span> <span data-ttu-id="e0a8c-158">При обнаружении такого экземпляра компиляция этого файла разметки откладывается, пока не будут скомпилированы файлы кода, после чего второй этап компиляции разметки обрабатывает эти файлы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-158">When such an instance is found, that markup file’s compilation is postponed until the code files have been compiled, after which, the second markup compilation pass processes these files.</span></span>

<a name="File_Classification"></a>

### <a name="file-classification"></a><span data-ttu-id="e0a8c-159">Классификация файлов</span><span class="sxs-lookup"><span data-stu-id="e0a8c-159">File Classification</span></span>

<span data-ttu-id="e0a8c-160">Процесс сборки помещает выходные файлы в различные группы ресурсов на основе того, в какую сборку приложения они будут помещены.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-160">The build process puts output files into different resource groups based on which application assembly they will be placed in.</span></span> <span data-ttu-id="e0a8c-161">В обычном нелокализованном приложении все файлы данных, отмеченные как `Resource`, помещаются в главную сборку (исполняемый файл или библиотеку).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-161">In a typical nonlocalized application, all data files marked as `Resource` are placed in the main assembly (executable or library).</span></span> <span data-ttu-id="e0a8c-162">Когда в проекте задается `UICulture`, все скомпилированные файлы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] и ресурсы, специально отмеченные как языковые, помещаются во вспомогательную сборку ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-162">When `UICulture` is set in the project, all compiled [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files and those resources specifically marked as language-specific are placed in the satellite resource assembly.</span></span> <span data-ttu-id="e0a8c-163">Кроме того, все независящие от языка ресурсы помещаются в главную сборку.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-163">Furthermore, all language-neutral resources are placed in the main assembly.</span></span> <span data-ttu-id="e0a8c-164">На этом шаге процесса сборки принимается это решение.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-164">In this step of the build process, that determination is made.</span></span>

<span data-ttu-id="e0a8c-165">Действия сборки `ApplicationDefinition`, `Page` и `Resource` в файле проекта могут быть дополнены метаданными `Localizable` (допустимые значения — `true` и `false`), которые определяют, зависит ли этот файл от языка.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-165">The `ApplicationDefinition`, `Page`, and `Resource` build actions in the project file can be augmented with the `Localizable` metadata (acceptable values are `true` and `false`), which dictates whether the file is language-specific or language-neutral.</span></span>

<a name="Core_Compilation"></a>

### <a name="core-compilation"></a><span data-ttu-id="e0a8c-166">Основная компиляция</span><span class="sxs-lookup"><span data-stu-id="e0a8c-166">Core Compilation</span></span>

<span data-ttu-id="e0a8c-167">На этапе основной компиляции выполняется компиляция файлов кода.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-167">The core compile step involves compilation of code files.</span></span> <span data-ttu-id="e0a8c-168">Это управляется логикой в языковых файлах целей сборки Microsoft.CSharp.targets и Microsoft.VisualBasic.targets.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-168">This is orchestrated by logic in the language-specific targets files Microsoft.CSharp.targets and Microsoft.VisualBasic.targets.</span></span> <span data-ttu-id="e0a8c-169">Если эвристика определила, что первого этапа компилятора разметки достаточно, то создается главная сборка.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-169">If heuristics have determined that a single pass of the markup compiler is sufficient, then the main assembly is generated.</span></span> <span data-ttu-id="e0a8c-170">Однако если один или несколько файлов [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] в проекте имеют ссылки на локально определенные типы, то создается временный DLL-файл, чтобы могли быть созданы окончательные сборки приложения по завершении второго этапа компиляции разметки.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-170">However, if one or more [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files in the project have references to locally defined types, then a temporary .dll file is generated so the final application assemblies may be created after the second pass of markup compilation is complete.</span></span>

<a name="Manifest_generation"></a>

### <a name="manifest-generation"></a><span data-ttu-id="e0a8c-171">Создание манифеста</span><span class="sxs-lookup"><span data-stu-id="e0a8c-171">Manifest Generation</span></span>

<span data-ttu-id="e0a8c-172">После завершения процесса сборки, после того как все сборки приложения и файлы содержимого будут готовы, создаются манифесты ClickOnce для приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-172">At the end of the build process, after all the application assemblies and content files are ready, the ClickOnce manifests for the application are generated.</span></span>

<span data-ttu-id="e0a8c-173">Файл манифеста развертывания описывает модель развертывания: текущую версию, поведение обновления и идентификатор издателя вместе с цифровой подписью.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-173">The deployment manifest file describes the deployment model: the current version, update behavior, and publisher identity along with digital signature.</span></span> <span data-ttu-id="e0a8c-174">Этот манифест должен создаваться администраторами, управляющими развертыванием.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-174">This manifest is intended to be authored by administrators who handle deployment.</span></span> <span data-ttu-id="e0a8c-175">Файл имеет расширение .xbap (для [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)]) и .application для установленных приложений.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-175">The file extension is .xbap (for [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)]) and .application for installed applications.</span></span> <span data-ttu-id="e0a8c-176">Первое диктуется свойством проекта `HostInBrowser`, и в результате манифест идентифицирует приложение как браузерное.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-176">The former is dictated by the `HostInBrowser` project property and as a result the manifest identifies the application as browser-hosted.</span></span>

<span data-ttu-id="e0a8c-177">Манифест приложения (файл .exe.manifest) описывает сборки приложения и зависимые библиотеки, а также перечисляет разрешения, необходимые для приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-177">The application manifest (an .exe.manifest file) describes the application assemblies and dependent libraries and lists permissions required by the application.</span></span> <span data-ttu-id="e0a8c-178">Этот файл должен быть создан разработчиком приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-178">This file is intended to be authored by the application developer.</span></span> <span data-ttu-id="e0a8c-179">Чтобы запустить приложение ClickOnce, пользователь открывает файл манифеста развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-179">In order to launch a ClickOnce application, a user opens the application's deployment manifest file.</span></span>

<span data-ttu-id="e0a8c-180">Эти файлы манифеста всегда создаются для [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0a8c-180">These manifest files are always created for [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)].</span></span> <span data-ttu-id="e0a8c-181">Для установленных приложений они не создаются, если в файле проекта не будет задано свойство `GenerateManifests` со значением `true`.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-181">For installed applications, they are not created unless the `GenerateManifests` property is specified in the project file with value `true`.</span></span>

[!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)]<span data-ttu-id="e0a8c-182">получите два дополнительных разрешения выше и выше этих разрешений, назначенных типичным приложениям зоны <xref:System.Security.Permissions.WebBrowserPermission> Интернета <xref:System.Security.Permissions.MediaPermission>: и.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-182">get two additional permissions over and above those permissions assigned to typical Internet zone applications: <xref:System.Security.Permissions.WebBrowserPermission> and <xref:System.Security.Permissions.MediaPermission>.</span></span> <span data-ttu-id="e0a8c-183">Система сборки [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] объявляет эти разрешения в манифесте приложения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-183">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] build system declares those permissions in the application manifest.</span></span>

<a name="Incremental_Build_Support"></a>

## <a name="incremental-build-support"></a><span data-ttu-id="e0a8c-184">Добавочная сборка</span><span class="sxs-lookup"><span data-stu-id="e0a8c-184">Incremental Build Support</span></span>

<span data-ttu-id="e0a8c-185">Система сборки [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] обеспечивает поддержку добавочных сборок.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-185">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] build system provides support for incremental builds.</span></span> <span data-ttu-id="e0a8c-186">Она достаточно интеллектуально обнаруживает изменения, внесенные в разметку или код, и компилирует только те артефакты, на которые повлияло изменение.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-186">It is fairly intelligent about detecting changes made to markup or code, and it compiles only those artifacts affected by the change.</span></span> <span data-ttu-id="e0a8c-187">Механизм добавочной сборки использует следующие файлы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-187">The incremental build mechanism uses the following files:</span></span>

- <span data-ttu-id="e0a8c-188">Файл $(*AssemblyName*)_MarkupCompiler.Cache для сохранения текущего состояния компилятора.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-188">An $(*AssemblyName*)_MarkupCompiler.Cache file to maintain current compiler state.</span></span>

- <span data-ttu-id="e0a8c-189">Файл $(*AssemblyName*)_MarkupCompiler.lref для кэширования файлов [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] со ссылками на локально определенные типы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-189">An $(*AssemblyName*)_MarkupCompiler.lref file to cache the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files with references to locally defined types.</span></span>

<span data-ttu-id="e0a8c-190">Ниже приведен набор правил, управляющих добавочной сборкой.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-190">The following is a set of rules governing incremental build:</span></span>

- <span data-ttu-id="e0a8c-191">Файл — это наименьшая единица, в которой система сборки обнаруживает изменения.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-191">The file is the smallest unit at which the build system detects change.</span></span> <span data-ttu-id="e0a8c-192">Таким образом, для файла кода система сборки не может узнать, был ли изменен тип или добавлен код.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-192">So, for a code file, the build system cannot tell if a type was changed or if code was added.</span></span> <span data-ttu-id="e0a8c-193">То же самое относится и к файлам проекта.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-193">The same holds for project files.</span></span>

- <span data-ttu-id="e0a8c-194">Механизм добавочной сборки должен знать, что страница [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] либо определяет класс, либо использует другие классы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-194">The incremental build mechanism must be cognizant that a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] page either defines a class or uses other classes.</span></span>

- <span data-ttu-id="e0a8c-195">Если изменены записи `Reference`, то перекомпилируются все страницы.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-195">If `Reference` entries change, then recompile all pages.</span></span>

- <span data-ttu-id="e0a8c-196">При изменении файла кода перекомпилируются все страницы с локально определенными ссылками типа.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-196">If a code file changes, recompile all pages with locally defined type references.</span></span>

- <span data-ttu-id="e0a8c-197">Если изменяется файл [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="e0a8c-197">If a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file changes:</span></span>

  - <span data-ttu-id="e0a8c-198">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] объявляется как `Page` в проекте: если [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] не имеет локально определенных ссылок на типы, перекомпилируется этот [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] плюс все страницы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с локальными ссылками; если [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] имеет локальные ссылки, перекомпилируются все страницы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с локальными ссылками.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-198">If [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] is declared as `Page` in the project: if the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] does not have locally defined type references, recompile that [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] plus all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references; if the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] has local references, recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references.</span></span>

  - <span data-ttu-id="e0a8c-199">Если [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] объявляется как `ApplicationDefinition` в проекте: перекомпилируются все [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] страницы <xref:System.Windows.Application> (причина: Каждая [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] содержит ссылку на тип, который мог быть изменен).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-199">If [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] is declared as `ApplicationDefinition` in the project: recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages (reason: each [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] has reference to an <xref:System.Windows.Application> type that may have changed).</span></span>

- <span data-ttu-id="e0a8c-200">Если файл проекта объявляет файл кода как определение приложения вместо файла [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="e0a8c-200">If the project file declares a code file as application definition instead of a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file:</span></span>

  - <span data-ttu-id="e0a8c-201">Проверьте, изменилось ли значение `ApplicationClassName` в файле проекта (появился ли новый тип приложения).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-201">Check if the `ApplicationClassName` value in the project file has changed (is there a new application type?).</span></span> <span data-ttu-id="e0a8c-202">Если да, перекомпилируйте все приложение.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-202">If so, recompile the entire application.</span></span>

  - <span data-ttu-id="e0a8c-203">В противном случае перекомпилируйте все страницы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] с локальными ссылками.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-203">Otherwise, recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references.</span></span>

- <span data-ttu-id="e0a8c-204">При изменении файла проекта: примените все вышеперечисленные правила и посмотрите, что нужно перекомпилировать.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-204">If a project file changes: apply all preceding rules and see what needs to be recompiled.</span></span> <span data-ttu-id="e0a8c-205">Изменения следующих свойств приводят к полной перекомпиляции: `AssemblyName`, `IntermediateOutputPath`, `RootNamespace` и `HostInBrowser`.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-205">Changes to the following properties trigger a complete recompile: `AssemblyName`, `IntermediateOutputPath`, `RootNamespace`, and `HostInBrowser`.</span></span>

<span data-ttu-id="e0a8c-206">Возможны следующие сценарии перекомпиляции.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-206">The following recompile scenarios are possible:</span></span>

- <span data-ttu-id="e0a8c-207">Перекомпилируется все приложение.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-207">The entire application is recompiled.</span></span>

- <span data-ttu-id="e0a8c-208">Перекомпилируются только те файлы [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], в которых есть локально определенные ссылки типа.</span><span class="sxs-lookup"><span data-stu-id="e0a8c-208">Only those [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files that have locally defined type references are recompiled.</span></span>

- <span data-ttu-id="e0a8c-209">Ничего не перекомпилируется (если в проекте ничего не изменялось).</span><span class="sxs-lookup"><span data-stu-id="e0a8c-209">Nothing is recompiled (if nothing in the project has changed).</span></span>

## <a name="see-also"></a><span data-ttu-id="e0a8c-210">См. также</span><span class="sxs-lookup"><span data-stu-id="e0a8c-210">See also</span></span>

- [<span data-ttu-id="e0a8c-211">Развертывание приложений WPF</span><span class="sxs-lookup"><span data-stu-id="e0a8c-211">Deploying a WPF Application</span></span>](deploying-a-wpf-application-wpf.md)
- [<span data-ttu-id="e0a8c-212">Справочные сведения о WPF для MSBuild</span><span class="sxs-lookup"><span data-stu-id="e0a8c-212">WPF MSBuild Reference</span></span>](/visualstudio/msbuild/wpf-msbuild-reference)
- [<span data-ttu-id="e0a8c-213">URI типа "pack" в WPF</span><span class="sxs-lookup"><span data-stu-id="e0a8c-213">Pack URIs in WPF</span></span>](pack-uris-in-wpf.md)
- [<span data-ttu-id="e0a8c-214">Файлы ресурсов, содержимого и данных WPF-приложения</span><span class="sxs-lookup"><span data-stu-id="e0a8c-214">WPF Application Resource, Content, and Data Files</span></span>](wpf-application-resource-content-and-data-files.md)
