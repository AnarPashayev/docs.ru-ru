---
title: Упрощение отладки в .NET изображения
description: Узнайте, как настроить исполняемый образ, для упрощения отладки с помощью интегрированной среды разработки параметров и параметров командной строки.
ms.date: 08/30/2018
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 5bab707afb059d4fcbd46a9ee54edead991be523
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61754223"
---
# <a name="making-an-image-easier-to-debug-in-net"></a><span data-ttu-id="a0ac7-103">Упрощение отладки в .NET изображения</span><span class="sxs-lookup"><span data-stu-id="a0ac7-103">Making an image easier to debug in .NET</span></span>

<span data-ttu-id="a0ac7-104">При компиляции неуправляемого кода можно настроить исполняемый образ для отладки, задав параметры командной строки или интегрированной среды разработки.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-104">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="a0ac7-105">Например, параметр командной строки /**Zi** в Visual C++ служит для создания файлов с отладочными символами (с расширением PDB).</span><span class="sxs-lookup"><span data-stu-id="a0ac7-105">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="a0ac7-106">Аналогичным образом параметр командной строки /**Od** отключает оптимизацию компилятора.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-106">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="a0ac7-107">Результирующий код работает медленно, но это упрощает отладку, необходимости.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-107">The resulting code runs more slowly, but it's easier to debug, should this be necessary.</span></span>

<span data-ttu-id="a0ac7-108">При компиляции .NET Framework управляемый код, компиляторы, такие как Visual C++, Visual Basic и C# компилируют исходную программу в промежуточный язык Майкрософт (MSIL).</span><span class="sxs-lookup"><span data-stu-id="a0ac7-108">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft intermediate language (MSIL).</span></span> <span data-ttu-id="a0ac7-109">Код MSIL будет JIT-компиляции, перед выполнением в машинный код.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-109">MSIL is then JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="a0ac7-110">Как и в случае с неуправляемым кодом, можно настроить исполняемый образ для отладки, задав параметры командной строки или интегрированной среды разработки.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-110">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="a0ac7-111">Также можно настроить для отладки в так же JIT-компиляцию.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-111">You can also configure the JIT compilation for debugging in much the same way.</span></span>

<span data-ttu-id="a0ac7-112">Данная JIT-конфигурация имеет два аспекта.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-112">This JIT configuration has two aspects:</span></span>

- <span data-ttu-id="a0ac7-113">Вы можете запросить JIT-компилятор для создания сведений об отслеживании.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-113">You can request the JIT compiler to generate tracking information.</span></span> <span data-ttu-id="a0ac7-114">После этого отладчик сможет сопоставлять цепочки команд MSIL с соответствующими командами машинного кода, а также отслеживать место хранения локальных переменных и аргументов функций.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-114">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span> <span data-ttu-id="a0ac7-115">Начиная с .NET Framework версии 2.0 JIT-компилятор всегда создает сведения об отслеживании, поэтому нет необходимости для запроса.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-115">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information, so there is no need to request it.</span></span>

- <span data-ttu-id="a0ac7-116">Вы можете запросить JIT-компилятор, можно отключить оптимизацию получившегося машинного кода.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-116">You can request the JIT compiler to not optimize the resulting machine code.</span></span>

<span data-ttu-id="a0ac7-117">Как правило, компилятор, создающим код MSIL задает эти параметры компилятора JIT соответствующим образом, в зависимости от интегрированной среды разработки параметры командной строки или указать, например, /**Od**.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-117">Normally, the compiler that generates the MSIL sets these JIT compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>

<span data-ttu-id="a0ac7-118">В некоторых случаях может возникнуть необходимость изменить поведение JIT-компилятора, чтобы создаваемый машинный код было проще отлаживать.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-118">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="a0ac7-119">Например, для окончательной сборки или оптимизации управления может потребоваться создать сведения о JIT-отслеживании.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-119">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="a0ac7-120">Это можно сделать с помощью файла инициализации (INI).</span><span class="sxs-lookup"><span data-stu-id="a0ac7-120">You can do so with an initialization (.ini) file.</span></span>

<span data-ttu-id="a0ac7-121">Например, если сборки, необходимо выполнить отладку называется *MyApp.exe*, то можно создать текстовый файл с именем *MyApp.ini*, в той же папке, что *MyApp.exe*, который содержит Эти три строки:</span><span class="sxs-lookup"><span data-stu-id="a0ac7-121">For example, if the assembly you want to debug is called *MyApp.exe*, then you can create a text file named *MyApp.ini*, in the same folder as *MyApp.exe*, which contains these three lines:</span></span>

```ini
[.NET Framework Debugging Control]
GenerateTrackingInfo=1
AllowOptimize=0
```

<span data-ttu-id="a0ac7-122">Значением каждого параметра может быть 0 или 1; отсутствующие параметры получают значение 0.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-122">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="a0ac7-123">Для упрощения отладки значение `GenerateTrackingInfo` должно быть равным 1, а значение `AllowOptimize` — 0.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-123">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>

<span data-ttu-id="a0ac7-124">Начиная с .NET Framework версии 2.0 JIT-компилятор всегда генерирует сведения об отслеживании независимо от значения для `GenerateTrackingInfo`, однако `AllowOptimize` значение еще действует.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-124">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="a0ac7-125">При использовании [Ngen.exe (средства для создания образов в машинном коде)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) для предварительной компиляции образа в машинном коде без оптимизации INI-файл, содержащий параметр `AllowOptimize=0`, должен находиться в целевой папке во время выполнения Ngen.exe.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-125">When using the [Ngen.exe (Native Image Generator)](../../../docs/framework/tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="a0ac7-126">Если имеет предкомпилированные сборки без оптимизации, необходимо удалить предварительно скомпилированный код, с помощью NGen.exe **/ uninstall** параметр прежде чем перезапускать Ngen.exe для предварительной компиляции оптимизированного кода.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-126">If you have precompiled an assembly without optimization, you must remove the precompiled code using NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="a0ac7-127">Если INI-файл отсутствует в папке, по умолчанию Ngen.exe предварительно компилирует код как оптимизированный.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-127">If the .ini file isn't present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>

<span data-ttu-id="a0ac7-128"><xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> управляет параметрами для сборки.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-128">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="a0ac7-129">**DebuggableAttribute** включает два поля, управляющие ли JIT-компилятор следует оптимизировать и/или создает данные для отслеживания.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-129">**DebuggableAttribute** includes two fields that control whether the JIT compiler should optimize and/or generate tracking information.</span></span> <span data-ttu-id="a0ac7-130">Начиная с .NET Framework версии 2.0 JIT-компилятор всегда генерирует сведения об отслеживании.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-130">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information.</span></span>

<span data-ttu-id="a0ac7-131">Для окончательных сборок компиляторы не устанавливать любые **DebuggableAttribute**.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-131">For a retail build, compilers don't set any **DebuggableAttribute**.</span></span> <span data-ttu-id="a0ac7-132">По умолчанию JIT-компилятор создает высокую производительность, затрудняет отладку машинного кода.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-132">By default, the JIT compiler generates the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="a0ac7-133">Включение JIT-отслеживания несколько снижает производительность; отключение оптимизации снижает производительность значительно.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-133">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>

<span data-ttu-id="a0ac7-134">**DebuggableAttribute** одновременно применяется ко всей сборке, а не к ее отдельным модулям.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-134">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="a0ac7-135">Средства разработки должны, таким образом, подключать пользовательские атрибуты к классу **System.Runtime.CompilerServices.AssemblyAttributesGoHere** или, если сборка уже создана, к токену метаданных сборки.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-135">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="a0ac7-136">Средство ALink активизируется эти **DebuggableAttribute** атрибуты из каждого модуля в сборку, они становятся частью.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-136">The ALink tool then promotes these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="a0ac7-137">Если возникает конфликт, сбой операции ALink.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-137">If there's a conflict, the ALink operation fails.</span></span>

> [!NOTE]
> <span data-ttu-id="a0ac7-138">В .NET Framework версии 1.0 **DebuggableAttribute** добавляется компилятором Microsoft Visual C++, если указаны параметры компилятора **/clr** и **/Zi**.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-138">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="a0ac7-139">В версии 1.1 платформы .NET Framework, необходимо добавить **DebuggableAttribute** вручную в коде или используйте **/ASSEMBLYDEBUG** параметр компоновщика.</span><span class="sxs-lookup"><span data-stu-id="a0ac7-139">In version 1.1 of the .NET Framework, you must either add the **DebuggableAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>

## <a name="see-also"></a><span data-ttu-id="a0ac7-140">См. также</span><span class="sxs-lookup"><span data-stu-id="a0ac7-140">See also</span></span>

- [<span data-ttu-id="a0ac7-141">Отладка, трассировка и профилирование</span><span class="sxs-lookup"><span data-stu-id="a0ac7-141">Debugging, Tracing, and Profiling</span></span>](../../../docs/framework/debug-trace-profile/index.md)
- [<span data-ttu-id="a0ac7-142">Включение отладки с JIT-присоединением</span><span class="sxs-lookup"><span data-stu-id="a0ac7-142">Enabling JIT-Attach Debugging</span></span>](../../../docs/framework/debug-trace-profile/enabling-jit-attach-debugging.md)
- <span data-ttu-id="a0ac7-143">[Включение профилирования](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="a0ac7-143">[Enabling Profiling](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span></span>
