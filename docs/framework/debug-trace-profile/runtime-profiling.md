---
title: Профилирование среды выполнения
ms.date: 03/30/2017
helpviewer_keywords:
- performance counters
- common language runtime, profiling
- Perfmon.exe
- System Monitor
- profiling
- runtime, profiling
- profiling applications
- Performance Console
ms.assetid: ccd68284-f3a8-47b8-bc3f-92e5fe3a1640
ms.openlocfilehash: daa2ae4fbbed78bda4648b4b3077fa7d96a9b3f3
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73121566"
---
# <a name="runtime-profiling"></a>Профилирование среды выполнения
Профилирование представляет собой метод сбора данных по производительности в любом сценарии разработки или развертывания. Это раздел представляет интерес для разработчиков и системных администраторов, которые хотят получить сведения о производительности приложения.  
  
## <a name="tracking-performance-using-the-performance-monitor-perfmonexe"></a>Отслеживание производительности с использованием системного монитора (Perfmon.exe)  
 Системный монитор — это самый простой инструмент для профилирования приложения .NET Framework. Монитор производительности графически представляет данные, найденные в счетчиках производительности .NET Framework, которые устанавливаются вместе со средой CLR и Windows SDK. Эти счетчики можно использовать для контроля всех параметров, начиная с управления памятью и заканчивая производительностью JIT-компилятора. Они сообщают об используемых приложением ресурсах, которые являются косвенным показателем производительности. Используйте эти счетчики, чтобы понять, как приложение работает внутри.  
  
#### <a name="to-run-perfmonexe-on-windows-vista-and-later-versions"></a>Запуск Perfmon.exe в Windows Vista и более поздних версиях  
  
1. В командной строке введите **perfmon**. Появится консоль **системного монитора** .  
  
2. В папке **Средства наблюдения** нажмите **Системный монитор**.  
  
3. На панели инструментов "Системный монитор" щелкните значок **Добавить** (знак "плюс"), если он присутствует. Если этот значок не отображается, щелкните правой кнопкой мыши в окне монитора и выберите команду **Добавить счетчики** .  
  
     Откроется диалоговое окно **Добавить счетчики** . В списке **Имеющиеся счетчики** приводятся доступные объекты производительности. Для приложений .NET Framework имеется ряд предварительно определенных объектов, в том числе объекты для управления памятью (**Память CLR .NET**), взаимодействия (**Взаимодействие CLR .NET**), обработки исключений (**Исключения CLR .NET**) и многопоточности (**Блокировки и потоки CLR .NET**). Каждый объект производительности включает ряд отдельных счетчиков производительности. Список счетчиков производительности, доступных в системном мониторе, см. в разделе [Performance Counters](performance-counters.md).  
  
4. Установите флажок рядом с именем объекта производительности, чтобы просмотреть список счетчиков, которые он поддерживает.  
  
5. Щелкните нужный счетчик производительности.  
  
6. В списке **Экземпляры выбранного объекта** выберите пункт **\<Все экземпляры**, чтобы указать, что необходимо выполнять глобальное наблюдение за счетчиком производительности для среды CLR (то есть на уровне системы).  
  
     \- или -  
  
     В списке **Экземпляры выбранного объекта** щелкните имя приложения, чтобы отслеживать счетчик производительности для него.  
  
     Для различения нескольких версий среды выполнения или устранения неоднозначности между несколькими приложениями с одним и тем же именем необходимо также изменить раздел реестра. Для получения дополнительной информации см. [Performance Counters and In-Process Side-By-Side Applications](performance-counters-and-in-process-side-by-side-applications.md).  
  
> [!NOTE]
> Если новые счетчики производительности были установлены при работающем системном мониторе, остановите системный монитор и перезапустите его, чтобы новые счетчики стали видны.  
  
 Если нужно профилировать сборку, существующую в зоне или в удаленном общем ресурсе, убедитесь в том, что удаленная сборка является полностью доверенной на компьютере с работающими счетчиками производительности. Если сборка не обладает достаточным уровнем доверия, счетчики производительности работать не будут. Сведения о предоставлении доверия различным зонам см. в разделе [Caspol.exe (средство настройки политики управления доступом для кода)](../tools/caspol-exe-code-access-security-policy-tool.md).  
  
> [!NOTE]
> В системах, где установлена .NET Framework 4, системный монитор может не отображать данные счетчиков производительности в некоторых категориях, таких как **данные .NET CLR** и **сети .NET CLR**, для приложений, разработанных с помощью .NET. Framework 1,1. Если это так, можно настроить монитор производительности для отображения этих данных, добавив элемент [\<forcePerformanceCounterUniqueSharedMemoryReads>](../configure-apps/file-schema/runtime/forceperformancecounteruniquesharedmemoryreads-element.md) в файле конфигурации приложения.  
  
## <a name="reading-and-creating-performance-counters-programmatically"></a>Считывание данных и создание счетчиков производительности программным способом  
 .NET Framework предоставляет классы, которые можно использовать для программного доступа к тем же сведениям о производительности, которые доступны в консоли производительности. Эти классы можно также использовать для создания пользовательских счетчиков производительности. В следующей таблице описаны некоторые классы наблюдения за производительностью, предоставляемые в .NET Framework.  
  
|Class|Описание|  
|-----------|-----------------|  
|<xref:System.Diagnostics.PerformanceCounter?displayProperty=nameWithType>|Представляет компонент счетчика производительности Windows NT. Этот класс используется для чтения существующих предварительно определенных или пользовательских счетчиков и публикации (записи) данных производительности в пользовательские счетчики.|  
|<xref:System.Diagnostics.PerformanceCounterCategory?displayProperty=nameWithType>|Предоставляет ряд методов для взаимодействия со счетчиками и категориями счетчиков на компьютере.|  
|<xref:System.Diagnostics.PerformanceCounterInstaller?displayProperty=nameWithType>|Задает установщик для компонента `PerformanceCounter` .|  
|<xref:System.Diagnostics.PerformanceCounterType?displayProperty=nameWithType>|Задает формулу для вычисления метода `NextValue` для `PerformanceCounter`.|  
  
## <a name="see-also"></a>См. также

- [Счетчики производительности](performance-counters.md)
