---
title: Профилирование среды выполнения
ms.date: 03/30/2017
helpviewer_keywords:
- performance counters
- common language runtime, profiling
- Perfmon.exe
- System Monitor
- profiling
- runtime, profiling
- profiling applications
- Performance Console
ms.assetid: ccd68284-f3a8-47b8-bc3f-92e5fe3a1640
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 9d50ece4b800b77ac0447d1f22f1929f5a38a7d9
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59306395"
---
# <a name="runtime-profiling"></a><span data-ttu-id="3c38f-102">Профилирование среды выполнения</span><span class="sxs-lookup"><span data-stu-id="3c38f-102">Runtime Profiling</span></span>
<span data-ttu-id="3c38f-103">Профилирование представляет собой метод сбора данных по производительности в любом сценарии разработки или развертывания.</span><span class="sxs-lookup"><span data-stu-id="3c38f-103">Profiling is a method of gathering performance data in any development or deployment scenario.</span></span> <span data-ttu-id="3c38f-104">Это раздел представляет интерес для разработчиков и системных администраторов, которые хотят получить сведения о производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="3c38f-104">This section is for developers and system administrators who want to gather information about application performance.</span></span>  
  
## <a name="tracking-performance-using-the-performance-monitor-perfmonexe"></a><span data-ttu-id="3c38f-105">Отслеживание производительности с использованием системного монитора (Perfmon.exe)</span><span class="sxs-lookup"><span data-stu-id="3c38f-105">Tracking Performance Using the Performance Monitor (Perfmon.exe)</span></span>  
 <span data-ttu-id="3c38f-106">Системный монитор — самое удобное средство для профилирования приложений [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="3c38f-106">The Performance Monitor is the easiest tool to use to profile your [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] application.</span></span> <span data-ttu-id="3c38f-107">Системный монитор содержит графическое представление данных счетчиков производительности платформы .NET Framework, установленных вместе со средой CLR и [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3c38f-107">The Performance Monitor graphically represents data found in the .NET Framework performance counters that are installed with the common language runtime and the [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)].</span></span> <span data-ttu-id="3c38f-108">Эти счетчики можно использовать для контроля всех параметров, начиная с управления памятью и заканчивая производительностью JIT-компилятора.</span><span class="sxs-lookup"><span data-stu-id="3c38f-108">These counters can be used to monitor everything from memory management to just-in-time (JIT) compiler performance.</span></span> <span data-ttu-id="3c38f-109">Они сообщают об используемых приложением ресурсах, которые являются косвенным показателем производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-109">They tell you about the resources your application uses, which is an indirect measure of your application's performance.</span></span> <span data-ttu-id="3c38f-110">Используйте эти счетчики, чтобы понять, как приложение работает внутри.</span><span class="sxs-lookup"><span data-stu-id="3c38f-110">Use these counters to understand how your application works internally.</span></span>  
  
#### <a name="to-run-perfmonexe-on-windows-vista-and-later-versions"></a><span data-ttu-id="3c38f-111">Запуск Perfmon.exe в Windows Vista и более поздних версиях</span><span class="sxs-lookup"><span data-stu-id="3c38f-111">To run Perfmon.exe on Windows Vista and later versions</span></span>  
  
1. <span data-ttu-id="3c38f-112">В командной строке введите **perfmon**.</span><span class="sxs-lookup"><span data-stu-id="3c38f-112">At the command prompt, type **perfmon**.</span></span> <span data-ttu-id="3c38f-113">Появится консоль **системного монитора** .</span><span class="sxs-lookup"><span data-stu-id="3c38f-113">The **Performance Monitor** console appears.</span></span>  
  
2. <span data-ttu-id="3c38f-114">В папке **Средства наблюдения** нажмите **Системный монитор**.</span><span class="sxs-lookup"><span data-stu-id="3c38f-114">In the **Monitoring Tools** folder, click **Performance Monitor**.</span></span>  
  
3. <span data-ttu-id="3c38f-115">На панели инструментов "Системный монитор" щелкните значок **Добавить** (знак "плюс"), если он присутствует.</span><span class="sxs-lookup"><span data-stu-id="3c38f-115">In the Performance Monitor toolbar, click the **Add** icon (the plus sign), if it is present.</span></span> <span data-ttu-id="3c38f-116">Если этот значок не отображается, щелкните правой кнопкой мыши в окне монитора и выберите команду **Добавить счетчики** .</span><span class="sxs-lookup"><span data-stu-id="3c38f-116">If it is not present, right-click in the monitor window and select the **Add Counters** option.</span></span>  
  
     <span data-ttu-id="3c38f-117">Откроется диалоговое окно **Добавить счетчики** .</span><span class="sxs-lookup"><span data-stu-id="3c38f-117">This opens the **Add Counters** dialog box.</span></span> <span data-ttu-id="3c38f-118">В списке **Имеющиеся счетчики** приводятся доступные объекты производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-118">The **Available counters** list box displays the available performance objects.</span></span> <span data-ttu-id="3c38f-119">Для приложений .NET Framework имеется ряд предварительно определенных объектов, в том числе объекты для управления памятью (**Память CLR .NET**), взаимодействия (**Взаимодействие CLR .NET**), обработки исключений (**Исключения CLR .NET**) и многопоточности (**Блокировки и потоки CLR .NET**).</span><span class="sxs-lookup"><span data-stu-id="3c38f-119">There are a number of predefined objects for .NET Framework applications, including those for memory management (**.NET CLR Memory**), interoperability (**.NET CLR Interop**), exception handling (**.NET CLR Exceptions**), and multithreading (**.NET CLR LocksAndThreads**).</span></span> <span data-ttu-id="3c38f-120">Каждый объект производительности включает ряд отдельных счетчиков производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-120">Each performance object includes a number of individual performance counters.</span></span> <span data-ttu-id="3c38f-121">Список счетчиков производительности, доступных в системном мониторе, см. в разделе [Performance Counters](../../../docs/framework/debug-trace-profile/performance-counters.md).</span><span class="sxs-lookup"><span data-stu-id="3c38f-121">For a list of the performance counters available in Performance Monitor, see [Performance Counters](../../../docs/framework/debug-trace-profile/performance-counters.md).</span></span>  
  
4. <span data-ttu-id="3c38f-122">Установите флажок рядом с именем объекта производительности, чтобы просмотреть список счетчиков, которые он поддерживает.</span><span class="sxs-lookup"><span data-stu-id="3c38f-122">Select the check box next to a performance object's name to view the list of individual performance counters that it supports.</span></span>  
  
5. <span data-ttu-id="3c38f-123">Щелкните нужный счетчик производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-123">Click the performance counter you want to view.</span></span>  
  
6. <span data-ttu-id="3c38f-124">В списке **Экземпляры выбранного объекта** выберите пункт **\<Все экземпляры**, чтобы указать, что необходимо выполнять глобальное наблюдение за счетчиком производительности для среды CLR (то есть на уровне системы).</span><span class="sxs-lookup"><span data-stu-id="3c38f-124">In the **Instances of selected object** list box, click **\<All instances>** to specify that you want to monitor the performance counter for the common language runtime globally (that is, on a system-wide basis).</span></span>  
  
     <span data-ttu-id="3c38f-125">-или-</span><span class="sxs-lookup"><span data-stu-id="3c38f-125">-or-</span></span>  
  
     <span data-ttu-id="3c38f-126">В списке **Экземпляры выбранного объекта** щелкните имя приложения, чтобы отслеживать счетчик производительности для него.</span><span class="sxs-lookup"><span data-stu-id="3c38f-126">In the **Instances of selected object** list box, click an application name to monitor the performance counter for that application.</span></span>  
  
     <span data-ttu-id="3c38f-127">Для различения нескольких версий среды выполнения или устранения неоднозначности между несколькими приложениями с одним и тем же именем необходимо также изменить раздел реестра.</span><span class="sxs-lookup"><span data-stu-id="3c38f-127">To differentiate multiple versions of the runtime, or to disambiguate multiple applications with the same name, you must also modify a registry key.</span></span> <span data-ttu-id="3c38f-128">Для получения дополнительной информации см. [Счетчики производительности и внутрипроцессные параллельные приложения](../../../docs/framework/debug-trace-profile/performance-counters-and-in-process-side-by-side-applications.md).</span><span class="sxs-lookup"><span data-stu-id="3c38f-128">For more information, see [Performance Counters and In-Process Side-By-Side Applications](../../../docs/framework/debug-trace-profile/performance-counters-and-in-process-side-by-side-applications.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="3c38f-129">Если новые счетчики производительности были установлены при работающем системном мониторе, остановите системный монитор и перезапустите его, чтобы новые счетчики стали видны.</span><span class="sxs-lookup"><span data-stu-id="3c38f-129">When new performance counters are installed while the Performance console is running, stop and restart the Performance console to make the new counters visible.</span></span>  
  
 <span data-ttu-id="3c38f-130">Если нужно профилировать сборку, существующую в зоне или в удаленном общем ресурсе, убедитесь в том, что удаленная сборка является полностью доверенной на компьютере с работающими счетчиками производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-130">If you want to profile an assembly that exists in a zone or on a remote share, make sure that the remote assembly has full trust on the computer that runs the performance counters.</span></span> <span data-ttu-id="3c38f-131">Если сборка не обладает достаточным уровнем доверия, счетчики производительности работать не будут.</span><span class="sxs-lookup"><span data-stu-id="3c38f-131">If the assembly does not have sufficient trust, the performance counters will not work.</span></span> <span data-ttu-id="3c38f-132">Сведения о предоставлении доверия различным зонам см. в разделе [Caspol.exe (средство настройки политики управления доступом для кода)](../../../docs/framework/tools/caspol-exe-code-access-security-policy-tool.md).</span><span class="sxs-lookup"><span data-stu-id="3c38f-132">For information about granting trust to different zones, see [Caspol.exe (Code Access Security Policy Tool)](../../../docs/framework/tools/caspol-exe-code-access-security-policy-tool.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="3c38f-133">В системах, в которых установлена платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] , в системном мониторе могут не отображаться данные счетчиков производительности в некоторых категориях, таких как **Данные CLR .NET** и **Организация сети CLR .NET**, для приложений, которые были разработаны с помощью [!INCLUDE[net_v11_short](../../../includes/net-v11-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3c38f-133">On systems on which the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed, the Performance Monitor may not display data for performance counters in some categories, such as **.NET CLR Data** and **.NET CLR Networking**, for applications that were developed using the [!INCLUDE[net_v11_short](../../../includes/net-v11-short-md.md)].</span></span> <span data-ttu-id="3c38f-134">Если это так, можно настроить монитор производительности для отображения этих данных, добавив элемент [\<forcePerformanceCounterUniqueSharedMemoryReads>](../../../docs/framework/configure-apps/file-schema/runtime/forceperformancecounteruniquesharedmemoryreads-element.md) в файле конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="3c38f-134">If this is the case, you can configure Performance Monitor to display this data by adding the [\<forcePerformanceCounterUniqueSharedMemoryReads>](../../../docs/framework/configure-apps/file-schema/runtime/forceperformancecounteruniquesharedmemoryreads-element.md) element to the application's configuration file.</span></span>  
  
## <a name="reading-and-creating-performance-counters-programmatically"></a><span data-ttu-id="3c38f-135">Считывание данных и создание счетчиков производительности программным способом</span><span class="sxs-lookup"><span data-stu-id="3c38f-135">Reading and Creating Performance Counters Programmatically</span></span>  
 <span data-ttu-id="3c38f-136">Платформа [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] предоставляет классы, которые можно использовать для программного доступа к тем же сведениям о производительности, которые доступны в системном мониторе.</span><span class="sxs-lookup"><span data-stu-id="3c38f-136">The [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] provides classes you can use to programmatically access the same performance information that is available in the Performance console.</span></span> <span data-ttu-id="3c38f-137">Эти классы можно также использовать для создания пользовательских счетчиков производительности.</span><span class="sxs-lookup"><span data-stu-id="3c38f-137">You can also use these classes to create custom performance counters.</span></span> <span data-ttu-id="3c38f-138">В таблице ниже описаны некоторые из классов мониторинга производительности, предоставляемых [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3c38f-138">The following table describes some of the performance monitoring classes that are provided in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span></span>  
  
|<span data-ttu-id="3c38f-139">Класс</span><span class="sxs-lookup"><span data-stu-id="3c38f-139">Class</span></span>|<span data-ttu-id="3c38f-140">Описание</span><span class="sxs-lookup"><span data-stu-id="3c38f-140">Description</span></span>|  
|-----------|-----------------|  
|<xref:System.Diagnostics.PerformanceCounter?displayProperty=nameWithType>|<span data-ttu-id="3c38f-141">Представляет компонент счетчика производительности Windows NT.</span><span class="sxs-lookup"><span data-stu-id="3c38f-141">Represents a Windows NT performance counter component.</span></span> <span data-ttu-id="3c38f-142">Этот класс используется для чтения существующих предварительно определенных или пользовательских счетчиков и публикации (записи) данных производительности в пользовательские счетчики.</span><span class="sxs-lookup"><span data-stu-id="3c38f-142">Use this class to read existing predefined or custom counters and publish (write) performance data to custom counters.</span></span>|  
|<xref:System.Diagnostics.PerformanceCounterCategory?displayProperty=nameWithType>|<span data-ttu-id="3c38f-143">Предоставляет ряд методов для взаимодействия со счетчиками и категориями счетчиков на компьютере.</span><span class="sxs-lookup"><span data-stu-id="3c38f-143">Provides several methods for interacting with counters and categories of counters on the computer.</span></span>|  
|<xref:System.Diagnostics.PerformanceCounterInstaller?displayProperty=nameWithType>|<span data-ttu-id="3c38f-144">Задает установщик для компонента `PerformanceCounter` .</span><span class="sxs-lookup"><span data-stu-id="3c38f-144">Specifies an installer for the `PerformanceCounter` component.</span></span>|  
|<xref:System.Diagnostics.PerformanceCounterType?displayProperty=nameWithType>|<span data-ttu-id="3c38f-145">Задает формулу для вычисления метода `NextValue` для `PerformanceCounter`.</span><span class="sxs-lookup"><span data-stu-id="3c38f-145">Specifies the formula to calculate the `NextValue` method for a `PerformanceCounter`.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="3c38f-146">См. также</span><span class="sxs-lookup"><span data-stu-id="3c38f-146">See also</span></span>

- [<span data-ttu-id="3c38f-147">Счетчики производительности</span><span class="sxs-lookup"><span data-stu-id="3c38f-147">Performance Counters</span></span>](../../../docs/framework/debug-trace-profile/performance-counters.md)
