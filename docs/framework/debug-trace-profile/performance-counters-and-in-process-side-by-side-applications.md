---
title: Счетчики производительности и внутрипроцессные параллельные приложения
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- performance counters
- performance counters,and in-process side-by-side applications
- performance,.NET Framework applications
- performance monitoring,counters
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: dd3501bc74da2c9a812f9c4816b5a081b3780cd0
ms.sourcegitcommit: 155012a8a826ee8ab6aa49b1b3a3b532e7b7d9bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66490032"
---
# <a name="performance-counters-and-in-process-side-by-side-applications"></a><span data-ttu-id="9a872-102">Счетчики производительности и внутрипроцессные параллельные приложения</span><span class="sxs-lookup"><span data-stu-id="9a872-102">Performance Counters and In-Process Side-By-Side Applications</span></span>
<span data-ttu-id="9a872-103">С помощью системного монитора (Perfmon.exe) можно различать счетчики производительности на основе среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-103">Using the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis.</span></span> <span data-ttu-id="9a872-104">В этом разделе описываются изменения в реестре, необходимые для включения этой функции.</span><span class="sxs-lookup"><span data-stu-id="9a872-104">This topic describes the registry change needed to enable this functionality.</span></span>  
  
## <a name="the-default-behavior"></a><span data-ttu-id="9a872-105">Поведение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="9a872-105">The Default Behavior</span></span>  
 <span data-ttu-id="9a872-106">По умолчанию системный монитор отображает счетчики производительности по приложениям.</span><span class="sxs-lookup"><span data-stu-id="9a872-106">By default, the Performance Monitor displays performance counters on a per-application basis.</span></span> <span data-ttu-id="9a872-107">Тем не менее в двух случаях это может быть сопряжено с проблемами:</span><span class="sxs-lookup"><span data-stu-id="9a872-107">However, there are two scenarios in which this is problematic:</span></span>  
  
- <span data-ttu-id="9a872-108">Отслеживание двух приложений с одинаковыми именами.</span><span class="sxs-lookup"><span data-stu-id="9a872-108">When you monitor two applications that have the same name.</span></span> <span data-ttu-id="9a872-109">Например, если оба приложения называются myapp.exe, они будут отображаться соответственно как **myapp** и **myapp#1** в столбце **Экземпляр**.</span><span class="sxs-lookup"><span data-stu-id="9a872-109">For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column.</span></span> <span data-ttu-id="9a872-110">В этом случае сложно сопоставить счетчик производительности с конкретным приложением.</span><span class="sxs-lookup"><span data-stu-id="9a872-110">In this case, it is difficult to match a performance counter to a particular application.</span></span> <span data-ttu-id="9a872-111">При этом неочевидно, относятся ли данные для **myapp#1** к первому или второму приложению myapp.exe.</span><span class="sxs-lookup"><span data-stu-id="9a872-111">It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe.</span></span>  
  
- <span data-ttu-id="9a872-112">Приложение, использующее несколько экземпляров общеязыковой среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-112">When an application uses multiple instances of the common language runtime.</span></span> <span data-ttu-id="9a872-113">.NET Framework 4 поддерживает сценарии размещения-process side-by-side; то есть отдельные процесс или приложение могут загружать несколько экземпляров среды CLR.</span><span class="sxs-lookup"><span data-stu-id="9a872-113">The .NET Framework 4 supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime.</span></span> <span data-ttu-id="9a872-114">Если одно приложение с именем myapp.exe загружает два экземпляра среды выполнения, по умолчанию они будут обозначены в столбце **Экземпляр** как **myapp** и **myapp#1**.</span><span class="sxs-lookup"><span data-stu-id="9a872-114">If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**.</span></span> <span data-ttu-id="9a872-115">В этом случае также неясно, относятся ли **myapp** и **myapp#1** к двум одноименным приложениям или к одному приложению с двумя средами выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-115">In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes.</span></span> <span data-ttu-id="9a872-116">Если несколько приложений загружают несколько сред выполнения, степень неоднозначности только возрастает.</span><span class="sxs-lookup"><span data-stu-id="9a872-116">If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.</span></span>  
  
 <span data-ttu-id="9a872-117">Чтобы устранить подобное состояние, можно настроить соответствующий раздел реестра.</span><span class="sxs-lookup"><span data-stu-id="9a872-117">You can set a registry key to eliminate this ambiguity.</span></span> <span data-ttu-id="9a872-118">Для приложений, разработанных с помощью .NET Framework 4, это изменение реестра добавляет идентификатор процесса, идентификатор экземпляра среды выполнения к имени приложения в **экземпляр** столбца.</span><span class="sxs-lookup"><span data-stu-id="9a872-118">For applications developed using the .NET Framework 4, this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column.</span></span> <span data-ttu-id="9a872-119">Так, вместо *приложение* или *приложение*#1 приложение теперь будет идентифицироваться как *приложение*_`p`\*ИД_процесса*\_`r`*ИД_среды_выполнения\* в столбце **Экземпляр**.</span><span class="sxs-lookup"><span data-stu-id="9a872-119">Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\_`r`*runtimeID* in the **Instance** column.</span></span> <span data-ttu-id="9a872-120">Если приложение было разработано с использованием предыдущей версии среды CLR, этот экземпляр отображается как *приложения\_* `p`*processID* условии, что. NET Framework 4 установлена.</span><span class="sxs-lookup"><span data-stu-id="9a872-120">If an application was developed using a previous version of the common language runtime, that instance is represented as *application\_*`p`*processID* provided that the .NET Framework 4 is installed.</span></span>  
  
## <a name="performance-counters-for-in-process-side-by-side-applications"></a><span data-ttu-id="9a872-121">Счетчики производительности для внутрипроцессных параллельных приложений</span><span class="sxs-lookup"><span data-stu-id="9a872-121">Performance Counters for In-Process Side-by-Side Applications</span></span>  
 <span data-ttu-id="9a872-122">Чтобы использовать счетчики производительности для нескольких версий общеязыковой среды выполнения, размещаемых в одном приложении, необходимо изменить один параметр раздела реестра, как показано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="9a872-122">To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="9a872-123">Имя раздела</span><span class="sxs-lookup"><span data-stu-id="9a872-123">Key name</span></span>|<span data-ttu-id="9a872-124">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span><span class="sxs-lookup"><span data-stu-id="9a872-124">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span></span>|  
|<span data-ttu-id="9a872-125">Имя значения</span><span class="sxs-lookup"><span data-stu-id="9a872-125">Value name</span></span>|<span data-ttu-id="9a872-126">ProcessNameFormat</span><span class="sxs-lookup"><span data-stu-id="9a872-126">ProcessNameFormat</span></span>|  
|<span data-ttu-id="9a872-127">Тип значения</span><span class="sxs-lookup"><span data-stu-id="9a872-127">Value type</span></span>|<span data-ttu-id="9a872-128">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="9a872-128">REG_DWORD</span></span>|  
|<span data-ttu-id="9a872-129">Значение</span><span class="sxs-lookup"><span data-stu-id="9a872-129">Value</span></span>|<span data-ttu-id="9a872-130">1 (0x00000001)</span><span class="sxs-lookup"><span data-stu-id="9a872-130">1 (0x00000001)</span></span>|  
  
 <span data-ttu-id="9a872-131">Значение 0 для параметра `ProcessNameFormat` активирует поведение по умолчанию, при котором Perfmon.exe отображает счетчики производительности на основе приложений.</span><span class="sxs-lookup"><span data-stu-id="9a872-131">A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis.</span></span> <span data-ttu-id="9a872-132">Если это значение равно 1, Perfmon.exe проводит различия между несколькими версиями приложения и предоставляет счетчики производительности на основе среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-132">When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis.</span></span> <span data-ttu-id="9a872-133">Любые другие значения параметра раздела реестра `ProcessNameFormat` не поддерживаются и зарезервированы для будущего использования.</span><span class="sxs-lookup"><span data-stu-id="9a872-133">Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use.</span></span>  
  
 <span data-ttu-id="9a872-134">Для корректной работы функции именования экземпляров после обновления параметра раздела реестра `ProcessNameFormat` необходимо перезапустить Perfmon.exe или любые другие компоненты, использующие счетчики производительности.</span><span class="sxs-lookup"><span data-stu-id="9a872-134">After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.</span></span>  
  
 <span data-ttu-id="9a872-135">В следующем примере показано изменение значения `ProcessNameFormat` программным способом.</span><span class="sxs-lookup"><span data-stu-id="9a872-135">The following example shows how to change the `ProcessNameFormat` value programmatically.</span></span>  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]
 [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 <span data-ttu-id="9a872-136">При внесении этого изменения в реестр программа Perfmon.exe отображает имена приложений, предназначенных для .NET Framework 4 как *приложения*_`p`*processID* \_ `r` \*Ид_среды_выполнения\*, где *приложения* — это имя приложения, *processID* — идентификатор процесса приложения, и  \*Ид_среды_выполнения\* — идентификатор среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-136">When you make this registry change, Perfmon.exe displays the names of applications that target the .NET Framework 4 as *application*_`p`*processID*\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier.</span></span> <span data-ttu-id="9a872-137">Например, если приложение myapp.exe загружает два экземпляра общеязыковой среды выполнения, программа Perfmon.exe может идентифицировать их как myapp_p1416_r10 и myapp_p3160_r10 соответственно.</span><span class="sxs-lookup"><span data-stu-id="9a872-137">For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10.</span></span> <span data-ttu-id="9a872-138">Идентификатор среды выполнения может использоваться только для различения сред выполнения в рамках процесса и не предоставляет какой-либо другой информации о среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-138">The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime.</span></span> <span data-ttu-id="9a872-139">(Например, идентификатор среды выполнения не связан с ее версией или номером SKU.)</span><span class="sxs-lookup"><span data-stu-id="9a872-139">(For example, the runtime ID has no relation to the version or the SKU of the runtime.)</span></span>  
  
 <span data-ttu-id="9a872-140">Если установлен .NET Framework 4, изменения в реестре также влияет на приложения, разработанные с помощью более ранних версий платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9a872-140">If the .NET Framework 4 is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework.</span></span> <span data-ttu-id="9a872-141">Они отображаются в программе Perfmon.exe как *приложение_* `p`*ИД_процесса*, где *приложение* — это имя приложения, а *ИД_процесса* — идентификатор процесса.</span><span class="sxs-lookup"><span data-stu-id="9a872-141">These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier.</span></span> <span data-ttu-id="9a872-142">Например, при отслеживании счетчиков производительности для двух приложений с именем myapp.exe одно из них может отображаться как myapp_p23900, а другое — как myapp_p24908.</span><span class="sxs-lookup"><span data-stu-id="9a872-142">For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9a872-143">Идентификатор процесса позволяет устранить неоднозначность при идентификации двух приложений с одинаковыми именами, использующих более ранние версии среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="9a872-143">The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime.</span></span> <span data-ttu-id="9a872-144">Идентификатор среды выполнения для более ранних версий общеязыковой среды выполнения не нужен, поскольку в них не поддерживаются сценарии параллельного размещения.</span><span class="sxs-lookup"><span data-stu-id="9a872-144">A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.</span></span>  
  
 <span data-ttu-id="9a872-145">Если .NET Framework 4 не существует или была удалена, Настройка раздела реестра не оказывает влияния.</span><span class="sxs-lookup"><span data-stu-id="9a872-145">If the .NET Framework 4 is not present or was uninstalled, setting the registry key has no effect.</span></span> <span data-ttu-id="9a872-146">Это означает, что два приложения с одинаковым именем будут по-прежнему отображаться в программе Perfmon.exe как *приложение* и *приложение#1* (например, **myapp** и **myapp#1**).</span><span class="sxs-lookup"><span data-stu-id="9a872-146">This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**).</span></span>
