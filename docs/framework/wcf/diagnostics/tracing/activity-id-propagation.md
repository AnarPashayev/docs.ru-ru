---
title: Распространение ИД действия
ms.date: 03/30/2017
ms.assetid: cd1c1ae5-cc8a-4f51-90c9-f7b476bcfe70
ms.openlocfilehash: e51970f693d9ca2d2f81bf4efc97969896de4828
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61998053"
---
# <a name="activity-id-propagation"></a><span data-ttu-id="8635b-102">Распространение ИД действия</span><span class="sxs-lookup"><span data-stu-id="8635b-102">Activity ID Propagation</span></span>
<span data-ttu-id="8635b-103">Распространение происходит при включении трассировки действий ServiceModel (распространение ServiceModel) или ее выключении (распространение действий от пользователя к пользователю).</span><span class="sxs-lookup"><span data-stu-id="8635b-103">Propagation happens when ServiceModel activity tracing is enabled (ServiceModel propagation) or disabled (User-to-User activity propagation).</span></span>  
  
## <a name="servicemodel-activity-tracing-is-enabled"></a><span data-ttu-id="8635b-104">Трассировка действий ServiceModel включена</span><span class="sxs-lookup"><span data-stu-id="8635b-104">ServiceModel Activity Tracing is Enabled</span></span>  
 <span data-ttu-id="8635b-105">Если трассировка действий ServiceModel включена, между действиями ProcessAction осуществляется распространение.</span><span class="sxs-lookup"><span data-stu-id="8635b-105">If ServiceModel ActivityTracing is enabled, propagation happens between ProcessAction activities.</span></span>  
  
### <a name="server"></a><span data-ttu-id="8635b-106">Сервер</span><span class="sxs-lookup"><span data-stu-id="8635b-106">Server</span></span>  
 <span data-ttu-id="8635b-107">Когда `propagateActivity` атрибуту присваивается `true` на клиенте и сервере, идентификатор `ProcessAction` действия на сервере идентичен Идентификатору в распространенном `ActivityId` заголовок сообщения.</span><span class="sxs-lookup"><span data-stu-id="8635b-107">When the `propagateActivity` attribute is set to `true` on both the client and server, the ID of the `ProcessAction` activity in the server is identical to the ID in the propagated `ActivityId` message header.</span></span>  
  
 <span data-ttu-id="8635b-108">Если аргумент `ActivityId` заголовок присутствует в сообщении (то есть `propagateActivity` = `false` на стороне клиента), или когда `propagateActivity` = `false` на сервере, сервер создает новый идентификатор действия.</span><span class="sxs-lookup"><span data-stu-id="8635b-108">When no `ActivityId` header is present in the message (that is, `propagateActivity`=`false` on the client), or when `propagateActivity`=`false` on the server, the server generates a new activity ID.</span></span>  
  
### <a name="client"></a><span data-ttu-id="8635b-109">"Клиент";</span><span class="sxs-lookup"><span data-stu-id="8635b-109">Client</span></span>  
 <span data-ttu-id="8635b-110">Если клиент синхронно однопоточный, он игнорирует любые параметры `propagateActivity` на уровне клиента или сервера.</span><span class="sxs-lookup"><span data-stu-id="8635b-110">If the client is synchronously single threaded, the client disregards any settings of `propagateActivity` at the client or server.</span></span> <span data-ttu-id="8635b-111">Вместо этого ответ обрабатывается действием запроса.</span><span class="sxs-lookup"><span data-stu-id="8635b-111">Instead, the response is handled in the request activity.</span></span> <span data-ttu-id="8635b-112">Если клиент асинхронный или синхронный многопоточный, `propagateActivity` = `true` в клиенте и имеется заголовок идентификатора действия в сообщении, отправленном сервером, клиент извлекает из сообщения идентификатор действия и передает Действие Process Action, содержащее распространенный идентификатор действия.</span><span class="sxs-lookup"><span data-stu-id="8635b-112">If the client is asynchronous or synchronous multithreaded, `propagateActivity`=`true` in the client, and there is an activity ID header in the message sent by the server, the client retrieves the activity ID from the message, and transfers to the Process Action activity that contains the propagated activity ID.</span></span> <span data-ttu-id="8635b-113">Иначе клиент передает его из действия Process Action в новое действие Process Action.</span><span class="sxs-lookup"><span data-stu-id="8635b-113">Otherwise, the client transfers from Process Message activity to a new Process Action activity.</span></span> <span data-ttu-id="8635b-114">Такая дополнительная передача в новое действие Process Action осуществляется для обеспечения согласованности.</span><span class="sxs-lookup"><span data-stu-id="8635b-114">This extra transfer to a new Process Action activity is done for consistency.</span></span> <span data-ttu-id="8635b-115">В этом действии клиент извлекает идентификатор действия BeginCall из контекста локального потока, когда выделяется поток для обработки ответного сообщения.</span><span class="sxs-lookup"><span data-stu-id="8635b-115">Inside this activity, the client retrieves the activity ID of the BeginCall activity from the local thread context, when the thread is allocated for response message processing.</span></span> <span data-ttu-id="8635b-116">После этого осуществляется передача в первоначальное действие Process Action.</span><span class="sxs-lookup"><span data-stu-id="8635b-116">It then transfers to the initial Process Action activity.</span></span>  
  
 <span data-ttu-id="8635b-117">Если клиент дуплексный, он действует в качестве сервера для получения сообщения.</span><span class="sxs-lookup"><span data-stu-id="8635b-117">If the client is duplex, the client acts as server on receiving the message.</span></span>  
  
### <a name="propagation-in-fault-messages"></a><span data-ttu-id="8635b-118">Распространение в сообщениях об ошибках</span><span class="sxs-lookup"><span data-stu-id="8635b-118">Propagation in Fault Messages</span></span>  
 <span data-ttu-id="8635b-119">Разницы в обработке допустимых сообщений и сообщений об ошибках нет.</span><span class="sxs-lookup"><span data-stu-id="8635b-119">There is no difference in handling valid and fault messages.</span></span> <span data-ttu-id="8635b-120">Если `propagateActivity` = `true`, идентификатор действия, добавляемые в заголовки сообщений об ошибках SOAP идентичен внешнему действию.</span><span class="sxs-lookup"><span data-stu-id="8635b-120">If `propagateActivity`=`true`, the activity ID added to the SOAP fault message headers is identical to the ambient activity.</span></span>  
  
## <a name="servicemodel-activity-tracing-is-disabled"></a><span data-ttu-id="8635b-121">Трассировка действий ServiceModel отключена</span><span class="sxs-lookup"><span data-stu-id="8635b-121">ServiceModel Activity Tracing is Disabled</span></span>  
 <span data-ttu-id="8635b-122">Если трассировка действий ServiceModel отключена, распространение осуществляется непосредственно между действиями пользовательского кода, минуя действия ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8635b-122">If ServiceModel ActivityTracing is disabled, propagation occurs between user code activities directly without going through ServiceModel activities.</span></span> <span data-ttu-id="8635b-123">Идентификатор пользовательского действия также распространяется через заголовок идентификатора действия сообщения.</span><span class="sxs-lookup"><span data-stu-id="8635b-123">A user-defined activity ID is also propagated through the message activity ID header.</span></span>  
  
 <span data-ttu-id="8635b-124">Если `propagateActivity` = `true` и `ActivityTracing` = `off` для прослушивателя трассировки ServiceModel (независимо от того, включена ли трассировка в ServiceModel), на стороне клиента или сервера происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="8635b-124">If `propagateActivity`=`true` and `ActivityTracing`=`off` for a ServiceModel trace listener (regardless of whether tracing is enabled on ServiceModel), the following happen on either the client or server:</span></span>  
  
- <span data-ttu-id="8635b-125">При запросе операции или отправке ответа идентификатор действия в TLS распространяется из пользовательского кода, пока не будет сформировано сообщение.</span><span class="sxs-lookup"><span data-stu-id="8635b-125">On operation request or sending response, the activity ID in TLS is propagated out of user code until a message is formed.</span></span> <span data-ttu-id="8635b-126">Заголовок идентификатора действия также вставляется в сообщение перед отправкой.</span><span class="sxs-lookup"><span data-stu-id="8635b-126">An activity ID header is also inserted into the message before it is sent.</span></span>  
  
- <span data-ttu-id="8635b-127">При получении запроса или ответа идентификатор действия извлекается из заголовка сообщения сразу после создания объекта полученного сообщения.</span><span class="sxs-lookup"><span data-stu-id="8635b-127">On receiving request or receiving response, the activity ID is retrieved from the message header as soon as the received message object is created.</span></span> <span data-ttu-id="8635b-128">Идентификатор действия в TLS распространяется сразу после исчезновения сообщения из области, пока не будет достигнут пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="8635b-128">The activity ID in TLS is propagated as soon as the message disappears from scope until user code is reached.</span></span>  
  
 <span data-ttu-id="8635b-129">Такие действия гарантируют, что при включенном распространении пользовательские трассировки появятся в том же действии.</span><span class="sxs-lookup"><span data-stu-id="8635b-129">These actions guarantee that user traces will appear in the same activity if propagation is on.</span></span> <span data-ttu-id="8635b-130">Однако гарантии в отношении трассировок ServiceModel отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="8635b-130">However, it makes no guarantee on ServiceModel traces.</span></span> <span data-ttu-id="8635b-131">Трассировки ServiceModel возникают в действии пользовательского кода, только если обработка таких трассировок выполняется в том же потоке, в котором было задано действие пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="8635b-131">ServiceModel traces occur in a user code activity only if the processing of those traces is executed on the same thread where the user code activity was set.</span></span>  
  
 <span data-ttu-id="8635b-132">Как правило, трассировки ServiceModel находятся в следующих местах.</span><span class="sxs-lookup"><span data-stu-id="8635b-132">In general, ServiceModel traces can be observed in the following places:</span></span>  
  
- <span data-ttu-id="8635b-133">Если трассировка ServiceModel отключена, все выданные трассировки находятся в действиях пользователя.</span><span class="sxs-lookup"><span data-stu-id="8635b-133">If ServiceModel tracing is disabled, all emitted traces appear in user activities.</span></span> <span data-ttu-id="8635b-134">Если включено распространение на сервере и клиенте, эти трассировки будут находиться в том же действии.</span><span class="sxs-lookup"><span data-stu-id="8635b-134">If propagation is enabled at both the server and client, these traces will be in the same activity.</span></span>  
  
- <span data-ttu-id="8635b-135">Если включена трассировка ServiceModel, но ActivityTracing отключена, пользовательские трассировки находятся в том же действии, если для обеих сторон включено распространение.</span><span class="sxs-lookup"><span data-stu-id="8635b-135">If ServiceModel tracing is enabled, but ActivityTracing is disabled, user traces appear in the same activity if propagation is enabled on both ends.</span></span> <span data-ttu-id="8635b-136">Трассировки ServiceModel появляются в действии по умолчанию 0000, пока они не возникнут в том же потоке, где выполняется обработка пользовательского кода с первоначально заданным действием.</span><span class="sxs-lookup"><span data-stu-id="8635b-136">ServiceModel traces appear in the default 0000 activity, unless they occur in the same thread as the user code processing where the activity is initially set.</span></span>  
  
- <span data-ttu-id="8635b-137">Если включены трассировка ServiceModel и ActivityTracing, пользовательские трассировки находятся в пользовательских действиях, а трассировка ServiceModel - в действиях, определенных ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8635b-137">If both ServiceModel tracing and ActivityTracing are enabled, user traces appear in user-defined activities, and ServiceModel traces appear in ServiceModel-defined activities.</span></span> <span data-ttu-id="8635b-138">Распространение осуществляется на уровне ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="8635b-138">Propagation happens at ServiceModel level.</span></span>
