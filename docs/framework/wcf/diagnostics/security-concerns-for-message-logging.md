---
title: Проблемы безопасности при ведении журналов сообщений
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: b635591b7a3b07385ed48c6b1ea556139c6d77c5
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2019
ms.locfileid: "70044259"
---
# <a name="security-concerns-for-message-logging"></a>Проблемы безопасности при ведении журналов сообщений
В этом разделе описываются способы защиты конфиденциальных данных от раскрытия в журналах сообщений, а также в событиях, формируемых посредством ведения журнала сообщений.  
  
## <a name="security-concerns"></a>Проблемы безопасности  
  
### <a name="logging-sensitive-information"></a>Регистрация конфиденциальных сведений  
 Windows Communication Foundation (WCF) не изменяет какие-либо данные в заголовках и тексте конкретного приложения. WCF также не следит за личными сведениями в заголовках или данных основного текста для конкретного приложения.  
  
 Когда регистрация сообщений включена, персональные данные в заголовках, зависящих от приложения (такие как строка запроса), и в теле сообщения (такие как номер кредитной карты), могут быть видимы в журналах. За надлежащее управление доступом к файлам конфигурации и журналов отвечает специалист, выполняющий развертывание приложения. Если требуется, чтобы подобные сведения не были видимы, необходимо отключить регистрацию или фильтровать часть данных (если предполагается доступ к журналам других лиц).  
  
 Следующие советы помогут предотвратить непреднамеренное раскрытие содержимого файла журнала.  
  
- Убедитесь, что файлы журналов защищены с помощью списков управления доступом (ACL), как в сценарии с размещением на веб-сервере, так и в сценарии с резидентной службой.  
  
- Выберите расширение файла, которое нельзя легко получить с помощью веб-запроса. Например, расширение XML безопасным не является. Список расширений, которые могут быть получены, можно найти в руководстве по администрированию Internet Information Services (IIS).  
  
- Задайте абсолютный путь к местоположению файла журнала, которое должно находиться за пределами общедоступного каталога vroot веб-сервера во избежание доступа к нему третьих лиц с помощью веб-браузера.  
  
 По умолчанию ключи и персональные данные (personally identifiable information, PII), такие как имя пользователя и пароль, не регистрируются трассировкой и не указываются в заносимых в журнал сообщениях. Администратор компьютера может, тем не менее, с помощью атрибута `enableLoggingKnownPII` в элементе `machineSettings` файла Machine.config разрешить приложениям, выполняющимся на компьютере, регистрировать известные персональные данные (PII). Следующая конфигурация показывает, как это сделать.  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>   
```  
  
 Специалист, выполняющий развертывание приложения, может затем с помощью атрибута `logKnownPii` в файле App.config или Web.config включить регистрацию персональных данных следующим образом:  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 Регистрация PII включена, только когда оба параметра имеют значение `true`. Такое сочетание из двух ключей позволяет регистрировать известные PII для каждого приложения.  
  
> [!IMPORTANT]
> В [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] для флагов `logEntireMessage` и `logKnownPii` необходимо задать значение `true` в файле Web.config или файле App.config, чтобы включить регистрацию персональных данных, как показано в следующем примере: `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.  
  
 Необходимо иметь в виду, что при задании в файле конфигурации двух или более пользовательских источников считываются только атрибуты первого источника. Остальные атрибуты не учитываются. Это значит, что в случае следующего файла App.config PII не регистрируются для обоих источников, несмотря на то что для второго источника явно включена регистрация персональных данных.  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"   
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 Если элемент `<machineSettings enableLoggingKnownPii="Boolean"/>`<xref:System.Configuration.ConfigurationErrorsException> присутствует за пределами файла Machine.config, система вызывает исключение.  
  
 Изменения вступают в силу только после запуска или перезапуска приложения. Когда оба атрибута имеют значение `true`, при запуске регистрируется событие. Событие также регистрируется, если атрибут `logKnownPii` имеет значение `true`, а атрибут `enableLoggingKnownPii` имеет значение `false`.  
  
 Администратор компьютера и специалист, выполняющий развертывание приложения, должны быть предельно осторожными при использовании этих двух переключателей. Если регистрация PII включена, ключи контроля доступа и персональные данные заносятся в журналы. Если она отключена, конфиденциальные и зависящие от приложения данные все равно регистрируются в составе заголовков и тел сообщений. Более подробные сведения о конфиденциальности и защите личных данных от предоставления данных см. в статье [конфиденциальность пользователей](https://go.microsoft.com/fwlink/?LinkID=94647).  
  
> [!CAUTION]
> В неправильно сформированных сообщениях PII не скрываются. Такие сообщения регистрируются «как есть», без каких-либо изменений. Упомянутые выше атрибуты никак на это не влияют.  
  
### <a name="custom-trace-listener"></a>Пользовательский прослушиватель трассировки  
 Добавление пользовательского прослушивателя трассировки на источник трассировки «Ведение журнала сообщений» должно быть привилегией исключительно администратора. Это связано с тем, что пользовательские прослушиватели могут быть настроены злоумышленниками на удаленную отправку сообщений, что может привести к разглашению конфиденциальных сведений. Кроме того, если пользовательский прослушиватель настроен на отправку сообщений по линии связи, например в удаленную базу данных, необходимо обеспечить надлежащее управление доступом к журналам сообщений на удаленной машине.  
  
## <a name="events-triggered-by-message-logging"></a>События, активируемые регистрацией сообщений  
 Ниже приведен исчерпывающий список событий, формируемых регистрацией событий.  
  
- Вход в систему сообщений: Это событие создается при включении ведения журнала сообщений в конфигурации или с помощью инструментария WMI. Содержание события: "Регистрация сообщений включена. Секретные сведения могут регистрироваться без шифрования, даже если при передаче они были зашифрованы, например, тексты сообщений".  
  
- Выход из системы для сообщения: Это событие создается, когда ведение журнала сообщений отключено через WMI. Содержание события: "Регистрация сообщений отключена".  
  
- Записывать известные персональные данные в журнал: Это событие создается при включении ведения журнала известных персональных персональных данных. Это происходит `true`, когда `enableLoggingKnownPii` `machineSettings` атрибут в элементе файла Machine. config имеет `logKnownPii` значение, а атрибут `source` элемента в файле App. config или Web. config имеет значение `true`.  
  
- Не допускаются известные персональные данные журнала: Это событие создается, если ведение журнала известных персональных данных не разрешено. Это происходит `true`, когда `logKnownPii` `source` атрибут элемента в файле App. config или Web. config имеет `enableLoggingKnownPii` значение, но атрибут в `machineSettings` элементе файла Machine. config имеет значение `false`. Исключение не возникает.  
  
 Эти события можно просмотреть с помощью средства просмотра событий, входящего в состав Windows. Дополнительные сведения об этом см. в разделе [ведение журнала событий](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).  
  
## <a name="see-also"></a>См. также

- [Ведение журналов сообщений](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [Проблемы безопасности и полезные советы при трассировке](../../../../docs/framework/wcf/diagnostics/tracing/security-concerns-and-useful-tips-for-tracing.md)
