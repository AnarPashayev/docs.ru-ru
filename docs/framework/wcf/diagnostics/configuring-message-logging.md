---
title: Настройка ведения журналов сообщений
ms.date: 03/30/2017
helpviewer_keywords:
- message logging [WCF]
ms.assetid: 0ff4c857-8f09-4b85-9dc0-89084706e4c9
ms.openlocfilehash: e1d4c91ee282233e862ae14bf8d650ab2a754462
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59112090"
---
# <a name="configuring-message-logging"></a><span data-ttu-id="dfb7f-102">Настройка ведения журналов сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-102">Configuring Message Logging</span></span>
<span data-ttu-id="dfb7f-103">В этом разделе описывается, как настроить ведение журнала сообщений для различных сценариев.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-103">This topic describes how you can configure message logging for different scenarios.</span></span>  
  
## <a name="enabling-message-logging"></a><span data-ttu-id="dfb7f-104">Включение ведения журнала сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-104">Enabling Message Logging</span></span>  
 <span data-ttu-id="dfb7f-105">Windows Communication Foundation (WCF) не регистрируют сообщений по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-105">Windows Communication Foundation (WCF) does not log messages by default.</span></span> <span data-ttu-id="dfb7f-106">Чтобы включить ведение журнала сообщений, необходимо добавить прослушиватель трассировки в источник трассировки `System.ServiceModel.MessageLogging` и задать атрибуты элемента `<messagelogging>` в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-106">To activate message logging, you must add a trace listener to the `System.ServiceModel.MessageLogging` trace source and set attributes for the `<messagelogging>` element in the configuration file.</span></span>  
  
 <span data-ttu-id="dfb7f-107">В следующем примере показано, как включить ведение журнала и указать дополнительные параметры.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-107">The following example shows how to enable logging and specify additional options.</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
    <source name="System.ServiceModel.MessageLogging">  
      <listeners>  
         <add name="messages"  
              type="System.Diagnostics.XmlWriterTraceListener"  
              initializeData="c:\logs\messages.svclog" />  
        </listeners>  
    </source>  
  </sources>  
</system.diagnostics>  
  
<system.serviceModel>  
  <diagnostics>  
    <messageLogging   
         logEntireMessage="true"   
         logMalformedMessages="false"  
         logMessagesAtServiceLevel="true"   
         logMessagesAtTransportLevel="false"  
         maxMessagesToLog="3000"  
         maxSizeOfMessageToLog="2000"/>  
  </diagnostics>  
</system.serviceModel>  
```  
  
 <span data-ttu-id="dfb7f-108">Дополнительные сведения о параметрах ведения журнала сообщений, см. в разделе [рекомендуемые параметры для трассировки и ведения журнала сообщений](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-108">For more information about message logging settings, see [Recommended Settings for Tracing and Message Logging](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span></span>  
  
 <span data-ttu-id="dfb7f-109">С помощью элемента `add` можно задать имя и тип прослушивателя, который требуется использовать.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-109">You can use `add` to specify the name and type of the listener you want to use.</span></span> <span data-ttu-id="dfb7f-110">В данном примере прослушиватель с именем «messages» добавляет стандартный прослушиватель трассировки .NET Framework (`System.Diagnostics.XmlWriterTraceListener`) в качестве используемого типа.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-110">In the example configuration, the Listener is named "messages" and adds the standard .NET Framework trace listener (`System.Diagnostics.XmlWriterTraceListener`) as the type to use.</span></span> <span data-ttu-id="dfb7f-111">Если используется прослушиватель `System.Diagnostics.XmlWriterTraceListener`, необходимо задать расположение выходного файла и имя файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-111">If you use `System.Diagnostics.XmlWriterTraceListener`, you must specify the output file location and name in the configuration file.</span></span> <span data-ttu-id="dfb7f-112">Для этого нужно присвоить свойству `initializeData` имя файла журнала.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-112">This is done by setting `initializeData` to the name of the log file.</span></span> <span data-ttu-id="dfb7f-113">В противном случае система создает исключение.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-113">Otherwise, the system throws an exception.</span></span> <span data-ttu-id="dfb7f-114">Кроме того, можно реализовать пользовательский прослушиватель, который выводит журналы в файл по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-114">You can also implement a custom listener that emits logs to a default file.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="dfb7f-115">Поскольку для журнала сообщений требуется место на диске, необходимо ограничить число сообщений, записываемых на диск для конкретной службы.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-115">Because message logging accesses disk space, you should limit the number of messages that are written to disk for a particular service.</span></span> <span data-ttu-id="dfb7f-116">Когда достигается максимальное число сообщений, создается трассировка на уровне информации, и все операции по ведению журнала сообщений останавливаются.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-116">When the message limit is reached, a trace at the Information level is produced and all message logging activities stop.</span></span>  
  
 <span data-ttu-id="dfb7f-117">Уровень ведения журнала, а также дополнительные параметры, описаны в разделе Уровень и параметры ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-117">The logging level, as well as the additional options, are discussed in the Logging Level and Options section.</span></span>  
  
 <span data-ttu-id="dfb7f-118">Действие атрибута `switchValue` элемента `source` распространяется только на трассировку.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-118">The `switchValue` attribute of a `source` is only valid for tracing.</span></span> <span data-ttu-id="dfb7f-119">Если задать атрибут `switchValue` источника трассировки `System.ServiceModel.MessageLogging`, как показано ниже, это ни к чему не приведет.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-119">If you specify a `switchValue` attribute for the `System.ServiceModel.MessageLogging` trace source as follows, it has no effect.</span></span>  
  
```xml  
<source name="System.ServiceModel.MessageLogging" switchValue="Verbose">  
```  
  
 <span data-ttu-id="dfb7f-120">Если требуется отключить источник трассировки, следует использовать атрибуты `logMessagesAtServiceLevel`, `logMalformedMessages` и `logMessagesAtTransportLevel` элемента `messageLogging`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-120">If you want to disable the trace source, you should use the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element instead.</span></span> <span data-ttu-id="dfb7f-121">Все эти атрибуты должны иметь значение `false`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-121">You should set all these attributes to `false`.</span></span> <span data-ttu-id="dfb7f-122">Для этого можно воспользоваться файлом конфигурации, приведенным в последнем примере кода, пользовательским интерфейсом редактора конфигурации или инструментарием WMI.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-122">This can be done by using the configuration file in the previous code example, through the Configuration Editor UI interface, or using WMI.</span></span> <span data-ttu-id="dfb7f-123">Дополнительные сведения о редакторе конфигураций см. в разделе [средство редактирования конфигурации (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-123">For more information about the Configuration Editor tool, see [Configuration Editor Tool (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span></span> <span data-ttu-id="dfb7f-124">Дополнительные сведения о WMI см. в разделе [с помощью Windows Management Instrumentation для диагностики](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-124">For more information about WMI, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
## <a name="logging-levels-and-options"></a><span data-ttu-id="dfb7f-125">Уровни и параметры ведения журнала</span><span class="sxs-lookup"><span data-stu-id="dfb7f-125">Logging Levels and Options</span></span>  
 <span data-ttu-id="dfb7f-126">Для входящих сообщений регистрация в журнале осуществляется сразу после формирования сообщения, непосредственно перед попаданием сообщения в пользовательский код на уровне службы и при обнаружении неправильно сформированных сообщений.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-126">For incoming messages, logging happens immediately after the message is formed, immediately before the message gets to user code in the service level, and when malformed messages are detected.</span></span>  
  
 <span data-ttu-id="dfb7f-127">Для исходящих сообщений регистрация в журнале осуществляется сразу после выхода сообщения из пользовательского кода и непосредственно перед отправкой сообщения по каналам связи.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-127">For outgoing messages, logging happens immediately after the message leaves user code and immediately before the message goes on the wire.</span></span>  
  
 <span data-ttu-id="dfb7f-128">WCF регистрирует сообщения в двух различных уровнях, службы и транспорта.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-128">WCF logs messages at two different levels, service and transport.</span></span> <span data-ttu-id="dfb7f-129">Также регистрируются неправильно сформированные сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-129">Malformed messages are also logged.</span></span> <span data-ttu-id="dfb7f-130">Эти три категории журнала не зависят друг от друга и могут активироваться в конфигурации по отдельности.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-130">The three categories are independent from each other and can be activated separately in configuration.</span></span>  
  
 <span data-ttu-id="dfb7f-131">Для управления уровнем ведения журнала необходимо задать атрибуты `logMessagesAtServiceLevel`, `logMalformedMessages` и `logMessagesAtTransportLevel` элемента `messageLogging`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-131">You can control the logging level by setting the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element.</span></span>  
  
### <a name="service-level"></a><span data-ttu-id="dfb7f-132">Уровень службы</span><span class="sxs-lookup"><span data-stu-id="dfb7f-132">Service Level</span></span>  
 <span data-ttu-id="dfb7f-133">Сообщения, регистрируемые на этом уровне, готовы к входу (при получении) в пользовательский код или выходу (при отправке) из него.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-133">Messages logged at this layer are about to enter (on receiving) or leave (on sending) user code.</span></span> <span data-ttu-id="dfb7f-134">Если определены фильтры, в журнал записываются только сообщения, соответствующие этим фильтрам.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-134">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="dfb7f-135">В противном случае в журнал записываются все сообщения на уровне службы.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-135">Otherwise, all messages at the service level are logged.</span></span> <span data-ttu-id="dfb7f-136">На этом уровне также регистрируются сообщения инфраструктуры (транзакции, сообщения одноранговых каналов и безопасности), кроме сообщений системы надежного обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-136">Infrastructure messages (transactions, peer channel, and security) are also logged at this level, except for Reliable Messaging messages.</span></span> <span data-ttu-id="dfb7f-137">Для потоковых сообщений в журнал заносятся только заголовки.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-137">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="dfb7f-138">Защищенные сообщения регистрируются на этом уровне в расшифрованном виде.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-138">In addition, secure messages are logged decrypted at this level.</span></span>  
  
### <a name="transport-level"></a><span data-ttu-id="dfb7f-139">Уровень транспорта</span><span class="sxs-lookup"><span data-stu-id="dfb7f-139">Transport Level</span></span>  
 <span data-ttu-id="dfb7f-140">Сообщения, записываемые в журнал на этом уровне, готовы к кодированию или раскодированию для передачи по каналам связи или после нее.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-140">Messages logged at this layer are ready to be encoded or decoded for or after transportation on the wire.</span></span> <span data-ttu-id="dfb7f-141">Если определены фильтры, в журнал записываются только сообщения, соответствующие этим фильтрам.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-141">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="dfb7f-142">В противном случае в журнал записываются все сообщения на уровне транспорта.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-142">Otherwise, all messages at the transport layer are logged.</span></span> <span data-ttu-id="dfb7f-143">На этом уровне регистрируются все сообщения инфраструктуры, включая сообщения системы надежного обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-143">All infrastructure messages are logged at this layer, including reliable messaging messages.</span></span> <span data-ttu-id="dfb7f-144">Для потоковых сообщений в журнал заносятся только заголовки.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-144">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="dfb7f-145">Защищенные сообщения регистрируются на этом уровне в зашифрованном виде, если не используется защищенный транспорт, например протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-145">In addition, secure messages are logged as encrypted at this level, except if a secure transport such as HTTPS is used.</span></span>  
  
### <a name="malformed-level"></a><span data-ttu-id="dfb7f-146">Уровень неправильно составленных сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-146">Malformed Level</span></span>  
 <span data-ttu-id="dfb7f-147">Неправильный формат сообщения, сообщения, которые отклоняются стеком WCF на любом этапе обработки.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-147">Malformed messages are messages that are rejected by the WCF stack at any stage of processing.</span></span> <span data-ttu-id="dfb7f-148">Сообщения неправильного формата записываются в журнал в исходном виде, зашифровываются с неправильным XML и т. д.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-148">Malformed messages are logged as-is: encrypted if they are so, with non-proper XML, and so on.</span></span> <span data-ttu-id="dfb7f-149">Свойство `maxSizeOfMessageToLog` определяет размер сообщения, записываемого в журнал в виде CDATA.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-149">`maxSizeOfMessageToLog` defined the size of the message to be logged as CDATA.</span></span> <span data-ttu-id="dfb7f-150">По умолчанию свойство `maxSizeOfMessageToLog` имеет значение 256 КБ.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-150">By default, `maxSizeOfMessageToLog` is equal to 256K.</span></span> <span data-ttu-id="dfb7f-151">Дополнительные сведения об этом атрибуте см. в разделе «другие параметры».</span><span class="sxs-lookup"><span data-stu-id="dfb7f-151">For more information about this attribute, see the Other Options section.</span></span>  
  
### <a name="other-options"></a><span data-ttu-id="dfb7f-152">Другие параметры</span><span class="sxs-lookup"><span data-stu-id="dfb7f-152">Other Options</span></span>  
 <span data-ttu-id="dfb7f-153">Помимо уровня ведения журнала можно задать следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-153">In addition to the logging levels, the user can specify the following options:</span></span>  
  
-   <span data-ttu-id="dfb7f-154">Журнал сообщение целиком (`logEntireMessage` атрибут): Это значение указывает, является ли в журнал сообщение целиком (тело и заголовок сообщения).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-154">Log Entire Message (`logEntireMessage` attribute): This value specifies whether the entire message (message header and body) is logged.</span></span> <span data-ttu-id="dfb7f-155">Значением по умолчанию является `false`, означающее, что в журнал записывается только заголовок сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-155">The default value is `false`, meaning that only the header is logged.</span></span> <span data-ttu-id="dfb7f-156">Действие этого параметра распространяется на уровни ведения журнала службы и транспорта.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-156">This setting affects service and transport message logging levels..</span></span>  
  
-   <span data-ttu-id="dfb7f-157">Максимальное число сообщений в журнал (`maxMessagesToLog` атрибут): Это значение указывает максимальное количество записываемых в журнал сообщений.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-157">Max messages to log (`maxMessagesToLog` attribute): This value specifies the maximum number of messages to log.</span></span> <span data-ttu-id="dfb7f-158">Это значение относится ко всем сообщениям (службы, транспорта и неправильно сформированным сообщениям).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-158">All messages (service, transport, and malformed messages) are counted towards this quota.</span></span> <span data-ttu-id="dfb7f-159">После достижения этого значения создается трассировка и новые сообщения в журнал не заносятся.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-159">When the quota is reached, a trace is emitted and no additional message is logged.</span></span> <span data-ttu-id="dfb7f-160">Значение по умолчанию — 10 000.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-160">The default value is 10000.</span></span>  
  
-   <span data-ttu-id="dfb7f-161">Максимальный размер сообщения для входа (`maxSizeOfMessageToLog` атрибут): Это значение указывает максимальный размер сообщения в журнал в байтах.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-161">Max size of message to log (`maxSizeOfMessageToLog` attribute): This value specifies the maximum size of messages to log in bytes.</span></span> <span data-ttu-id="dfb7f-162">Сообщения, превышающие этот размер, в журнал не заносятся, и никакие другие действия с этими сообщениями не выполняются.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-162">Messages that exceed the size limit are not logged, and no other activity is performed for that message.</span></span> <span data-ttu-id="dfb7f-163">Действие этого параметра распространяется на все уровни трассировки.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-163">This setting affects all trace levels.</span></span> <span data-ttu-id="dfb7f-164">Если включена трассировка ServiceModel, в первой точке записи в журнал (ServiceModelSend\* или TransportReceive) создается трассировка порога предупреждений для уведомления пользователя.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-164">If ServiceModel tracing is on, a Warning level trace is emitted at the first logging point (ServiceModelSend\* or TransportReceive) to notify the user.</span></span> <span data-ttu-id="dfb7f-165">Значение по умолчанию для сообщений уровня службы и транспорта составляет 256 КБ, а для сформированных сообщений неправильного формата - 4 КБ.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-165">The default value for service level and transport level messages is 256K, while the default value for malformed messages is 4K.</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="dfb7f-166">Размер сообщения, вычисляемый для сравнения со значением `maxSizeOfMessageToLog`, является размером сообщения в памяти до сериализации.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-166">The message size that is computed to compare against `maxSizeOfMessageToLog` is the message size in memory before serialization.</span></span> <span data-ttu-id="dfb7f-167">Этот размер может отличаться от фактической длины строки сообщения, записываемой в журнал, и часто превышает фактический размер сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-167">This size can differ from the actual length of the message string that is being logged, and in many occasions is bigger than the actual size.</span></span> <span data-ttu-id="dfb7f-168">Поэтому сообщение может быть не записано в журнал.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-168">As a result, messages may not be logged.</span></span> <span data-ttu-id="dfb7f-169">Можно учесть этот факт, установив для атрибута `maxSizeOfMessageToLog` значение, на 10% превышающее ожидаемый размер сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-169">You can account for this fact by specifying the `maxSizeOfMessageToLog` attribute to be 10% larger than the expected message size.</span></span> <span data-ttu-id="dfb7f-170">Кроме того, при внесении в журнал неправильно сформированного сообщения фактическое место на диске, занимаемое журналом сообщений, может до 5 раз превышать размер, задаваемый значением `maxSizeOfMessageToLog`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-170">In addition, if malformed messages are logged, the actual disk space utilized by the message logs can be up to 5 times the size of the value specified by `maxSizeOfMessageToLog`.</span></span>  
  
 <span data-ttu-id="dfb7f-171">Если в файле конфигурации не задан прослушиватель трассировки, в журнал ничего не записывается независимо от установленного уровня ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-171">If no trace listener is defined in the configuration file, no logging output is generated regardless of the specified logging level.</span></span>  
  
 <span data-ttu-id="dfb7f-172">Параметры ведения журнала, например описанные в этом разделе атрибуты, можно изменить во время выполнения с помощью инструментария управления Windows (WMI).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-172">Message logging options, such as the attributes described in this section, can be changed at runtime using Windows Management Instrumentation (WMI).</span></span> <span data-ttu-id="dfb7f-173">Это можно сделать путем доступа к [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) экземпляр, который предоставляет следующим логическим свойствам: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, и `LogMalformedMessages`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-173">This can be done by accessing the [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, and `LogMalformedMessages`.</span></span> <span data-ttu-id="dfb7f-174">Поэтому, если в файле конфигурации прослушиватель трассировки настроен на ведение журнала, но эти параметры имеют значение `false`, можно впоследствии изменить их значения на `true`, когда приложение будет выполняться.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-174">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="dfb7f-175">В результате ведение журнала будет включено во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-175">This effectively enables message logging at runtime.</span></span> <span data-ttu-id="dfb7f-176">Аналогично, если ведение журнала было включено в файле конфигурации, его можно отключить во время выполнения с помощью инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-176">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span> <span data-ttu-id="dfb7f-177">Дополнительные сведения см. в разделе [с помощью Windows Management Instrumentation для диагностики](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="dfb7f-177">For more information, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
 <span data-ttu-id="dfb7f-178">Поле `source` в журнале сообщений определяет контекст, в котором регистрируется сообщение: отправка или получение сообщения с запросом, запрос-ответ или односторонний запрос, модель службы или транспортный уровень, либо сформированное сообщение неправильного формата.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-178">The `source` field in a message log specifies in which context the message is logged: when sending/receiving a request message, for a request-reply or 1-way request, at service model or transport layer, or in the case of a malformed message.</span></span>  
  
 <span data-ttu-id="dfb7f-179">Для сформированных сообщений `source` равен `Malformed`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-179">For malformed messages, `source`  is equal to `Malformed`.</span></span> <span data-ttu-id="dfb7f-180">В противном случае поле source будет иметь следующие значения в зависимости от контекста.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-180">Otherwise, source has the following values based on the context.</span></span>  
  
 <span data-ttu-id="dfb7f-181">Запросы и ответы</span><span class="sxs-lookup"><span data-stu-id="dfb7f-181">For Request/Reply</span></span>  
  
||<span data-ttu-id="dfb7f-182">Отправка запроса</span><span class="sxs-lookup"><span data-stu-id="dfb7f-182">Send Request</span></span>|<span data-ttu-id="dfb7f-183">Получение запроса</span><span class="sxs-lookup"><span data-stu-id="dfb7f-183">Receive Request</span></span>|<span data-ttu-id="dfb7f-184">Отправка ответа</span><span class="sxs-lookup"><span data-stu-id="dfb7f-184">Send Reply</span></span>|<span data-ttu-id="dfb7f-185">Получение ответа</span><span class="sxs-lookup"><span data-stu-id="dfb7f-185">Receive Reply</span></span>|  
|-|------------------|---------------------|----------------|-------------------|  
|<span data-ttu-id="dfb7f-186">Уровень модели службы</span><span class="sxs-lookup"><span data-stu-id="dfb7f-186">Service Model layer</span></span>|<span data-ttu-id="dfb7f-187">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-187">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-188">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-188">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-189">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-189">Send</span></span><br /><br /> <span data-ttu-id="dfb7f-190">Запрос</span><span class="sxs-lookup"><span data-stu-id="dfb7f-190">Request</span></span>|<span data-ttu-id="dfb7f-191">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-191">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-192">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-192">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-193">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-193">Receive</span></span><br /><br /> <span data-ttu-id="dfb7f-194">Запрос</span><span class="sxs-lookup"><span data-stu-id="dfb7f-194">Request</span></span>|<span data-ttu-id="dfb7f-195">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-195">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-196">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-196">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-197">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-197">Send</span></span><br /><br /> <span data-ttu-id="dfb7f-198">Reply</span><span class="sxs-lookup"><span data-stu-id="dfb7f-198">Reply</span></span>|<span data-ttu-id="dfb7f-199">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-199">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-200">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-200">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-201">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-201">Receive</span></span><br /><br /> <span data-ttu-id="dfb7f-202">Reply</span><span class="sxs-lookup"><span data-stu-id="dfb7f-202">Reply</span></span>|  
|<span data-ttu-id="dfb7f-203">Уровень транспорта</span><span class="sxs-lookup"><span data-stu-id="dfb7f-203">Transport layer</span></span>|<span data-ttu-id="dfb7f-204">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-204">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-205">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-205">Send</span></span>|<span data-ttu-id="dfb7f-206">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-206">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-207">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-207">Receive</span></span>|<span data-ttu-id="dfb7f-208">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-208">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-209">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-209">Send</span></span>|<span data-ttu-id="dfb7f-210">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-210">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-211">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-211">Receive</span></span>|  
  
 <span data-ttu-id="dfb7f-212">Односторонний запрос</span><span class="sxs-lookup"><span data-stu-id="dfb7f-212">For One-way Request</span></span>  
  
||<span data-ttu-id="dfb7f-213">Отправка запроса</span><span class="sxs-lookup"><span data-stu-id="dfb7f-213">Send Request</span></span>|<span data-ttu-id="dfb7f-214">Получение запроса</span><span class="sxs-lookup"><span data-stu-id="dfb7f-214">Receive Request</span></span>|  
|-|------------------|---------------------|  
|<span data-ttu-id="dfb7f-215">Уровень модели службы</span><span class="sxs-lookup"><span data-stu-id="dfb7f-215">Service Model layer</span></span>|<span data-ttu-id="dfb7f-216">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-216">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-217">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-217">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-218">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-218">Send</span></span><br /><br /> <span data-ttu-id="dfb7f-219">Datagram</span><span class="sxs-lookup"><span data-stu-id="dfb7f-219">Datagram</span></span>|<span data-ttu-id="dfb7f-220">Служба</span><span class="sxs-lookup"><span data-stu-id="dfb7f-220">Service</span></span><br /><br /> <span data-ttu-id="dfb7f-221">Уровень</span><span class="sxs-lookup"><span data-stu-id="dfb7f-221">Level</span></span><br /><br /> <span data-ttu-id="dfb7f-222">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-222">Receive</span></span><br /><br /> <span data-ttu-id="dfb7f-223">Datagram</span><span class="sxs-lookup"><span data-stu-id="dfb7f-223">Datagram</span></span>|  
|<span data-ttu-id="dfb7f-224">Уровень транспорта</span><span class="sxs-lookup"><span data-stu-id="dfb7f-224">Transport layer</span></span>|<span data-ttu-id="dfb7f-225">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-225">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-226">Отправить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-226">Send</span></span>|<span data-ttu-id="dfb7f-227">Transport</span><span class="sxs-lookup"><span data-stu-id="dfb7f-227">Transport</span></span><br /><br /> <span data-ttu-id="dfb7f-228">Получить</span><span class="sxs-lookup"><span data-stu-id="dfb7f-228">Receive</span></span>|  
  
## <a name="message-filters"></a><span data-ttu-id="dfb7f-229">Фильтры сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-229">Message Filters</span></span>  
 <span data-ttu-id="dfb7f-230">Фильтры сообщений определяются в элементе конфигурации `messageLogging` в разделе `diagnostics`.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-230">Message filters are defined in the `messageLogging` configuration element of the `diagnostics` configuration section.</span></span> <span data-ttu-id="dfb7f-231">Они применяются на уровне службы и транспорта.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-231">They are applied at the service and transport level.</span></span> <span data-ttu-id="dfb7f-232">Если в файле конфигурации определены один или несколько фильтров, в журнал записываются только сообщения, соответствующие хотя бы одному из фильтров.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-232">When one or more filters are defined, only messages that match at least one of the filters are logged.</span></span> <span data-ttu-id="dfb7f-233">Если фильтры не заданы, в журнал записываются все сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-233">If no filter is defined, all messages pass through.</span></span>  
  
 <span data-ttu-id="dfb7f-234">Фильтры поддерживают полный синтаксис XPath и применяются в порядке, в котором они указаны в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-234">Filters support the full XPath syntax and are applied in the order they appear in the configuration file.</span></span> <span data-ttu-id="dfb7f-235">Синтаксически неверные фильтры вызывают исключения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-235">A syntactically incorrect filter results in a configuration exception.</span></span>  
  
 <span data-ttu-id="dfb7f-236">Кроме того, атрибут `nodeQuota` обеспечивает механизм защиты фильтров. Он ограничивает максимальное число узлов объектной модели XPath, которые можно проверить на соответствие фильтру.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-236">Filters also provide a safety feature using the `nodeQuota` attribute, which limits the maximum number of nodes in the XPath DOM that can be examined to match the filter.</span></span>  
  
 <span data-ttu-id="dfb7f-237">В следующем примере показано, как настроить фильтр для записи только сообщений с разделом заголовка SOAP.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-237">The following example shows how to configure a filter that records only messages that have a SOAP header section.</span></span>  
  
```xml  
<messageLogging logEntireMessage="true"  
    logMalformedMessages="true"   
    logMessagesAtServiceLevel="true"  
    logMessagesAtTransportLevel="true"  
    maxMessagesToLog="420">  
    <filters>  
        <add nodeQuota="10" xmlns:soap="http://www.w3.org/2003/05/soap-envelope">  
                 /soap:Envelope/soap:Header  
        </add>  
     </filters>  
</messageLogging>  
```  
  
 <span data-ttu-id="dfb7f-238">Фильтры невозможно применить к тексту сообщения.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-238">Filters cannot be applied to the body of a message.</span></span> <span data-ttu-id="dfb7f-239">Фильтры, которые пытаются изменять текст сообщения, удаляются из списка фильтров.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-239">Filters that attempt to manipulate the body of a message are removed from the list of filters.</span></span> <span data-ttu-id="dfb7f-240">Кроме того, создается событие, указывающее на это.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-240">An event is also emitted that indicates this.</span></span> <span data-ttu-id="dfb7f-241">Например, из таблицы фильтров будет удален следующий фильтр.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-241">For example, the following filter would be removed from the filter table.</span></span>  
  
```xml  
<add xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">/s:Envelope/s:Body[contains(text(), "Hello")]</add>  
```  
  
## <a name="configuring-a-custom-listener"></a><span data-ttu-id="dfb7f-242">Настройка пользовательского прослушивателя</span><span class="sxs-lookup"><span data-stu-id="dfb7f-242">Configuring a Custom Listener</span></span>  
 <span data-ttu-id="dfb7f-243">Имеется возможность настроить пользовательский прослушиватель с дополнительными параметрами.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-243">You can also configure a custom listener with additional options.</span></span> <span data-ttu-id="dfb7f-244">Пользовательский прослушиватель может оказаться полезным для удаления из сообщений элементов с личной информацией, относящихся к конкретным приложениям, перед внесением в журнал этих сообщений.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-244">A custom listener can be useful in filtering application-specific PII elements from messages before logging.</span></span> <span data-ttu-id="dfb7f-245">Ниже показан пример конфигурации пользовательского прослушивателя.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-245">The following example demonstrates a custom listener configuration.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
     <source name="System.ServiceModel.MessageLogging">  
           <listeners>  
             <add name="MyListener"   
                    type="YourCustomListener"  
                    initializeData="c:\logs\messages.svclog"  
                    maxDiskSpace="1000"/>  
           </listeners>  
     </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="dfb7f-246">Следует иметь в виду, что для атрибута `type` следует задавать определенное имя сборки данного типа.</span><span class="sxs-lookup"><span data-stu-id="dfb7f-246">You should be aware that the `type` attribute should be set to a qualified assembly name of the type.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dfb7f-247">См. также</span><span class="sxs-lookup"><span data-stu-id="dfb7f-247">See also</span></span>

- [<span data-ttu-id="dfb7f-248">\<messageLogging ></span><span class="sxs-lookup"><span data-stu-id="dfb7f-248">\<messageLogging></span></span>](../../../../docs/framework/configure-apps/file-schema/wcf/messagelogging.md)
- [<span data-ttu-id="dfb7f-249">Ведение журналов сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-249">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [<span data-ttu-id="dfb7f-250">Рекомендуемые параметры для трассировки и ведения журналов сообщений</span><span class="sxs-lookup"><span data-stu-id="dfb7f-250">Recommended Settings for Tracing and Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md)
