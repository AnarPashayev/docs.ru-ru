---
title: Размещение служб
ms.date: 03/30/2017
helpviewer_keywords:
- hosting services [WCF]
ms.assetid: 192be927-6be2-4fda-98f0-e513c4881acc
ms.openlocfilehash: 9608f9cc55bbba29686440be529659c6606b0eb8
ms.sourcegitcommit: cdf5084648bf5e77970cbfeaa23f1cab3e6e234e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "76921051"
---
# <a name="hosting-services"></a>Службы размещения

Для активации службы ее необходимо разместить в среде выполнения, которая создает эту службу и управляет ее контекстом и временем существования. Службы Windows Communication Foundation (WCF) предназначены для работы в любом процессе Windows, который поддерживает управляемый код.

WCF предоставляет унифицированную модель программирования для создания приложений, ориентированных на службы. Эта модель программирования остается согласованной и не зависит от среды выполнения, в которой развертывается служба. На практике это означает, что код службы всегда выглядит практически одинаково, независимо от вариантов размещения.

Варианты размещения могут самыми различными - от выполнения внутри консольного приложения до серверных сред, таких как службы Windows, выполняемых внутри рабочего процесса, который управляется службами IIS или службой активации Windows (WAS). Разработчики могут выбрать среду размещения, которая соответствует требованиям по развертыванию службы. Эти требования могут определяться платформой, на которой развертывается приложение, транспортом, с помощью которого оно должно отправлять и принимать сообщения, или типом перезапуска процессов и другими механизмами управления процессами, необходимыми для обеспечения нужного уровня доступности службы, а также другими требованиями по управлению и надежности. В следующем разделе приведены сведения и инструкции по применению различных вариантов размещения.

## <a name="hosting-options"></a>Варианты размещения

### <a name="self-host-in-a-managed-application"></a>Самостоятельный хост в управляемом приложении
 Службы WCF могут размещаться в любом управляемом приложении. Это наиболее гибкий вариант, поскольку он почти не требует развертывания инфраструктуры. Код службы внедряется в код управляемого приложения, после чего создается и открывается экземпляр класса <xref:System.ServiceModel.ServiceHost> , чтобы служба стала доступной. Дополнительные сведения см. в разделе [инструкции. размещение службы WCF в управляемом приложении](how-to-host-a-wcf-service-in-a-managed-application.md).

 Этот параметр включает два распространенных сценария: службы WCF, работающие в консольных приложениях, и многофункциональные клиентские приложения, такие как на основе Windows Presentation Foundation (WPF) или Windows Forms (WinForms). Размещение службы WCF внутри консольного приложения обычно полезно на этапе разработки приложения. В этом случае приложение легко отлаживать, удобно получать данные трассировки, чтобы узнать, что происходит внутри приложения, и удобно копировать приложение в другие расположения. Этот вариант размещения также упрощает взаимодействие с полнофункциональными клиентскими приложениями, такими как приложения WPF и WinForms, для взаимодействия с внешним миром. Например, одноранговый клиент совместной работы, использующий WPF для пользовательского интерфейса, а также размещает службу WCF, которая позволяет другим клиентам подключаться к ней и обмениваться информацией.

### <a name="managed-windows-services"></a>Управляемые службы Windows

Этот вариант размещения состоит из регистрации домена приложения (AppDomain), в котором размещена служба WCF, в качестве управляемой службы Windows (прежнее название — служба NT), чтобы Управление временем существования процесса службы управлялось диспетчером управления службами (SCM) для Службы Windows. Как и в случае резидентного размещения, в данном случае код размещения является частью приложения. Служба реализована как служба Windows и как служба WCF, что приводит к наследованию от класса <xref:System.ServiceProcess.ServiceBase>, а также от интерфейса контракта службы WCF. Таким образом, объект <xref:System.ServiceModel.ServiceHost> создается и открывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> и закрывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStop> . Кроме того, необходимо реализовать класс установщика, наследующий классу <xref:System.Configuration.Install.Installer> , чтобы программу можно было устанавливать в качестве службы Windows с помощью средства Installutil.exe. Дополнительные сведения см. в разделе [инструкции. размещение службы WCF в управляемой службе Windows](./feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md). Этот сценарий, включенный параметром размещения управляемой службы Windows, состоит в том, что в безопасной среде служба WCF, размещенная за пределами IIS, не активирована с помощью сообщения. Вместо этого время существования службы контролируется операционной системой. Данный вариант размещения доступен во всех версиях Windows.

### <a name="internet-information-services-iis"></a>службы IIS

Параметр размещения IIS интегрируется с ASP.NET и использует функции, предлагаемые этими технологиями, такие как перезапуск процессов, выключение в режиме простоя, мониторинг работоспособности процессов и активация на основе сообщений. В операционных системах Windows XP и Windows Server 2003 это предпочтительное решение для размещения приложений веб-служб, которые должны поддерживать высокую доступность и масштабируемость. Кроме того, службы IIS обеспечивают встроенные возможности управления, которые обычно присущи серверным продуктам корпоративного уровня. Для реализации этого варианта размещения требуется правильно настроить службу IIS, но не требуется включать в приложение код размещения. Дополнительные сведения о настройке размещения служб IIS для службы WCF см. в разделе [как разместить службу WCF в IIS](./feature-details/how-to-host-a-wcf-service-in-iis.md).

 Службы, размещенные в IIS, могут использовать только транспорт HTTP. Реализация в IIS 5,1 предоставила некоторые ограничения в Windows XP. Активация на основе сообщений, предоставляемая службой WCF службами IIS 5,1 в Windows XP, блокирует все остальные Резидентные службы WCF на том же компьютере, с помощью порта 80. Службы WCF могут работать в том же AppDomain, в пуле приложений или рабочем процессе, что и другие приложения, размещенные в IIS 6,0 на Windows Server 2003. Но поскольку WCF и IIS 6,0 используют стек HTTP режима ядра (HTTP. sys), IIS 6,0 может совместно использовать порт 80 с другими резидентными службами WCF, работающими на том же компьютере, в отличие от IIS 5,1.

### <a name="windows-process-activation-service-was"></a>Служба активации Windows (WAS)

Служба активации Windows (WAS) — это новый механизм активации процессов для Windows Server 2008, который также доступен в Windows Vista. Он содержит знакомую модель процессов IIS 6,0 (пулы приложений и активацию процессов на основе сообщений) и функции размещения (такие как быстрая защита от сбоев, мониторинг работоспособности и повторное использование), но устраняет зависимость от протокола HTTP от активации. AHA. IIS 7,0 использует WAS для выполнения активации на основе сообщений по протоколу HTTP. Дополнительные компоненты WCF также подключаются к, чтобы обеспечить активацию на основе сообщений для других протоколов, поддерживаемых WCF, таких как TCP, MSMQ и именованные каналы. Это позволяет приложениям, которые используют протоколы взаимодействия, использовать функции IIS, такие как перезапуск процессов, быструю защиту от сбоев и систему стандартных конфигураций, которые ранее были доступны только приложениям, работающим на базе протокола HTTP.

 Для реализации этого варианта размещения требуется правильно настроить службу WAS, но не требуется включать в приложение код размещения. Дополнительные сведения о том, как настроить размещение, см. [в разделе как разместить службу WCF в WAS](./feature-details/how-to-host-a-wcf-service-in-was.md).

## <a name="choose-a-hosting-environment"></a>Выбор среды размещения
 В следующей таблице описаны некоторые ключевые преимущества и сценарии, связанные с каждым из вариантов размещения.

|Среда размещения|Распространенные ситуации|Ключевые преимущества и ограничения|
|-------------------------|----------------------|----------------------------------|
|Управляемое приложение (резидентное размещение)|— Приложения консоли, используемые во время разработки.<br />— Широкие клиентские приложения WinForm и WPF, обращающиеся к службам.|Гибк.<br />— Простота развертывания.<br />— Не корпоративное решение для служб.|
|Службы Windows (прежнее название - службы NT)|— Длительно выполняемая служба WCF, размещенная вне служб IIS.|— Время существования процесса службы, управляемое операционной системой, без активации сообщения.<br />— Поддерживается всеми версиями Windows.<br />— Безопасная среда.|
|IIS 5,1, IIS 6,0|— Запуск службы WCF параллельно с содержимым ASP.NET в Интернете по протоколу HTTP.|— Повторное использование процессов.<br />-Shutdown без простоя.<br />— Мониторинг работоспособности процесса.<br />— Активация на основе сообщений.<br />— Только HTTP.|
|Служба активации Windows (WAS)|— Запуск службы WCF без установки служб IIS в Интернете с использованием различных транспортных протоколов.|-IIS не требуется.<br />— Повторное использование процессов.<br />-Shutdown без простоя.<br />— Мониторинг работоспособности процесса.<br />— Активация на основе сообщений.<br />— Работает с HTTP, TCP, именованными каналами и MSMQ.|
|IIS 7.0|— Запуск службы WCF с содержимым ASP.NET.<br />— Запуск службы WCF в Интернете с использованием различных транспортных протоколов.|— БЫЛИ преимущества.<br />— Интегрировано с ASP.NET и содержимым IIS.|

 Выбор среды размещения зависит от версии Windows, в которой она развертывается, транспортных протоколов, с помощью которых требуется отправлять сообщения, и необходимого типа перезапуска процессов и доменов приложений. В следующей таблице приведены сведения, относящиеся к этим требованиям.

|Среда размещения|Доступность платформы|Поддерживаемые транспортные протоколы|Перезапуск процессов и доменов приложений|
|-------------------------|---------------------------|--------------------------|-------------------------------------|
|Управляемые приложения (резидентное размещение)|Windows XP, Windows Server 2003, Windows Vista,<br /><br /> Windows Server 2008|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|
|Службы Windows (прежнее название - службы NT)|Windows XP, Windows Server 2003, Windows Vista,<br /><br /> Windows Server 2008|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|
|IIS 5,1|Windows XP|HTTP|Да|
|IIS 6,0|Windows Server 2003|HTTP|Да|
|Служба активации Windows (WAS)|Windows Vista, Windows Server 2008|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Да|

 Важно отметить, что при запуске службы или любого расширения от недоверенного узла нарушается безопасность. Кроме того, при открытии <xref:System.ServiceModel.ServiceHost> в рамках олицетворения приложение должно убедиться, что пользователь не вышел из системы, например, путем кэширования <xref:System.Security.Principal.WindowsIdentity> пользователя.

## <a name="see-also"></a>См. также:

- [Базовый жизненный цикл программирования](basic-programming-lifecycle.md)
- [Реализация контрактов служб](implementing-service-contracts.md)
- [Практическое руководство. Размещение службы WCF в IIS](./feature-details/how-to-host-a-wcf-service-in-iis.md)
- [Практическое руководство. Размещение службы WCF в WAS](./feature-details/how-to-host-a-wcf-service-in-was.md)
- [Практическое руководство. Размещение службы WCF в управляемой службе Windows](./feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [Практическое руководство. Размещение службы WCF в управляемом приложении](how-to-host-a-wcf-service-in-a-managed-application.md)
