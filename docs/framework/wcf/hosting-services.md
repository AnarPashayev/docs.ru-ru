---
title: Размещение служб
ms.date: 03/30/2017
helpviewer_keywords:
- hosting services [WCF]
ms.assetid: 192be927-6be2-4fda-98f0-e513c4881acc
ms.openlocfilehash: 4641c1c63a4f3c13cefb573dacf4e88b5d63077e
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2019
ms.locfileid: "65881189"
---
# <a name="hosting-services"></a>Размещение служб
Для активации службы ее необходимо разместить в среде выполнения, которая создает эту службу и управляет ее контекстом и временем существования. Службы Windows Communication Foundation (WCF) предназначены для выполнения в любом процессе Windows, который поддерживает управляемый код.  
  
 WCF предоставляет унифицированную модель программирования для создания приложений, ориентированных на службы. Эта модель программирования остается согласованной и не зависит от среды выполнения, в которой развертывается служба. На практике это означает, что код службы всегда выглядит практически одинаково, независимо от вариантов размещения.  
  
 Варианты размещения могут самыми различными - от выполнения внутри консольного приложения до серверных сред, таких как службы Windows, выполняемых внутри рабочего процесса, который управляется службами IIS или службой активации Windows (WAS). Разработчики могут выбрать среду размещения, которая соответствует требованиям по развертыванию службы. Эти требования могут определяться платформой, на которой развертывается приложение, транспортом, с помощью которого оно должно отправлять и принимать сообщения, или типом перезапуска процессов и другими механизмами управления процессами, необходимыми для обеспечения нужного уровня доступности службы, а также другими требованиями по управлению и надежности. В следующем разделе приведены сведения и инструкции по применению различных вариантов размещения.  
  
## <a name="hosting-options"></a>Варианты размещения  
  
#### <a name="self-hosting-in-a-managed-application"></a>Резидентное размещение в управляемом приложении  
 Службы WCF можно размещать в любом управляемом приложении. Это наиболее гибкий вариант, поскольку он почти не требует развертывания инфраструктуры. Код службы внедряется в код управляемого приложения, после чего создается и открывается экземпляр класса <xref:System.ServiceModel.ServiceHost> , чтобы служба стала доступной. Дополнительные сведения см. в разделе [Практическое руководство. Размещение службы WCF в управляемом приложении](../../../docs/framework/wcf/how-to-host-a-wcf-service-in-a-managed-application.md).  
  
 Этот параметр включает два распространенных сценария: Службы WCF, выполняющиеся внутри консольных приложений и многофункциональных клиентских приложений на основе Windows Presentation Foundation (WPF) или Windows Forms (WinForms). Размещение службы WCF внутри консольного приложения обычно используется на этапе разработки приложения. В этом случае приложение легко отлаживать, удобно получать данные трассировки, чтобы узнать, что происходит внутри приложения, и удобно копировать приложение в другие расположения. Кроме того, этот вариант размещения упрощает взаимодействие функционально насыщенных клиентских приложений, таких как приложения [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] и WinForms, с внешними системами. Например, клиент peer-to-peer совместной работы, использующий [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] для пользовательского интерфейса и также размещается служба WCF, позволяющую другим клиентам подключаться к нему и обмениваться информацией.  
  
#### <a name="managed-windows-services"></a>Управляемые службы Windows  
 Этот вариант размещения предполагает регистрацию домена приложения (AppDomain), на котором размещена служба WCF как службу Windows (прежнее название-служба NT), так что время существования процесса службы контролируется диспетчером управления службами (SCM) для Службы Windows. Как и в случае резидентного размещения, в данном случае код размещения является частью приложения. Служба реализуется как услуга Windows и как служба WCF, вызывая его наследование от <xref:System.ServiceProcess.ServiceBase> класса, а также от WCF интерфейсом контракта службы. Таким образом, объект <xref:System.ServiceModel.ServiceHost> создается и открывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> и закрывается с помощью переопределенного метода <xref:System.ServiceProcess.ServiceBase.OnStop> . Кроме того, необходимо реализовать класс установщика, наследующий классу <xref:System.Configuration.Install.Installer> , чтобы программу можно было устанавливать в качестве службы Windows с помощью средства Installutil.exe. Дополнительные сведения см. в разделе [Практическое руководство. Размещение службы WCF в службе Windows, управляемых](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md). Сценарий, реализуемый с помощью управляемой службе Windows, варианта размещения — это долго выполняющейся службы WCF, размещенных вне IIS в защищенной среде, которая является не активируется сообщениями. Вместо этого время существования службы контролируется операционной системой. Данный вариант размещения доступен во всех версиях Windows.  
  
#### <a name="internet-information-services-iis"></a>службы IIS  
 IIS, варианта размещения интегрируется с ASP.NET и использует возможности, которые предоставляют эти технологии, таких как процесс перезапуска, завершение при ожидании, наблюдение за работоспособностью процессов и активация на основе сообщений. В операционных системах [!INCLUDE[wxp](../../../includes/wxp-md.md)] и [!INCLUDE[ws2003](../../../includes/ws2003-md.md)] этот вариант является предпочтительным при размещении приложений веб-служб, которым требуется высокий уровень доступности и масштабируемости. Кроме того, службы IIS обеспечивают встроенные возможности управления, которые обычно присущи серверным продуктам корпоративного уровня. Для реализации этого варианта размещения требуется правильно настроить службу IIS, но не требуется включать в приложение код размещения. Дополнительные сведения о настройке IIS размещения для службы WCF, см. в разделе [как: Размещение службы WCF в IIS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-iis.md).  
  
 Обратите внимание, что службы, размещаемые в IIS, могут использовать только транспорт HTTP. Реализация в IIS 5.1 накладывает некоторые ограничения при использовании [!INCLUDE[wxp](../../../includes/wxp-md.md)]. Активация на основе сообщений, предоставляемые для службы WCF IIS 5.1 в [!INCLUDE[wxp](../../../includes/wxp-md.md)] блокирует все другие резидентной службы WCF на одном компьютере с помощью порта 80. Службы WCF могут работать в одном процессе пула и рабочих домена приложения или приложения, что и другие приложения, если они размещаются в [!INCLUDE[iis601](../../../includes/iis601-md.md)] на [!INCLUDE[ws2003](../../../includes/ws2003-md.md)]. Но так как WCF и [!INCLUDE[iis601](../../../includes/iis601-md.md)] используют стек HTTP режима ядра (HTTP.sys), [!INCLUDE[iis601](../../../includes/iis601-md.md)] можно совместно использовать порт 80 других резидентной службы WCF, работающие на одном компьютере, в отличие от IIS 5.1.  
  
#### <a name="windows-process-activation-service-was"></a>Служба активации Windows (WAS)  
 Служба активации Windows (WAS) - это новый механизм активации процессов для [!INCLUDE[lserver](../../../includes/lserver-md.md)] , который также доступен в [!INCLUDE[wv](../../../includes/wv-md.md)]. Он сохраняет привычную модель процессов [!INCLUDE[iis601](../../../includes/iis601-md.md)] (с использованием пулов приложений и активации процессов с помощью сообщений) и функции размещения (например, быструю отработку сбоев, мониторинг работоспособности служб и их перезапуск), однако его архитектура активации уже не зависит от протокола HTTP. [!INCLUDE[iisver](../../../includes/iisver-md.md)] использует архитектуру WAS для выполнения активации на основе сообщений по протоколу HTTP. Дополнительные компоненты WCF также подключите WAS, обеспечивая активации на основе сообщений для других протоколов, поддерживаемых WCF, таких как TCP, MSMQ и именованных каналов. Это позволяет приложениям, которые используют протоколы взаимодействия, использовать функции IIS, такие как перезапуск процессов, быструю защиту от сбоев и систему стандартных конфигураций, которые ранее были доступны только приложениям, работающим на базе протокола HTTP.  
  
 Для реализации этого варианта размещения требуется правильно настроить службу WAS, но не требуется включать в приложение код размещения. Дополнительные сведения о настройке размещалась, см. в разделе [как: Размещение службы WCF в WAS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-was.md).  
  
## <a name="choosing-a-hosting-environment"></a>Выбор среды размещения  
 В следующей таблице описаны некоторые ключевые преимущества и сценарии, связанные с каждым из вариантов размещения.  
  
|Среда размещения|Стандартные сценарии|Ключевые преимущества и ограничения|  
|-------------------------|----------------------|----------------------------------|  
|Управляемое приложение (резидентное размещение)|— Консольное приложение, используемое во время разработки.<br />-Насыщенное WinForm и [!INCLUDE[avalon2](../../../includes/avalon2-md.md)] клиентских приложений, доступ к службам.|-Гибкие.<br />-Проста в развертывании.<br />-Не корпоративного решения для служб.|  
|Службы Windows (прежнее название - службы NT)|-Долго выполняющейся службой WCF, размещенной за пределами служб IIS.|-Управлять операционной системой, не активируется сообщениями время существования процесса службы.<br />-Поддерживается всеми версиями Windows.<br />— Безопасная среда.|  
|IIS 5.1, [!INCLUDE[iis601](../../../includes/iis601-md.md)]|-Запуск службы WCF side-by-side с содержимым ASP.NET в Интернете по протоколу HTTP.|-Перезапуск процессов.<br />-Shutdown простоя.<br />— Мониторинг работоспособности процессов.<br />-Активация основе сообщений.<br />— Только для HTTP.|  
|Служба активации Windows (WAS)|-Запуск службы WCF без установки IIS в Интернет с использованием различных транспортных протоколов.|— Службы IIS не требуются.<br />-Перезапуск процессов.<br />-Shutdown простоя.<br />— Мониторинг работоспособности процессов.<br />-Активация основе сообщений.<br />-Работает с HTTP, TCP, именованные каналы и MSMQ.|  
|IIS 7.0|-Запуск службы WCF с содержимым ASP.NET.<br />-Запуск службы WCF в Интернете с использованием различных транспортных протоколов.|-Это приложение было преимущества.<br />-Интегрированные с содержимым ASP.NET и IIS.|  
  
 Выбор среды размещения зависит от версии Windows, в которой она развертывается, транспортных протоколов, с помощью которых требуется отправлять сообщения, и необходимого типа перезапуска процессов и доменов приложений. В следующей таблице приведены сведения, относящиеся к этим требованиям.  
  
|Среда размещения|Доступность платформы|Поддерживаемые транспортные протоколы|Перезапуск процессов и доменов приложений|  
|-------------------------|---------------------------|--------------------------|-------------------------------------|  
|Управляемые приложения (резидентное размещение)|[!INCLUDE[wxp](../../../includes/wxp-md.md)], [!INCLUDE[ws2003](../../../includes/ws2003-md.md)], [!INCLUDE[wv](../../../includes/wv-md.md)],<br /><br /> [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|  
|Службы Windows (прежнее название - службы NT)|[!INCLUDE[wxp](../../../includes/wxp-md.md)], [!INCLUDE[ws2003](../../../includes/ws2003-md.md)], [!INCLUDE[wv](../../../includes/wv-md.md)],<br /><br /> [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Нет|  
|IIS 5,1|[!INCLUDE[wxp](../../../includes/wxp-md.md)]|HTTP|Да|  
|[!INCLUDE[iis601](../../../includes/iis601-md.md)]|[!INCLUDE[ws2003](../../../includes/ws2003-md.md)]|HTTP|Да|  
|Служба активации Windows (WAS)|[!INCLUDE[wv](../../../includes/wv-md.md)], [!INCLUDE[lserver](../../../includes/lserver-md.md)]|HTTP,<br /><br /> net.tcp,<br /><br /> net.pipe,<br /><br /> net.msmq|Да|  
  
 Важно отметить, что при запуске службы или любого расширения от недоверенного узла нарушается безопасность. Кроме того, следует иметь в ввиду, что при открытии объекта <xref:System.ServiceModel.ServiceHost> при олицетворении приложение должно следить, чтобы пользователь не вышел из системы, например путем кэширования объекта <xref:System.Security.Principal.WindowsIdentity> этого пользователя.  
  
## <a name="see-also"></a>См. также

- [Требования к системе](../../../docs/framework/wcf/wcf-system-requirements.md)
- [Базовый жизненный цикл программирования](../../../docs/framework/wcf/basic-programming-lifecycle.md)
- [Реализация контрактов служб](../../../docs/framework/wcf/implementing-service-contracts.md)
- [Практическое руководство. Размещение службы WCF в IIS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-iis.md)
- [Практическое руководство. Размещение службы WCF в WAS](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-was.md)
- [Практическое руководство. Размещение службы WCF в службе Windows, управляемых](../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [Практическое руководство. Размещение службы WCF в управляемом приложении](../../../docs/framework/wcf/how-to-host-a-wcf-service-in-a-managed-application.md)
