---
title: Настройка поддержки транзакций WS-Atomic
ms.date: 03/30/2017
helpviewer_keywords:
- WS-AT protocol [WCF], configuring WS-Atomic Transaction
ms.assetid: cb9f1c9c-1439-4172-b9bc-b01c3e09ac48
ms.openlocfilehash: 2ec4fd65b97808fbf1a8401f5c0913face5835f0
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64651137"
---
# <a name="configuring-ws-atomic-transaction-support"></a>Настройка поддержки транзакций WS-Atomic
В этой теме описывается, как можно настроить поддержку WS-AtomicTransaction (WS-AT) с помощью программы конфигурации WS-AT.  
  
## <a name="using-the-ws-at-configuration-utility"></a>Использование программы конфигурации WS-AT.  
 Программа конфигурации WS-AT (wsatConfig.exe) используется для настройки параметров WS-AT. Чтобы включить службу протокола WS-AT, с помощью программы конфигурации следует настроить порт HTTPS для WS-AT, привязать сертификат X.509 к порту HTTPS и настроить сертификаты авторизованных партнеров, указав имена субъектов сертификатов или отпечатки. Программа конфигурации также позволяет выбрать режим трассировки и задать значения времени ожидания по умолчанию для исходящих и максимальных входящих транзакций.  
  
 Функциями этой программы можно воспользоваться с помощью оснастки страницы свойств консоли управления (MMC) в консоли управления службами компонентов или с помощью окна командной строки. Настройте поддержку WS-AT на локальном компьютере с помощью окна командной строки; задайте параметры на локальных и удаленных компьютерах с помощью оснастки MMC.  
  
 Окно командной строки можно открыть в папке установки Windows SDK "%WINDIR%\Microsoft.NET\Framework\v3.0\Windows Communication Foundation".  
  
 Дополнительные сведения о средстве командной строки см. в разделе [служебную программу настройки WS-AtomicTransaction (wsatConfig.exe)](../../../../docs/framework/wcf/ws-atomictransaction-configuration-utility-wsatconfig-exe.md).  
  
 Если вы используете [!INCLUDE[wxp](../../../../includes/wxp-md.md)] или [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)], доступны оснастки MMC, перейдя по адресу **элемента управления панели/Администрирование/службы компонентов**, щелкните правой кнопкой мыши **Мой компьютер**, и выбрав **свойства**. Здесь же можно настроить координатор распределенных транзакций (Майкрософт). Доступные для настройки параметры сгруппированы под **WS-AT** вкладки. Если вы используете Windows Vista или [!INCLUDE[lserver](../../../../includes/lserver-md.md)], оснастку MMC можно найти, щелкнув **запустить** и введите `dcomcnfg.exe` в **поиска** поле. При открытии консоли MMC перейдите к **транзакций Мой компьютер\координатор распределенных транзакций\локальный DTC** узел, щелкните правой кнопкой мыши и выберите **свойства**. Доступные для настройки параметры сгруппированы под **WS-AT** вкладки.  
  
 Дополнительные сведения об оснастке см. в разделе [оснастку MMC конфигурации WS-AtomicTransaction](../../../../docs/framework/wcf/ws-atomictransaction-configuration-mmc-snap-in.md).  
  
 Для работы с пользовательским интерфейсом средства необходимо зарегистрировать файл WsatUI.dll. Путь к этому файлу:  
  
 %PROGRAMFILES%\Microsoft SDKs\Windows\v6.0\Bin  
  
 Чтобы зарегистрировать продукт, выполните следующую команду в окне командной строки:  
  
 `regasm.exe /codebase WsatUI.dll`  
  
## <a name="enabling-ws-at"></a>Включение WS-AT  
 Чтобы включить службу протокола WS-AT в MSDTC с использованием порта 443 и сертификата X.509 с закрытым ключом, установленным в хранилище локального компьютера, используйте средство wsatConfig.exe со следующей командой.  
  
 `WsatConfig.exe –network:enable –port:8443 –endpointCert:<machine|"Issuer\SubjectName"> -accountsCerts:<thumbprint|"Issuer\SubjectName"> -restart`  
  
 Замените соответствующие параметры значениями, подходящими для вашей среды.  
  
 Чтобы выключить службу протокола WS-AT в MSDTC, используйте средство wsatConfig.exe со следующей командой.  
  
 `WsatConfig.exe –network:disable -restart`  
  
## <a name="configuring-trust-between-two-machines"></a>Настройка параметров доверия между двумя компьютерами  
 Для службы протокола WS-AT требуется, чтобы администратор явно авторизовал отдельные учетные записи для их участия в распределенных транзакциях. Администратор двух компьютеров может настроить оба из них, чтобы они установили взаимно доверенные отношения путем обмена правильным набором сертификатов между компьютерами, их установки в соответствующие хранилища сертификатов и использования средства wsatConfig.exe для добавления сертификата каждого компьютера в список сертификатов авторизованных участников другого компьютера. Эта процедура необходима для выполнения распределенных транзакций между двумя компьютерами с WS-AT.  
  
 В следующем примере описываются этапы установления доверия между двумя компьютерами, A и B.  
  
### <a name="creating-and-exporting-certificates"></a>Создание и экспорт сертификатов  
 Для этой процедуры требуется оснастка диспетчера сертификатов MMC. Чтобы открыть эту оснастку, выберите меню «Пуск - Выполнить», введите «mmc» в поле ввода и нажмите кнопку «ОК». Затем в **Консоль1** окно, перейдите к **файл/Добавить-удалить** оснастку, щелкните "Добавить" и выберите **сертификаты** из **изолированных Оснастки** списка. Наконец, выберите **учетная запись компьютера** для управления и нажмите кнопку **ОК**. **Сертификаты** в консоли оснастки появится узел.  
  
 Чтобы установить доверенные отношения, необходимо уже иметь в наличии необходимые сертификаты. Чтобы узнать, как создать и установить новые сертификаты до следующие действия, см. в разделе [как: Создание и настройка временных сертификатов в WCF во время разработки](https://go.microsoft.com/fwlink/?LinkId=158925).  
  
1. На компьютере A, использующем оснастку диспетчера сертификатов MMC, импортируйте существующий сертификат (certA) в хранилище LocalMachine\MY (Личный узел) и LocalMachine\ROOT (узел доверенного корневого центра сертификации). Чтобы импортировать сертификат для определенного узла, щелкните правой кнопкой мыши узел и выберите **все задачи/Импорт**.  
  
2. На компьютере B, использующем оснастку диспетчера сертификатов MMC, создайте или получите сертификат (certB) с закрытым ключом и импортируйте его в хранилище LocalMachine\MY (личный узел) и LocalMachine\ROOT (узел доверенного корневого центра сертификации).  
  
3. Экспортируйте открытый ключ certA в файл, если это еще не сделано.  
  
4. Экспортируйте открытый ключ certB в файл, если это еще не сделано.  
  
### <a name="establishing-mutual-trust-between-machines"></a>Установка взаимного доверия между компьютерами  
  
1. На компьютере A импортируйте файловое представление certB в хранилища LocalMachine\MY и LocalMachine\ROOT. Это объявляет, что компьютер A доверяет certB связываться с ним.  
  
2. На компьютере B импортируйте файл certA в хранилища LocalMachine\MY и LocalMachine\ROOT. Это подразумевает, что компьютер B доверяет certA связываться с ним.  
  
 По завершении этих этапов между двумя компьютерами устанавливаются отношения доверия, и их можно настроить таким образом, чтобы они связывались друг с другом с использованием WS-AT.  
  
### <a name="configuring-msdtc-to-use-certificates"></a>Настройка MSDTC для использования сертификатов  
 Поскольку служба протокола WS-AT работает как клиент и как сервер, она должна прослушивать входящие подключения и инициировать исходящие. Поэтому координатор MSDTC необходимо настроить таким образом, чтобы он знал, какой сертификат использовать для связи с внешними сторонами, а какие авторизовывать во время приема входящего подключения.  
  
 Это можно осуществить с помощью оснастки MMC WS-AT. Дополнительные сведения об использовании этого инструмента см. в разделе [оснастку MMC конфигурации WS-AtomicTransaction](../../../../docs/framework/wcf/ws-atomictransaction-configuration-mmc-snap-in.md) раздела. Далее описывается, как устанавливать отношения доверия между двумя компьютерами с MSDTC.  
  
1. Задайте параметры компьютера A. Для «Сертификата конечной точки» выберите certA. Для «Авторизованных сертификатов» выберите certB.  
  
2. Задайте параметры компьютера B. Для «Сертификата конечной точки» выберите certB. Для «Авторизованных сертификатов» выберите certA.  
  
> [!NOTE]
>  Когда один компьютер отправляет сообщение другому, отправитель пытается проверить совпадение имени субъекта сертификата получателя и имени компьютера получателя. Если они не совпадают, проверка сертификата завершается ошибкой и оба компьютера не могут связываться друг с другом.  
>   
>  Для компьютера, входящего в состав домена, имя представляет собой полное доменное имя. По умолчанию имя компьютера в рабочей группе является именем NetBIOS компьютера. Однако имя также может содержать суффикс службы доменных имен (DNS), если он используется для подключения между двумя компьютерами.  
>   
>  Если имя компьютера меняется, например, когда компьютер рабочей группы входит в состав домена, необходимо повторно выдать сертификаты или вручную настроить суффиксы DNS.  
  
## <a name="security"></a>Безопасность  
 Поскольку некоторые параметры, относящиеся к MSDTC и WS-AT, хранятся в реестре в разделе HKLM\Software\Microsoft\MSDTC и HKLM\Software\Microsoft\WSAT соответственно, убедитесь, что эти ключи реестра защищены и только администраторы могут указывать в них значения. В редакторе реестра щелкните правой кнопкой мыши ключ, который требуется защитить и выберите **разрешение** задать соответствующее управление доступом. Для обеспечения безопасности и целостности системы крайне важно, чтобы для важных ключей был задан атрибут «только для чтения» для пользователей с ограниченными правами доступа.  
  
 При развертывании MSDTC администратор должен обеспечить безопасность обмена любыми данными MSDTC. При развертывании рабочей группы изолируйте инфраструктуру транзакций от злоумышленников. При кластерном развертывании защитите реестр кластера.  
  
## <a name="tracing"></a>Трассировка  
 WS-AT протокол поддерживает службы интеграции, транзакции, определенной трассировка, которая может включается и управляется с помощью [оснастку MMC конфигурации WS-AtomicTransaction](../../../../docs/framework/wcf/ws-atomictransaction-configuration-mmc-snap-in.md) средство.  Трассировки могут включать в себя данные, указывающие на время создания зачисления для определенной транзакции, время достижения транзакцией конечного состояния и результат, полученный зачислением каждой транзакции. Все трассировки можно просмотреть с помощью [программа Service Trace Viewer (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md) средство.  
  
 Служба протокола WS-AT также поддерживает интегрированную трассировку ServiceModel во время сеанса трассировки ETW. Результатом этого являются более подробные трассировки, относящиеся к связи, в дополнение к существующим трассировкам транзакций.  Чтобы включить такие дополнительные трассировки, выполните следующие действия.  
  
1. Откройте **Пуск/Выполнить** меню, введите «regedit» в поле ввода и выберите **ОК**.  
  
2. В **редактора реестра**, перейдите в следующую папку на левой панели, Hkey_Local_Machine\SOFTWARE\Microsoft\WSAT\3.0\  
  
3. Щелкните правой кнопкой мыши `ServiceModelDiagnosticTracing` значение в области справа и выберите **изменить**.  
  
4. В **значение** поле ввода, введите одно из следующих допустимых значений для указания уровня трассировки, необходимо включить.  
  
- 0: выключено  
  
- 1: критично  
  
- 3: ошибка. Это значение по умолчанию  
  
- 7: предупреждение  
  
- 15: информация  
  
- 31: подробно  
  
## <a name="see-also"></a>См. также

- [Служебная программа конфигурации WS-AtomicTransaction (wsatConfig.exe)](../../../../docs/framework/wcf/ws-atomictransaction-configuration-utility-wsatconfig-exe.md)
- [Оснастка консоли MMC для конфигурации WS-AtomicTransaction](../../../../docs/framework/wcf/ws-atomictransaction-configuration-mmc-snap-in.md)
