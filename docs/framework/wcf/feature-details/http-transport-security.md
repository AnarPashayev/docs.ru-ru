---
title: Безопасность транспорта HTTP
ms.date: 03/30/2017
ms.assetid: d3439262-c58e-4d30-9f2b-a160170582bb
ms.openlocfilehash: b7415dcc1e6c4a5d47d9e7b6e70a86ab1b898783
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59113806"
---
# <a name="http-transport-security"></a><span data-ttu-id="bb0c3-102">Безопасность транспорта HTTP</span><span class="sxs-lookup"><span data-stu-id="bb0c3-102">HTTP Transport Security</span></span>
<span data-ttu-id="bb0c3-103">Если в качестве транспорта используется протокол HTTP, безопасность обеспечивается реализацией протокола SSL (Secure Sockets Layer).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-103">When using HTTP as the transport, security is provided by a Secure Sockets Layer (SSL) implementation.</span></span> <span data-ttu-id="bb0c3-104">Протокол SSL широко используется в Интернете для проверки подлинности службы при подключении клиента, а затем и для обеспечения конфиденциальности (шифрования) канала.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-104">SSL is widely used on the Internet to authenticate a service to a client, and then to provide confidentiality (encryption) to the channel.</span></span> <span data-ttu-id="bb0c3-105">В этом разделе объясняется, как SSL работает и как это реализуется в Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-105">This topic explains how SSL works and how it is implemented in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="basic-ssl"></a><span data-ttu-id="bb0c3-106">Базовый SSL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-106">Basic SSL</span></span>  
 <span data-ttu-id="bb0c3-107">Лучше всего функционирование SSL можно продемонстрировать с помощью стандартного сценария, в данном случае - веб-сайта банка.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-107">How SSL works is best explained through a typical scenario, in this case, a bank's Web site.</span></span> <span data-ttu-id="bb0c3-108">Сайт позволяет клиенту входить в систему с помощью имени пользователя и пароля.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-108">The site allows a customer to log on with a user name and password.</span></span> <span data-ttu-id="bb0c3-109">После прохождения проверки подлинности пользователь может совершать различные транзакции, например просматривать балансы счетов, оплачивать счета и переводить деньги с одного счета на другой.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-109">After being authenticated, the user can perform transactions, such as view account balances, pay bills, and move money from one account to another.</span></span>  
  
 <span data-ttu-id="bb0c3-110">Когда пользователь посещает сайт впервые, механизм SSL начинает серию согласований, которая называется *подтверждения*, с клиентом пользователя (в данном случае Internet Explorer).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-110">When a user first visits the site, the SSL mechanism begins a series of negotiations, called a *handshake*, with the user's client (in this case, Internet Explorer).</span></span> <span data-ttu-id="bb0c3-111">Во-первых, SSL проводит проверку подлинности сайта банка для клиента.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-111">SSL first authenticates the bank site to the customer.</span></span> <span data-ttu-id="bb0c3-112">Это очень важный шаг, так как в первую очередь клиенты должны знать, что они взаимодействуют с настоящим сайтом, а не подделкой, с помощью которой злоумышленники пытаются обманным путем получить их имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-112">This is an essential step because customers must first know that they are communicating with the actual site, and not a spoof that tries to lure them into typing in their user name and password.</span></span> <span data-ttu-id="bb0c3-113">SSL проводит такую проверку подлинности с помощью сертификата SSL, предоставляемого надежным центром сертификации, таким как VeriSign.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-113">SSL does this authentication by using an SSL certificate provided by a trusted authority, such as VeriSign.</span></span> <span data-ttu-id="bb0c3-114">Логика выглядит следующим образом: VeriSign подтверждает удостоверение сайта банка.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-114">The logic goes like this: VeriSign vouches for the identity of the bank site.</span></span> <span data-ttu-id="bb0c3-115">Поскольку Internet Explorer доверяет VeriSign, этот сайт считается надежным.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-115">Because Internet Explorer trusts VeriSign, the site is trusted.</span></span> <span data-ttu-id="bb0c3-116">Если вы хотите осуществлять проверку с VeriSign, щелкните по логотипу VeriSign.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-116">If you want to check with VeriSign, you can do so as well by clicking on the VeriSign logo.</span></span> <span data-ttu-id="bb0c3-117">Сертификат VeriSign представляет утверждение подлинности с датой истечения срока действия и указанием, кому был выписан сертификат (сайту банка).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-117">That presents a statement of authenticity with its expiration date and who it is issued to (the bank site).</span></span>  
  
 <span data-ttu-id="bb0c3-118">Чтобы инициировать безопасный сеанс, клиент отправляет серверу эквивалент приветствия, а также список алгоритмов шифрования, которые могут быть использованы клиентом для подписания, шифрования и расшифровки данных и создания хэшей.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-118">To initiate a secure session, the client sends the equivalent of a "hello" to the server along with a list of cryptographic algorithms it can use to sign, generate hashes, and encrypt and decrypt with.</span></span> <span data-ttu-id="bb0c3-119">В ответ сайт отправляет подтверждение и указывает, какой набор алгоритмов был выбран.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-119">In response, the site sends back an acknowledgment and its choice of one of the algorithms suites.</span></span> <span data-ttu-id="bb0c3-120">В ходе такого первоначального подтверждения оба участника посылают и отправляют специальные слова.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-120">During this initial handshake, both parties send and receive nonces.</span></span> <span data-ttu-id="bb0c3-121">Объект *nonce* является случайным образом созданный блок данных, используемый, в сочетании с помощью открытого ключа сайта, для создания хэша.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-121">A *nonce* is a randomly generated piece of data that is used, in combination with the site's public key, to create a hash.</span></span> <span data-ttu-id="bb0c3-122">Объект *хэш* новый номер, который является производным от двух чисел с помощью стандартного алгоритма, такого как SHA1.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-122">A *hash* is a new number that is derived from the two numbers using a standard algorithm, such as SHA1.</span></span> <span data-ttu-id="bb0c3-123">(Клиент и сайт также обмениваются сообщениями, чтобы согласовать, какой хэш-алгоритм следует использовать.) Хэш уникален и используется только для шифрования и расшифровки сообщений в ходе сеанса между клиентом и сайтом.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-123">(The client and the site also exchange messages to agree which hash algorithm to use.) The hash is unique and is used only for the session between the client and the site to encrypt and decrypt messages.</span></span> <span data-ttu-id="bb0c3-124">Как клиент, так и служба имеют исходное специальное слово и открытый ключ сертификата, поэтому обе стороны могут создать один и тот же хэш.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-124">Both client and service have the original nonce and the certificate's public key, so both sides can generate the same hash.</span></span> <span data-ttu-id="bb0c3-125">Следовательно, клиент проверяет хэш, отправленный службой, (а) используя согласованный алгоритм для вычисления хэша из данных и (б) сравнивая его с хэшем, отправленным службой; если хэши соответствуют друг другу, клиент может быть уверен, что хэш не был подделан.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-125">Therefore, the client validates the hash sent by the service by (a) using the agreed upon algorithm to calculate the hash from the data, and (b) comparing it to the hash sent by the service; if the two match, then the client has assurance that the hash has not been tampered with.</span></span> <span data-ttu-id="bb0c3-126">После этого клиент может использовать этот хэш в качестве ключа для шифрования сообщения, которое содержит другой, новый хэш.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-126">The client can then use this hash as a key to encrypt a message that contains yet another new hash.</span></span> <span data-ttu-id="bb0c3-127">Служба может расшифровать сообщение с помощью хэша и восстановить предпоследний хэш.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-127">The service can decrypt the message using the hash, and recover this second-to-final hash.</span></span> <span data-ttu-id="bb0c3-128">Теперь накопленная информация (специальные слова, открытый ключ и другие данные) известна обеим сторонам, и они могут создать окончательный хэш (или главный ключ).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-128">The accumulated information (nonces, public key, and other data) is now known to both sides, and a final hash (or master key) can be created.</span></span> <span data-ttu-id="bb0c3-129">Окончательный ключ отправляется зашифрованным с использованием предпоследнего хэша.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-129">This final key is sent encrypted using the next-to-last hash.</span></span> <span data-ttu-id="bb0c3-130">Затем главный ключ используется для шифрования и расшифровки сообщений для остальной части сеанса.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-130">The master key is then used to encrypt and decrypt messages for the rest of the session.</span></span> <span data-ttu-id="bb0c3-131">Так как клиент и служба используют тот же ключ, также называется *сеансовый ключ*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-131">Because both client and service use the same key, this is also called a *session key*.</span></span>  
  
 <span data-ttu-id="bb0c3-132">Сеансовый ключ также характеризуется как симметричный ключ или "общий секрет".</span><span class="sxs-lookup"><span data-stu-id="bb0c3-132">The session key is also characterized as a symmetric key, or a "shared secret."</span></span> <span data-ttu-id="bb0c3-133">Наличие симметричного ключа очень важно, так как благодаря этому обоим участникам транзакции требуется выполнять меньше вычислений.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-133">Having a symmetric key is important because it reduces the computation required by both sides of the transaction.</span></span> <span data-ttu-id="bb0c3-134">Если бы для каждого сообщения приходилось заново обмениваться специальными словами и хэшами, это значительно бы снизило производительность.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-134">If every message demanded a new exchange of nonces and hashes, performance would deteriorate.</span></span> <span data-ttu-id="bb0c3-135">Следовательно, конечной целью сертификатов SSL является использование симметричного ключа, благодаря чему оба участника взаимодействия могут свободно, более безопасно и эффективно обмениваться сообщениями.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-135">Therefore, the ultimate goal of SSL is to use a symmetric key that allows messages to flow freely between the two sides with a greater degree of security and efficiency.</span></span>  
  
 <span data-ttu-id="bb0c3-136">Предыдущее описание представляет собой упрощенную версию происходящего, так как протокол по-разному функционирует на разных сайтах.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-136">The previous description is a simplified version of what happens, because the protocol may vary from site to site.</span></span> <span data-ttu-id="bb0c3-137">Возможно также, что и клиент, и сайт создают специальные слова, которые алгоритмически сочетаются во время подтверждения, усложняя тем самым процесс обмена данными, одновременно обеспечивая его дополнительную защиту.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-137">It is also possible that both the client and the site both generate nonces that are algorithmically combined during the handshake to add more complexity, and therefore protection, to the process of exchanging data.</span></span>  
  
### <a name="certificates-and-public-key-infrastructure"></a><span data-ttu-id="bb0c3-138">Сертификаты и инфраструктура открытого ключа</span><span class="sxs-lookup"><span data-stu-id="bb0c3-138">Certificates and Public Key Infrastructure</span></span>  
 <span data-ttu-id="bb0c3-139">Во время подтверждения служба также отправляет свой SSL-сертификат клиенту.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-139">During the handshake, the service also sends its SSL certificate to the client.</span></span> <span data-ttu-id="bb0c3-140">В сертификате содержится различная информация, такая как дата истечения срока действия, центр выдачи и универсальный код ресурса (URI) сайта.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-140">The certificate contains information, such as its expiration date, issuing authority, and the site's Uniform Resource Identifier (URI).</span></span> <span data-ttu-id="bb0c3-141">Клиент сравнивает этот URI с универсальным кодом ресурса, с которым он взаимодействовал изначально, чтобы убедиться, что они соответствуют друг другу, затем клиент проверяет дату и центр выдачи сертификата.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-141">The client compares the URI to the URI it had originally contacted to ensure a match, and also checks the date and issuing authority.</span></span>  
  
 <span data-ttu-id="bb0c3-142">Каждый сертификат имеет два ключа, закрытый ключ и открытый ключ, а также известные как *пара ключей обмена*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-142">Every certificate has two keys, a private key and a public key, and the two are known as an *exchange key pair*.</span></span> <span data-ttu-id="bb0c3-143">Вкратце, закрытый ключ известен только владельцу сертификата, а открытый ключ можно прочитать из сертификата.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-143">In brief, the private key is known only to the owner of the certificate while the public key is readable from the certificate.</span></span> <span data-ttu-id="bb0c3-144">Любой из них можно использовать для шифрования и расшифровки хэш-кода, хэша или другого ключа, но только как противоположные операции.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-144">Either key can be used to encrypt or decrypt a digest, hash, or other key, but only as contrary operations.</span></span> <span data-ttu-id="bb0c3-145">Например, если клиент осуществляет шифрование с использованием открытого ключа, только сайт может расшифровать сообщение с помощью закрытого ключа.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-145">For example, if the client encrypts with the public key, only the site can decrypt the message using the private key.</span></span> <span data-ttu-id="bb0c3-146">Аналогично, если сайт осуществляет шифрование с помощью закрытого ключа, клиент может расшифровать данные с помощью открытого ключа.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-146">Similarly, if the site encrypts with the private key, the client can decrypt with the public key.</span></span> <span data-ttu-id="bb0c3-147">Благодаря этому клиент уверен, что обменивается сообщениями только с обладателем закрытого ключа, так как только сообщения, зашифрованные с помощью закрытого ключа, можно расшифровать с использованием открытого ключа.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-147">This provides assurance to the client that the messages are being exchanged only with the possessor of the private key because only messages encrypted with the private key can be decrypted with the public key.</span></span> <span data-ttu-id="bb0c3-148">При этом сайт уверен, что обменивается сообщениями с клиентом, осуществившим шифрование с использованием открытого ключа.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-148">The site is assured that it is exchanging messages with a client that has encrypted using the public key.</span></span> <span data-ttu-id="bb0c3-149">Такой обмен надежен только на этапе первоначального подтверждения, поэтому создание фактического симметричного ключа представляет собой гораздо более сложную процедуру.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-149">This exchange is secure only for an initial handshake, however, which is why much more is done to create the actual symmetric key.</span></span> <span data-ttu-id="bb0c3-150">Тем не менее, все виды взаимодействия зависят от наличия у службы действительного SSL-сертификата.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-150">Nevertheless, all communications depend on the service having a valid SSL certificate.</span></span>  
  
## <a name="implementing-ssl-with-wcf"></a><span data-ttu-id="bb0c3-151">Реализация SSL с WCF</span><span class="sxs-lookup"><span data-stu-id="bb0c3-151">Implementing SSL with WCF</span></span>  
 <span data-ttu-id="bb0c3-152">Безопасность транспорта HTTP (или SSL) предоставляется извне WCF.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-152">HTTP transport security (or SSL) is provided externally to WCF.</span></span> <span data-ttu-id="bb0c3-153">SSL можно реализовать одним из двух способов; при этом выбор способа определяется размещением приложения.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-153">You can implement SSL in one of two ways; the deciding factor is how your application is hosted:</span></span>  
  
-   <span data-ttu-id="bb0c3-154">Если вы используете Internet Information Services (IIS) в качестве узла WCF, используйте инфраструктуру IIS для настройки службы SSL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-154">If you are using Internet Information Services (IIS) as your WCF host, use the IIS infrastructure to set up an SSL service.</span></span>  
  
-   <span data-ttu-id="bb0c3-155">При создании резидентного приложения WCF, можно привязать SSL-сертификат к адресу, с помощью средства HttpCfg.exe.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-155">If you are creating a self-hosted WCF application, you can bind an SSL certificate to the address using the HttpCfg.exe tool.</span></span>  
  
### <a name="using-iis-for-transport-security"></a><span data-ttu-id="bb0c3-156">Использование служб IIS для безопасности транспорта</span><span class="sxs-lookup"><span data-stu-id="bb0c3-156">Using IIS for Transport Security</span></span>  
  
#### <a name="iis-70"></a><span data-ttu-id="bb0c3-157">IIS 7.0</span><span class="sxs-lookup"><span data-stu-id="bb0c3-157">IIS 7.0</span></span>  
 <span data-ttu-id="bb0c3-158">Чтобы настроить [!INCLUDE[iisver](../../../../includes/iisver-md.md)] качестве надежного узла (с использованием SSL), см. в разделе [бета-версия IIS 7.0: Настройка SSL в IIS 7.0](https://go.microsoft.com/fwlink/?LinkId=88600).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-158">To set up [!INCLUDE[iisver](../../../../includes/iisver-md.md)] as a secure host (using SSL), see [IIS 7.0 Beta: Configuring Secure Sockets Layer in IIS 7.0](https://go.microsoft.com/fwlink/?LinkId=88600).</span></span>  
  
 <span data-ttu-id="bb0c3-159">Настройка сертификатов для использования с [!INCLUDE[iisver](../../../../includes/iisver-md.md)], см. в разделе [бета-версия IIS 7.0: Настройка сертификатов сервера в IIS 7.0](https://go.microsoft.com/fwlink/?LinkID=88595).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-159">To configure certificates for use with [!INCLUDE[iisver](../../../../includes/iisver-md.md)], see [IIS 7.0 Beta: Configuring Server Certificates in IIS 7.0](https://go.microsoft.com/fwlink/?LinkID=88595).</span></span>  
  
#### <a name="iis-60"></a><span data-ttu-id="bb0c3-160">IIS 6,0</span><span class="sxs-lookup"><span data-stu-id="bb0c3-160">IIS 6.0</span></span>  
 <span data-ttu-id="bb0c3-161">Чтобы настроить [!INCLUDE[iis601](../../../../includes/iis601-md.md)] качестве надежного узла (с использованием SSL), см. в разделе [Настройка SSL](https://go.microsoft.com/fwlink/?LinkId=88601).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-161">To set up [!INCLUDE[iis601](../../../../includes/iis601-md.md)] as a secure host (using SSL), see [Configuring Secure Sockets Layer](https://go.microsoft.com/fwlink/?LinkId=88601).</span></span>  
  
 <span data-ttu-id="bb0c3-162">Настройка сертификатов для использования с [!INCLUDE[iis601](../../../../includes/iis601-md.md)], см. в разделе [Certificates_IIS_SP1_Ops](https://go.microsoft.com/fwlink/?LinkId=88602).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-162">To configure certificates for use with [!INCLUDE[iis601](../../../../includes/iis601-md.md)], see [Certificates_IIS_SP1_Ops](https://go.microsoft.com/fwlink/?LinkId=88602).</span></span>  
  
### <a name="using-httpcfg-for-ssl"></a><span data-ttu-id="bb0c3-163">Использование средства HttpCfg для SSL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-163">Using HttpCfg for SSL</span></span>  
 <span data-ttu-id="bb0c3-164">Если вы создаете резидентного приложения WCF, загрузите средство HttpCfg.exe, доступное на [средства для поддержки Windows XP Service Pack 2 узла](https://go.microsoft.com/fwlink/?LinkId=29002).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-164">If you are creating a self-hosted WCF application, download the HttpCfg.exe tool, available at the [Windows XP Service Pack 2 Support Tools site](https://go.microsoft.com/fwlink/?LinkId=29002).</span></span>  
  
 <span data-ttu-id="bb0c3-165">Дополнительные сведения об использовании средства HttpCfg.exe для настройки порта с сертификатом X.509, см. в разделе [как: Настройка порта SSL-сертификат](../../../../docs/framework/wcf/feature-details/how-to-configure-a-port-with-an-ssl-certificate.md).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-165">For more information about using the HttpCfg.exe tool to set up a port with an X.509 certificate, see [How to: Configure a Port with an SSL Certificate](../../../../docs/framework/wcf/feature-details/how-to-configure-a-port-with-an-ssl-certificate.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bb0c3-166">См. также</span><span class="sxs-lookup"><span data-stu-id="bb0c3-166">See also</span></span>

- [<span data-ttu-id="bb0c3-167">Безопасность транспорта</span><span class="sxs-lookup"><span data-stu-id="bb0c3-167">Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/transport-security.md)
- [<span data-ttu-id="bb0c3-168">Безопасность сообщений</span><span class="sxs-lookup"><span data-stu-id="bb0c3-168">Message Security</span></span>](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)
