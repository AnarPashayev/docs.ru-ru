---
title: Очереди в WCF
ms.date: 03/30/2017
ms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112
ms.openlocfilehash: e6608a3d556b546660be904eb8c853243e833d2e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184565"
---
# <a name="queuing-in-wcf"></a><span data-ttu-id="4bae6-102">Очереди в WCF</span><span class="sxs-lookup"><span data-stu-id="4bae6-102">Queuing in WCF</span></span>
<span data-ttu-id="4bae6-103">В этом разделе описывается, как использовать коммуникацию в очереди в Фонде связи Windows (WCF).</span><span class="sxs-lookup"><span data-stu-id="4bae6-103">This section describes how to use queued communication in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="queues-as-a-wcf-transport-binding"></a><span data-ttu-id="4bae6-104">Очереди в качестве привязки транспорта WCF</span><span class="sxs-lookup"><span data-stu-id="4bae6-104">Queues as a WCF transport binding</span></span>  
 <span data-ttu-id="4bae6-105">В WCF в контрактах указывается, что происходит обмен.</span><span class="sxs-lookup"><span data-stu-id="4bae6-105">In WCF, the contracts specify what is being exchanged.</span></span> <span data-ttu-id="4bae6-106">Контракты представляют собой обмен сообщениями, связанными с бизнес-требованиями или конкретными приложениями.</span><span class="sxs-lookup"><span data-stu-id="4bae6-106">Contracts are business-dependent or application-specific message exchanges.</span></span> <span data-ttu-id="4bae6-107">Механизм, с помощью которого осуществляется обмен сообщениями, задается в привязках.</span><span class="sxs-lookup"><span data-stu-id="4bae6-107">The mechanism used to exchange messages (or the "how") is specified in the bindings.</span></span> <span data-ttu-id="4bae6-108">Привязки в WCF инкапсулируют детали обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="4bae6-108">Bindings in WCF encapsulate details of the message exchange.</span></span> <span data-ttu-id="4bae6-109">Они предоставляют доступ к элементам конфигурации, с помощью которых пользователи могут управлять различными аспектами транспорта или протокола, которые представляются привязками.</span><span class="sxs-lookup"><span data-stu-id="4bae6-109">They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.</span></span> <span data-ttu-id="4bae6-110">Очереди в WCF рассматривается как и любой другой транспортной привязки, что является большим преимуществом для многих очередей приложений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-110">Queuing in WCF is treated like any other transport binding, which is a big advantage for many queuing applications.</span></span> <span data-ttu-id="4bae6-111">В наше время многие приложения с использованием очередей разрабатываются не так, как другие распределенные приложения на базе удаленного вызова процедур, что затрудняет их понимание и обслуживание.</span><span class="sxs-lookup"><span data-stu-id="4bae6-111">Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.</span></span> <span data-ttu-id="4bae6-112">С WCF стиль написания распределенного приложения во многом одинаков, что упрощает наблюдение и обслуживание.</span><span class="sxs-lookup"><span data-stu-id="4bae6-112">With WCF, the style of writing a distributed application is much the same, making it easier to follow and maintain.</span></span> <span data-ttu-id="4bae6-113">Более того, отделение механизма обмена данными от бизнес-логики упрощает настройку транспорта или внесение изменений в него, не затрагивая код, относящийся к предметной области.</span><span class="sxs-lookup"><span data-stu-id="4bae6-113">Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.</span></span> <span data-ttu-id="4bae6-114">На следующем рисунке показана структура службы и клиента WCF, которые используют MSMQ в качестве транспорта.</span><span class="sxs-lookup"><span data-stu-id="4bae6-114">The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.</span></span>  
  
 <span data-ttu-id="4bae6-115">![Схема находящихся в очереди приложений](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Распределенная очередь-Рисунок")</span><span class="sxs-lookup"><span data-stu-id="4bae6-115">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="4bae6-116">Как видно из этого рисунка, клиент и служба должны определять только семантику приложения, т. е. контракт и реализацию.</span><span class="sxs-lookup"><span data-stu-id="4bae6-116">As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.</span></span> <span data-ttu-id="4bae6-117">Служба настраивает поддерживающую очереди привязку с использованием нужных параметров.</span><span class="sxs-lookup"><span data-stu-id="4bae6-117">The service configures a queued binding with preferred settings.</span></span> <span data-ttu-id="4bae6-118">Клиент использует [инструмент Utility Tool ServiceModel Metadata (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) для создания клиента WCF в службе и для создания файла конфигурации, описывающего привязки для отправки сообщений службе.</span><span class="sxs-lookup"><span data-stu-id="4bae6-118">The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a WCF client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.</span></span> <span data-ttu-id="4bae6-119">Таким образом, чтобы отправить в очередь сообщение, клиент мгновенно wCF клиента и вызывает операцию на нем.</span><span class="sxs-lookup"><span data-stu-id="4bae6-119">Thus, to send a queued message, the client instantiates a WCF client and invokes an operation on it.</span></span> <span data-ttu-id="4bae6-120">В результате сообщение отправляется в очередь передачи, а затем передается в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="4bae6-120">This causes the message to be sent to the transmission queue and transferred to the target queue.</span></span> <span data-ttu-id="4bae6-121">Все сложные механизмы взаимодействия с использованием очередей оказываются скрытыми от приложения, которое отправляет и получает сообщения.</span><span class="sxs-lookup"><span data-stu-id="4bae6-121">All the complexities of queued communication are hidden from the application that is sending and receiving messages.</span></span>  
  
 <span data-ttu-id="4bae6-122">Оговорки о привязке в очереди в WCF включают:</span><span class="sxs-lookup"><span data-stu-id="4bae6-122">Caveats about queued binding in WCF include:</span></span>  
  
- <span data-ttu-id="4bae6-123">Все операции службы должны быть односторонними, поскольку привязка по умолчанию в очереди в WCF не поддерживает дуплексную связь с помощью очередей.</span><span class="sxs-lookup"><span data-stu-id="4bae6-123">All service operations must be one-way because the default queued binding in WCF does not support duplex communication using queues.</span></span> <span data-ttu-id="4bae6-124">Двухсторонний образец связи[(Two-Way Communication)](../../../../docs/framework/wcf/samples/two-way-communication.md)иллюстрирует, как использовать два односторонних контракта для реализации дуплексной связи с помощью очередей.</span><span class="sxs-lookup"><span data-stu-id="4bae6-124">A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.</span></span>  
  
- <span data-ttu-id="4bae6-125">Для создания клиента WCF с помощью обмена метаданными требуется дополнительная конечная точка HTTP на службе, чтобы его можно было заставить непосредственно генерировать клиента WCF и получить обязательную информацию для правильной настройки коммуникации в очереди.</span><span class="sxs-lookup"><span data-stu-id="4bae6-125">To generate a WCF client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the WCF client and obtain binding information to appropriately configure queued communication.</span></span>  
  
- <span data-ttu-id="4bae6-126">На основе привязки в очереди требуется дополнительная конфигурация за пределами WCF.</span><span class="sxs-lookup"><span data-stu-id="4bae6-126">Based on the queued binding, extra configuration outside of WCF is required.</span></span> <span data-ttu-id="4bae6-127">Например, <xref:System.ServiceModel.NetMsmqBinding> класс, поставляемый с Помощью WCF, требует настройки привязок, а также минимальной настройки квидинга сообщений (MSM).</span><span class="sxs-lookup"><span data-stu-id="4bae6-127">For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with WCF requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).</span></span>  
  
 <span data-ttu-id="4bae6-128">В следующих разделах описываются конкретные очереди привязки, отправленные с WCF, которые основаны на МСМЗ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-128">The following sections describe the specific queued bindings shipped with WCF, which are based on MSMQ.</span></span>  
  
### <a name="msmq"></a><span data-ttu-id="4bae6-129">MSMQ</span><span class="sxs-lookup"><span data-stu-id="4bae6-129">MSMQ</span></span>  
 <span data-ttu-id="4bae6-130">В очереди транспорт в WCF использует МСМЗ для своей связи в очереди.</span><span class="sxs-lookup"><span data-stu-id="4bae6-130">The queued transport in WCF uses MSMQ for its queued communication.</span></span>  
  
 <span data-ttu-id="4bae6-131">MSMQ поставляется как дополнительный компонент Windows и выполняется как служба NT.</span><span class="sxs-lookup"><span data-stu-id="4bae6-131">MSMQ ships as an optional component with Windows and runs as an NT service.</span></span> <span data-ttu-id="4bae6-132">MSMQ помещает передаваемые сообщения в очередь передачи и доставляет их в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="4bae6-132">It captures messages for transmission in a transmission queue and for delivery in a target queue.</span></span> <span data-ttu-id="4bae6-133">Диспетчеры очередей MSMQ реализуют надежный протокол передачи сообщений, благодаря которому сообщения не могут быть потеряны при передаче.</span><span class="sxs-lookup"><span data-stu-id="4bae6-133">The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.</span></span> <span data-ttu-id="4bae6-134">Этот протокол может быть собственным или основанным на SOAP, например как протокол SRMP.</span><span class="sxs-lookup"><span data-stu-id="4bae6-134">The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="4bae6-135">В MSMQ, очереди могут быть транзакционными и нетранзакционными.</span><span class="sxs-lookup"><span data-stu-id="4bae6-135">In MSMQ, queues can be transactional or non-transactional.</span></span> <span data-ttu-id="4bae6-136">Транзакционная очередь позволяет перехватывать и доставлять сообщение в транзакции, а затем продолжительное время хранить его в очереди.</span><span class="sxs-lookup"><span data-stu-id="4bae6-136">A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.</span></span> <span data-ttu-id="4bae6-137">Сообщения, отправляемые в транзакционную очередь, передаются только один раз в заданном порядке.</span><span class="sxs-lookup"><span data-stu-id="4bae6-137">Messages sent to a transactional queue are transferred exactly once in order.</span></span> <span data-ttu-id="4bae6-138">С помощью нетранзакционных очередей можно передавать, как неустойчивые, так и устойчивые сообщения.</span><span class="sxs-lookup"><span data-stu-id="4bae6-138">You can use a non-transactional queue to send both volatile and durable messages.</span></span> <span data-ttu-id="4bae6-139">Сообщение, переданное в нетранзакционную очередь, не содержит каких-либо механизмов подтверждения надежной передачи, поэтому такое сообщение может быть потеряно.</span><span class="sxs-lookup"><span data-stu-id="4bae6-139">A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.</span></span>  
  
 <span data-ttu-id="4bae6-140">Кроме того, очереди MSMQ можно защищать с помощью удостоверений Windows, зарегистрированных в службе каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4bae6-140">MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.</span></span> <span data-ttu-id="4bae6-141">При установке MSMQ можно установить интеграцию с Active Directory, для чего компьютер должен входить в домен Windows.</span><span class="sxs-lookup"><span data-stu-id="4bae6-141">When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.</span></span>  
  
 <span data-ttu-id="4bae6-142">Для получения более подробной информации об МСМЗ [см.](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)</span><span class="sxs-lookup"><span data-stu-id="4bae6-142">For more information about MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span></span>  
  
### <a name="netmsmqbinding"></a><span data-ttu-id="4bae6-143">NetMsmqBinding</span><span class="sxs-lookup"><span data-stu-id="4bae6-143">NetMsmqBinding</span></span>  
 <span data-ttu-id="4bae6-144">[ \<NetMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) является очереди связывания WCF предусматривает две wCF конечных точек для общения с помощью МСМЗ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-144">The [\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding WCF provides for two WCF endpoints to communicate using MSMQ.</span></span> <span data-ttu-id="4bae6-145">Поэтому привязка предоставляет свойства, имеющие отношение к MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-145">The binding, therefore, exposes properties that are specific to MSMQ.</span></span> <span data-ttu-id="4bae6-146">Тем не менее в `NetMsmqBinding` доступны не все функции и свойства MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-146">However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`.</span></span> <span data-ttu-id="4bae6-147">Компактная привязка `NetMsmqBinding` содержит оптимальный набор возможностей, которого должно быть достаточно для большинства пользователей.</span><span class="sxs-lookup"><span data-stu-id="4bae6-147">The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.</span></span>  
  
 <span data-ttu-id="4bae6-148">В `NetMsmqBinding` в виде свойств привязок объявлены базовые принципы работы с очередями, рассмотренные выше.</span><span class="sxs-lookup"><span data-stu-id="4bae6-148">The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings.</span></span> <span data-ttu-id="4bae6-149">Эти свойства, в свою очередь, определяют, каким образом сообщения должны передаваться и отправляться с использованием MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-149">These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.</span></span> <span data-ttu-id="4bae6-150">Описание категорий свойств содержится в приведенных ниже разделах.</span><span class="sxs-lookup"><span data-stu-id="4bae6-150">A discussion of the property categories is in the following sections.</span></span> <span data-ttu-id="4bae6-151">Для получения дополнительной информации смотрите концептуальные темы, которые более полно описывают конкретные свойства.</span><span class="sxs-lookup"><span data-stu-id="4bae6-151">For more information, see the conceptual topics that describe specific properties more completely.</span></span>  
  
#### <a name="exactlyonce-and-durable-properties"></a><span data-ttu-id="4bae6-152">Свойства ExactlyOnce и Durable</span><span class="sxs-lookup"><span data-stu-id="4bae6-152">ExactlyOnce and Durable Properties</span></span>  
 <span data-ttu-id="4bae6-153">От значений свойств `ExactlyOnce` и `Durable` зависит то, каким образом сообщения передаются между очередями.</span><span class="sxs-lookup"><span data-stu-id="4bae6-153">The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:</span></span>  
  
- <span data-ttu-id="4bae6-154">`ExactlyOnce`: если имеет значение `true` (по умолчанию), канал очереди следит за тем, чтобы сообщение доставлялось только один раз.</span><span class="sxs-lookup"><span data-stu-id="4bae6-154">`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated.</span></span> <span data-ttu-id="4bae6-155">Кроме того, он контролирует, чтобы сообщение не было потеряно.</span><span class="sxs-lookup"><span data-stu-id="4bae6-155">It also ensures that the message is not lost.</span></span> <span data-ttu-id="4bae6-156">Если доставить сообщение не удается или срок жизни сообщения истекает до его доставки, это сообщение, а также причина сбоя при его доставке записываются в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-156">If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.</span></span> <span data-ttu-id="4bae6-157">Если свойство имеет значение `false`, канал очереди пытается передать сообщение.</span><span class="sxs-lookup"><span data-stu-id="4bae6-157">When set to `false`, the queued channel makes an effort to transfer the message.</span></span> <span data-ttu-id="4bae6-158">В этом случае можно (необязательно) выбрать очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-158">In this case, you can optionally choose a dead-letter queue.</span></span>  
  
- <span data-ttu-id="4bae6-159">`Durable:` если имеет значение `true` (по умолчанию), канал очереди проверяет, что MSMQ сохраняет сообщение на диск на продолжительное время.</span><span class="sxs-lookup"><span data-stu-id="4bae6-159">`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk.</span></span> <span data-ttu-id="4bae6-160">Таким образом, если службу MSMQ необходимо остановить и перезапустить, сообщения на диске передаются в целевую очередь или в службу.</span><span class="sxs-lookup"><span data-stu-id="4bae6-160">Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.</span></span> <span data-ttu-id="4bae6-161">Если свойство имеет значение `false`, сообщения сохраняются во временном хранилище и теряются в случае остановки и перезапуска службы MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-161">When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.</span></span>  
  
 <span data-ttu-id="4bae6-162">Для реализации надежной передачи в режиме `ExactlyOnce` служба MSMQ требует, чтобы очередь была транзакционной.</span><span class="sxs-lookup"><span data-stu-id="4bae6-162">For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional.</span></span> <span data-ttu-id="4bae6-163">Кроме того, служба MSMQ требует чтения транзакции из транзакционной очереди.</span><span class="sxs-lookup"><span data-stu-id="4bae6-163">Also, MSMQ requires a transaction to read from a transactional queue.</span></span> <span data-ttu-id="4bae6-164">Поэтому при использовании привязки `NetMsmqBinding` следует помнить, что для отправки и получения сообщения требуется транзакция, если свойство `ExactlyOnce` имеет значение `true`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-164">As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`.</span></span> <span data-ttu-id="4bae6-165">Аналогично служба MSMQ требует, чтобы очередь была нетранзакционной с гарантией наилучшего из возможного, как например в случаях, когда свойство `ExactlyOnce` равняется `false` или при обмене временными сообщениями.</span><span class="sxs-lookup"><span data-stu-id="4bae6-165">Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging.</span></span> <span data-ttu-id="4bae6-166">Таким образом, если свойство `ExactlyOnce` имеет значение `false` или свойство Durable имеет значение `false`, невозможно осуществлять отправку или получение с использованием транзакций.</span><span class="sxs-lookup"><span data-stu-id="4bae6-166">Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4bae6-167">Следите за тем, чтобы создавалась правильная очередь (транзакционная или нетранзакционная) в зависимости от параметров привязок.</span><span class="sxs-lookup"><span data-stu-id="4bae6-167">Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.</span></span> <span data-ttu-id="4bae6-168">Если свойство `ExactlyOnce` имеет значение `true`, используется транзакционную очередь; в противном случае используется нетранзакционная очередь.</span><span class="sxs-lookup"><span data-stu-id="4bae6-168">If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.</span></span>  
  
#### <a name="dead-letter-queue-properties"></a><span data-ttu-id="4bae6-169">Свойства очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="4bae6-169">Dead-Letter Queue Properties</span></span>  
 <span data-ttu-id="4bae6-170">Очередь недоставленных сообщений служит для хранения сообщений, которые не удалось доставить.</span><span class="sxs-lookup"><span data-stu-id="4bae6-170">The dead-letter queue is used to store messages that fail delivery.</span></span> <span data-ttu-id="4bae6-171">Пользователь может написать дополнительные операции по чтению сообщений из очереди недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-171">The user can write compensating logic that reads messages out of the dead-letter queue.</span></span>  
  
 <span data-ttu-id="4bae6-172">Многие системы организации очереди реализуют общесистемную очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-172">Many queuing systems provide for a system-wide dead-letter queue.</span></span> <span data-ttu-id="4bae6-173">Служба MSMQ имеет две общесистемные очереди недоставленных сообщений: общесистемную очередь недоставленных нетранзакционных сообщений, которые не удалось доставить в нетранзакционные очереди, и общесистемную очередь недоставленных транзакционных сообщений, которые не удалось доставить в транзакционные очереди.</span><span class="sxs-lookup"><span data-stu-id="4bae6-173">MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.</span></span>  
  
 <span data-ttu-id="4bae6-174">Если несколько клиентов отправляют сообщения в различные целевые очереди с использованием одной службы MSMQ, все отправляемые клиентами сообщения попадают в одну и ту же очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-174">If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.</span></span> <span data-ttu-id="4bae6-175">Это не всегда желательно.</span><span class="sxs-lookup"><span data-stu-id="4bae6-175">This is not always preferable.</span></span> <span data-ttu-id="4bae6-176">Для лучшей изоляции WCF и MsM в Windows Vista предоставляют пользовательскую очередь мертвых букв (или очередь с конкретными буквами), которую пользователь может указать для хранения сообщений, не выполняющих сбой доставки.</span><span class="sxs-lookup"><span data-stu-id="4bae6-176">For better isolation, WCF and MSMQ in Windows Vista provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.</span></span> <span data-ttu-id="4bae6-177">В результате различные клиенты не будут использовать одну и ту же очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-177">Therefore, different clients do not share the same dead-letter queue.</span></span>  
  
 <span data-ttu-id="4bae6-178">У привязок имеются следующие важные свойства.</span><span class="sxs-lookup"><span data-stu-id="4bae6-178">The binding has two properties of interest:</span></span>  
  
- <span data-ttu-id="4bae6-179">`DeadLetterQueue`. Это свойство является перечислением, которое указывает, запрошена ли очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-179">`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested.</span></span> <span data-ttu-id="4bae6-180">Кроме того, в перечислении содержится тип очереди недоставленных сообщений, если она запрошена.</span><span class="sxs-lookup"><span data-stu-id="4bae6-180">The enumeration also contains the kind of dead-letter queue, if one is requested.</span></span> <span data-ttu-id="4bae6-181">Допустимые значения — `None`, `System` и `Custom`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-181">The values are `None`, `System`, and `Custom`.</span></span> <span data-ttu-id="4bae6-182">Для получения дополнительной информации о интерпретации этих свойств [см.](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span><span class="sxs-lookup"><span data-stu-id="4bae6-182">For more information about the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span></span>  
  
- <span data-ttu-id="4bae6-183">`CustomDeadLetterQueue`. Это свойство представляет собой универсальный код ресурса (URI) очереди недоставленных сообщений конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="4bae6-183">`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.</span></span> <span data-ttu-id="4bae6-184">Это необходимо, `DeadLetterQueue`если .`Custom`</span><span class="sxs-lookup"><span data-stu-id="4bae6-184">This is required if `DeadLetterQueue`.`Custom`</span></span> <span data-ttu-id="4bae6-185">выбирается.</span><span class="sxs-lookup"><span data-stu-id="4bae6-185">is chosen.</span></span>  
  
#### <a name="poison-message-handling-properties"></a><span data-ttu-id="4bae6-186">Свойства обработки подозрительных сообщений</span><span class="sxs-lookup"><span data-stu-id="4bae6-186">Poison Message Handling properties</span></span>  
 <span data-ttu-id="4bae6-187">Когда служба получает сообщение из целевой очереди в рамках транзакции, служба может по какой-либо причине не обработать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="4bae6-187">When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.</span></span> <span data-ttu-id="4bae6-188">В этом случае сообщение возвращается в очередь, чтобы быть считанными снова.</span><span class="sxs-lookup"><span data-stu-id="4bae6-188">The message is then put back into the queue to be read again.</span></span> <span data-ttu-id="4bae6-189">Для обработки сообщений, которые часто вызывают сбои, в привязке можно настроить набор свойств обработки подозрительных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-189">To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.</span></span> <span data-ttu-id="4bae6-190">Есть четыре свойства: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay` и `ReceiveErrorHandling`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-190">There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`.</span></span> <span data-ttu-id="4bae6-191">Для получения дополнительной информации [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)об этих свойствах см.</span><span class="sxs-lookup"><span data-stu-id="4bae6-191">For more information about these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span></span>  
  
#### <a name="security-properties"></a><span data-ttu-id="4bae6-192">Свойства безопасности</span><span class="sxs-lookup"><span data-stu-id="4bae6-192">Security Properties</span></span>  
 <span data-ttu-id="4bae6-193">Служба MSMQ реализует собственную модель безопасности, например списки управления доступом в очереди или отправку прошедших проверку подлинности сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-193">MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.</span></span> <span data-ttu-id="4bae6-194">В привязке `NetMsmqBinding` эти свойства безопасности реализованы как часть параметров безопасности транспорта.</span><span class="sxs-lookup"><span data-stu-id="4bae6-194">The `NetMsmqBinding` exposes these security properties as part of its transport security settings.</span></span> <span data-ttu-id="4bae6-195">В привязке имеется два свойства для обеспечения безопасности транспорта: `MsmqAuthenticationMode` и `MsmqProtectionLevel`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-195">There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`.</span></span> <span data-ttu-id="4bae6-196">Значения этих свойств зависят от настройки MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-196">Settings in these properties depend on how MSMQ is configured.</span></span> <span data-ttu-id="4bae6-197">Для получения дополнительной [информации см.](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)</span><span class="sxs-lookup"><span data-stu-id="4bae6-197">For more information, see [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span></span>  
  
 <span data-ttu-id="4bae6-198">Помимо безопасности транспорта само сообщение SOAP можно также защитить с помощью механизмов защиты сообщений.</span><span class="sxs-lookup"><span data-stu-id="4bae6-198">In addition to transport security, the actual SOAP message itself can be secured using message security.</span></span> <span data-ttu-id="4bae6-199">Для получения дополнительной [информации см.](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)</span><span class="sxs-lookup"><span data-stu-id="4bae6-199">For more information, see [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span></span>  
  
 <span data-ttu-id="4bae6-200">`MsmqTransportSecurity` также реализует два свойства: `MsmqEncryptionAlgorithm` и `MsmqHashAlgorithm`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-200">`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`.</span></span> <span data-ttu-id="4bae6-201">Это перечисления различных алгоритмов, позволяющее задать шифрование при передаче сообщений между очередями и хэширование сигнатур.</span><span class="sxs-lookup"><span data-stu-id="4bae6-201">These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.</span></span>  
  
#### <a name="other-properties"></a><span data-ttu-id="4bae6-202">Другие свойства</span><span class="sxs-lookup"><span data-stu-id="4bae6-202">Other Properties</span></span>  
 <span data-ttu-id="4bae6-203">Помимо описанных выше свойства предоставляемые привязкой свойства MSMQ включают:</span><span class="sxs-lookup"><span data-stu-id="4bae6-203">In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:</span></span>  
  
- <span data-ttu-id="4bae6-204">`UseSourceJournal`: свойство, указывающее, что включено ведение журнала источника.</span><span class="sxs-lookup"><span data-stu-id="4bae6-204">`UseSourceJournal`: A property to indicate that source journaling is turned on.</span></span> <span data-ttu-id="4bae6-205">Ведение журнала является возможностью MSMQ, отслеживающей сообщения, которые были успешно переданы из очереди передачи;</span><span class="sxs-lookup"><span data-stu-id="4bae6-205">Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.</span></span>  
  
- <span data-ttu-id="4bae6-206">`UseMsmqTracing`: свойство, указывающее, что включена трассировка MSMQ.</span><span class="sxs-lookup"><span data-stu-id="4bae6-206">`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on.</span></span> <span data-ttu-id="4bae6-207">Функция трассировки MSMQ отправляет сообщение с отчетом в очередь отчетов всякий раз, когда сообщение покидает компьютер с диспетчером очереди MSMQ или приходит на него;</span><span class="sxs-lookup"><span data-stu-id="4bae6-207">MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.</span></span>  
  
- <span data-ttu-id="4bae6-208">`QueueTransferProtocol`: перечисление протокола, используемого для обмена сообщениями между очередями.</span><span class="sxs-lookup"><span data-stu-id="4bae6-208">`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers.</span></span> <span data-ttu-id="4bae6-209">Служба MSMQ реализует собственный протокол передачи сообщений между очередями, а также протокол на базе SOAP (SRMP).</span><span class="sxs-lookup"><span data-stu-id="4bae6-209">MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).</span></span> <span data-ttu-id="4bae6-210">Протокол SRMP используется при передаче сообщений между очередями с помощью протокола HTTP.</span><span class="sxs-lookup"><span data-stu-id="4bae6-210">SRMP is used when using HTTP transport for queue-to-queue transfers.</span></span> <span data-ttu-id="4bae6-211">Если сообщения между очередями передаются с помощью протокола HTTPS, используется протокол SRMP;</span><span class="sxs-lookup"><span data-stu-id="4bae6-211">SRMP secure is used when using HTTPS for queue-to-queue transfers.</span></span>  
  
- <span data-ttu-id="4bae6-212">`UseActiveDirectory`: логическое значение, указывающее, следует ли использовать для разрешения адресов очередей службу каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4bae6-212">`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.</span></span> <span data-ttu-id="4bae6-213">По умолчанию этот режим отключен.</span><span class="sxs-lookup"><span data-stu-id="4bae6-213">By default, this is off.</span></span> <span data-ttu-id="4bae6-214">Для получения дополнительной [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)информации см.</span><span class="sxs-lookup"><span data-stu-id="4bae6-214">For more information, see [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span></span>  
  
### <a name="msmqintegrationbinding"></a><span data-ttu-id="4bae6-215">MsmqIntegrationBinding</span><span class="sxs-lookup"><span data-stu-id="4bae6-215">MsmqIntegrationBinding</span></span>  
 <span data-ttu-id="4bae6-216">Используется, `MsmqIntegrationBinding` когда требуется, чтобы конечная точка WCF общалась с существующим приложением МСМЗ, написанным в AIS C, C, COM или System.Messaging.</span><span class="sxs-lookup"><span data-stu-id="4bae6-216">The `MsmqIntegrationBinding` is used when you want a WCF endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.</span></span>  
  
 <span data-ttu-id="4bae6-217">Привязка имеет те же свойства, что и `NetMsmqBinding`.</span><span class="sxs-lookup"><span data-stu-id="4bae6-217">The binding properties are the same as for `NetMsmqBinding`.</span></span> <span data-ttu-id="4bae6-218">Однако имеются следующие различия:</span><span class="sxs-lookup"><span data-stu-id="4bae6-218">However, the following differences apply:</span></span>  
  
- <span data-ttu-id="4bae6-219">контракт операции `MsmqIntegrationBinding` может принимать только один параметр типа <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601>, где параметр типа является типом тела;</span><span class="sxs-lookup"><span data-stu-id="4bae6-219">The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.</span></span>  
  
- <span data-ttu-id="4bae6-220">большинство свойств собственных сообщений MSMQ доступно в <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601>;</span><span class="sxs-lookup"><span data-stu-id="4bae6-220">Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.</span></span>  
  
- <span data-ttu-id="4bae6-221">для сериализации и десериализации тела сообщения предоставляются сериализаторы, например XML и ActiveX.</span><span class="sxs-lookup"><span data-stu-id="4bae6-221">To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="4bae6-222">Пример кода</span><span class="sxs-lookup"><span data-stu-id="4bae6-222">Sample Code</span></span>  
 <span data-ttu-id="4bae6-223">Пошаговые инструкции по созданию служб WCF, использующих MSMQ, см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="4bae6-223">For step by step instructions on how to write WCF services that use MSMQ see the following topics:</span></span>  
  
- [<span data-ttu-id="4bae6-224">Практическое руководство. Обмен сообщениями с конечными точками WCF и приложениями очереди сообщений</span><span class="sxs-lookup"><span data-stu-id="4bae6-224">How to: Exchange Messages with WCF Endpoints and Message Queuing Applications</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  
  
- [<span data-ttu-id="4bae6-225">Практическое руководство. Обмен сообщениями в очереди с конечными точками WCF</span><span class="sxs-lookup"><span data-stu-id="4bae6-225">How to: Exchange Queued Messages with WCF Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  
  
 <span data-ttu-id="4bae6-226">Полный образец кода, демонстрирующий использование MSMQ в WCF, см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="4bae6-226">For a completed code sample illustrating the use of MSMQ in WCF see the following topics:</span></span>  
  
- [<span data-ttu-id="4bae6-227">Привязка MSMQ с поддержкой транзакций</span><span class="sxs-lookup"><span data-stu-id="4bae6-227">Transacted MSMQ Binding</span></span>](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  
  
- [<span data-ttu-id="4bae6-228">Неустойчивое взаимодействие с использованием очереди</span><span class="sxs-lookup"><span data-stu-id="4bae6-228">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
  
- [<span data-ttu-id="4bae6-229">Очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="4bae6-229">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
  
- [<span data-ttu-id="4bae6-230">Сеансы и очереди</span><span class="sxs-lookup"><span data-stu-id="4bae6-230">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
  
- [<span data-ttu-id="4bae6-231">Двусторонний обмен данными</span><span class="sxs-lookup"><span data-stu-id="4bae6-231">Two-Way Communication</span></span>](../../../../docs/framework/wcf/samples/two-way-communication.md)
  
- [<span data-ttu-id="4bae6-232">SRMP</span><span class="sxs-lookup"><span data-stu-id="4bae6-232">SRMP</span></span>](../../../../docs/framework/wcf/samples/srmp.md)  
  
- [<span data-ttu-id="4bae6-233">Безопасность сообщений при использовании очереди сообщений</span><span class="sxs-lookup"><span data-stu-id="4bae6-233">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
  
## <a name="see-also"></a><span data-ttu-id="4bae6-234">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="4bae6-234">See also</span></span>

- [<span data-ttu-id="4bae6-235">Конечные точки служб и адресация очереди</span><span class="sxs-lookup"><span data-stu-id="4bae6-235">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)
- [<span data-ttu-id="4bae6-236">Размещение веб-узлов в приложении, использующем очереди</span><span class="sxs-lookup"><span data-stu-id="4bae6-236">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
