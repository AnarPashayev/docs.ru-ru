---
title: Развертывание службы WCF, размещенной в IIS
ms.date: 03/30/2017
ms.assetid: 04ebd329-3fbd-44c3-b3ab-1de3517e27d7
ms.openlocfilehash: 36bdd22ec838af8b1a6b3be8c5636beced9b9132
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75964857"
---
# <a name="deploying-an-internet-information-services-hosted-wcf-service"></a>Развертывание службы WCF, размещенной в IIS

Разработка и развертывание службы Windows Communication Foundation (WCF), размещенной в службы IIS (IIS), состоит из следующих задач.

- Убедитесь, что службы IIS, ASP.NET, WCF и компонент активации WCF правильно установлены и зарегистрированы.

- Создайте новое приложение IIS или повторно используйте существующее приложение ASP.NET.

- Создайте SVC-файл для службы WCF.

- Развертывание реализации службы в приложение IIS.

- Настройте службу WCF.

Подробное пошаговое руководство по созданию службы WCF, размещенной в IIS, см. в статье [как разместить службу WCF в IIS](how-to-host-a-wcf-service-in-iis.md).

## <a name="ensure-that-iis-aspnet-and-wcf-are-correctly-installed-and-registered"></a>Проверка правильности установки и регистрации IIS, ASP.NET и WCF

Для правильной работы служб WCF, размещенных в IIS, необходимо установить WCF, IIS и ASP.NET. Процедуры установки WCF (в составе .NET Framework), ASP.NET и IIS зависят от операционной системы. Дополнительные сведения об установке WCF и .NET Framework см. в [статье установка .NET Framework для разработчиков](../../install/guide-for-developers.md). Чтобы установить службы IIS в Windows 10, откройте " **программы и компоненты** " на **панели управления** , а затем выберите **включить или отключить компоненты Windows**. В окне **компоненты Windows**выберите **службы IIS** и нажмите кнопку **ОК**.

![Компоненты Windows с выделенными службами IIS](./media/windows-features-iis.png)

Инструкции по установке служб IIS в других операционных системах можно найти в [статье Установка IIS в Windows Vista и Windows 7](/iis/install/installing-iis-7/installing-iis-on-windows-vista-and-windows-7) и [Установка IIS 8,5 на Windows Server 2012 R2](/iis/install/installing-iis-85/installing-iis-85-on-windows-server-2012-r2).

Процесс установки .NET Framework автоматически регистрирует WCF в службах IIS, если службы IIS уже имеются на компьютере. Если службы IIS установлены после .NET Framework, для регистрации WCF в IIS и ASP.NET требуется дополнительный шаг. Это можно выполнить указанным ниже способом в зависимости от операционной системы.

- Windows 7 и Windows Server 2003. Используйте средство [регистрации ServiceModel (ServiceModelReg. exe)](../../../../docs/framework/wcf/servicemodelreg-exe.md) для регистрации WCF в службах IIS. Чтобы использовать это средство, введите **ServiceModelReg. exe/i/x** в [Командная строка разработчика для Visual Studio](../../tools/developer-command-prompt-for-vs.md).

- Windows 7. Наконец, необходимо убедиться, что ASP.NET настроен для использования .NET Framework версии 4 или более поздней. Это можно сделать, запустив средство ASPNET_Regiis с параметром `–i`. Дополнительные сведения см. в разделе [ASP.NET IIS Registration Tool](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/k6h9cz8h(v=vs.90)).

## <a name="create-a-new-iis-application-or-reuse-an-existing-aspnet-application"></a>Создание нового приложения служб IIS или повторное использование существующего приложения ASP.NET

Службы WCF, размещенные в IIS, должны находиться внутри приложения IIS. Можно создать новое приложение IIS для размещения служб WCF исключительно. Кроме того, можно развернуть службу WCF в существующем приложении, в котором уже размещено содержимое ASP.NET 2,0 (например, страницы ASPX и веб-службы ASP.NET [ASMX]). Дополнительные сведения об этих параметрах см. в разделах "размещение WCF параллельно с ASP.NET" и "размещение служб WCF в режиме совместимости ASP.NET" в разделе [службы WCF и ASP.NET](wcf-services-and-aspnet.md).

Обратите внимание, что IIS 6,0 и более поздние версии периодически перезапускают изолированное объектно-ориентированное программное приложение. Значение по умолчанию — 1740 минут. Максимальное поддерживаемое значение - 71582 минуты. Этот перезапуск можно отключить. Дополнительные сведения об этом свойстве см. в разделе [PeriodicRestartTime](https://docs.microsoft.com/previous-versions/iis/6.0-sdk/ms525914(v=vs.90)).

## <a name="create-an-svc-file-for-the-wcf-service"></a>Создание SVC-файла для службы WCF

Службы WCF, размещенные в IIS, представлены в приложении IIS в виде специальных файлов содержимого (SVC-файлов). Эта модель подобна модели, согласно которой страницы ASMX представляются внутри приложения IIS в виде ASMX-файлов. SVC-файл содержит директиву обработки, специфичную для WCF ([\@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md)), которая позволяет инфраструктуре размещения WCF активировать размещенные службы в ответ на входящие сообщения. В приведенном ниже операторе показан наиболее распространенный синтаксис SVC-файла.

`<% @ServiceHost Service="MyNamespace.MyServiceImplementationTypeName" %>`

Он состоит из директивы [\@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md) и единственного атрибута `Service`. Значение атрибута `Service` - имя типа среды CLR реализации службы. Использование этой директивы по существу эквивалентно созданию основного приложения службы с помощью следующего кода.

```csharp
new ServiceHost( typeof( MyNamespace.MyServiceImplementationTypeName ) );
```

Можно также создать дополнительную конфигурацию размещения, например список базовых адресов службы. Кроме того, можно применить пользовательскую фабрику <xref:System.ServiceModel.Activation.ServiceHostFactory> , чтобы расширить директиву для использования с пользовательскими решениями по размещению. Приложения IIS, в которых размещаются службы WCF, не отвечают за управление созданием и временем существования экземпляров <xref:System.ServiceModel.ServiceHost>. Управляемая инфраструктура размещения WCF создает необходимый экземпляр <xref:System.ServiceModel.ServiceHost> динамически при получении первого запроса для SVC-файла. Этот экземпляр не освобождается, пока он не будет явно закрыт кодом или не перезапустится приложение.

Дополнительные сведения о синтаксисе файлов SVC см. в разделе [\@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md).

## <a name="deploy-the-service-implementation-to-the-iis-application"></a>Развертывание реализации службы в приложение IIS

Службы WCF, размещенные в IIS, используют ту же динамическую модель компиляции, что и ASP.NET 2,0. Как и в случае с ASP.NET, код реализации для размещенных в IIS служб WCF можно развернуть несколькими способами в различных расположениях, как показано ниже.

- В виде предкомпилированного DLL-файла, расположенного в глобальном кэше сборок или в каталоге \bin приложения. Предкомпилированные двоичные файлы не обновляются, пока не будет развернута новая версия библиотеки классов.

- Как некомпилированные исходные файлы, расположенные в каталоге приложения \ App_Code. Исходные файлы, расположенные в этом каталоге, запрашиваются динамически при обработке первого запроса приложения. Любые изменения в файлах в каталоге \App_Code приводят к перезапуску и повторной компиляции всего приложения при получении следующего запроса.

- Как некомпилированный код, помещенный непосредственно в SVC файл. Код реализации также можно найти в виде встроенного SVC в файле службы после директивы \@ServiceHost. Любые изменения во встроенном коде приводят к перезапуску и повторной компиляции приложения при получении следующего запроса.

Дополнительные сведения о модели компиляции ASP.NET 2,0 см. в разделе [Обзор компиляции ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/ms178466(v=vs.100)).

## <a name="configure-the-wcf-service"></a>Настройка службы WCF

Службы WCF, размещенные в IIS, хранят свою конфигурацию в файле Web. config приложения. Службы, размещенные в IIS, используют те же элементы конфигурации и синтаксис, что и службы WCF, размещенные за пределами служб IIS. Однако для среды размещения IIS присущи следующие ограничения.

- Базовые адреса размещенных в IIS служб.

- Приложения, в которых размещаются службы WCF за пределами служб IIS, могут управлять базовым адресом размещенных в них служб путем передачи набора универсальных кодов ресурса (URI) в конструктор <xref:System.ServiceModel.ServiceHost> или путем предоставления элемента [\<узла >](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) в конфигурации службы. Службы, размещенные в IIS, не могут управлять своими базовыми адресами; базовым адресом службы, размещенной в IIS, является адрес ее SVC-файла.

### <a name="endpoint-addresses-for-iis-hosted-services"></a>Адреса конечных точек для служб, размещенных в IIS

Будучи размещенными в IIS, адреса конечных точек всегда считаются относительными для адреса SVC-файла, представляющего службу. Например, если базовый адрес службы WCF `http://localhost/Application1/MyService.svc` со следующей конфигурацией конечной точки:

```xml
<endpoint address="anotherEndpoint" .../>
```

Это предоставляет конечную точку, которую можно получить по адресу `http://localhost/Application1/MyService.svc/anotherEndpoint`.

Аналогичным образом, элемент конфигурации конечной точки, использующий пустую строку в качестве относительного адреса, предоставляет конечную точку, доступную в `http://localhost/Application1/MyService.svc`, которая является базовым адресом.

```xml
<endpoint address="" ... />
```

Для конечных точек служб, размещенных в IIS, следует всегда использовать относительные адреса. Предоставление полного адреса конечной точки (например, `http://localhost/MyService.svc`) может привести к ошибкам в развертывании службы, если адрес конечной точки не указывает на IIS-Application, на котором размещена служба, предоставляя доступ к конечной точке. Использование относительных адресов конечных точек для размещенных служб позволяет избежать таких потенциальных конфликтов.

### <a name="available-transports"></a>Доступные типы транспорта

Службы WCF, размещенные в IIS 5,1 и IIS 6,0, ограничены использованием связи на основе HTTP. В этих платформах IIS настройка размещенной службы на использование привязки, отличной от HTTP, приводит к ошибке во время активации службы. Для IIS 7,0 Поддерживаемые транспорты включают HTTP, net. TCP, net. pipe, net. MSMQ и MSMQ. formatname для обеспечения обратной совместимости с существующими приложениями MSMQ.

### <a name="http-transport-security"></a>Безопасность транспорта HTTP

Службы WCF, размещенные в IIS, могут использовать безопасность транспорта HTTP (например, схемы проверки подлинности HTTPS и HTTP, такие как базовая, дайджест-и встроенная проверка подлинности Windows), если виртуальный каталог IIS, содержащий службу, поддерживает эти Параметры. Параметры безопасности транспорта HTTP в привязке размещенной конечной точки должны соответствовать параметрам безопасности транспорта в виртуальном каталоге IIS, который содержит эту привязку.

Например, конечная точка WCF, настроенная для использования дайджест-проверки подлинности HTTP, должна находиться в виртуальном каталоге IIS, который также настроен для поддержки дайджест-проверки подлинности HTTP. Непарные сочетания параметров IIS и параметров конечной точки WCF приводят к ошибке во время активации службы.

## <a name="see-also"></a>См. также:

- [Размещение в службах IIS](hosting-in-internet-information-services.md)
- [Рекомендации по размещению в службах IIS](internet-information-services-hosting-best-practices.md)
- [Функции размещения Windows Server App Fabric](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))
