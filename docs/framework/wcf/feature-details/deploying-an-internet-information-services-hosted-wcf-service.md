---
title: Развертывание службы WCF, размещенной в IIS
ms.date: 03/30/2017
ms.assetid: 04ebd329-3fbd-44c3-b3ab-1de3517e27d7
ms.openlocfilehash: 67f6877546951bd92b235218f10f6ccc7011ef5c
ms.sourcegitcommit: 927b7ea6b2ea5a440c8f23e3e66503152eb85591
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81463851"
---
# <a name="deploying-an-internet-information-services-hosted-wcf-service"></a>Развертывание службы WCF, размещенной в IIS

Разработка и развертывание службы Windows Communication Foundation (WCF), размещенной в информационных службах Интернета (IIS), состоит из следующих задач:

- Убедитесь, что IIS, ASP.NET, WCF и компонент активации WCF правильно установлены и зарегистрированы.

- Создайте новое приложение IIS или повторно используйте существующее ASP.NET приложение.

- Создайте файл .svc для службы WCF.

- Развертывание реализации службы в приложение IIS.

- Настройте службу WCF.

Подробную информацию о создании сервиса WCF, размещенного на IIS, можно [узнать: «Хозяйничать wCF Service в IIS.](how-to-host-a-wcf-service-in-iis.md)

## <a name="ensure-that-iis-aspnet-and-wcf-are-correctly-installed-and-registered"></a>Проверка правильности установки и регистрации IIS, ASP.NET и WCF

WCF, IIS и ASP.NET должны быть установлены для того, чтобы службы WCF, размещенные на IIS, функционировали правильно. Процедуры установки WCF (в рамках системы .NET), ASP.NET и IIS варьируются в зависимости от операционной системы. Для получения дополнительной информации об установке WCF и рамочной системы .NET [см.](../../install/guide-for-developers.md) Для установки IIS на Windows 10, откройте **программы и функции** в **панели управления,** а затем выберите **включить или выключить функции Windows.** В **функциях Windows**выберите **информационные службы Интернета,** а затем выберите **OK**.

![Особенности Windows с IIS выделены](./media/windows-features-iis.png)

Инструкции по установке IIS на другие операционные системы можно найти на [Install IIS на Windows Vista и Windows 7](/iis/install/installing-iis-7/installing-iis-on-windows-vista-and-windows-7) и [установить IIS 8.5 на Windows Server 2012 R2](/iis/install/installing-iis-85/installing-iis-85-on-windows-server-2012-r2).

Процесс установки для .NET Framework автоматически регистрирует WCF с IIS, если IIS уже присутствует на машине. Если IIS установлен после рамочного соглашения .NET, требуется дополнительный шаг для регистрации WCF в IIS и ASP.NET. Это можно выполнить указанным ниже способом в зависимости от операционной системы.

- Windows 7 и Windows Server 2003: Используйте инструмент [регистрации ServiceModel (ServiceModelReg.exe)](../../../../docs/framework/wcf/servicemodelreg-exe.md) для регистрации WCF с IIS. Чтобы использовать этот инструмент, введите **ServiceModelReg.exe /i /x** в командном запросе [разработчика для Visual Studio.](../../tools/developer-command-prompt-for-vs.md)

- Windows 7: Наконец, вы должны убедиться, что ASP.NET настроен айодионизм для использования версии .NET Framework 4 или позже. Вы делаете это, запустив ASPNET_Regiis инструмент с опцией. `–i` Для получения дополнительной информации см [ASP.NET.](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/k6h9cz8h(v=vs.90))

## <a name="create-a-new-iis-application-or-reuse-an-existing-aspnet-application"></a>Создание нового приложения служб IIS или повторное использование существующего приложения ASP.NET

Службы WCF, размещенные на IIS, должны находиться внутри приложения IIS. Можно создать новое приложение IIS для размещения исключительно wCF-сервисов. Кроме того, можно развернуть службу WCF в существующее приложение, которое уже размещает ASP.NET контента 2.0 (например, страницы .aspx и ASP.NET web-сервисов (ASMX). Для получения дополнительной информации об этих вариантах, см" Хостинг WCF бок о бок с ASP.NET" и "Хостинг WCF Услуги в режиме ASP.NET совместимости" разделы в [WCF Услуги и ASP.NET](wcf-services-and-aspnet.md).

Обратите внимание, что IIS 6.0 и более поздние версии периодически перезапускаются изолированным объектно-ориентированным приложением программирования. Значение по умолчанию — 1740 минут. Максимальное поддерживаемое значение - 71582 минуты. Этот перезапуск можно отключить. Для получения дополнительной информации об этом свойстве, [см.](https://docs.microsoft.com/previous-versions/iis/6.0-sdk/ms525914(v=vs.90))

## <a name="create-an-svc-file-for-the-wcf-service"></a>Создание SVC-файла для службы WCF

Службы WCF, размещенные в IIS, представлены в виде специальных файлов содержимого (.svc) внутри приложения IIS. Эта модель подобна модели, согласно которой страницы ASMX представляются внутри приложения IIS в виде ASMX-файлов. Файл .svc содержит директиву по обработке wCF[\@(ServiceHost),](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md)которая позволяет инфраструктуре хостинга WCF активировать размещенные службы в ответ на входящие сообщения. В приведенном ниже операторе показан наиболее распространенный синтаксис SVC-файла.

`<% @ServiceHost Service="MyNamespace.MyServiceImplementationTypeName" %>`

Она состоит из директивы `Service` [ \@ServiceHost](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md) и одного атрибута. Значение атрибута `Service` - имя типа среды CLR реализации службы. Использование этой директивы по существу эквивалентно созданию основного приложения службы с помощью следующего кода.

```csharp
new ServiceHost( typeof( MyNamespace.MyServiceImplementationTypeName ) );
```

Можно также создать дополнительную конфигурацию размещения, например список базовых адресов службы. Кроме того, можно применить пользовательскую фабрику <xref:System.ServiceModel.Activation.ServiceHostFactory> , чтобы расширить директиву для использования с пользовательскими решениями по размещению. Приложения IIS, принимающие службы WCF, не отвечают за управление созданием и сроком службы <xref:System.ServiceModel.ServiceHost> экземпляров. Управляемая инфраструктура хостинга <xref:System.ServiceModel.ServiceHost> WCF создает необходимый экземпляр динамически при получении первого запроса для файла .svc. Этот экземпляр не освобождается, пока он не будет явно закрыт кодом или не перезапустится приложение.

Для получения дополнительной информации о синтаксисе для файлов .svc [ \@см.](../../../../docs/framework/configure-apps/file-schema/wcf-directive/servicehost.md)

## <a name="deploy-the-service-implementation-to-the-iis-application"></a>Развертывание реализации службы в приложение IIS

Службы WCF, размещенные в IIS, используют ту же динамическую модель компиляции, что и ASP.NET 2.0. Так же, как и в ASP.NET, можно развернуть код реализации для служб WCF, размещенных на IIS, несколькими способами в различных местах:

- В виде предкомпилированного DLL-файла, расположенного в глобальном кэше сборок или в каталоге \bin приложения. Предкомпилированные двоичные файлы не обновляются, пока не будет развернута новая версия библиотеки классов.

- Как некомпиляционные исходные файлы, расположенные в App_Code каталоге приложения. Исходные файлы, расположенные в этом каталоге, запрашиваются динамически при обработке первого запроса приложения. Любые изменения в файлах в каталоге \App_Code приводят к перезапуску и повторной компиляции всего приложения при получении следующего запроса.

- Как некомпилированный код, помещенный непосредственно в файл .svc. Код реализации также может быть размещен в файле службы \@.svc после директивы ServiceHost. Любые изменения во встроенном коде приводят к перезапуску и повторной компиляции приложения при получении следующего запроса.

Для получения дополнительной информации о модели компиляции ASP.NET 2.0 с [ASP.NETм.](https://docs.microsoft.com/previous-versions/aspnet/ms178466(v=vs.100))

## <a name="configure-the-wcf-service"></a>Настройка службы WCF

Сервисы WCF, размещенные на IIS, хранят свою конфигурацию в файле web.config приложений. Службы, размещенные на IIS, используют те же элементы конфигурации и синтаксис, что и службы WCF, размещенные за пределами IIS. Однако для среды размещения IIS присущи следующие ограничения.

- Базовые адреса размещенных в IIS служб.

- Приложения, принимающие услуги WCF за пределами IIS, могут управлять базовым адресом <xref:System.ServiceModel.ServiceHost> услуг, которые они размещают, передавая конструктору набор базовых адресов или предоставляя [ \<элемент>в](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) конфигурации службы. Службы, размещенные в IIS, не могут управлять своими базовыми адресами; базовым адресом службы, размещенной в IIS, является адрес ее SVC-файла.

### <a name="endpoint-addresses-for-iis-hosted-services"></a>Адреса конечных точек для служб, размещенных в IIS

Будучи размещенными в IIS, адреса конечных точек всегда считаются относительными для адреса SVC-файла, представляющего службу. Например, если базовый адрес службы `http://localhost/Application1/MyService.svc` WCF находится со следующей конфигурацией конечной точки:

```xml
<endpoint address="anotherEndpoint" />
```

Это обеспечивает конечную точку, `http://localhost/Application1/MyService.svc/anotherEndpoint`которая может быть достигнута на .

Аналогичным образом, элемент конфигурации конечных точек, который использует пустую `http://localhost/Application1/MyService.svc`строку, как относительный адрес обеспечивает конечную точку, достижимую в, который является базовым адресом.

```xml
<endpoint address="" />
```

Для конечных точек служб, размещенных в IIS, следует всегда использовать относительные адреса. Предоставление полностью квалифицированного адреса конечной `http://localhost/MyService.svc`точки (например, может привести к ошибкам в развертывании службы, если адрес конечной точки не указывает на IIS-приложение, в котором размещается служба, раскрывающая конечную точку. Использование относительных адресов конечных точек для размещенных служб позволяет избежать таких потенциальных конфликтов.

### <a name="available-transports"></a>Доступные типы транспорта

Услуги WCF, размещенные в IIS 5.1 и IIS 6.0, ограничены использованием http-коммуникаций. В этих платформах IIS настройка размещенной службы на использование привязки, отличной от HTTP, приводит к ошибке во время активации службы. Для IIS 7.0 поддерживаемые перевозки включают HTTP, Net.TCP, Net.Pipe, Net.MSM и msmq.formatname для обратной совместимости с существующими приложениями МСМЗ.

### <a name="http-transport-security"></a>Безопасность транспорта HTTP

Службы WCF, размещенные на IIS, могут использовать системы безопасности переноса HTTP (например, схемы проверки подлинности HTTPS и HTTP, такие как Basic, Digest и Windows Integrated Authentication) до тех пор, пока виртуальный каталог IIS, содержащий эти настройки, поддерживает эти параметры. Параметры безопасности транспорта HTTP в привязке размещенной конечной точки должны соответствовать параметрам безопасности транспорта в виртуальном каталоге IIS, который содержит эту привязку.

Например, конечная точка WCF, настроенная для использования аутентификации дайджеста HTTP, должна находиться в виртуальном каталоге IIS, который также настроен таким образом, чтобы позволить authentication дайджеста http. Непревзойденные комбинации настроек IIS и параметров конечной точки WCF приводят к ошибке при активации службы.

## <a name="see-also"></a>См. также

- [Размещение в службах IIS](hosting-in-internet-information-services.md)
- [Рекомендации по размещению в службах IIS](internet-information-services-hosting-best-practices.md)
- [Функции размещения Windows Server App Fabric](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))
