---
title: Практическое руководство. Настройка учетных данных службы федерации
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a
ms.openlocfilehash: 05f35bbb7dbb34cd4067c407578038cbb4eff70f
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84599149"
---
# <a name="how-to-configure-credentials-on-a-federation-service"></a><span data-ttu-id="f906d-102">Практическое руководство. Настройка учетных данных службы федерации</span><span class="sxs-lookup"><span data-stu-id="f906d-102">How to: Configure Credentials on a Federation Service</span></span>
<span data-ttu-id="f906d-103">В Windows Communication Foundation (WCF) Создание федеративной службы состоит из следующих основных процедур:</span><span class="sxs-lookup"><span data-stu-id="f906d-103">In Windows Communication Foundation (WCF), creating a federated service consists of the following main procedures:</span></span>  
  
1. <span data-ttu-id="f906d-104">Настройка <xref:System.ServiceModel.WSFederationHttpBinding> или аналогичной пользовательской привязки.</span><span class="sxs-lookup"><span data-stu-id="f906d-104">Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding.</span></span> <span data-ttu-id="f906d-105">Дополнительные сведения о создании подходящей привязки см. в разделе [инструкции. Создание WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md).</span><span class="sxs-lookup"><span data-stu-id="f906d-105">For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md).</span></span>  
  
2. <span data-ttu-id="f906d-106">Настройка объекта <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>, который определяет порядок проверки подлинности выданных маркеров, которые предоставляются службе.</span><span class="sxs-lookup"><span data-stu-id="f906d-106">Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.</span></span>  
  
 <span data-ttu-id="f906d-107">В этом разделе описывается второй этап.</span><span class="sxs-lookup"><span data-stu-id="f906d-107">This topic provides details about the second step.</span></span> <span data-ttu-id="f906d-108">Дополнительные сведения о работе федеративной службы см. в разделе [Федерация](federation.md).</span><span class="sxs-lookup"><span data-stu-id="f906d-108">For more information about how a federated service works, see [Federation](federation.md).</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-code"></a><span data-ttu-id="f906d-109">Задание свойств объекта IssuedTokenServiceCredential в коде</span><span class="sxs-lookup"><span data-stu-id="f906d-109">To set the properties of IssuedTokenServiceCredential in code</span></span>  
  
1. <span data-ttu-id="f906d-110">Свойство <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> класса <xref:System.ServiceModel.Description.ServiceCredentials> служит для возврата ссылки на экземпляр <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="f906d-110">Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance.</span></span> <span data-ttu-id="f906d-111">Доступ к этому свойству осуществляется через свойство <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> класса <xref:System.ServiceModel.ServiceHostBase>.</span><span class="sxs-lookup"><span data-stu-id="f906d-111">The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span>  
  
2. <span data-ttu-id="f906d-112">Задайте <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> для свойства значение, `true` Если для самостоятельно выдаваемых токенов, таких как карты CardSpace, требуется проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="f906d-112">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as CardSpace cards are to be authenticated.</span></span> <span data-ttu-id="f906d-113">Значение по умолчанию — `false`.</span><span class="sxs-lookup"><span data-stu-id="f906d-113">The default is `false`.</span></span>  
  
3. <span data-ttu-id="f906d-114">Заполните коллекцию, возвращаемую свойством <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>, экземплярами класса <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="f906d-114">Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class.</span></span> <span data-ttu-id="f906d-115">Каждый экземпляр представляет издателя, для которого служба будет проверять подлинность маркеров.</span><span class="sxs-lookup"><span data-stu-id="f906d-115">Each instance represents an issuer from which the service will authenticate tokens.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="f906d-116">В отличие от клиентской коллекции, возвращаемой свойством <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A>, коллекция известных сертификатов не является коллекцией с ключом.</span><span class="sxs-lookup"><span data-stu-id="f906d-116">Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection.</span></span> <span data-ttu-id="f906d-117">Служба принимает маркеры, выдаваемые заданным сертификатом, независимо от адреса клиента, который отправил сообщение с выданным маркером (на него накладываются дополнительные ограничения, описанные ниже в этом разделе).</span><span class="sxs-lookup"><span data-stu-id="f906d-117">The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).</span></span>  
  
4. <span data-ttu-id="f906d-118">Присвойте свойству <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> одно из значений перечисления <xref:System.ServiceModel.Security.X509CertificateValidationMode>.</span><span class="sxs-lookup"><span data-stu-id="f906d-118">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values.</span></span> <span data-ttu-id="f906d-119">Это можно сделать только в коде.</span><span class="sxs-lookup"><span data-stu-id="f906d-119">This can be done only in code.</span></span> <span data-ttu-id="f906d-120">Значение по умолчанию — <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span><span class="sxs-lookup"><span data-stu-id="f906d-120">The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span></span>  
  
5. <span data-ttu-id="f906d-121">Если свойство <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> имеет значение <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, присвойте экземпляр пользовательского класса <xref:System.IdentityModel.Selectors.X509CertificateValidator> свойству <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A>.</span><span class="sxs-lookup"><span data-stu-id="f906d-121">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.</span></span>  
  
6. <span data-ttu-id="f906d-122">Если свойство <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> имеет значение `ChainTrust` или `PeerOrChainTrust`, присвойте свойству <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> соответствующее значение из перечисления <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode>.</span><span class="sxs-lookup"><span data-stu-id="f906d-122">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration.</span></span> <span data-ttu-id="f906d-123">Обратите внимание, что в режимах проверки `PeerTrust` и `Custom`, режим отзыва не используется.</span><span class="sxs-lookup"><span data-stu-id="f906d-123">Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.</span></span>  
  
7. <span data-ttu-id="f906d-124">Если необходимо, присвойте экземпляр пользовательского класса <xref:System.IdentityModel.Tokens.SamlSerializer> свойству <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A>.</span><span class="sxs-lookup"><span data-stu-id="f906d-124">If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property.</span></span> <span data-ttu-id="f906d-125">Пользовательский сериализатор языка Security Assertions Markup Language (SAML) требуется, например, для анализа пользовательских утверждений SAML.</span><span class="sxs-lookup"><span data-stu-id="f906d-125">A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-configuration"></a><span data-ttu-id="f906d-126">Задание свойств объекта IssuedTokenServiceCredential в файле конфигурации</span><span class="sxs-lookup"><span data-stu-id="f906d-126">To set the properties of IssuedTokenServiceCredential in configuration</span></span>  
  
1. <span data-ttu-id="f906d-127">Создайте `<issuedTokenAuthentication>` элемент в качестве дочернего элемента для `serviceCredentials` элемента <>.</span><span class="sxs-lookup"><span data-stu-id="f906d-127">Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.</span></span>  
  
2. <span data-ttu-id="f906d-128">Присвойте `allowUntrustedRsaIssuers` атрибуту `<issuedTokenAuthentication>` элемента значение, `true` Если проверка подлинности самостоятельно выданного маркера, например карты CardSpace.</span><span class="sxs-lookup"><span data-stu-id="f906d-128">Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as a CardSpace card.</span></span>  
  
3. <span data-ttu-id="f906d-129">Создайте элемент `<knownCertificates>`, являющийся дочерним для элемента `<issuedTokenAuthentication>`.</span><span class="sxs-lookup"><span data-stu-id="f906d-129">Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.</span></span>  
  
4. <span data-ttu-id="f906d-130">Создайте ноль или несколько элементов `<add>`, являющих дочерними для элемента `<knownCertificates>`, и с помощью атрибутов `storeLocation`, `storeName`, `x509FindType` и `findValue` укажите, каким образом обнаружить сертификат.</span><span class="sxs-lookup"><span data-stu-id="f906d-130">Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.</span></span>  
  
5. <span data-ttu-id="f906d-131">При необходимости присвойте `samlSerializer` атрибуту `issuedTokenAuthentication` элемента <> имя типа пользовательского <xref:System.IdentityModel.Tokens.SamlSerializer> класса.</span><span class="sxs-lookup"><span data-stu-id="f906d-131">If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.</span></span>  
  
## <a name="example"></a><span data-ttu-id="f906d-132">Пример</span><span class="sxs-lookup"><span data-stu-id="f906d-132">Example</span></span>  
 <span data-ttu-id="f906d-133">В следующем примере свойства объекта <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> задаются в коде.</span><span class="sxs-lookup"><span data-stu-id="f906d-133">The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.</span></span>  
  
 [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]
 [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  
  
 <span data-ttu-id="f906d-134">Чтобы федеративная служба проверяла подлинность клиента, для выданного маркера должны выполняться следующие условия:</span><span class="sxs-lookup"><span data-stu-id="f906d-134">In order for a federated service to authenticate a client, the following must be true about the issued token:</span></span>  
  
- <span data-ttu-id="f906d-135">если в цифровой сигнатуре выданного маркера используется идентификатор ключа безопасности RSA, свойство <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> должно иметь значение `true`;</span><span class="sxs-lookup"><span data-stu-id="f906d-135">When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.</span></span>  
  
- <span data-ttu-id="f906d-136">если в подписи выданного маркера используется серийный номер издателя X.509, идентификатор ключа субъекта X.509 или идентификатор безопасности отпечатка X.509, выданный маркер должен быть подписан сертификатом из коллекции, возвращаемой свойством <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> класса <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>;</span><span class="sxs-lookup"><span data-stu-id="f906d-136">When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.</span></span>  
  
- <span data-ttu-id="f906d-137">если выданный маркер подписан с помощью сертификата X.509, этот сертификат должен осуществлять проверку на основании семантики, определенной значением свойства <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A>, независимо от того, был ли сертификат отправлен проверяющей стороне в качестве объекта <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> или же получен из свойства <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>.</span><span class="sxs-lookup"><span data-stu-id="f906d-137">When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property.</span></span> <span data-ttu-id="f906d-138">Дополнительные сведения о проверке сертификата X. 509 см. [в разделе Работа с сертификатами](working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="f906d-138">For more information about X.509 certificate validation, see [Working with Certificates](working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="f906d-139">Например, установка свойства <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> равным <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> приведет к тому, что будет проверяться подлинность всех выданных маркеров, сертификаты которых принадлежат к хранилищу сертификатов `TrustedPeople`.</span><span class="sxs-lookup"><span data-stu-id="f906d-139">For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store.</span></span> <span data-ttu-id="f906d-140">В этом случае задайте для свойства <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> значение <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> или <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span><span class="sxs-lookup"><span data-stu-id="f906d-140">In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span></span> <span data-ttu-id="f906d-141">Можно выбрать и другие режимы, в том числе режим <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span><span class="sxs-lookup"><span data-stu-id="f906d-141">You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span></span> <span data-ttu-id="f906d-142">Если выбран режим `Custom`, необходимо присвоить экземпляр класса <xref:System.IdentityModel.Selectors.X509CertificateValidator> свойству <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A>.</span><span class="sxs-lookup"><span data-stu-id="f906d-142">When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property.</span></span> <span data-ttu-id="f906d-143">Пользовательский проверяющий элемент управления может проверять сертификаты, используя любые условия.</span><span class="sxs-lookup"><span data-stu-id="f906d-143">The custom validator can validate certificates using any criteria it likes.</span></span> <span data-ttu-id="f906d-144">Дополнительные сведения см. [в разделе инструкции. Создание службы, использующей пользовательский проверяющий элемент управления для сертификатов](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="f906d-144">For more information, see [How to: Create a Service that Employs a Custom Certificate Validator](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f906d-145">Дополнительно</span><span class="sxs-lookup"><span data-stu-id="f906d-145">See also</span></span>

- [<span data-ttu-id="f906d-146">Федерация</span><span class="sxs-lookup"><span data-stu-id="f906d-146">Federation</span></span>](federation.md)
- [<span data-ttu-id="f906d-147">Федерация и доверие</span><span class="sxs-lookup"><span data-stu-id="f906d-147">Federation and Trust</span></span>](federation-and-trust.md)
- [<span data-ttu-id="f906d-148">Пример федерации</span><span class="sxs-lookup"><span data-stu-id="f906d-148">Federation Sample</span></span>](../samples/federation-sample.md)
- [<span data-ttu-id="f906d-149">Практическое руководство. Порядок отключения безопасных сеансов в WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="f906d-149">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="f906d-150">Практическое руководство. Создание WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="f906d-150">How to: Create a WSFederationHttpBinding</span></span>](how-to-create-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="f906d-151">Практическое руководство. Создание федеративного клиента</span><span class="sxs-lookup"><span data-stu-id="f906d-151">How to: Create a Federated Client</span></span>](how-to-create-a-federated-client.md)
- [<span data-ttu-id="f906d-152">Работа с сертификатами</span><span class="sxs-lookup"><span data-stu-id="f906d-152">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="f906d-153">Режимы проверки подлинности SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="f906d-153">SecurityBindingElement Authentication Modes</span></span>](securitybindingelement-authentication-modes.md)
