---
title: Настройка HTTP и HTTPS
description: Узнайте, как настроить HTTP/HTTPS, чтобы разрешить службам WCF и клиентам обмениваться данными. Настройте регистрацию URL-адреса и исключение брандмауэра с помощью Netsh.exe.
ms.date: 04/08/2019
helpviewer_keywords:
- configuring HTTP [WCF]
ms.assetid: b0c29a86-bc0c-41b3-bc1e-4eb5bb5714d4
ms.openlocfilehash: fbff78ff8e2c5c4fa73a56a3fdc15163596aa985
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2020
ms.locfileid: "85245145"
---
# <a name="configuring-http-and-https"></a><span data-ttu-id="f81c3-104">Настройка HTTP и HTTPS</span><span class="sxs-lookup"><span data-stu-id="f81c3-104">Configuring HTTP and HTTPS</span></span>

<span data-ttu-id="f81c3-105">Службы и клиенты WCF могут взаимодействовать по протоколам HTTP и HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f81c3-105">WCF services and clients can communicate over HTTP and HTTPS.</span></span> <span data-ttu-id="f81c3-106">Параметры HTTP/HTTPS задаются с помощью служб IIS или посредством использования средства командной строки.</span><span class="sxs-lookup"><span data-stu-id="f81c3-106">The HTTP/HTTPS settings are configured by using Internet Information Services (IIS) or through the use of a command-line tool.</span></span> <span data-ttu-id="f81c3-107">Когда служба WCF размещается в службах IIS, параметры HTTP или HTTPS можно задать в службах IIS (с помощью средства inetmgr.exe).</span><span class="sxs-lookup"><span data-stu-id="f81c3-107">When a WCF service is hosted under IIS HTTP or HTTPS settings can be configured within IIS (using the inetmgr.exe tool).</span></span> <span data-ttu-id="f81c3-108">Если служба WCF является резидентной, параметры HTTP или HTTPS задаются с помощью средства командной строки.</span><span class="sxs-lookup"><span data-stu-id="f81c3-108">If a WCF service is self-hosted, HTTP or HTTPS settings are configured by using a command-line tool.</span></span>

<span data-ttu-id="f81c3-109">Как минимум необходимо настроить регистрацию URL-адресов и добавить исключение брандмауэра для URL-адреса, который будет использоваться службой.</span><span class="sxs-lookup"><span data-stu-id="f81c3-109">At a minimum, you want to configure a URL registration and add a Firewall exception for the URL your service will be using.</span></span> <span data-ttu-id="f81c3-110">Эти параметры можно настроить с помощью средства Netsh.exe.</span><span class="sxs-lookup"><span data-stu-id="f81c3-110">You can configure these settings with the Netsh.exe tool.</span></span>

## <a name="configuring-namespace-reservations"></a><span data-ttu-id="f81c3-111">Настройка резервирования пространства имен</span><span class="sxs-lookup"><span data-stu-id="f81c3-111">Configuring namespace reservations</span></span>

<span data-ttu-id="f81c3-112">Резервирование пространства имен назначает права на часть пространства имен URL-адреса HTTP определенной группе пользователей.</span><span class="sxs-lookup"><span data-stu-id="f81c3-112">Namespace reservation assigns the rights for a portion of the HTTP URL namespace to a particular group of users.</span></span> <span data-ttu-id="f81c3-113">Резервирование предоставляет этим пользователям право создавать службы, которые ожидают передачи данных в указанной части пространства имен.</span><span class="sxs-lookup"><span data-stu-id="f81c3-113">A reservation gives those users the right to create services that listen on that portion of the namespace.</span></span> <span data-ttu-id="f81c3-114">Резервирования — это префиксы URL-адресов. Это означает, что резервирование охватывает все вложенные пути пути резервирования.</span><span class="sxs-lookup"><span data-stu-id="f81c3-114">Reservations are URL prefixes, meaning that the reservation covers all subpaths of the reservation path.</span></span> <span data-ttu-id="f81c3-115">Резервирования пространства имен позволяют использовать подстановочные знаки двумя способами.</span><span class="sxs-lookup"><span data-stu-id="f81c3-115">Namespace reservations permit two ways to use wildcards.</span></span> <span data-ttu-id="f81c3-116">В документации по API HTTP-сервера описывается [Порядок разрешения между утверждениями пространства имен, которые используют подстановочные знаки](/windows/desktop/Http/routing-incoming-requests).</span><span class="sxs-lookup"><span data-stu-id="f81c3-116">The HTTP Server API documentation describes the [order of resolution between namespace claims that involve wildcards](/windows/desktop/Http/routing-incoming-requests).</span></span>

<span data-ttu-id="f81c3-117">Запущенное приложение может создать аналогичный запрос для добавления регистраций пространства имен.</span><span class="sxs-lookup"><span data-stu-id="f81c3-117">A running application can create a similar request to add namespace registrations.</span></span> <span data-ttu-id="f81c3-118">Регистрации и резервирования конкурируют за части пространства имен.</span><span class="sxs-lookup"><span data-stu-id="f81c3-118">Registrations and reservations compete for portions of the namespace.</span></span> <span data-ttu-id="f81c3-119">Резервирование может иметь приоритет над регистрацией в соответствии с порядком разрешения, указанным в [порядке разрешения между утверждениями пространства имен, которые используют подстановочные знаки](/windows/desktop/Http/routing-incoming-requests).</span><span class="sxs-lookup"><span data-stu-id="f81c3-119">A reservation may have precedence over a registration according to the order of resolution given in the [order of resolution between namespace claims that involve wildcards](/windows/desktop/Http/routing-incoming-requests).</span></span> <span data-ttu-id="f81c3-120">В этом случае резервирование не позволяет запущенному приложению получать запросы.</span><span class="sxs-lookup"><span data-stu-id="f81c3-120">In this case, the reservation blocks the running application from receiving requests.</span></span>

<span data-ttu-id="f81c3-121">В следующем примере используется средство Netsh.exe:</span><span class="sxs-lookup"><span data-stu-id="f81c3-121">The following example uses the Netsh.exe tool:</span></span>

```console
netsh http add urlacl url=http://+:80/MyUri user=DOMAIN\user
```

<span data-ttu-id="f81c3-122">Эта команда добавляет резервирование URL-адресов для указанного пространства имен URL-адреса для учетной записи DOMAIN\user.</span><span class="sxs-lookup"><span data-stu-id="f81c3-122">This command adds a URL reservation for the specified URL namespace for the DOMAIN\user account.</span></span> <span data-ttu-id="f81c3-123">Для получения дополнительных сведений об использовании команды netsh введите `netsh http add urlacl /?` в командной строке и нажмите клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="f81c3-123">For more information on using the netsh command, type `netsh http add urlacl /?` in a command-prompt and press Enter.</span></span>

## <a name="configuring-a-firewall-exception"></a><span data-ttu-id="f81c3-124">Настройка исключения брандмауэра</span><span class="sxs-lookup"><span data-stu-id="f81c3-124">Configuring a firewall exception</span></span>

<span data-ttu-id="f81c3-125">При резидентном размещении службы WCF, которая осуществляет взаимодействие по протоколу HTTP, необходимо добавить исключение в конфигурацию брандмауэра, чтобы входящие соединения могли использовать определенный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="f81c3-125">When self-hosting a WCF service that communicates over HTTP, an exception must be added to the firewall configuration to allow inbound connections using a particular URL.</span></span>

## <a name="configuring-ssl-certificates"></a><span data-ttu-id="f81c3-126">Настройка SSL-сертификатов</span><span class="sxs-lookup"><span data-stu-id="f81c3-126">Configuring SSL certificates</span></span>

<span data-ttu-id="f81c3-127">Протокол SSL использует сертификаты в клиенте и службе для хранения ключей шифрования.</span><span class="sxs-lookup"><span data-stu-id="f81c3-127">The Secure Sockets Layer (SSL) protocol uses certificates on the client and server to store encryption keys.</span></span> <span data-ttu-id="f81c3-128">Сервер предоставляет свой SSL-сертификат при подключении, чтобы клиент мог проверить удостоверение сервера.</span><span class="sxs-lookup"><span data-stu-id="f81c3-128">The server provides its SSL certificate when a connection is made so that the client can verify the server identity.</span></span> <span data-ttu-id="f81c3-129">Для обеспечения взаимной проверки на обеих сторонах подключения сервер также запрашивает сертификат у клиента.</span><span class="sxs-lookup"><span data-stu-id="f81c3-129">The server can also request a certificate from the client to provide mutual authentication of both sides of the connection.</span></span>

<span data-ttu-id="f81c3-130">Сертификаты хранятся в централизованном хранилище в соответствии с IP-адресом и номером порта подключения.</span><span class="sxs-lookup"><span data-stu-id="f81c3-130">Certificates are stored in a centralized store according to the IP address and port number of the connection.</span></span> <span data-ttu-id="f81c3-131">Специальный IP-адрес 0.0.0.0 соответствует любому IP-адресу локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="f81c3-131">The special IP address 0.0.0.0 matches any IP address for the local machine.</span></span> <span data-ttu-id="f81c3-132">Обратите внимание, что хранилище сертификатов не различает URL-адреса в зависимости от пути.</span><span class="sxs-lookup"><span data-stu-id="f81c3-132">Note that the certificate store doesn't distinguish URLs based on the path.</span></span> <span data-ttu-id="f81c3-133">Службы с одним и тем же сочетанием IP-адреса и порта должны иметь общие сертификаты, даже если их пути в URL-адресе различаются.</span><span class="sxs-lookup"><span data-stu-id="f81c3-133">Services with the same IP address and port combination must share certificates even if the path in the URL for the services is different.</span></span>

<span data-ttu-id="f81c3-134">Пошаговые инструкции см. [в разделе как настроить порт с помощью SSL-сертификата](how-to-configure-a-port-with-an-ssl-certificate.md).</span><span class="sxs-lookup"><span data-stu-id="f81c3-134">For step-by-step instructions, see [How to: Configure a Port with an SSL Certificate](how-to-configure-a-port-with-an-ssl-certificate.md).</span></span>

## <a name="configuring-the-ip-listen-list"></a><span data-ttu-id="f81c3-135">Настройка списка ожидания передачи данных по протоколу IP</span><span class="sxs-lookup"><span data-stu-id="f81c3-135">Configuring the IP Listen List</span></span>

<span data-ttu-id="f81c3-136">API HTTP-сервера привязывается к IP-адресу и порту только после регистрации URL-адреса пользователем.</span><span class="sxs-lookup"><span data-stu-id="f81c3-136">The HTTP Server API only binds to an IP address and port once a user registers a URL.</span></span> <span data-ttu-id="f81c3-137">По умолчанию API HTTP-сервера привязывается к порту в URL-адресе для всех IP-адресов компьютера.</span><span class="sxs-lookup"><span data-stu-id="f81c3-137">By default, the HTTP Server API binds to the port in the URL for all of the IP addresses of the machine.</span></span> <span data-ttu-id="f81c3-138">Конфликт возникает, если приложение, которое не использует API сервера HTTP, было ранее привязано к этому сочетанию IP-адреса и порта.</span><span class="sxs-lookup"><span data-stu-id="f81c3-138">A conflict arises if an application that doesn't use the HTTP Server API has previously bound to that combination of IP address and port.</span></span> <span data-ttu-id="f81c3-139">Список прослушивания IP-адресов позволяет службам WCF сосуществовать с приложениями, которые используют порт для некоторых IP-адресов компьютера.</span><span class="sxs-lookup"><span data-stu-id="f81c3-139">The IP Listen List allows WCF services to coexist with applications that use a port for some of the IP addresses of the machine.</span></span> <span data-ttu-id="f81c3-140">Если в списке ожидания передачи данных по протоколу IP содержатся какие-либо записи, API HTTP-сервера привязывается только к IP-адресам, указанным в списке.</span><span class="sxs-lookup"><span data-stu-id="f81c3-140">If the IP Listen List contains any entries, the HTTP Server API only binds to those IP addresses that the list specifies.</span></span> <span data-ttu-id="f81c3-141">Для изменения списка ожидания передачи данных по протоколу IP требуются привилегии администратора.</span><span class="sxs-lookup"><span data-stu-id="f81c3-141">Modifying the IP Listen List requires administrative privileges.</span></span>

<span data-ttu-id="f81c3-142">Используйте средство Netsh для изменения списка прослушивания IP-адресов, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="f81c3-142">Use the netsh tool to modify the IP Listen List, as shown in the following example:</span></span>

```console
netsh http add iplisten ipaddress=0.0.0.0:8000
```

## <a name="other-configuration-settings"></a><span data-ttu-id="f81c3-143">Другие параметры конфигурации</span><span class="sxs-lookup"><span data-stu-id="f81c3-143">Other configuration settings</span></span>

<span data-ttu-id="f81c3-144">При работе с привязкой <xref:System.ServiceModel.WSDualHttpBinding> клиентское соединение использует значения по умолчанию, совместимые с резервированием пространства имен и брандмауэром Windows.</span><span class="sxs-lookup"><span data-stu-id="f81c3-144">When using <xref:System.ServiceModel.WSDualHttpBinding>, the client connection uses defaults that are compatible with namespace reservations and the Windows firewall.</span></span> <span data-ttu-id="f81c3-145">При необходимости настроить базовый адрес клиента для двустороннего соединения, необходимо, кроме того, настроить эти параметры HTTP в клиенте так, чтобы они соответствовали новому адресу.</span><span class="sxs-lookup"><span data-stu-id="f81c3-145">If you choose to customize the client base address of a dual connection, then you also must configure these HTTP settings on the client to match the new address.</span></span>

<span data-ttu-id="f81c3-146">API сервера HTTP имеет некоторые дополнительные параметры конфигурации, недоступные через HttpCfg.</span><span class="sxs-lookup"><span data-stu-id="f81c3-146">The HTTP Server API has some advanced configuration settings that aren't available through HttpCfg.</span></span> <span data-ttu-id="f81c3-147">Эти параметры сохраняются в реестре и применяются ко всем приложениям, выполняемым в системах, которые используют API HTTP-сервера.</span><span class="sxs-lookup"><span data-stu-id="f81c3-147">These settings are maintained in the registry and apply to all applications running on the systems that use the HTTP Server APIs.</span></span> <span data-ttu-id="f81c3-148">Дополнительные сведения об этих параметрах см. в разделе [Http.sys параметры реестра для IIS](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="f81c3-148">For information about these settings, see [Http.sys registry settings for IIS](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span> <span data-ttu-id="f81c3-149">Большинству пользователей не нужно изменять эти параметры.</span><span class="sxs-lookup"><span data-stu-id="f81c3-149">Most users don't need to change these settings.</span></span>

## <a name="see-also"></a><span data-ttu-id="f81c3-150">См. также</span><span class="sxs-lookup"><span data-stu-id="f81c3-150">See also</span></span>

- <xref:System.ServiceModel.WSDualHttpBinding>
- [<span data-ttu-id="f81c3-151">Практическое руководство. Настройка порта с использованием SSL-сертификата</span><span class="sxs-lookup"><span data-stu-id="f81c3-151">How to: Configure a Port with an SSL Certificate</span></span>](how-to-configure-a-port-with-an-ssl-certificate.md)
