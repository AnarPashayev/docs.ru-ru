---
title: Общие сведения о службах рабочих процессов - WCF
ms.date: 03/30/2017
ms.assetid: e536dda3-e286-441e-99a7-49ddc004b646
ms.openlocfilehash: 5d5f8636bec57cee1cb72c2796fc4bafc6b9c044
ms.sourcegitcommit: c7a7e1468bf0fa7f7065de951d60dfc8d5ba89f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65590082"
---
# <a name="workflow-services-overview"></a>Обзор служб рабочего процесса

Службы рабочих процессов являются служб на основе WCF, реализованные с помощью рабочих процессов. Службы рабочих процессов являются рабочими процессами, использующими действия обмена сообщениями для отправки и получения сообщений Windows Communication Foundation (WCF). В.NET Framework 4.5 появилось несколько действий обмена сообщениями, позволяющих отправлять и получать сообщения из рабочего процесса. Дополнительные сведения об обмене сообщениями через действия и как они могут использоваться для реализации различных шаблонов обмена сообщениями см. в разделе [действиями обмена сообщениями](messaging-activities.md).

## <a name="benefits-of-using-workflow-services"></a>Преимущества использования служб рабочих процессов

По мере возрастания распределения приложений отдельные службы становятся ответственными за вызов других служб для передачи им некоторой части работы. Реализация таких вызовов в виде асинхронных операций в коде представляет некоторую сложность. Обработка ошибок добавляет некоторую сложность в форме обработки исключений и обеспечения подробных сведений об отслеживании. Довольно часто некоторые службы являются длительными и занимают ценные системные ресурсы при ожидании ввода. Вследствие этих причин распределенные приложения часто являются очень сложными и их трудно разрабатывать и поддерживать. Рабочие процессы являются естественным способом координации асинхронной работы, особенно вызовов внешних служб. Рабочие процессы также достаточно эффективны при представлении длительных бизнес-процессов. Эти качества делают рабочий процесс великолепным активом для построения служб в распределенной среде.

## <a name="implementing-a-workflow-service"></a>Реализация службы рабочего процесса

При реализации службы WCF, можно определить ряд контрактов, описывающих службу и данные, которые она отправляет и получает. Данные, представленные в виде контрактов данных и сообщений. Службы WCF и службы рабочих процессов используют контракты данных и определения контрактов сообщений как часть описаний служб. Служба сама предоставляет метаданные (в форме WSDL) для описания операций службы. В WCF контракты службы и операций определяют службу и операции, которые она поддерживает. Однако в службе рабочего процесса эти контракты являются частью самого бизнес-процесса. Они поставляются в метаданные процессом, называемым выводом контракта. При размещении службы рабочего процесса с использованием <xref:System.ServiceModel.Activities.WorkflowServiceHost> просматривается определение рабочего процесса и формируется контракт на основе набора действий по отправке и получению сообщений, обнаруженных в рабочем процессе. В частности, для создания контракта используются следующие действия и свойства:

Действие <xref:System.ServiceModel.Activities.Receive>

- <xref:System.ServiceModel.Activities.Receive.ServiceContractName%2A>

- <xref:System.ServiceModel.Activities.Receive.OperationName%2A>

- <xref:System.ServiceModel.Activities.Receive.Action%2A>

Действие <xref:System.ServiceModel.Activities.SendReply>

- <xref:System.ServiceModel.Activities.SendReply.Action%2A>

Действие <xref:System.ServiceModel.Activities.TransactedReceiveScope>

Конечным результатом вывода контракта является описание службы, используя один и тот же структуры данных в качестве службы WCF и контрактов операций. Затем эти сведения используются для предоставления WSDL для службы рабочего процесса.

> [!NOTE]
> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] не позволяет писать службы рабочего процесса с использованием существующего определения контракта без дополнительных средств разработки. Контракты служб рабочих процессов создаются посредством процесса вывода, который был рассмотрен ранее. Контракты сообщений и данных, тем не менее, полностью поддерживаются.

## <a name="workflow-services-and-msmq-based-bindings"></a>Службы рабочих процессов и привязки на основе MSMQ

WCF определяет две привязки на основе очереди сообщений (MSMQ) - <xref:System.ServiceModel.NetMsmqBinding> и <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.  Привязки на основе очереди сообщений (MSMQ) часто используются со службами рабочих процессов, что связано с продолжительностью работы таких служб. Привязки на основе очереди сообщений (MSMQ) имеют свойство `ValidityDuration`, определяющее срок, в течение которого сообщения MSMQ считаются достоверными. Из-за длительного срока работы служб рабочих процессов возможно, что длительность достоверности сообщения MSMQ закончится до того, как служба рабочих процессов сможет его обработать. Поэтому очень важно задать для длительности достоверности привязки MSMQ подходящее значение. Это значение должно выбираться на основе рабочего процесса и способа, с помощью которого он обрабатывает сообщения. Например, если имеется рабочий процесс с действием <xref:System.ServiceModel.Activities.Receive>, сопровождаемым пользовательским действием, которое выполняется 10 минут, и действием <xref:System.ServiceModel.Activities.Receive>, правильное значение `ValidityDuration` должно превышать 10 минут.

## <a name="hosting-a-workflow-service"></a>Размещение службы рабочего процесса

Подобно службам WCF необходимо разместить службы рабочих процессов. Службы WCF использующие <xref:System.ServiceModel.ServiceHost> класса для размещения служб и рабочий процесс службы используют <xref:System.ServiceModel.Activities.WorkflowServiceHost> для размещения служб. Подобно службам WCF службы рабочих процессов можно размещать в различными способами, например:

- В управляемом приложении .NET Framework.

- В службах IIS.

- в службе WAS;

- в управляемой службе Windows.

Рабочий процесс службы, размещенные в управляемом приложении .NET Framework или управляемой службы Windows создайте экземпляр <xref:System.ServiceModel.Activities.WorkflowServiceHost> класса и передать его экземпляр <xref:System.ServiceModel.Activities.WorkflowService> , содержащий определение рабочего процесса в <xref:System.ServiceModel.Activities.WorkflowService.Body%2A> свойство. Определение рабочего процесса, содержащее действия обмена сообщениями, предоставлено службой рабочего процесса.

Для размещения службы рабочего процесса в IIS или WAS поместите XAMLX-файл, содержащий определение службы рабочего процесса, в виртуальный каталог. Конечную точку по умолчанию (с помощью <xref:System.ServiceModel.BasicHttpBinding>) будет создан автоматически, Дополнительные сведения, см. в разделе [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md). Также для указания собственных конечных точек можно разместить файл Web.config в виртуальном каталоге. Если определение рабочего процесса находится в сборке, то можно разместить SVC-файл в виртуальном каталоге, а сборку рабочего процесса в каталоге с кодом приложения. SVC-файл должен указывать фабрику узла службы и класс, реализующий службу рабочего процесса. В следующем примере показан способ указания фабрики узла службы и класса, реализующего службу рабочего процесса.

```
<%@ServiceHost Factory=" System.ServiceModel.Activities.Activation.WorkflowServiceHostFactory
Service="EchoService"%>
```
