---
title: Совместное использование портов Net.TCP
description: Узнайте о протоколе на основе TCP для высокопроизводительного обмена данными и службе, которая позволяет совместно использовать порты в нескольких пользовательских процессах в WCF.
ms.date: 03/30/2017
helpviewer_keywords:
- port activation [WCF]
- port sharing [WCF]
ms.assetid: f13692ee-a179-4439-ae72-50db9534eded
ms.openlocfilehash: 37e2c1de4516cbde58970db685422c5c65e25fb3
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96248101"
---
# <a name="nettcp-port-sharing"></a><span data-ttu-id="395f2-103">Совместное использование портов Net.TCP</span><span class="sxs-lookup"><span data-stu-id="395f2-103">Net.TCP Port Sharing</span></span>

<span data-ttu-id="395f2-104">Windows Communication Foundation (WCF) предоставляет новый сетевой протокол на основе TCP (NET. TCP://) для высокопроизводительного обмена данными.</span><span class="sxs-lookup"><span data-stu-id="395f2-104">Windows Communication Foundation (WCF) provides a new TCP-based network protocol (net.tcp://) for high-performance communication.</span></span> <span data-ttu-id="395f2-105">В WCF также появился новый системный компонент — Служба совместного доступа к портам Net. TCP, которая позволяет совместно использовать порты net. TCP в нескольких пользовательских процессах.</span><span class="sxs-lookup"><span data-stu-id="395f2-105">WCF also introduces a new system component, the Net.TCP Port Sharing Service that enables net.tcp ports to be shared across multiple user processes.</span></span>  
  
## <a name="background-and-motivation"></a><span data-ttu-id="395f2-106">Предыстория и мотивация</span><span class="sxs-lookup"><span data-stu-id="395f2-106">Background and Motivation</span></span>  

 <span data-ttu-id="395f2-107">Когда протокол TCP/IP появился впервые, он использовался лишь в небольшим числе протоколов приложений.</span><span class="sxs-lookup"><span data-stu-id="395f2-107">When the TCP/IP protocol was first introduced, only a small number of application protocols made use of it.</span></span> <span data-ttu-id="395f2-108">В TCP/IP для разграничения приложений использовались номера портов: каждому протоколу приложения присваивался уникальный 16-разрядный номер порта.</span><span class="sxs-lookup"><span data-stu-id="395f2-108">TCP/IP used port numbers to differentiate between applications by assigning a unique 16-bit port number to each application protocol.</span></span> <span data-ttu-id="395f2-109">Например, для HTTP-трафика сегодня стандартным считается TCP-порт 80, для SMTP используется TCP-порт 25, а для FTP - TCP-порты 20 и 21.</span><span class="sxs-lookup"><span data-stu-id="395f2-109">For example, HTTP traffic today is standardized to use TCP port 80, SMTP uses TCP port 25, and FTP uses TCP ports 20 and 21.</span></span> <span data-ttu-id="395f2-110">Другие приложения, использующие в качестве транспорта протокол TCP, могут выбирать другие доступные номера портов - по традиции либо в соответствии с формальными стандартами.</span><span class="sxs-lookup"><span data-stu-id="395f2-110">Other applications using TCP as a transport can choose another available port number, either by convention or through formal standardization.</span></span>  
  
 <span data-ttu-id="395f2-111">Использование для различения приложений номеров портов влекло за собой проблемы с безопасностью.</span><span class="sxs-lookup"><span data-stu-id="395f2-111">Using port numbers to distinguish between applications had security problems.</span></span> <span data-ttu-id="395f2-112">Брандмауэры обычно настраиваются на блокирование TCP-трафика на всех портах, за исключением нескольких широко известных точек входа, поэтому развертывание приложения, использующего нестандартный порт, зачастую сопряжено с трудностями или вообще невозможно в связи с присутствием корпоративных и персональных брандмауэров.</span><span class="sxs-lookup"><span data-stu-id="395f2-112">Firewalls are generally configured to block TCP traffic on all ports except for a few well-known entry points, so deploying an application that uses a non-standard port is often complicated or even impossible due to the presence of corporate and personal firewalls.</span></span> <span data-ttu-id="395f2-113">Приложения, которые способны обмениваться данными через стандартные, широко известные уже разрешенные порты, уменьшают внешнюю площадь атаки.</span><span class="sxs-lookup"><span data-stu-id="395f2-113">Applications that can communicate over standard, well-known ports that are already permitted, reduce the external attack surface.</span></span> <span data-ttu-id="395f2-114">Многие сетевые приложения используют протокол HTTP, поскольку большинство брандмауэров по умолчанию пропускают трафик на TCP-порту 80.</span><span class="sxs-lookup"><span data-stu-id="395f2-114">Many network applications make use of the HTTP protocol because most firewalls are configured by default to allow traffic on TCP port 80.</span></span>  
  
 <span data-ttu-id="395f2-115">Модель HTTP.SYS, в которой трафик для множества различных HTTP-приложений мультиплексируется в один TCP-порт, стала стандартной на платформе Windows.</span><span class="sxs-lookup"><span data-stu-id="395f2-115">The HTTP.SYS model in which traffic for many different HTTP applications is multiplexed onto a single TCP port has become standard on the Windows platform.</span></span> <span data-ttu-id="395f2-116">Это обеспечивает общую контрольную точку для администраторов брандмауэров и в то же время позволяет разработчикам приложений минимизировать стоимость развертывания при построении новых приложений, работа которых предусматривает использование сети.</span><span class="sxs-lookup"><span data-stu-id="395f2-116">This provides a common point of control for firewall administrators while allowing application developers to minimize the deployment cost of building new applications that can make use of the network.</span></span>  
  
 <span data-ttu-id="395f2-117">Возможность совместного использования портов несколькими HTTP-приложениями в течение долгого времени была характерна для служб Internet Information Services (IIS).</span><span class="sxs-lookup"><span data-stu-id="395f2-117">The ability to share ports across multiple HTTP applications has long been a feature of Internet Information Services (IIS).</span></span> <span data-ttu-id="395f2-118">Однако он был только с введением HTTP.SYS (прослушиватель протокола HTTP режима ядра) с IIS 6,0, что эта инфраструктура была полностью обобщенной.</span><span class="sxs-lookup"><span data-stu-id="395f2-118">However, it was only with the introduction of HTTP.SYS (the kernel-mode HTTP protocol listener) with IIS 6.0 that this infrastructure was fully generalized.</span></span> <span data-ttu-id="395f2-119">По сути HTTP.SYS позволяет произвольным пользовательским процессам совместно использовать TCP-порты, выделенные под HTTP-трафик.</span><span class="sxs-lookup"><span data-stu-id="395f2-119">In effect, HTTP.SYS allows arbitrary user processes to share the TCP ports dedicated to HTTP traffic.</span></span> <span data-ttu-id="395f2-120">Эта возможность позволяет нескольким HTTP-приложениям сосуществовать на одном физическом компьютере в отдельных изолированных процессах и в то же время совместно использовать сетевую инфраструктуру, необходимую для отправки и получения трафика через TCP-порт 80.</span><span class="sxs-lookup"><span data-stu-id="395f2-120">This capability allows many HTTP applications to coexist on the same physical machine in separate, isolated processes while sharing the network infrastructure required to send and receive traffic over TCP port 80.</span></span> <span data-ttu-id="395f2-121">Служба совместного использования портов Net.TCP делает возможным такое же совместное использование портов для приложений net.tcp.</span><span class="sxs-lookup"><span data-stu-id="395f2-121">The Net.TCP Port Sharing Service enables the same type of port sharing for net.tcp applications.</span></span>  
  
## <a name="port-sharing-architecture"></a><span data-ttu-id="395f2-122">Архитектура совместного использования портов</span><span class="sxs-lookup"><span data-stu-id="395f2-122">Port Sharing Architecture</span></span>  

 <span data-ttu-id="395f2-123">Архитектура совместного использования портов в WCF имеет три основных компонента:</span><span class="sxs-lookup"><span data-stu-id="395f2-123">The Port Sharing architecture in WCF has three main components:</span></span>  
  
- <span data-ttu-id="395f2-124">Рабочий процесс: любой процесс, обменивающийся данными по протоколу net.tcp:// через совместно используемые порты.</span><span class="sxs-lookup"><span data-stu-id="395f2-124">A Worker Process: Any process communicating over net.tcp:// using shared ports.</span></span>  
  
- <span data-ttu-id="395f2-125">Транспорт TCP WCF: реализует протокол net. TCP://.</span><span class="sxs-lookup"><span data-stu-id="395f2-125">The WCF TCP transport: Implements the net.tcp:// protocol.</span></span>  
  
- <span data-ttu-id="395f2-126">Служба совместного использования портов Net.TCP: позволяет множеству рабочих процессов использовать один и тот же TCP-порт.</span><span class="sxs-lookup"><span data-stu-id="395f2-126">The Net.TCP Port Sharing Service: Allows many worker processes to share the same TCP port.</span></span>  
  
 <span data-ttu-id="395f2-127">Служба совместного использования портов Net.TCP представляет собой службу Windows пользовательского режима, принимающую подключения по net.tcp:// от имени рабочих процессов, которые соединяются через нее.</span><span class="sxs-lookup"><span data-stu-id="395f2-127">The Net.TCP Port Sharing Service is a user-mode Windows service that accepts net.tcp:// connections on behalf of the worker processes that connect through it.</span></span> <span data-ttu-id="395f2-128">При поступлении подключения через сокет служба совместного использования портов анализирует входящий поток сообщения, чтобы получить его адрес назначения.</span><span class="sxs-lookup"><span data-stu-id="395f2-128">When a socket connection arrives, the port sharing service inspects the incoming message stream to obtain its destination address.</span></span> <span data-ttu-id="395f2-129">Располагая этим адресом, служба совместного использования портов может направить поток данных приложению, которое в конечном итоге его обрабатывает.</span><span class="sxs-lookup"><span data-stu-id="395f2-129">Based on this address, the port sharing service can route the data stream to the application that ultimately processes it.</span></span>  
  
 <span data-ttu-id="395f2-130">Когда открывается служба WCF, использующая NET. TCP://совместное использование портов, инфраструктура транспорта TCP WCF не открывает сокет TCP в процессе приложения напрямую.</span><span class="sxs-lookup"><span data-stu-id="395f2-130">When a WCF service that uses net.tcp:// port sharing opens, the WCF TCP transport infrastructure does not directly open a TCP socket in the application process.</span></span> <span data-ttu-id="395f2-131">Вместо этого транспортная инфраструктура регистрирует универсальный код ресурса (URI) базового адреса службы в службе совместного использования портов Net.TCP и ожидает, чтобы служба совместного использования портов прослушивала сообщения от ее имени.</span><span class="sxs-lookup"><span data-stu-id="395f2-131">Instead, the transport infrastructure registers the service’s base address Uniform Resource Identifier (URI) with the Net.TCP Port Sharing Service and waits for the port sharing service to listen for messages on its behalf.</span></span>  <span data-ttu-id="395f2-132">Служба совместного использования портов отправляет сообщения, адресованные службе приложения, по мере их поступления.</span><span class="sxs-lookup"><span data-stu-id="395f2-132">The port sharing service dispatches messages addressed to the application service as they arrive.</span></span>  
  
## <a name="installing-port-sharing"></a><span data-ttu-id="395f2-133">Установка совместного использования портов</span><span class="sxs-lookup"><span data-stu-id="395f2-133">Installing Port Sharing</span></span>  

 <span data-ttu-id="395f2-134">Служба совместного использования портов net. TCP доступна во всех операционных системах, поддерживающих WinFX, но служба не включена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="395f2-134">The Net.TCP Port Sharing Service is available on all operating systems that support WinFX, but the service is not enabled by default.</span></span> <span data-ttu-id="395f2-135">Из соображений безопасности администратор должен вручную включить службу совместного использования Net.TCP перед первым использованием.</span><span class="sxs-lookup"><span data-stu-id="395f2-135">As a security precaution, an administrator must manually enable the Net.TCP Port Sharing Service prior to first use.</span></span> <span data-ttu-id="395f2-136">Служба совместного использования портов Net.TCP предоставляет параметры конфигурации, которые позволяют манипулировать некоторыми характеристиками сетевых сокетов, принадлежащих службе совместного использования портов.</span><span class="sxs-lookup"><span data-stu-id="395f2-136">The Net.TCP Port Sharing Service exposes configuration options that allow you to manipulate several characteristics of the network sockets owned by the port sharing service.</span></span> <span data-ttu-id="395f2-137">Дополнительные сведения см. [в разделе инструкции. Включение службы совместного использования портов net. TCP](how-to-enable-the-net-tcp-port-sharing-service.md).</span><span class="sxs-lookup"><span data-stu-id="395f2-137">For more information, see [How to: Enable the Net.TCP Port Sharing Service](how-to-enable-the-net-tcp-port-sharing-service.md).</span></span>  
  
## <a name="using-nettcp-port-sharing-in-an-application"></a><span data-ttu-id="395f2-138">Включение совместного использования портов Net.TCP в приложении</span><span class="sxs-lookup"><span data-stu-id="395f2-138">Using Net.tcp Port Sharing in an Application</span></span>  

 <span data-ttu-id="395f2-139">Самый простой способ использовать NET. TCP://совместное использование портов в приложении WCF — предоставить службу с помощью, <xref:System.ServiceModel.NetTcpBinding> а затем включить службу совместного использования портов net. TCP с помощью <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> Свойства.</span><span class="sxs-lookup"><span data-stu-id="395f2-139">The easiest way to use net.tcp:// port sharing in your WCF application is to expose a service using the <xref:System.ServiceModel.NetTcpBinding> and then to enable Net.TCP Port Sharing Service using the <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> property.</span></span>  
  
 <span data-ttu-id="395f2-140">Дополнительные сведения о том, как это сделать, см. в разделе [как настроить службу WCF для использования совместного использования портов](how-to-configure-a-wcf-service-to-use-port-sharing.md).</span><span class="sxs-lookup"><span data-stu-id="395f2-140">For more information about how to do this, see [How to: Configure a WCF Service to Use Port Sharing](how-to-configure-a-wcf-service-to-use-port-sharing.md).</span></span>  
  
## <a name="security-implications-of-port-sharing"></a><span data-ttu-id="395f2-141">Проблемы безопасности, связанные с совместным использованием портов</span><span class="sxs-lookup"><span data-stu-id="395f2-141">Security Implications of Port Sharing</span></span>  

 <span data-ttu-id="395f2-142">Хотя служба совместного использования портов Net.TCP предусматривает уровень обработки между приложениями и сетью, приложения, совместно использующие порты, все равно необходимо защищать так, как если бы они непосредственно прослушивали сеть.</span><span class="sxs-lookup"><span data-stu-id="395f2-142">Although the Net.TCP Port Sharing Service provides a layer of processing between applications and the network, applications that use port sharing should still be secured as if they were directly listening on the network.</span></span> <span data-ttu-id="395f2-143">В частности, в приложениях, совместно использующих порты, необходимо оценивать привилегии процессов, в которых они выполняются.</span><span class="sxs-lookup"><span data-stu-id="395f2-143">Specifically, applications that use port sharing should evaluate the process privileges under which they run.</span></span> <span data-ttu-id="395f2-144">Имеет смысл рассмотреть возможность выполнения приложения от имени встроенной учетной записи Network Service, которая выполняется с минимально необходимым для обмена данными по сети набором привилегий.</span><span class="sxs-lookup"><span data-stu-id="395f2-144">Consider running your application using the built-in Network Service account, which runs with the minimal set of process privileges required for network communication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="395f2-145">См. также</span><span class="sxs-lookup"><span data-stu-id="395f2-145">See also</span></span>

- [<span data-ttu-id="395f2-146">Настройка службы совместного использования портов Net.TCP</span><span class="sxs-lookup"><span data-stu-id="395f2-146">Configuring the Net.TCP Port Sharing Service</span></span>](configuring-the-net-tcp-port-sharing-service.md)
- [<span data-ttu-id="395f2-147">Размещение</span><span class="sxs-lookup"><span data-stu-id="395f2-147">Hosting</span></span>](hosting.md)
- [<span data-ttu-id="395f2-148">Практическое руководство. Настройка службы WCF для совместного использования портов</span><span class="sxs-lookup"><span data-stu-id="395f2-148">How to: Configure a WCF Service to Use Port Sharing</span></span>](how-to-configure-a-wcf-service-to-use-port-sharing.md)
- [<span data-ttu-id="395f2-149">Практическое руководство. Включение службы совместного использования портов Net.TCP</span><span class="sxs-lookup"><span data-stu-id="395f2-149">How to: Enable the Net.TCP Port Sharing Service</span></span>](how-to-enable-the-net-tcp-port-sharing-service.md)
