---
title: Совместное использование портов Net.TCP
ms.date: 03/30/2017
helpviewer_keywords:
- port activation [WCF]
- port sharing [WCF]
ms.assetid: f13692ee-a179-4439-ae72-50db9534eded
ms.openlocfilehash: b04266b15f786e3a5a93ac1e9fff1754c397ccd4
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61762756"
---
# <a name="nettcp-port-sharing"></a>Совместное использование портов Net.TCP
Windows Communication Foundation (WCF) предоставляет новый протокол сети на базе TCP (net.tcp://) для высокопроизводительного обмена данными. WCF также появился новый компонент системы, Net.TCP служба совместного использования портов, позволяющий порты net.tcp между несколькими пользовательскими процессами.  
  
## <a name="background-and-motivation"></a>История и причины создания  
 Когда протокол TCP/IP появился впервые, он использовался лишь в небольшим числе протоколов приложений. В TCP/IP для разграничения приложений использовались номера портов: каждому протоколу приложения присваивался уникальный 16-разрядный номер порта. Например, для HTTP-трафика сегодня стандартным считается TCP-порт 80, для SMTP используется TCP-порт 25, а для FTP - TCP-порты 20 и 21. Другие приложения, использующие в качестве транспорта протокол TCP, могут выбирать другие доступные номера портов - по традиции либо в соответствии с формальными стандартами.  
  
 Использование для различения приложений номеров портов влекло за собой проблемы с безопасностью. Брандмауэры обычно настраиваются на блокирование TCP-трафика на всех портах, за исключением нескольких широко известных точек входа, поэтому развертывание приложения, использующего нестандартный порт, зачастую сопряжено с трудностями или вообще невозможно в связи с присутствием корпоративных и персональных брандмауэров. Приложения, которые способны обмениваться данными через стандартные, широко известные уже разрешенные порты, уменьшают внешнюю площадь атаки. Многие сетевые приложения используют протокол HTTP, поскольку большинство брандмауэров по умолчанию пропускают трафик на TCP-порту 80.  
  
 Модель HTTP.SYS, в которой трафик для множества различных HTTP-приложений мультиплексируется в один TCP-порт, стала стандартной на платформе Windows. Это обеспечивает общую контрольную точку для администраторов брандмауэров и в то же время позволяет разработчикам приложений минимизировать стоимость развертывания при построении новых приложений, работа которых предусматривает использование сети.  
  
 Возможность совместного использования портов несколькими HTTP-приложениями в течение долгого времени была характерна для служб Internet Information Services (IIS). Однако полностью эта инфраструктура была введена в употребление только с появлением HTTP.SYS (прослушивателя протокола HTTP режима ядра) в [!INCLUDE[iis601](../../../../includes/iis601-md.md)]. По сути HTTP.SYS позволяет произвольным пользовательским процессам совместно использовать TCP-порты, выделенные под HTTP-трафик. Эта возможность позволяет нескольким HTTP-приложениям сосуществовать на одном физическом компьютере в отдельных изолированных процессах и в то же время совместно использовать сетевую инфраструктуру, необходимую для отправки и получения трафика через TCP-порт 80. Служба совместного использования портов Net.TCP делает возможным такое же совместное использование портов для приложений net.tcp.  
  
## <a name="port-sharing-architecture"></a>Архитектура совместного использования портов  
 Архитектура совместного использования портов в WCF имеется три основных компонента:  
  
- Рабочий процесс: Любой процесс, который обменивается с использованием общих портов net.tcp://.  
  
- TCP-транспорта WCF: Реализует протокол net.tcp://.  
  
- Служба совместного использования портов Net.TCP: Позволяет многим рабочим процессам совместно использовать один и тот же порт TCP.  
  
 Служба совместного использования портов Net.TCP представляет собой службу Windows пользовательского режима, принимающую подключения по net.tcp:// от имени рабочих процессов, которые соединяются через нее. При поступлении подключения через сокет служба совместного использования портов анализирует входящий поток сообщения, чтобы получить его адрес назначения. Располагая этим адресом, служба совместного использования портов может направить поток данных приложению, которое в конечном итоге его обрабатывает.  
  
 Когда служба WCF, использует общий доступ к совместного использования порта net.tcp://, инфраструктура транспорта WCF TCP не открывает непосредственно TCP-сокет в процессе приложения. Вместо этого транспортная инфраструктура регистрирует универсальный код ресурса (URI) базового адреса службы в службе совместного использования портов Net.TCP и ожидает, чтобы служба совместного использования портов прослушивала сообщения от ее имени.  Служба совместного использования портов отправляет сообщения, адресованные службе приложения, по мере их поступления.  
  
## <a name="installing-port-sharing"></a>Установка совместного использования портов  
 Служба совместного использования портов Net.TCP доступна во всех операционных системах, поддерживающих [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)], однако эта служба не включена по умолчанию. Из соображений безопасности администратор должен вручную включить службу совместного использования Net.TCP перед первым использованием. Служба совместного использования портов Net.TCP предоставляет параметры конфигурации, которые позволяют манипулировать некоторыми характеристиками сетевых сокетов, принадлежащих службе совместного использования портов. Дополнительные сведения см. в разделе [Как Включение службы совместного использования портов Net.TCP](../../../../docs/framework/wcf/feature-details/how-to-enable-the-net-tcp-port-sharing-service.md).  
  
## <a name="using-nettcp-port-sharing-in-an-application"></a>Включение совместного использования портов Net.TCP в приложении  
 — Это самый простой способ использования порта net.tcp:// в приложении WCF для предоставления службы с помощью <xref:System.ServiceModel.NetTcpBinding> и затем включить службу по совместного использования портов Net.TCP с помощью <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> свойство.  
  
 Дополнительные сведения об этой операции см. в разделе [Практическое руководство. Настройка службы WCF на совместное использование портов](../../../../docs/framework/wcf/feature-details/how-to-configure-a-wcf-service-to-use-port-sharing.md).  
  
## <a name="security-implications-of-port-sharing"></a>Проблемы безопасности, связанные с совместным использованием портов  
 Хотя служба совместного использования портов Net.TCP предусматривает уровень обработки между приложениями и сетью, приложения, совместно использующие порты, все равно необходимо защищать так, как если бы они непосредственно прослушивали сеть. В частности, в приложениях, совместно использующих порты, необходимо оценивать привилегии процессов, в которых они выполняются. Имеет смысл рассмотреть возможность выполнения приложения от имени встроенной учетной записи Network Service, которая выполняется с минимально необходимым для обмена данными по сети набором привилегий.  
  
## <a name="see-also"></a>См. также

- [Настройка службы совместного использования портов Net.TCP](../../../../docs/framework/wcf/feature-details/configuring-the-net-tcp-port-sharing-service.md)
- [Размещение](../../../../docs/framework/wcf/feature-details/hosting.md)
- [Практическое руководство. Настройка службы WCF на совместное использование портов](../../../../docs/framework/wcf/feature-details/how-to-configure-a-wcf-service-to-use-port-sharing.md)
- [Практическое руководство. Включение службы совместного использования портов Net.TCP](../../../../docs/framework/wcf/feature-details/how-to-enable-the-net-tcp-port-sharing-service.md)
