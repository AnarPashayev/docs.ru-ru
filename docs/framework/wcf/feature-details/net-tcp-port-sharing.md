---
title: Совместное использование портов Net.TCP
description: Узнайте о протоколе на основе TCP для высокопроизводительного обмена данными и службе, которая позволяет совместно использовать порты в нескольких пользовательских процессах в WCF.
ms.date: 03/30/2017
helpviewer_keywords:
- port activation [WCF]
- port sharing [WCF]
ms.assetid: f13692ee-a179-4439-ae72-50db9534eded
ms.openlocfilehash: a9579c588906f509dd835d3c9b25571495d147e0
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2020
ms.locfileid: "85245249"
---
# <a name="nettcp-port-sharing"></a>Совместное использование портов Net.TCP
Windows Communication Foundation (WCF) предоставляет новый сетевой протокол на основе TCP (NET. TCP://) для высокопроизводительного обмена данными. В WCF также появился новый системный компонент — Служба совместного доступа к портам Net. TCP, которая позволяет совместно использовать порты net. TCP в нескольких пользовательских процессах.  
  
## <a name="background-and-motivation"></a>Предыстория и мотивация  
 Когда протокол TCP/IP появился впервые, он использовался лишь в небольшим числе протоколов приложений. В TCP/IP для разграничения приложений использовались номера портов: каждому протоколу приложения присваивался уникальный 16-разрядный номер порта. Например, для HTTP-трафика сегодня стандартным считается TCP-порт 80, для SMTP используется TCP-порт 25, а для FTP - TCP-порты 20 и 21. Другие приложения, использующие в качестве транспорта протокол TCP, могут выбирать другие доступные номера портов - по традиции либо в соответствии с формальными стандартами.  
  
 Использование для различения приложений номеров портов влекло за собой проблемы с безопасностью. Брандмауэры обычно настраиваются на блокирование TCP-трафика на всех портах, за исключением нескольких широко известных точек входа, поэтому развертывание приложения, использующего нестандартный порт, зачастую сопряжено с трудностями или вообще невозможно в связи с присутствием корпоративных и персональных брандмауэров. Приложения, которые способны обмениваться данными через стандартные, широко известные уже разрешенные порты, уменьшают внешнюю площадь атаки. Многие сетевые приложения используют протокол HTTP, поскольку большинство брандмауэров по умолчанию пропускают трафик на TCP-порту 80.  
  
 Модель HTTP.SYS, в которой трафик для множества различных HTTP-приложений мультиплексируется в один TCP-порт, стала стандартной на платформе Windows. Это обеспечивает общую контрольную точку для администраторов брандмауэров и в то же время позволяет разработчикам приложений минимизировать стоимость развертывания при построении новых приложений, работа которых предусматривает использование сети.  
  
 Возможность совместного использования портов несколькими HTTP-приложениями в течение долгого времени была характерна для служб Internet Information Services (IIS). Однако он был только с введением HTTP.SYS (прослушиватель протокола HTTP режима ядра) с IIS 6,0, что эта инфраструктура была полностью обобщенной. По сути HTTP.SYS позволяет произвольным пользовательским процессам совместно использовать TCP-порты, выделенные под HTTP-трафик. Эта возможность позволяет нескольким HTTP-приложениям сосуществовать на одном физическом компьютере в отдельных изолированных процессах и в то же время совместно использовать сетевую инфраструктуру, необходимую для отправки и получения трафика через TCP-порт 80. Служба совместного использования портов Net.TCP делает возможным такое же совместное использование портов для приложений net.tcp.  
  
## <a name="port-sharing-architecture"></a>Архитектура совместного использования портов  
 Архитектура совместного использования портов в WCF имеет три основных компонента:  
  
- Рабочий процесс: любой процесс, обменивающийся данными по протоколу net.tcp:// через совместно используемые порты.  
  
- Транспорт TCP WCF: реализует протокол net. TCP://.  
  
- Служба совместного использования портов Net.TCP: позволяет множеству рабочих процессов использовать один и тот же TCP-порт.  
  
 Служба совместного использования портов Net.TCP представляет собой службу Windows пользовательского режима, принимающую подключения по net.tcp:// от имени рабочих процессов, которые соединяются через нее. При поступлении подключения через сокет служба совместного использования портов анализирует входящий поток сообщения, чтобы получить его адрес назначения. Располагая этим адресом, служба совместного использования портов может направить поток данных приложению, которое в конечном итоге его обрабатывает.  
  
 Когда открывается служба WCF, использующая NET. TCP://совместное использование портов, инфраструктура транспорта TCP WCF не открывает сокет TCP в процессе приложения напрямую. Вместо этого транспортная инфраструктура регистрирует универсальный код ресурса (URI) базового адреса службы в службе совместного использования портов Net.TCP и ожидает, чтобы служба совместного использования портов прослушивала сообщения от ее имени.  Служба совместного использования портов отправляет сообщения, адресованные службе приложения, по мере их поступления.  
  
## <a name="installing-port-sharing"></a>Установка совместного использования портов  
 Служба совместного использования портов net. TCP доступна во всех операционных системах, поддерживающих WinFX, но служба не включена по умолчанию. Из соображений безопасности администратор должен вручную включить службу совместного использования Net.TCP перед первым использованием. Служба совместного использования портов Net.TCP предоставляет параметры конфигурации, которые позволяют манипулировать некоторыми характеристиками сетевых сокетов, принадлежащих службе совместного использования портов. Дополнительные сведения см. [в разделе инструкции. Включение службы совместного использования портов net. TCP](how-to-enable-the-net-tcp-port-sharing-service.md).  
  
## <a name="using-nettcp-port-sharing-in-an-application"></a>Включение совместного использования портов Net.TCP в приложении  
 Самый простой способ использовать NET. TCP://совместное использование портов в приложении WCF — предоставить службу с помощью, <xref:System.ServiceModel.NetTcpBinding> а затем включить службу совместного использования портов net. TCP с помощью <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> Свойства.  
  
 Дополнительные сведения о том, как это сделать, см. в разделе [как настроить службу WCF для использования совместного использования портов](how-to-configure-a-wcf-service-to-use-port-sharing.md).  
  
## <a name="security-implications-of-port-sharing"></a>Проблемы безопасности, связанные с совместным использованием портов  
 Хотя служба совместного использования портов Net.TCP предусматривает уровень обработки между приложениями и сетью, приложения, совместно использующие порты, все равно необходимо защищать так, как если бы они непосредственно прослушивали сеть. В частности, в приложениях, совместно использующих порты, необходимо оценивать привилегии процессов, в которых они выполняются. Имеет смысл рассмотреть возможность выполнения приложения от имени встроенной учетной записи Network Service, которая выполняется с минимально необходимым для обмена данными по сети набором привилегий.  
  
## <a name="see-also"></a>См. также

- [Настройка службы совместного использования портов Net.TCP](configuring-the-net-tcp-port-sharing-service.md)
- [Размещение](hosting.md)
- [Практическое руководство. Настройка службы WCF для совместного использования портов](how-to-configure-a-wcf-service-to-use-port-sharing.md)
- [Практическое руководство. Включение службы совместного использования портов Net.TCP](how-to-enable-the-net-tcp-port-sharing-service.md)
