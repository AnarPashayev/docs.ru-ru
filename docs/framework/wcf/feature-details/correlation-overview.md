---
title: Общие сведения о корреляции
ms.date: 03/30/2017
ms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f
ms.openlocfilehash: cb11f65a30c6bdf5a1d910402ef58446c03a5491
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75963942"
---
# <a name="correlation-overview"></a><span data-ttu-id="d3d0d-102">Общие сведения о корреляции</span><span class="sxs-lookup"><span data-stu-id="d3d0d-102">Correlation Overview</span></span>
<span data-ttu-id="d3d0d-103">Корреляция - это механизм связи сообщений службы рабочего процесса друг с другом или с состоянием экземпляра приложения, таким как ответ на начальный запрос, или с определенным идентификатором запроса к сохраненному состоянию рабочего процесса обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-103">Correlation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow.</span></span> <span data-ttu-id="d3d0d-104">В данном разделе приведены общие сведения о корреляции.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-104">This topic provides an overview of correlation.</span></span> <span data-ttu-id="d3d0d-105">В других подразделах этого раздела содержатся дополнительные сведения о каждом из видов корреляции.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-105">The other topics in this section provide additional information for each type of correlation.</span></span>  
  
## <a name="types-of-correlation"></a><span data-ttu-id="d3d0d-106">Типы корреляции</span><span class="sxs-lookup"><span data-stu-id="d3d0d-106">Types of Correlation</span></span>  
 <span data-ttu-id="d3d0d-107">Корреляция может быть основана на протоколе или на содержимом.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-107">Correlation can be protocol-based or content-based.</span></span> <span data-ttu-id="d3d0d-108">При основанной на протоколе корреляции для сопоставления сообщений используются данные, предоставляемые инфраструктурой доставки сообщений.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-108">Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages.</span></span> <span data-ttu-id="d3d0d-109">Сообщения, сопоставляемые с помощью корреляции на основе протокола, связываются друг с другом с помощью находящегося в памяти объекта, например <xref:System.ServiceModel.Channels.RequestContext>, или с помощью маркера, предоставляемого транспортным протоколом.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-109">Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol.</span></span> <span data-ttu-id="d3d0d-110">Корреляции на основе содержимого связывает сообщения друг с другом с помощью данных, задаваемых приложением.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-110">Content-based correlations relate messages to each other using application-specified data.</span></span> <span data-ttu-id="d3d0d-111">Сообщения, сопоставляемые с помощью корреляции на основе содержимого, связываются друг с другом с помощью содержащихся в сообщении данных, определяемых приложением, например по номеру клиента.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-111">Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.</span></span>  
  
 <span data-ttu-id="d3d0d-112">Действия, участвующие в корреляции, применяют для объединения действий обмена сообщениями дескриптор <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-112">Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together.</span></span> <span data-ttu-id="d3d0d-113">Например, для действия <xref:System.ServiceModel.Activities.Send>, используемого для вызова службы, и следующего за ним действия <xref:System.ServiceModel.Activities.Receive>, используемого для получения обратного вызова от службы, применяется один и тот же дескриптор <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-113">For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="d3d0d-114">Этот основной шаблон применяется как для корреляции на основе содержимого, так и для корреляции на основе протокола.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-114">This basic pattern is used whether the correlation is content based or protocol based.</span></span> <span data-ttu-id="d3d0d-115">Дескриптор взаимосвязи может быть установлен для каждого действия явно, или же действия могут содержаться в действии <xref:System.ServiceModel.Activities.CorrelationScope>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-115">The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="d3d0d-116">Дескрипторами взаимосвязи действий, содержащихся в <xref:System.ServiceModel.Activities.CorrelationScope>, управляет <xref:System.ServiceModel.Activities.CorrelationScope>, для них не требуется явно задавать значение <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-116">Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set.</span></span> <span data-ttu-id="d3d0d-117">Область <xref:System.ServiceModel.Activities.CorrelationScope> реализует управление дескрипторами <xref:System.ServiceModel.Activities.CorrelationHandle> для корреляции «запрос-ответ» и одного дополнительного типа корреляции.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-117">A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type.</span></span> <span data-ttu-id="d3d0d-118">Для служб рабочих процессов, размещенных с помощью <xref:System.ServiceModel.Activities.WorkflowServiceHost>, используется то же управление корреляцией по умолчанию, что и для действия <xref:System.ServiceModel.Activities.CorrelationScope>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-118">Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="d3d0d-119">Это управление корреляцией по умолчанию, как правило, приводит к тому, что во многих сценариях использования для действий обмена сообщениями в области <xref:System.ServiceModel.Activities.CorrelationScope> или для службы рабочего процесса не требуется задавать дескриптор <xref:System.ServiceModel.Activities.CorrelationHandle>, если только несколько действий обмена сообщениями не выполняются параллельно или с перекрытием (например, два параллельных действия <xref:System.ServiceModel.Activities.Receive> или два действия <xref:System.ServiceModel.Activities.Send>, за которыми следует два действия <xref:System.ServiceModel.Activities.Receive>).</span><span class="sxs-lookup"><span data-stu-id="d3d0d-119">This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="d3d0d-120">Дополнительные сведения о корреляции по умолчанию содержатся в подразделах этого раздела, описывающих каждый из видов корреляции по отдельности.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-120">More information about default correlation is provided in the topics in this section that cover each specific type of correlation.</span></span> <span data-ttu-id="d3d0d-121">Дополнительные сведения о действиях обмена сообщениями см. в разделе [действия по обмену сообщениями](../../../../docs/framework/wcf/feature-details/messaging-activities.md) и [инструкции. Создание службы рабочего процесса с помощью действий обмена сообщениями](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md).</span><span class="sxs-lookup"><span data-stu-id="d3d0d-121">For more information about messaging activities see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md).</span></span>  
  
## <a name="protocol-based-correlation"></a><span data-ttu-id="d3d0d-122">Корреляция, основанная на протоколе</span><span class="sxs-lookup"><span data-stu-id="d3d0d-122">Protocol-Based Correlation</span></span>

<span data-ttu-id="d3d0d-123">Основанная на протоколе корреляция использует транспортный механизм для связи сообщений друг с другом и с соответствующим экземпляром.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-123">Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance.</span></span> <span data-ttu-id="d3d0d-124">Некоторые предоставляемые системой корреляции на основе протокола включают корреляции типа «запрос-ответ» и корреляции на основе контекста.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-124">Some system-provided protocol correlations include request-reply correlation and context-based correlation.</span></span> <span data-ttu-id="d3d0d-125">Корреляции «запрос-ответ» используются для сопоставления пары действий обмена сообщениями с операцией двунаправленной формы, например действие <xref:System.ServiceModel.Activities.Send> может составлять пару с действием <xref:System.ServiceModel.Activities.ReceiveReply>, а действие <xref:System.ServiceModel.Activities.Receive> может составлять пару с действием <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-125">A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="d3d0d-126">Visual Studio конструктор рабочих процессов также предоставляет набор шаблонов действий для быстрой реализации этого шаблона.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-126">The Visual Studio Workflow Designer also provides a set of activity templates to quickly implement this pattern.</span></span> <span data-ttu-id="d3d0d-127">Корреляция на основе контекста основана на механизме обмена контекстом, описанном в [спецификации протокола обмена контекстами .NET](https://docs.microsoft.com/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4).</span><span class="sxs-lookup"><span data-stu-id="d3d0d-127">A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](https://docs.microsoft.com/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4).</span></span> <span data-ttu-id="d3d0d-128">Для использования корреляции на основе контекста в конечной точке необходимо использовать привязку на основе контекста, например <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> или <xref:System.ServiceModel.NetTcpContextBinding>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-128">To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint.</span></span>  
  
<span data-ttu-id="d3d0d-129">Дополнительные сведения о корреляции протоколов см. в разделе [устойчивая дуплексная](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md) и [запрос-ответ](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="d3d0d-129">For more information about protocol correlation, see [Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md) and [Request-Reply](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md).</span></span> <span data-ttu-id="d3d0d-130">Дополнительные сведения об использовании шаблонов действий Visual Studio конструктор рабочих процессов см. в разделе [действия обмена сообщениями](../../../../docs/framework/wcf/feature-details/messaging-activities.md).</span><span class="sxs-lookup"><span data-stu-id="d3d0d-130">For more information about using the Visual Studio Workflow Designer activity templates, see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md).</span></span> <span data-ttu-id="d3d0d-131">Пример кода см. в примере [нетконтекстексчанжекоррелатион](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29) .</span><span class="sxs-lookup"><span data-stu-id="d3d0d-131">For sample code, see the [NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29) sample.</span></span>  
  
## <a name="content-based-correlation"></a><span data-ttu-id="d3d0d-132">Корреляция по содержимому</span><span class="sxs-lookup"><span data-stu-id="d3d0d-132">Content-Based Correlation</span></span>

<span data-ttu-id="d3d0d-133">При корреляции, основанной на содержимом, для сопоставления сообщения с конкретным экземпляром используется часть содержащихся в сообщении данных.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-133">Content-based correlation uses some piece of information in the message to associate it to a particular instance.</span></span> <span data-ttu-id="d3d0d-134">В отличие от корреляции на основе протокола, при использовании корреляции на основе содержимого разработчик приложения должен явно указать, где в каждом из сопоставляемых сообщений находится такая часть данных.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-134">Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message.</span></span> <span data-ttu-id="d3d0d-135">В действиях, использующих корреляцию на основе содержимого, эти данные сообщения задаются с помощью набора <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-135">Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="d3d0d-136">Корреляция на основе содержимого полезна при взаимодействии со службами, в которых не применяется ни одна из контекстных привязок, таких как <xref:System.ServiceModel.BasicHttpContextBinding>.</span><span class="sxs-lookup"><span data-stu-id="d3d0d-136">Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="d3d0d-137">См. также:</span><span class="sxs-lookup"><span data-stu-id="d3d0d-137">See also</span></span>

- [<span data-ttu-id="d3d0d-138">NetContextExchangeCorrelation</span><span class="sxs-lookup"><span data-stu-id="d3d0d-138">NetContextExchangeCorrelation</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)
