---
title: Сценарии маршрутизации
ms.date: 03/30/2017
helpviewer_keywords:
- rounting [WCF], scenarios
ms.assetid: ec22f308-665a-413e-9f94-7267cb665dab
ms.openlocfilehash: fa5d588211cfe40cde9e9db3161a931e3287cd39
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59223831"
---
# <a name="routing-scenarios"></a><span data-ttu-id="ed9a0-102">Сценарии маршрутизации</span><span class="sxs-lookup"><span data-stu-id="ed9a0-102">Routing Scenarios</span></span>
<span data-ttu-id="ed9a0-103">Хотя служба маршрутизации является настраиваемой, спроектировать эффективную логику маршрутизации при создании новой конфигурации с нуля может быть достаточно сложным.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-103">While the Routing Service is highly customizable, it can be a challenge to design efficient routing logic when creating a new configuration from scratch.</span></span>  <span data-ttu-id="ed9a0-104">Однако существует несколько типичных сценариев, которым следует большинство конфигураций службы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-104">However, there are several common scenarios that most Routing Service configurations follow.</span></span> <span data-ttu-id="ed9a0-105">Хотя эти сценарии могут не применяться напрямую к определенной конфигурации, освоение способа настройки службы маршрутизации для управления этими сценариями поможет в понимании работы службы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-105">While these scenarios may not apply directly to your specific configuration, understanding how the Routing Service can be configured to handle these scenarios will aid you in understanding the Routing Service.</span></span>  
  
## <a name="common-scenarios"></a><span data-ttu-id="ed9a0-106">Стандартные сценарии</span><span class="sxs-lookup"><span data-stu-id="ed9a0-106">Common Scenarios</span></span>  
 <span data-ttu-id="ed9a0-107">Наиболее часто служба маршрутизации используется для объединения нескольких целевых конечных точек для снижения числа конечных точек, представленных клиентским приложениям, и последующего использования фильтров сообщений для перенаправления каждого сообщения в нужное назначение.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-107">The most basic use of the Routing Service is to aggregate multiple destination endpoints to reduce the number of endpoints exposed to the client applications, and then use message filters to route each message to the correct destination.</span></span> <span data-ttu-id="ed9a0-108">Сообщения можно перенаправить на основе логических или физических требований к обработке, например типа сообщения, которое должно обрабатываться определенной службой, или на основе произвольных бизнес-требованиях, например обеспечении приоритета обработки сообщений от определенного источника.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-108">Messages may be routed based on logical or physical processing requirements, such as a message type that must be processed by a specific service, or based on arbitrary business needs such as providing priority processing of messages from a specific source.</span></span> <span data-ttu-id="ed9a0-109">В следующей таблице перечислены некоторые стандартные сценарии и условия, при которых они возникают.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-109">The following table lists some of the common scenarios and when they are encountered:</span></span>  
  
|<span data-ttu-id="ed9a0-110">Сценарий</span><span class="sxs-lookup"><span data-stu-id="ed9a0-110">Scenario</span></span>|<span data-ttu-id="ed9a0-111">Используется, если</span><span class="sxs-lookup"><span data-stu-id="ed9a0-111">Use when</span></span>|  
|--------------|--------------|  
|<span data-ttu-id="ed9a0-112">Управление версиями служб</span><span class="sxs-lookup"><span data-stu-id="ed9a0-112">Service versioning</span></span>|<span data-ttu-id="ed9a0-113">Необходимо поддерживать несколько версий службы, или потребуется развертывание обновленной службы в будущем</span><span class="sxs-lookup"><span data-stu-id="ed9a0-113">You need to support multiple versions of a service or may deploy an updated service in the future</span></span>|  
|<span data-ttu-id="ed9a0-114">Секционирование данных службы</span><span class="sxs-lookup"><span data-stu-id="ed9a0-114">Service data partitioning</span></span>|<span data-ttu-id="ed9a0-115">Необходимо секционировать службу в нескольких узлах</span><span class="sxs-lookup"><span data-stu-id="ed9a0-115">You must partition a service across multiple hosts</span></span>|  
|<span data-ttu-id="ed9a0-116">Динамическое обновление</span><span class="sxs-lookup"><span data-stu-id="ed9a0-116">Dynamic update</span></span>|<span data-ttu-id="ed9a0-117">Необходимо динамически перенастроить логику маршрутизации во время выполнения для управления изменением развертывания служб</span><span class="sxs-lookup"><span data-stu-id="ed9a0-117">You must dynamically reconfigure routing logic at runtime to handle changing service deployments</span></span>|  
|<span data-ttu-id="ed9a0-118">Multicast</span><span class="sxs-lookup"><span data-stu-id="ed9a0-118">Multicast</span></span>|<span data-ttu-id="ed9a0-119">Необходимо отправить одно сообщение в несколько конечных точек</span><span class="sxs-lookup"><span data-stu-id="ed9a0-119">You must send one message to multiple endpoints</span></span>|  
|<span data-ttu-id="ed9a0-120">Связывание протоколов</span><span class="sxs-lookup"><span data-stu-id="ed9a0-120">Protocol bridging</span></span>|<span data-ttu-id="ed9a0-121">Получение сообщений выполняется через один транспортный протокол, а целевая конечная точка использует другой протокол</span><span class="sxs-lookup"><span data-stu-id="ed9a0-121">You receive messages over one transport protocol, and the destination endpoint uses a different protocol</span></span>|  
|<span data-ttu-id="ed9a0-122">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="ed9a0-122">Error Handling</span></span>|<span data-ttu-id="ed9a0-123">Необходимо обеспечить устойчивость к сетевым сбоям и ошибкам связи</span><span class="sxs-lookup"><span data-stu-id="ed9a0-123">You need to provide resilience to network outages and communication failures</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="ed9a0-124">Хотя многие из представленных сценариев созданы для определенных бизнес-требований или требований к обработке, планирование динамических обновлений и управление ошибками часто считается лучшей методикой, поскольку позволяет изменять логику маршрутизации во время выполнения и выполнять восстановление после временных неполадок в сети и ошибок связи.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-124">While many of the scenarios presented are specific to certain business needs or processing requirements, planning to support dynamic updates and utilizing error handling can often be considered as best practices as they allow you to modify routing logic at runtime and recover from transient network and communication failures.</span></span>  
  
### <a name="service-versioning"></a><span data-ttu-id="ed9a0-125">Управление версиями службы</span><span class="sxs-lookup"><span data-stu-id="ed9a0-125">Service Versioning</span></span>  
 <span data-ttu-id="ed9a0-126">При выходе новой версии службы часто бывает необходимо поддерживать предыдущую версию до перевода всех клиентов на новую службу.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-126">When introducing a new version of a service, you must often maintain the previous version until all clients have transitioned to the new service.</span></span> <span data-ttu-id="ed9a0-127">Это особенно важно, если служба является длительным процессом, требующим для выполнения дни, недели и даже месяцы.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-127">This is especially critical if the service is a long-running process that takes days, weeks, or even months to complete.</span></span> <span data-ttu-id="ed9a0-128">Обычно это требует внедрения нового адреса конечной точки для новой службы с сохранением поддержки исходной конечной точки для предыдущей версии.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-128">Usually this requires implementing a new endpoint address for the new service while maintaining the original endpoint for the previous version.</span></span>  
  
 <span data-ttu-id="ed9a0-129">Служба маршрутизации позволяет через одну конечную точку принимать сообщения от клиентских приложений и перенаправлять каждое сообщение на основе его содержимого службе с требуемой версией.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-129">By using the Routing Service, you can expose one endpoint to receive messages from client applications and then route each message to the correct service version based on the message content.</span></span> <span data-ttu-id="ed9a0-130">Наиболее общая реализация включает добавление пользовательского заголовка в сообщение, определяющее версию службы, которая обрабатывает данное сообщение.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-130">The most basic implementation involves adding a custom header to the message that indicates the version of the service that the message is to be processed by.</span></span> <span data-ttu-id="ed9a0-131">Служба маршрутизации может использовать объект XPathMessageFilter для проверки каждого сообщения на наличие пользовательского заголовка и перенаправлять сообщение в соответствующую целевую конечную точку.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-131">The Routing Service can use the XPathMessageFilter to inspect each message for the presence of the custom header and route the message to the appropriate destination endpoint.</span></span>  
  
 <span data-ttu-id="ed9a0-132">Шаги, используемые для создания конфигурации управления версиями службы, см. в разделе [How To: Управление версиями службы](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="ed9a0-132">For the steps used to create a service versioning configuration, see [How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md).</span></span>
  
### <a name="service-data-partitioning"></a><span data-ttu-id="ed9a0-133">Секционирование данных служб</span><span class="sxs-lookup"><span data-stu-id="ed9a0-133">Service Data Partitioning</span></span>  
 <span data-ttu-id="ed9a0-134">При проектировании распределенной среды часто требуется распределение нагрузки обработки среди нескольких компьютеров для обеспечения высокого уровня доступности, снижения нагрузки обработки на отдельных компьютерах или для предоставления выделенных ресурсов для определенных подмножеств сообщений.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-134">When designing a distributed environment, it is often desirable to spread processing load across multiple computers in order to provide high availability, decrease processing load on individual computers, or to provide dedicated resources for a specific subset of messages.</span></span> <span data-ttu-id="ed9a0-135">Хотя служба маршрутизации не заменяет специализированное решение по балансу нагрузки, ее способность выполнять маршрутизацию на основе содержимого можно использовать для перенаправления похожих сообщений в определенные назначения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-135">While the Routing Service does not replace a dedicated load balancing solution, its ability to perform content based routing can be used to route otherwise similar messages to specific destinations.</span></span> <span data-ttu-id="ed9a0-136">Например, можно назначить обработку сообщений от определенного клиента отдельно от сообщений, полученных от других клиентов.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-136">For example, you may have a requirement to process messages from a specific client separately from messages received from other clients.</span></span>  
  
 <span data-ttu-id="ed9a0-137">Шаги, используемые для создания конфигурации секционирования данных службы, см. в разделе [How To: Секционирование данных службы](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="ed9a0-137">For the steps used to create a service data partitioning configuration, see [How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md).</span></span>  
  
### <a name="dynamic-routing"></a><span data-ttu-id="ed9a0-138">Динамическая маршрутизация</span><span class="sxs-lookup"><span data-stu-id="ed9a0-138">Dynamic Routing</span></span>  
 <span data-ttu-id="ed9a0-139">Часто требуется изменить конфигурацию маршрутизации для удовлетворения изменений бизнес-требований, например добавления маршрута к более новой версии службы, изменения критерия маршрутизации или изменения целевой конечной точки определенного сообщения, которое перенаправляет фильтр.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-139">Often it is desirable to modify the routing configuration to satisfy changing business needs, such as adding a route to a newer version of a service, changing routing criteria, or changing the destination endpoint a specific message that the filter routes to.</span></span> <span data-ttu-id="ed9a0-140">Служба маршрутизации позволяет выполнять вышеуказанные задачи с помощью класса <xref:System.ServiceModel.Routing.RoutingExtension>, который позволяет предоставлять новую конфигурацию маршрутизации во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-140">The Routing Service allows you to do this through the <xref:System.ServiceModel.Routing.RoutingExtension>, which allows you to provide a new RoutingConfiguration during run time.</span></span> <span data-ttu-id="ed9a0-141">Новая конфигурация вступает в силу немедленно, но влияет только на новые сеансы, обрабатываемые службой маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-141">The new configuration takes effect immediately, but only affects any new sessions processed by the Routing Service.</span></span>  
  
 <span data-ttu-id="ed9a0-142">Шаги, используемые для реализации динамической маршрутизации, см. в разделе [How To: Динамическое обновление](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md).</span><span class="sxs-lookup"><span data-stu-id="ed9a0-142">For the steps used to implement dynamic routing, see [How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md).</span></span>
  
### <a name="multicast"></a><span data-ttu-id="ed9a0-143">Multicast</span><span class="sxs-lookup"><span data-stu-id="ed9a0-143">Multicast</span></span>  
 <span data-ttu-id="ed9a0-144">При маршрутизации сообщений, как правило, выполняется перенаправление каждого сообщения в одну определенную целевую конечную точку.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-144">When routing messages, usually you routing each message to one specific destination endpoint.</span></span>  <span data-ttu-id="ed9a0-145">Однако может потребоваться перенаправить копию сообщения в несколько целевых конечных точек.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-145">However, you may occasionally need to route a copy of the message to multiple destination endpoints.</span></span> <span data-ttu-id="ed9a0-146">Для выполнения многоадресной маршрутизации необходимо соблюдение следующих условий.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-146">To perform multicast routing, the following conditions must be true:</span></span>  
  
-   <span data-ttu-id="ed9a0-147">Форма канала не должна иметь тип «запрос-ответ» (хотя он может быть односторонним или дуплексным), так как данный тип требует, чтобы на запрос от клиентского приложения выдавался только один ответ.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-147">The channel shape must not be request-reply (though it may be one-way or duplex,) because request-reply mandates that only one reply can be received by the client application in response to the request.</span></span>  
  
-   <span data-ttu-id="ed9a0-148">Несколько фильтров должны возвращать **true** при оценке сообщения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-148">Multiple filters must return **true** when evaluating the message.</span></span>  
  
 <span data-ttu-id="ed9a0-149">При выполнении этих условий каждая целевая конечная точка, связанная с фильтром, возвращающим значение true, получит копию сообщения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-149">If these conditions are met, each destination endpoint that is associated with a filter that returns true will receive a copy of the message.</span></span>  
  
### <a name="protocol-bridging"></a><span data-ttu-id="ed9a0-150">Связывание протоколов</span><span class="sxs-lookup"><span data-stu-id="ed9a0-150">Protocol Bridging</span></span>  
 <span data-ttu-id="ed9a0-151">При маршрутизации сообщений между разнородными протоколами SOAP служба маршрутизации использует API-интерфейсы WCF для преобразования сообщения из одного протокола в другой.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-151">When routing messages between dissimilar SOAP protocols, the Routing Service uses WCF APIs to convert the message from one protocol to the other.</span></span> <span data-ttu-id="ed9a0-152">Это происходит автоматически, если конечная точка службы, представленная службой маршрутизации, использует протокол, отличный от протокола, используемого клиентской точкой, в которую перенаправляются сообщения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-152">This occurs automatically when the service endpoint(s) exposed by the Routing Service use a different protocol than the client endpoint(s) that messages are routed to.</span></span> <span data-ttu-id="ed9a0-153">Данное поведение можно отключить, если используемые протоколы не являются стандартными. Однако затем необходимо предоставить свой собственный код преобразования.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-153">It is possible to disable this behavior if the protocols in use are not standard; however, you must then provide your own bridging code.</span></span>
  
### <a name="error-handling"></a><span data-ttu-id="ed9a0-154">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="ed9a0-154">Error Handling</span></span>  
 <span data-ttu-id="ed9a0-155">В распределенной среде временные неполадки в сети или ошибки связи обычно не возникают.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-155">In a distributed environment, it is not uncommon to encounter transient network or communication failures.</span></span> <span data-ttu-id="ed9a0-156">Без наличия службы-посредника, такой как служба маршрутизации, нагрузка по устранению таких ошибок ложится на клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-156">Without an intermediary service such as the Routing Service, the burden of handling such failures falls on the client application.</span></span> <span data-ttu-id="ed9a0-157">Если клиентское приложение не содержит определенную логику повторения при ошибках сети или связи и набора знаний об альтернативных расположениях, то пользователь может столкнуться с ситуацией, когда сообщение необходимо отправить несколько раз, перед тем как оно будет успешно обработано целевой службой.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-157">If the client application does not include specific logic to retry in the event of network or communication failures and knowledge of alternate locations, the user may encounter scenarios where a message must be submitted multiple times before it is successfully processed by the destination service.</span></span> <span data-ttu-id="ed9a0-158">Это приводит к неудовлетворению заказчика качеством работы приложения, и оно может быть воспринято как ненадежное.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-158">This can lead to customer dissatisfaction with the application, as it may be perceived as unreliable.</span></span>  
  
 <span data-ttu-id="ed9a0-159">Служба маршрутизации помогает решить проблемы такого сценария, предоставляя сообщениям возможность надежной обработки ошибок или сбоев связи, возникающих в сети.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-159">The Routing Service attempts to remedy this scenario by providing robust error handling capabilities for messages that encounter network or communication-related failures.</span></span> <span data-ttu-id="ed9a0-160">Путем создания списка возможных целевых точек и сопоставления данного списка с каждым фильтром сообщений решается проблема, вызванная наличием только одного возможного назначения.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-160">By creating a list of possible destination endpoints and associating this list with each message filter, you remove the single point of failure incurred by having only one possible destination.</span></span> <span data-ttu-id="ed9a0-161">В случае сбоя служба маршрутизации попытается доставить сообщение следующей конечной точке в списке до окончательной доставки сообщения, возникновения сбоя, не относящегося к связи, или пока не закончатся все конечные точки.</span><span class="sxs-lookup"><span data-stu-id="ed9a0-161">In the event of a failure, the Routing Service will attempt to deliver the message to the next endpoint in the list until the message has been delivered, a non-communication failure occurs, or all endpoints have been exhausted.</span></span>  
  
 <span data-ttu-id="ed9a0-162">Шаги, используемые для настройки обработки ошибок, см. в разделе [How To: Обработка ошибок](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ed9a0-162">For the steps used to configure error handling, see [How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md).</span></span>
  
### <a name="in-this-section"></a><span data-ttu-id="ed9a0-163">В этом разделе</span><span class="sxs-lookup"><span data-stu-id="ed9a0-163">In This Section</span></span>  
 [<span data-ttu-id="ed9a0-164">Практическое руководство. Управление версиями службы</span><span class="sxs-lookup"><span data-stu-id="ed9a0-164">How To: Service Versioning</span></span>](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)  
  
 [<span data-ttu-id="ed9a0-165">Практическое руководство. Секционирование данных служб</span><span class="sxs-lookup"><span data-stu-id="ed9a0-165">How To: Service Data Partitioning</span></span>](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)  
  
 [<span data-ttu-id="ed9a0-166">Практическое руководство. Динамическое обновление</span><span class="sxs-lookup"><span data-stu-id="ed9a0-166">How To: Dynamic Update</span></span>](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)  
  
 [<span data-ttu-id="ed9a0-167">Практическое руководство. Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="ed9a0-167">How To: Error Handling</span></span>](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)  
  
## <a name="see-also"></a><span data-ttu-id="ed9a0-168">См. также</span><span class="sxs-lookup"><span data-stu-id="ed9a0-168">See also</span></span>

- [<span data-ttu-id="ed9a0-169">Введение в маршрутизацию</span><span class="sxs-lookup"><span data-stu-id="ed9a0-169">Routing Introduction</span></span>](../../../../docs/framework/wcf/feature-details/routing-introduction.md)
