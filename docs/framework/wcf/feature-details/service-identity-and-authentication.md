---
title: Идентификация и проверка подлинности службы
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- authentication [WCF], specifying the identity of a service
ms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be
ms.openlocfilehash: 695b6c24700fe42664944d6f9c1e03010248d86a
ms.sourcegitcommit: 2d42b7ae4252cfe1232777f501ea9ac97df31b63
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2019
ms.locfileid: "67487738"
---
# <a name="service-identity-and-authentication"></a><span data-ttu-id="4f0e8-102">Идентификация и проверка подлинности службы</span><span class="sxs-lookup"><span data-stu-id="4f0e8-102">Service Identity and Authentication</span></span>
<span data-ttu-id="4f0e8-103">Это служба *удостоверение конечной точки* представляет собой значение, созданный из службы языка описания служб (WSDL).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-103">A service's *endpoint identity* is a value generated from the service Web Services Description Language (WSDL).</span></span> <span data-ttu-id="4f0e8-104">Это значение распространяется по всем клиентам и используется для проверки подлинности службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-104">This value, propagated to any client, is used to authenticate the service.</span></span> <span data-ttu-id="4f0e8-105">После того как клиент инициирует связь с конечной точкой и служба пройдет проверку подлинности на клиенте, клиент сравнивает значение удостоверения конечной точки с действительным значением, возвращенным процессом проверки подлинности конечной точки.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-105">After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.</span></span> <span data-ttu-id="4f0e8-106">Если значения совпадают, значит клиент связался с ожидаемой конечной точкой службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-106">If they match, the client is assured it has contacted the expected service endpoint.</span></span> <span data-ttu-id="4f0e8-107">Это работает как защиту от *фишинг* , предотвращая клиента осуществляется перенаправление в конечную точку, размещенную на вредоносной службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-107">This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.</span></span>  
  
 <span data-ttu-id="4f0e8-108">Образец приложения, демонстрирующий настройку удостоверения, см. в разделе [образец идентификации службы](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="4f0e8-109">Дополнительные сведения о конечных точках и адреса конечных точек см. в разделе [адреса](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-109">For more information about endpoints and endpoint addresses, see [Addresses](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4f0e8-110">При использовании NT LanMan (NTLM) для проверки подлинности удостоверение службы не проверяется, так как в NTLM проверка подлинности сервера клиентом не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-110">When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.</span></span> <span data-ttu-id="4f0e8-111">NTLM используется, когда компьютеры входят в рабочую группу Windows или при работе в старых версиях Windows, не поддерживающих проверку подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-111">NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.</span></span>  
  
 <span data-ttu-id="4f0e8-112">Когда клиент инициирует защищенный канал для отправки сообщения в службу над ней, инфраструктуре Windows Communication Foundation (WCF) проверяет подлинность службы и отправляет сообщение, только если удостоверение службы соответствует удостоверению, указанному в конечной точке адрес, который клиент использует.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-112">When the client initiates a secure channel to send a message to a service over it, the Windows Communication Foundation (WCF) infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.</span></span>  
  
 <span data-ttu-id="4f0e8-113">Обработка удостоверений включает следующие этапы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-113">Identity processing consists of the following stages:</span></span>  
  
- <span data-ttu-id="4f0e8-114">Во время проектирования разработчик клиента определяет удостоверение службы на основе метаданных конечной точки (передаваемых через WSDL).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-114">At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).</span></span>  
  
- <span data-ttu-id="4f0e8-115">Во время выполнения клиентское приложение проверяет утверждения учетных данных безопасности службы, прежде чем пересылать ей какие-либо сообщения.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-115">At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.</span></span>  
  
 <span data-ttu-id="4f0e8-116">Обработка идентификаций на клиенте аналогична проверке подлинности клиента в службе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-116">Identity processing on the client is analogous to client authentication on the service.</span></span> <span data-ttu-id="4f0e8-117">Защищенная служба не выполняет код до тех пор, пока не будет проведена проверка подлинности учетных данных клиента.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-117">A secure service does not execute code until the client's credentials have been authenticated.</span></span> <span data-ttu-id="4f0e8-118">Аналогично, клиент не отправляет сообщения службе до тех пор, пока не будет проведена проверка подлинности учетных данных службы, исходя из заранее известной информации на основе метаданных службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-118">Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.</span></span>  
  
 <span data-ttu-id="4f0e8-119">Свойство <xref:System.ServiceModel.EndpointAddress.Identity%2A> класса <xref:System.ServiceModel.EndpointAddress> представляет удостоверение службы, вызываемой клиентом.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-119">The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client.</span></span> <span data-ttu-id="4f0e8-120">Служба публикует свойство <xref:System.ServiceModel.EndpointAddress.Identity%2A> в своих метаданных.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-120">The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata.</span></span> <span data-ttu-id="4f0e8-121">Когда разработчик клиента запускает [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) для конечной точки службы, созданное удостоверение содержит значение службы <xref:System.ServiceModel.EndpointAddress.Identity%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-121">When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property.</span></span> <span data-ttu-id="4f0e8-122">Инфраструктура WCF (если настроено с безопасностью) проверяет, что служба обрабатывает удостоверение, указанное.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-122">The WCF infrastructure (if configured with security) verifies that the service possesses the identity specified.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="4f0e8-123">Метаданные содержат ожидаемое удостоверение службы, поэтому рекомендуется передавать метаданные службы через защищенные средства, например путем создания конечной точки HTTPS для службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-123">The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.</span></span> <span data-ttu-id="4f0e8-124">Дополнительные сведения см. в разделе [Практическое руководство. Защита конечных точек метаданных](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-124">For more information, see [How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).</span></span>  
  
## <a name="identity-types"></a><span data-ttu-id="4f0e8-125">Типы удостоверений</span><span class="sxs-lookup"><span data-stu-id="4f0e8-125">Identity Types</span></span>  
 <span data-ttu-id="4f0e8-126">Служба может предоставлять шесть типов удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-126">A service can provide six types of identities.</span></span> <span data-ttu-id="4f0e8-127">Каждый тип удостоверения соответствует элементу, который может содержаться в элементе `<identity>` в конфигурации.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-127">Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration.</span></span> <span data-ttu-id="4f0e8-128">Используемый тип зависит от сценария и требований службы к безопасности.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-128">The type used depends on the scenario and the service's security requirements.</span></span> <span data-ttu-id="4f0e8-129">Типы удостоверений описаны в приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-129">The following table describes each identity type.</span></span>  
  
|<span data-ttu-id="4f0e8-130">Тип удостоверения</span><span class="sxs-lookup"><span data-stu-id="4f0e8-130">Identity type</span></span>|<span data-ttu-id="4f0e8-131">Описание</span><span class="sxs-lookup"><span data-stu-id="4f0e8-131">Description</span></span>|<span data-ttu-id="4f0e8-132">Типичный сценарий</span><span class="sxs-lookup"><span data-stu-id="4f0e8-132">Typical scenario</span></span>|  
|-------------------|-----------------|----------------------|  
|<span data-ttu-id="4f0e8-133">Служба доменных имен (DNS)</span><span class="sxs-lookup"><span data-stu-id="4f0e8-133">Domain Name System (DNS)</span></span>|<span data-ttu-id="4f0e8-134">Этот элемент следует использовать с сертификатами X.509 или учетными записями Windows.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-134">Use this element with X.509 certificates or Windows accounts.</span></span> <span data-ttu-id="4f0e8-135">Он сравнивает DNS-имя, указанное в учетных данных, со значением, указанным в этом элементе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-135">It compares the DNS name specified in the credential with the value specified in this element.</span></span>|<span data-ttu-id="4f0e8-136">Проверка DNS позволяет использовать сертификаты с DNS-именами или именами субъектов.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-136">A DNS check enables you to use certificates with DNS or subject names.</span></span> <span data-ttu-id="4f0e8-137">Если сертификат повторно выдан с тем же DNS-именем или именем субъекта, тогда проверка удостоверения по-прежнему действительна.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-137">If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.</span></span> <span data-ttu-id="4f0e8-138">При повторной выдаче сертификата он получает новый ключ RSA, однако при этом сохраняется то же DNS-имя или имя субъекта.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-138">When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.</span></span> <span data-ttu-id="4f0e8-139">Это означает, что клиентам не нужно обновлять в удостоверении информацию о службе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-139">This means that clients do not have to update their identity information about the service.</span></span>|  
|<span data-ttu-id="4f0e8-140">Сертификат.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-140">Certificate.</span></span> <span data-ttu-id="4f0e8-141">Используется по умолчанию, если параметру `ClientCredentialType` присвоено значение "Certificate".</span><span class="sxs-lookup"><span data-stu-id="4f0e8-141">The default when `ClientCredentialType` is set to Certificate.</span></span>|<span data-ttu-id="4f0e8-142">Этот элемент задает значение сертификата X.509 в кодировке Base64 для сравнения с клиентом.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-142">This element specifies a Base64-encoded X.509 certificate value to compare with the client.</span></span><br /><br /> <span data-ttu-id="4f0e8-143">Также этот элемент используется, когда использование CardSpace в качестве учетных данных для проверки подлинности службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-143">Also use this element when using a CardSpace as a credential to authenticate the service.</span></span>|<span data-ttu-id="4f0e8-144">Этот элемент ограничивает проверку подлинности одним сертификатом на основе значения отпечатка.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-144">This element restricts authentication to a single certificate based upon its thumbprint value.</span></span> <span data-ttu-id="4f0e8-145">Это обеспечивает более строгую проверку подлинности, поскольку значения отпечатков уникальны.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-145">This enables stricter authentication because thumbprint values are unique.</span></span> <span data-ttu-id="4f0e8-146">Эта проблема исходит за одним исключением: Если сертификат повторно выдан с тем же именем субъекта, также имеет новый отпечаток.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-146">This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.</span></span> <span data-ttu-id="4f0e8-147">Следовательно, клиенты могут проверить службу только в том случае, когда известен новый отпечаток.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-147">Therefore, clients are not able to validate the service unless the new thumbprint is known.</span></span> <span data-ttu-id="4f0e8-148">Дополнительные сведения о поиске отпечатка сертификата, см. в разделе [как: Извлечение отпечатка сертификата](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-148">For more information about finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md).</span></span>|  
|<span data-ttu-id="4f0e8-149">Ссылка на сертификат</span><span class="sxs-lookup"><span data-stu-id="4f0e8-149">Certificate Reference</span></span>|<span data-ttu-id="4f0e8-150">Идентичен описанному выше типу "Сертификат".</span><span class="sxs-lookup"><span data-stu-id="4f0e8-150">Identical to the Certificate option described previously.</span></span> <span data-ttu-id="4f0e8-151">Однако этот элемент позволяет задавать имя сертификата и сохранять расположение, из которого нужно получать сертификат.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-151">However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.</span></span>|<span data-ttu-id="4f0e8-152">Аналогичен описанному выше сценарию для типа "Сертификат".</span><span class="sxs-lookup"><span data-stu-id="4f0e8-152">Same as the Certificate scenario described previously.</span></span><br /><br /> <span data-ttu-id="4f0e8-153">Преимущество в том, что есть возможность изменить расположение хранилища сертификатов.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-153">The benefit is that the certificate store location can change.</span></span>|  
|<span data-ttu-id="4f0e8-154">RSA</span><span class="sxs-lookup"><span data-stu-id="4f0e8-154">RSA</span></span>|<span data-ttu-id="4f0e8-155">Этот элемент задает значение ключа RSA для сравнения с клиентом.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-155">This element specifies an RSA key value to compare with the client.</span></span> <span data-ttu-id="4f0e8-156">Он аналогичен типу "Сертификат", однако вместо использования отпечатка сертификата используется ключ RSA сертификата.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-156">This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.</span></span>|<span data-ttu-id="4f0e8-157">Проверка RSA позволяет ограничить проверку подлинности одним сертификатом с использованием его ключа RSA.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-157">An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.</span></span> <span data-ttu-id="4f0e8-158">Это позволяет выполнять более строгую проверку подлинности определенного ключа RSA, однако если значение ключа RSA будет изменено, служба больше не будет работать с существующими клиентами.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-158">This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.</span></span>|  
|<span data-ttu-id="4f0e8-159">Имя участника-пользователя.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-159">User principal name (UPN).</span></span> <span data-ttu-id="4f0e8-160">Используется по умолчанию, если параметру `ClientCredentialType` присвоено значение "Windows" и процесс службы выполняется не под одной из системных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-160">The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.</span></span>|<span data-ttu-id="4f0e8-161">Этот элемент задает имя участника-пользователя, под которым выполняется служба.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-161">This element specifies the UPN that the service is running under.</span></span> <span data-ttu-id="4f0e8-162">См. в разделе протокол Kerberos и удостоверение [переопределение идентификатора службы для проверки подлинности](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-162">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="4f0e8-163">Это обеспечивает выполнение службы под определенной учетной записью пользователя Windows.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-163">This ensures that the service is running under a specific Windows user account.</span></span> <span data-ttu-id="4f0e8-164">В качестве учетной записи может использоваться либо учетная запись текущего пользователя, либо служба, запущенная под учетной записью определенного пользователя.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-164">The user account can be either the current logged-on user or the service running under a particular user account.</span></span><br /><br /> <span data-ttu-id="4f0e8-165">Для этого параметра используется безопасность Windows Kerberos, если служба выполняется под учетной записью домена в среде Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-165">This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.</span></span>|  
|<span data-ttu-id="4f0e8-166">Имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-166">Service principal name (SPN).</span></span> <span data-ttu-id="4f0e8-167">Используется по умолчанию, если параметру `ClientCredentialType` присвоено значение "Windows" и процесс службы выполняется под одной из системных учетных записей: LocalService, LocalSystem или NetworkService.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-167">The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accounts—LocalService, LocalSystem, or NetworkService.</span></span>|<span data-ttu-id="4f0e8-168">Этот элемент задает имя участника-службы, связанное с учетной записью службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-168">This element specifies the SPN associated with the service's account.</span></span> <span data-ttu-id="4f0e8-169">См. в разделе протокол Kerberos и удостоверение [переопределение идентификатора службы для проверки подлинности](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-169">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="4f0e8-170">Это обеспечивает идентификацию службы с помощью имени участника-службы и определенной учетной записи Windows, связанной с этим именем.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-170">This ensures that the SPN and the specific Windows account associated with the SPN identify the service.</span></span><br /><br /> <span data-ttu-id="4f0e8-171">Для связывания учетной записи компьютера для учетной записи пользователя службы можно воспользоваться средством Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-171">You can use the Setspn.exe tool to associate a machine account for the service's user account.</span></span><br /><br /> <span data-ttu-id="4f0e8-172">Этот параметр использует безопасность Windows Kerberos, если служба выполняется под одной из системных учетных записей или под учетной записью домена, с которой связано имя участника-службы, при условии что компьютер входит в домен в среде Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-172">This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.</span></span>|  
  
## <a name="specifying-identity-at-the-service"></a><span data-ttu-id="4f0e8-173">Задание удостоверения в службе</span><span class="sxs-lookup"><span data-stu-id="4f0e8-173">Specifying Identity at the Service</span></span>  
 <span data-ttu-id="4f0e8-174">Как правило, нет необходимости задавать удостоверение в службе, поскольку выбор типа учетных данных клиента определяет тип удостоверения, предоставляемого в метаданных службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-174">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="4f0e8-175">Дополнительные сведения о том, как переопределить или указать удостоверение службы, см. в разделе [переопределение идентификатора службы для проверки подлинности](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-175">For more information about how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>  
  
## <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="4f0e8-176">С помощью \<удостоверений > элемент в конфигурации</span><span class="sxs-lookup"><span data-stu-id="4f0e8-176">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="4f0e8-177">Если изменить тип учетных данных клиента в привязке, ранее показанной сертификату `Certificate,` созданный WSDL будет содержать сериализованный сертификат X.509 в кодировке Base64, соответствующий значению удостоверения, как показано в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-177">If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="4f0e8-178">Используется по умолчанию для всех типов учетных данных клиентов, за исключением Windows.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-178">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="4f0e8-179">Можно изменить значение по умолчанию удостоверения службы или измените тип удостоверения с помощью `<identity>` в конфигурации или задав удостоверение в коде.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-179">You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="4f0e8-180">В следующем коде конфигурации задается идентификатор DNS со значением `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-180">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

## <a name="setting-identity-programmatically"></a><span data-ttu-id="4f0e8-181">Задание удостоверения программным способом</span><span class="sxs-lookup"><span data-stu-id="4f0e8-181">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="4f0e8-182">Службе не требуется явно задавать удостоверение, поскольку WCF определяет его автоматически.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-182">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="4f0e8-183">Тем не менее WCF позволяет указать удостоверение для конечной точки, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-183">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="4f0e8-184">В приведенном ниже примере кода добавляется новая конечная точка службы с определенным идентификатором DNS.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-184">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="specifying-identity-at-the-client"></a><span data-ttu-id="4f0e8-185">Назначение удостоверения в клиенте</span><span class="sxs-lookup"><span data-stu-id="4f0e8-185">Specifying Identity at the Client</span></span>  
 <span data-ttu-id="4f0e8-186">Во время разработки разработчик клиента обычно использует [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) для создания конфигурации клиента.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-186">At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration.</span></span> <span data-ttu-id="4f0e8-187">Созданный файл конфигурации (предназначенный для использования клиентом) содержит удостоверение сервера.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-187">The generated configuration file (intended for use by the client) contains the server's identity.</span></span> <span data-ttu-id="4f0e8-188">Например, приведенный ниже код создан на основе службы, в которой задан идентификатор DNS, как показано в предыдущем примере.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-188">For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.</span></span> <span data-ttu-id="4f0e8-189">Обратите внимание, что значение удостоверения конечной точки клиента совпадает с соответствующим значением службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-189">Note that the client's endpoint identity value matches that of the service.</span></span> <span data-ttu-id="4f0e8-190">В этом случае, когда клиент получает учетные данные Windows (Kerberos) для службы, он ожидает значение `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-190">In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.</span></span>  

 <span data-ttu-id="4f0e8-191">Если вместо Windows сертификат в службе задан в качестве клиентского типа учетных данных, тогда ожидается, что свойство DNS будет иметь значение `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-191">If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`.</span></span> <span data-ttu-id="4f0e8-192">(Если же свойство DNS имеет значение `null`, имя субъекта сертификата должно иметь значение `contoso.com`.)</span><span class="sxs-lookup"><span data-stu-id="4f0e8-192">(Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)</span></span>  
  
#### <a name="using-a-specific-value-for-identity"></a><span data-ttu-id="4f0e8-193">Использование определенного значения для удостоверения</span><span class="sxs-lookup"><span data-stu-id="4f0e8-193">Using a Specific Value for Identity</span></span>  
 <span data-ttu-id="4f0e8-194">В приведенном ниже файле конфигурации клиента показано, каким образом в качестве удостоверения службы может ожидаться использование определенного значения.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-194">The following client configuration file shows how the service's identity is expected to be a specific value.</span></span> <span data-ttu-id="4f0e8-195">В приведенном ниже примере клиент может связываться с двумя конечными точками.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-195">In the following example, the client can communicate with two endpoints.</span></span> <span data-ttu-id="4f0e8-196">Первая конечная точка определяется отпечатком сертификата, а вторая – ключом RSA сертификата.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-196">The first is identified with a certificate thumbprint and the second with a certificate RSA key.</span></span> <span data-ttu-id="4f0e8-197">Другими словами, сертификатом, содержащим только пару открытого и закрытого ключей, который не был издан доверенным центром.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-197">That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.</span></span>  

## <a name="identity-checking-at-run-time"></a><span data-ttu-id="4f0e8-198">Проверка удостоверения во время выполнения</span><span class="sxs-lookup"><span data-stu-id="4f0e8-198">Identity Checking at Run Time</span></span>  
 <span data-ttu-id="4f0e8-199">Во время проектирования разработчик клиента определяет удостоверение сервера с помощью его метаданных.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-199">At design time, a client developer determines the server's identity through its metadata.</span></span> <span data-ttu-id="4f0e8-200">Во время выполнения проверка удостоверения выполняется перед вызовом конечных точек в службе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-200">At runtime, the identity check is performed before calling any endpoints on the service.</span></span>  
  
 <span data-ttu-id="4f0e8-201">Значение удостоверения привязано к типу проверки подлинности, указанному в метаданных; другими словами, к типу учетных данных, используемому в службе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-201">The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.</span></span>  
  
 <span data-ttu-id="4f0e8-202">Если в канале настроена проверка подлинности с использованием протокола SSL на уровне сообщений или транспортном уровне с сертификатами X.509, действительны следующие значения удостоверения.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-202">If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="4f0e8-203">DNS.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-203">DNS.</span></span> <span data-ttu-id="4f0e8-204">WCF гарантирует, что сертификат, предоставленный во время подтверждения SSL содержит DNS или `CommonName` атрибут (CN), равным значению, заданному в идентификаторе DNS на клиенте.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-204">WCF ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client.</span></span> <span data-ttu-id="4f0e8-205">Обратите внимание, что эти проверки выполняются в дополнение к определению действительности сертификата сервера.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-205">Note that these checks are done in addition to determining the validity of the server certificate.</span></span> <span data-ttu-id="4f0e8-206">По умолчанию WCF проверяет, что сертификат сервера выдан доверенным корневым центром.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-206">By default, WCF validates that the server certificate is issued by a trusted root authority.</span></span>  
  
- <span data-ttu-id="4f0e8-207">Сертификат.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-207">Certificate.</span></span> <span data-ttu-id="4f0e8-208">Во время подтверждения SSL WCF гарантирует, что Удаленная конечная точка предоставляет значение именно тот сертификат, заданному в идентификаторе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-208">During the SSL handshake, WCF ensures that the remote endpoint provides the exact certificate value specified in the identity.</span></span>  
  
- <span data-ttu-id="4f0e8-209">Ссылка на сертификат.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-209">Certificate Reference.</span></span> <span data-ttu-id="4f0e8-210">Аналогичен значению "Сертификат".</span><span class="sxs-lookup"><span data-stu-id="4f0e8-210">Same as Certificate.</span></span>  
  
- <span data-ttu-id="4f0e8-211">RSA.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-211">RSA.</span></span> <span data-ttu-id="4f0e8-212">Во время подтверждения SSL WCF гарантирует, что Удаленная конечная точка предоставляет точный ключ RSA, заданному в идентификаторе.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-212">During the SSL handshake, WCF ensures that the remote endpoint provides the exact RSA key specified in the identity.</span></span>  
  
 <span data-ttu-id="4f0e8-213">Если служба выполняет проверку подлинности с использованием протокола SSL на уровне сообщений или транспортном уровне с учетными данными Windows и согласует учетные данные, следующие значения удостоверения являются действительными.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-213">If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="4f0e8-214">DNS.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-214">DNS.</span></span> <span data-ttu-id="4f0e8-215">Согласование проходит имя участника-службы, так что DNS-имя может быть проверено.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-215">The negotiation passes the service's SPN so that the DNS name can be checked.</span></span> <span data-ttu-id="4f0e8-216">Имя участника-службы указывается в формате `host/<dns name>`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-216">The SPN is in the form `host/<dns name>`.</span></span>  
  
- <span data-ttu-id="4f0e8-217">Имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-217">SPN.</span></span> <span data-ttu-id="4f0e8-218">Возвращается явное имя участника-службы, например `host/myservice`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-218">An explicit service SPN is returned, for example, `host/myservice`.</span></span>  
  
- <span data-ttu-id="4f0e8-219">Имя участника-пользователя.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-219">UPN.</span></span> <span data-ttu-id="4f0e8-220">Имя участника-пользователя учетной записи службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-220">The UPN of the service account.</span></span> <span data-ttu-id="4f0e8-221">Имя участника-пользователя указывается в формате `username` @ `domain`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-221">The UPN is in the form `username`@`domain`.</span></span> <span data-ttu-id="4f0e8-222">Например, при выполнении службы под учетной записью пользователя может использоваться такое имя участника-пользователя, как `username@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-222">For example, when the service is running in a user account, it may be `username@contoso.com`.</span></span>  
  
 <span data-ttu-id="4f0e8-223">Назначать удостоверение программным путем (с использованием свойства <xref:System.ServiceModel.EndpointAddress.Identity%2A>) не обязательно.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-223">Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional.</span></span> <span data-ttu-id="4f0e8-224">Если удостоверение не задано и используется тип учетных данных клиента Windows, по умолчанию имени участника-службы назначается значение, соответствующее имени узла в адресе конечной точки службы с префиксом "host/".</span><span class="sxs-lookup"><span data-stu-id="4f0e8-224">If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the "host/" literal.</span></span> <span data-ttu-id="4f0e8-225">Если удостоверение задано и в качестве типа учетных данных клиента применяется сертификат, по умолчанию используется значение `Certificate`.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-225">If no identity is specified, and the client credential type is a certificate, the default is `Certificate`.</span></span> <span data-ttu-id="4f0e8-226">Это относится к безопасности как на уровне сообщений, так и на транспортном уровне.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-226">This applies to both message- and transport-level security.</span></span>  
  
## <a name="identity-and-custom-bindings"></a><span data-ttu-id="4f0e8-227">Удостоверение и пользовательские привязки</span><span class="sxs-lookup"><span data-stu-id="4f0e8-227">Identity and Custom Bindings</span></span>  
 <span data-ttu-id="4f0e8-228">Поскольку удостоверение службы зависит от используемого типа привязки, при создании пользовательской привязки убедитесь, что передается требуемое удостоверение.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-228">Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.</span></span> <span data-ttu-id="4f0e8-229">Например, в приведенном ниже примере кода передаваемое удостоверение несовместимо с типом безопасности, поскольку удостоверение для привязки начальной загрузки защищенного диалога не соответствует удостоверению для привязки на конечной точке.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-229">For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.</span></span> <span data-ttu-id="4f0e8-230">Привязка защищенного диалога назначает идентификатор DNS, тогда как <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> назначает удостоверение имени участника-пользователя или участника-службы.</span><span class="sxs-lookup"><span data-stu-id="4f0e8-230">The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.</span></span>  
  
 [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]
 [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  
  
 <span data-ttu-id="4f0e8-231">Дополнительные сведения о том, как стека привязки элементов правильно для пользовательской привязки, см. в разделе [параметрах привязок](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-231">For more information about how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md).</span></span> <span data-ttu-id="4f0e8-232">Дополнительные сведения о создании пользовательской привязки с <xref:System.ServiceModel.Channels.SecurityBindingElement>, см. в разделе [как: Создание SecurityBindingElement для заданного режима проверки подлинности](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span><span class="sxs-lookup"><span data-stu-id="4f0e8-232">For more information about creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4f0e8-233">См. также</span><span class="sxs-lookup"><span data-stu-id="4f0e8-233">See also</span></span>

- [<span data-ttu-id="4f0e8-234">Практическое руководство. Создание пользовательской привязки с использованием элемента SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="4f0e8-234">How to: Create a Custom Binding Using the SecurityBindingElement</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)
- [<span data-ttu-id="4f0e8-235">Практическое руководство. Создание SecurityBindingElement для заданного режима проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="4f0e8-235">How to: Create a SecurityBindingElement for a Specified Authentication Mode</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)
- [<span data-ttu-id="4f0e8-236">Практическое руководство. Создание средства проверки идентификации настраиваемого клиента</span><span class="sxs-lookup"><span data-stu-id="4f0e8-236">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="4f0e8-237">Выбор типа учетных данных</span><span class="sxs-lookup"><span data-stu-id="4f0e8-237">Selecting a Credential Type</span></span>](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)
- [<span data-ttu-id="4f0e8-238">Работа с сертификатами</span><span class="sxs-lookup"><span data-stu-id="4f0e8-238">Working with Certificates</span></span>](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)
- [<span data-ttu-id="4f0e8-239">Служебная программа для метаданных ServiceModel (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="4f0e8-239">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)
- [<span data-ttu-id="4f0e8-240">Создание пользовательских привязок</span><span class="sxs-lookup"><span data-stu-id="4f0e8-240">Creating User-Defined Bindings</span></span>](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)
- [<span data-ttu-id="4f0e8-241">Практическое руководство. Извлечение отпечатка сертификата</span><span class="sxs-lookup"><span data-stu-id="4f0e8-241">How to: Retrieve the Thumbprint of a Certificate</span></span>](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)
