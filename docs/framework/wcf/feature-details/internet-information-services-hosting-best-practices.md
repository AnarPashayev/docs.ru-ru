---
title: Рекомендации по размещению в службах IIS
ms.date: 03/30/2017
ms.assetid: 0834768e-9665-46bf-86eb-d4b09ab91af5
ms.openlocfilehash: 3be9d4c81f891ad898099ba9041a09b16388b7e4
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184719"
---
# <a name="internet-information-services-hosting-best-practices"></a>Рекомендации по размещению в службах IIS
В этой теме излагаются некоторые рекомендации по хостингу услуг Windows Communication Foundation (WCF).  
  
## <a name="implementing-wcf-services-as-dlls"></a>Реализация служб WCF в виде библиотек DLL  
 Внедрение службы WCF в качестве DLL, развернутой в каталоге веб-приложений, позволяет повторно использовать службу за пределами модели Web-приложений, например, в тестовой среде, в которой могут не быть развернуты информационные службы Интернета (IIS).  
  
## <a name="service-hosts-in-iis-hosted-applications"></a>Ведущие приложения служб в приложениях, размещенных в IIS  
 Не используйте императивные AI-хостинга для создания новых узлов служб, которые слушают на сетевых переносах, не поддерживаемых средой хостинга IIS (например, IIS 6.0 для размещения услуг TCP, потому что связь TCP не поддерживается на IIS 6.0). Такой подход не рекомендуется. Ведущие приложения служб, созданные принудительно, в среде размещения IIS неизвестны. Ключевым пунктом является то, что обработка, выполненная принудительно созданными службами, не принимается во внимание системой IIS, когда она определяет, простаивает ли пул ведущих приложений. В результате приложения, где есть такие принудительно созданные ведущие приложения служб, имеют среду размещения IIS, которая агрессивно удаляет ведущие процессы IIS.  
  
## <a name="uris-and-iis-hosted-endpoints"></a>Универсальные коды ресурсов (URI) и размещенные в IIS конечные точки  
 Конечные точки для службы, размещенной в IIS, должны быть настроены с использованием относительных универсальных кодов ресурсов (URI), а не абсолютных адресов. При этом гарантируется попадание адреса конечной точки в ряд адресов URI, принадлежащих ведущему приложению, и обеспечивается надлежащая активация на основе сообщений.  
  
## <a name="state-management-and-process-recycling"></a>Управление состоянием и перезапуск процессов  
 Среда размещения IIS оптимизирована для служб, не поддерживающих локальное состояние в памяти. При появлении множества внешних и внутренних событий система IIS перезапускает ведущий процесс, в результате чего любое непостоянное состояние, сохраненное только в памяти, теряется. Службы, размещенные в IIS, должны сохранять свое состояние во внешней по отношению к процессу среде (например, в базе данных) или в расположенном в памяти кэше, который в случае перезапуска приложения может быть легко восстановлен.  
  
> [!NOTE]
> Протоколы, которые WCF использует для надежности и безопасности с точки зрения сообщений, используют неустойчивое состояние в памяти. Надежные сеансы WCF и сеансы безопасности могут быть неожиданно прекращены из-за рециркуляции приложений. Приложения, размещенные на IIS, которые используют эти протоколы, должны либо зависеть от чего-то иного, чем предоставленный WCF ключ сессии для сопоставления состояния уровня приложения (например, построение стежка приложения или пользовательский заголовок корреляции), либо отключить Процесс переработки IIS для размещенного приложения.  
  
## <a name="optimizing-performance-in-middle-tier-scenarios"></a>Оптимизация производительности в сценариях среднего уровня  
 Для оптимальной производительности в *сценарии среднего уровня*— службы, которая вызывает вызовы в другие службы в ответ на входящие сообщения — мгновенное воспроизведение клиента службы WCF в службу удаленного обслуживания один раз и повторное его использование в нескольких входящих запросах. Мгновенное выполнение услуг WCF — это дорогостоящая операция, связанная с вызовом службы на уже существующем экземпляре клиента, а сценарии среднего уровня дают отчетливые преимущества в производительности путем кэширования удаленных клиентов по запросам. Клиенты wCF защищены от потоков, поэтому нет необходимости синхронизировать доступ к клиенту по нескольким потокам.  
  
 Увеличение производительности в сценариях среднего уровня обеспечивается также благодаря использованию асинхронных интерфейсов API, создаваемых параметром `svcutil /a`. Эта `/a` опция заставляет [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) генерировать `BeginXXX/EndXXX` методы для каждой операции службы, что позволяет совершать потенциально длительные вызовы удаленным службам на фоновых потоках.  
  
## <a name="wcf-in-multi-homed-or-multi-named-scenarios"></a>WCF в многосетевых сценариях и сценариях со многими именами  
 Вы можете развернуть службы WCF внутри веб-фермы IIS, где набор `http://www.contoso.com`компьютеров имеет общее внешнее имя (например), но индивидуально адресованы разными именами хоста (например, `http://www.contoso.com` может направлять трафик на две разные машины, названные `http://machine1.internal.contoso.com` и `http://machine2.internal.contoso.com`). Этот сценарий развертывания полностью поддерживается WCF, но требует специальной конфигурации веб-сайта IIS, совещающей службы WCF, для отображения правильного (внешнего) хоста в метаданных службы (Язык описания веб-служб).  
  
 Чтобы убедиться, что правильное хостативное имя отображается в метаданных службы, генерируемого WCF, настройте итог по умолчанию для веб-узла IIS, на котором размещается службы WCF для использования явного хост-моста. Например, компьютеры, расположенные `www.contoso.com` внутри фермы, должны использовать привязку сайта IIS от no:80:www.contoso.com для HTTP и \*:443:www.contoso.com для HTTPS.  
  
 Привязки веб-узла IIS можно настроить с помощью оснастки консоли управления (MMC) IIS.  
  
## <a name="application-pools-running-in-different-user-contexts-overwrite-assemblies-from-other-accounts-in-the-temporary-folder"></a>Пулы приложений, работающие в разных контекстах пользователей, которые перезаписывают сборки из других учетных записей во временной папке  
 Для обеспечения того, чтобы пулы приложений, работающие в разных контекстах пользователя, не могли перезаписывать сборки из других учетных записей во папке временных ASP.NET файлов, используйте различные идентификаторы и временные папки для разных приложений. Например, если имеется два виртуальных приложения /Application1 и / Application2, можно создать два пула приложений (A и B) с двумя разными идентификаторами. Пул приложений A может работать под одним идентификатором пользователя (user1), а пул приложений B - под другим идентификатором пользователя (user2). Настройте приложение /Application1 на использование пула A, а приложение /Application2 - на использование пула B.  
  
 В Web.config можно настроить временную папку с помощью \< system.web/compilation/@tempFolder>. Для /Application1, это может быть "c:'tempForUser1", а для application2 это может быть "c:'tempForUser2". Предоставьте соответствующее разрешение на запись в эти папки для двух идентификаторов.  
  
 В этом случае пользователь user2 не может изменить папку создания кода для приложения /application2 (в папке c:\tempForUser1).  
  
## <a name="enabling-asynchronous-processing"></a>Включение асинхронной обработки  
 По умолчанию сообщения, отправленные на службу WCF, размещенные под IIS 6.0 и ранее обрабатываемые синхронным образом. ASP.NET вызовы в WCF на своем потоке (ASP.NET поток рабочего) и WCF использует другой поток для обработки запроса. WCF удерживает рабочий поток ASP.NET до завершения обработки. В результате обработка запросов выполняется синхронно. Обработка запросов асинхронно обеспечивает большую масштабируемость, поскольку уменьшает количество потоков, необходимых для обработки запроса , WCF не удерживает ASP.NET поток при обработке запроса. Использование асинхронного поведения не рекомендуется для машин с IIS 6.0, потому что нет никакого способа задушить входящие запросы, которые открывают сервер для атак *Denial Of Service* (DOS). Начиная с версии IIS 7.0, реализовано регулирование параллельных запросов: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`. Новая система регулирования гарантирует безопасность использования асинхронной обработки.  По умолчанию в IIS 7.0 регистрируются асинхронные обработчик и модуль. Если эта функция выключена, то можно вручную включить асинхронную обработку запросов в файле Web.config приложения. Используемые параметры зависят от параметра `aspNetCompatibilityEnabled`. Если параметр `aspNetCompatibilityEnabled` установлен в значение `false`, настройте модуль `System.ServiceModel.Activation.ServiceHttpModule`, как показано в следующем фрагменте конфигурации.  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="false" />
  </system.serviceModel>  
  <system.webServer>  
    <modules>  
      <remove name="ServiceModel"/>  
      <add name="ServiceModel"
           preCondition="integratedMode,runtimeVersionv2.0"
           type="System.ServiceModel.Activation.ServiceHttpModule, System.ServiceModel,Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>  
    </modules>  
    </system.webServer>  
```  
  
 Если параметр `aspNetCompatibilityEnabled` установлен в значение `true`, настройте модуль `System.ServiceModel.Activation.ServiceHttpHandlerFactory`, как показано в следующем фрагменте конфигурации.  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />
  </system.serviceModel>  
  <system.webServer>  
    <handlers>  
          <clear/>  
          <add name="TestAsyncHttpHandler"
               path="*.svc"
               verb="*"
               type="System.ServiceModel.Activation.ServiceHttpHandlerFactory, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
               />  
    </handlers>
  </system.webServer>  
```  
  
## <a name="see-also"></a>См. также раздел

- [Примеры размещения служб](../samples/hosting.md)
- [Функции размещения Windows Server App Fabric](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))
