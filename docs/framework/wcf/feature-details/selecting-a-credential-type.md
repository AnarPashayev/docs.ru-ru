---
title: Выбор типа учетных данных
description: Узнайте об учетных данных, способах их использования в WCF и о том, как выбрать правильные учетные данные для приложения, чтобы установить затребованное удостоверение или возможности.
ms.date: 03/30/2017
ms.assetid: bf707063-3f30-4304-ab53-0e63413728a8
ms.openlocfilehash: c5a47bf95ab8e22cda1beb7eeca7cb77bfc2a169
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96253977"
---
# <a name="selecting-a-credential-type"></a>Выбор типа учетных данных

*Учетные данные* — это Windows Communication Foundation данных (WCF), которые используются для установления затребованного удостоверения или возможностей. Например, паспорт - это документ, выданный властями, в котором содержатся учетные данные, подтверждающие гражданство страны или региона. В WCF учетные данные могут принимать множество форм, таких как маркеры имени пользователя и сертификаты X. 509. В этом разделе обсуждаются учетные данные, способы их использования в WCF и выбор правильных учетных данных для приложения.  
  
 Во многих странах и регионах примером учетных данных могут служить водительские права. Водительские права содержат данные о личности и возможностях их обладателя. Они содержат доказательство владения в виде фотографии владельца. Водительские права выданы доверенной организацией (центром авторизации), обычно государственным органом. Водительские права ламинированы и могут содержать голограмму, подтверждающую, что права не изменены или подделаны.  
  
 При предоставлении учетных данных требуется предоставить как сами данные, так и доказательство обладания ими. WCF поддерживает различные типы учетных данных на уровнях безопасности транспорта и сообщений. Например, рассмотрим два типа учетных данных, поддерживаемых в WCF: имя пользователя и учетные данные сертификата (X. 509).  
  
 При использовании в качестве учетных данных имени пользователя само имя пользователя представляет заявленную идентификацию, а пароль является доказательством прав обладания. Центром авторизации в данном случае является система, проверяющая имя пользователя и пароль.  
  
 Используя учетные данные сертификата X. 509, имя субъекта, альтернативное имя субъекта или конкретные поля в сертификате можно использовать в качестве утверждений удостоверения, а другие поля, такие как `Valid From` `Valid To` поля и, указывают на допустимость сертификата.  
  
## <a name="transport-credential-types"></a>Типы учетных данных транспорта  

 В приведенной ниже таблице перечислены типы учетных данных клиента, которые можно использовать в режиме безопасности транспорта. При создании службы свойству `ClientCredentialType` задается одно из этих значений, указывающих тип учетных данных, которые должен предоставить клиент для связи с этой службой. Типы можно задавать как в коде, так и в файлах конфигурации.  
  
|Параметр|Описание|  
|-------------|-----------------|  
|None|Указывает, что клиенту не требуется предоставлять учетные данные. Это означает, что клиент является анонимным.|  
|Основные|Задает для клиента обычную проверку подлинности. Дополнительные сведения см. в разделе RFC2617 —[Проверка подлинности HTTP: базовая и дайджест-проверка подлинности](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).|  
|Digest (дайджест)|Задает для клиента дайджест-проверку подлинности. Дополнительные сведения см. в разделе RFC2617 —[Проверка подлинности HTTP: базовая и дайджест-проверка подлинности](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).|  
|Ntlm|Задает проверку подлинности NTLM (NT LAN Manager). Этот параметр используется, если по какой-то причине нельзя использовать проверку подлинности Kerberos. Вы также можете отключить его использование в качестве резервного, задав <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> для свойства значение `false` , которое заставляет WCF создавать исключение, если используется NTLM. Обратите внимание, что установка для данного свойства значения `false` не предотвращает отправки учетных данных NTLM по сети.|  
|Windows|Задает проверку подлинности Windows. Чтобы установить в домене Windows режим использования только протокола Kerberos, задайте свойству <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> значение `false` (по умолчанию `true`).|  
|Сертификат|Выполняет проверку подлинности клиента с использованием сертификата X.509.|  
|Пароль|Пользователь должен ввести имя пользователя и пароль. Контроль пары «имя пользователя и пароль» с помощью проверки подлинности Windows или другого пользовательского решения.|  
  
### <a name="message-client-credential-types"></a>Типы учетных данных клиента при использовании безопасности сообщений  

 В следующей таблице приведены типы учетных данных, которые могут использоваться при создании приложения, использующего безопасность сообщений. Эти значения можно использовать как в коде, так и в файлах конфигурации.  
  
|Параметр|Описание|  
|-------------|-----------------|  
|None|Указывает, что клиенту не требуется предоставлять учетные данные. Это означает, что клиент является анонимным.|  
|Windows|Позволяет проводить обмен сообщениями SOAP в рамках контекста безопасности, созданного с использованием учетных данных Windows.|  
|Имя пользователя|Позволяет службе запрашивать проверку подлинности клиента на основе учетных данных типа «имя пользователя». Обратите внимание, что в WCF не допускаются криптографические операции с именами пользователей, например создание подписи или шифрование данных. WCF обеспечивает защиту транспорта при использовании учетных данных имени пользователя.|  
|Сертификат|Позволяет службе запрашивать проверку подлинности клиента с помощью сертификата X.509.|  
|Issued Token|Пользовательский тип маркера, настроенный в соответствии с политикой безопасности. Тип маркера по умолчанию - маркер языка SAML (Security Assertions Markup Language). Маркер выдается службой маркеров безопасности. Дополнительные сведения см. в разделе [Федерация и выданные токены](federation-and-issued-tokens.md).|  
  
### <a name="negotiation-model-of-service-credentials"></a>Модель согласования учетных данных служб  

 *Согласование* — это процесс установки отношений доверия между клиентом и службой путем обмена учетными данными. Этот процесс выполняется между клиентом и службой последовательно, чтобы раскрывать только те сведения, которые нужны для следующего этапа процесса согласования. Обычно в результате согласования клиент получает учетные данные службы, которые используются при последующих операциях.  
  
 За одним исключением по умолчанию предоставляемые системой привязки в WCF автоматически согласовывают учетные данные службы при использовании безопасности на уровне сообщений. (Исключением является <xref:System.ServiceModel.BasicHttpBinding> , которое по умолчанию не включает безопасность.) Чтобы отключить это поведение, см <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> . раздел <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> Свойства и.  
  
> [!NOTE]
> При использовании безопасности SSL с .NET Framework 3,5 и более поздних версий клиент WCF использует как промежуточные сертификаты в хранилище сертификатов, так и промежуточные сертификаты, полученные во время согласования SSL для выполнения проверки цепочки сертификатов в сертификате службы. Платформа .NET Framework 3.0 использует только промежуточные сертификаты, установленные в локальном хранилище сертификатов.  
  
#### <a name="out-of-band-negotiation"></a>Внешнее согласование  

 Если автоматическое согласование отключено, перед отправкой любых сообщений службе клиент должен предоставить учетные данные службы. Это также называется *внештатной* инициализацией. Например, если в качестве типа учетных данных указан сертификат, а автоматическое согласование отключено, клиент должен связаться с владельцем службы, чтобы получить и установить сертификат на том компьютере, на котором выполняется клиентское приложение. Это можно сделать, например, если нужно строго контролировать доступ клиентов к службе, обеспечивающей взаимодействие предприятий. Это нестандартное согласование можно выполнить по электронной почте, а сертификат X. 509 хранится в хранилище сертификатов Windows с помощью такого средства, как оснастка "сертификаты" консоли управления (MMC).  
  
> [!NOTE]
> Сертификат, полученный с использованием процедуры внешнего согласования, передается службе с помощью свойства <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>. Это необходимо при использовании класса <xref:System.ServiceModel.BasicHttpBinding>, поскольку привязка не допускает автоматического согласования. Это свойство также используется в случае некоррелированного дуплексного канала. В этом случае сервер отправляет клиенту сообщение, не ожидая поступления запроса от клиента. Так как сервер не получает запрос от клиента, он должен использовать для шифрования сообщения сертификат клиента.  
  
## <a name="setting-credential-values"></a>Задание значений учетных данных  

 После выбора режима безопасности необходимо задать фактические значения учетных данных. Например, если типом учетных данных клиента является сертификат, необходимо связать со службой или клиентом определенный сертификат (например, определенный сертификат X.509).  
  
 Методы задания значений учетных данных при программировании службы и клиента несколько различаются.  
  
### <a name="setting-service-credentials"></a>Задание учетных данных службы  

 При использовании режима транспорта и HTTP в качестве транспорта нужно использовать службы IIS или настраивать порт с сертификатом. Дополнительные сведения см. в разделе [Общие сведения о безопасности транспорта](transport-security-overview.md) и [Безопасность транспорта HTTP](http-transport-security.md).  
  
 Для указания учетных данных для службы в коде создайте экземпляр класса <xref:System.ServiceModel.ServiceHost> и задайте соответствующие учетные данные с помощью класса <xref:System.ServiceModel.Description.ServiceCredentials>, доступ к которому осуществляется через свойство <xref:System.ServiceModel.ServiceHostBase.Credentials%2A>.  
  
#### <a name="setting-a-certificate"></a>Задание сертификата  

 Чтобы предоставить службе сертификат X.509 для проверки подлинности службы клиентами, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>.  
  
 Чтобы предоставить службе сертификат клиента, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>.  
  
#### <a name="setting-windows-credentials"></a>Задание учетных данных Windows  

 Если клиент указывает действительные имя пользователя и пароль, они используются для проверки подлинности клиента. В противном случае используются учетные данные текущего пользователя.  
  
### <a name="setting-client-credentials"></a>Задание учетных данных клиента  

 В WCF клиентские приложения используют клиент WCF для подключения к службам. Все клиенты наследуются от класса <xref:System.ServiceModel.ClientBase%601>, а свойство <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> клиента позволяет устанавливать различные значения учетных данных клиента.  
  
#### <a name="setting-a-certificate"></a>Задание сертификата  

 Чтобы предоставить службе сертификат X.509 для проверки подлинности клиента службой, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>.  
  
## <a name="how-client-credentials-are-used-to-authenticate-a-client-to-the-service"></a>Использование учетных данных клиента при проверке подлинности клиента службой  

 Учетные данные клиента, необходимые для связи со службой, предоставляются с помощью свойства <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> или <xref:System.ServiceModel.ChannelFactory.Credentials%2A>. Безопасный канал может использовать эту информацию для выполнения службой проверки подлинности клиента. Проверка подлинности выполняется в одном из двух режимов.  
  
- Учетные данные клиента используются один раз перед отправкой первого сообщения, используя экземпляр клиента WCF для установки контекста безопасности. Все сообщения приложения после этого защищены контекстом безопасности.  
  
- Учетные данные используются для проверки подлинности всех сообщений приложения, отправляемых службе. В этом случае контекст между клиентом и службой не устанавливается.  
  
### <a name="established-identities-cannot-be-changed"></a>Невозможность изменения установленных идентификаций  

 При использовании первого метода установленный контекст связывается с идентификацией клиента навсегда. Это значит, что после установки контекста безопасности нельзя изменить идентификацию, связанную с клиентом.  
  
> [!IMPORTANT]
> Есть ситуация, в которой следует учитывать невозможность изменить идентификацию (то есть при поведении по умолчанию, когда включена установка контекста безопасности). При создании службы, которая взаимодействует со второй службой, удостоверение, используемое для открытия клиента WCF во второй службе, изменить нельзя. Это становится проблемой, если несколько клиентов могут использовать первую службу, а служба олицетворяет клиенты при доступе ко второй службе. Если служба использует для всех вызывающих один и тот же клиент, все вызовы ко второй службе происходят под идентификацией первого вызывающего, с помощью которой был открыт клиент для второй службы. Иными словами, служба использует идентификацию первого клиента для связи всех своих клиентов с другой службой. Это может привести к повышению привилегий. Если такое поведение службы нежелательно, нужно отслеживать каждого отдельного вызывающего и создавать для каждого из них новый клиент для второй службы. Следует убедиться, что служба использует для связи каждого вызывающего со второй службой только соответствующий клиент.  
  
 Дополнительные сведения об учетных данных и безопасных сеансах см. в статье [вопросы безопасности для защищенных сеансов](security-considerations-for-secure-sessions.md).  
  
## <a name="see-also"></a>См. также

- <xref:System.ServiceModel.ClientBase%601?displayProperty=nameWithType>
- <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.ClientCredentials.ClientCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.BasicHttpMessageSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.HttpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverMsmq.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverTcp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.TcpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A?displayProperty=nameWithType>
- [Основные понятия безопасности](security-concepts.md)
- [Защита служб и клиентов](securing-services-and-clients.md)
- [Программирование безопасности WCF](programming-wcf-security.md)
- [Безопасность транспорта HTTP](http-transport-security.md)
