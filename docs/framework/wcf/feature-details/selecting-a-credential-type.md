---
title: Выбор типа учетных данных
ms.date: 03/30/2017
ms.assetid: bf707063-3f30-4304-ab53-0e63413728a8
ms.openlocfilehash: 20c070e9351219a649735ac404231cf6f265d814
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64586133"
---
# <a name="selecting-a-credential-type"></a>Выбор типа учетных данных
*Учетные данные* — это данные, Windows Communication Foundation (WCF) использует для подтверждения заявленной идентификации или возможностей. Например, паспорт - это документ, выданный властями, в котором содержатся учетные данные, подтверждающие гражданство страны или региона. В WCF учетные данные могут принимать различные формы, например маркеры имен пользователей и сертификаты X.509. В этом разделе рассматриваются учетные данные, как они используются в WCF и способ выбора правильных учетных данных для вашего приложения.  
  
 Во многих странах и регионах примером учетных данных могут служить водительские права. Водительские права содержат данные о личности и возможностях их обладателя. Они содержат доказательство владения в виде фотографии владельца. Водительские права выданы доверенной организацией (центром авторизации), обычно государственным органом. Водительские права ламинированы и могут содержать голограмму, подтверждающую, что права не изменены или подделаны.  
  
 При предоставлении учетных данных требуется предоставить как сами данные, так и доказательство обладания ими. WCF поддерживает различные типы учетных данных на уровнях безопасности транспорта и сообщений. Например, рассмотрим два типа учетных данных, поддерживаемые в WCF: имя пользователя и сертификат (X.509) учетные данные.  
  
 При использовании в качестве учетных данных имени пользователя само имя пользователя представляет заявленную идентификацию, а пароль является доказательством прав обладания. Центром авторизации в данном случае является система, проверяющая имя пользователя и пароль.  
  
 С помощью учетных данных сертификата X.509 имя субъекта, альтернативное имя субъекта или определенные поля сертификата можно использовать как утверждения, удостоверения, а другие поля, такие как `Valid From` и `Valid To` поля, указывают, действителен ли сертификат.  
  
## <a name="transport-credential-types"></a>Типы учетных данных транспорта  
 В приведенной ниже таблице перечислены типы учетных данных клиента, которые можно использовать в режиме безопасности транспорта. При создании службы свойству `ClientCredentialType` задается одно из этих значений, указывающих тип учетных данных, которые должен предоставить клиент для связи с этой службой. Типы можно задавать как в коде, так и в файлах конфигурации.  
  
|Параметр|Описание|  
|-------------|-----------------|  
|Нет|Указывает, что клиенту не требуется предоставлять учетные данные. Это означает, что клиент является анонимным.|  
|Basic|Задает для клиента обычную проверку подлинности. Дополнительные сведения см. в документе RFC2617 —[проверки подлинности HTTP: обычная и дайджест-проверка подлинности](https://go.microsoft.com/fwlink/?LinkID=88313).|  
|Digest|Задает для клиента дайджест-проверку подлинности. Дополнительные сведения см. в документе RFC2617 —[проверки подлинности HTTP: обычная и дайджест-проверка подлинности](https://go.microsoft.com/fwlink/?LinkID=88313).|  
|Ntlm|Задает проверку подлинности NTLM (NT LAN Manager). Этот параметр используется, если по какой-то причине нельзя использовать проверку подлинности Kerberos. Можно также отключить его использование в качестве запасного варианта, задав <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> свойства `false`, чего WCF сделать усилия для создания исключения, если используется NTLM. Обратите внимание, что установка для данного свойства значения `false` не предотвращает отправки учетных данных NTLM по сети.|  
|Windows|Задает проверку подлинности Windows. Чтобы установить в домене Windows режим использования только протокола Kerberos, задайте свойству <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> значение `false` (по умолчанию `true`).|  
|Сертификат|Выполняет проверку подлинности клиента с использованием сертификата X.509.|  
|Пароль|Пользователь должен ввести имя пользователя и пароль. Контроль пары «имя пользователя и пароль» с помощью проверки подлинности Windows или другого пользовательского решения.|  
  
### <a name="message-client-credential-types"></a>Типы учетных данных клиента при использовании безопасности сообщений  
 В следующей таблице приведены типы учетных данных, которые могут использоваться при создании приложения, использующего безопасность сообщений. Эти значения можно использовать как в коде, так и в файлах конфигурации.  
  
|Параметр|Описание|  
|-------------|-----------------|  
|Нет|Указывает, что клиенту не требуется предоставлять учетные данные. Это означает, что клиент является анонимным.|  
|Windows|Позволяет проводить обмен сообщениями SOAP в рамках контекста безопасности, созданного с использованием учетных данных Windows.|  
|Имя пользователя|Позволяет службе запрашивать проверку подлинности клиента на основе учетных данных типа «имя пользователя». Обратите внимание на то, что WCF не позволяет выполнять криптографические операции с именами пользователей, таких как создание сигнатуры или шифрование данных. WCF обеспечивает безопасность транспорта при использовании учетных данных имени пользователя.|  
|Сертификат|Позволяет службе запрашивать проверку подлинности клиента с помощью сертификата X.509.|  
|Issued Token|Пользовательский тип маркера, настроенный в соответствии с политикой безопасности. Тип маркера по умолчанию - маркер языка SAML (Security Assertions Markup Language). Маркер выдается службой маркеров безопасности. Дополнительные сведения см. в разделе [Федерация и выданные маркеры](../../../../docs/framework/wcf/feature-details/federation-and-issued-tokens.md).|  
  
### <a name="negotiation-model-of-service-credentials"></a>Модель согласования учетных данных служб  
 *Согласование* — это процесс установки отношений доверия между клиентом и службой путем обмена учетные данные. Этот процесс выполняется между клиентом и службой последовательно, чтобы раскрывать только те сведения, которые нужны для следующего этапа процесса согласования. Обычно в результате согласования клиент получает учетные данные службы, которые используются при последующих операциях.  
  
 За одним исключением по умолчанию предоставляемых системой привязок в WCF согласования учетных данных службы автоматически при использовании безопасности уровня сообщений. (Исключением является класс <xref:System.ServiceModel.BasicHttpBinding>, не включающий безопасность по умолчанию.) Для отключения такого поведения см. свойства <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> и <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A>.  
  
> [!NOTE]
>  При использовании безопасности SSL с .NET Framework 3.5 и более поздних версиях клиента WCF использует как промежуточные сертификаты в своем хранилище сертификатов, так и промежуточные сертификаты, полученные в процессе согласования SSL для проверки цепочки сертификатов для службы сертификат. Платформа .NET Framework 3.0 использует только промежуточные сертификаты, установленные в локальном хранилище сертификатов.  
  
#### <a name="out-of-band-negotiation"></a>Внешнее согласование  
 Если автоматическое согласование отключено, перед отправкой любых сообщений службе клиент должен предоставить учетные данные службы. Это также называется *-резервному* подготовки. Например, если в качестве типа учетных данных указан сертификат, а автоматическое согласование отключено, клиент должен связаться с владельцем службы, чтобы получить и установить сертификат на том компьютере, на котором выполняется клиентское приложение. Это можно сделать, например, если нужно строго контролировать доступ клиентов к службе, обеспечивающей взаимодействие предприятий. Этот выход из — внешнее согласование можно сделать в сообщении электронной почты, а сертификат X.509 хранится в хранилище сертификатов Windows, с помощью такого средства, как оснастка консоли управления (MMC) сертификаты.  
  
> [!NOTE]
>  Сертификат, полученный с использованием процедуры внешнего согласования, передается службе с помощью свойства <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>. Это необходимо при использовании класса <xref:System.ServiceModel.BasicHttpBinding>, поскольку привязка не допускает автоматического согласования. Это свойство также используется в случае некоррелированного дуплексного канала. В этом случае сервер отправляет клиенту сообщение, не ожидая поступления запроса от клиента. Так как сервер не получает запрос от клиента, он должен использовать для шифрования сообщения сертификат клиента.  
  
## <a name="setting-credential-values"></a>Задание значений учетных данных  
 После выбора режима безопасности необходимо задать фактические значения учетных данных. Например, если типом учетных данных клиента является сертификат, необходимо связать со службой или клиентом определенный сертификат (например, определенный сертификат X.509).  
  
 Методы задания значений учетных данных при программировании службы и клиента несколько различаются.  
  
### <a name="setting-service-credentials"></a>Задание учетных данных службы  
 При использовании режима транспорта и HTTP в качестве транспорта нужно использовать службы IIS или настраивать порт с сертификатом. Дополнительные сведения см. в разделе [Общие сведения о безопасности транспорта](../../../../docs/framework/wcf/feature-details/transport-security-overview.md) и [безопасности транспорта HTTP](../../../../docs/framework/wcf/feature-details/http-transport-security.md).  
  
 Для указания учетных данных для службы в коде создайте экземпляр класса <xref:System.ServiceModel.ServiceHost> и задайте соответствующие учетные данные с помощью класса <xref:System.ServiceModel.Description.ServiceCredentials>, доступ к которому осуществляется через свойство <xref:System.ServiceModel.ServiceHostBase.Credentials%2A>.  
  
#### <a name="setting-a-certificate"></a>Задание сертификата  
 Чтобы предоставить службе сертификат X.509 для проверки подлинности службы клиентами, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>.  
  
 Чтобы предоставить службе сертификат клиента, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>.  
  
#### <a name="setting-windows-credentials"></a>Задание учетных данных Windows  
 Если клиент указывает действительные имя пользователя и пароль, они используются для проверки подлинности клиента. В противном случае используются учетные данные текущего пользователя.  
  
### <a name="setting-client-credentials"></a>Задание учетных данных клиента  
 В WCF клиентские приложения используют клиента WCF для подключения к службам. Все клиенты наследуются от класса <xref:System.ServiceModel.ClientBase%601>, а свойство <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> клиента позволяет устанавливать различные значения учетных данных клиента.  
  
#### <a name="setting-a-certificate"></a>Задание сертификата  
 Чтобы предоставить службе сертификат X.509 для проверки подлинности клиента службой, используйте метод <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> класса <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>.  
  
## <a name="how-client-credentials-are-used-to-authenticate-a-client-to-the-service"></a>Использование учетных данных клиента при проверке подлинности клиента службой  
 Учетные данные клиента, необходимые для связи со службой, предоставляются с помощью свойства <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> или <xref:System.ServiceModel.ChannelFactory.Credentials%2A>. Безопасный канал может использовать эту информацию для выполнения службой проверки подлинности клиента. Проверка подлинности выполняется в одном из двух режимов.  
  
- Учетные данные клиента используются один раз перед отправкой первого сообщения, используя экземпляр клиента WCF для установления контекста безопасности. Все сообщения приложения после этого защищены контекстом безопасности.  
  
- Учетные данные используются для проверки подлинности всех сообщений приложения, отправляемых службе. В этом случае контекст между клиентом и службой не устанавливается.  
  
### <a name="established-identities-cannot-be-changed"></a>Невозможность изменения установленных идентификаций  
 При использовании первого метода установленный контекст связывается с идентификацией клиента навсегда. Это значит, что после установки контекста безопасности нельзя изменить идентификацию, связанную с клиентом.  
  
> [!IMPORTANT]
>  Есть ситуация, в которой следует учитывать невозможность изменить идентификацию (то есть при поведении по умолчанию, когда включена установка контекста безопасности). Если создать службу, которая взаимодействует с вторую службу, нельзя изменить удостоверение, используемое для открытия клиента WCF для второй службы. Это становится проблемой, если несколько клиентов могут использовать первую службу, а служба олицетворяет клиенты при доступе ко второй службе. Если служба использует для всех вызывающих один и тот же клиент, все вызовы ко второй службе происходят под идентификацией первого вызывающего, с помощью которой был открыт клиент для второй службы. Иными словами, служба использует идентификацию первого клиента для связи всех своих клиентов с другой службой. Это может привести к повышению привилегий. Если такое поведение службы нежелательно, нужно отслеживать каждого отдельного вызывающего и создавать для каждого из них новый клиент для второй службы. Следует убедиться, что служба использует для связи каждого вызывающего со второй службой только соответствующий клиент.  
  
 Дополнительные сведения о учетные данные и безопасные сеансы, см. в разделе [соображения о защите безопасных сеансов](../../../../docs/framework/wcf/feature-details/security-considerations-for-secure-sessions.md).  
  
## <a name="see-also"></a>См. также

- <xref:System.ServiceModel.ClientBase%601?displayProperty=nameWithType>
- <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.ClientCredentials.ClientCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.BasicHttpMessageSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.HttpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverMsmq.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverTcp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.TcpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A?displayProperty=nameWithType>
- [Основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
- [Программирование безопасности WCF](../../../../docs/framework/wcf/feature-details/programming-wcf-security.md)
- [Безопасность транспорта HTTP](../../../../docs/framework/wcf/feature-details/http-transport-security.md)
