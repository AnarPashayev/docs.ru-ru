---
title: Защита сообщений с использованием средств обеспечения безопасности сообщений
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: a6b062d0d6a74ce2a2ff9afa7e8a0a18853dbd22
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76746442"
---
# <a name="securing-messages-using-message-security"></a>Защита сообщений с использованием средств обеспечения безопасности сообщений
В этом разделе обсуждается безопасность сообщений WCF при использовании <xref:System.ServiceModel.NetMsmqBinding>.  
  
> [!NOTE]
> Перед чтением этого раздела рекомендуется ознакомиться с [основными понятиями безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md).  
  
 На следующем рисунке представлена концептуальная модель обмена данными в очереди с помощью WCF. Для объяснения принципов безопасности транспорта  
  
 используются следующие терминология и рисунки.  
  
 ![Диаграмма приложений в очереди](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Схема распределенной очереди")  
  
 При отправке сообщений в очереди с помощью WCF сообщение WCF прикрепляется в качестве тела сообщения MSMQ. В то время как безопасность транспорта обеспечивает безопасность всего сообщения MSMQ, безопасность сообщений (или протокол SOAP) обеспечивает безопасность только тела сообщения MSMQ.  
  
 Ключевым принципом безопасности сообщений является обеспечение безопасности сообщения клиентом для принимающего приложения (службы), в отличие от безопасности транспорта, когда клиент обеспечивает безопасность сообщения для целевой очереди. Таким образом, служба MSMQ не играет никакой части при защите сообщения WCF с помощью безопасности сообщений.  
  
 Безопасность сообщений WCF добавляет заголовки безопасности в сообщение WCF, которое интегрируется с существующими инфраструктурами безопасности, например сертификатом или протоколом Kerberos.  
  
## <a name="message-credential-type"></a>Типы учетных данных сообщений  
 С помощью безопасности сообщений служба и клиент могут предоставить учетные данные для двусторонней проверки подлинности. Включить безопасность сообщений можно, установив для режима <xref:System.ServiceModel.NetMsmqBinding.Security%2A> значение `Message` или `Both` (то есть использование и безопасности транспорта, и безопасности сообщений).  
  
 Служба может использовать свойство <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> для проверки учетных данных, подтверждающих подлинность клиента. Это свойство также может использоваться на последующих этапах авторизации, применяемых службой.  
  
 В этом разделе описываются различные типы учетных данных и их использование с очередями.  
  
### <a name="certificate"></a>Сертификат  
 Этот тип учетных данных сертификата использует сертификат X.509 для идентификации службы и клиента.  
  
 В типичном сценарии доверенный центр сертификации издает действительный сертификат для клиента и службы. Затем устанавливается соединение, клиент проверяет допустимость службы, обращаясь к ее сертификату для определения ее надежности. Аналогичным образом служба обращается к сертификату клиента для проверки надежности клиента.  
  
 Так как очереди отключены от сети, клиент и служба могут быть не подключены к сети одновременно. В таком случае клиент и служба должны обмениваться сертификатами по внештатному каналу. В частности, на основании наличия сертификата службы (который может быть привязан к центру сертификации) в доверенном хранилище клиент должен заключить, что взаимодействие осуществляется с нужной службой. Для проверки подлинности клиента служба использует сертификат X.509, прикрепленный к сообщению, для сопоставления его сертификату проверки подлинности клиента в хранилище. Аналогичным образом сертификат должен быть привязан к центру сертификации.  
  
 На компьютере под управлением Windows имеется несколько типов хранилищ сертификатов. Дополнительные сведения о различных хранилищах см. в разделе [хранилища сертификатов](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757138(v=ws.10)).  
  
### <a name="windows"></a>Портал  
 Тип учетных данных сообщений Windows использует протокол Kerberos.  
  
 Протокол Kerberos является механизмом обеспечения безопасности, проверяющим подлинность пользователей в домене и позволяющим пользователям, прошедшим проверку подлинности, устанавливать защищенные контексты с другими сущностями в домене.  
  
 Проблема, возникающая при применении протокола Kerberos для взаимодействия с использованием очереди, заключается в том, что билеты с учетной записью клиента, выдаваемые центром распространения ключей (KDC), имеют относительно короткое время существования. *Время существования* связано с билетом Kerberos, указывающим на допустимость билета. Поэтому в случае большой задержки нельзя быть уверенным в том, что маркер еще действителен для службы, выполняющей проверку подлинности клиента.  
  
 Обратите внимание, что при использовании этого типа учетных данных служба должна запускаться из учетной записи службы (SERVICE).  
  
 Протокол Kerberos используется по умолчанию при выборе учетных данных сообщения.
  
### <a name="username-password"></a>Имя пользователя и пароль  
 С помощью этого свойства клиент может проверить подлинность сервера, используя имя пользователя и пароль в заголовке безопасности сообщения.  
  
### <a name="issuedtoken"></a>IssuedToken  
 Клиент может обратиться к службе маркеров безопасности для получения прикрепляемого к сообщению маркера, с помощью которого служба может проверить подлинность клиента.  
  
## <a name="using-transport-and-message-security"></a>Использование безопасности транспорта и сообщений  
 При применении одновременно и безопасности транспорта, и безопасности сообщений для обеспечения безопасности сообщения как на уровне транспорта, так и на уровне сообщений SOAP должен использоваться один и тот же сертификат.  
  
## <a name="see-also"></a>См. также:

- [Защита сообщений с использованием средств обеспечения безопасности транспорта](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [Безопасность сообщений при использовании очереди сообщений](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [Основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
