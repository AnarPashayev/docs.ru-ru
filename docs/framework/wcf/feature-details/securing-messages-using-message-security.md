---
title: Защита сообщений с использованием средств обеспечения безопасности сообщений
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: cf014c8aa972c45140a523573b9806996062b40f
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59172007"
---
# <a name="securing-messages-using-message-security"></a>Защита сообщений с использованием средств обеспечения безопасности сообщений
В этом разделе рассматриваются безопасности сообщений WCF при использовании <xref:System.ServiceModel.NetMsmqBinding>.  
  
> [!NOTE]
>  Перед прочтением этого раздела, рекомендуется ознакомиться с [основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md).  
  
 На рисунке ниже представлен концептуальную модель взаимодействия с использованием очередей с помощью WCF. Для объяснения принципов безопасности транспорта  
  
 используются следующие терминология и рисунки.  
  
 ![В очереди схемы приложения](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "распределенных очереди Значной")  
  
 При отправке в очередь сообщений с помощью WCF, сообщение WCF присоединяется в качестве тела сообщения Message Queuing (MSMQ). В то время как безопасность транспорта обеспечивает безопасность всего сообщения MSMQ, безопасность сообщений (или протокол SOAP) обеспечивает безопасность только тела сообщения MSMQ.  
  
 Ключевым принципом безопасности сообщений является обеспечение безопасности сообщения клиентом для принимающего приложения (службы), в отличие от безопасности транспорта, когда клиент обеспечивает безопасность сообщения для целевой очереди. Таким образом MSMQ играет не роль при защите сообщений WCF, с использованием безопасности сообщений.  
  
 Безопасность сообщений WCF добавляет заголовки безопасности сообщений WCF, которые интегрируются с существующими инфраструктурами безопасности, например, сертификат или протокол Kerberos.  
  
## <a name="message-credential-type"></a>Типы учетных данных сообщений  
 С помощью безопасности сообщений служба и клиент могут предоставить учетные данные для двусторонней проверки подлинности. Включить безопасность сообщений можно, установив для режима <xref:System.ServiceModel.NetMsmqBinding.Security%2A> значение `Message` или `Both` (то есть использование и безопасности транспорта, и безопасности сообщений).  
  
 Служба может использовать свойство <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> для проверки учетных данных, подтверждающих подлинность клиента. Это свойство также может использоваться на последующих этапах авторизации, применяемых службой.  
  
 В этом разделе описываются различные типы учетных данных и их использование с очередями.  
  
### <a name="certificate"></a>Сертификат  
 Этот тип учетных данных сертификата использует сертификат X.509 для идентификации службы и клиента.  
  
 В типичном сценарии доверенный центр сертификации издает действительный сертификат для клиента и службы. Затем устанавливается соединение, клиент проверяет допустимость службы, обращаясь к ее сертификату для определения ее надежности. Аналогичным образом служба обращается к сертификату клиента для проверки надежности клиента.  
  
 Так как очереди отключены от сети, клиент и служба могут быть не подключены к сети одновременно. В таком случае клиент и служба должны обмениваться сертификатами по внештатному каналу. В частности, на основании наличия сертификата службы (который может быть привязан к центру сертификации) в доверенном хранилище клиент должен заключить, что взаимодействие осуществляется с нужной службой. Для проверки подлинности клиента служба использует сертификат X.509, прикрепленный к сообщению, для сопоставления его сертификату проверки подлинности клиента в хранилище. Аналогичным образом сертификат должен быть привязан к центру сертификации.  
  
 На компьютере под управлением Windows имеется несколько типов хранилищ сертификатов. Дополнительные сведения о различных хранилищах см. в разделе [хранилищах сертификатов](https://go.microsoft.com/fwlink/?LinkId=87787).  
  
### <a name="windows"></a>Windows  
 Тип учетных данных сообщений Windows использует протокол Kerberos.  
  
 Протокол Kerberos является механизмом обеспечения безопасности, проверяющим подлинность пользователей в домене и позволяющим пользователям, прошедшим проверку подлинности, устанавливать защищенные контексты с другими сущностями в домене.  
  
 Проблема, возникающая при применении протокола Kerberos для взаимодействия с использованием очереди, заключается в том, что билеты с учетной записью клиента, выдаваемые центром распространения ключей (KDC), имеют относительно короткое время существования. Объект *время существования* связан с билетом Kerberos, указывающим срок действия билета. Поэтому в случае большой задержки нельзя быть уверенным в том, что маркер еще действителен для службы, выполняющей проверку подлинности клиента.  
  
 Обратите внимание, что при использовании этого типа учетных данных служба должна запускаться из учетной записи службы (SERVICE).  
  
 Протокол Kerberos используется по умолчанию при выборе учетных данных сообщения. Дополнительные сведения см. в разделе [изучение Kerberos-протокола распределенной безопасности в Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).  
  
### <a name="username-password"></a>Имя пользователя и пароль  
 С помощью этого свойства клиент может проверить подлинность сервера, используя имя пользователя и пароль в заголовке безопасности сообщения.  
  
### <a name="issuedtoken"></a>IssuedToken  
 Клиент может обратиться к службе маркеров безопасности для получения прикрепляемого к сообщению маркера, с помощью которого служба может проверить подлинность клиента.  
  
## <a name="using-transport-and-message-security"></a>Использование безопасности транспорта и сообщений  
 При применении одновременно и безопасности транспорта, и безопасности сообщений для обеспечения безопасности сообщения как на уровне транспорта, так и на уровне сообщений SOAP должен использоваться один и тот же сертификат.  
  
## <a name="see-also"></a>См. также

- [Защита сообщений с использованием средств обеспечения безопасности транспорта](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [Безопасность сообщений при использовании очереди сообщений](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [Основные понятия безопасности](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [Защита служб и клиентов](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
