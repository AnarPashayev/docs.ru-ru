---
title: Размещение в приложении службы Windows
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: 8e50c39955f9ab72dfa1d52cbc37ab90f1ab0a8a
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59335372"
---
# <a name="hosting-in-a-windows-service-application"></a>Размещение в приложении службы Windows
Службы Windows (ранее называвшиеся службами Windows NT) обеспечивают модель процессов, особенно подходящую для приложений, которые должны существовать в длительно исполняемом файле и не отображают никакой формы пользовательского интерфейса. Временем существования процессов приложений служб Windows управляет диспетчер служб, который позволяет запускать, останавливать и приостанавливать приложения служб Windows. Можно настроить процесс службы Windows для автоматического запуска при запуске компьютера, сделав его подходящей средой размещения для приложений «always on». Дополнительные сведения о приложениях служб Windows, см. в разделе [приложений служб Windows](https://go.microsoft.com/fwlink/?LinkId=89450).  
  
 Приложения, размещающие долго выполняющихся служб Windows Communication Foundation (WCF) используют многие характеристики совместно со службами Windows. В частности службы WCF обладают server длительных исполняемые файлы, которые не взаимодействуют напрямую с пользователем и таким образом, не реализуют никакой формы пользовательского интерфейса. Таким образом для размещения служб WCF в приложении службы Windows — один из вариантов для создания надежных, длительно работающих приложений WCF.  
  
 Часто разработчикам WCF необходимо решить, следует ли для размещения своего приложения WCF внутри приложения службы Windows или в среде размещения службы Internet Information Services (IIS) или службы активации процессов Windows (WAS). Рассмотреть возможность использования приложений служб Windows необходимо в следующих случаях.  
  
-   Приложение требует явной активации. Например, службы Windows следует использовать, когда приложение должно запускаться автоматически при запуске сервера, а не динамически при поступлении первого входящего сообщения.  
  
-   Процесс, в котором размещается приложение, после запуска должен оставаться работающим. После запуска процесс службы Windows остается работающим, если явно не завершается администратором сервера с помощью диспетчера служб. Приложения, размещенные в IIS или службе активации Windows, могут запускаться и останавливаться динамически для обеспечения оптимального использования системных ресурсов. Приложения, для которых требуется явное управление в течение времени существования их процесса размещения, должны использовать службы Windows, а не IIS или службу активации Windows.  
  
-   Службы WCF необходимо запустить в Windows Server 2003 и использовать транспорт, отличный от HTTP. В Windows Server 2003 среда размещения [!INCLUDE[iis601](../../../../includes/iis601-md.md)] ограничена связью только по протоколу HTTP. Приложения служб Windows не распространяются на это ограничение и можно использовать любой транспорт поддерживает WCF, включая net.tcp, net.pipe и net.msmq.  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a>Размещение WCF в приложении службы Windows  
  
1. Создайте приложение службы Windows. Приложения служб Windows можно создавать в управляемом коде, используя классы в пространстве имен <xref:System.ServiceProcess>. Это приложение должно включать один класс, наследуемый от <xref:System.ServiceProcess.ServiceBase>.  
  
2. Свяжите время существования службы WCF времени существования приложения службы Windows. Как правило требуется служб WCF, размещенных в приложении службы Windows, становились активными при запуске службы размещения, остановить прослушивание сообщений при остановке службы размещения и завершение работы ведущего процесса, когда служба WCF сталкивается с ошибкой. Это можно обеспечить, выполнив следующие действия.  
  
    -   Переопределите <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, чтобы открыть один или несколько экземпляров <xref:System.ServiceModel.ServiceHost>. Одно приложение службы Windows можно разместить несколько служб WCF, запускать и останавливать как группу.  
  
    -   Переопределить <xref:System.ServiceProcess.ServiceBase.OnStop%2A> для вызова <xref:System.ServiceModel.Channels.CommunicationObject.Closed> на <xref:System.ServiceModel.ServiceHost> любой службы WCF, которые были запущены в течение <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.  
  
    -   Подпишитесь на событие <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> приложения <xref:System.ServiceModel.ServiceHost> и используйте класс <xref:System.ServiceProcess.ServiceController>, чтобы завершить работу приложения службы Windows в случае ошибки.  
  
     Приложений служб Windows, на которых размещены службы WCF развертываются и управляются так же, как приложения службы Windows, которые не используют WCF.  
  
## <a name="see-also"></a>См. также

- <xref:System.ServiceProcess>
- [Пошаговое руководство. Создание приложения службы Windows в конструкторе компонентов](https://go.microsoft.com/fwlink/?LinkId=94875)
- [Практическое руководство. Размещение службы WCF в управляемой службе Windows](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [Узел службы Windows](../../../../docs/framework/wcf/samples/windows-service-host.md)
- [Программная архитектура приложений служб](https://go.microsoft.com/fwlink/?LinkId=94876)
- [Возможности размещения Windows Server App Fabric](https://go.microsoft.com/fwlink/?LinkId=201276)
