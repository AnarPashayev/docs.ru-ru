---
title: Федерация и доверие
ms.date: 03/30/2017
helpviewer_keywords:
- federation [WCF], and trust
ms.assetid: 4bdec4f2-f8a2-4512-bdcf-14ef54b5877a
ms.openlocfilehash: 8b924a4aeb9c667592e99d65666cd8f048d34c22
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84595483"
---
# <a name="federation-and-trust"></a><span data-ttu-id="4476b-102">Федерация и доверие</span><span class="sxs-lookup"><span data-stu-id="4476b-102">Federation and Trust</span></span>
<span data-ttu-id="4476b-103">В этом разделе рассматриваются различные аспекты, связанные с федеративными приложениями, разграничением доверия и конфигурацией, и использование выданных маркеров в Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="4476b-103">This topic covers various aspects related to federated applications, trust boundaries and configuration, and use of issued tokens in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="services-security-token-services-and-trust"></a><span data-ttu-id="4476b-104">Службы, службы маркеров безопасности и доверие</span><span class="sxs-lookup"><span data-stu-id="4476b-104">Services, Security Token Services, and Trust</span></span>  
 <span data-ttu-id="4476b-105">Службы, предоставляющие федеративные конечные точки, обычно ожидают, что проверка подлинности клиентов будет выполняться с использованием маркеров, предоставленных определенным издателем.</span><span class="sxs-lookup"><span data-stu-id="4476b-105">Services that expose federated endpoints typically expect clients to authenticate using a token provided by a specific issuer.</span></span> <span data-ttu-id="4476b-106">Важно, чтобы в службе были настроены правильные учетные данные этого издателя; в противном случае служба не сможет проверять сигнатуры в выданных токенах и клиент не сможет взаимодействовать со службой.</span><span class="sxs-lookup"><span data-stu-id="4476b-106">It is important that the service is configured with the correct credentials for the issuer; otherwise, it will not be able to verify signatures over the issued tokens, and the client will be unable to communicate with the service.</span></span> <span data-ttu-id="4476b-107">Дополнительные сведения о настройке учетных данных издателя в службе см. в разделе [как настроить учетные данные на служба федерации](how-to-configure-credentials-on-a-federation-service.md).</span><span class="sxs-lookup"><span data-stu-id="4476b-107">For more information about configuring issuer credentials on the service, see [How to: Configure Credentials on a Federation Service](how-to-configure-credentials-on-a-federation-service.md).</span></span>  
  
 <span data-ttu-id="4476b-108">Аналогично, при использовании симметричных ключей они шифруются для целевой службы, поэтому необходимо настроить в службе маркеров безопасности правильные учетные данные целевой службы; в противном случае она не сможет зашифровать ключ для целевой службы, и клиент не сможет взаимодействовать со службой.</span><span class="sxs-lookup"><span data-stu-id="4476b-108">Similarly, when using symmetric keys, the keys are encrypted for the target service, so you must configure the security token service with the correct credentials for the target service; otherwise, it will be unable to encrypt the key for the target service, and again, the client will be unable to communicate with the service.</span></span>  
  
 <span data-ttu-id="4476b-109">Службы WCF используют значение <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> свойства в [SecurityBindingElement](../diagnostics/wmi/securitybindingelement.md) , чтобы обеспечить отклонение часов между клиентом и службой.</span><span class="sxs-lookup"><span data-stu-id="4476b-109">WCF services use the value of the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the [SecurityBindingElement](../diagnostics/wmi/securitybindingelement.md) to allow for clock skew between the client and service.</span></span> <span data-ttu-id="4476b-110">В федерации параметр `MaxClockSkew` применяется к рассогласованию часов как для клиента, так и для службы маркеров безопасности, от которой клиент получил выданный маркер.</span><span class="sxs-lookup"><span data-stu-id="4476b-110">In federation, the `MaxClockSkew` setting applies to clock skews between both the client and the security token service from where the client obtained the issued token.</span></span> <span data-ttu-id="4476b-111">Поэтому службам маркеров безопасности при задании времени начала и истечения срока действия выданных маркеров не требуется учитывать рассогласование часов.</span><span class="sxs-lookup"><span data-stu-id="4476b-111">Therefore, security token services need not make clock-skew allowances when setting the issued token's effective and expiration times.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4476b-112">Важность рассогласования часов возрастает по мере уменьшения времени существования выданных маркеров.</span><span class="sxs-lookup"><span data-stu-id="4476b-112">The importance of clock skew increases as the lifetime of the issued token shortens.</span></span> <span data-ttu-id="4476b-113">В большинстве случаев рассогласование часов не оказывает существенного влияния, если время существования маркера составляет 30 минут и более.</span><span class="sxs-lookup"><span data-stu-id="4476b-113">In most cases, clock skew is not a significant issue if the token lifetime is 30 minutes or more.</span></span> <span data-ttu-id="4476b-114">В сценариях, в которых время существования меньше или в которых важно точное время действия маркера, необходимо учитывать рассогласование часов.</span><span class="sxs-lookup"><span data-stu-id="4476b-114">Scenarios with shorter lifetimes or where the exact validity time of the token is important should be designed to take clock skew into account.</span></span>  
  
## <a name="federated-endpoints-and-time-outs"></a><span data-ttu-id="4476b-115">Федеративные конечные точки и значения времени ожидания</span><span class="sxs-lookup"><span data-stu-id="4476b-115">Federated Endpoints and Time-Outs</span></span>  
 <span data-ttu-id="4476b-116">Когда клиент взаимодействует с федеративной конечной точкой, он должен сначала получить соответствующий маркер от службы маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="4476b-116">When a client communicates with a federated endpoint, it must first acquire an appropriate token from a security token service.</span></span> <span data-ttu-id="4476b-117">Если служба маркеров безопасности предоставляет федеративную конечную точку, клиент должен сначала получить маркер от издателя этой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="4476b-117">If the security token service exposes a federated endpoint, the client must first obtain a token from the issuer for that endpoint.</span></span> <span data-ttu-id="4476b-118">Каждое получение маркера занимает некоторое время, и это время входит в общее время ожидания отправки фактического сообщения на финальную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="4476b-118">Each token acquisition takes time, and that time is subject to the overall time-out for sending the actual message to the final endpoint.</span></span>  
  
 <span data-ttu-id="4476b-119">Например, пусть для канала со стороны клиента задано время ожидания 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="4476b-119">For example, the time-out on the client-side channel is set to 30 seconds.</span></span> <span data-ttu-id="4476b-120">Перед передачей сообщения на финальную конечную точку требуется обратиться за маркерами к двум издателям, при этом для получения маркера у каждого издателя требуется по 15 секунд.</span><span class="sxs-lookup"><span data-stu-id="4476b-120">Two token issuers need to be called to retrieve tokens before sending the message to the final endpoint, and each takes 15 seconds to issue a token.</span></span> <span data-ttu-id="4476b-121">В этом случае попытка завершается со сбоем, и генерируется исключение <xref:System.TimeoutException>.</span><span class="sxs-lookup"><span data-stu-id="4476b-121">In this case, the attempt will fail and a <xref:System.TimeoutException> is thrown.</span></span> <span data-ttu-id="4476b-122">Поэтому необходимо установить в клиентском канале значение <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A>, достаточное для учета времени получения всех выданных маркеров.</span><span class="sxs-lookup"><span data-stu-id="4476b-122">Thus, you need to set the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> value on the client channel to a value large enough to include the time taken to retrieve all issued tokens.</span></span> <span data-ttu-id="4476b-123">В случае, если для свойства <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> значение не указано, для свойства <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> или свойства <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> (или для обоих) необходимо задать значение, достаточное для получения всех выданных маркеров.</span><span class="sxs-lookup"><span data-stu-id="4476b-123">In the case where a value is not specified for the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> property, the <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> property or the <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> property (or both) need to be set to a value large enough to include the time taken to retrieve all issued tokens.</span></span>  
  
## <a name="token-lifetime-and-renewal"></a><span data-ttu-id="4476b-124">Время существования маркера и его обновление</span><span class="sxs-lookup"><span data-stu-id="4476b-124">Token Lifetime and Renewal</span></span>  
 <span data-ttu-id="4476b-125">Клиенты WCF не проверяют выданный маркер при выполнении первоначального запроса к службе.</span><span class="sxs-lookup"><span data-stu-id="4476b-125">WCF clients do not check the issued token when making an initial request to a service.</span></span>  <span data-ttu-id="4476b-126">Вместо этого WCF доверяет службе маркеров безопасности выдать маркер с соответствующим действующим временем и сроком действия.</span><span class="sxs-lookup"><span data-stu-id="4476b-126">Rather, WCF trusts the security token service to issue a token with appropriate effective and expiration times.</span></span> <span data-ttu-id="4476b-127">Если клиент кэшировал токен и использовал его заново, время существования токена проверяется при последующих запросах и в случае необходимости клиент автоматически обновляет токен.</span><span class="sxs-lookup"><span data-stu-id="4476b-127">If the token is cached by the client and reused, the token lifetime is checked on subsequent requests and the client automatically renews the token if necessary.</span></span> <span data-ttu-id="4476b-128">Дополнительные сведения о кэшировании маркеров см. [в разделе инструкции. создание федеративного клиента](how-to-create-a-federated-client.md).</span><span class="sxs-lookup"><span data-stu-id="4476b-128">For more information about token caching, see [How to: Create a Federated Client](how-to-create-a-federated-client.md).</span></span>  
  
 <span data-ttu-id="4476b-129">Указание коротких жизненных циклов в порядке 30 секунд или меньше для выданных маркеров или маркеров контекста безопасности может привести к истечению времени ожидания согласования или другим исключениям, создаваемым клиентами WCF при запросе выданных маркеров или при согласовании или обновлении маркеров контекста безопасности.</span><span class="sxs-lookup"><span data-stu-id="4476b-129">Specifying short lifetimes, on the order of 30 seconds or less for issued tokens or security context tokens, may result in negotiation time-outs or other exceptions being thrown by WCF clients when requesting issued tokens or when negotiating or renewing security context tokens.</span></span>  
  
## <a name="issued-tokens-and-inclusionmode"></a><span data-ttu-id="4476b-130">Выданные маркеры и InclusionMode</span><span class="sxs-lookup"><span data-stu-id="4476b-130">Issued Tokens and InclusionMode</span></span>  
 <span data-ttu-id="4476b-131">Сериализация выданного маркера в сообщении, передаваемом клиентом в федеративную конечную точку, определяется заданием свойства <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> класса <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>.</span><span class="sxs-lookup"><span data-stu-id="4476b-131">Whether an issued token is serialized in a message sent from a client to a federated endpoint or not is controlled by setting the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> property of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="4476b-132">Этому свойству можно присвоить одно из значений перечисления <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>, но в большинстве федеративных сценариев это бесполезно.</span><span class="sxs-lookup"><span data-stu-id="4476b-132">This property can be set to one of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> enumeration values, but it is not useful in most federated scenarios.</span></span> <span data-ttu-id="4476b-133">Значения `SecurityTokenInclusionMode.Never` и `SecurityTokenInclusionMode.AlwaysToInitiator` приводят к тому, что клиент отправляет проверяющей стороне ссылку на маркер, выданный службой маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="4476b-133">The `SecurityTokenInclusionMode.Never` and `SecurityTokenInclusionMode.AlwaysToInitiator` values cause the client to send a reference to the token issued by the security token service to the relying party.</span></span> <span data-ttu-id="4476b-134">Если у проверяющей стороны нет копии выданного токена, проверка подлинности завершится сбоем, так как ссылка на токен не может быть разрешена.</span><span class="sxs-lookup"><span data-stu-id="4476b-134">Unless the relying party possesses a copy of the issued token, authentication will fail because the token reference is not resolvable.</span></span> <span data-ttu-id="4476b-135">WCF считается `SecurityTokenInclusionMode.Once` эквивалентной `SecurityTokenInclusionMode.AlwaysToRecipient` .</span><span class="sxs-lookup"><span data-stu-id="4476b-135">WCF treats `SecurityTokenInclusionMode.Once` as equivalent to `SecurityTokenInclusionMode.AlwaysToRecipient`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4476b-136">Дополнительно</span><span class="sxs-lookup"><span data-stu-id="4476b-136">See also</span></span>

- <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>
- [<span data-ttu-id="4476b-137">Практическое руководство. Создание федеративного клиента</span><span class="sxs-lookup"><span data-stu-id="4476b-137">How to: Create a Federated Client</span></span>](how-to-create-a-federated-client.md)
- [<span data-ttu-id="4476b-138">Практическое руководство. Настройка учетных данных службы федерации</span><span class="sxs-lookup"><span data-stu-id="4476b-138">How to: Configure Credentials on a Federation Service</span></span>](how-to-configure-credentials-on-a-federation-service.md)
- [<span data-ttu-id="4476b-139">Практическое руководство. Создание WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="4476b-139">How to: Create a WSFederationHttpBinding</span></span>](how-to-create-a-wsfederationhttpbinding.md)
