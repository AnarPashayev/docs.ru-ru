---
title: Федерация и доверие
ms.date: 03/30/2017
helpviewer_keywords:
- federation [WCF], and trust
ms.assetid: 4bdec4f2-f8a2-4512-bdcf-14ef54b5877a
ms.openlocfilehash: 4e1529db6cc52b6b8cc8881d2b2a35a754b4b311
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59225343"
---
# <a name="federation-and-trust"></a>Федерация и доверие
В этом разделе рассматриваются различные аспекты, относящиеся к федеративным приложениям, границы доверия и конфигурации и использования маркеров, выданных в Windows Communication Foundation (WCF).  
  
## <a name="services-security-token-services-and-trust"></a>Службы, службы маркеров безопасности и доверие  
 Службы, предоставляющие федеративные конечные точки, обычно ожидают, что проверка подлинности клиентов будет выполняться с использованием маркеров, предоставленных определенным издателем. Важно, чтобы в службе были настроены правильные учетные данные этого издателя; в противном случае служба не сможет проверять сигнатуры в выданных токенах и клиент не сможет взаимодействовать со службой. Дополнительные сведения о настройке учетных данных издателя в службе, см. в разделе [как: Настройка учетных данных службы федерации](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).  
  
 Аналогично, при использовании симметричных ключей они шифруются для целевой службы, поэтому необходимо настроить в службе маркеров безопасности правильные учетные данные целевой службы; в противном случае она не сможет зашифровать ключ для целевой службы, и клиент не сможет взаимодействовать со службой.  
  
 Службы WCF используют значение <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> свойство [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) разрешающее для часов между клиентом и службой. В федерации параметр `MaxClockSkew` применяется к рассогласованию часов как для клиента, так и для службы маркеров безопасности, от которой клиент получил выданный маркер. Поэтому службам маркеров безопасности при задании времени начала и истечения срока действия выданных маркеров не требуется учитывать рассогласование часов.  
  
> [!NOTE]
>  Важность рассогласования часов возрастает по мере уменьшения времени существования выданных маркеров. В большинстве случаев рассогласование часов не оказывает существенного влияния, если время существования маркера составляет 30 минут и более. В сценариях, в которых время существования меньше или в которых важно точное время действия маркера, необходимо учитывать рассогласование часов.  
  
## <a name="federated-endpoints-and-time-outs"></a>Федеративные конечные точки и значения времени ожидания  
 Когда клиент взаимодействует с федеративной конечной точкой, он должен сначала получить соответствующий маркер от службы маркеров безопасности. Если служба маркеров безопасности предоставляет федеративную конечную точку, клиент должен сначала получить маркер от издателя этой конечной точки. Каждое получение маркера занимает некоторое время, и это время входит в общее время ожидания отправки фактического сообщения на финальную конечную точку.  
  
 Например, пусть для канала со стороны клиента задано время ожидания 30 секунд. Перед передачей сообщения на финальную конечную точку требуется обратиться за маркерами к двум издателям, при этом для получения маркера у каждого издателя требуется по 15 секунд. В этом случае попытка завершается со сбоем, и генерируется исключение <xref:System.TimeoutException>. Поэтому необходимо установить в клиентском канале значение <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A>, достаточное для учета времени получения всех выданных маркеров. В случае, если для свойства <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> значение не указано, для свойства <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> или свойства <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> (или для обоих) необходимо задать значение, достаточное для получения всех выданных маркеров.  
  
## <a name="token-lifetime-and-renewal"></a>Время существования маркера и его обновление  
 Клиенты WCF не проверяют выданные маркеры, при выполнении первоначального запроса к службе.  Вместо этого WCF доверяет служба маркеров безопасности выдала маркер с соответствующее время начала и окончания срока действия. Если клиент кэшировал токен и использовал его заново, время существования токена проверяется при последующих запросах и в случае необходимости клиент автоматически обновляет токен. Дополнительные сведения о кэшировании маркеров см. в разделе [как: Создание федеративного клиента](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).  
  
 Задание короткого времени существования, порядка 30 секунд или менее, выданных маркеров или маркеров контекста безопасности, приложение может привести к превышению времени ожидания согласования или другие исключения, исключение клиентами WCF при запросе выданных маркеров или при согласовании либо обновлении безопасности маркеры контекста.  
  
## <a name="issued-tokens-and-inclusionmode"></a>Выданные маркеры и InclusionMode  
 Сериализация выданного маркера в сообщении, передаваемом клиентом в федеративную конечную точку, определяется заданием свойства <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> класса <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>. Этому свойству можно присвоить одно из значений перечисления <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>, но в большинстве федеративных сценариев это бесполезно. Значения `SecurityTokenInclusionMode.Never` и `SecurityTokenInclusionMode.AlwaysToInitiator` приводят к тому, что клиент отправляет проверяющей стороне ссылку на маркер, выданный службой маркеров безопасности. Если у проверяющей стороны нет копии выданного токена, проверка подлинности завершится сбоем, так как ссылка на токен не может быть разрешена. Обрабатывает WCF `SecurityTokenInclusionMode.Once` как эквивалент `SecurityTokenInclusionMode.AlwaysToRecipient`.  
  
## <a name="see-also"></a>См. также

- <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>
- [Практическое руководство. Создание федеративного клиента](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)
- [Практическое руководство. Настройка учетных данных службы федерации](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)
- [Практическое руководство. Создание WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)
