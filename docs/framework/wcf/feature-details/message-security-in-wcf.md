---
title: Безопасность сообщений в WCF
ms.date: 03/30/2017
ms.assetid: a80efb59-591a-4a37-bb3c-8fffa6ca0b7d
ms.openlocfilehash: 6875339df327371a79bc9b9072aca2df0bc7d3f6
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84602665"
---
# <a name="message-security-in-wcf"></a><span data-ttu-id="b7d98-102">Безопасность сообщений в WCF</span><span class="sxs-lookup"><span data-stu-id="b7d98-102">Message Security in WCF</span></span>

<span data-ttu-id="b7d98-103">Windows Communication Foundation (WCF) имеет два основных режима для обеспечения безопасности ( `Transport` и `Message` ) и третьего режима ( `TransportWithMessageCredential` ), объединяющего эти два.</span><span class="sxs-lookup"><span data-stu-id="b7d98-103">Windows Communication Foundation (WCF) has two major modes for providing security (`Transport` and `Message`) and a third mode (`TransportWithMessageCredential`) that combines the two.</span></span> <span data-ttu-id="b7d98-104">В данном разделе рассматривается безопасность сообщения и причины для ее использования.</span><span class="sxs-lookup"><span data-stu-id="b7d98-104">This topic discusses message security and the reasons to use it.</span></span>

## <a name="what-is-message-security"></a><span data-ttu-id="b7d98-105">Что такое безопасность сообщения?</span><span class="sxs-lookup"><span data-stu-id="b7d98-105">What Is Message Security?</span></span>

<span data-ttu-id="b7d98-106">Безопасность сообщения использует спецификацию WS-Security для защиты сообщений.</span><span class="sxs-lookup"><span data-stu-id="b7d98-106">Message security uses the WS-Security specification to secure messages.</span></span> <span data-ttu-id="b7d98-107">Спецификация WS-Security описывает улучшения в обмене сообщениями SOAP для обеспечения конфиденциальности, целостности и проверки подлинности на уровне сообщений SOAP (вместо транспортного уровня).</span><span class="sxs-lookup"><span data-stu-id="b7d98-107">The WS-Security specification describes enhancements to SOAP messaging to ensure confidentiality, integrity, and authentication at the SOAP message level (instead of the transport level).</span></span>

<span data-ttu-id="b7d98-108">Вкратце, безопасность сообщений отличается от безопасности транспорта тем, что учетные данные и утверждения безопасности инкапсулированы в каждое сообщение вместе с любой защитой сообщения (подпись или шифрование).</span><span class="sxs-lookup"><span data-stu-id="b7d98-108">In brief, message security differs from transport security by encapsulating the security credentials and claims with every message along with any message protection (signing or encryption).</span></span> <span data-ttu-id="b7d98-109">Применение защиты непосредственно к сообщению с помощью изменения его содержимого позволяет защищенному сообщению быть самосодержащим в отношении аспектов безопасности.</span><span class="sxs-lookup"><span data-stu-id="b7d98-109">Applying the security directly to the message by modifying its content allows the secured message to be self-containing with respect to the security aspects.</span></span> <span data-ttu-id="b7d98-110">Это позволяет использовать некоторые сценарии, которые были невозможны в случае безопасности транспорта.</span><span class="sxs-lookup"><span data-stu-id="b7d98-110">This enables some scenarios that are not possible when transport security is used.</span></span>

## <a name="reasons-to-use-message-security"></a><span data-ttu-id="b7d98-111">Причина для использования безопасности сообщения</span><span class="sxs-lookup"><span data-stu-id="b7d98-111">Reasons to Use Message Security</span></span>

<span data-ttu-id="b7d98-112">В безопасности на уровне сообщения вся информация безопасности инкапсулирована внутри сообщения.</span><span class="sxs-lookup"><span data-stu-id="b7d98-112">In message-level security, all of the security information is encapsulated in the message.</span></span> <span data-ttu-id="b7d98-113">Защита сообщения с помощью безопасности на уровне сообщения вместо защиты на транспортном уровне имеет следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="b7d98-113">Securing the message with message-level security instead of transport-level security has the following advantages:</span></span>

- <span data-ttu-id="b7d98-114">Сквозная безопасность.</span><span class="sxs-lookup"><span data-stu-id="b7d98-114">End-to-end security.</span></span> <span data-ttu-id="b7d98-115">Средства обеспечения безопасности транспорта, например протокол SSL, обеспечивают защиту только для соединения «точка-точка».</span><span class="sxs-lookup"><span data-stu-id="b7d98-115">Transport security, such as Secure Sockets Layer (SSL) only secures messages when the communication is point-to-point.</span></span> <span data-ttu-id="b7d98-116">Если перед тем, как попасть к конечному получателю SOAP, сообщение проходит через один или несколько посредников (например, через маршрутизатор), оно не будет защищено, когда посредник считывает его из потока.</span><span class="sxs-lookup"><span data-stu-id="b7d98-116">If the message is routed to one or more SOAP intermediaries (for example a router) before reaching the ultimate receiver, the message itself is not protected once an intermediary reads it from the wire.</span></span> <span data-ttu-id="b7d98-117">Кроме того, информация проверки подлинности клиента доступна только первому посреднику, поэтому в случае необходимости она должны заново передаваться конечному получателю вне потока.</span><span class="sxs-lookup"><span data-stu-id="b7d98-117">Additionally, the client authentication information is available only to the first intermediary and must be re-transmitted to the ultimate receiver in out-of-band fashion, if necessary.</span></span> <span data-ttu-id="b7d98-118">Это относится даже к сценариям, где на всем маршруте между отдельными прыжками используется безопасность SSL.</span><span class="sxs-lookup"><span data-stu-id="b7d98-118">This applies even if the entire route uses SSL security between individual hops.</span></span> <span data-ttu-id="b7d98-119">Поскольку безопасность сообщения реализована непосредственно в сообщении и защищает в нем код XML, защита обеспечивается вне зависимости от количества посредников, используемых для передачи сообщения конечному получателю.</span><span class="sxs-lookup"><span data-stu-id="b7d98-119">Because message security works directly with the message and secures the XML in it, the security stays with the message regardless of how many intermediaries are involved before it reaches the ultimate receiver.</span></span> <span data-ttu-id="b7d98-120">Это обеспечивает в полном смысле слова всеобъемлющую безопасность.</span><span class="sxs-lookup"><span data-stu-id="b7d98-120">This enables a true end-to-end security scenario.</span></span>

- <span data-ttu-id="b7d98-121">Повышенная гибкость.</span><span class="sxs-lookup"><span data-stu-id="b7d98-121">Increased flexibility.</span></span> <span data-ttu-id="b7d98-122">Можно подписывать части сообщения, а не только все сообщение.</span><span class="sxs-lookup"><span data-stu-id="b7d98-122">Parts of the message, instead of the entire message, can be signed or encrypted.</span></span> <span data-ttu-id="b7d98-123">Это означает, что посредники могут просматривать части сообщения, предназначенные для них.</span><span class="sxs-lookup"><span data-stu-id="b7d98-123">This means that intermediaries can view the parts of the message that are intended for them.</span></span> <span data-ttu-id="b7d98-124">Если отправителю необходимо сделать часть информации в сообщении видимой для посредников, но защитить ее от подделки, для этого достаточно подписать эту часть, но не зашифровывать ее.</span><span class="sxs-lookup"><span data-stu-id="b7d98-124">If the sender needs to make part of the information in the message visible to the intermediaries but wants to ensure that it is not tampered with, it can just sign it but leave it unencrypted.</span></span> <span data-ttu-id="b7d98-125">Поскольку подпись является частью сообщения, конечный получатель может проверить, что полученная информация в сообщении не была изменена.</span><span class="sxs-lookup"><span data-stu-id="b7d98-125">Since the signature is part of the message, the ultimate receiver can verify that the information in the message was received intact.</span></span> <span data-ttu-id="b7d98-126">В одном из сценариев возможно использование службы посредника SOAP, которая направляет сообщение в соответствии со значением заголовка действия.</span><span class="sxs-lookup"><span data-stu-id="b7d98-126">One scenario might have a SOAP intermediary service that routes message according the Action header value.</span></span> <span data-ttu-id="b7d98-127">По умолчанию WCF не шифрует значение действия, но подписывает его, если используется безопасность сообщений.</span><span class="sxs-lookup"><span data-stu-id="b7d98-127">By default, WCF does not encrypt the Action value but signs it if message security is used.</span></span> <span data-ttu-id="b7d98-128">Поэтому данная информация доступна всем посредникам, но не один из них не может изменить ее.</span><span class="sxs-lookup"><span data-stu-id="b7d98-128">Therefore, this information is available to all intermediaries, but no one can change it.</span></span>

- <span data-ttu-id="b7d98-129">Поддержка нескольких транспортов.</span><span class="sxs-lookup"><span data-stu-id="b7d98-129">Support for multiple transports.</span></span> <span data-ttu-id="b7d98-130">Можно отправлять защищенные сообщения с помощью различных транспортов, таких как именованные каналы и TCP. При этом нет необходимости задействовать протокол для обеспечения безопасности.</span><span class="sxs-lookup"><span data-stu-id="b7d98-130">You can send secured messages over many different transports, such as named pipes and TCP, without having to rely on the protocol for security.</span></span> <span data-ttu-id="b7d98-131">В случае с безопасностью на уровне транспорта вся информация безопасности действует в подключении транспорта и не доступна из содержимого самого сообщения.</span><span class="sxs-lookup"><span data-stu-id="b7d98-131">With transport-level security, all the security information is scoped to a single particular transport connection and is not available from the message content itself.</span></span> <span data-ttu-id="b7d98-132">Безопасность сообщения обеспечивает защиту вне зависимости от того, какой транспорт используется для передачи, и контекст безопасности внедряется непосредственно в сообщение.</span><span class="sxs-lookup"><span data-stu-id="b7d98-132">Message security makes the message secure regardless of what transport you use to transmit the message, and the security context is directly embedded inside the message.</span></span>

- <span data-ttu-id="b7d98-133">Поддержка широкого набора учетных данных и утверждений.</span><span class="sxs-lookup"><span data-stu-id="b7d98-133">Support for a wide set of credentials and claims.</span></span> <span data-ttu-id="b7d98-134">Безопасность сообщения основывается на спецификации WS-Security, обеспечивающей расширяемую инфраструктуру для передачи любого типа утверждения внутри сообщения SOAP.</span><span class="sxs-lookup"><span data-stu-id="b7d98-134">The message security is based on the WS-Security specification, which provides an extensible framework capable of transmitting any type of claim inside the SOAP message.</span></span> <span data-ttu-id="b7d98-135">В отличие от безопасности транспорта, набор механизмов проверки подлинности или утверждений не ограничен возможностями транспорта.</span><span class="sxs-lookup"><span data-stu-id="b7d98-135">Unlike transport security, the set of authentication mechanisms, or claims, that you can use is not limited by the transport capabilities.</span></span> <span data-ttu-id="b7d98-136">Безопасность сообщений WCF включает несколько типов проверки подлинности и передачи утверждений и может быть расширена для поддержки дополнительных типов по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="b7d98-136">WCF message security includes multiple types of authentication and claim transmission and can be extended to support additional types as necessary.</span></span> <span data-ttu-id="b7d98-137">По этой причине сценарий с участием федеративных учетных данных невозможен без обеспечения защищенности сообщения.</span><span class="sxs-lookup"><span data-stu-id="b7d98-137">For those reasons, for example, a federated credentials scenario is not possible without message security.</span></span> <span data-ttu-id="b7d98-138">Дополнительные сведения о сценариях Федерации, поддерживаемых WCF, см. в разделе [Федерация и выданные токены](federation-and-issued-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="b7d98-138">For more information about federation scenarios WCF supports, see [Federation and Issued Tokens](federation-and-issued-tokens.md).</span></span>

## <a name="how-message-and-transport-security-compare"></a><span data-ttu-id="b7d98-139">Сравнение безопасности сообщений и транспорта</span><span class="sxs-lookup"><span data-stu-id="b7d98-139">How Message and Transport Security Compare</span></span>

### <a name="pros-and-cons-of-transport-level-security"></a><span data-ttu-id="b7d98-140">Преимущества и недостатки безопасности на транспортном уровне</span><span class="sxs-lookup"><span data-stu-id="b7d98-140">Pros and Cons of Transport-Level Security</span></span>

<span data-ttu-id="b7d98-141">Безопасность транспорта имеет следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="b7d98-141">Transport security has the following advantages:</span></span>

- <span data-ttu-id="b7d98-142">Для взаимодействующих сторон не требуется поддержка принципов безопасности на уровне XML.</span><span class="sxs-lookup"><span data-stu-id="b7d98-142">Does not require that the communicating parties understand XML-level security concepts.</span></span> <span data-ttu-id="b7d98-143">Например, это позволяет улучшить взаимодействие при использовании протокола HTTPS для защиты связи.</span><span class="sxs-lookup"><span data-stu-id="b7d98-143">This can improve the interoperability, for example, when HTTPS is used to secure the communication.</span></span>

- <span data-ttu-id="b7d98-144">Общее повышение производительности.</span><span class="sxs-lookup"><span data-stu-id="b7d98-144">Generally improved performance.</span></span>

- <span data-ttu-id="b7d98-145">Наличие аппаратных ускорителей.</span><span class="sxs-lookup"><span data-stu-id="b7d98-145">Hardware accelerators are available.</span></span>

- <span data-ttu-id="b7d98-146">Возможность потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="b7d98-146">Streaming is possible.</span></span>

 <span data-ttu-id="b7d98-147">Безопасность транспорта имеет следующие недостатки.</span><span class="sxs-lookup"><span data-stu-id="b7d98-147">Transport security has the following disadvantages:</span></span>

- <span data-ttu-id="b7d98-148">Доступна только между прыжками.</span><span class="sxs-lookup"><span data-stu-id="b7d98-148">Hop-to-hop only.</span></span>

- <span data-ttu-id="b7d98-149">Ограниченный и не расширяемый набор учетных данных.</span><span class="sxs-lookup"><span data-stu-id="b7d98-149">Limited and inextensible set of credentials.</span></span>

- <span data-ttu-id="b7d98-150">Зависимость от транспорта.</span><span class="sxs-lookup"><span data-stu-id="b7d98-150">Transport-dependent.</span></span>

### <a name="disadvantages-of-message-level-security"></a><span data-ttu-id="b7d98-151">Недостатки безопасности на уровне сообщений</span><span class="sxs-lookup"><span data-stu-id="b7d98-151">Disadvantages of Message-Level Security</span></span>

<span data-ttu-id="b7d98-152">Безопасность сообщения имеет следующие недостатки.</span><span class="sxs-lookup"><span data-stu-id="b7d98-152">Message security has the following disadvantages:</span></span>

- <span data-ttu-id="b7d98-153">Производительность</span><span class="sxs-lookup"><span data-stu-id="b7d98-153">Performance</span></span>

- <span data-ttu-id="b7d98-154">Не поддерживается потоковая передача сообщений.</span><span class="sxs-lookup"><span data-stu-id="b7d98-154">Cannot use message streaming.</span></span>

- <span data-ttu-id="b7d98-155">Требуется реализация механизмов безопасности на уровне XML и поддержка спецификации WS-Security.</span><span class="sxs-lookup"><span data-stu-id="b7d98-155">Requires implementation of XML-level security mechanisms and support for WS-Security specification.</span></span> <span data-ttu-id="b7d98-156">Это может повлиять на взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="b7d98-156">This might affect the interoperability.</span></span>

## <a name="see-also"></a><span data-ttu-id="b7d98-157">Дополнительно</span><span class="sxs-lookup"><span data-stu-id="b7d98-157">See also</span></span>

- [<span data-ttu-id="b7d98-158">Защита служб и клиентов</span><span class="sxs-lookup"><span data-stu-id="b7d98-158">Securing Services and Clients</span></span>](securing-services-and-clients.md)
- [<span data-ttu-id="b7d98-159">Безопасность транспорта</span><span class="sxs-lookup"><span data-stu-id="b7d98-159">Transport Security</span></span>](transport-security.md)
- [<span data-ttu-id="b7d98-160">Практическое руководство. Использование средств обеспечения безопасности транспорта и учетных данных сообщения</span><span class="sxs-lookup"><span data-stu-id="b7d98-160">How to: Use Transport Security and Message Credentials</span></span>](how-to-use-transport-security-and-message-credentials.md)
- <span data-ttu-id="b7d98-161">[Шаблоны и примеры Microsoft, глава 3: "Реализация безопасности на уровне транспорта и сообщений"](https://docs.microsoft.com/previous-versions/msp-n-p/ff647370(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="b7d98-161">[Microsoft Patterns and Practices, Chapter 3: Implementing Transport and Message Layer Security](https://docs.microsoft.com/previous-versions/msp-n-p/ff647370(v=pandp.10))</span></span>
