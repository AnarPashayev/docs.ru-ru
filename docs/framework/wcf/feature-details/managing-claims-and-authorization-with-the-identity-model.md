---
title: Управление утверждениями и авторизацией с помощью модели удостоверения
ms.date: 03/30/2017
helpviewer_keywords:
- authorization [WCF]
- WCF security
- claims [WCF], managing with the Identity Model
- claims [WCF]
- authorization [WCF], managing with the Identity Model
ms.assetid: 099defbb-5d35-434e-9336-1a49b9ec7663
ms.openlocfilehash: 9341ff8bfb2aec4eb7274d444fca4497fa66f210
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2019
ms.locfileid: "65875556"
---
# <a name="managing-claims-and-authorization-with-the-identity-model"></a>Управление утверждениями и авторизацией с помощью модели удостоверения
Авторизация - это процесс определения сущностей, имеющих право изменять, просматривать компьютерный ресурс или получать доступ к нему. Например, в организации только менеджерам может быть разрешен доступ к файлам их сотрудников. Windows Communication Foundation (WCF) поддерживает два механизма выполнения авторизации. Первый механизм позволяет управлять авторизацией с помощью существующих конструкций среды CLR. Второй — модель на основе утверждений, называется *модели удостоверения*. WCF использует модель удостоверения для создания утверждений из входящих сообщений; Классы модели удостоверения можно расширить для поддержки новых типов утверждений для пользовательских схем авторизации. В этом разделе приводятся общие сведения об основных принципах программирования возможности "Модель удостоверения", а также перечисляются наиболее важные классы, используемые этой возможностью.  
  
## <a name="identity-model-scenarios"></a>Сценарии модели удостоверения  
 Использование модели удостоверения представляется следующими сценариями.  
  
### <a name="scenario-1-supporting-identity-role-and-group-claims"></a>Сценарий 1. Поддержка идентификации, роли и утверждений о группах  
 Пользователи отправляют сообщения в веб-службу. Согласно требованиям управления доступом веб-службы, используются идентификация, роли или группы. Отправитель сообщения сопоставляется с рядом ролей или групп. Для выполнения проверок доступа используются сведения о роли или группе.  
  
### <a name="scenario-2-supporting-rich-claims"></a>Сценарий 2. Поддержка полнофункциональных утверждений  
 Пользователи отправляют сообщения в веб-службу. Согласно требованиям управления доступом веб-службы, необходима модель с более широкими функциональными возможностями, чем модель с идентификацией, ролями или группами. Имеет ли заданный пользователь доступ к конкретному защищенному ресурсу, определяется веб-службой с помощью модели, основанной на утверждениях с широкими функциональными возможностями. Например, один пользователь может иметь доступ к конкретным сведениям, например о заработной плате, а другие пользователи - нет.  
  
### <a name="scenario-3-mapping-disparate-claims"></a>Сценарий 3. Сопоставление несопоставимых утверждений  
 Пользователь отправляет сообщение в веб-службу. Пользователь может указать свои учетные данные несколькими разными способами: Сертификат X.509, маркера имени пользователя или маркера Kerberos. Веб-служба должна выполнить одинаковые проверки управления доступом независимо от типа учетных данных пользователя. Если впоследствии будут поддерживаться дополнительные типы учетных данных, необходимо соответствующим образом расширить возможности системы.  
  
### <a name="scenario-4-determining-access-to-multiple-resources"></a>Сценарий 4. Определение доступа к нескольким ресурсам  
 Веб-служба пытается получить доступ к нескольким ресурсам. Служба определяет, к каким защищенным ресурсам имеет доступ заданный пользователь, сравнивая утверждения, связанные с этим пользователем, с утверждениями, необходимыми для доступа к ресурсу.  
  
## <a name="identity-model-terms"></a>Термины модели удостоверения  
 Ниже определяются основные термины, используемые для описания концепций модели удостоверения.  
  
 Политика авторизации  
 Набор правил сопоставления ряда входных утверждений с рядом выходных утверждений. Оценка политики авторизации приводит к добавлению наборов утверждений в контекст оценки и впоследствии в контекст авторизации.  
  
 Контекст авторизации  
 Ряд наборов утверждений и ноль или более свойств. Результат оценки одной или нескольких политик авторизации.  
  
 Утверждение  
 Сочетание типа утверждения, права и значения.  
  
 Набор утверждений  
 Ряд утверждений, изданных конкретным издателем.  
  
 Тип утверждения  
 Вид утверждения. Утверждения, определенные интерфейсом API модели удостоверения, являются свойствами класса <xref:System.IdentityModel.Claims.Claim.ClaimType%2A>. Примеры типов утверждений, обеспечиваемых системой: <xref:System.IdentityModel.Claims.ClaimTypes.Dns%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Email%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Hash%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Name%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Rsa%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Sid%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Spn%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.System%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Thumbprint%2A>, <xref:System.IdentityModel.Claims.ClaimTypes.Uri%2A> и <xref:System.IdentityModel.Claims.ClaimTypes.X500DistinguishedName%2A>.  
  
 Контекст оценки  
 Контекст, в котором оценивается политика авторизации. Содержит свойства и наборы утверждений. По окончании оценки становится основой контекста авторизации.  
  
 Идентификационное утверждение  
 Утверждение, правом которого является удостоверение.  
  
 Издатель  
 Набор утверждений, который содержит по крайней мере одно идентификационное утверждение и считается имеющим другой изданный набор утверждений.  
  
 Свойства  
 Ряд сведений, связанных с контекстом оценки или контекстом авторизации.  
  
 Защищенный ресурс  
 Ресурс в системе, который может использоваться или обрабатываться или к которому может предоставляться доступ, только если удовлетворены определенные требования.  
  
 Правый  
 Возможность в отношении ресурса. Права, определенные интерфейсом API модели удостоверения, являются свойствами класса <xref:System.IdentityModel.Claims.Rights>. Примеры прав, обеспечиваемых системой: <xref:System.IdentityModel.Claims.Rights.Identity%2A> и <xref:System.IdentityModel.Claims.Rights.PossessProperty%2A>.  
  
 Значение  
 Некоторое значение, в отношении которого утверждается право.  
  
## <a name="claims"></a>Утверждения  
 Модель удостоверения - это система, основанная на утверждениях. Утверждения описывают возможности, связанные с некоторой сущностью в системе, часто с пользователем этой системы. Ряд утверждений, связанных с заданной сущностью, можно считать ключом. Конкретные утверждения определяют форму этого ключа, подобную физическому ключу для открывания замка двери. Утверждения используются для получения доступа к ресурсам. Доступ к заданному защищенному ресурсу определяется сравнением утверждений, необходимых для доступа к этому ресурсу, с утверждениями, связанными с сущностью, пытающейся получить доступ.  
  
 Утверждение - это выражение права в отношении конкретного значения. Правом может быть нечто вроде "Чтение", "Запись" или "Выполнение". Значением может быть база данных, файл, почтовый ящик или свойство. Утверждения также имеют тип утверждения. Сочетание типа утверждения и права обеспечивает механизм задания возможностей в отношении значения. Например, утверждение типа «File» с правом «Read» в отношении значения «Biography.doc» указывает, что сущность, с которой связывается такое утверждение, имеет доступ для чтения к файлу Biography.doc. Утверждение типа «Name» с правом «PossessProperty» в отношении значения «Martin» указывает, что сущность, с которой связывается такое утверждение, обладает свойством Name со значением «Martin».  
  
 Хотя различные типы утверждений и права определяются как часть модели удостоверения, система является расширяемой, позволяя различным системам, создаваемым в дополнение к инфраструктуре модели удостоверения, определять дополнительные типы утверждений и права согласно требованиям.  
  
### <a name="identity-claims"></a>Идентификационные утверждения  
 Одно конкретное право является правом удостоверения. Утверждения, обладающие таким правом, создают оператор в отношении удостоверения сущности. Например, утверждение типа «имя участника-пользователя» (UPN) со значением "someone@example.com" и правом удостоверения указывает конкретное удостоверение в определенном домене.  
  
#### <a name="system-identity-claim"></a>Идентификационное утверждение "система"  
 Модель удостоверения определяет одно идентификационное утверждение: System. Идентификационное утверждение "система" указывает, что сущностью является текущее приложение или система.  
  
### <a name="sets-of-claims"></a>Наборы утверждений  
 Модель утверждений, представляющих удостоверение, важна, поскольку утверждения всегда издаются некоторой сущностью в системе, даже если эта сущность является в конечном счете некоторой "самостоятельной" концепцией. Утверждения группируются в виде набора, и каждый набор имеет издателя. Издатель - это просто набор утверждений. Такая рекурсивная связь должна в конечном счете завершиться, и любой набор утверждений может быть издателем сам для себя.  
  
 На следующем рисунке приведен пример трех наборов утверждений, где издателем одного набора утверждений является другой набор утверждений, издателем которого, в свою очередь, является набор утверждений "система". Следовательно, наборы утверждений образуют иерархию, которая может иметь произвольную глубину.  
  
 ![Наборы утверждений в иерархии.](./media/managing-claims-and-authorization-with-the-identity-model/claims-sets-hierarchy.gif)  
  
 Несколько наборов утверждений может иметь тот же издающий набор утверждений, как показано на следующем рисунке:
 
  
 ![Несколько наборов заявок с тот же издающий набор утверждений.](./media/managing-claims-and-authorization-with-the-identity-model/multiple-claim-sets-same-issuing-claim-set.gif)  
  
 За исключением набора утверждений, который является издателем сам для себя, модель удостоверения не обеспечивает никакой поддержки образования цикла наборами утверждений. Таким образом, невозможно возникновение ситуации, когда набор утверждений A издается набором утверждений B, который сам издается набором утверждений A. Кроме того, модель удостоверения не обеспечивает никакой поддержки наличия нескольких издателей для наборов утверждений. Если два или более издателей должны издать заданный набор утверждений, необходимо использовать несколько наборов утверждений, каждый из которых содержит одни и те же утверждения, но имеет разных издателей.  
  
### <a name="the-origin-of-claims"></a>Источники утверждений  
 Утверждения могут поступать из множества источников. Одним из общих источников утверждений являются учетные данные, представляемые пользователем, например в виде части сообщения, отправляемого в веб-службу. Система подтверждает такие утверждения, и они становятся частью набора утверждений, связанных с данным пользователем. Источниками утверждений могут также быть другие компоненты системы, включая операционную систему, сетевой стек, среду выполнения и приложение (но не только эти компоненты). Еще один возможный источник утверждений - удаленные службы.  
  
### <a name="authorization-policies"></a>Политики авторизации  
 В модели удостоверения утверждения создаются в процессе оценки политики авторизации. Политика авторизации проверяет набор (возможно, пустой) существующих утверждений и может добавить дополнительные утверждения на основе уже имеющихся утверждений и дополнительных сведений при их наличии. Это обеспечивает основу для сопоставления утверждений между собой. Наличие или отсутствие утверждений в системе влияет на поведение политики авторизации, касающееся добавления дополнительных утверждений.  
  
 Например, пусть политика авторизации имеет доступ к базе данных, в которой содержатся дни рождения различных сущностей, использующих систему. Политика авторизации использует эти сведения для добавления утверждения "Over18" в контекст. Обратите внимание, что это утверждение не раскрывает никаких сведений о сущности, кроме того факта, что ее возраст больше 18 лет. Следует отметить, что интерпретация утверждения "Over18" зависит от понимания семантики этого утверждения. Политика авторизации, добавившая данное утверждение, понимает эту семантику на некотором уровне. Код, который впоследствии проверяет утверждения, являющиеся результатом оценки политики, также информируется об этой семантике.  
  
 Заданная политика авторизации может требовать, чтобы она оценивалась несколько раз, поскольку, так как другие политики авторизации добавляют утверждения, эта политика авторизации может добавить еще больше утверждений. Модель удостоверения разработана для продолжения оценки до тех пор, пока в контекст больше не будет добавляться никаких утверждений любой из действующих политик авторизации. Такая продолжающаяся оценка политик авторизации исключает необходимость принудительного установления конкретного порядка оценки политик авторизации; они могут оцениваться в любом порядке. Например, если политика X добавляет утверждение Z, только если политика A добавила утверждение B, то если сначала оценивается политика X, она изначально не добавляет утверждение Z. Затем оценивается политика A и она добавляет утверждение B. После этого второй раз оценивается политика X и теперь она добавляет утверждение Z.  
  
 Заданная система может иметь много действующих политик авторизации.  
  
### <a name="a-key-making-machine"></a>Компьютер, создающий ключи  
 Оценка группы связанных политик авторизации аналогична использованию компьютера, который создает ключи. Выполняется оценка каждой политики авторизации и формируются наборы утверждений, создавая форму ключа. По окончании создания формы ключа с помощью этой формы можно пытаться открывать некоторые замки. Форма ключа сохраняется в "контексте авторизации," создаваемом диспетчером авторизации.  
  
### <a name="authorization-context"></a>Контекст авторизации  
 Диспетчер авторизации оценивает различные политики авторизации согласно описанию, результатом чего является контекст авторизации (ряд наборов утверждений и некоторые связанные свойства). Контекст авторизации может быть проверен, чтобы определить имеющиеся в нем утверждения, взаимосвязи между этими утверждениями (например, издание набора утверждений) и в конечном счете сравнить их с некоторыми требованиями, которым они должны соответствовать для доступа к ресурсу.  
  
### <a name="locks"></a>Замки  
 Если контекст авторизации (набор утверждений) является ключом, требования, которые должны быть удовлетворены для предоставления доступа к конкретному защищенному ресурсу, составляют замок, которому этот ключ должен соответствовать. Модель удостоверения не формализует, как такие требования выражаются, но они (при условии основанного на утверждениях характера системы) включают сравнение утверждений в контексте авторизации с некоторым набором необходимых утверждений.  
  
### <a name="a-recap"></a>Резюме  
 Модель удостоверения основана на концепции утверждений. Утверждения группируются в наборы и объединяются в контексте авторизации. Контекст авторизации содержит ряд утверждений и является результатом оценки одной или нескольких политик авторизации, связанных с диспетчером авторизации. Эти наборы утверждений могут проверяться для выяснения, удовлетворены ли требования к доступу. На следующем рисунке показаны взаимосвязи между этими концепциями модели удостоверения.  
  
 ![Управление утверждениями и авторизацией](../../../../docs/framework/wcf/feature-details/media/xsi-recap.gif "xsi_recap")  
  
## <a name="wcf-and-identity-model"></a>WCF и модель удостоверения  
 WCF использует инфраструктуре модели удостоверения в качестве основы для выполнения авторизации. В WCF <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> позволяет указать *авторизации* политики как части службы. Такие политики авторизации называются *внешних политик авторизации*, позволяя им выполнять обработку утверждений на основе локальной политики или взаимодействия с удаленной службой. Диспетчер авторизации, представленный <xref:System.ServiceModel.ServiceAuthorizationManager> класс оценивает внешние политики авторизации вместе с политиками авторизации, которые распознают различные типы (маркеры) учетных данных и заполняет так называемый  *контекст авторизации* утверждениями, соответствующими входящему сообщению. Контекст авторизации представляется классом <xref:System.IdentityModel.Policy.AuthorizationContext>.  
  
## <a name="identity-model-programming"></a>Программирование модели удостоверения  
 В приведенной ниже таблице описана объектная модель для программирования расширений модели удостоверения. Все указанные классы существуют в пространстве имен <xref:System.IdentityModel.Policy> или <xref:System.IdentityModel.Claims>.  
  
|Класс|Описание|  
|-----------|-----------------|  
|Компонент авторизации|Класс модели удостоверения, реализующий интерфейс <xref:System.IdentityModel.Policy.IAuthorizationComponent>.|  
|<xref:System.IdentityModel.Policy.IAuthorizationComponent>|Интерфейс, обеспечивающий единственное доступное только для чтения свойство строки: Идентификатор Значение этого свойства уникально для каждого экземпляра в системе, которая реализует данный интерфейс.|  
|<xref:System.IdentityModel.Policy.AuthorizationContext>|*Компонент авторизации* , содержащий набор `ClaimSet` экземпляры с ноль или более свойств; результат оценки одной или нескольких политик авторизации.|  
|<xref:System.IdentityModel.Claims.Claim>|Сочетание типа утверждения, права и значения. Компоненты права и значения ограничиваются типом утверждения.|  
|<xref:System.IdentityModel.Claims.ClaimSet>|Абстрактный базовый класс. Коллекция экземпляров класса `Claim`.|  
|<xref:System.IdentityModel.Claims.DefaultClaimSet>|Запечатанный класс. Реализация класса `ClaimSet`.|  
|<xref:System.IdentityModel.Policy.EvaluationContext>|Абстрактный базовый класс. Передается в политику авторизации во время оценки политики.|  
|<xref:System.IdentityModel.Policy.IAuthorizationPolicy>|Наследуемый от интерфейса `IAuthorizationComponent` и реализуемый классами политики авторизации.|  
|<xref:System.IdentityModel.Claims.Rights>|Статический класс, содержащий заранее определенные значения права.|  
  
 Представленные ниже классы также используются для программирования модели удостоверения, но в пространствах имен <xref:System.IdentityModel.Policy> и <xref:System.IdentityModel.Claims> отсутствуют.  
  
|Класс|Описание|  
|-----------|-----------------|  
|<xref:System.ServiceModel.ServiceAuthorizationManager>|Класс, предоставляющий метод (<xref:System.ServiceModel.ServiceAuthorizationManager.CheckAccessCore%2A>) для выполнения проверок авторизации на основе утверждений для каждой операции в службе. Необходимо выполнить наследование от этого класса и переопределить данный метод.|  
|<xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>|Запечатанный класс, предоставляющий различные свойства, связанные с поведением службы, когда оно относится к авторизации.|  
|<xref:System.ServiceModel.ServiceSecurityContext>|Класс, предоставляющий контекст безопасности, включая контекст авторизации, для выполняющейся в данный момент (или подлежащей выполнению) операции. Экземпляр этого класса является частью <xref:System.ServiceModel.OperationContext>.|  
  
### <a name="significant-members"></a>Важные члены  
 Представленные ниже члены обычно используются для создания новых типов утверждений.  
  
|Член|Описание|  
|------------|-----------------|  
|<xref:System.ServiceModel.ServiceAuthorizationManager.CheckAccessCore%2A>|Производные классы реализуют этот метод для выполнения проверок доступа на основе утверждений до выполнения операций в службе. При принятии решения по проверке доступа могут рассматриваться любые или все сведения в предоставленном контексте <xref:System.ServiceModel.OperationContext> или где-то в другом месте. Если <xref:System.ServiceModel.ServiceAuthorizationManager.CheckAccessCore%2A> возвращает значение `true`, доступ предоставляется и разрешается выполнение операции. Если `CheckAccessCore` возвращает значение `false`, доступ отклоняется и операция не выполняется. Пример см. в статье [Практическое руководство. Создание пользовательского диспетчера авторизации для службы](../../../../docs/framework/wcf/extending/how-to-create-a-custom-authorization-manager-for-a-service.md).|  
|<xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ServiceAuthorizationManager%2A>|Возвращает <xref:System.ServiceModel.ServiceAuthorizationManager> для службы. <xref:System.ServiceModel.ServiceAuthorizationManager> отвечает за принятие решений по авторизации.|  
|<xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ExternalAuthorizationPolicies%2A>|Коллекция пользовательских политик авторизации, заданных для службы. Эти политики оцениваются в дополнение к политикам, связанным с учетными данными во входящих сообщениях.|  
  
## <a name="see-also"></a>См. также

- <xref:System.IdentityModel.Policy.AuthorizationContext>
- <xref:System.IdentityModel.Claims.Claim>
- <xref:System.IdentityModel.Policy.EvaluationContext>
- <xref:System.IdentityModel.Policy.IAuthorizationComponent>
- <xref:System.IdentityModel.Policy.IAuthorizationPolicy>
- <xref:System.IdentityModel.Claims.Rights>
- <xref:System.IdentityModel.Claims>
- <xref:System.IdentityModel.Policy>
- <xref:System.IdentityModel.Tokens>
- <xref:System.IdentityModel.Selectors>
- [Утверждения и маркеры](../../../../docs/framework/wcf/feature-details/claims-and-tokens.md)
- [Утверждения и запрет доступа к ресурсам](../../../../docs/framework/wcf/feature-details/claims-and-denying-access-to-resources.md)
- [Создание утверждений и значения ресурсов](../../../../docs/framework/wcf/feature-details/claim-creation-and-resource-values.md)
- [Практическое руководство. Создание пользовательского утверждения](../../../../docs/framework/wcf/extending/how-to-create-a-custom-claim.md)
- [Практическое руководство. Сравнение утверждений](../../../../docs/framework/wcf/extending/how-to-compare-claims.md)
- [Практическое руководство. Создание пользовательской политики авторизации](../../../../docs/framework/wcf/extending/how-to-create-a-custom-authorization-policy.md)
- [Практическое руководство. Создание пользовательского диспетчера авторизации для службы](../../../../docs/framework/wcf/extending/how-to-create-a-custom-authorization-manager-for-a-service.md)
- [Общие сведения о безопасности](../../../../docs/framework/wcf/feature-details/security-overview.md)
- [Авторизация](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)
