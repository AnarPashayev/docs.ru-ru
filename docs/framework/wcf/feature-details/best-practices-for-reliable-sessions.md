---
title: Рекомендации по работе с надежными сеансами
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 1d9671e7e3124d535b66de8cd8468f76dcb32b10
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61857991"
---
# <a name="best-practices-for-reliable-sessions"></a>Рекомендации по работе с надежными сеансами

В этом разделе обсуждаются рекомендации для надежных сеансов.

## <a name="setting-maxtransferwindowsize"></a>Установка MaxTransferWindowSize

Надежные сеансы в Windows Communication Foundation (WCF) используют окно передачи для хранения сообщений клиента и службы. Настраиваемое свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в окне передачи.

На стороне отправителя это указывает количество сообщений, могут храниться в окне передачи во время ожидания подтверждения; на стороне получателя он указывает количество сообщений, помещаемых в буфер для службы.

Выбор правильного размера влияет на эффективность работы сети и оптимальную производительность службы. В следующих разделах подробно, что нужно учитывать при выборе значения для этого свойства и влиянии этого значения.

Размер окна передачи по умолчанию составляет 8 сообщений.

### <a name="efficient-use-of-the-network"></a>Эффективное использование сети

В этом контексте термин *сети* соответствует всему, что используется в качестве основы связи между клиентом (отправителем) и службой (получателем). Сюда входят подключения транспорта и любые посредника или мосты между ними, включая маршрутизаторы SOAP или HTTP-прокси-серверы или брандмауэры.

Эффективное использование сети обеспечивает максимальные возможности сети. Объем данных, передаваемых по сети в секунду (*скорость передачи данных*) и время, необходимое для передачи данных от отправителя к получателю (*задержки*) влияет на эффективность сети применяется к имеющимся.

На стороне отправителя свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в его окне передачи во время ожидания подтверждения. Если Высокая задержка сети и для обеспечения ответа отправителя и эффективного использования сети, следует увеличить размер окна передачи.

Например даже, если отправитель поддерживает скорость передачи данных, задержка может быть высокой Если существует несколько посредников между отправителем и получателем или данные, должны пройти через посредника, ведущем к потере данных или сеть. Таким образом отправитель должен ждать подтверждений для сообщений, в его окне передачи, прежде чем принять новые сообщения для отправки по сети. Чем меньше буфер с высокой задержкой, тем менее эффективными использования сети. С другой стороны слишком большой размер окна передачи может повлиять на службу, так как служба может понадобиться Догнать большое число данных, отправленных клиентом.

### <a name="running-the-service-to-capacity"></a>Со службой емкости

Как бы эффективно ни использовалась сеть, в идеале также требуется служба для запуска с максимальной производительностью. Свойство размера окна передачи на стороне получателя указывает количество сообщений, которое получатель может поместить в буфер. Такая буферизация сообщений помогает не только управлять потоком в сети, но и обеспечивает выполнение службы с максимальной производительностью. Например, если буфер имеет одно сообщение и сообщения прибывают быстрее, чем эта служба может обрабатывать их затем сети могут удалять сообщения и может быть потрачены впустую или недостаточно емкости.

При использовании буфера повышается доступность службы, так как она одновременно получает и помещает в буфер сообщение во время обработки сообщения, полученные ранее.

Мы рекомендуем использовать же `MaxTransferWindowSize` на отправителя и получателя.

### <a name="enabling-flow-control"></a>Включение управления потоком

*Поток управления* — это механизм, который гарантирует, что отправитель и получатель не отставать от друг с другом, то есть сообщения принимаются и обрабатываемое настолько быстро, насколько они являетесь созданы. Размер окна передачи со стороны клиента и службы гарантирует, что отправитель и получатель находятся в разумном окне синхронизации.

Настоятельно рекомендуется присвоить свойству <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> для `true` при использовании надежного сеанса между клиентом WCF и службы WCF.

## <a name="setting-maxpendingchannels"></a>Установка MaxPendingChannels

При записи службы, обеспечивающей надежный сеанс передачи от разных клиентов, можно задать многим клиентам установить надежный сеанс, к службе, в то же время. Ответ службы в таких ситуациях зависит от свойства `MaxPendingChannels`.

Когда отправитель создает канал надежного сеанса для связи с получателем, после подтверждения между ними устанавливается надежный сеанс. После установки надежного сеанса канал помещается в очередь ожидающих каналов для принятия службой. Свойство `MaxPendingChannels` указывает количество каналов, которые могут находиться в этом состоянии.

Это служба может находиться в состоянии, где он не может принимать несколько каналов. Если очередь заполнена, попытка установки надежного сеанса отклоняется и клиент должен повторить попытку.

Можно также, когда ожидающие каналы в очереди остаются в очереди более длительный срок. В то же время временем ожидания простоя в надежном сеансе может возникать, вызывая канал перейдет в состояние сбоя.

При написании службы, которая обслуживает несколько клиентов одновременно, необходимо задать значение, которое подходит для ваших потребностей. Слишком большое значение для параметра `MaxPendingChannels` свойство влияет на рабочего набора.

Значение по умолчанию для <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> — четыре канала.

## <a name="reliable-sessions-and-hosting"></a>Надежные сеансы и размещение

Когда веб-размещения службы, использующей надежные сеансы, вам следует учитывать следующие важные моменты:

- В надежных сеансах можно отследить состояние, которое поддерживается в домене приложения. Это значит, что все сообщения, являющиеся частью надежного сеанса, необходимо обрабатывать в том же домене приложения. Веб-фермы и веб-сады, где размер фермы или сада больше, чем один узел не может гарантировать это ограничение.

- Надежные сеансы, использующих двойные каналы HTTP (например, с помощью `WsDualHttpBinding`) могут потребоваться дополнительные, чем предусмотрено по умолчанию два HTTP соединений на одного клиента. Это означает, что для дуплексного надежного сеанса может потребоваться до двух соединений в каждую сторону, поскольку приложения и протокола сообщений, одновременно могут передаваться каждую сторону в любой момент времени. При определенных условиях, в зависимости от шаблона обмена сообщениями службы это означает, что может вызвать взаимоблокировку службы веб сервере с помощью двойных каналов HTTP и надежных сеансов. Чтобы увеличить число допустимых HTTP-соединений на одного клиента, добавьте следующее в соответствующий файл конфигурации (например, *web.config* рассматриваемой службы):

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  Значение `maxconnection` атрибут — это количество требуемых соединений. В этом случае минимальное следует четыре подключения.
