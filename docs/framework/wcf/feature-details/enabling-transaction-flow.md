---
title: Включение потока транзакций
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], enabling flow
ms.assetid: a03f5041-5049-43f4-897c-e0292d4718f7
ms.openlocfilehash: 2443e82dd9c6d8b5447c2fa16b537a9feed8ddaf
ms.sourcegitcommit: 5ae5a1a9520b8b8b6164ad728d396717f30edafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "70895152"
---
# <a name="enabling-transaction-flow"></a><span data-ttu-id="a7571-102">Включение потока транзакций</span><span class="sxs-lookup"><span data-stu-id="a7571-102">Enabling Transaction Flow</span></span>
<span data-ttu-id="a7571-103">Windows Communication Foundation (WCF) предоставляет гибкие возможности для управления потоком транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-103">Windows Communication Foundation (WCF) provides highly flexible options for controlling transaction flow.</span></span> <span data-ttu-id="a7571-104">Параметры потока транзакций службы могут быть выражены посредством комбинации атрибутов и конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a7571-104">A service's transaction flow settings can be expressed using a combination of attributes and configuration.</span></span>  
  
## <a name="transaction-flow-settings"></a><span data-ttu-id="a7571-105">Параметры потока транзакций</span><span class="sxs-lookup"><span data-stu-id="a7571-105">Transaction Flow Settings</span></span>  
 <span data-ttu-id="a7571-106">Параметры потока транзакций создаются для конечной точки службы в результате пересечения следующих трех значений:</span><span class="sxs-lookup"><span data-stu-id="a7571-106">Transaction flow settings are generated for a service endpoint as a result of the intersection of the following three values:</span></span>  
  
- <span data-ttu-id="a7571-107">атрибута <xref:System.ServiceModel.TransactionFlowAttribute>, определенного для каждого метода в контракте службы;</span><span class="sxs-lookup"><span data-stu-id="a7571-107">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specified for each method in the service contract.</span></span>  
  
- <span data-ttu-id="a7571-108">свойства привязки `TransactionFlow` в конкретной привязке.</span><span class="sxs-lookup"><span data-stu-id="a7571-108">The `TransactionFlow` binding property in the specific binding.</span></span>  
  
- <span data-ttu-id="a7571-109">свойства привязки `TransactionFlowProtocol` в конкретной привязке.</span><span class="sxs-lookup"><span data-stu-id="a7571-109">The `TransactionFlowProtocol` binding property in the specific binding.</span></span> <span data-ttu-id="a7571-110">Свойство привязки `TransactionFlowProtocol` позволяет выбрать один из двух различных протоколов транзакций для передачи транзакции.</span><span class="sxs-lookup"><span data-stu-id="a7571-110">The `TransactionFlowProtocol` binding property enables you to choose among two different transaction protocols that you can use to flow a transaction.</span></span> <span data-ttu-id="a7571-111">Эти протоколы кратко описываются в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="a7571-111">The following sections briefly describe each of them.</span></span>  
  
### <a name="ws-atomictransaction-protocol"></a><span data-ttu-id="a7571-112">Протокол WS-AtomicTransaction</span><span class="sxs-lookup"><span data-stu-id="a7571-112">WS-AtomicTransaction Protocol</span></span>  
 <span data-ttu-id="a7571-113">В сценариях, требующих взаимодействия со сторонним стеком протоколов, удобно использовать протокол WS-AtomicTransaction (WS-AT).</span><span class="sxs-lookup"><span data-stu-id="a7571-113">The WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.</span></span>  
  
### <a name="oletransactions-protocol"></a><span data-ttu-id="a7571-114">Протокол OleTransactions</span><span class="sxs-lookup"><span data-stu-id="a7571-114">OleTransactions Protocol</span></span>  
 <span data-ttu-id="a7571-115">В сценариях, не требующих взаимодействия со сторонним стеком протоколов, когда специалисту, выполняющему развертывание приложения, известно, что служба протокола WS-AT отключена в данном местоположении или в топологии существующей сети предпочтительно не использовать протокол WS-AT, удобно использовать протокол OleTransactions.</span><span class="sxs-lookup"><span data-stu-id="a7571-115">The OleTransactions protocol is useful for scenarios when interoperability with third-party protocol stacks is not required, and the deployer of a service knows in advance that the WS-AT protocol service is disabled locally or the existing network topology does not favor the usage of WS-AT.</span></span>  
  
 <span data-ttu-id="a7571-116">В следующей таблице показаны типы потоков транзакций, которые можно создать, используя представленные различные комбинации.</span><span class="sxs-lookup"><span data-stu-id="a7571-116">The following table shows the different types of transaction flows that can be generated using these various combinations.</span></span>  
  
|<span data-ttu-id="a7571-117">TransactionFlow</span><span class="sxs-lookup"><span data-stu-id="a7571-117">TransactionFlow</span></span><br /><br /> <span data-ttu-id="a7571-118">привязка</span><span class="sxs-lookup"><span data-stu-id="a7571-118">binding</span></span>|<span data-ttu-id="a7571-119">Свойство привязки TransactionFlow</span><span class="sxs-lookup"><span data-stu-id="a7571-119">TransactionFlow binding property</span></span>|<span data-ttu-id="a7571-120">Протокол привязки TransactionFlowProtocol</span><span class="sxs-lookup"><span data-stu-id="a7571-120">TransactionFlowProtocol binding protocol</span></span>|<span data-ttu-id="a7571-121">Тип потока транзакций</span><span class="sxs-lookup"><span data-stu-id="a7571-121">Type of transaction flow</span></span>|  
|---------------------------------|--------------------------------------|----------------------------------------------|------------------------------|  
|<span data-ttu-id="a7571-122">Обязательный</span><span class="sxs-lookup"><span data-stu-id="a7571-122">Mandatory</span></span>|<span data-ttu-id="a7571-123">true</span><span class="sxs-lookup"><span data-stu-id="a7571-123">true</span></span>|<span data-ttu-id="a7571-124">WS-AT</span><span class="sxs-lookup"><span data-stu-id="a7571-124">WS-AT</span></span>|<span data-ttu-id="a7571-125">Транзакция должна передаваться в обеспечивающем возможность взаимодействия формате WS-AT.</span><span class="sxs-lookup"><span data-stu-id="a7571-125">Transaction must be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="a7571-126">Обязательный</span><span class="sxs-lookup"><span data-stu-id="a7571-126">Mandatory</span></span>|<span data-ttu-id="a7571-127">true</span><span class="sxs-lookup"><span data-stu-id="a7571-127">true</span></span>|<span data-ttu-id="a7571-128">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="a7571-128">OleTransactions</span></span>|<span data-ttu-id="a7571-129">Транзакция должна передаваться в формате WCF OleTransactions.</span><span class="sxs-lookup"><span data-stu-id="a7571-129">Transaction must be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="a7571-130">Обязательный</span><span class="sxs-lookup"><span data-stu-id="a7571-130">Mandatory</span></span>|<span data-ttu-id="a7571-131">False</span><span class="sxs-lookup"><span data-stu-id="a7571-131">false</span></span>|<span data-ttu-id="a7571-132">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="a7571-132">Not applicable</span></span>|<span data-ttu-id="a7571-133">Неприменима, так как это недопустимая конфигурация.</span><span class="sxs-lookup"><span data-stu-id="a7571-133">Not applicable because this is an invalid configuration.</span></span>|  
|<span data-ttu-id="a7571-134">Allowed</span><span class="sxs-lookup"><span data-stu-id="a7571-134">Allowed</span></span>|<span data-ttu-id="a7571-135">true</span><span class="sxs-lookup"><span data-stu-id="a7571-135">true</span></span>|<span data-ttu-id="a7571-136">WS-AT</span><span class="sxs-lookup"><span data-stu-id="a7571-136">WS-AT</span></span>|<span data-ttu-id="a7571-137">Транзакция может передаваться в обеспечивающем возможность взаимодействия формате WS-AT.</span><span class="sxs-lookup"><span data-stu-id="a7571-137">Transaction may be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="a7571-138">Allowed</span><span class="sxs-lookup"><span data-stu-id="a7571-138">Allowed</span></span>|<span data-ttu-id="a7571-139">true</span><span class="sxs-lookup"><span data-stu-id="a7571-139">true</span></span>|<span data-ttu-id="a7571-140">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="a7571-140">OleTransactions</span></span>|<span data-ttu-id="a7571-141">Транзакция может передаваться в формате WCF OleTransactions.</span><span class="sxs-lookup"><span data-stu-id="a7571-141">Transaction may be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="a7571-142">Allowed</span><span class="sxs-lookup"><span data-stu-id="a7571-142">Allowed</span></span>|<span data-ttu-id="a7571-143">False</span><span class="sxs-lookup"><span data-stu-id="a7571-143">false</span></span>|<span data-ttu-id="a7571-144">Любое значение</span><span class="sxs-lookup"><span data-stu-id="a7571-144">Any value</span></span>|<span data-ttu-id="a7571-145">Транзакция не передается.</span><span class="sxs-lookup"><span data-stu-id="a7571-145">A transaction is not flowed.</span></span>|  
|<span data-ttu-id="a7571-146">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a7571-146">NotAllowed</span></span>|<span data-ttu-id="a7571-147">Любое значение</span><span class="sxs-lookup"><span data-stu-id="a7571-147">Any value</span></span>|<span data-ttu-id="a7571-148">Любое значение</span><span class="sxs-lookup"><span data-stu-id="a7571-148">Any value</span></span>|<span data-ttu-id="a7571-149">Транзакция не передается.</span><span class="sxs-lookup"><span data-stu-id="a7571-149">A transaction is not flowed.</span></span>|  
  
 <span data-ttu-id="a7571-150">В следующей таблице приведены сводные результаты обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="a7571-150">The following table summarizes the message processing result.</span></span>  
  
|<span data-ttu-id="a7571-151">Входящее сообщение</span><span class="sxs-lookup"><span data-stu-id="a7571-151">Incoming message</span></span>|<span data-ttu-id="a7571-152">Параметры TransactionFlow</span><span class="sxs-lookup"><span data-stu-id="a7571-152">TransactionFlow setting</span></span>|<span data-ttu-id="a7571-153">Заголовок транзакции</span><span class="sxs-lookup"><span data-stu-id="a7571-153">Transaction header</span></span>|<span data-ttu-id="a7571-154">Результат обработки сообщения</span><span class="sxs-lookup"><span data-stu-id="a7571-154">Message processing result</span></span>|  
|----------------------|-----------------------------|------------------------|-------------------------------|  
|<span data-ttu-id="a7571-155">Транзакция соответствует ожидаемому формату протокола</span><span class="sxs-lookup"><span data-stu-id="a7571-155">Transaction matches expected protocol format</span></span>|<span data-ttu-id="a7571-156">Allowed или Mandatory</span><span class="sxs-lookup"><span data-stu-id="a7571-156">Allowed or Mandatory</span></span>|<span data-ttu-id="a7571-157">`MustUnderstand` равняется `true`.</span><span class="sxs-lookup"><span data-stu-id="a7571-157">`MustUnderstand` equals `true`.</span></span>|<span data-ttu-id="a7571-158">Процесс</span><span class="sxs-lookup"><span data-stu-id="a7571-158">Process</span></span>|  
|<span data-ttu-id="a7571-159">Транзакция не соответствует ожидаемому формату протокола</span><span class="sxs-lookup"><span data-stu-id="a7571-159">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="a7571-160">Обязательный</span><span class="sxs-lookup"><span data-stu-id="a7571-160">Mandatory</span></span>|<span data-ttu-id="a7571-161">`MustUnderstand` равняется `false`.</span><span class="sxs-lookup"><span data-stu-id="a7571-161">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a7571-162">Отклонена, так как требуется транзакция</span><span class="sxs-lookup"><span data-stu-id="a7571-162">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="a7571-163">Транзакция не соответствует ожидаемому формату протокола</span><span class="sxs-lookup"><span data-stu-id="a7571-163">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="a7571-164">Allowed</span><span class="sxs-lookup"><span data-stu-id="a7571-164">Allowed</span></span>|<span data-ttu-id="a7571-165">`MustUnderstand` равняется `false`.</span><span class="sxs-lookup"><span data-stu-id="a7571-165">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a7571-166">Отклонена, так как заголовок не распознан</span><span class="sxs-lookup"><span data-stu-id="a7571-166">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="a7571-167">Транзакция, использующая любой формат протокола</span><span class="sxs-lookup"><span data-stu-id="a7571-167">Transaction using any protocol format</span></span>|<span data-ttu-id="a7571-168">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a7571-168">NotAllowed</span></span>|<span data-ttu-id="a7571-169">`MustUnderstand` равняется `false`.</span><span class="sxs-lookup"><span data-stu-id="a7571-169">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a7571-170">Отклонена, так как заголовок не распознан</span><span class="sxs-lookup"><span data-stu-id="a7571-170">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="a7571-171">Транзакция отсутствует</span><span class="sxs-lookup"><span data-stu-id="a7571-171">No transaction</span></span>|<span data-ttu-id="a7571-172">Обязательный</span><span class="sxs-lookup"><span data-stu-id="a7571-172">Mandatory</span></span>|<span data-ttu-id="a7571-173">Н/Д</span><span class="sxs-lookup"><span data-stu-id="a7571-173">N/A</span></span>|<span data-ttu-id="a7571-174">Отклонена, так как требуется транзакция</span><span class="sxs-lookup"><span data-stu-id="a7571-174">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="a7571-175">Транзакция отсутствует</span><span class="sxs-lookup"><span data-stu-id="a7571-175">No transaction</span></span>|<span data-ttu-id="a7571-176">Allowed</span><span class="sxs-lookup"><span data-stu-id="a7571-176">Allowed</span></span>|<span data-ttu-id="a7571-177">Н/Д</span><span class="sxs-lookup"><span data-stu-id="a7571-177">N/A</span></span>|<span data-ttu-id="a7571-178">Процесс</span><span class="sxs-lookup"><span data-stu-id="a7571-178">Process</span></span>|  
|<span data-ttu-id="a7571-179">Транзакция отсутствует</span><span class="sxs-lookup"><span data-stu-id="a7571-179">No transaction</span></span>|<span data-ttu-id="a7571-180">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a7571-180">NotAllowed</span></span>|<span data-ttu-id="a7571-181">Н/Д</span><span class="sxs-lookup"><span data-stu-id="a7571-181">N/A</span></span>|<span data-ttu-id="a7571-182">Процесс</span><span class="sxs-lookup"><span data-stu-id="a7571-182">Process</span></span>|  
  
 <span data-ttu-id="a7571-183">Хотя у каждого метода в контракте могут быть разные требования к потоку транзакций, параметр протокола передачи транзакций действует на уровне привязки.</span><span class="sxs-lookup"><span data-stu-id="a7571-183">While each method on a contract can have different transaction flow requirements, the transaction flow protocol setting is scoped at the level of the binding.</span></span> <span data-ttu-id="a7571-184">Это означает, что во всех методах, использующих совместно одну и ту же конечную точку (и, таким образом, одну и ту же привязку), применяется одна и та же политика, в соответствии с которой разрешена или необходима передача транзакций, так же как и тот же протокол транзакций, если применимо.</span><span class="sxs-lookup"><span data-stu-id="a7571-184">This means that all methods that share the same endpoint (and therefore the same binding) also share the same policy allowing or requiring transaction flow, as well as the same transaction protocol if applicable.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-method-level"></a><span data-ttu-id="a7571-185">Включение потока транзакций на уровне метода</span><span class="sxs-lookup"><span data-stu-id="a7571-185">Enabling Transaction Flow at the Method Level</span></span>  
 <span data-ttu-id="a7571-186">Требования потока транзакций не всегда одинаковы для всех методов в контракте службы.</span><span class="sxs-lookup"><span data-stu-id="a7571-186">Transaction flow requirements are not always the same for all methods in a service contract.</span></span> <span data-ttu-id="a7571-187">Таким образом, WCF также предоставляет механизм на основе атрибутов, позволяющий выражать параметры потока транзакций для каждого метода.</span><span class="sxs-lookup"><span data-stu-id="a7571-187">Therefore, WCF also provides an attribute-based mechanism to allow each method's transaction flow preferences to be expressed.</span></span> <span data-ttu-id="a7571-188">Это обеспечивается посредством атрибута <xref:System.ServiceModel.TransactionFlowAttribute>, задающего уровень, на котором операция службы принимает заголовок транзакции.</span><span class="sxs-lookup"><span data-stu-id="a7571-188">This is achieved by the <xref:System.ServiceModel.TransactionFlowAttribute> that specifies the level in which a service operation accepts a transaction header.</span></span> <span data-ttu-id="a7571-189">Для включения потока транзакций необходимо пометить методы контракта службы этим атрибутом.</span><span class="sxs-lookup"><span data-stu-id="a7571-189">You should mark your service contract methods with this attribute if you want to enable transaction flow.</span></span> <span data-ttu-id="a7571-190">Этот атрибут принимает одно из значений перечисления <xref:System.ServiceModel.TransactionFlowOption>, в котором значением по умолчанию является <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span><span class="sxs-lookup"><span data-stu-id="a7571-190">This attribute takes one of the values of the <xref:System.ServiceModel.TransactionFlowOption> enumeration, in which the default value is <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span> <span data-ttu-id="a7571-191">Если задано какое-либо значение, отличное от <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>, требуется, чтобы метод был не односторонним.</span><span class="sxs-lookup"><span data-stu-id="a7571-191">If any value except <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> is specified, the method is required to not be one-way.</span></span> <span data-ttu-id="a7571-192">Разработчик может использовать этот атрибут для задания требований или ограничений потока транзакций на уровне метода во время разработки.</span><span class="sxs-lookup"><span data-stu-id="a7571-192">A developer can use this attribute to specify method-level transaction flow requirements or constraints at design time.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-endpoint-level"></a><span data-ttu-id="a7571-193">Включение потока транзакций на уровне конечной точки</span><span class="sxs-lookup"><span data-stu-id="a7571-193">Enabling Transaction Flow at the Endpoint Level</span></span>  
 <span data-ttu-id="a7571-194">В дополнение к потоку <xref:System.ServiceModel.TransactionFlowAttribute> транзакций уровня метода, предоставляемому атрибутом, WCF предоставляет параметр на уровне конечной точки для потока транзакций, позволяющий администраторам управлять потоком транзакций на более высоком уровне.</span><span class="sxs-lookup"><span data-stu-id="a7571-194">In addition to the method-level transaction flow setting  the <xref:System.ServiceModel.TransactionFlowAttribute> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level.</span></span>  
  
 <span data-ttu-id="a7571-195">Это обеспечивается элементом <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, который позволяет включить или отключить входящий поток транзакций в параметрах привязки конечной точки, а также задать необходимый формат протокола транзакций для входящих транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-195">This is achieved by the <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions.</span></span>  
  
 <span data-ttu-id="a7571-196">Если поток транзакций привязки выключен, но для выполнения одной из операций в контракте службы требуется входящая транзакция, при запуске службы вызывается исключение проверки.</span><span class="sxs-lookup"><span data-stu-id="a7571-196">If the binding has disabled transaction flow, but one of the operations on a service contract requires an incoming transaction, then a validation exception is thrown at service startup.</span></span>  
  
 <span data-ttu-id="a7571-197">Большая часть фиксированных привязок WCF предоставляет `transactionFlow` атрибуты и `transactionProtocol` , позволяющие настроить конкретную привязку для приема входящих транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-197">Most of the standing bindings WCF provides contain the `transactionFlow` and `transactionProtocol` attributes to enable you to configure the specific binding to accept incoming transactions.</span></span> <span data-ttu-id="a7571-198">Дополнительные сведения о настройке элементов конфигурации см. в разделе [ \<Binding >](../../../../docs/framework/misc/binding.md).</span><span class="sxs-lookup"><span data-stu-id="a7571-198">For more information about setting the configuration elements, see [\<binding>](../../../../docs/framework/misc/binding.md).</span></span>  
  
 <span data-ttu-id="a7571-199">Администратор или разработчик могут использовать поток транзакций уровня конечной точки для настройки на этапе разработки требований или ограничений для потока транзакций с помощью файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a7571-199">An administrator or deployer can use endpoint-level transaction flow to configure transaction flow requirements or constraints at deployment time using the configuration file.</span></span>  
  
## <a name="security"></a><span data-ttu-id="a7571-200">Безопасность</span><span class="sxs-lookup"><span data-stu-id="a7571-200">Security</span></span>  
 <span data-ttu-id="a7571-201">Для обеспечения безопасности и целостности системы необходимо обеспечить безопасный обмен сообщениями при передаче транзакций между приложениями.</span><span class="sxs-lookup"><span data-stu-id="a7571-201">To ensure system security and integrity, you must secure message exchanges when flowing transactions between applications.</span></span> <span data-ttu-id="a7571-202">Не следует передавать или раскрывать сведения о транзакции никакому приложению, не имеющему разрешения на участие в данной транзакции.</span><span class="sxs-lookup"><span data-stu-id="a7571-202">You should not flow or disclose transaction details to any application that is not entitled to participate in the same transaction.</span></span>  
  
 <span data-ttu-id="a7571-203">При создании клиентов WCF для неизвестных или ненадежных веб-служб с помощью обмена метаданными вызовы операций для этих веб-служб должны подавлять текущую транзакцию по возможности.</span><span class="sxs-lookup"><span data-stu-id="a7571-203">When generating WCF clients to unknown or untrusted Web services through the use of metadata exchange, calls to operations on these Web services should suppress the current transaction if possible.</span></span> <span data-ttu-id="a7571-204">В следующем примере показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="a7571-204">The following example demonstrates how to do this.</span></span>  
  
```csharp
//client code which has an ambient transaction  
using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Suppress))  
{  
    // No transaction will flow to this operation  
    untrustedProxy.Operation1(...);  
    scope.Complete();  
}  
//remainder of client code  
```  
  
 <span data-ttu-id="a7571-205">Кроме того, службы должны быть настроены таким образом, что они принимают входящие транзакции только от прошедших проверку подлинности и авторизованных клиентов.</span><span class="sxs-lookup"><span data-stu-id="a7571-205">In addition, services should be configured to accept incoming transactions only from clients that they have authenticated and authorized.</span></span> <span data-ttu-id="a7571-206">Входящие транзакции должны приниматься только от клиентов высокого уровня доверия.</span><span class="sxs-lookup"><span data-stu-id="a7571-206">Incoming transactions should only be accepted if they come from highly trusted clients.</span></span>  
  
## <a name="policy-assertions"></a><span data-ttu-id="a7571-207">Утверждения политики</span><span class="sxs-lookup"><span data-stu-id="a7571-207">Policy Assertions</span></span>  
 <span data-ttu-id="a7571-208">WCF использует утверждения политики для управления потоком транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-208">WCF uses policy assertions to control transaction flow.</span></span> <span data-ttu-id="a7571-209">Утверждения политики описаны в документе о политике службы, агрегируемом с помощью добавления контрактов, конфигурации и атрибутов.</span><span class="sxs-lookup"><span data-stu-id="a7571-209">Policy assertions can be found in a service’s policy document, which is generated by aggregating contracts, configuration, and attributes.</span></span> <span data-ttu-id="a7571-210">Клиент может получить документ о политике службы с помощью запроса-ответа HTTP GET или WS-MetadataExchange.</span><span class="sxs-lookup"><span data-stu-id="a7571-210">The client can obtain the service’s policy document using an HTTP GET or a WS-MetadataExchange request-reply.</span></span> <span data-ttu-id="a7571-211">Клиенты затем могут обработать документ о политике, определив, для каких операций в контракте службы может поддерживаться или требуется поток транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-211">Clients can then process the policy document to determine which operations on a service contract may support or require transaction flow.</span></span>  
  
 <span data-ttu-id="a7571-212">Утверждения политики потока транзакций влияют на поток транзакций, указывая заголовки протокола SOAP, которые должны посылаться клиентом службе для представления транзакции.</span><span class="sxs-lookup"><span data-stu-id="a7571-212">Transaction flow policy assertions affect transaction flow by specifying the SOAP headers that a client should send to a service to represent a transaction.</span></span> <span data-ttu-id="a7571-213">Все заголовки транзакций должны быть помечены `MustUnderstand` равняется `true`.</span><span class="sxs-lookup"><span data-stu-id="a7571-213">All transaction headers must be marked with `MustUnderstand` equal to `true`.</span></span> <span data-ttu-id="a7571-214">Любое сообщение с заголовком, помеченным иначе, отклоняется с ошибкой SOAP.</span><span class="sxs-lookup"><span data-stu-id="a7571-214">Any message with a header marked otherwise is rejected with a SOAP fault.</span></span>  
  
 <span data-ttu-id="a7571-215">В одной операции может присутствовать только одно утверждение политики транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-215">Only one transaction-related policy assertion can be present on a single operation.</span></span> <span data-ttu-id="a7571-216">Документы политики с более чем одним утверждением транзакций в операции считаются недопустимыми и отклоняются WCF.</span><span class="sxs-lookup"><span data-stu-id="a7571-216">Policy documents with more than one transaction assertion on an operation are considered invalid and are rejected by WCF.</span></span> <span data-ttu-id="a7571-217">Кроме того, в каждом типе порта может присутствовать только один протокол транзакций.</span><span class="sxs-lookup"><span data-stu-id="a7571-217">In addition, only a single transaction protocol can be present inside each port type.</span></span> <span data-ttu-id="a7571-218">Документы политики с операциями, ссылающимися на несколько протоколов транзакций внутри одного типа портов, считаются недопустимыми и отклоняются [средством служебной программы метаданных ServiceModel (Svcutil. exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="a7571-218">Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="a7571-219">Документы политики, имеющие утверждения о транзакции в выходных сообщениях или односторонних входных сообщениях, также считаются недействительными.</span><span class="sxs-lookup"><span data-stu-id="a7571-219">Policy documents with transaction assertions present on output messages or one-way input messages are also considered invalid.</span></span>
