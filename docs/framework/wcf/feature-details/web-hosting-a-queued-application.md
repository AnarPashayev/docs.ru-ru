---
title: Размещение веб-узлов в приложении, использующем очереди
ms.date: 03/30/2017
ms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88
ms.openlocfilehash: c44a6b5059f5294646d95b4281dcf7845b369929
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59126026"
---
# <a name="web-hosting-a-queued-application"></a>Размещение веб-узлов в приложении, использующем очереди
Служба активации процессов Windows (WAS) управляет активацией и временем существования рабочих процессов, содержащих приложения, размещения служб Windows Communication Foundation (WCF). Модель процесса WAS обобщает модель процесса [!INCLUDE[iis601](../../../../includes/iis601-md.md)] для HTTP-сервера путем устранения зависимости от HTTP. Это позволяет службам WCF использовать как HTTP, так и отличные от HTTP протоколы, такие как net.msmq и msmq.formatname, в среде размещения, которая поддерживает активацию на основе сообщений и предоставляет возможность размещать большое количество приложений на данном компьютере.  
  
 WAS содержит службу активации очереди сообщений (MSMQ), которая активирует приложение с использованием очередей, где одно или более сообщений ставятся в очередь сообщений MSMQ, одну из очередей, используемых приложением. Служба активации MSMQ является службой NT, запускающейся по умолчанию автоматически.  
  
 Дополнительные сведения о WAS и ее преимуществах см. в разделе [размещение в службе активации процессов Windows](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md). Дополнительные сведения о MSMQ, см. в разделе [Общие сведения об очередях](../../../../docs/framework/wcf/feature-details/queues-overview.md).
  
## <a name="queue-addressing-in-was"></a>Адресация очереди в WAS  
 Приложения WAS имеют адреса в виде универсальных кодов ресурсов (URI). Адреса приложений состоят из двух частей: основной префикс URI и относительный адрес, специальный для каждого приложения (путь). Вместе эти две части показывают внешний адрес приложения. Базовый префикс URI создается из привязки узла и используется для всех приложений на узле, например, «NET.MSMQ://localhost», «MSMQ.FormatName://localhost» или «NET.TCP://localhost». Адреса приложений формируются путем фрагментов пути конкретного приложения (например, «/ applicationOne») и добавления их к базовому URI префиксов для получения полного URI приложения, например, «NET.MSMQ://localhost/applicationone».  
  
 Служба активации MSMQ использует URI приложения для проверки соответствия с очередью, сообщения которой служба активации MSMQ должна контролировать. При запуске служба активации MSMQ перечисляет все общие и частные очереди на компьютере, с которого она их получает согласно настройкам конфигурации, и отслеживает наличие в них сообщений. Служба активации MSMQ обновляет список очередей для проверки каждые 10 минут. Если в очереди найдено сообщение, служба активации проверяет соответствие имени очереди и самого длинного согласующегося URI для привязки net.msmq и активирует приложение.  
  
> [!NOTE]
>  Активируемое приложение должно соответствовать (иметь самый длинный согласующийся код) префиксу имени очереди.  
  
 Например, имя очереди: msmqWebHost/orderProcessing/service.svc. Если приложение 1 имеет виртуальный каталог /msmqWebHost/orderProcessing с файлом service.svc в нем, а приложение 2 имеет виртуальный каталог /msmqWebHost с orderProcessing.svc в нем, активируется приложение 1. Если приложение 1 удалено, активируется приложение 2.  
  
> [!NOTE]
>  При создании очереди ни одно сообщение из всех отправленных в очередь не активирует приложение до тех пор, пока служба активации MSMQ не обновит список очередей, что произойдет максимум через 10 минут после создания очереди. При повторном запуске службы активации список очередей также обновляется.  
  
### <a name="the-effect-of-private-and-public-queues-on-addressing"></a>Влияние общих и частных очередей на адресацию  
 Служба активизации MSMQ не делает различий между мониторингом частных и общих очередей. В принципе, общая и частная очереди не могут иметь одинаковых имен. Но, если это так, приложение, размещенное на веб-сервере, может быть активировано чтением сообщения из любой из очередей.  
  
### <a name="queue-configuration-for-activation"></a>Конфигурация очереди для активации  
 Служба активации MSMQ работает как NETWORK SERVICE. Это служба, осуществляющая мониторинг очередей для активации приложений. Для того, чтобы служба активировала приложения из очереди, очередь должна быть доступна NETWORK SERVICE для просмотра сообщений в списке управления доступом (ACL).  
  
### <a name="poison-messaging"></a>Подозрительные сообщения  
 Обработка подозрительных сообщений в WCF обрабатывается каналом, который не только обнаруживает подозрительное сообщение, но также предпринимает в зависимости от конфигурации пользователя. В результате, в очереди находится одно сообщение. Приложение, размещающееся на веб-сервере, прерывает последующие попытки, и сообщение перемещается в очередь повторного выполнения. В момент истечения времени цикла повторного выполнения сообщение перемещается из очереди повторного выполнения в главную очередь для повторной попытки. Однако, чтобы это произошло, канал в очереди должен быть активным. Если цикл в приложении задает WAS, сообщение остается в очереди повторного выполнения до тех пор, пока в основную очередь не поступит другое сообщение, активирующее приложение в очереди. Обходным путем в этом случае является перемещение сообщения вручную из очереди повторного выполнения обратно в основную очередь для повторной активации приложения.  
  
### <a name="subqueue-and-system-queue-caveat"></a>Вложенная очередь и недостаток системных очередей  
 Приложение, размещенное WAS не может быть активировано посредством сообщений из системных очередей, таких как общесистемная очередь недоставленных сообщений или вложенных очередей, таких как вложенные очереди подозрительных сообщений. Это ограничение для данной версии продукта.  
  
## <a name="see-also"></a>См. также

- [Обработка подозрительных сообщений](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)
- [Конечные точки служб и адресация очереди](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)
