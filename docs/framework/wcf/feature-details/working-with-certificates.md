---
title: Работа с сертификатами
description: Дополнительные сведения о функциях цифровых сертификатов X. 509 и их использовании в WCF. Ресурсы в этой статье помогут вам объяснить эти концепции.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- certificates [WCF]
ms.assetid: 6ffb8682-8f07-4a45-afbb-8d2487e9dbc3
ms.openlocfilehash: a12e723c763cdc3b9cf2105df9d0ee601f8bda1a
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2020
ms.locfileid: "90559022"
---
# <a name="working-with-certificates"></a><span data-ttu-id="ef3c6-104">Работа с сертификатами</span><span class="sxs-lookup"><span data-stu-id="ef3c6-104">Working with Certificates</span></span>

<span data-ttu-id="ef3c6-105">Для программирования безопасности Windows Communication Foundation (WCF) обычно используются цифровые сертификаты X.509, с помощью которых выполняется проверка подлинности клиентов и серверов, шифрование и создание цифровой подписи для сообщений.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-105">To program Windows Communication Foundation (WCF) security, X.509 digital certificates are commonly used to authenticate clients and servers, encrypt, and digitally sign messages.</span></span> <span data-ttu-id="ef3c6-106">В этом разделе содержится краткое описание возможностей для работы с цифровыми сертификатами X.509 и порядка использования этих возможностей в WCF. Кроме того, этот раздел включает ссылки на другие разделы с более подробным объяснением основных понятий и порядка выполнения общих задач с использованием WCF и сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-106">This topic briefly explains X.509 digital certificate features and how to use them in WCF, and includes links to topics that explain these concepts further or that show how to accomplish common tasks using WCF and certificates.</span></span>

<span data-ttu-id="ef3c6-107">Вкратце, цифровой сертификат является частью *инфраструктуры открытых ключей* (PKI), представляющей собой систему цифровых сертификатов, центров сертификации и других центров регистрации, которые используются для проверки подлинности каждой стороны, участвующей в электронной транзакции, посредством использования шифрования с открытым ключом.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-107">In brief, a digital certificate is a part of a *public key infrastructure* (PKI), which is a system of digital certificates, certificate authorities, and other registration authorities that verify and authenticate the validity of each party involved in an electronic transaction through the use of public key cryptography.</span></span> <span data-ttu-id="ef3c6-108">Сертификаты выдаются центрами сертификации, и каждый сертификат имеет набор полей, в которых содержатся такие данные, как *субъект* (сущность, которой выдается сертификат), срок действия (период времени, в течение которого сертификат является действительным), издатель (лицо, выдавшее сертификат) и открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-108">A certification authority issues certificates and each certificate has a set of fields that contain data, such as *subject* (the entity to which the certificate is issued), validity dates (when the certificate is valid), issuer (the entity that issued the certificate), and a public key.</span></span> <span data-ttu-id="ef3c6-109">В WCF каждое из этих свойств обрабатывается как утверждение <xref:System.IdentityModel.Claims.Claim>, и каждое утверждение затем подразделяется на два типа: удостоверение и право.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-109">In WCF, each of these properties is processed as a <xref:System.IdentityModel.Claims.Claim>, and each claim is further divided into two types: identity and right.</span></span> <span data-ttu-id="ef3c6-110">Дополнительные сведения о сертификатах X.509 см. в разделе [Сертификаты открытого ключа X.509](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-110">For more information about X.509 certificates see [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span></span> <span data-ttu-id="ef3c6-111">Дополнительные сведения об утверждениях и авторизации в WCF см. в разделе [Управление утверждениями и авторизацией с помощью модели удостоверения](managing-claims-and-authorization-with-the-identity-model.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-111">For more information about Claims and Authorization in WCF see [Managing Claims and Authorization with the Identity Model](managing-claims-and-authorization-with-the-identity-model.md).</span></span> <span data-ttu-id="ef3c6-112">Дополнительные сведения о реализации PKI см. в статье [Enterprise PKI с Windows Server 2012 R2 Active Directory Certificate Services](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-112">For more information about implementing a PKI, see [Enterprise PKI with Windows Server 2012 R2 Active Directory Certificate Services](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span></span>

<span data-ttu-id="ef3c6-113">Основной функцией сертификата является удостоверение подлинности владельца сертификата для других сторон.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-113">The primary function of a certificate is to authenticate the identity of the owner of the certificate to others.</span></span> <span data-ttu-id="ef3c6-114">В сертификате содержится *открытый ключ* владельца, в то время как закрытый ключ хранится у владельца.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-114">A certificate contains the *public key* of the owner, while the owner retains the private key.</span></span> <span data-ttu-id="ef3c6-115">Открытый ключ можно использовать для зашифровывания сообщений, передаваемых владельцу сертификата.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-115">The public key can be used to encrypt messages sent to the owner of the certificate.</span></span> <span data-ttu-id="ef3c6-116">Доступ к закрытому ключу имеет только владелец сертификата, поэтому только он может расшифровать эти сообщения.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-116">Only the owner has access to the private key, so only the owner can decrypt those messages.</span></span>

<span data-ttu-id="ef3c6-117">Сертификаты должны выдаваться центром сертификации, который обычно является сторонним издателем сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-117">Certificates must be issued by a certification authority, which is often a third-party  issuer of certificates.</span></span> <span data-ttu-id="ef3c6-118">Домен Windows содержит центр сертификации, который можно использовать для выдачи сертификатов компьютерам домена.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-118">On a Windows domain, a certification authority is included that can be used to issue certificates to computers on the domain.</span></span>

## <a name="viewing-certificates"></a><span data-ttu-id="ef3c6-119">Просмотр сертификатов</span><span class="sxs-lookup"><span data-stu-id="ef3c6-119">Viewing Certificates</span></span>

<span data-ttu-id="ef3c6-120">При работе с сертификатами зачастую необходимо просматривать их и проверять определенные свойства.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-120">To work with certificates, it is often necessary to view them and examine their properties.</span></span> <span data-ttu-id="ef3c6-121">Это легко выполняется с помощью консоли управления (MMC).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-121">This is easily done with the Microsoft Management Console (MMC) snap-in tool.</span></span> <span data-ttu-id="ef3c6-122">Дополнительные сведения см. в разделе [Практическое руководство. Просмотр сертификатов с помощью оснастки MMC](how-to-view-certificates-with-the-mmc-snap-in.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-122">For more information, see [How to: View Certificates with the MMC Snap-in](how-to-view-certificates-with-the-mmc-snap-in.md).</span></span>

## <a name="certificate-stores"></a><span data-ttu-id="ef3c6-123">Хранилища сертификатов</span><span class="sxs-lookup"><span data-stu-id="ef3c6-123">Certificate Stores</span></span>

<span data-ttu-id="ef3c6-124">Сертификаты хранятся в хранилищах.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-124">Certificates are found in stores.</span></span> <span data-ttu-id="ef3c6-125">Существует два основных хранилища, которые подразделяются на вложенные хранилища.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-125">Two major store locations exist that are further divided into sub-stores.</span></span> <span data-ttu-id="ef3c6-126">Администратор компьютера может просматривать оба основных хранилища с помощью средства MMC.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-126">If you are the administrator on a computer, you can view both major stores by using the MMC snap-in tool.</span></span> <span data-ttu-id="ef3c6-127">Пользователи, не являющиеся администраторами, могут просматривать только хранилище текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-127">Non-administrators can view only the current user store.</span></span>

- <span data-ttu-id="ef3c6-128">**Хранилище локального компьютера**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-128">**The local machine store**.</span></span> <span data-ttu-id="ef3c6-129">Он содержит сертификаты, к которым обращаются машинные процессы, например ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-129">This contains the certificates accessed by machine processes, such as ASP.NET.</span></span> <span data-ttu-id="ef3c6-130">Это расположение используется для хранения сертификатов, удостоверяющих подлинность сервера для клиентов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-130">Use this location to store certificates that authenticate the server to clients.</span></span>

- <span data-ttu-id="ef3c6-131">**Хранилище текущего пользователя**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-131">**The current user store**.</span></span> <span data-ttu-id="ef3c6-132">Интерактивные приложения обычно помещают сертификаты в это хранилище для текущего пользователя компьютера.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-132">Interactive applications typically place certificates here for the computer's current user.</span></span> <span data-ttu-id="ef3c6-133">В случае клиентского приложения в это хранилище обычно помещаются сертификаты, используемые для проверки подлинности пользователя при подключении к службе.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-133">If you are creating a client application, this is where you typically place certificates that authenticate a user to a service.</span></span>

<span data-ttu-id="ef3c6-134">Эти два хранилища подразделяются на вложенные хранилища.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-134">These two stores are further divided into sub-stores.</span></span> <span data-ttu-id="ef3c6-135">Ниже представлены наиболее важные вложенные хранилища, используемые при программировании с помощью WCF.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-135">The most important of these when programming with WCF include:</span></span>

- <span data-ttu-id="ef3c6-136">**Доверенные корневые центры сертификации**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-136">**Trusted Root Certification Authorities**.</span></span> <span data-ttu-id="ef3c6-137">Сертификаты из этого хранилища можно использовать для создания цепочки сертификатов, которую можно проследить до сертификата центра сертификации в этом хранилище.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-137">You can use the certificates in this store to create a chain of certificates, which can be traced back to a certification authority certificate in this store.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ef3c6-138">Локальный компьютер полностью доверяет любому сертификату, помещенному в это хранилище, даже если он поступил не из доверенного стороннего центра сертификации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-138">The local computer implicitly trusts any certificate placed in this store, even if the certificate does not come from a trusted third-party certification authority.</span></span> <span data-ttu-id="ef3c6-139">Поэтому в данное хранилище не следует помещать сертификаты, к издателям которых нет полного доверия, или если последствия не до конца ясны.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-139">For this reason, do not place any certificate into this store unless you fully trust the issuer and understand the consequences.</span></span>

- <span data-ttu-id="ef3c6-140">**Личное**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-140">**Personal**.</span></span> <span data-ttu-id="ef3c6-141">Это хранилище используется для хранения сертификатов, связанных с пользователем компьютера.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-141">This store is used for certificates associated with a user of a computer.</span></span> <span data-ttu-id="ef3c6-142">Обычно в этом хранилище хранятся сертификаты, выданные одним из центров сертификации, сертификаты которых находятся в хранилище «Доверенные корневые центры сертификации».</span><span class="sxs-lookup"><span data-stu-id="ef3c6-142">Typically this store is used for certificates issued by one of the certification authority certificates found in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="ef3c6-143">С другой стороны, сертификат, находящийся в этом хранилище, может быть самостоятельно выданным, и ему будет доверять приложение.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-143">Alternatively, a certificate found here may be self-issued and trusted by an application.</span></span>

<span data-ttu-id="ef3c6-144">Дополнительные сведения о хранилищах сертификатов см. в разделе [Хранилища сертификатов](/windows/desktop/secauthn/certificate-stores).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-144">For more information about certificate stores, see [Certificate Stores](/windows/desktop/secauthn/certificate-stores).</span></span>

### <a name="selecting-a-store"></a><span data-ttu-id="ef3c6-145">Выбор хранилища</span><span class="sxs-lookup"><span data-stu-id="ef3c6-145">Selecting a Store</span></span>

<span data-ttu-id="ef3c6-146">Выбор расположения для хранения сертификата зависит от режима и места выполнения клиента или службы.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-146">Selecting where to store a certificate depends how and when the service or client runs.</span></span> <span data-ttu-id="ef3c6-147">Действуют следующие общие правила.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-147">The following general rules apply:</span></span>

- <span data-ttu-id="ef3c6-148">Если служба WCF размещается в службе Windows, используйте хранилище **локального компьютера**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-148">If the WCF service is hosted in a Windows service use the **local machine** store.</span></span> <span data-ttu-id="ef3c6-149">Обратите внимание, что для установки сертификатов в хранилище локального компьютера требуются привилегии администратора.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-149">Note that administrator privileges are required to install certificates into the local machine store.</span></span>

- <span data-ttu-id="ef3c6-150">Если служба или клиент является приложением, выполняющимся от имени учетной записи пользователя, используйте хранилище **текущего пользователя**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-150">If the service or client is an application that runs under a user account, then use the **current user** store.</span></span>

### <a name="accessing-stores"></a><span data-ttu-id="ef3c6-151">Доступ к хранилищам</span><span class="sxs-lookup"><span data-stu-id="ef3c6-151">Accessing Stores</span></span>

<span data-ttu-id="ef3c6-152">Хранилища защищаются с помощью списков управления доступом (ACL) аналогично папкам на компьютере.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-152">Stores are protected by access control lists (ACLs), just like folders on a computer.</span></span> <span data-ttu-id="ef3c6-153">При создании службы, размещенной службы IIS (IIS), процесс ASP.NET выполняется в учетной записи ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-153">When creating a service hosted by Internet Information Services (IIS), the ASP.NET process runs under the ASP.NET account.</span></span> <span data-ttu-id="ef3c6-154">Эта учетная запись должна иметь доступ к хранилищу, в котором содержатся используемые службой сертификаты.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-154">That account must have access to the store that contains the certificates a service uses.</span></span> <span data-ttu-id="ef3c6-155">Каждое основное хранилище защищается с помощью списка управления доступом по умолчанию, однако списки можно изменять.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-155">Each of the major stores is protected with a default access list, but the lists can be modified.</span></span> <span data-ttu-id="ef3c6-156">При создании отдельной роли для доступа к хранилищу необходимо предоставить ей разрешение на доступ.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-156">If you create a separate role to access a store, you must grant that role access permission.</span></span> <span data-ttu-id="ef3c6-157">Сведения о том, как изменить список доступа с помощью средства WinHttpCertConfig.exe, см. в разделе [Практическое руководство. Создание временных сертификатов для использования во время разработки](how-to-create-temporary-certificates-for-use-during-development.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-157">To learn how to modify the access list using the WinHttpCertConfig.exe tool, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="chain-trust-and-certificate-authorities"></a><span data-ttu-id="ef3c6-158">Цепочка доверия и центры сертификации</span><span class="sxs-lookup"><span data-stu-id="ef3c6-158">Chain Trust and Certificate Authorities</span></span>

<span data-ttu-id="ef3c6-159">Сертификаты создаются в иерархии, где каждый отдельный сертификат связан с выдавшим его органом сертификации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-159">Certificates are created in a hierarchy where each individual certificate is linked to the CA that issued the certificate.</span></span> <span data-ttu-id="ef3c6-160">Эта ссылка указывает на сертификат органа сертификации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-160">This link is to the CA’s certificate.</span></span> <span data-ttu-id="ef3c6-161">Затем сертификат ЦС связывается с центром сертификации, который выдал сертификат исходного ЦС.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-161">The CA’s certificate then links to the CA that issued the original CA’s certificate.</span></span> <span data-ttu-id="ef3c6-162">Процесс повторяется до тех пор, пока не будет достигнут корневой сертификат органа сертификации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-162">This process is repeated up until the Root CA’s certificate is reached.</span></span> <span data-ttu-id="ef3c6-163">Сертификат корневого органа сертификации является изначально доверенным.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-163">The Root CA’s certificate is inherently trusted.</span></span>

<span data-ttu-id="ef3c6-164">Цифровые сертификаты используются для удостоверения подлинности сущности на основе этой иерархии, которая также называется *цепочкой сертификатов*.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-164">Digital certificates are used to authenticate an entity by relying on this hierarchy, also called a *chain of trust*.</span></span> <span data-ttu-id="ef3c6-165">Вы можете просмотреть цепочку сертификатов с помощью оснастки MMC, дважды щелкнув любой сертификат, а затем перейдя на вкладку **путь к сертификату** . Дополнительные сведения об импорте цепочек сертификатов для центра сертификации см. в разделе [инструкции. Указание цепочки сертификатов центра сертификации, используемой для проверки подписей](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-165">You can view any certificate's chain using the MMC snap-in by double-clicking any certificate, then clicking the **Certificate Path** tab. For more information about importing certificate chains for a Certification authority, see [How to: Specify the Certificate Authority Certificate Chain Used to Verify Signatures](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ef3c6-166">Любой издатель может быть сделан доверенным корневым центром; для этого необходимо поместить сертификат издателя в хранилище сертификатов доверенных корневых центров.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-166">Any issuer can be designated a trusted root authority by placing the issuer's certificate in the trusted root authority certificate store.</span></span>

### <a name="disabling-chain-trust"></a><span data-ttu-id="ef3c6-167">Отключение механизма проверки цепочки доверия</span><span class="sxs-lookup"><span data-stu-id="ef3c6-167">Disabling Chain Trust</span></span>

<span data-ttu-id="ef3c6-168">При создании новой службы пользователь может использовать сертификат, который был выдан центром сертификации, отличным от доверенного, или сертификат издателя может отсутствовать в хранилище «Доверенные корневые центры сертификации».</span><span class="sxs-lookup"><span data-stu-id="ef3c6-168">When creating a new service, you may be using a certificate that is not issued by a trusted root certificate, or the issuing certificate itself may not be in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="ef3c6-169">Предусмотрена возможность временного отключения механизма, проверяющего цепочку сертификатов для заданного сертификата; эта возможность должна использоваться только в процессе разработки.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-169">For development purposes only, you can temporarily disable the mechanism that checks the chain of trust for a certificate.</span></span> <span data-ttu-id="ef3c6-170">Чтобы отключить данный механизм, задайте для свойства `CertificateValidationMode` значение `PeerTrust` или `PeerOrChainTrust`.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-170">To do this, set the `CertificateValidationMode` property to either `PeerTrust` or `PeerOrChainTrust`.</span></span> <span data-ttu-id="ef3c6-171">Эти режимы определяют, что сертификат может быть либо самостоятельно выданным (доверие одноранговой группы), либо являться частью цепочки доверия.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-171">Either mode specifies that the certificate can either be self-issued (peer trust) or part of a chain of trust.</span></span> <span data-ttu-id="ef3c6-172">Указанное свойство можно задать для любого из следующих классов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-172">You can set the property on any of the following classes.</span></span>

|<span data-ttu-id="ef3c6-173">Класс</span><span class="sxs-lookup"><span data-stu-id="ef3c6-173">Class</span></span>|<span data-ttu-id="ef3c6-174">Свойство.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-174">Property</span></span>|
|-----------|--------------|
|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential>|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A?displayProperty=nameWithType>|

<span data-ttu-id="ef3c6-175">Свойство также можно задать с использованием конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-175">You can also set the property using configuration.</span></span> <span data-ttu-id="ef3c6-176">Для задания режима проверки используются следующие элементы.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-176">The following elements are used to specify the validation mode:</span></span>

- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md)

- [\<peerAuthentication>](../../configure-apps/file-schema/wcf/peerauthentication-element.md)

- [\<messageSenderAuthentication>](../../configure-apps/file-schema/wcf/messagesenderauthentication-element.md)

## <a name="custom-authentication"></a><span data-ttu-id="ef3c6-177">Нестандартная проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="ef3c6-177">Custom Authentication</span></span>

<span data-ttu-id="ef3c6-178">Свойство `CertificateValidationMode` также позволяет настроить способ проверки сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-178">The `CertificateValidationMode` property also enables you to customize how certificates are authenticated.</span></span> <span data-ttu-id="ef3c6-179">По умолчанию задано значение `ChainTrust`.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-179">By default, the level is set to `ChainTrust`.</span></span> <span data-ttu-id="ef3c6-180">Чтобы использовать значение <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, необходимо также установить атрибут `CustomCertificateValidatorType` для сборки и типа, которые используются при проверке сертификата.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-180">To use the <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> value, you must also set the `CustomCertificateValidatorType` attribute to an assembly and type used to validate the certificate.</span></span> <span data-ttu-id="ef3c6-181">Для создания пользовательского проверяющего элемента управления необходимо наследование от абстрактного класса <xref:System.IdentityModel.Selectors.X509CertificateValidator>.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-181">To create a custom validator, you must inherit from the abstract <xref:System.IdentityModel.Selectors.X509CertificateValidator> class.</span></span>

<span data-ttu-id="ef3c6-182">При создании пользовательской структуры проверки подлинности наиболее важным методом, который необходимо переопределить, является метод <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-182">When creating a custom authenticator, the most important method to override is the <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> method.</span></span> <span data-ttu-id="ef3c6-183">Образец создания пользовательской структуры проверки подлинности см. в разделе [Проверяющий элемент управления для сертификатов X.509](../samples/x-509-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-183">For an example of custom authentication, see the [X.509 Certificate Validator](../samples/x-509-certificate-validator.md) sample.</span></span> <span data-ttu-id="ef3c6-184">Дополнительные сведения см. в разделе [Пользовательские учетные данные и проверка учетных данных](../extending/custom-credential-and-credential-validation.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-184">For more information, see [Custom Credential and Credential Validation](../extending/custom-credential-and-credential-validation.md).</span></span>

## <a name="using-the-powershell-new-selfsignedcertificate-cmdlet-to-build-a-certificate-chain"></a><span data-ttu-id="ef3c6-185">Использование командлета PowerShell New-SelfSignedCertificate для создания цепочки сертификатов</span><span class="sxs-lookup"><span data-stu-id="ef3c6-185">Using the PowerShell New-SelfSignedCertificate Cmdlet to Build a Certificate Chain</span></span>

<span data-ttu-id="ef3c6-186">Командлет PowerShell New-SelfSignedCertificate создает сертификаты X. 509 и пары "закрытый ключ — открытый ключ".</span><span class="sxs-lookup"><span data-stu-id="ef3c6-186">The PowerShell New-SelfSignedCertificate cmdlet creates X.509 certificates and private key/public key pairs.</span></span> <span data-ttu-id="ef3c6-187">Закрытый ключ можно сохранить на диск, а затем использовать его для выдачи и подписи новых сертификатов, что позволяет имитировать иерархию цепочки сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-187">You can save the private key to disk and then use it to issue and sign new certificates, thus simulating a hierarchy of chained certificates.</span></span> <span data-ttu-id="ef3c6-188">Командлет предназначен для использования только в качестве вспомогательной службы при разработке служб и никогда не должен использоваться для создания сертификатов для фактического развертывания.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-188">The cmdlet is intended for use only as an aid when developing services and should never be used to create certificates for actual deployment.</span></span> <span data-ttu-id="ef3c6-189">При разработке службы WCF выполните следующие действия, чтобы создать цепочку доверия с помощью командлета New-SelfSignedCertificate.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-189">When developing a WCF service, use the following steps to build a chain of trust with the New-SelfSignedCertificate cmdlet.</span></span>

#### <a name="to-build-a-chain-of-trust-with-the-new-selfsignedcertificate-cmdlet"></a><span data-ttu-id="ef3c6-190">Создание цепочки доверия с помощью командлета New-SelfSignedCertificate</span><span class="sxs-lookup"><span data-stu-id="ef3c6-190">To build a chain of trust with the New-SelfSignedCertificate cmdlet</span></span>

1. <span data-ttu-id="ef3c6-191">Создайте временный сертификат корневого центра сертификации с помощью командлета New-SelfSignedCertificate.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-191">Create a temporary root authority (self-signed) certificate using the New-SelfSignedCertificate cmdlet.</span></span> <span data-ttu-id="ef3c6-192">Сохраните закрытый ключ на диск.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-192">Save the private key to the disk.</span></span>

2. <span data-ttu-id="ef3c6-193">Воспользуйтесь новым сертификатом для выдачи другого сертификата, содержащего открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-193">Use the new certificate to issue another certificate that contains the public key.</span></span>

3. <span data-ttu-id="ef3c6-194">Импортируйте сертификат корневого центра в хранилище «Доверенные корневые центры сертификации».</span><span class="sxs-lookup"><span data-stu-id="ef3c6-194">Import the root authority certificate into the Trusted Root Certification Authorities store.</span></span>

4. <span data-ttu-id="ef3c6-195">Подробные инструкции см. в разделе [Практическое руководство. Создание временных сертификатов для использования во время разработки](how-to-create-temporary-certificates-for-use-during-development.md).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-195">For step-by-step instructions, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="which-certificate-to-use"></a><span data-ttu-id="ef3c6-196">Выбор сертификата для использования</span><span class="sxs-lookup"><span data-stu-id="ef3c6-196">Which Certificate to Use?</span></span>

<span data-ttu-id="ef3c6-197">Наиболее распространенными вопросами о сертификатах являются следующие: какой сертификат использовать и почему?</span><span class="sxs-lookup"><span data-stu-id="ef3c6-197">Common questions about certificates are which certificate to use, and why.</span></span> <span data-ttu-id="ef3c6-198">Ответ зависит от того, что программирует пользователь - клиент или службу.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-198">The answer depends on whether you are programming a client or service.</span></span> <span data-ttu-id="ef3c6-199">Ниже представлены общие рекомендации; следует иметь виду, что они не являются исчерпывающими ответами на поставленные вопросы.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-199">The following information provides a general guideline and is not an exhaustive answer to these questions.</span></span>

### <a name="service-certificates"></a><span data-ttu-id="ef3c6-200">Сертификаты служб</span><span class="sxs-lookup"><span data-stu-id="ef3c6-200">Service Certificates</span></span>

<span data-ttu-id="ef3c6-201">Основной задачей сертификатов служб является удостоверение подлинности сервера для клиентов.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-201">Service certificates have the primary task of authenticating the server to clients.</span></span> <span data-ttu-id="ef3c6-202">При проверке подлинности сервера клиентом одной из исходных проверок является сравнение значения поля **Субъект** с универсальным кодом ресурса (URI), используемым для обращения к службе: DNS-имена должны совпадать.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-202">One of the initial checks when a client authenticates a server is to compare the value of the **Subject** field to the Uniform Resource Identifier (URI) used to contact the service: the DNS of both must match.</span></span> <span data-ttu-id="ef3c6-203">Например, если URI службы, `http://www.contoso.com/endpoint/` поле **subject** также должно содержать значение `www.contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="ef3c6-203">For example, if the URI of the service is `http://www.contoso.com/endpoint/` then the **Subject** field must also contain the value `www.contoso.com`.</span></span>

<span data-ttu-id="ef3c6-204">Обратите внимание, что в этом поле может содержаться несколько значений с отдельными префиксами.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-204">Note that the field can contain several values, each prefixed with an initialization to indicate the value.</span></span> <span data-ttu-id="ef3c6-205">Чаще всего для общего имени используется инициализация "CN", например `CN = www.contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="ef3c6-205">Most commonly, the initialization is "CN" for common name, for example, `CN = www.contoso.com`.</span></span> <span data-ttu-id="ef3c6-206">Кроме того, поле **Субъект** может быть пустым; в этом случае в поле **Альтернативное имя субъекта** может содержаться значение **DNS-имя**.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-206">It is also possible for the **Subject** field to be blank, in which case the **Subject Alternative Name** field can contain the **DNS Name** value.</span></span>

<span data-ttu-id="ef3c6-207">Также обратите внимание, что поле **Назначения** сертификата должно включать соответствующее значение, например "Проверка подлинности сервера" или "Проверка подлинности клиента".</span><span class="sxs-lookup"><span data-stu-id="ef3c6-207">Also note the value of the **Intended Purposes** field of the certificate should include an appropriate value, such as "Server Authentication" or "Client Authentication".</span></span>

### <a name="client-certificates"></a><span data-ttu-id="ef3c6-208">Сертификаты клиента</span><span class="sxs-lookup"><span data-stu-id="ef3c6-208">Client Certificates</span></span>

<span data-ttu-id="ef3c6-209">Сертификаты клиентов, как правило, выдаются не сторонними центрами сертификации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-209">Client certificates are not typically issued by a third-party certification authority.</span></span> <span data-ttu-id="ef3c6-210">В хранилище «Личное» текущего пользователя обычно содержатся сертификаты, выданные корневым центром; в поле «Назначения» этих сертификатов задано значение «Проверка подлинности клиента».</span><span class="sxs-lookup"><span data-stu-id="ef3c6-210">Instead, the Personal store of the current user location typically contains certificates placed there by a root authority, with an intended purpose of "Client Authentication".</span></span> <span data-ttu-id="ef3c6-211">Клиент может использовать такой сертификат, когда требуется взаимная проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-211">The client can use such a certificate when mutual authentication is required.</span></span>

## <a name="online-revocation-and-offline-revocation"></a><span data-ttu-id="ef3c6-212">Проверка отзыва сертификатов в режиме подключения к сети и автономном режиме</span><span class="sxs-lookup"><span data-stu-id="ef3c6-212">Online Revocation and Offline Revocation</span></span>

### <a name="certificate-validity"></a><span data-ttu-id="ef3c6-213">Срок действия сертификата</span><span class="sxs-lookup"><span data-stu-id="ef3c6-213">Certificate Validity</span></span>

<span data-ttu-id="ef3c6-214">Каждый сертификат действителен только в течение заданного периода времени, который называется *сроком действия*.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-214">Every certificate is valid only for a given period of time, called the *validity period*.</span></span> <span data-ttu-id="ef3c6-215">Срок действия определяется значениями полей **Действителен с** и **Действителен по** сертификата X.509.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-215">The validity period is defined by the **Valid from** and **Valid to** fields of an X.509 certificate.</span></span> <span data-ttu-id="ef3c6-216">Во время проверки подлинности проверяется, не истек ли срок действия сертификата.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-216">During authentication, the certificate is checked to determine whether the certificate is still within the validity period.</span></span>

### <a name="certificate-revocation-list"></a><span data-ttu-id="ef3c6-217">Список отзыва сертификатов</span><span class="sxs-lookup"><span data-stu-id="ef3c6-217">Certificate Revocation List</span></span>

<span data-ttu-id="ef3c6-218">Центр сертификации может отменить действующий сертификат в любой момент.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-218">At any time during the validity period, the certification authority can revoke a certificate.</span></span> <span data-ttu-id="ef3c6-219">Это может произойти по многим причинам, например при компрометации закрытого ключа сертификата.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-219">This can occur for many reasons, such as a compromise of the private key of the certificate.</span></span>

<span data-ttu-id="ef3c6-220">В этом случае все цепочки, происходящие от отозванного сертификата, также становятся недействительными и механизмы проверки подлинности перестают им доверять.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-220">When this occurs, any chains that descend from the revoked certificate are also invalid, and are not trusted during authentication procedures.</span></span> <span data-ttu-id="ef3c6-221">Для обозначения отозванных сертификатов каждый издатель публикует *список отзыва сертификатов*, имеющий отметку даты и времени.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-221">To find out which certificates are revoked, each issuer publishes a time- and date-stamped *certificate revocation list* (CRL).</span></span> <span data-ttu-id="ef3c6-222">Этот список можно проверить с помощью режима с подключением к сети или автономного режима, задав одно из значений перечисления `RevocationMode` для свойства `DefaultRevocationMode` или <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> следующих классов: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication> и <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-222">The list can be checked using either online revocation or offline revocation by setting the `RevocationMode` or `DefaultRevocationMode` property of the following classes to one of the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration values: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, and the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> classes.</span></span> <span data-ttu-id="ef3c6-223">Значение по умолчанию для всех свойств - `Online`.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-223">The default value for all properties is `Online`.</span></span>

<span data-ttu-id="ef3c6-224">Можно также задать режим в конфигурации, используя `revocationMode` атрибут как [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of), так [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) и [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) ).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-224">You can also set the mode in configuration using the `revocationMode` attribute of both the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md)) and the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md)).</span></span>

## <a name="the-setcertificate-method"></a><span data-ttu-id="ef3c6-225">Метод SetCertificate</span><span class="sxs-lookup"><span data-stu-id="ef3c6-225">The SetCertificate Method</span></span>

<span data-ttu-id="ef3c6-226">В WCF часто требуется задать сертификат или набор сертификатов, который служба или клиент будут использовать для проверки подлинности, шифрования или подписи сообщения.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-226">In WCF, you must often specify a certificate or set of certificates a service or client is to use to authenticate, encrypt, or digitally sign a message.</span></span> <span data-ttu-id="ef3c6-227">Это можно сделать программно с помощью метода `SetCertificate` различных классов, представляющих сертификаты X.509.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-227">You can do this programmatically by using the `SetCertificate` method of various classes that represent X.509 certificates.</span></span> <span data-ttu-id="ef3c6-228">Следующие классы используют метод `SetCertificate` для задания сертификата.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-228">The following classes use the `SetCertificate` method to specify a certificate.</span></span>

|<span data-ttu-id="ef3c6-229">Class</span><span class="sxs-lookup"><span data-stu-id="ef3c6-229">Class</span></span>|<span data-ttu-id="ef3c6-230">Метод</span><span class="sxs-lookup"><span data-stu-id="ef3c6-230">Method</span></span>|
|-----------|------------|
|<xref:System.ServiceModel.Security.PeerCredential>|<xref:System.ServiceModel.Security.PeerCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A>|

<span data-ttu-id="ef3c6-231">Метод `SetCertificate` позволяет задать хранилище и его расположение, тип поиска (параметр `x509FindType`), определяющий поле сертификата, и значение, которое требуется найти в данном поле.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-231">The `SetCertificate` method works by designating a store location and store, a "find" type (`x509FindType` parameter) that specifies a field of the certificate, and a value to find in the field.</span></span> <span data-ttu-id="ef3c6-232">Например, следующий код создает экземпляр <xref:System.ServiceModel.ServiceHost> и задает сертификат службы, используемый с целью удостоверения подлинности службы для клиентов, с помощью метода `SetCertificate`.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-232">For example, the following code creates a <xref:System.ServiceModel.ServiceHost> instance and sets the service certificate used to authenticate the service to clients with the `SetCertificate` method.</span></span>

[!code-csharp[c_WorkingWithCertificates#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_workingwithcertificates/cs/source.cs#1)]
[!code-vb[c_WorkingWithCertificates#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_workingwithcertificates/vb/source.vb#1)]

### <a name="multiple-certificates-with-the-same-value"></a><span data-ttu-id="ef3c6-233">Несколько сертификатов с одинаковыми значениями полей</span><span class="sxs-lookup"><span data-stu-id="ef3c6-233">Multiple Certificates with the Same Value</span></span>

<span data-ttu-id="ef3c6-234">В хранилище может содержаться несколько сертификатов с одним и тем же именем субъекта.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-234">A store may contain multiple certificates with the same subject name.</span></span> <span data-ttu-id="ef3c6-235">Поэтому если для параметра `x509FindType` задано значение <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> или <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName> и существует несколько сертификатов с таким значением, возникает исключение, поскольку в этом случае невозможно определить, какой именно сертификат требуется использовать.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-235">This means that if you specify that the `x509FindType` is <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> or <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, and more than one certificate has the same value, an exception is thrown because there is no way to distinguish which certificate is required.</span></span> <span data-ttu-id="ef3c6-236">Это можно подавить, задав для параметра `x509FindType` значение <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-236">You can mitigate this by setting the `x509FindType` to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span></span> <span data-ttu-id="ef3c6-237">В поле отпечатка содержится уникальное значение, которое можно использовать для поиска конкретного сертификата в хранилище.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-237">The thumbprint field contains a unique value that can be used to find a specific certificate in a store.</span></span> <span data-ttu-id="ef3c6-238">Однако у данного подхода есть свой недостаток: если сертификат был отозван или обновлен, метод `SetCertificate` выполнить не удастся, поскольку исходный отпечаток на будет найден.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-238">However, this has its own disadvantage: if the certificate is revoked or renewed, the `SetCertificate` method fails because the thumbprint is also gone.</span></span> <span data-ttu-id="ef3c6-239">А если сертификат является недействительным, проверка подлинности не будет пройдена.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-239">Or, if the certificate is no longer valid, authentication fails.</span></span> <span data-ttu-id="ef3c6-240">Это можно подавить, задав для параметра `x590FindType` значение <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> и указав имя издателя.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-240">The way to mitigate this is to set the `x590FindType` parameter to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> and specify the issuer's name.</span></span> <span data-ttu-id="ef3c6-241">Если указывать издателя не требуется, можно также задать одно из значений перечисления <xref:System.Security.Cryptography.X509Certificates.X509FindType>, например <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-241">If no particular issuer is required, you can also set one of the other <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration values, such as <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span></span>

## <a name="certificates-in-configuration"></a><span data-ttu-id="ef3c6-242">Сертификаты в конфигурации</span><span class="sxs-lookup"><span data-stu-id="ef3c6-242">Certificates in Configuration</span></span>

<span data-ttu-id="ef3c6-243">Сертификаты также можно задать с использованием конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-243">You can also set certificates by using configuration.</span></span> <span data-ttu-id="ef3c6-244">При создании службы учетные данные, включая сертификаты, задаются в разделе [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="ef3c6-244">If you are creating a service, credentials, including certificates, are specified under the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md).</span></span> <span data-ttu-id="ef3c6-245">При программировании клиента сертификаты задаются в [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="ef3c6-245">When you are programming a client, certificates are specified under the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md).</span></span>

## <a name="mapping-a-certificate-to-a-user-account"></a><span data-ttu-id="ef3c6-246">Сопоставление сертификата с учетной записью пользователя</span><span class="sxs-lookup"><span data-stu-id="ef3c6-246">Mapping a Certificate to a User Account</span></span>

<span data-ttu-id="ef3c6-247">Службы IIS и Active Directory предусматривают возможность сопоставления сертификата с учетной пользовательской записью Windows.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-247">A feature of IIS and Active Directory is the ability to map a certificate to a Windows user account.</span></span> <span data-ttu-id="ef3c6-248">Дополнительные сведения об этой возможности см. в разделе [Сопоставление сертификатов с учетными записями пользователей](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-248">For more information about the feature, see [Map certificates to user accounts](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span></span>

<span data-ttu-id="ef3c6-249">Дополнительные сведения о сопоставлении Active Directory см. в разделе [Сопоставление сертификатов клиентов с помощью функции сопоставления службы каталогов](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="ef3c6-249">For more information about using Active Directory mapping, see [Mapping Client Certificates with Directory Service Mapping](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span></span>

<span data-ttu-id="ef3c6-250">Если эта функция включена, можно задать для свойства <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> класса <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> значение `true`.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-250">With this capability enabled, you can set the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> property of the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> class to `true`.</span></span> <span data-ttu-id="ef3c6-251">В конфигурации можно задать `mapClientCertificateToWindowsAccount` атрибуту [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) элемента значение `true` , как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-251">In configuration, you can set the `mapClientCertificateToWindowsAccount` attribute of the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) element to `true`, as shown in the following code.</span></span>

```xml
<serviceBehaviors>
 <behavior name="MappingBehavior">
  <serviceCredentials>
   <clientCertificate>
    <authentication certificateValidationMode="None" mapClientCertificateToWindowsAccount="true" />
   </clientCertificate>
  </serviceCredentials>
 </behavior>
</serviceBehaviors>
```

<span data-ttu-id="ef3c6-252">Сопоставление сертификата X.509 с маркером, представляющим учетную запись пользователя Windows, считается повышением привилегий, поскольку после сопоставления маркер Windows может использоваться для получения доступа к защищенным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-252">Mapping an X.509 certificate to the token that represents a Windows user account is considered an elevation of privilege because, once mapped, the Windows token can be used to gain access to protected resources.</span></span> <span data-ttu-id="ef3c6-253">Поэтому перед сопоставлением необходимо проверить, что сертификат X.509 соответствует политике домена.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-253">Therefore, domain policy requires the X.509 certificate to comply with its policy prior to mapping.</span></span> <span data-ttu-id="ef3c6-254">Проверку этого требования обеспечивает пакет безопасности *SChannel*.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-254">The *SChannel* security package enforces this requirement.</span></span>

<span data-ttu-id="ef3c6-255">При использовании .NET Framework 3,5 или более поздних версий WCF гарантирует, что сертификат соответствует политике домена, прежде чем он будет сопоставлен с учетной записью Windows.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-255">When using .NET Framework 3.5 or later versions, WCF ensures the certificate conforms to domain policy before it is mapped to a Windows account.</span></span>

<span data-ttu-id="ef3c6-256">В первом выпуске WCF сопоставление выполняется без обращения к политике домена.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-256">In the first release of WCF, mapping is done without consulting the domain policy.</span></span> <span data-ttu-id="ef3c6-257">Поэтому более старые приложения, которые работали при использовании первого выпуска, могут не работать, если включено сопоставление и сертификат X.509 не удовлетворяет требованиям политики домена.</span><span class="sxs-lookup"><span data-stu-id="ef3c6-257">Therefore it is possible that older applications that used to work when running under the first release, fails if the mapping is enabled and the X.509 certificate does not satisfy the domain policy.</span></span>

## <a name="see-also"></a><span data-ttu-id="ef3c6-258">См. также</span><span class="sxs-lookup"><span data-stu-id="ef3c6-258">See also</span></span>

- <xref:System.ServiceModel.Channels>
- <xref:System.ServiceModel.Security>
- <xref:System.ServiceModel>
- <xref:System.Security.Cryptography.X509Certificates.X509FindType>
- [<span data-ttu-id="ef3c6-259">Защита служб и клиентов</span><span class="sxs-lookup"><span data-stu-id="ef3c6-259">Securing Services and Clients</span></span>](securing-services-and-clients.md)
