---
title: Расширенная политика защиты
ms.date: 03/30/2017
ms.assetid: e2616a10-317e-4c34-8023-0c015a80a82f
ms.openlocfilehash: c7c2e85872c158facb2de91a7413ac5a04491d7f
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2019
ms.locfileid: "70044988"
---
# <a name="extended-protection-policy"></a><span data-ttu-id="2b57d-102">Расширенная политика защиты</span><span class="sxs-lookup"><span data-stu-id="2b57d-102">Extended Protection Policy</span></span>
<span data-ttu-id="2b57d-103">Расширенная защита - это инициатива, направленная на отражение атак типа «злоумышленник в середине» (MITM).</span><span class="sxs-lookup"><span data-stu-id="2b57d-103">Extended Protection is a security initiative for protecting against man-in-the-middle (MITM) attacks.</span></span> <span data-ttu-id="2b57d-104">Атака MITM - это угроза безопасности, при которой злоумышленник перехватывает учетные данные клиента и переправляет их на сервер.</span><span class="sxs-lookup"><span data-stu-id="2b57d-104">A MITM attack is a security threat in which a MITM takes a client’s credentials and forwards it to a server.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="2b57d-105">Демонстрации</span><span class="sxs-lookup"><span data-stu-id="2b57d-105">Demonstrates</span></span>  
 <span data-ttu-id="2b57d-106">Расширенная защита</span><span class="sxs-lookup"><span data-stu-id="2b57d-106">Extended protection</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="2b57d-107">Обсуждение</span><span class="sxs-lookup"><span data-stu-id="2b57d-107">Discussion</span></span>  
 <span data-ttu-id="2b57d-108">Если приложение проходит проверку подлинности с использованием протокола Kerberos, дайджест-проверку подлинности или проверку NTLM с использованием HTTPS, то сначала устанавливается канал безопасности транспортного уровня (TLS), а проверка подлинности выполняется по этому защищенному каналу.</span><span class="sxs-lookup"><span data-stu-id="2b57d-108">When applications authenticate using Kerberos, Digest or NTLM using HTTPS, a Transport Level Security (TLS) channel is first established and then authentication takes place using the secure channel.</span></span> <span data-ttu-id="2b57d-109">При этом отсутствует привязка между сеансовым ключом, создаваемым протоколом SSL, и сеансовым ключом, создаваемым в ходе проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="2b57d-109">However, there is no binding between the session key generated by SSL and the session key generated during authentication.</span></span> <span data-ttu-id="2b57d-110">Любой злоумышленник может внедриться между клиентом и сервером и начать пересылать запросы от клиента, даже если сам по себе транспортный канал защищен, поскольку сервер не имеет возможности проверить, был ли установлен защищенный канал клиентом или злоумышленником.</span><span class="sxs-lookup"><span data-stu-id="2b57d-110">Any MITM can establish itself between the client and the server and start forwarding the requests from the client, even when the transport channel itself is secure, because the server has no way of knowing whether the secure channel has been established from the client or a MITM.</span></span> <span data-ttu-id="2b57d-111">Решением в данном сценарии является привязка внешнего канала с защитой TLS ко внутреннему каналу с проверкой подлинности клиента, чтобы сервер мог обнаружить вторжение злоумышленника.</span><span class="sxs-lookup"><span data-stu-id="2b57d-111">The solution in this scenario is to bind the outer TLS channel with the inner authentication channel such that the server can detect if there is a MITM.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="2b57d-112">Данный образец работает только при размещении на IIS и не поддерживает Cassini - сервер разработчиков Visual Studio, поскольку Cassini не поддерживает протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2b57d-112">This sample only works when hosted on IIS and cannot work on Cassini – Visual Studio Development Server because Cassini does not support HTTPS.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="2b57d-113">Эта функция доступна в настоящее время только для Windows 7.</span><span class="sxs-lookup"><span data-stu-id="2b57d-113">This feature is currently only available on Windows 7.</span></span> <span data-ttu-id="2b57d-114">Следующие шаги применимы только для Windows 7.</span><span class="sxs-lookup"><span data-stu-id="2b57d-114">The following steps are specific to Windows 7.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="2b57d-115">Настройка, сборка и выполнение образца</span><span class="sxs-lookup"><span data-stu-id="2b57d-115">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="2b57d-116">Установите службы IIS с **панели управления**, компонента **Установка и удаление программ**, **компоненты Windows**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-116">Install Internet Information Services from **Control Panel**, **Add/Remove Programs**, **Windows Features**.</span></span>  
  
2. <span data-ttu-id="2b57d-117">Установите **проверку подлинности Windows** в **компонентах Windows**, **службы IIS**, службах Интернета, **безопасности**и **проверки подлинности Windows**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-117">Install **Windows Authentication** in **Windows Features**, **Internet Information Services**, **World Wide Web Services**, **Security**, and **Windows Authentication**.</span></span>  
  
3. <span data-ttu-id="2b57d-118">Установите **Windows Communication Foundation активацию HTTP** в **компонентах Windows**, **Microsoft .NET Framework 3.5.1**и **Windows Communication Foundation активации HTTP**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-118">Install **Windows Communication Foundation HTTP Activation** in **Windows Features**, **Microsoft .NET Framework 3.5.1**, and **Windows Communication Foundation HTTP Activation**.</span></span>  
  
4. <span data-ttu-id="2b57d-119">Для работы этого образца клиенту необходимо установить защищенный канал с сервером, для чего требуется наличие сертификата сервера, который может устанавливаться из диспетчера служб IIS.</span><span class="sxs-lookup"><span data-stu-id="2b57d-119">This sample requires the client to establish a secure channel with the server, so it requires the presence of a server certificate which can be installed from Internet Information Services (IIS) Manager.</span></span>  
  
    1. <span data-ttu-id="2b57d-120">Откройте диспетчер IIS.</span><span class="sxs-lookup"><span data-stu-id="2b57d-120">Open IIS Manager.</span></span> <span data-ttu-id="2b57d-121">Откройте **Сертификаты сервера**, которые отображаются на вкладке **представление функций** при выборе корневого узла (имя компьютера).</span><span class="sxs-lookup"><span data-stu-id="2b57d-121">Open **Server certificates**, which appears in the **Feature View** tab when the root node (machine name) is selected.</span></span>  
  
    2. <span data-ttu-id="2b57d-122">Для тестирования этого образца создайте самозаверяющий сертификат.</span><span class="sxs-lookup"><span data-stu-id="2b57d-122">For the purpose of testing this sample, create a self-signed certificate.</span></span> <span data-ttu-id="2b57d-123">Чтобы не выводить в Internet Explorer запрос об отсутствии защиты сертификата, можно установить его в хранилище «Доверенные корневые центры сертификации».</span><span class="sxs-lookup"><span data-stu-id="2b57d-123">If you do not want Internet Explorer to prompt you about the certificate not being secure, install the certificate in the Trusted Certificate Root authority store.</span></span>  
  
5. <span data-ttu-id="2b57d-124">Откройте панель **действия** для веб-сайта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2b57d-124">Open the **Actions** pane for the default Web site.</span></span> <span data-ttu-id="2b57d-125">Щелкните **изменить сайт**, **привязки**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-125">Click **Edit Site**, **Bindings**.</span></span> <span data-ttu-id="2b57d-126">Добавьте HTTPS в качестве типа, если пока этот протокол отсутствует, с номером порта 443.</span><span class="sxs-lookup"><span data-stu-id="2b57d-126">Add HTTPS as a type if not already present, with port number 443.</span></span> <span data-ttu-id="2b57d-127">Назначьте SSL-сертификат, созданный на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="2b57d-127">Assign the SSL certificate created in the preceding step.</span></span>  
  
6. <span data-ttu-id="2b57d-128">Постройте службу.</span><span class="sxs-lookup"><span data-stu-id="2b57d-128">Build the service.</span></span> <span data-ttu-id="2b57d-129">При этом в службах IIS будет создан виртуальный каталог, куда будут скопированы DLL-файлы, SVC-файлы и файлы конфигурации, необходимые для размещения службы в веб.</span><span class="sxs-lookup"><span data-stu-id="2b57d-129">This creates a virtual directory in IIS, and copies the .dll, .svc and .config files as required for the service to be Web hosted.</span></span>  
  
7. <span data-ttu-id="2b57d-130">Откройте диспетчер IIS.</span><span class="sxs-lookup"><span data-stu-id="2b57d-130">Open IIS Manager.</span></span> <span data-ttu-id="2b57d-131">Щелкните правой кнопкой мыши виртуальный каталог (**екстендедпротектион**), созданный на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="2b57d-131">Right-click the virtual directory (**ExtendedProtection**), which was created in the preceding step.</span></span> <span data-ttu-id="2b57d-132">Выберите **преобразовать в приложение**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-132">Select **Convert to Application**.</span></span>  
  
8. <span data-ttu-id="2b57d-133">Откройте модуль **проверки** подлинности в диспетчере IIS для этого виртуального каталога и включите **проверку подлинности Windows**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-133">Open the **Authentication** module in IIS Manager for this virtual directory and enable **Windows Authentication**.</span></span>  
  
9. <span data-ttu-id="2b57d-134">Откройте **Дополнительные параметры** в разделе **Проверка подлинности Windows** для этого виртуального каталога и задайте для него значение **обязательно**.</span><span class="sxs-lookup"><span data-stu-id="2b57d-134">Open **Advanced Settings** under **Windows Authentication** for this virtual directory and set it to **Required**.</span></span>  
  
10. <span data-ttu-id="2b57d-135">Проверить службу можно, введя соответствующий HTTPS URL в окне браузера (полное доменное имя).</span><span class="sxs-lookup"><span data-stu-id="2b57d-135">You can test the service by accessing the HTTPS URL from a browser window (Provide a fully-qualified domain name).</span></span> <span data-ttu-id="2b57d-136">Чтобы получить доступ к этому URL-адресу с удаленного компьютера, убедитесь, что в брандмауэре открыты все входящие подключения HTTP и HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2b57d-136">If you want to access this URL from a remote machine, make sure that the firewall is opened for all incoming HTTP and HTTPS connections.</span></span>  
  
11. <span data-ttu-id="2b57d-137">Откройте клиентский файл конфигурации и введите полное имя домена в атрибуте адреса клиента или конечной точки вместо `<<full_machine_name>>`.</span><span class="sxs-lookup"><span data-stu-id="2b57d-137">Open the client configuration file and provide a fully-qualified domain name for the client or endpoint address attribute that replaces `<<full_machine_name>>`.</span></span>  
  
12. <span data-ttu-id="2b57d-138">Запустите клиент.</span><span class="sxs-lookup"><span data-stu-id="2b57d-138">Run the client.</span></span> <span data-ttu-id="2b57d-139">Клиент обращается к службе, которая устанавливает безопасный канал и использует расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="2b57d-139">The client communicates with the service, which establishes a secure channel and uses extended protection.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="2b57d-140">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="2b57d-140">The samples may already be installed on your machine.</span></span> <span data-ttu-id="2b57d-141">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="2b57d-141">Check for the following (default) directory before continuing.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples`  
>   
> <span data-ttu-id="2b57d-142">Если этот каталог не существует, перейдите к [примерам Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) , чтобы скачать все Windows Communication Foundation (WCF) [!INCLUDE[wf1](../../../../includes/wf1-md.md)] и примеры.</span><span class="sxs-lookup"><span data-stu-id="2b57d-142">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="2b57d-143">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="2b57d-143">This sample is located in the following directory.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\Security\ExtendedProtection`
