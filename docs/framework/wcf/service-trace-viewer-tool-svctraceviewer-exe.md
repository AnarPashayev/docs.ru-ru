---
title: Программа Service Trace Viewer (SvcTraceViewer.exe)
ms.date: 03/30/2017
ms.assetid: 9027efd3-df8d-47ed-8bcd-f53d55ed803c
ms.openlocfilehash: 543b0e714343cdb8078861ceb31e4f8035e20afd
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "72321214"
---
# <a name="service-trace-viewer-tool-svctraceviewerexe"></a>Программа Service Trace Viewer (SvcTraceViewer.exe)

Средство просмотра трассировки службы Windows Communication Foundation (WCF) помогает анализировать диагностические трассировки, созданные WCF. Средство Service Trace Viewer позволяет легко выполнять слияние, просмотр и фильтрацию сообщений трассировки в журнале, чтобы можно было диагностировать, восстанавливать и проверять проблемы служб WCF.

## <a name="configuring-tracing"></a>Настройка трассировки

Диагностические трассировки предоставляют информацию о том, что происходит на всем протяжении работы приложения. Как следует из названия, можно проследить операции от их источника до назначения, а также выяснить, что происходило в промежуточных точках.

Вы можете настроить трассировку с помощью файла конфигурации приложения (Web. config для веб-приложений или *имя_приложения*. config для собственных приложений). Ниже представлен пример такого кода.

```xml
<system.diagnostics>
    <trace autoflush="true" />
    <sources>
            <source name="System.ServiceModel"
                    switchValue="Information, ActivityTracing"
                    propagateActivity="true">
            <listeners>
               <add name="sdt"
                   type="System.Diagnostics.XmlWriterTraceListener"
                   initializeData= "SdrConfigExample.e2e" />
            </listeners>
         </source>
    </sources>
</system.diagnostics>
```

В этом примере указываются имя и тип прослушивателя трассировки. Прослушиватель имеет имя `sdt`, а в качестве типа добавляется стандартный прослушиватель трассировки .NET Framework (System.Diagnostics.XmlWriterTraceListener). Атрибут `initializeData` используется для задания имени файла журнала для этого прослушивателя `SdrConfigExample.e2e`. Для файла журнала можно заменить полный путь на простое имя файла.

В этом примере в корневом каталоге создается файл с именем SdrConfigExample.e2e. При использовании средства просмотра трассировки для открытия файла, как описано в разделе "Открытие и просмотр файлов трассировки WCF", можно просмотреть все отправленные сообщения.

Уровень трассировки контролируется параметром `switchValue`. Доступные уровни трассировки приведены в следующей таблице.

|Уровень трассировки|Описание|
|-----------------|-----------------|
|Критические важное|— Записывает в журнал ошибки быстрого входа и записи журнала событий, а затем данные корреляции трассировки. Ниже приводится несколько примеров ситуаций, в которых может потребоваться использовать уровень Critical.<br />— Ваш AppDomain вышел из-за необработанного исключения.<br />— Не удается запустить приложение.<br />— Сообщение, вызвавшее сбой, получено от процесса MyApp. exe.|
|Error|— Записывает все исключения. Уровень Error можно использовать в следующих ситуациях.<br />— Ваш код был аварийно завершен из-за исключения недопустимого приведения.<br />— Исключение "не удалось создать конечную точку" вызывает сбой приложения при запуске.|
|Предупреждение|— Существует условие, которое может впоследствии привести к ошибке или критическому сбою. Этот уровень можно использовать в следующих ситуациях.<br />— Приложение получает больше запросов, чем разрешает его параметры регулирования.<br />— Принимающая очередь находится на 98 процентов от своей заданной емкости.|
|Сведения|— Сообщения, полезные для мониторинга и диагностики состояния системы, измерения производительности или профилирования. Эту информацию можно использовать для планирования загрузки и управления производительностью. Этот уровень можно использовать в следующих ситуациях.<br />— Произошла ошибка после того, как сообщение достигло домена приложения и было десериализовано.<br />-Во время создания привязки HTTP произошла ошибка.|
|Подробный|— Трассировка на уровне отладки для пользовательского кода и обслуживания. Этот уровень используется в следующих ситуациях.<br />— Вы не уверены, какой метод в коде был вызван при возникновении ошибки.<br />-У вас настроена неправильная конечная точка, и не удалось запустить службу, так как запись в хранилище резервирования заблокирована.|
|ActivityTracing|События переходов между действиями по обработке и компонентами.<br /><br /> Этот уровень позволяет администраторам и разработчикам коррелировать приложения из одного домена приложений.<br /><br /> — Трассировка для границ действий: запуск и завершение.<br />— Трассировки для передачи.|

 С помощью `add` можно задать имя и тип прослушивателя трассировки, который требуется использовать. В примере конфигурации прослушиватель имеет имя `sdt`, а в качестве типа добавляется стандартный прослушиватель трассировки .NET Framework (`System.Diagnostics.XmlWriterTraceListener`). Чтобы задать имя файла журнала для этого прослушивателя, используйте `initializeData`. Кроме того, можно заменить простое имя файла полным путем.

Начиная с .NET Framework 4,8, элементы управления ComboBox в некоторых темах с высокой контрастностью отображаются в правильном цвете. Вы можете отключить это изменение, удалив следующий параметр из файла *svcTraceViewer. exe. config* :

```xml
<AppContextSwitchOverrides value="Switch.UseLegacyAccessibilityFeatures=false;Switch.UseLegacyAccessibilityFeatures.2=false" />
```

## <a name="using-the-service-trace-viewer-tool"></a>Использование программы Service Trace Viewer

### <a name="opening-and-viewing-wcf-trace-files"></a>Открытие и просмотр файлов трассировки WCF

Программа Service Trace Viewer поддерживает три типа файлов:

- Файл трассировки WCF (. svcLog)

- Файлы трассировки событий (ETL)

- Файлы трассировки Crimson

 Программа Service Trace Viewer позволяет открыть любой поддерживаемый файл трассировки, добавить или интегрировать дополнительные файлы трассировки, а также открыть и выполнить одновременное слияние группы файлов трассировки.

##### <a name="to-open-a-trace-file"></a>Открытие файла трассировки

1. Запустите средство Service Trace Viewer, используя командное окно, чтобы перейти к расположению установки WCF (C:\Program Files\Microsoft Sdks\windows\v6.0\Bin.), а затем введите `SvcTraceViewer.exe`.

> [!NOTE]
> Программу Service Trace Viewer можно ассоциировать с двумя типами файлов: SVCLOG и STVPROJ. С помощью двух параметров в командной строке можно регистрировать и отменять регистрацию расширений файлов.
>
> /register: зарегистрировать связь расширений файлов "SVCLOG" и "STVPROJ" с программой SvcTraceViewer.exe.
>
> /unregister: отменить регистрацию связи расширений файлов "SVCLOG" и "STVPROJ" с программой SvcTraceViewer.exe.

1. Когда программа Service Trace Viewer запускается, в меню **файл** выберите пункт **Открыть**. Перейдите в папку, где находятся файлы трассировки.

2. Дважды щелкните имя файла трассировки, который требуется открыть.

    > [!NOTE]
    > Щелкните несколько файлов трассировки, удерживая нажатой клавишу SHIFT, и откройте их одновременно. Service Trace Viewer производит слияние содержимого всех файлов и отображает данные в одном представлении. Например, можно открыть файлы трассировки как для клиента, так и для службы. Это удобно, если в конфигурации включено ведение журнала сообщений и распространение действий. Таким образом, можно проверить обмен сообщениями между клиентом и службой. Можно также перетащить несколько файлов в средство просмотра или использовать вкладку Project ( **проект** ). Дополнительные сведения см. в разделе "Управление проектом".

3. Чтобы добавить дополнительные файлы трассировки в открытую коллекцию, в меню **файл** выберите пункт **Добавить**. В открывшемся окне перейдите в расположение файлов трассировки и дважды щелкните левой кнопкой мыши файл, который нужно добавить.

> [!CAUTION]
> Не рекомендуется загружать файлы журнала трассировки размером более 200 МБ. Загрузка файла, размер которого превышает указанное значение, может занять длительное время в зависимости от ресурсов компьютера. Программа Service Trace Viewer может не отвечать в течение длительного времени или исчерпать память компьютера. Во избежание этого рекомендуется настроить частичную загрузку. Дополнительные сведения см. в разделе "Загрузка больших файлов трассировки".

#### <a name="event-tracing-and-crimson-tracing"></a>Трассировка событий и трассировка Crimson

Собственный формат средства просмотра — это формат трассировки действий, выдаваемый WCF. Трассировки, создаваемые в различных форматах, должны конвертироваться перед их отображением в средстве просмотра. На данный момент кроме формата трассировки действий средство просмотра поддерживает трассировку событий и трассировку Crimson.

При открытии файла, не содержащего трассировок действий, средство просмотра пытается преобразовать файл. Необходимо указать имя и расположение файла, который будет содержать преобразованные данные трассировки. После преобразования данных средство просмотра отображает содержимое в новом файле.

> [!NOTE]
> Для сохранения преобразованных данных трассировки требуется свободное пространство на диске. Перед запуском преобразования убедитесь, что на диске достаточно свободного пространства для сохранения данных. В противном случае преобразование не будет выполнено.

### <a name="managing-projects"></a>Управление проектами

Средство просмотра поддерживает проекты, что позволяет просматривать несколько файлов трассировки одновременно. Например, если имеется файл трассировки клиента и файл трассировки службы, их можно добавить в проект. После этого при каждом открытии проекта все файлы трассировки проекта будут загружаться одновременно.

Существует два способа управления проектами.

- В меню **файл** можно открывать, сохранять и закрывать проекты.

- На вкладке **проект** можно добавить файлы в проект.

### <a name="viewing-wcf-traces"></a>Просмотр трассировок WCF

WCF выдает трассировки, используя формат трассировки действий. В модели трассировки действий отдельные трассировки группируются в действиях в соответствии со своим назначением. Логический поток управления переходит между действиями. Например, во время работы приложения появляется и исчезает множество действий "отправка сообщения". Дополнительные сведения о просмотре трассировок и действий, а также о пользовательском интерфейсе средства просмотра трассировки службы см. в разделе [Использование Service Trace Viewer для просмотра коррелированных трассировок и устранения неполадок](./diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md).

#### <a name="switching-to-different-views"></a>Переключение между различными представлениями

В программе Service Trace Viewer предусмотрены следующие различные представления. Они отображаются в виде вкладок на левой панели средства просмотра, и к ним также можно получить доступ из меню **вид** .

- Представление действия

- Представление проекта

- Представление сообщения

- Представление диаграммы

##### <a name="activity-view"></a>Представление действия

После открытия файлов трассировки можно просмотреть трассировки, сгруппированные в действия, и отобразить их в представлении " **действия** " на панели слева.

В представлении " **действия** " отображаются имена действий, число трассировок в действии, длительность, время начала и время окончания.

При щелчке на любом из перечисленных действий на панели трассировок справа отображаются трассировки этого действия. После этого можно выбрать трассировку, чтобы просмотреть сведения о ней.

Можно выбрать несколько действий, нажав клавишу **CTRL** или **SHIFT** и выбрав нужные действия. Панель трассировок отображает все трассировки выбранных действий.

Можно дважды щелкнуть действие, чтобы отобразить его в представлении **графика** . Альтернативным способом является выбор действия и переключение в представление **графика** .

> [!NOTE]
> Действие "000000000000" является специальным действием, которое не может быть отображено в представлении графа. Поскольку все остальные действия привязаны к нему, отображение данного действия может сильно повлиять на производительность.

Чтобы выполнить сортировку списка действий, щелкните заголовок столбца. Действия, содержащие трассировки предупреждений, имеют желтый фон, а действия, содержащие трассировки ошибок, - красный фон.

Существуют различные типы действий, и каждому типу соответствует значок, расположенный слева от каждого действия. Обратитесь к разделу "Значки трассировок", чтобы получить информацию об их значении.

##### <a name="project-view"></a>Представление проекта

Это представление позволяет управлять файлами трассировки текущего проекта. Дополнительные сведения см. в разделе «Управление проектом».

##### <a name="message-view"></a>Представление сообщения

Это представление позволяет просматривать все трассировки журнала сообщений, включая действия, даты и времени, обработку, действий и обратно, а также переходить к сведениям о трассировке журнала сообщений. Трассировки журнала сообщений можно сгруппировать по границе действия, процессу или потоку или отправить & получения для упрощения навигации по потоку сообщений.

##### <a name="graph-view"></a>Представление диаграммы

В этом представлении отображаются данные трассировки для данного действия в форме диаграммы. Диаграмма позволяет просматривать последовательные этапы выполнения событий и взаимосвязи между множеством действий при перемещении данных между ними.

Чтобы переключиться в представление **графика** , выберите действие в представлении **действие** и перейдите на вкладку **действие** или трассировку журнала сообщений в представлении **сообщений** . Если загружено несколько файлов трассировки и действие включает трассировки из нескольких файлов, в представлении графика отображаются все соответствующие трассировки. Двойной щелчок по действиям и трассировке журнала сообщений также приводит к представлению **графика** .

В представлении **диаграммы** каждый вертикальный столбец представляет действие, а каждый блок в столбце представляет трассировку. Действия группируются в процессы (или потоки). Небольшие стрелки между действиями обозначают перенаправления. Большие стрелки между процессами обозначают обмен сообщениями. Выбранное действие всегда обозначается желтым цветом.

###### <a name="selecting-traces-in-the-graph"></a>Выбор трассировок на графике

1. Щелкните блок на графике.

2. Используйте клавиши СТРЕЛКА ВВЕРХ и СТРЕЛКА ВНИЗ для выбора соседних трассировок.

3. Просматривайте данные трассировки на панели трассировки и в области сведений.

###### <a name="expanding-or-collapsing-activity-transfers"></a>Развертывание и свертывание перенаправлений действий

Можно развернуть перенаправление действия, если выбранное действие перенаправляется на другое действие. Это позволяет следить за перенаправлениями.

Развертывание и свертывание перенаправлений действий

1. Нахождение трассировки перемещения с помощью знака "+" слева от значка перемещения.

2. Нажмите клавишу "+" или клавиши **CTRL** и "+" с помощью клавиатуры.

3. На графике отображается следующее действие.

4. В левой части значка перемещения появится "-". Щелкните знак "-" или нажмите клавиши CTRL и "-", чтобы свернуть действие.

> [!NOTE]
> Если развернуть одно из нескольких перенаправлений на одно действие, будут отображены действия, ведущие к новому действию из корневого действия. Эти новые действия отобразятся в свернутом виде. Если необходимо просмотреть подробные сведения об этих действиях, разверните их по вертикали, щелкнув значок развертывания в заголовке графика.

###### <a name="expanding-or-collapsing-activities-vertically"></a>Вертикальное развертывание и свертывание действий

Средство просмотра позволяет скрыть ненужные сведения на графике действий путем свертывания действий. В свернутом действии отдельные трассировки не отображаются. Отображаются только перенаправления трассировок. Чтобы просмотреть все трассировки в действии, разверните действие вертикально, щелкнув значок развертывания действия в заголовке графика.

Вертикальное развертывание и свертывание действий

1. Щелкните значок "+" в заголовке действия, чтобы развернуть действие по вертикали.

2. Обратите внимание, что на графике отображаются все трассировки.

3. Щелкните значок "-" в заголовке действия, чтобы свернуть действие по вертикали.

4. Обратите внимание, что в действии отображаются только важные трассировки перенаправлений, журналов сообщений, предупреждений и исключений.

###### <a name="options"></a>Параметры

В меню « **Параметры** » в представлении диаграммы можно выбрать два параметра.

- Показать трассировки границ действий. Если этот параметр отключен, трассировки границ действий на графике игнорируются.

- Показать подробные трассировки, не относящиеся к сообщениям. Если этот параметр отключен, игнорируются все подробные трассировки, за исключением трассировок сообщений. В большинстве случаев подробные трассировки не очень важны для анализа. Этот параметр полезен, если не требуется анализировать подробные трассировки, и необходимо сосредоточиться на более важных трассировках.

###### <a name="layout-mode"></a>Режим макета

Средство просмотра имеет два режима макета: **Обработка** и **поток**. Этот параметр определяет самый большой элемент организации. Режим макета по умолчанию — **Process**, то есть действия группируются по процессам в графе.

###### <a name="execution-list"></a>Список выполнения

В этом раскрывающемся списке можно выбрать процесс или поток для отображения на графике. Например, если имеется два файла трассировки двух клиентов (А и Б) и открыта одна служба и необходимо отобразить на графике только службу и клиент А, можно отменить выбор клиента Б в списке.

#### <a name="viewing-trace-details"></a>Просмотр сведений трассировки

Для просмотра сведений трассировки выберите трассировку на панели трассировки. Подробные сведения отобразятся в области сведений.

##### <a name="trace-pane"></a>Панель трассировки

Панель, расположенная в правой верхней части окна Service Trace Viewer, - это панель трассировки. В ней отображаются все трассировки, существующие в выбранном действии, вместе с дополнительной информацией, такой как уровень трассировки, идентификатор потока и имя процесса.

Вы можете скопировать необработанный XML-код трассировки в буфер обмена, щелкнув трассировку правой кнопкой мыши и выбрав пункт **Копировать трассировку в буфер обмена**.

##### <a name="detail-pane"></a>Область сведений

Левая нижняя область окна Service Trace Viewer - это область сведений. Она содержит три вкладки для просмотра сведений трассировок.

В **форматированном** представлении данные отображаются более организованным образом. Все известные XML-элементы отображаются в таблицах и деревьях, что облегчает чтение и восприятие информации.

В представлении **XML** отображается XML-код, соответствующий выбранной трассировке. Это представление поддерживает выделение цветом и раскраску синтаксических конструкций. При использовании **Find** для поиска строк выделяются результаты поиска.

В представлении **сообщений** отображается часть сообщения XML в трассировках журнала сообщений. Эти данные скрыты при выборе трассировок, не связанных с сообщениями.

### <a name="filtering-wcf-traces"></a>Фильтрация трассировок WCF

Чтобы упростить анализ файлов трассировки, их можно фильтровать следующими способами.

- Панель инструментов фильтрации предоставляет доступ к встроенным и настраиваемым фильтрам. Его можно включить в меню **вид** .

- Предварительно определенный фильтр средства просмотра можно использовать для выборочной фильтрации частей трассировок WCF. По умолчанию он настроен на пропускание всех трассировок инфраструктуры. Параметры этого фильтра определяются в подменю " **Параметры фильтра** " в меню " **вид** ".

- Пользовательские фильтры XPath позволяют пользователям полностью контролировать процесс фильтрации. Их можно определить в **настраиваемом фильтре** в меню **вид** .

Отображаются только трассировки, которые проходят через все фильтры.

#### <a name="using-the-filter-toolbar"></a>Использование панели инструментов фильтра

Панель фильтра отображается в верхней части инструмента. Если он отсутствует, его можно активировать в меню **вид** . Панель содержит три компонента.

- Искать: **найдите** , определяет предмет для поиска в операции фильтрации. Например, если нужно найти все трассировки, которые были созданы в контексте процесса X, задайте для этого поля значение X, а в поле **Поиск** — значение "имя процесса". Это поле заменяется элементом управления выбора даты и времени, если выбран фильтр времени.

- Диапазон поиска: это поле определяет тип применяемого фильтра.

- Уровень: определяет минимальный уровень трассировки, допускаемый фильтром. Например, при значении "Ошибка и выше" отображаются только трассировки уровня Error или Critical. Этот фильтр комбинируется с критериями, заданными в полях «Искать» и «Диапазон поиска».

Кнопка **Фильтр теперь** запускает операцию фильтрации. Некоторые фильтры, особенно если они применяются к большим объемам данных, работают достаточно долго. Операцию фильтра можно отменить, нажав кнопку **остановить** , которая отображается в строке состояния в меню **операции** .

Кнопка **clear** сбрасывает предварительно определенные и настраиваемые фильтры, чтобы разрешить передачу всех трассировок.

#### <a name="filter-options"></a>Параметры фильтрации

Средство просмотра может автоматически удалять трассировки WCF из представления. Он также может выборочно удалять трассировки, относящиеся к отдельным областям WCF, например, удалять из представления трассировки, относящиеся к транзакциям.

Параметры этого фильтра определяются в подменю " **Параметры фильтра** " в меню " **вид** ".

#### <a name="custom-filters"></a>Настраиваемые фильтры

С помощью языка XML Path (XPath) можно создавать настраиваемые фильтры, позволяющие выполнять поиск данных трассировки для любого XML-элемента. Фильтры доступны на панели инструментов фильтрации.

В пользовательских фильтрах могут быть предусмотрены параметры. Также можно импортировать уже имеющиеся настраиваемые фильтры.

##### <a name="creating-a-custom-filter"></a>Создание пользовательского фильтра

Фильтры можно создавать двумя способами:

###### <a name="creating-a-custom-filter-using-the-template-wizard"></a>Создание настраиваемого фильтра с помощью мастера шаблонов

Можно щелкнуть существующую трассировку и создать фильтр на основе структуры этой трассировки. В этом примере создается настраиваемый фильтр на основе идентификатора потока.

1. На панели трассировки в правой части средства просмотра выберите трассировку, содержащую элемент, для которого требуется выполнить фильтрацию.

2. Нажмите кнопку **создать настраиваемый фильтр** , расположенную в верхней части панели трассировки.

3. В появившемся диалоговом окне введите имя фильтра. В этом примере введите `Thread ID`. Также можно ввести описание фильтра.

4. В древовидном представлении слева представлена структура записи трассировки, выбранной на шаге 1. Перейдите к элементу, для которого нужно создать условие. В этом примере перейдите к ThreadID, который будет находиться в узле XPath: /E2ETraceEvent/System/Execution/@ThreadID. Дважды щелкните атрибут ThreadID в древовидном представлении. Будет создано выражение для атрибута в правой части диалогового окна.

5. Измените поле параметра для состояния ThreadID с None на "{0}". В результате выполнения этого действия при применении фильтра станет возможной настройка значения ThreadID. (См. раздел "Применение фильтра".) Можно определить до четырех параметров. Условия комбинируются с помощью оператора "ИЛИ".

6. Нажмите кнопку **ОК** , чтобы создать фильтр.

> [!NOTE]
> Если фильтр создан с помощью мастера шаблонов, его можно изменять только вручную. Невозможно запустить мастер для фильтра, который уже был создан. Кроме того, условия фильтра XPath, созданного с помощью мастера шаблонов, комбинируются с помощью оператора "ИЛИ". Если необходимо использовать оператор «И», выражение фильтра можно отредактировать после его создания.

###### <a name="creating-a-custom-filter-manually"></a>Создание пользовательского фильтра вручную

В меню "Настраиваемые фильтры" можно создавать фильтры XPath вручную.

1. В меню Вид выберите пункт меню **Настраиваемые фильтры** .

2. В появившемся диалоговом окне нажмите кнопку **создать.**

3. Как минимум, следует указать имя фильтра и выражение XPath.

4. Нажмите кнопку **ОК**.

###### <a name="applying-a-custom-filter"></a>Применение пользовательского фильтра

После создания настраиваемый фильтр доступен на панели инструментов фильтрации. Выберите фильтр, который нужно применить, в поле **Поиск в** панели инструментов фильтра. В случае предыдущего примера выберите "Thread ID".

1. Укажите искомое значение в поле **найти** . В данном примере введите идентификатор потока, который требуется найти.

2. Нажмите кнопку **Фильтр сейчас**и просмотрите результат операции.

Если фильтр использует несколько параметров, введите их в качестве разделителя в поле **найти** , используя символ ";". Например, следующая строка определяет три параметра: "1;findValue;text". Средство просмотра применяет "1" к параметру {0} фильтра. "findValue" и "Text" применяются к {1} и {2} соответственно.

###### <a name="sharing-custom-filters"></a>Совместное использование настраиваемых фильтров

Настраиваемые фильтры могут совместно использоваться различными сеансами и пользователями. Фильтры можно экспортировать в файл определения, который затем можно импортировать в другое расположение.

 Импорт настраиваемого фильтра

1. В меню **вид** выберите пункт **Настраиваемые фильтры**.

2. В открывшемся диалоговом окне нажмите кнопку **Импорт** .

3. Перейдите к файлу настраиваемого фильтра (. STVCF), щелкните его и нажмите кнопку **Открыть** .

Экспорт настраиваемого фильтра

1. В меню Вид выберите пункт **Настраиваемые фильтры**.

2. В появившемся диалоговом окне выберите фильтр, который следует экспортировать.

3. Нажмите кнопку **Экспорт** .

4. Укажите имя и расположение файла определения пользовательского фильтра (STVCF) и нажмите кнопку **сохранить** .

> [!NOTE]
> Эти пользовательские фильтры можно импортировать и экспортировать только в Service Trace Viewer. Выполнить их чтение другими средствами невозможно.

### <a name="finding-data"></a>Поиск данных

В средстве просмотра предусмотрены следующие способы поиска данных.

- Панель поиска предоставляет быстрый доступ к наиболее распространенным поисковым параметрам.

- Диалоговое окно поиска предоставляет дополнительные параметры поиска. Доступ к нему можно получить в меню **Правка** или с помощью сочетания клавиш CTRL + F.

Панель инструментов поиска отображается в верхней части средства просмотра. Если он отсутствует, его можно активировать в меню **вид** . Панель содержит два компонента.

- Искать: позволяет ввести искомое ключевое слово.

- Диапазон поиска: позволяет указать область поиска. Можно выбрать поиск во всех действиях или только в текущем действии.

Диалоговое окно поиска содержит два дополнительных параметра.

- Найти объект.

  - Параметр "необработанные данные журнала" выполняет поиск ключевого слова во всех необработанных данных.

  - Параметры "XML Text" и "XML Attribute" выполняют поиск только в XML-элементах.

  - Параметр "зарегистрированное сообщение" выполняет поиск по ключевому слову только в сообщениях.

- Игнорировать корневое действие: Поиск игнорирует трассировки в действии "000000000000". Этот параметр увеличивает производительность при работе с большими файлами трассировки, если корневое действие содержит тысячи трассировок, большая часть которых является перенаправлениями.

### <a name="navigating-traces"></a>Навигация по трассировкам

Поскольку трассировки записываются поэтапно во время работы приложения, навигация по трассировкам может помочь при отладке приложения. Программа Service Trace Viewer предоставляет различные способы навигации по трассировкам.

#### <a name="step-forward-or-backward"></a>Шаг вперед или назад

Если рассматривать каждую трассировку как строку кода в программе, пошаговое выполнение в интегрированной среде разработки (IDE) Visual Studio очень похоже на шаг с обходным переходом. Единственное отличие заключается в том, что при работе с трассировками можно также совершать шаги назад. Шаг вперед означает переход к следующей трассировке в действии.

- Шаг вперед. Используйте меню **действие** или нажмите клавишу F10. В области трассировки можно также использовать клавишу со стрелкой "вниз".

- Шаг назад. Используйте меню **действие** или нажмите клавишу F9. В области трассировки можно также использовать клавишу со стрелкой "вверх".

> [!NOTE]
> Это может привести к действию, выполняемому в другом процессе или даже на другом компьютере, так как сообщения WCF могут содержать идентификаторы действий, охватывающие компьютеры.

#### <a name="follow-transfer"></a>Отслеживание перенаправлений

Трассировки перенаправлений — это специальные трассировки в файле трассировки. Посредством трассировки перенаправления одно действие может перенаправляться другому действию. Например, "действие A" может переноситься в "Activity B". В этом случае имеется трассировка перемещения в «действии A» с именем «to: Activity» и значком перемещения. Эта трассировка перенаправления является связью между двумя трассировками. В "действии б" в конце действия также может быть трассировка передачи, которую необходимо вернуть в "действие а". Это похоже на вызовы функций в программах: А вызывает Б, затем Б возвращает значение.

"Следовать перемещению" аналогичен шагу в отладчике. Отслеживается перенаправление от "Действия А" к "Действию Б". Это не оказывает какого-либо воздействия на другие трассировки.

Предусмотрено два способа отслеживания перенаправлений: с помощью мыши или с помощью клавиатуры.

- При помощи мыши: дважды щелкните трассировку перенаправления на панели трассировки.

- С помощью клавиатуры: выберите трассировку перемещения и используйте команду "перейти к перемещению" в меню " **действие** " или нажмите клавишу F11.

> [!NOTE]
> Во многих случаях, когда «Действие А» перенаправляется к «Действию Б», «Действие А» ожидает обратного перенаправления «Действия Б» к «Действию А». Это означает, что «Действие А» не имеет запланированных трассировок во время выполнения трассировки «Действием Б». Однако "Действие А" может не находиться в состоянии ожидания, а продолжать записывать трассировки. Также возможна ситуация, когда "Действие Б" не перенаправляется обратно к "Действию А". Таким образом, перенаправления действий все же отличаются от вызовов функций. Представление графика позволяет лучше понять суть перенаправления действий.

#### <a name="jump-to-next-or-previous-transfer"></a>Переход к следующему или предыдущему перенаправлению

При анализе текущего действия (или нескольких выбранных действий) может потребоваться быстро найти действия, к которым оно перенаправляется. "Переход к следующему переносу" позволяет выбрать следующую трассировку перемещения в действии. Настроив трассировку перемещения, вы можете перейти к следующему действию с помощью инструкции "следовать за перемещением".

- Перейти к следующему переносу: используйте меню " **действие** " или нажмите клавиши "Ctrl + F10".

- Перейти к предыдущему переносу: используйте меню " **действие** " или нажмите клавиши "CTRL + F9".

#### <a name="navigate-in-graph-view"></a>Навигация в представлении графика

Хотя переходы в области действий и области трассировки аналогичны отладке, использование представления **диаграмм** обеспечивает гораздо более эффективное взаимодействие. Дополнительные сведения см. в разделе "представление графика".

### <a name="loading-large-trace-files"></a>Загрузка больших файлов трассировки

Файлы трассировки могут быть очень большими. Например, если включить трассировку на уровне "verbose", результирующий файл трассировки для выполнения в течение нескольких минут может легко составлять сотни мегабайт или даже больше, в зависимости от скорости сети и схемы обмена данными.

При открытии очень большого файла трассировки в программе Service Trace Viewer производительность системы может значительно снизиться. Скорость загрузки может быть медленной, и может увеличиться время отклика. Фактическая скорость периодически меняется в зависимости от конфигурации оборудования. На большинстве компьютеров загрузка файла трассировки размером более 200 МБ значительно снижает производительность системы. При работе с файлами трассировки, имеющими размер более 1 Гб, программа может использовать всю доступную оперативную память или очень долго не отвечать на запросы.

Чтобы избежать снижения скорости загрузки и времени отклика при анализе больших файлов трассировки, средство просмотра трассировки служб предоставляет функцию «частичной загрузки», которая загружает только небольшую часть трассировки за раз. Например, имеется файл трассировки размером более 1 Гб, работающий на сервере на протяжении нескольких дней. При возникновении некоторых ошибок и попытке анализа трассировки не требуется открывать файл трассировки целиком. Вместо этого можно загрузить трассировки за определенный период времени, когда, скорее всего, произошла ошибка. Поскольку область данных сокращается, программа Service Trace Viewer загружает файл быстрее, и можно найти ошибку, используя небольшой объем данных.

#### <a name="enabling-partial-loading"></a>Включение частичной загрузки

Включать частичную загрузку вручную не требуется. Если общий размер открываемых файлов трассировки превышает 40 МБ, программа Service Trace Viewer автоматически отображает диалоговое окно частичной загрузки, чтобы можно было выбрать часть, которую требуется загрузить.

> [!NOTE]
> Поскольку трассировки могут быть распределены по времени неравномерно, длительность периода времени, который указывается на панели инструментов частичной загрузки, может не быть пропорциональна отображаемому размеру загружаемых данных. Фактический размер загружаемых данных может быть меньше, чем предполагаемый размер, который отображается в диалоговом окне частичной загрузки.

#### <a name="adjusting-partial-loading"></a>Настройка частичной загрузки

После частичной загрузки файла трассировки может потребоваться изменить набор загружаемых данных. Это можно сделать с помощью панели инструментов частичной загрузки, расположенной в верхней части средства просмотра.

1. Переместите панель инструментов с помощью мыши или введите время начала и окончания.

2. Нажмите кнопку " **изменить** ".

## <a name="understanding-trace-icons"></a>Значки трассировок

Ниже приведен список значков, которые программа Service Trace Viewer использует в представлении **действий** , представлении **графа** и панели **трассировки** для представления различных элементов.

> [!NOTE]
> Некоторые трассировки, которые не разбиты на категории (например, «сообщение закрыто»), не имеют значка.

### <a name="activity-tracing-traces"></a>Трассировки действий

|Значок|Описание|
|----------|-----------------|
|![Предупреждение трассировки](./media/7457c4ed-8383-4ac7-bada-bcb27409da58.gif "7457c4ed-8383-4ac7-Bada-bcb27409da58")|Трассировка предупреждения: трассировка, создаваемая на пороге предупреждений|
|![Трассировка ошибок](./media/7d908807-4967-4f6d-9226-d52125db69ca.gif "7d908807-4967-4f6d-9226-d52125db69ca")|Трассировка Error: трассировка, создаваемая на уровне Error.|
|![Трассировка начала действия:](./media/8a728f91-5f80-4a95-afe8-0b6acd6e0317.gif "8a728f91-5f80-4a95-afe8-0b6acd6e0317")|Трассировка Start: трассировка, обозначающая начало действия. В ней содержится имя действия. Разработчику приложений необходимо определить одну трассировку Start для каждого идентификатора действия для каждого процесса или потока.<br /><br /> После распространения идентификатора действия по источникам трассировки для корреляции трассировок можно увидеть несколько трассировок Start для одного идентификатора действия (один для каждого источника трассировки). Трассировка Start создается, если функция ActivityTracing включена для источника трассировки.|
|![Действие "закончить трассировку](./media/a0493e95-653e-4af8-84a4-4d09a400bc31.gif "a0493e95-653e-4af8-84a4-4d09a400bc31") "|Трассировка Stop: трассировка, обозначающая конец действия. . В ней содержится имя действия. Разработчику приложений необходимо определить одну трассировку Stop для каждого идентификатора действия для каждого источника трассировки. Ни одна трассировка из заданного источника трассировки не появляется после создания трассировки Stop источником трассировки, кроме случая, когда временное разбиение трассировки не слишком мало. В этом случае две трассировки с одним значением временного разбиения, включая Stop, могут чередоваться при отображении. После распространения идентификатора действия по источникам трассировки для корреляции трассировок можно увидеть несколько трассировок Stop для одного идентификатора действия (один для каждого источника трассировки). Трассировка Stop создается, если функция ActivityTracing включена для источника трассировки.|
|![Действие приостановить трассировку](./media/6f7f4191-df2b-4592-8998-8379769e2d32.gif "6f7f4191-DF2B-4592-8998-8379769e2d32")|Трассировка Suspend: трассировка, обозначающая время приостановки действия. До возобновления приостановленного действия никакие трассировки не создаются. Приостановленное действие означает, что никакой обработки в этом действии в области источника трассировки не выполняется. Трассировки Suspend и Resume полезны для профилирования. Трассировка Suspend создается, если функция ActivityTracing включена для источника трассировки.|
|![Действие возобновления трассировки](./media/1060d9d2-c9c8-4e0a-9988-cdc2f7030f17.gif "1060d9d2-c9c8-4e0a-9988-cdc2f7030f17")|Трассировка Resume: обозначает время возобновления действия после приостановки. В этом действии трассировки могут создаваться повторно. Трассировки Suspend и Resume полезны для профилирования. Трассировка Resume создается, если функция ActivityTracing включена для источника трассировки.|
|![Переместить](./media/b2d9850e-f362-4ae5-bb8d-9f6f3ca036a5.gif "b2d9850e-f362-4ae5-bb8d-9f6f3ca036a5")|Transfer: трассировка, создаваемая при перенаправлении логики потока управления от одного действия к другому. Действие, от которого происходит перенаправление, может продолжать выполнение работы параллельно действию, к которому осуществляется перенаправление. Трассировка Transfer создается, если функция ActivityTracing включена для источника трассировки.|
|![Перемещение из](./media/1df215cb-b344-4f36-a20d-195999bda741.gif "1df215cb-b344-4f36-a20d-195999bda741")|Transfer From: трассировка, определяющая перенаправление от другого действия к текущему действию.|
|![Переместить в](./media/74255b6e-7c47-46ef-8e53-870c76b04c3f.gif "74255b6e-7c47-46ef-8e53-870c76b04c3f")|Transfer To: трассировка, определяющая перенаправление логического потока управления от текущего действия к другому.|

### <a name="wcf-traces"></a>Трассировки WCF

|Значок|Описание|
|----------|-----------------|
|(./media/7c66e994-2476-4260-a0db-98948b9af197.gif "7c66e994-2476-4260-a0db-98948b9af197") ![трассировки журнала сообщений]|Трассировка журнала сообщений. трассировка, создаваемая при регистрации сообщения WCF функцией ведения журнала сообщений при включении источника трассировки `System.ServiceModel.MessageLogging`. При щелчке трассировки отображается сообщение. Существует четыре настраиваемые точки ведения журнала для сообщения: ServiceLevelSendRequest, TransportSend, TransportReceive и ServiceLevelReceiveRequest, которые также могут быть заданы атрибутом `messageSource` в трассировке журнала сообщений.|
|![Получено сообщение](./media/de4f586c-c5dd-41ec-b1c3-ac56b4dfa35c.gif "de4f586c-C5DD-41ec-b1c3-ac56b4dfa35c") трассировки|Трассировка получила сообщение: трассировка, создаваемая при получении сообщения WCF, если источник трассировки `System.ServiceModel` включен на уровне сведений или подробно. Эта трассировка необходима для просмотра стрелки корреляции сообщений в представлении **граф** действий.|
|![Сообщение отправлено](./media/558943c4-17cf-4c12-9405-677e995ac387.gif "558943c4-17cf-4c12-9405-677e995ac387") трассировки|Трассировка отправленных сообщений: трассировка, порожденная при отправке сообщения WCF, если источник трассировки `System.ServiceModel` включен на уровне сведений или подробно. Эта трассировка необходима для просмотра стрелки корреляции сообщений в представлении **граф** действий.|

### <a name="activities"></a>Действия

|Значок|Описание|
|----------|-----------------|
|![](./media/wcfc-defaultactivityc.gif "Wcfc_defaultActivityc") действия|Activity: указывает, что текущее действие является общим действием.|
|(./media/5dc8e0eb-1c32-4076-8c66-594935beaee9.gif "5dc8e0eb-1c32-4076-8c66-594935beaee9") ![действия root]|Действие Root: обозначает корневое действие процесса.|

### <a name="wcf-activities"></a>Действия WCF

|Значок|Описание|
|----------|-----------------|
|(./media/29fa00ac-cf78-46e5-822d-56222fff61d1.gif "29fa00ac-cf78-46e5-822d-56222fff61d1") ![действия окружения]|Действие среды: действие, которое создает, открывает или закрывает узел или клиент WCF. Ошибки, произошедшие в ходе этих этапов, отображаются в данном действии.|
|(./media/d7b135f6-ec7d-45d7-9913-037ab30e4c26.gif "D7b135f6-ec7d-45d7-9913-037ab30e4c26") ![действия прослушивания]|Действие Listen: действие, записывающее трассировки, которые относятся к прослушивателю. В этом действии можно просматривать информацию о прослушивателе и запросы соединения.|
|(./media/2f628580-b80f-45a7-925b-616c96426c0e.gif "2f628580-b80f-45a7-925b-616c96426c0e") ![действия получения байтов]|Действие Receive Bytes: действие, группирующее все трассировки, которые относятся к получению входящих байтов при установленном соединении между двумя конечными точками. Это действие необходимо для корреляции с действиями транспорта, распространяющими свой идентификатор действия, например http.sys. В этом действии отображаются ошибки соединения, такие как прерывание связи.|
|![Обработка сообщения](./media/wcfc-executionactivityiconc.GIF "wcfc_ExecutionActivityIconc")|Действие обработки сообщения: действие, которое группирует трассировки, связанные с созданием сообщения WCF. В этом действии отображаются ошибки, связанные с неправильным конвертом или неправильно сформированным сообщением. В этом действии можно просматривать заголовки сообщений, чтобы проверить выполнение распространения идентификатора действия от вызывающего. Если распространение выполнено, при перенаправлении действия Process Action (следующий значок) можно также назначить этому действию распространенный идентификатор действия для корреляции трассировок вызывающего и вызываемого.|
|(./media/7c66e994-2476-4260-a0db-98948b9af197.gif "7c66e994-2476-4260-a0db-98948b9af197") ![трассировки журнала сообщений]|Действие "обработать действие" — действие, которое группирует все трассировки, связанные с запросом WCF, между двумя конечными точками. Если в конфигурации обеих конечных точек для параметра `propagateActivity` задано значение `true`, все трассировки от этих конечных точек объединяются в одно действие для непосредственной корреляции. Такое действие будет содержать ошибки, обусловленные обработкой транспорта или безопасности, а также расширением до границы пользовательского кода и обратным сужением (если существует отклик).|
|![Обработка сообщения](./media/wcfc-executionactivityiconc.GIF "wcfc_ExecutionActivityIconc")|Действие Execute User Code: действие, группирующее трассировки пользовательского кода для обработки запроса.|

## <a name="troubleshooting"></a>Устранение неполадок

Если у вас нет разрешения на запись в реестр, появится следующее сообщение об ошибке: "средство Microsoft Service Trace Viewer не зарегистрировано в системе" при использовании команды "`svctraceviewer /register`" для регистрации этого средства. В этом случае необходимо войти в систему с использованием учетной записи, у которой имеется право записи в реестр.

Кроме того, программа Service Trace Viewer записывает некоторые параметры (например, параметры настраиваемых фильтров и фильтрации) в файл SvcTraceViewer.exe.settings в папке сборки. При отсутствии разрешения на чтение файла можно по-прежнему запустить программу, но нельзя загрузить параметры.

Отображение сообщения об ошибке "Неизвестная ошибка во время обработки одной или более трассировок" при открытии ETL-файла означает, что этот файл имеет недопустимый формат.

Если открыть журнал трассировки в операционной системе на арабском языке, можно заметить, что фильтр времени не работает. Например, 2005 год соответствует 1427 году в арабском календаре. Однако диапазон времени, поддерживаемый фильтром в программе «Просмотр трассировки службы», не включает даты ранее 1752 г. В результате может оказаться невозможным выбрать правильную дату в фильтре. Чтобы устранить эту проблему, можно создать настраиваемый фильтр (**Просмотр/настраиваемые фильтры**), используя выражение XPath для включения определенного диапазона времени.

## <a name="see-also"></a>См. также

- [Использование программы Service Trace Viewer для просмотра скоррелированных трассировок и устранения неполадок](./diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)
- [Настройка трассировки](./diagnostics/tracing/configuring-tracing.md)
- [Сквозная трассировка](./diagnostics/tracing/end-to-end-tracing.md)
