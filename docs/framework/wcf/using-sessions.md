---
title: Использование сеансов
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
ms.openlocfilehash: 671e650a494d314ec1da1957eaae91e2d1811213
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2019
ms.locfileid: "69952839"
---
# <a name="using-sessions"></a><span data-ttu-id="62bf1-102">Использование сеансов</span><span class="sxs-lookup"><span data-stu-id="62bf1-102">Using Sessions</span></span>
<span data-ttu-id="62bf1-103">В приложениях Windows Communication Foundation (WCF) *сеанс* сопоставляет группу сообщений с диалогом.</span><span class="sxs-lookup"><span data-stu-id="62bf1-103">In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="62bf1-104">Сеансы WCF отличаются от объектов сеанса, доступных в ASP.NET приложениях, поддерживают различные поведения и управляются различными способами.</span><span class="sxs-lookup"><span data-stu-id="62bf1-104">WCF sessions are different than the session object available in ASP.NET applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="62bf1-105">В этом разделе описываются функции, которые сеансы включают в приложениях WCF, и способы их использования.</span><span class="sxs-lookup"><span data-stu-id="62bf1-105">This topic describes the features that sessions enable in WCF applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="62bf1-106">Сеансы в приложениях Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="62bf1-106">Sessions in Windows Communication Foundation Applications</span></span>  
 <span data-ttu-id="62bf1-107">Если в контракте службы указано, что для него требуется сеанс, это означает, что все вызовы (т. е. обмен сообщениями, на котором он основан) должны быть частью одного диалога.</span><span class="sxs-lookup"><span data-stu-id="62bf1-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="62bf1-108">Если в контракте указано, что сеансы для него разрешены, но не требуются, клиенты могут подключаться, создавая сеанс или не создавая его.</span><span class="sxs-lookup"><span data-stu-id="62bf1-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="62bf1-109">Если сеанс завершен и по его каналу отправляется сообщение, выдается исключение.</span><span class="sxs-lookup"><span data-stu-id="62bf1-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="62bf1-110">Сеансы WCF имеют следующие основные концептуальные функции:</span><span class="sxs-lookup"><span data-stu-id="62bf1-110">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="62bf1-111">Они явным образом инициируются и завершаются вызвавшим приложением (клиентом WCF).</span><span class="sxs-lookup"><span data-stu-id="62bf1-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
- <span data-ttu-id="62bf1-112">Сообщения, доставленные в ходе сеанса, обрабатываются в порядке их получения.</span><span class="sxs-lookup"><span data-stu-id="62bf1-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="62bf1-113">Сеанс коррелирует группу сообщений в диалог.</span><span class="sxs-lookup"><span data-stu-id="62bf1-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="62bf1-114">Возможны различные типы корреляций.</span><span class="sxs-lookup"><span data-stu-id="62bf1-114">Different types of correlation are possible.</span></span> <span data-ttu-id="62bf1-115">Например, один основанный на сеансах канал может коррелировать сообщения, основываясь на общем сетевом подключении, а другой - основываясь на общем теге в тексте сообщения.</span><span class="sxs-lookup"><span data-stu-id="62bf1-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="62bf1-116">Функции, получаемые в результате сеанса, зависят от характера корреляции.</span><span class="sxs-lookup"><span data-stu-id="62bf1-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="62bf1-117">Нет общего хранилища данных, связанного с сеансом WCF.</span><span class="sxs-lookup"><span data-stu-id="62bf1-117">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="62bf1-118">Если вы знакомы с <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> классом в приложениях ASP.NET и предоставляемыми им функциями, вы можете заметить следующие различия между этим видом сеанса и сеансами WCF:</span><span class="sxs-lookup"><span data-stu-id="62bf1-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in ASP.NET applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="62bf1-119">Сеансы ASP.NET всегда инициируются сервером.</span><span class="sxs-lookup"><span data-stu-id="62bf1-119">ASP.NET sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="62bf1-120">Сеансы ASP.NET неявно неупорядочены.</span><span class="sxs-lookup"><span data-stu-id="62bf1-120">ASP.NET sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="62bf1-121">Сеансы ASP.NET предоставляют общий механизм хранения данных для запросов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-121">ASP.NET sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="62bf1-122">В этом разделе описываются следующие функции и операции:</span><span class="sxs-lookup"><span data-stu-id="62bf1-122">This topic describes:</span></span>  
  
- <span data-ttu-id="62bf1-123">Поведение выполнения по умолчанию при использовании привязок, основанных на сеансе, в уровне модели службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
- <span data-ttu-id="62bf1-124">Типы функций, предоставляемых системными привязками, основанными на сеансах WCF.</span><span class="sxs-lookup"><span data-stu-id="62bf1-124">The types of features that the WCF session-based, system-provided bindings provide.</span></span>  
  
- <span data-ttu-id="62bf1-125">Создание контракта, объявляющего требование сеанса.</span><span class="sxs-lookup"><span data-stu-id="62bf1-125">How to create a contract that declares a session requirement.</span></span>  
  
- <span data-ttu-id="62bf1-126">Управление созданием и прекращением сеанса и его связью с экземпляром службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="62bf1-127">Поведение выполнения по умолчанию с использованием сеансов</span><span class="sxs-lookup"><span data-stu-id="62bf1-127">Default Execution Behavior Using Sessions</span></span>  
 <span data-ttu-id="62bf1-128">Привязка, пытающаяся инициировать сеанс, называется *основанной на сеансе* .</span><span class="sxs-lookup"><span data-stu-id="62bf1-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="62bf1-129">Контракты служб указывают о том, что для них требуются, допускаются или не допускаются привязки, основанные на сеансе. Для этого свойству <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> интерфейса (или класса) контракта службы присваивается одно из значений перечисления <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="62bf1-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="62bf1-130">По умолчанию значение этого свойства равно <xref:System.ServiceModel.SessionMode.Allowed>, а это означает, что если клиент использует привязку на основе сеанса с реализацией службы WCF, служба устанавливает и использует предоставленный сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="62bf1-131">Когда служба WCF принимает сеанс клиента, по умолчанию включаются следующие функции.</span><span class="sxs-lookup"><span data-stu-id="62bf1-131">When a WCF service accepts a client session, the following features are enabled by default:</span></span>  
  
1. <span data-ttu-id="62bf1-132">Все вызовы между объектом клиента WCF обрабатываются одним и тем же экземпляром службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-132">All calls between a WCF client object are handled by the same service instance.</span></span>  
  
2. <span data-ttu-id="62bf1-133">Различные привязки на основе сеанса предоставляют дополнительные возможности.</span><span class="sxs-lookup"><span data-stu-id="62bf1-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="62bf1-134">Типы сеансов, предоставляемые системой</span><span class="sxs-lookup"><span data-stu-id="62bf1-134">System-Provided Session Types</span></span>  
 <span data-ttu-id="62bf1-135">Привязка, основанная на сеансе, поддерживает ассоциацию по умолчанию экземпляра службы с определенным сеансом.</span><span class="sxs-lookup"><span data-stu-id="62bf1-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="62bf1-136">Впрочем, различные привязки, основанные на сеансе, поддерживают и другие различные функции, помимо описанного выше управления созданием экземпляров на основе сеанса.</span><span class="sxs-lookup"><span data-stu-id="62bf1-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 <span data-ttu-id="62bf1-137">WCF предоставляет следующие типы поведения приложений на основе сеансов:</span><span class="sxs-lookup"><span data-stu-id="62bf1-137">WCF provides the following types of session-based application behavior:</span></span>  
  
- <span data-ttu-id="62bf1-138">Элемент <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> поддерживает основанные на безопасности сеансы, в которых обе стороны, обменивающиеся информацией, согласовали определенный безопасный диалог.</span><span class="sxs-lookup"><span data-stu-id="62bf1-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> <span data-ttu-id="62bf1-139">Дополнительные сведения см. в разделе [Защита служб](../../../docs/framework/wcf/securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-139">For more information, see [Securing Services](../../../docs/framework/wcf/securing-services.md).</span></span> <span data-ttu-id="62bf1-140">Например, привязка <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> , содержащая поддержку как безопасных, так и надежных сеансов, по умолчанию использует только безопасный сеанс, шифрующий сообщения и защищающий их цифровой подписью.</span><span class="sxs-lookup"><span data-stu-id="62bf1-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
- <span data-ttu-id="62bf1-141">Привязка <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> поддерживает сеансы, основанные на TCP/IP, что обеспечивает корреляцию всех сообщений по подключению на уровне сокетов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
- <span data-ttu-id="62bf1-142">Элемент <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> , реализующий спецификацию WS-ReliableMessaging, обеспечивает поддержку надежных сеансов, в которых можно настроить отправку сообщений в определенном порядке и только один раз, что гарантирует получение сообщений, даже когда при диалоге они проходят через несколько узлов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> <span data-ttu-id="62bf1-143">Дополнительные сведения см. в разделе [Надежные сеансы](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-143">For more information, see [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span></span>  
  
- <span data-ttu-id="62bf1-144">Привязка <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> обеспечивает сеансы датаграммы MSMQ.</span><span class="sxs-lookup"><span data-stu-id="62bf1-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> <span data-ttu-id="62bf1-145">Дополнительные сведения см. [в разделе очереди в WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-145">For more information, see [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="62bf1-146">Установка свойства <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> указывает о том, что для контракта требуется сеанс, но не задает тип этого сеанса.</span><span class="sxs-lookup"><span data-stu-id="62bf1-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="62bf1-147">Создание контракта, требующего сеанс</span><span class="sxs-lookup"><span data-stu-id="62bf1-147">Creating a Contract That Requires a Session</span></span>  
 <span data-ttu-id="62bf1-148">Создание контракта, требующего сеанс, означает, что группа операций, объявляемых контрактом службы, должна выполняться в пределах одного сеанса и сообщения должны быть доставлены в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="62bf1-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="62bf1-149">Чтобы назначить уровень поддержки сеансов, требуемый контрактом, задайте в качестве значения свойства <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> класса или интерфейса контракта службы перечисление <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> . При этом указывается одно из следующих условий контракта:</span><span class="sxs-lookup"><span data-stu-id="62bf1-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
- <span data-ttu-id="62bf1-150">Требуется сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-150">Requires a session.</span></span>  
  
- <span data-ttu-id="62bf1-151">Клиенту допускается создавать сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-151">Allows a client to establish a session.</span></span>  
  
- <span data-ttu-id="62bf1-152">Сеансы запрещены.</span><span class="sxs-lookup"><span data-stu-id="62bf1-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="62bf1-153">Впрочем, установка свойства <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> не указывает требуемый контрактом тип поведения, основанного на сеансе.</span><span class="sxs-lookup"><span data-stu-id="62bf1-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="62bf1-154">Он предписывает WCF подтвердить во время выполнения, что настроенная привязка (которая создает коммуникационный канал) для службы, не поддерживает или не может установить сеанс при реализации службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-154">It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="62bf1-155">Опять же, привязка может выполнить это требование с любым типом поведения, основанного на сеансе: безопасность, транспорт, надежность или некоторая комбинация этих типов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="62bf1-156">Конкретное поведение зависит от выбранного значения <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="62bf1-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="62bf1-157">Если настроенная для службы привязка не соответствует значению <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, выдается исключение.</span><span class="sxs-lookup"><span data-stu-id="62bf1-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="62bf1-158">Привязки и создаваемые ими каналы, поддерживающие сеансы, называются основанными на сеансах.</span><span class="sxs-lookup"><span data-stu-id="62bf1-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="62bf1-159">Следующий контракт службы указывает, что все операции в `ICalculatorSession` необходимо выполнить в пределах одного сеанса.</span><span class="sxs-lookup"><span data-stu-id="62bf1-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="62bf1-160">Ни одна операция не возвращает значение вызвавшему объекту, за исключением метода `Equals` .</span><span class="sxs-lookup"><span data-stu-id="62bf1-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="62bf1-161">Впрочем, метод `Equals` не принимает параметры, а потому может возвращать только ненулевое значение в пределах сеанса, в котором данные уже переданы другим операциям.</span><span class="sxs-lookup"><span data-stu-id="62bf1-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="62bf1-162">Для правильной работы этого контракта требуется сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="62bf1-163">При отсутствии сеанса, связанного с определенным клиентом, экземпляр службы не может определить, какие именно данные отправил клиент.</span><span class="sxs-lookup"><span data-stu-id="62bf1-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="62bf1-164">Если сеанс разрешен службой, он создается и используется, если он инициирован клиентом. В противном случае сеанс не создается.</span><span class="sxs-lookup"><span data-stu-id="62bf1-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="62bf1-165">Сеансы и экземпляры служб</span><span class="sxs-lookup"><span data-stu-id="62bf1-165">Sessions and Service Instances</span></span>  
 <span data-ttu-id="62bf1-166">При использовании поведения создания экземпляров по умолчанию в WCF все вызовы между объектом клиента WCF обрабатываются одним и тем же экземпляром службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-166">If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.</span></span> <span data-ttu-id="62bf1-167">Таким образом, на уровне приложения можно считать, что сеанс обеспечивает поведение приложений, аналогичное поведению местных вызовов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="62bf1-168">Например, при создании локального объекта происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="62bf1-168">For example, when you create a local object:</span></span>  
  
- <span data-ttu-id="62bf1-169">Вызывается конструктор.</span><span class="sxs-lookup"><span data-stu-id="62bf1-169">A constructor is called.</span></span>  
  
- <span data-ttu-id="62bf1-170">Все последующие вызовы к клиентской ссылке на объект WCF обрабатываются одним и тем же экземпляром объекта.</span><span class="sxs-lookup"><span data-stu-id="62bf1-170">All subsequent calls made to the WCF client object reference are processed by the same object instance.</span></span>  
  
- <span data-ttu-id="62bf1-171">Деструктор вызывается при уничтожении ссылки на объект.</span><span class="sxs-lookup"><span data-stu-id="62bf1-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="62bf1-172">Сеансы обеспечивают аналогичное поведение при взаимодействии между клиентами и службами, если используется поведение создания экземпляров службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="62bf1-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="62bf1-173">Если контракт службы требует или поддерживает сеансы, можно отметить операцию (или несколько операций) как инициирующую или завершающую сеанс. Для этого необходимо задать свойства <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> и <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> .</span><span class="sxs-lookup"><span data-stu-id="62bf1-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="62bf1-174">*Инициирующие операции* - это операции, вызываемые в качестве первых операций новых сеансов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="62bf1-175">Неинициирующие операции могут вызываться только после вызова по крайней мере одной инициирующей операции.</span><span class="sxs-lookup"><span data-stu-id="62bf1-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="62bf1-176">Поэтому можно создать некоторое подобие конструктора сеансов для службы, объявив инициирующие операции, которые принимают от клиентов входные данные, как подходящие для создания экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="62bf1-177">(Впрочем, состояние ассоциируется с сеансом, а не с объектом службы.)</span><span class="sxs-lookup"><span data-stu-id="62bf1-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="62bf1-178">*Завершающие операции*- это, соответственно, операции, вызываемые как последние сообщения существующих сеансов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="62bf1-179">В случае по умолчанию WCF повторно использует объект службы и его контекст после закрытия сеанса, с которым была связана эта служба.</span><span class="sxs-lookup"><span data-stu-id="62bf1-179">In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="62bf1-180">Поэтому можно создать некоторое подобие деструктора, объявив завершающие операции, которые выполняют функции по завершению действия экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="62bf1-181">Поведение по умолчанию имеет сходство с локальными конструкторами и деструкторами, но это не более чем сходство.</span><span class="sxs-lookup"><span data-stu-id="62bf1-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="62bf1-182">Любая операция службы WCF может быть инициированной или завершающей операцией одновременно.</span><span class="sxs-lookup"><span data-stu-id="62bf1-182">Any WCF service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="62bf1-183">Кроме того, в случае по умолчанию инициирующие операции можно вызывать сколько угодно раз и в любом порядке. После того как сеанс установлен и связан с экземпляром, дополнительные сеансы могут быть созданы только в случае осуществления явным образом управления временем существования экземпляра службы (путем обработки объекта <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> ).</span><span class="sxs-lookup"><span data-stu-id="62bf1-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="62bf1-184">И наконец, состояние связывается с сеансом, а не с объектом службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="62bf1-185">Например, `ICalculatorSession` контракт, используемый в предыдущем примере, требует, чтобы клиентский объект WCF сначала `Clear` вызывал операцию перед любой другой операцией и что сеанс с этим объектом клиента WCF должен завершаться при вызове метода `Equals` операция.</span><span class="sxs-lookup"><span data-stu-id="62bf1-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="62bf1-186">В следующем примере кода приведен контракт, обеспечивающий выполнение этих требований.</span><span class="sxs-lookup"><span data-stu-id="62bf1-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="62bf1-187">Для инициации сеанса сначала необходимо вызвать операцию`Clear` , а завершится сеанс при вызове операции `Equals` .</span><span class="sxs-lookup"><span data-stu-id="62bf1-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="62bf1-188">Службы не начинают сеансы с клиентами.</span><span class="sxs-lookup"><span data-stu-id="62bf1-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="62bf1-189">В клиентских приложениях WCF существует прямая связь между временем существования канала на основе сеанса и временем существования самого сеанса.</span><span class="sxs-lookup"><span data-stu-id="62bf1-189">In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="62bf1-190">Таким образом, клиенты создают новые сеансы путем создания новых каналов, основанных на сеансах, и прерывают существующие сеансы путем правильного закрытия этих каналов.</span><span class="sxs-lookup"><span data-stu-id="62bf1-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="62bf1-191">Клиент начинает сеанс с конечной точкой службы путем вызова одной из следующих операций:</span><span class="sxs-lookup"><span data-stu-id="62bf1-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="62bf1-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> для канала, возвращенного при вызове <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="62bf1-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="62bf1-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType>в объекте клиента WCF, созданном [средством служебной программы метаданных ServiceModel (Svcutil. exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
- <span data-ttu-id="62bf1-194">Операция инициирования для любого типа клиентского объекта WCF (по умолчанию инициируются все операции).</span><span class="sxs-lookup"><span data-stu-id="62bf1-194">An initiating operation on either type of WCF client object (by default, all operations are initiating).</span></span> <span data-ttu-id="62bf1-195">При вызове первой операции клиентский объект WCF автоматически открывает канал и инициирует сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-195">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="62bf1-196">Обычно клиент завершает сеанс с конечной точкой службы путем вызова одной из следующих операций:</span><span class="sxs-lookup"><span data-stu-id="62bf1-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="62bf1-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> для канала, возвращенного при вызове <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="62bf1-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="62bf1-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>в объекте клиента WCF, созданном программой Svcutil. exe.</span><span class="sxs-lookup"><span data-stu-id="62bf1-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.</span></span>  
  
- <span data-ttu-id="62bf1-199">Завершающая операция для любого типа клиентского объекта WCF (по умолчанию никакие операции не завершаются; контракт должен явно указать завершающую операцию).</span><span class="sxs-lookup"><span data-stu-id="62bf1-199">A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="62bf1-200">При вызове первой операции клиентский объект WCF автоматически открывает канал и инициирует сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-200">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="62bf1-201">Примеры см. в разделах [Практическое руководство. Создайте службу, для которой требуются](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) сеансы, а также [поведение службы по умолчанию](../../../docs/framework/wcf/samples/default-service-behavior.md) и примеры создания [экземпляров](../../../docs/framework/wcf/samples/instancing.md) .</span><span class="sxs-lookup"><span data-stu-id="62bf1-201">For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples.</span></span>  
  
 <span data-ttu-id="62bf1-202">Дополнительные сведения о клиентах и сеансах см. [в разделе доступ к службам с помощью клиента WCF](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-202">For more information about clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="62bf1-203">Сеансы взаимодействуют с параметрами InstanceContext</span><span class="sxs-lookup"><span data-stu-id="62bf1-203">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="62bf1-204">Перечисление <xref:System.ServiceModel.SessionMode> контракта взаимодействует со свойством <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> , управляющим связью между каналами и определенными объектами службы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> <span data-ttu-id="62bf1-205">Дополнительные сведения см. в разделе [сеансы, создание экземпляров и параллелизм](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="62bf1-205">For more information, see [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="62bf1-206">Совместное использование объектов InstanceContext</span><span class="sxs-lookup"><span data-stu-id="62bf1-206">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="62bf1-207">Также можно задать для каждого вызова или канала, основанного на сеансе, с каким именно объектом <xref:System.ServiceModel.InstanceContext> он будет ассоциирован, самостоятельно назначив ассоциацию.</span><span class="sxs-lookup"><span data-stu-id="62bf1-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span> 
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="62bf1-208">Сеансы и потоковая передача</span><span class="sxs-lookup"><span data-stu-id="62bf1-208">Sessions and Streaming</span></span>  
 <span data-ttu-id="62bf1-209">При наличии большого количества данных для передачи режим потоковой передачи в WCF является разумной альтернативой поведению по умолчанию для буферизации и обработки сообщений в памяти целиком.</span><span class="sxs-lookup"><span data-stu-id="62bf1-209">When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="62bf1-210">При потоковой передаче вызовов с привязкой, основанной на сеансе, может возникнуть непредвиденное поведение.</span><span class="sxs-lookup"><span data-stu-id="62bf1-210">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="62bf1-211">Все потоковые вызовы выполняются через один канал (канал датаграммы), который не поддерживает сеансы, даже если используемая привязка настроена так, чтобы она использовала сеансы.</span><span class="sxs-lookup"><span data-stu-id="62bf1-211">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="62bf1-212">Если несколько клиентов выполняют потоковые вызовы одного объекта службы через привязку, основанную на сеансе, и задан "одиночный" режим параллелизма объекта службы и задан режим контекста его экземпляра `PerSession`, все вызовы должны проходить через канал датаграммы, а потому может обрабатываться не более одного вызова одновременно.</span><span class="sxs-lookup"><span data-stu-id="62bf1-212">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="62bf1-213">При этом может истечь время ожидания для одного или нескольких клиентов. Эту проблему можно обойти, присвоив значение `InstanceContextMode` свойству `PerCall` или выбрав "множественный" режим параллелизма.</span><span class="sxs-lookup"><span data-stu-id="62bf1-213">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="62bf1-214">Свойство MaxConcurrentSessions в данном случае ни на что не влияет, поскольку имеется всего один сеанс.</span><span class="sxs-lookup"><span data-stu-id="62bf1-214">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="62bf1-215">См. также</span><span class="sxs-lookup"><span data-stu-id="62bf1-215">See also</span></span>

- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
