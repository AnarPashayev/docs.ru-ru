---
title: Суррогаты контрактов данных
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: f97826cb5154035b535b5eac3a8818d8b366d639
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61858030"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="84303-102">Суррогаты контрактов данных</span><span class="sxs-lookup"><span data-stu-id="84303-102">Data Contract Surrogates</span></span>
<span data-ttu-id="84303-103">Контракт данных *суррогат* является дополнительным, построенных на основе модели контракта данных.</span><span class="sxs-lookup"><span data-stu-id="84303-103">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="84303-104">Эта возможность предназначена для настройки и подстановки типов, когда необходимо изменить способ сериализации типа, десериализации или преобразования типа в метаданные.</span><span class="sxs-lookup"><span data-stu-id="84303-104">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="84303-105">Например, суррогат может использоваться в сценариях, когда для типа не задан контракт данных, поля и свойства не помечены атрибутом <xref:System.Runtime.Serialization.DataMemberAttribute> или пользователи хотят динамически создавать вариации схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-105">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="84303-106">Сериализация и десериализация выполняются с суррогатом контракта данных при использовании <xref:System.Runtime.Serialization.DataContractSerializer> для преобразования из .NET Framework в подходящий формат, например XML.</span><span class="sxs-lookup"><span data-stu-id="84303-106">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="84303-107">Суррогат контракта данных также может использоваться для изменения метаданных, экспортированных для типов, при создании представлений метаданных, например документов схемы XML (XSD).</span><span class="sxs-lookup"><span data-stu-id="84303-107">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="84303-108">Во время импорта из метаданных создается код, суррогат может также использоваться для настройки создаваемого кода.</span><span class="sxs-lookup"><span data-stu-id="84303-108">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="84303-109">Как работает суррогат</span><span class="sxs-lookup"><span data-stu-id="84303-109">How the Surrogate Works</span></span>  
 <span data-ttu-id="84303-110">Суррогат сопоставляет один тип ("исходный" тип) с другим типом ("суррогатным" типом).</span><span class="sxs-lookup"><span data-stu-id="84303-110">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="84303-111">В следующем примере показаны исходный тип `Inventory` и новый суррогатный тип `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="84303-111">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="84303-112">Тип `Inventory` не позволяет сериализацию, а тип `InventorySurrogated` позволяет:</span><span class="sxs-lookup"><span data-stu-id="84303-112">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="84303-113">Так как для этого класса контракт данных не определен, класс преобразуется в суррогатный класс с контрактом данных.</span><span class="sxs-lookup"><span data-stu-id="84303-113">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="84303-114">Суррогатный класс показан в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="84303-114">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="84303-115">Реализация IDataContractSurrogate</span><span class="sxs-lookup"><span data-stu-id="84303-115">Implementing the IDataContractSurrogate</span></span>  
 <span data-ttu-id="84303-116">Для использования суррогата контракта данных необходимо реализовать интерфейс <xref:System.Runtime.Serialization.IDataContractSurrogate>.</span><span class="sxs-lookup"><span data-stu-id="84303-116">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="84303-117">Ниже приведен обзор каждого метода интерфейса <xref:System.Runtime.Serialization.IDataContractSurrogate> с возможной реализацией.</span><span class="sxs-lookup"><span data-stu-id="84303-117">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="84303-118">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="84303-118">GetDataContractType</span></span>  
 <span data-ttu-id="84303-119">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> сопоставляет один тип с другим.</span><span class="sxs-lookup"><span data-stu-id="84303-119">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="84303-120">Этот метод требуется для сериализации, десериализации, импорта и экспорта.</span><span class="sxs-lookup"><span data-stu-id="84303-120">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="84303-121">Первая задача - определить, какие типы будут сопоставляться с другими типами.</span><span class="sxs-lookup"><span data-stu-id="84303-121">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="84303-122">Пример:</span><span class="sxs-lookup"><span data-stu-id="84303-122">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="84303-123">При сериализации сопоставление, которое возвращает этот метод, используется затем для преобразования исходного экземпляра в суррогатный экземпляр вызовом метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-123">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="84303-124">При десериализации сопоставление, которое возвращает этот метод, используется сериализатором для десериализации в экземпляр суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-124">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="84303-125">Затем вызывается метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> для преобразования суррогатного экземпляра в экземпляр исходного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-125">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="84303-126">При экспорте суррогатный тип, возвращенный этим методом, применяется для получения контракта данных, который будет использоваться для генерирования метаданных.</span><span class="sxs-lookup"><span data-stu-id="84303-126">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="84303-127">При импорте исходный тип заменяется на суррогатный, который применяется для получения контракта данных, необходимого, например для поддержки возможности ссылок.</span><span class="sxs-lookup"><span data-stu-id="84303-127">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="84303-128">Параметр <xref:System.Type> является типом объекта, который подвергается сериализации, десериализации, импорту или экспорту.</span><span class="sxs-lookup"><span data-stu-id="84303-128">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="84303-129">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> должен возвращать тип, который был на входе, если суррогат не обрабатывает тип.</span><span class="sxs-lookup"><span data-stu-id="84303-129">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="84303-130">В противном случае возвращается соответствующий суррогатный тип.</span><span class="sxs-lookup"><span data-stu-id="84303-130">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="84303-131">Если существует несколько суррогатных типов, метод позволяет определить несколько сопоставлений.</span><span class="sxs-lookup"><span data-stu-id="84303-131">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="84303-132">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> не вызывается для встроенных примитивов контрактов данных, например <xref:System.Int32> или <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="84303-132">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="84303-133">Для других типов, таких как массивы, типы, определяемые пользователем, и других структур данных, метод вызывается для каждого типа.</span><span class="sxs-lookup"><span data-stu-id="84303-133">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="84303-134">В предыдущем примере метод проверяет, совместим ли параметр `type` и `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="84303-134">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="84303-135">Если да, то метод сопоставляет его с `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="84303-135">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="84303-136">Каждый раз при сериализации, десериализации, импорте схемы или экспорте схемы сперва вызывается эта функция для определения соответствия типов.</span><span class="sxs-lookup"><span data-stu-id="84303-136">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="84303-137">Метод GetObjectToSerialize</span><span class="sxs-lookup"><span data-stu-id="84303-137">GetObjectToSerialize Method</span></span>  
 <span data-ttu-id="84303-138">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> преобразует экземпляр исходного типа в экземпляр суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-138">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="84303-139">Этот метод требуется для сериализации.</span><span class="sxs-lookup"><span data-stu-id="84303-139">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="84303-140">На втором этапе необходимо определить, каким образом физические данные из исходного экземпляра будут преобразовываться в данные суррогатного, при помощи реализации метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-140">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="84303-141">Пример:</span><span class="sxs-lookup"><span data-stu-id="84303-141">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="84303-142">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> вызывается при сериализации объекта.</span><span class="sxs-lookup"><span data-stu-id="84303-142">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="84303-143">Этот метод передает данные из исходного типа в поля суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-143">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="84303-144">Поля могут быть напрямую сопоставлены с суррогатными полями, либо в суррогате можно сохранить результат манипуляций с исходными данными.</span><span class="sxs-lookup"><span data-stu-id="84303-144">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="84303-145">Некоторые варианты использования: прямое сопоставление полей; выполнение операций над данными, которые нужно сохранить в суррогатных полях; сохранение XML исходного типа в суррогатном поле.</span><span class="sxs-lookup"><span data-stu-id="84303-145">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="84303-146">Параметр `targetType` относится к объявленному типу элемента.</span><span class="sxs-lookup"><span data-stu-id="84303-146">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="84303-147">Этот параметр является суррогатным типом, возвращенным методом <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-147">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="84303-148">Сериализатор не требует, чтобы возвращенный объект можно было назначить этому типу.</span><span class="sxs-lookup"><span data-stu-id="84303-148">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="84303-149">`obj` Представляет собой объект для сериализации и будут преобразованы в свой суррогат, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="84303-149">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="84303-150">Этот метод возвращает входной объект, если суррогатный не обрабатывает этот объект.</span><span class="sxs-lookup"><span data-stu-id="84303-150">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="84303-151">В противном случае возвращается новый суррогатный объект.</span><span class="sxs-lookup"><span data-stu-id="84303-151">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="84303-152">Суррогат не вызывается, если объект пустой.</span><span class="sxs-lookup"><span data-stu-id="84303-152">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="84303-153">Метод позволяет определить несколько суррогатных сопоставлений для различных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="84303-153">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="84303-154">При создании объекта <xref:System.Runtime.Serialization.DataContractSerializer> можно задать для него сохранение ссылок на объекты.</span><span class="sxs-lookup"><span data-stu-id="84303-154">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="84303-155">(Дополнительные сведения см. в разделе [сериализации и десериализации](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) Это можно сделать, указав для параметра `preserveObjectReferences` в его конструкторе значение `true`.</span><span class="sxs-lookup"><span data-stu-id="84303-155">(For more information, see [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="84303-156">В таком случае суррогат вызывается для объекта только один раз, так как все последующие сериализации просто записывают в поток ссылку.</span><span class="sxs-lookup"><span data-stu-id="84303-156">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="84303-157">Если параметр `preserveObjectReferences` имеет значение `false`, суррогат вызывается для каждого вхождения экземпляра.</span><span class="sxs-lookup"><span data-stu-id="84303-157">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="84303-158">Если тип экземпляра, подвергающегося сериализации, отличается от объявленного типа, сведения о типе записываются в поток (например `xsi:type`), чтобы экземпляр затем можно было десериализовать.</span><span class="sxs-lookup"><span data-stu-id="84303-158">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="84303-159">Это происходит независимо от того, является объект суррогатным, или нет.</span><span class="sxs-lookup"><span data-stu-id="84303-159">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="84303-160">В приведенном выше примере данные экземпляра `Inventory` преобразуются в данные `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="84303-160">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="84303-161">Проверяется тип объекта и выполняются необходимые операции для преобразования в суррогатный тип.</span><span class="sxs-lookup"><span data-stu-id="84303-161">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="84303-162">В данном случае поля класса `Inventory` напрямую копируются в поля класса `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="84303-162">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="84303-163">Метод GetDeserializedObject</span><span class="sxs-lookup"><span data-stu-id="84303-163">GetDeserializedObject Method</span></span>  
 <span data-ttu-id="84303-164">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> преобразует экземпляр суррогатного типа в экземпляр исходного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-164">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="84303-165">Этот метод требуется для десериализации.</span><span class="sxs-lookup"><span data-stu-id="84303-165">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="84303-166">Следующая задача - определить, каким образом физические данные из суррогатного экземпляра будут сопоставляться с данными исходного экземпляра.</span><span class="sxs-lookup"><span data-stu-id="84303-166">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="84303-167">Пример:</span><span class="sxs-lookup"><span data-stu-id="84303-167">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="84303-168">Этот метод вызывается только во время десериализации объекта.</span><span class="sxs-lookup"><span data-stu-id="84303-168">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="84303-169">Он предоставляет возможность обратного сопоставления данных для десериализации из суррогатного типа обратно в исходный тип.</span><span class="sxs-lookup"><span data-stu-id="84303-169">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="84303-170">Аналогично методу `GetObjectToSerialize`, возможен прямой обмен данными полей, выполнение операций над данными или хранение XML-данных.</span><span class="sxs-lookup"><span data-stu-id="84303-170">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="84303-171">При десериализации не всегда получаются данные, идентичные исходным, что связано с операциями при преобразовании данных.</span><span class="sxs-lookup"><span data-stu-id="84303-171">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="84303-172">Параметр `targetType` относится к объявленному типу элемента.</span><span class="sxs-lookup"><span data-stu-id="84303-172">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="84303-173">Этот параметр является суррогатным типом, возвращенным методом `GetDataContractType`.</span><span class="sxs-lookup"><span data-stu-id="84303-173">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="84303-174">`obj` Параметр ссылается на объект, который был десериализован.</span><span class="sxs-lookup"><span data-stu-id="84303-174">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="84303-175">Объект может быть преобразован обратно в свой исходный тип, если он был заменен на суррогатный.</span><span class="sxs-lookup"><span data-stu-id="84303-175">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="84303-176">Этот метод возвращает входной объект, если суррогатный не обрабатывает этот объект.</span><span class="sxs-lookup"><span data-stu-id="84303-176">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="84303-177">В противном случае после завершения преобразования возвращается десериализованный объект.</span><span class="sxs-lookup"><span data-stu-id="84303-177">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="84303-178">Если есть несколько суррогатных типов, можно задать преобразование данных из суррогатного типа в исходный для каждого из них, указав каждый тип и его преобразование.</span><span class="sxs-lookup"><span data-stu-id="84303-178">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="84303-179">Когда возвращается объект, внутренние таблицы объектов обновляются, получая объект, возвращенный суррогатом.</span><span class="sxs-lookup"><span data-stu-id="84303-179">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="84303-180">Все дальнейшие ссылки на экземпляр будут получать суррогатный экземпляр из таблиц объектов.</span><span class="sxs-lookup"><span data-stu-id="84303-180">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="84303-181">В предшествующем примере объекты типа `InventorySurrogated` преобразуются обратно в исходный тип `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="84303-181">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="84303-182">В данном случае данные напрямую передаются из полей `InventorySurrogated` в соответствующие поля `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="84303-182">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="84303-183">Так как операций с данными не производилось, все поля элементов будут содержать те же данные, что и до сериализации.</span><span class="sxs-lookup"><span data-stu-id="84303-183">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="84303-184">Метод GetCustomDataToExport</span><span class="sxs-lookup"><span data-stu-id="84303-184">GetCustomDataToExport Method</span></span>  
 <span data-ttu-id="84303-185">При экспорте схемы метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> является необязательным.</span><span class="sxs-lookup"><span data-stu-id="84303-185">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="84303-186">Он применяется для вставки дополнительных данных или указаний в экспортированную схему.</span><span class="sxs-lookup"><span data-stu-id="84303-186">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="84303-187">Дополнительные данные могут быть добавлены на уровне элемента или типа.</span><span class="sxs-lookup"><span data-stu-id="84303-187">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="84303-188">Пример:</span><span class="sxs-lookup"><span data-stu-id="84303-188">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="84303-189">Этот метод (с двумя перегрузками) позволяет включение дополнительных сведений в метаданные на уровне элемента или типа.</span><span class="sxs-lookup"><span data-stu-id="84303-189">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="84303-190">Можно добавить указания о том, является ли элемент открытым или закрытым, а также комментарии, которые сохраняются при экспорте и импорте схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-190">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="84303-191">Если не применять этот метод, такая информация теряется.</span><span class="sxs-lookup"><span data-stu-id="84303-191">Such information would be lost without this method.</span></span> <span data-ttu-id="84303-192">Этот метод не позволяет добавлять или удалять элементы и типы, а дает возможность добавлять дополнительные данные в схемы на любом из этих двух уровней.</span><span class="sxs-lookup"><span data-stu-id="84303-192">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="84303-193">Этот метод перегружен и может принимать либо объект `Type` (параметр `clrtype`), либо объект <xref:System.Reflection.MemberInfo> (параметр `memberInfo`).</span><span class="sxs-lookup"><span data-stu-id="84303-193">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="84303-194">Второй параметр всегда будет объектом `Type` (параметр `dataContractType`).</span><span class="sxs-lookup"><span data-stu-id="84303-194">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="84303-195">Этот метод вызывается для каждого элемента и типа суррогатного типа `dataContractType`.</span><span class="sxs-lookup"><span data-stu-id="84303-195">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="84303-196">Каждая из перегрузок возвращает либо `null`, либо объект, который можно сериализовать.</span><span class="sxs-lookup"><span data-stu-id="84303-196">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="84303-197">Непустой объект сериализуется как заметка в экспортированной схеме.</span><span class="sxs-lookup"><span data-stu-id="84303-197">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="84303-198">Для перегрузки `Type` каждый тип, экспортированный в схему, предается этому методу в первом параметре с суррогатным типом в качестве параметра `dataContractType`.</span><span class="sxs-lookup"><span data-stu-id="84303-198">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="84303-199">Для перегрузки `MemberInfo` каждый элемент, экспортированный в схему, отправляет свои сведения как параметр `memberInfo` с суррогатным типом в качестве второго параметра.</span><span class="sxs-lookup"><span data-stu-id="84303-199">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="84303-200">Метод GetCustomDataToExport (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="84303-200">GetCustomDataToExport Method (Type, Type)</span></span>  
 <span data-ttu-id="84303-201">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> вызывается во время экспорта схемы для каждого определения типа.</span><span class="sxs-lookup"><span data-stu-id="84303-201">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="84303-202">Этот метод добавляет информацию в типы схемы при экспорте.</span><span class="sxs-lookup"><span data-stu-id="84303-202">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="84303-203">Каждый определенный тип отправляется этому методу с целью определить, есть ли дополнительные данные, которые необходимо включить в схему.</span><span class="sxs-lookup"><span data-stu-id="84303-203">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="84303-204">Метод GetCustomDataToExport (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="84303-204">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  
 <span data-ttu-id="84303-205">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> вызывается во время экспорта для каждого элемента в экспортируемых типах.</span><span class="sxs-lookup"><span data-stu-id="84303-205">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="84303-206">Эта функция дает возможность настроить для элементов любые комментарии, которые будут включены в схему при экспорте.</span><span class="sxs-lookup"><span data-stu-id="84303-206">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="84303-207">Сведения для каждого элемента класса отправляются в этот метод для проверки, не нужно ли включить в схему какие-либо дополнительные данные.</span><span class="sxs-lookup"><span data-stu-id="84303-207">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="84303-208">В приведенном выше примере выполняется поиск по `dataContractType` для каждого элемента суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-208">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="84303-209">Затем возвращается соответствующий модификатор доступа для каждого поля.</span><span class="sxs-lookup"><span data-stu-id="84303-209">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="84303-210">Без такой настойки значение по умолчанию для любого модификатора доступа - открытый.</span><span class="sxs-lookup"><span data-stu-id="84303-210">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="84303-211">Поэтому в коде, сгенерированном при помощи экспортированной схемы, все элементы будут определены как открытые, независимо от их реальных ограничений доступа.</span><span class="sxs-lookup"><span data-stu-id="84303-211">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="84303-212">Если бы эта реализация не использовалась, элемент `numpens` был бы открытым в экспортированной схеме, хотя он определен как закрытый в суррогате.</span><span class="sxs-lookup"><span data-stu-id="84303-212">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="84303-213">Благодаря этому методу в экспортированной схеме модификатор доступа может быть сгенерирован как закрытый.</span><span class="sxs-lookup"><span data-stu-id="84303-213">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="84303-214">Метод GetReferencedTypeOnImport</span><span class="sxs-lookup"><span data-stu-id="84303-214">GetReferencedTypeOnImport Method</span></span>  
 <span data-ttu-id="84303-215">Этот метод сопоставляет тип <xref:System.Type> суррогата с исходным типом.</span><span class="sxs-lookup"><span data-stu-id="84303-215">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="84303-216">Этот метод является необязательным для импорта схем.</span><span class="sxs-lookup"><span data-stu-id="84303-216">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="84303-217">При создании суррогата, импортирующего схему и генерирующего код для нее, следующая задача - перейти от типа суррогатного экземпляра к исходному типу.</span><span class="sxs-lookup"><span data-stu-id="84303-217">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="84303-218">Если в сгенерированном коде необходимо сослаться на существующий пользовательский тип, это можно сделать реализацией метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-218">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="84303-219">При импорте схемы этот метод вызывается для каждого объявления типа, чтобы сопоставить суррогатный контракт данных с типом.</span><span class="sxs-lookup"><span data-stu-id="84303-219">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="84303-220">Строковые параметры `typeName` и `typeNamespace` определяют имя и пространство имен суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-220">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="84303-221">Возвращаемое значение для метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> используется для определения, нужно ли сгенерировать новый тип.</span><span class="sxs-lookup"><span data-stu-id="84303-221">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="84303-222">Этот метод возвращает либо допустимый тип, либо значение NULL.</span><span class="sxs-lookup"><span data-stu-id="84303-222">This method must return either a valid type or null.</span></span> <span data-ttu-id="84303-223">В случае допустимого типа возвращаемый тип используется как тип, на который существует ссылка в сгенерированном коде.</span><span class="sxs-lookup"><span data-stu-id="84303-223">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="84303-224">Если возвращается значение NULL, ссылки на тип не будет, должен быть создан новый тип.</span><span class="sxs-lookup"><span data-stu-id="84303-224">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="84303-225">Если есть несколько суррогатов, можно выполнить сопоставление каждого суррогатного типа и его исходного типа.</span><span class="sxs-lookup"><span data-stu-id="84303-225">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="84303-226">Параметр `customData` является объектом, возвращенным методом <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-226">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="84303-227">Параметр `customData` используется, когда создатели суррогата хотят поместить дополнительные данные или указания в метаданные, которые используются при импорте для генерирования кода.</span><span class="sxs-lookup"><span data-stu-id="84303-227">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="84303-228">Метод ProcessImportedType</span><span class="sxs-lookup"><span data-stu-id="84303-228">ProcessImportedType Method</span></span>  
 <span data-ttu-id="84303-229">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> позволяет настроить любой тип, созданный при импорте схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-229">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="84303-230">Этот метод является необязательным.</span><span class="sxs-lookup"><span data-stu-id="84303-230">This method is optional.</span></span>  
  
 <span data-ttu-id="84303-231">При импорте схемы этот метод позволяет настройку любого импортированного типа и сведений о компиляции.</span><span class="sxs-lookup"><span data-stu-id="84303-231">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="84303-232">Пример:</span><span class="sxs-lookup"><span data-stu-id="84303-232">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="84303-233">Во время импорта этот метод вызывается для каждого генерируемого типа.</span><span class="sxs-lookup"><span data-stu-id="84303-233">During import, this method is called for every type generated.</span></span> <span data-ttu-id="84303-234">Измените объект <xref:System.CodeDom.CodeTypeDeclaration> или <xref:System.CodeDom.CodeCompileUnit>.</span><span class="sxs-lookup"><span data-stu-id="84303-234">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="84303-235">Это означает в том числе изменение имени, элементов, атрибутов и многих других свойств объекта `CodeTypeDeclaration`.</span><span class="sxs-lookup"><span data-stu-id="84303-235">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="84303-236">Обрабатывая объект `CodeCompileUnit`, можно изменить директивы, пространства имен, сборки, на которые существуют ссылки, и некоторые другие аспекты.</span><span class="sxs-lookup"><span data-stu-id="84303-236">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="84303-237">Параметр `CodeTypeDeclaration` содержит объявление типа Code DOM.</span><span class="sxs-lookup"><span data-stu-id="84303-237">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="84303-238">Параметр `CodeCompileUnit` позволяет изменение обработки кода.</span><span class="sxs-lookup"><span data-stu-id="84303-238">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="84303-239">Если возвращается результат `null`, в объявлении типа он уничтожается.</span><span class="sxs-lookup"><span data-stu-id="84303-239">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="84303-240">В противном случае, если возвращается объект `CodeTypeDeclaration`, изменения сохраняются.</span><span class="sxs-lookup"><span data-stu-id="84303-240">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="84303-241">Если при экспорте метаданных добавляются пользовательские данные, необходимо, чтобы они были предоставлены пользователю при импорте для их использования.</span><span class="sxs-lookup"><span data-stu-id="84303-241">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="84303-242">Такие пользовательские данные могут использоваться для указаний о модели программирования или других комментариев.</span><span class="sxs-lookup"><span data-stu-id="84303-242">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="84303-243">Каждый экземпляр `CodeTypeDeclaration` и <xref:System.CodeDom.CodeTypeMember> включает в себя пользовательские данные в виде свойства <xref:System.CodeDom.CodeObject.UserData%2A>, приведенного к типу `IDataContractSurrogate`.</span><span class="sxs-lookup"><span data-stu-id="84303-243">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="84303-244">В приведенном выше примере в импортированной схеме производится несколько изменений.</span><span class="sxs-lookup"><span data-stu-id="84303-244">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="84303-245">Код сохраняет закрытые элементы исходного типа при помощи суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-245">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="84303-246">При импорте схемы модификатор доступа по умолчанию имеет значение `public` (открытый).</span><span class="sxs-lookup"><span data-stu-id="84303-246">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="84303-247">Поэтому все элементы суррогатной схемы будут открытыми, если не изменить их, как в этом примере.</span><span class="sxs-lookup"><span data-stu-id="84303-247">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="84303-248">При экспорте в метаданные вставляются пользовательские данные, указывающие, какие элементы являются закрытыми.</span><span class="sxs-lookup"><span data-stu-id="84303-248">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="84303-249">Производится поиск в пользовательских данных и проверка, должен ли модификатор доступа быть закрытым. Затем выполняется изменение соответствующего элемента, он делается закрытым при помощи атрибутов.</span><span class="sxs-lookup"><span data-stu-id="84303-249">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="84303-250">Без такой настройки элемент `numpens` был бы определен как открытый вместо закрытого.</span><span class="sxs-lookup"><span data-stu-id="84303-250">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="84303-251">Метод GetKnownCustomDataTypes</span><span class="sxs-lookup"><span data-stu-id="84303-251">GetKnownCustomDataTypes Method</span></span>  
 <span data-ttu-id="84303-252">Этот метод получает определенные типы пользовательских данных из схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-252">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="84303-253">Этот метод является необязательным для импорта схем.</span><span class="sxs-lookup"><span data-stu-id="84303-253">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="84303-254">Этот метод вызывается в начале экспорта или импорта схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-254">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="84303-255">Метод возвращает типы пользовательских данных, которые используются в экспортируемой или импортируемой схеме.</span><span class="sxs-lookup"><span data-stu-id="84303-255">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="84303-256">Методу передается объект <xref:System.Collections.ObjectModel.Collection%601> (параметр `customDataTypes`), который представляет собой коллекцию типов.</span><span class="sxs-lookup"><span data-stu-id="84303-256">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="84303-257">Метод добавляет дополнительные известные типы в эту коллекцию.</span><span class="sxs-lookup"><span data-stu-id="84303-257">The method should add additional known types to this collection.</span></span> <span data-ttu-id="84303-258">Известные типы пользовательских данных необходимы для сериализации и десериализации пользовательских данных при помощи <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="84303-258">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="84303-259">Дополнительные сведения см. в разделе [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).</span><span class="sxs-lookup"><span data-stu-id="84303-259">For more information, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="84303-260">Реализация суррогата</span><span class="sxs-lookup"><span data-stu-id="84303-260">Implementing a Surrogate</span></span>  
 <span data-ttu-id="84303-261">Чтобы использовать суррогат контракта данных в WCF, необходимо выполнить несколько специальных процедур.</span><span class="sxs-lookup"><span data-stu-id="84303-261">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="84303-262">Использование суррогата для сериализации и десериализации</span><span class="sxs-lookup"><span data-stu-id="84303-262">To Use a Surrogate for Serialization and Deserialization</span></span>  
 <span data-ttu-id="84303-263">Для выполнения сериализации и десериализации данных с суррогатом используйте <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="84303-263">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="84303-264">Объект <xref:System.Runtime.Serialization.DataContractSerializer> создается при помощи <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="84303-264">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="84303-265">Необходимо также задать суррогат.</span><span class="sxs-lookup"><span data-stu-id="84303-265">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="84303-266">Реализация сериализации и десериализации</span><span class="sxs-lookup"><span data-stu-id="84303-266">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="84303-267">Создайте экземпляр <xref:System.ServiceModel.ServiceHost> для службы.</span><span class="sxs-lookup"><span data-stu-id="84303-267">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="84303-268">Полные инструкции см. в разделе [базовое Программирование WCF](../../../../docs/framework/wcf/basic-wcf-programming.md).</span><span class="sxs-lookup"><span data-stu-id="84303-268">For complete instructions, see [Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="84303-269">Для каждого объекта <xref:System.ServiceModel.Description.ServiceEndpoint> заданного узла службы найдите соответствующий объект <xref:System.ServiceModel.Description.OperationDescription>.</span><span class="sxs-lookup"><span data-stu-id="84303-269">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="84303-270">Выполните поиск экземпляра <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> в поведениях операций.</span><span class="sxs-lookup"><span data-stu-id="84303-270">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="84303-271">Если найден экземпляр <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>, задайте в его свойстве <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-271">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="84303-272">Если экземпляр <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> не найден, создайте новый экземпляр и задайте для элемента <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> нового расширения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-272">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="84303-273">Наконец, добавьте это новое поведение в текущие поведения операций, как показано в примере:</span><span class="sxs-lookup"><span data-stu-id="84303-273">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="84303-274">Использование суррогата для импорта метаданных</span><span class="sxs-lookup"><span data-stu-id="84303-274">To Use a Surrogate for Metadata Import</span></span>  
 <span data-ttu-id="84303-275">При импорте метаданных, таких как WSDL и XSD, для генерации клиентского кода суррогат необходимо добавить в компонент, отвечающий за генерирование кода из схемы XSD, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-275">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="84303-276">Для этого напрямую измените объект <xref:System.ServiceModel.Description.WsdlImporter>, который используется для импорта метаданных.</span><span class="sxs-lookup"><span data-stu-id="84303-276">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="84303-277">Реализация суррогата для импорта метаданных</span><span class="sxs-lookup"><span data-stu-id="84303-277">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="84303-278">Импортируйте метаданные при помощи класса <xref:System.ServiceModel.Description.WsdlImporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-278">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="84303-279">Чтобы проверить, определен ли объект <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>, воспользуйтесь методом <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-279">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="84303-280">Если метод <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> возвращает значение `false`, создайте новый объект <xref:System.Runtime.Serialization.XsdDataContractImporter> и задайте в его свойстве <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> новый экземпляр класса <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="84303-280">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="84303-281">В противном случае используйте импортер, возвращенный параметром `out` метода <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-281">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="84303-282">Если для импортера <xref:System.Runtime.Serialization.XsdDataContractImporter> не определено свойство <xref:System.Runtime.Serialization.ImportOptions>, задайте для свойства новый экземпляр класса <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="84303-282">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="84303-283">Задайте для свойства <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> объекта <xref:System.Runtime.Serialization.ImportOptions> импортера <xref:System.Runtime.Serialization.XsdDataContractImporter> в качестве значения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-283">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="84303-284">Добавьте объект <xref:System.Runtime.Serialization.XsdDataContractImporter> в коллекцию, возвращенную свойством <xref:System.ServiceModel.Description.MetadataExporter.State%2A> объекта <xref:System.ServiceModel.Description.WsdlImporter> (унаследован от класса <xref:System.ServiceModel.Description.MetadataExporter>).</span><span class="sxs-lookup"><span data-stu-id="84303-284">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="84303-285">Используйте метод <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> объекта <xref:System.ServiceModel.Description.WsdlImporter> для импорта всех контрактов данных схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-285">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="84303-286">Во время последнего действия генерируется код из схем, загруженных при вызове суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-286">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="84303-287">Использование суррогата для экспорта метаданных</span><span class="sxs-lookup"><span data-stu-id="84303-287">To Use a surrogate for Metadata Export</span></span>  
 <span data-ttu-id="84303-288">По умолчанию при экспорте метаданных из WCF для службы необходимо создать WSDL и XSD-схемы.</span><span class="sxs-lookup"><span data-stu-id="84303-288">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="84303-289">Суррогат необходимо добавить в компонент, отвечающий за генерацию XSD-схемы для типов контрактов данных, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-289">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="84303-290">Для этого используйте либо поведение, реализующее <xref:System.ServiceModel.Description.IWsdlExportExtension> для изменения <xref:System.ServiceModel.Description.WsdlExporter>, либо напрямую измените объект <xref:System.ServiceModel.Description.WsdlExporter>, который используется для экспорта метаданных.</span><span class="sxs-lookup"><span data-stu-id="84303-290">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="84303-291">Использование суррогата для экспорта метаданных</span><span class="sxs-lookup"><span data-stu-id="84303-291">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="84303-292">Создайте новый объект <xref:System.ServiceModel.Description.WsdlExporter> или используйте параметр `wsdlExporter`, переданный методу <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-292">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="84303-293">Чтобы проверить, определен ли объект <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>, воспользуйтесь функцией <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-293">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="84303-294">Если метод <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> возвращает значение `false`, создайте новый объект <xref:System.Runtime.Serialization.XsdDataContractExporter> со сгенерированными схемами XML из объекта <xref:System.ServiceModel.Description.WsdlExporter>, и добавьте его в коллекцию, возвращенную свойством <xref:System.ServiceModel.Description.MetadataExporter.State%2A> объекта <xref:System.ServiceModel.Description.WsdlExporter>.</span><span class="sxs-lookup"><span data-stu-id="84303-294">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="84303-295">В противном случае используйте экспортер, возвращенный параметром `out` метода <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="84303-295">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="84303-296">Если для экспортера <xref:System.Runtime.Serialization.XsdDataContractExporter> не определен объект <xref:System.Runtime.Serialization.ExportOptions>, задайте для свойства <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> в качестве значения новый экземпляр класса <xref:System.Runtime.Serialization.ExportOptions>.</span><span class="sxs-lookup"><span data-stu-id="84303-296">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="84303-297">Задайте для свойства <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> объекта <xref:System.Runtime.Serialization.ExportOptions> импортера <xref:System.Runtime.Serialization.XsdDataContractExporter> в качестве значения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="84303-297">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="84303-298">Дальнейшие шаги по экспорту метаданных остаются без изменений.</span><span class="sxs-lookup"><span data-stu-id="84303-298">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="84303-299">См. также</span><span class="sxs-lookup"><span data-stu-id="84303-299">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="84303-300">Использование контрактов данных</span><span class="sxs-lookup"><span data-stu-id="84303-300">Using Data Contracts</span></span>](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)
