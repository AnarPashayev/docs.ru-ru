---
title: Общие сведения о модели каналов
ms.date: 03/30/2017
helpviewer_keywords:
- channel model [WCF]
ms.assetid: 07a81e11-3911-4632-90d2-cca99825b5bd
ms.openlocfilehash: 8a71adbc9c9b3f13cde250ff0bfbca67e9f23df9
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96262181"
---
# <a name="channel-model-overview"></a><span data-ttu-id="79108-102">Общие сведения о модели каналов</span><span class="sxs-lookup"><span data-stu-id="79108-102">Channel Model Overview</span></span>

<span data-ttu-id="79108-103">Стек каналов Windows Communication Foundation (WCF) — это многоуровневый стек связи с одним или несколькими каналами, которые обрабатывают сообщения.</span><span class="sxs-lookup"><span data-stu-id="79108-103">The Windows Communication Foundation (WCF) channel stack is a layered communication stack with one or more channels that process messages.</span></span> <span data-ttu-id="79108-104">В нижней части стека находится канал транспорта, отвечающий за адаптацию стека каналов к используемому транспорту (например, TCP, HTTP, SMTP и другим типам транспорта).</span><span class="sxs-lookup"><span data-stu-id="79108-104">At the bottom of the stack is a transport channel that is responsible for adapting the channel stack to the underlying transport (for example, TCP, HTTP, SMTP and other types of transport.).</span></span> <span data-ttu-id="79108-105">Каналы обеспечивают модель низкоуровневого программирования для передачи и приема сообщений.</span><span class="sxs-lookup"><span data-stu-id="79108-105">Channels provide a low-level programming model for sending and receiving messages.</span></span> <span data-ttu-id="79108-106">Эта модель программирования основывается на нескольких интерфейсах и других типах, которые совместно называются моделью WCF Channel.</span><span class="sxs-lookup"><span data-stu-id="79108-106">This programming model relies on several interfaces and other types collectively known as the WCF channel model.</span></span> <span data-ttu-id="79108-107">В данном разделе рассматриваются формы каналов, создание базового прослушивателя каналов (в службе) и фабрики каналов (на клиенте).</span><span class="sxs-lookup"><span data-stu-id="79108-107">This topic discusses channel shapes, the construction of a basic channel listener (on the service) and channel factory (on the client).</span></span>  
  
## <a name="channel-stack"></a><span data-ttu-id="79108-108">Стек каналов</span><span class="sxs-lookup"><span data-stu-id="79108-108">Channel Stack</span></span>  

 <span data-ttu-id="79108-109">Конечные точки WCF взаимодействуют с миром с помощью стека связи, который называется стеком каналов.</span><span class="sxs-lookup"><span data-stu-id="79108-109">WCF endpoints communicate with the world using a communication stack called the channel stack.</span></span> <span data-ttu-id="79108-110">На следующем рисунке стек каналов сравнивается с другими стеками связи, например TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="79108-110">The following diagram compares the channel stack with other communication stacks, for example TCP/IP.</span></span>  
  
 <span data-ttu-id="79108-111">![Модель канала](./media/wcfc-channelstackhighlevelc.gif "wcfc_ChannelStackHighLevelc")</span><span class="sxs-lookup"><span data-stu-id="79108-111">![Channel Model](./media/wcfc-channelstackhighlevelc.gif "wcfc_ChannelStackHighLevelc")</span></span>  
  
 <span data-ttu-id="79108-112">Сначала отметим сходства. В обоих случаях каждый уровень стека обеспечивает некоторое абстрактное представление среды, находящейся под ним, и предоставляет это абстрактное представление только уровню, расположенному непосредственно над ним.</span><span class="sxs-lookup"><span data-stu-id="79108-112">First, the similarities: In both cases, each layer of the stack provides some abstraction of the world below that layer and exposed that abstraction only to the layer directly above it.</span></span> <span data-ttu-id="79108-113">Каждый уровень использует абстрактное представление только уровня, расположенного непосредственно под ним.</span><span class="sxs-lookup"><span data-stu-id="79108-113">Each layer uses the abstraction of only the layer directly below it.</span></span> <span data-ttu-id="79108-114">Кроме того, в обоих случаях при взаимодействии двух стеков каждый уровень взаимодействует с соответствующим уровнем другого стека, например уровень IP взаимодействует с уровнем IP, уровень TCP - с уровнем TCP и т. д.</span><span class="sxs-lookup"><span data-stu-id="79108-114">Also in both cases, when two stacks communicate, each layer communicates with the corresponding layer in the other stack, for example, the IP layer communicates with the IP layer and the TCP layer with the TCP layer, and so on.</span></span>  
  
 <span data-ttu-id="79108-115">Теперь отметим различия. Стек TCP был разработан для обеспечения абстрактного представления физической сети, а стек каналов - для обеспечения абстрактного представления не только способа доставки сообщения, т. е. транспорта, но и других особенностей, например содержимого сообщения, протокола, используемого для взаимодействия, включая транспорт, но не только его.</span><span class="sxs-lookup"><span data-stu-id="79108-115">Now, the differences: While the TCP stack was designed to provide an abstraction of the physical network, the channel stack is designed to provide an abstraction of not only how the message is delivered, that is, the transport, but also other features such as what is in the message or what protocol is used for communication, including the transport but much more than that.</span></span> <span data-ttu-id="79108-116">Например, элемент привязки надежного сеанса является частью стека каналов, но не находится ниже транспорта и не представляет сам транспорт.</span><span class="sxs-lookup"><span data-stu-id="79108-116">For example, reliable session binding element is part of the channel stack but is not below the transport or the transport itself.</span></span> <span data-ttu-id="79108-117">Эта абстракция достигается посредством предъявления нижнему каналу в стеке требования адаптировать базовый транспортный протокол к архитектуре стека каналов и последующего расчета на то, что вышестоящие каналы в стеке должны обеспечивать такие функции связи, как предоставление гарантий надежности и безопасности.</span><span class="sxs-lookup"><span data-stu-id="79108-117">This abstraction is achieved by requiring the bottom channel in the stack to adapt the underlying transport protocol to the channel stack architecture and then relying on channels further up in the stack to provide communication features such as reliability guarantees and security.</span></span>  
  
 <span data-ttu-id="79108-118">Сообщения проходят через стек связи в виде объектов <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="79108-118">Messages flow through the communication stack as <xref:System.ServiceModel.Channels.Message> objects.</span></span> <span data-ttu-id="79108-119">Как показано на представленном выше рисунке, нижний канал называется каналом транспорта.</span><span class="sxs-lookup"><span data-stu-id="79108-119">As shown in figure above, the bottom channel is called a transport channel.</span></span> <span data-ttu-id="79108-120">Этот канал отвечает за передачу сообщений другим участникам и прием сообщений от них,</span><span class="sxs-lookup"><span data-stu-id="79108-120">It is the channel that is responsible for sending and receiving messages to and from other parties.</span></span> <span data-ttu-id="79108-121">в том числе несет ответственность за преобразование объекта <xref:System.ServiceModel.Channels.Message> в формат, используемый для связи с другими участниками, и за обратное преобразование.</span><span class="sxs-lookup"><span data-stu-id="79108-121">This includes the responsibility of transforming the <xref:System.ServiceModel.Channels.Message> object to and from the format used to communicate with other parties.</span></span> <span data-ttu-id="79108-122">Над каналом транспорта может находиться любое число протокольных каналов, каждый из которых отвечает за обеспечение такой функции связи, как предоставление гарантий надежной доставки.</span><span class="sxs-lookup"><span data-stu-id="79108-122">Above the transport channel there can be any number of protocol channels each responsible for providing a communication function such as reliable delivery guarantees.</span></span> <span data-ttu-id="79108-123">Протокольные каналы оперируют с сообщениями, проходящими через них в виде объекта <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="79108-123">Protocol channels operate on messages flowing through them in the form of the <xref:System.ServiceModel.Channels.Message> object.</span></span> <span data-ttu-id="79108-124">Они обычно либо преобразуют сообщение, например добавляя заголовки или шифруя тело сообщения, либо передают и принимают свои собственные управляющие сообщения протокола, например подтверждения приема.</span><span class="sxs-lookup"><span data-stu-id="79108-124">They typically either transform the message, for example, by adding headers or encrypting the body, or send and receive their own protocol control messages, for example, receipt acknowledgments.</span></span>  
  
## <a name="channel-shapes"></a><span data-ttu-id="79108-125">Формы каналов</span><span class="sxs-lookup"><span data-stu-id="79108-125">Channel Shapes</span></span>  

 <span data-ttu-id="79108-126">Каждый канал реализует один или несколько интерфейсов, называемых интерфейсами форм каналов, или формами каналов.</span><span class="sxs-lookup"><span data-stu-id="79108-126">Each channel implements one or more interfaces known as channel shape interfaces or channel shapes.</span></span> <span data-ttu-id="79108-127">Эти формы каналов обеспечивают такие ориентированные на взаимодействие методы, как передача и прием или запрос и ответ, которые реализуются каналом и вызываются пользователем канала.</span><span class="sxs-lookup"><span data-stu-id="79108-127">Those channel shapes provide the communication-oriented methods such as send and receive or request and reply that the channel implements and the user of the channel calls.</span></span> <span data-ttu-id="79108-128">В основе фигур канала находится <xref:System.ServiceModel.Channels.IChannel> интерфейс, который предоставляет `GetProperty` \<T> метод, предназначенный для использования в качестве многоуровневого механизма для доступа к произвольным функциям, предоставляемым каналами в стеке.</span><span class="sxs-lookup"><span data-stu-id="79108-128">At the base of the channel shapes is the <xref:System.ServiceModel.Channels.IChannel> interface, which is an interface that provides a `GetProperty`\<T> method intended as a layered mechanism to access arbitrary features exposed by channels in the stack.</span></span> <span data-ttu-id="79108-129">Ниже перечислены пять форм каналов, расширяющих интерфейс <xref:System.ServiceModel.Channels.IChannel>.</span><span class="sxs-lookup"><span data-stu-id="79108-129">The five channel shapes that extend <xref:System.ServiceModel.Channels.IChannel> are:</span></span>  
  
- <xref:System.ServiceModel.Channels.IInputChannel>  
  
- <xref:System.ServiceModel.Channels.IOutputChannel>  
  
- <xref:System.ServiceModel.Channels.IRequestChannel>  
  
- <xref:System.ServiceModel.Channels.IReplyChannel>  
  
- <xref:System.ServiceModel.Channels.IDuplexChannel>  
  
 <span data-ttu-id="79108-130">Каждая из этих форм имеет эквивалент, который расширяет <xref:System.ServiceModel.Channels.ISessionChannel%601?displayProperty=nameWithType> для поддержки сеансов.</span><span class="sxs-lookup"><span data-stu-id="79108-130">Further, each of these shapes has an equivalent that extends <xref:System.ServiceModel.Channels.ISessionChannel%601?displayProperty=nameWithType> to support sessions.</span></span> <span data-ttu-id="79108-131">Эти особые значения приведены ниже.</span><span class="sxs-lookup"><span data-stu-id="79108-131">These are:</span></span>  
  
- <xref:System.ServiceModel.Channels.IInputSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IOutputSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IRequestSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IReplySessionChannel>  
  
- <xref:System.ServiceModel.Channels.IDuplexSessionChannel>  
  
 <span data-ttu-id="79108-132">Формы каналов создаются в соответствии с некоторыми базовыми шаблонами обмена сообщениями, поддерживаемыми существующими транспортными протоколами.</span><span class="sxs-lookup"><span data-stu-id="79108-132">The channel shapes are patterned after some of the fundamental message exchange patterns supported by existing transport protocols.</span></span> <span data-ttu-id="79108-133">Например, односторонняя обмен сообщениями соответствует <xref:System.ServiceModel.Channels.IInputChannel> / <xref:System.ServiceModel.Channels.IOutputChannel> паре, "запрос-ответ <xref:System.ServiceModel.Channels.IRequestChannel> / <xref:System.ServiceModel.Channels.IReplyChannel> " соответствует парам, а двусторонняя дуплексная связь соответствует <xref:System.ServiceModel.Channels.IDuplexChannel> (которая расширяет <xref:System.ServiceModel.Channels.IInputChannel> и, и <xref:System.ServiceModel.Channels.IOutputChannel> ).</span><span class="sxs-lookup"><span data-stu-id="79108-133">For example, one-way messaging corresponds to an <xref:System.ServiceModel.Channels.IInputChannel>/<xref:System.ServiceModel.Channels.IOutputChannel> pair, request-reply corresponds to <xref:System.ServiceModel.Channels.IRequestChannel>/<xref:System.ServiceModel.Channels.IReplyChannel> pairs and two-way duplex communications corresponds to <xref:System.ServiceModel.Channels.IDuplexChannel> (which extends both <xref:System.ServiceModel.Channels.IInputChannel> and <xref:System.ServiceModel.Channels.IOutputChannel>).</span></span>  
  
## <a name="programming-with-the-channel-stack"></a><span data-ttu-id="79108-134">Программирование со стеком каналов</span><span class="sxs-lookup"><span data-stu-id="79108-134">Programming with the Channel Stack</span></span>  

 <span data-ttu-id="79108-135">Стеки каналов обычно создаются с помощью шаблона фабрики, где привязка создает стек каналов.</span><span class="sxs-lookup"><span data-stu-id="79108-135">Channel stacks are typically created using a factory pattern where a binding creates the channel stack.</span></span> <span data-ttu-id="79108-136">На стороне передачи привязка используется для создания фабрики <xref:System.ServiceModel.ChannelFactory>, которая, в свою очередь, создает стек каналов и возвращает ссылку на верхний канал в стеке.</span><span class="sxs-lookup"><span data-stu-id="79108-136">On the send side, a binding is used to build a <xref:System.ServiceModel.ChannelFactory>, which in turn builds a channel stack and returns a reference to the top channel in the stack.</span></span> <span data-ttu-id="79108-137">Затем приложение может использовать этот канал для передачи сообщений.</span><span class="sxs-lookup"><span data-stu-id="79108-137">The application can then use this channel to send messages.</span></span> <span data-ttu-id="79108-138">Дополнительные сведения см. в разделе [программирование клиентских Channel-Level](client-channel-level-programming.md).</span><span class="sxs-lookup"><span data-stu-id="79108-138">For more information, see [Client Channel-Level Programming](client-channel-level-programming.md).</span></span>  
  
 <span data-ttu-id="79108-139">На стороне приема привязка используется для создания прослушивателя <xref:System.ServiceModel.Channels.IChannelListener>, который прослушивает входящие сообщения.</span><span class="sxs-lookup"><span data-stu-id="79108-139">On the receive side a binding is used to build a <xref:System.ServiceModel.Channels.IChannelListener>, which listens for incoming messages.</span></span> <span data-ttu-id="79108-140"><xref:System.ServiceModel.Channels.IChannelListener> предоставляет сообщения прослушивающему приложению, создавая стеки каналов и обрабатывая ссылку приложения на верхний канал.</span><span class="sxs-lookup"><span data-stu-id="79108-140">The <xref:System.ServiceModel.Channels.IChannelListener> provides messages to the listening application by creating channel stacks and handing the application reference to the top channel.</span></span> <span data-ttu-id="79108-141">Затем приложение использует этот канал для приема входящих сообщений.</span><span class="sxs-lookup"><span data-stu-id="79108-141">The application then uses this channel to receive incoming messages.</span></span> <span data-ttu-id="79108-142">Дополнительные сведения см. в статье [Программирование служб Channel-Level](service-channel-level-programming.md).</span><span class="sxs-lookup"><span data-stu-id="79108-142">For more information, see [Service Channel-Level Programming](service-channel-level-programming.md).</span></span>  
  
## <a name="the-channel-object-model"></a><span data-ttu-id="79108-143">Объектная модель каналов</span><span class="sxs-lookup"><span data-stu-id="79108-143">The Channel Object Model</span></span>  

 <span data-ttu-id="79108-144">Объектная модель каналов - это базовый набор интерфейсов, необходимых для реализации каналов, прослушивателей каналов и фабрик каналов.</span><span class="sxs-lookup"><span data-stu-id="79108-144">The channel object model is the core set of interfaces required to implement channels, channel listeners and channel factories.</span></span> <span data-ttu-id="79108-145">Существуют также некоторые базовые классы, предусмотренные для содействия в обеспечении пользовательских реализаций.</span><span class="sxs-lookup"><span data-stu-id="79108-145">There are also some base classes provided to assist in custom implementations.</span></span>  
  
 <span data-ttu-id="79108-146">Прослушиватели каналов отвечают за прослушивание входящих сообщений и их доставку вышестоящему уровню по созданным ими каналам.</span><span class="sxs-lookup"><span data-stu-id="79108-146">Channel listeners are responsible for listening for incoming messages, then delivering them to the layer above through channels created by the channel listener.</span></span>  
  
 <span data-ttu-id="79108-147">Фабрики каналов отвечают за создание каналов, используемых для передачи сообщений, и за закрытие всех созданных ими каналов, когда эти фабрики закрываются.</span><span class="sxs-lookup"><span data-stu-id="79108-147">Channel factories are responsible for creating channels that are used for sending messages and for closing all channels they created when the channel factory is closed.</span></span>  
  
 <span data-ttu-id="79108-148"><xref:System.ServiceModel.ICommunicationObject> - это базовый интерфейс, определяющий основной конечный автомат, который реализуют все объекты, обменивающиеся сообщениями.</span><span class="sxs-lookup"><span data-stu-id="79108-148"><xref:System.ServiceModel.ICommunicationObject> is the core interface that defines the basic state machine that all communication objects implement.</span></span> <span data-ttu-id="79108-149"><xref:System.ServiceModel.Channels.CommunicationObject> предоставляет реализацию этого базового интерфейса, от которого можно наследовать другие классы каналов, что позволяет избежать повторной реализации интерфейса.</span><span class="sxs-lookup"><span data-stu-id="79108-149"><xref:System.ServiceModel.Channels.CommunicationObject> provides an implementation of this core interface that other channel classes can derive from rather than re-implementing the interface.</span></span> <span data-ttu-id="79108-150">Однако это необязательно: пользовательский канал может реализовать интерфейс <xref:System.ServiceModel.ICommunicationObject> непосредственно, а не наследовать его от <xref:System.ServiceModel.Channels.CommunicationObject>.</span><span class="sxs-lookup"><span data-stu-id="79108-150">However, this is not required: a custom channel can implement <xref:System.ServiceModel.ICommunicationObject> directly and not inherit from <xref:System.ServiceModel.Channels.CommunicationObject>.</span></span> <span data-ttu-id="79108-151">Ни один из классов, показанных на рис. 3, не считается частью модели каналов; это вспомогательные классы, доступные тем, кто занимается реализацией пользовательских каналов и нуждается в средствах создания каналов.</span><span class="sxs-lookup"><span data-stu-id="79108-151">None of the classes in Figure 3 are considered part of the channel model; they are helpers available to custom channel implementers who want to build channels.</span></span>  
  
 <span data-ttu-id="79108-152">![Модель канала](./media/wcfc-wcfcchannelsigure3omumtreec.gif "wcfc_WCFCChannelsigure3OMUMTreec")</span><span class="sxs-lookup"><span data-stu-id="79108-152">![Channel model](./media/wcfc-wcfcchannelsigure3omumtreec.gif "wcfc_WCFCChannelsigure3OMUMTreec")</span></span>  
  
 <span data-ttu-id="79108-153">В следующих разделах описываются объектная модель каналов, а также различные области разработки, помогающие создавать пользовательские каналы.</span><span class="sxs-lookup"><span data-stu-id="79108-153">The following topics describe the channel object model as well as various development areas that help build custom channels.</span></span>  
  
|<span data-ttu-id="79108-154">Раздел</span><span class="sxs-lookup"><span data-stu-id="79108-154">Topic</span></span>|<span data-ttu-id="79108-155">Описание</span><span class="sxs-lookup"><span data-stu-id="79108-155">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="79108-156">Служба: прослушиватели каналов и каналы</span><span class="sxs-lookup"><span data-stu-id="79108-156">Service: Channel Listeners and Channels</span></span>](service-channel-listeners-and-channels.md)|<span data-ttu-id="79108-157">Описываются прослушиватели каналов, ожидающие передачи данных по входящим каналам в приложении службы.</span><span class="sxs-lookup"><span data-stu-id="79108-157">Describes channel listeners, which listen for incoming channels in a service application.</span></span>|  
|[<span data-ttu-id="79108-158">Клиент: Фабрики каналов и каналы</span><span class="sxs-lookup"><span data-stu-id="79108-158">Client: Channel Factories and Channels</span></span>](client-channel-factories-and-channels.md)|<span data-ttu-id="79108-159">Описываются фабрики каналов, которые создают каналы для подключения к приложению службы.</span><span class="sxs-lookup"><span data-stu-id="79108-159">Describes channel factories, which create channels to connect to a service application.</span></span>|  
|[<span data-ttu-id="79108-160">Основные сведения об изменении состояния</span><span class="sxs-lookup"><span data-stu-id="79108-160">Understanding State Changes</span></span>](understanding-state-changes.md)|<span data-ttu-id="79108-161">Описывается, как модели интерфейса <xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType> изменяют состояния в каналах.</span><span class="sxs-lookup"><span data-stu-id="79108-161">Describes how the <xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType> interface models state changes in channels.</span></span>|  
|[<span data-ttu-id="79108-162">Выбор шаблона обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="79108-162">Choosing a Message Exchange Pattern</span></span>](choosing-a-message-exchange-pattern.md)|<span data-ttu-id="79108-163">Описываются шесть базовых шаблонов обмена сообщениями, которые могут поддерживаться каналами.</span><span class="sxs-lookup"><span data-stu-id="79108-163">Describes the six basic message exchange patterns that channels can support.</span></span>|  
|[<span data-ttu-id="79108-164">Обработка исключений и сбоев</span><span class="sxs-lookup"><span data-stu-id="79108-164">Handling Exceptions and Faults</span></span>](handling-exceptions-and-faults.md)|<span data-ttu-id="79108-165">Описываются способы обработки сбоев и исключений в пользовательских каналах.</span><span class="sxs-lookup"><span data-stu-id="79108-165">Describes how to handle faults and exceptions in custom channels.</span></span>|  
|[<span data-ttu-id="79108-166">Конфигурация и поддержка метаданных</span><span class="sxs-lookup"><span data-stu-id="79108-166">Configuration and Metadata Support</span></span>](configuration-and-metadata-support.md)|<span data-ttu-id="79108-167">Описываются поддержка использования пользовательских каналов из модели приложения, а также экспорт и импорт метаданных с использованием привязок и элементов привязок.</span><span class="sxs-lookup"><span data-stu-id="79108-167">Describes how to support the use of custom channels from the application model and how to export and import metadata using bindings and binding elements.</span></span>|
