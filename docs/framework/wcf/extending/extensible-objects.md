---
title: Расширяемые объекты
ms.date: 03/30/2017
helpviewer_keywords:
- extensible objects [WCF]
ms.assetid: bc88cefc-31fb-428e-9447-6d20a7d452af
ms.openlocfilehash: 682c391e7b3c68de5bf799f77a93df7539681a37
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64654487"
---
# <a name="extensible-objects"></a><span data-ttu-id="9f55c-102">Расширяемые объекты</span><span class="sxs-lookup"><span data-stu-id="9f55c-102">Extensible Objects</span></span>

<span data-ttu-id="9f55c-103">Шаблон расширяемого объекта используется для расширения существующих классов среды выполнения при помощи новых функций или добавления нового состояния к объекту.</span><span class="sxs-lookup"><span data-stu-id="9f55c-103">The extensible object pattern is used to either extend existing runtime classes with new functionality or to add new state to an object.</span></span> <span data-ttu-id="9f55c-104">Расширения, привязанные к одному из расширяемых объектов, позволяют использовать поведения на различных этапах обработки для получения доступа к общему состоянию и функциональности, привязанным к общему расширяемому объекту, к которому они могут получить доступ.</span><span class="sxs-lookup"><span data-stu-id="9f55c-104">Extensions, attached to one of the extensible objects, enable behaviors at very different stages in processing to access shared state and functionality attached to a common extensible object that they can access.</span></span>

## <a name="the-iextensibleobjectt-pattern"></a><span data-ttu-id="9f55c-105">IExtensibleObject\<T > шаблон</span><span class="sxs-lookup"><span data-stu-id="9f55c-105">The IExtensibleObject\<T> Pattern</span></span>

<span data-ttu-id="9f55c-106">Предусмотрено три интерфейса в шаблоне расширяемого объекта: <xref:System.ServiceModel.IExtensibleObject%601>, <xref:System.ServiceModel.IExtension%601> и <xref:System.ServiceModel.IExtensionCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-106">There are three interfaces in the extensible object pattern: <xref:System.ServiceModel.IExtensibleObject%601>, <xref:System.ServiceModel.IExtension%601>, and <xref:System.ServiceModel.IExtensionCollection%601>.</span></span>

<span data-ttu-id="9f55c-107">Интерфейс <xref:System.ServiceModel.IExtensibleObject%601> реализуется типами, которые позволяют объектам <xref:System.ServiceModel.IExtension%601> настроить свою функциональность.</span><span class="sxs-lookup"><span data-stu-id="9f55c-107">The <xref:System.ServiceModel.IExtensibleObject%601> interface is implemented by types that allow <xref:System.ServiceModel.IExtension%601> objects to customize their functionality.</span></span>

<span data-ttu-id="9f55c-108">Расширяемые объекты обеспечивают динамическое агрегирование объектов <xref:System.ServiceModel.IExtension%601>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-108">Extensible objects allow dynamic aggregation of <xref:System.ServiceModel.IExtension%601> objects.</span></span> <span data-ttu-id="9f55c-109">Объекты <xref:System.ServiceModel.IExtension%601> характеризуются следующим интерфейсом:</span><span class="sxs-lookup"><span data-stu-id="9f55c-109"><xref:System.ServiceModel.IExtension%601> objects are characterized by the following interface:</span></span>

```csharp
public interface IExtension<T>
where T : IExtensibleObject<T>
{
    void Attach(T owner);
    void Detach(T owner);
}
```

<span data-ttu-id="9f55c-110">Ограничение типов гарантирует, что расширения можно определить только для классов <xref:System.ServiceModel.IExtensibleObject%601>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-110">The type restriction guarantees that extensions can only be defined for classes that are <xref:System.ServiceModel.IExtensibleObject%601>.</span></span> <span data-ttu-id="9f55c-111">Методы<xref:System.ServiceModel.IExtension%601.Attach%2A> и <xref:System.ServiceModel.IExtension%601.Detach%2A> предоставляют уведомление об агрегировании или деагрегировании.</span><span class="sxs-lookup"><span data-stu-id="9f55c-111"><xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A> provide notification of aggregation or disaggregation.</span></span>

<span data-ttu-id="9f55c-112">Реализации могут ограничивать, если их можно добавить и удалить из владельца.</span><span class="sxs-lookup"><span data-stu-id="9f55c-112">It is valid for implementations to restrict when they may be added and removed from an owner.</span></span> <span data-ttu-id="9f55c-113">Например, можно полностью запретить удаление, запретить добавление или удаление расширений, когда владелец или расширение находится в определенном состоянии, запретить одновременное добавление в несколько владельцев или разрешить только одно добавление с последующим одним удалением.</span><span class="sxs-lookup"><span data-stu-id="9f55c-113">For example, you can disallow removal entirely, disallowing adding or removing extensions when the owner or extension are in a certain state, disallow adding to multiple owners concurrently, or allow only a single addition followed by a single remove.</span></span>

<span data-ttu-id="9f55c-114">В шаблоне <xref:System.ServiceModel.IExtension%601> не подразумевается никаких взаимодействий с другими стандартными управляемыми интерфейсами.</span><span class="sxs-lookup"><span data-stu-id="9f55c-114"><xref:System.ServiceModel.IExtension%601> does not imply any interactions with other standard managed interfaces.</span></span> <span data-ttu-id="9f55c-115">В частности, метод <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> в объекте владельца, как правило, не отсоединяет его расширения.</span><span class="sxs-lookup"><span data-stu-id="9f55c-115">Specifically, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method on the owner object does not normally detach its extensions.</span></span>

<span data-ttu-id="9f55c-116">При добавлении расширения в коллекцию <xref:System.ServiceModel.IExtension%601.Attach%2A> вызывается перед отправкой его в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="9f55c-116">When an extension is added to the collection, <xref:System.ServiceModel.IExtension%601.Attach%2A> is called before it goes into the collection.</span></span> <span data-ttu-id="9f55c-117">При удалении расширения из коллекции, <xref:System.ServiceModel.IExtension%601.Detach%2A> вызывается после того, он удаляется.</span><span class="sxs-lookup"><span data-stu-id="9f55c-117">When an extension is removed from the collection, <xref:System.ServiceModel.IExtension%601.Detach%2A> is called after it is removed.</span></span> <span data-ttu-id="9f55c-118">Это значит (предполагая соответствующую синхронизацию) расширения могли полагаться на только найден в коллекции, когда элемент находится в диапазоне от <xref:System.ServiceModel.IExtension%601.Attach%2A> и <xref:System.ServiceModel.IExtension%601.Detach%2A>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-118">This means (assuming appropriate synchronization) an extension can count on only being found in the collection while it is between <xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A>.</span></span>

<span data-ttu-id="9f55c-119">Нет необходимости, чтобы объект, переданный методу <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> или методу <xref:System.ServiceModel.IExtensionCollection%601.Find%2A>, был объектом <xref:System.ServiceModel.IExtension%601> (например, можно передать любой объект), но возвращенное расширение должно быть расширением <xref:System.ServiceModel.IExtension%601>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-119">The object passed to <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> or <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> need not be <xref:System.ServiceModel.IExtension%601> (for example, you can pass any object), but the returned extension is an <xref:System.ServiceModel.IExtension%601>.</span></span>

<span data-ttu-id="9f55c-120">Если нет расширения в коллекции <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> возвращает значение null, и <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> возвращает пустую коллекцию.</span><span class="sxs-lookup"><span data-stu-id="9f55c-120">If no extension in the collection is an <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> returns null, and <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> returns an empty collection.</span></span> <span data-ttu-id="9f55c-121">Если несколько расширений реализуют <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> возвращает одно из них.</span><span class="sxs-lookup"><span data-stu-id="9f55c-121">If multiple extensions implement <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> returns one of them.</span></span> <span data-ttu-id="9f55c-122">Значение, возвращаемое методом <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A>, является моментальным снимком.</span><span class="sxs-lookup"><span data-stu-id="9f55c-122">The value returned from <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> is a snapshot.</span></span>

<span data-ttu-id="9f55c-123">Имеется два основных сценария.</span><span class="sxs-lookup"><span data-stu-id="9f55c-123">There are two main scenarios.</span></span> <span data-ttu-id="9f55c-124">В первом сценарии свойство <xref:System.ServiceModel.IExtensibleObject%601.Extensions%2A> используется как основанный на типах словарь для вставки состояния в объект с целью предоставления другому компоненту возможности просматривать его с помощью типа.</span><span class="sxs-lookup"><span data-stu-id="9f55c-124">The first scenario uses the <xref:System.ServiceModel.IExtensibleObject%601.Extensions%2A> property as a type-based dictionary to insert state on an object to enable another component to look it up using the type.</span></span>

<span data-ttu-id="9f55c-125">Во втором сценарии свойства <xref:System.ServiceModel.IExtension%601.Attach%2A> и <xref:System.ServiceModel.IExtension%601.Detach%2A> используются для предоставления объекту возможности участвовать в пользовательском поведении, таком как регистрация событий, наблюдение за переходами между состояниями и т. д.</span><span class="sxs-lookup"><span data-stu-id="9f55c-125">The second scenario uses the <xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A> properties to enable an object to participate in custom behavior, such as registering for events, watching state transitions, and so on.</span></span>

<span data-ttu-id="9f55c-126">Интерфейс <xref:System.ServiceModel.IExtensionCollection%601> - это коллекция объектов <xref:System.ServiceModel.IExtension%601>, которая позволяет получить экземпляр <xref:System.ServiceModel.IExtension%601> по его типу.</span><span class="sxs-lookup"><span data-stu-id="9f55c-126">The <xref:System.ServiceModel.IExtensionCollection%601> interface is a collection of the <xref:System.ServiceModel.IExtension%601> objects that allow for retrieving the <xref:System.ServiceModel.IExtension%601> by its type.</span></span> <span data-ttu-id="9f55c-127">Метод <xref:System.ServiceModel.IExtensionCollection%601.Find%2A?displayProperty=nameWithType> возвращает последний добавленный объект <xref:System.ServiceModel.IExtension%601> данного типа.</span><span class="sxs-lookup"><span data-stu-id="9f55c-127"><xref:System.ServiceModel.IExtensionCollection%601.Find%2A?displayProperty=nameWithType> returns the most recently added object that is an <xref:System.ServiceModel.IExtension%601> of that type.</span></span>

### <a name="extensible-objects-in-windows-communication-foundation"></a><span data-ttu-id="9f55c-128">Расширяемые объекты в Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="9f55c-128">Extensible Objects in Windows Communication Foundation</span></span>

<span data-ttu-id="9f55c-129">Существуют четыре расширяемых объекта в Windows Communication Foundation (WCF):</span><span class="sxs-lookup"><span data-stu-id="9f55c-129">There are four extensible objects in Windows Communication Foundation (WCF):</span></span>

- <span data-ttu-id="9f55c-130"><xref:System.ServiceModel.ServiceHostBase>. Это базовый класс для узла службы.</span><span class="sxs-lookup"><span data-stu-id="9f55c-130"><xref:System.ServiceModel.ServiceHostBase> – This is the base class for the service’s host.</span></span>  <span data-ttu-id="9f55c-131">Расширения этого класса можно использовать для расширения поведения самого класса <xref:System.ServiceModel.ServiceHostBase> или для хранения состояния для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="9f55c-131">Extensions of this class can be used to extend the behavior of the <xref:System.ServiceModel.ServiceHostBase> itself or to store the state for each service.</span></span>

- <span data-ttu-id="9f55c-132"><xref:System.ServiceModel.InstanceContext>. Этот класс соединяет экземпляр типа службы и среду выполнения службы.</span><span class="sxs-lookup"><span data-stu-id="9f55c-132"><xref:System.ServiceModel.InstanceContext> – This class connects an instance of the service’s type with the service runtime.</span></span>  <span data-ttu-id="9f55c-133">В нем содержится информация об экземпляре, а также ссылка на класс <xref:System.ServiceModel.InstanceContext>, содержащий класс <xref:System.ServiceModel.ServiceHostBase>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-133">It contains information about the instance as well as a reference to the <xref:System.ServiceModel.InstanceContext>'s containing <xref:System.ServiceModel.ServiceHostBase>.</span></span> <span data-ttu-id="9f55c-134">Расширения этого класса можно использовать для расширения поведения самого класса <xref:System.ServiceModel.InstanceContext> или для хранения состояния для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="9f55c-134">Extensions of this class can be used to extend the behavior of the <xref:System.ServiceModel.InstanceContext> or to store the state for each service.</span></span>

- <span data-ttu-id="9f55c-135"><xref:System.ServiceModel.OperationContext>. Этот класс представляет данные об операциях, собранные средой выполнения для каждой операции.</span><span class="sxs-lookup"><span data-stu-id="9f55c-135"><xref:System.ServiceModel.OperationContext> – This class represents the operation information that the runtime gathers for each operation.</span></span>  <span data-ttu-id="9f55c-136">Сюда входят такие данные как заголовки входящих сообщений, свойства входящих сообщений, идентификация входящих сообщений и др.</span><span class="sxs-lookup"><span data-stu-id="9f55c-136">This includes information such as the incoming message headers, the incoming message properties, the incoming security identity, and other information.</span></span>  <span data-ttu-id="9f55c-137">Расширения этого класса можно использовать как для расширения поведения класса <xref:System.ServiceModel.OperationContext>, так и для хранения состояния для каждой операции.</span><span class="sxs-lookup"><span data-stu-id="9f55c-137">Extensions of this class can either extend the behavior of <xref:System.ServiceModel.OperationContext> or store the state for each operation.</span></span>

- <span data-ttu-id="9f55c-138"><xref:System.ServiceModel.IContextChannel> – Этот интерфейс обеспечивает проверку каждого состояния для каналов и прокси-серверы, созданные средой выполнения WCF.</span><span class="sxs-lookup"><span data-stu-id="9f55c-138"><xref:System.ServiceModel.IContextChannel> – This interface allows for the inspection of each state for the channels and proxies built by the WCF runtime.</span></span>  <span data-ttu-id="9f55c-139">Расширения этого класса можно использовать как для расширения поведения класса <xref:System.ServiceModel.IClientChannel>, так и для хранения состояния для каждого канала.</span><span class="sxs-lookup"><span data-stu-id="9f55c-139">Extensions of this class can either extend the behavior of <xref:System.ServiceModel.IClientChannel> or can use it to store the state for each channel.</span></span>

<span data-ttu-id="9f55c-140">В следующем примере кода показано использование простого расширения для отслеживания объектов <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="9f55c-140">The following code example shows the use of a simple extension to track <xref:System.ServiceModel.InstanceContext> objects.</span></span>

[!code-csharp[IInstanceContextInitializer#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/iinstancecontextinitializer/cs/initializer.cs#1)]

## <a name="see-also"></a><span data-ttu-id="9f55c-141">См. также</span><span class="sxs-lookup"><span data-stu-id="9f55c-141">See also</span></span>

- <xref:System.ServiceModel.IExtensibleObject%601>
- <xref:System.ServiceModel.IExtension%601>
- <xref:System.ServiceModel.IExtensionCollection%601>
