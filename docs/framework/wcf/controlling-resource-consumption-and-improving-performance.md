---
title: Управление потреблением ресурсов и повышение производительности
ms.date: 03/30/2017
ms.assetid: 9a829669-5f76-4c88-80ec-92d0c62c0660
ms.openlocfilehash: 16d6f29235455ff30e115b7aff3425412bc7ba6a
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802257"
---
# <a name="controlling-resource-consumption-and-improving-performance"></a><span data-ttu-id="6f180-102">Управление потреблением ресурсов и повышение производительности</span><span class="sxs-lookup"><span data-stu-id="6f180-102">Controlling Resource Consumption and Improving Performance</span></span>
<span data-ttu-id="6f180-103">В этом разделе описываются различные свойства в различных областях архитектуры Windows Communication Foundation (WCF), которые работают для управления потреблением ресурсов и влияют на метрики производительности.</span><span class="sxs-lookup"><span data-stu-id="6f180-103">This topic describes various properties in different areas of the Windows Communication Foundation (WCF) architecture that work to control resource consumption and affect performance metrics.</span></span>

## <a name="properties-that-constrain-resource-consumption-in-wcf"></a><span data-ttu-id="6f180-104">Свойства, ограничивающие потребление ресурсов в WCF</span><span class="sxs-lookup"><span data-stu-id="6f180-104">Properties that Constrain Resource Consumption in WCF</span></span>
 <span data-ttu-id="6f180-105">Windows Communication Foundation (WCF) применяет ограничения для определенных типов процессов в целях безопасности или производительности.</span><span class="sxs-lookup"><span data-stu-id="6f180-105">Windows Communication Foundation (WCF) applies constraints on certain types of processes for either security or performance purposes.</span></span> <span data-ttu-id="6f180-106">Такие ограничения накладываются в двух основных формах: квот и регулировок.</span><span class="sxs-lookup"><span data-stu-id="6f180-106">These constraints come in two main forms, either quotas and throttles.</span></span> <span data-ttu-id="6f180-107">*Квоты* — это ограничения, которые при достижении или превышении этого условия вызывают немедленное исключение в некоторой точке системы.</span><span class="sxs-lookup"><span data-stu-id="6f180-107">*Quotas* are limits that when reached or exceeded trigger an immediate exception at some point in the system.</span></span> <span data-ttu-id="6f180-108">*Регулирование* — это ограничения, которые не вызывают немедленное исключение.</span><span class="sxs-lookup"><span data-stu-id="6f180-108">*Throttles* are limits that do not immediately cause an exception to be thrown.</span></span> <span data-ttu-id="6f180-109">Вместо этого по достижении предела регулировки обработка продолжается, но уже в рамках пределов, установленных значением регулировки.</span><span class="sxs-lookup"><span data-stu-id="6f180-109">Instead, when a throttle limit is reached, processing continues but within the limits set by that throttle value.</span></span> <span data-ttu-id="6f180-110">Во время ограниченной таким образом обработки исключение, в зависимости от приложения, может быть вызвано в другом месте.</span><span class="sxs-lookup"><span data-stu-id="6f180-110">This limited processing might trigger an exception elsewhere, but this depends upon the application.</span></span>

 <span data-ttu-id="6f180-111">Кроме различий между квотами и регулировками, некоторые ограничивающие свойства располагаются на уровне сериализации, некоторые - на транспортном уровне, некоторые - на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="6f180-111">In addition to the distinction between quotas and throttles, some constraining properties are located at the serialization level, some at the transport level, and some at the application level.</span></span> <span data-ttu-id="6f180-112">Например, чтобы препятствовать атакам типа «отказ в обслуживании» на службу со стороны вредоносных клиентов, приводящим к чрезмерному потреблению памяти, квота <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, реализованная всеми поддерживаемыми системой элементами привязки транспорта, по умолчанию имеет значение 65 536.</span><span class="sxs-lookup"><span data-stu-id="6f180-112">For example, the quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, which is implemented by all system-supplied transport binding elements, is set to 65,536 bytes by default to hinder malicious clients from engaging in denial-of-service attacks against a service by causing excessive memory consumption.</span></span> <span data-ttu-id="6f180-113">(Обычно, уменьшая это значение, можно увеличить производительность.)</span><span class="sxs-lookup"><span data-stu-id="6f180-113">(Typically, you can increase performance by lowering this value.)</span></span>

 <span data-ttu-id="6f180-114">Примером квоты сериализации является свойство <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType>, задающее максимальное число объектов, которые сериализатор сериализует или десериализует за один вызов метода <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="6f180-114">An example of a serialization quota is the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property, which specifies the maximum number of objects that the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A> method call.</span></span> <span data-ttu-id="6f180-115">Примером регулировки на уровне приложения является свойство <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType>, которое по умолчанию ограничивает до 10 число одновременных подключений каналов сеанса.</span><span class="sxs-lookup"><span data-stu-id="6f180-115">An example of an application-level throttle is the <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType> property, which by default restricts the number of concurrent sessionful channel connections to 10.</span></span> <span data-ttu-id="6f180-116">(В отличие от квот, по достижении значения, заданного регулировкой, приложение продолжает обработку, но не принимает новые каналы сеанса - это означает, что новые клиенты не могут подключиться, пока не прекратится соединение по одному из каналов сеанса.)</span><span class="sxs-lookup"><span data-stu-id="6f180-116">(Unlike the quotas, if this throttle value is reached, the application continues processing but accepts no new sessionful channels, which means that new clients cannot connect until one of the other sessionful channels is ended.)</span></span>

 <span data-ttu-id="6f180-117">Данные элементы управления представляют собой встроенное устранение рисков от некоторых типов атак или улучшают метрики производительности, такие как используемый объем памяти, время запуска и т. п.</span><span class="sxs-lookup"><span data-stu-id="6f180-117">These controls are designed to provide an out-of-the-box mitigation against certain types of attacks or to improve performance metrics such as memory footprint, start-up time, and so on.</span></span> <span data-ttu-id="6f180-118">Однако, в зависимости от приложения, данные элементы управления могут снижать производительность приложения службы или вовсе препятствовать работе приложения.</span><span class="sxs-lookup"><span data-stu-id="6f180-118">However, depending on the application, these controls can impede service application performance or prevent the application from working at all.</span></span> <span data-ttu-id="6f180-119">Например, приложение, предназначенное для потокового видео, может легко превысить заданное по умолчанию свойство <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6f180-119">For example, an application designed to stream video can easily exceed the default <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="6f180-120">В этом разделе приводятся общие сведения о различных элементах управления, применяемых к приложениям на всех уровнях WCF, описаны различные способы получения дополнительных сведений о том, мешает ли параметр приложению, и описывает способы устранения различных проблем.</span><span class="sxs-lookup"><span data-stu-id="6f180-120">This topic provides an overview of the various controls applied to applications at all levels of WCF, describes various ways to obtain more information about whether a setting is hindering your application, and describes ways to correct various problems.</span></span> <span data-ttu-id="6f180-121">Большинство ограничителей и некоторые квоты доступны на уровне приложения, даже когда базовым свойством является ограничение сериализации или транспорта.</span><span class="sxs-lookup"><span data-stu-id="6f180-121">Most throttles and some quotas are available at the application level, even when the base property is a serialization or transport constraint.</span></span> <span data-ttu-id="6f180-122">Например, можно задать в классе службы свойство <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> с помощью свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6f180-122">For example, you can set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property using the <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property on the service class.</span></span>

> [!NOTE]
> <span data-ttu-id="6f180-123">Если у вас возникла определенная проблема, сначала ознакомьтесь с [кратким руководством по устранению неполадок WCF](wcf-troubleshooting-quickstart.md) , чтобы узнать, присутствует ли в нем проблема (и решение).</span><span class="sxs-lookup"><span data-stu-id="6f180-123">If you have a particular problem, you should first read the [WCF Troubleshooting Quickstart](wcf-troubleshooting-quickstart.md) to see whether your problem (and a solution) is listed there.</span></span>

 <span data-ttu-id="6f180-124">Свойства, ограничивающие процессы сериализации, перечислены в разделе [вопросы безопасности данных](./feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="6f180-124">Properties that restrict serialization processes are listed in [Security Considerations for Data](./feature-details/security-considerations-for-data.md).</span></span> <span data-ttu-id="6f180-125">Свойства, ограничивающие потребление ресурсов, связанных с транспортами, перечислены в [квотах транспорта](./feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="6f180-125">Properties that restrict the consumption of resources related to transports are listed in [Transport Quotas](./feature-details/transport-quotas.md).</span></span> <span data-ttu-id="6f180-126">Свойства, ограничивающие потребление ресурсов на уровне приложения, являются членами класса <xref:System.ServiceModel.Dispatcher.ServiceThrottle>.</span><span class="sxs-lookup"><span data-stu-id="6f180-126">Properties that restrict the consumption of resources at the application layer are the members of the <xref:System.ServiceModel.Dispatcher.ServiceThrottle> class.</span></span>

## <a name="detecting-application-and-performance-issues-related-to-quota-settings"></a><span data-ttu-id="6f180-127">Выявление проблем с приложением и производительностью, связанных с параметрами квоты</span><span class="sxs-lookup"><span data-stu-id="6f180-127">Detecting Application and Performance Issues Related to Quota Settings</span></span>
 <span data-ttu-id="6f180-128">Значения по умолчанию указанных выше параметров выбраны таким образом, чтобы обеспечить функциональность основного приложения в широком диапазоне типов приложения, обеспечивая при этом основную защиту от общих проблем безопасности.</span><span class="sxs-lookup"><span data-stu-id="6f180-128">The defaults of the preceding values have been chosen to enable basic application functionality across a wide range of application types while providing basic protection against common security issues.</span></span> <span data-ttu-id="6f180-129">Однако дизайн некоторых приложений может превышать значение одного или нескольких параметров регулировки, хотя в противном случае приложение защищено и будет работать, как было задумано.</span><span class="sxs-lookup"><span data-stu-id="6f180-129">However, different application designs might exceed one or more throttle settings although the application otherwise is secure and would work as designed.</span></span> <span data-ttu-id="6f180-130">В таких случаях необходимо определить, какие значения ограничителей и на каком уровне превышены, и принять решение о соответствующих действиях по повышению пропускной способности приложения.</span><span class="sxs-lookup"><span data-stu-id="6f180-130">In these cases, you must identify which throttle values are being exceeded and at what level, and decide on the appropriate course of action to increase application throughput.</span></span>

 <span data-ttu-id="6f180-131">Обычно при написании и отладке приложения свойству <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> программно или с помощью файла конфигурации присваивается значение `true`.</span><span class="sxs-lookup"><span data-stu-id="6f180-131">Typically, when writing the application and debugging it, you set the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` in the configuration file or programmatically.</span></span> <span data-ttu-id="6f180-132">Это указывает WCF на необходимость возврата трассировок стека исключений службы в клиентское приложение для просмотра.</span><span class="sxs-lookup"><span data-stu-id="6f180-132">This instructs WCF to return service exception stack traces to the client application for viewing.</span></span> <span data-ttu-id="6f180-133">Данная функция позволяет создавать отчеты о большинстве исключений на уровне приложения таким образом, чтобы показать, если проблема заключается в этом, какие параметры квоты могут являться причиной.</span><span class="sxs-lookup"><span data-stu-id="6f180-133">This feature reports most application-level exceptions in such a way as to display which quota settings might be involved, if that is the problem.</span></span>

 <span data-ttu-id="6f180-134">Некоторые исключения вызываются во время выполнения за пределами видимости уровня приложения, не возвращаются при помощи такого механизма и не могут быть обработаны пользовательской реализацией <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6f180-134">Some exceptions happen at run time below the visibility of the application layer and are not returned using this mechanism, and they might not be handled by a custom <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> implementation.</span></span> <span data-ttu-id="6f180-135">В среде разработки, такой как Microsoft Visual Studio, большинство исключений отображается автоматически.</span><span class="sxs-lookup"><span data-stu-id="6f180-135">If you are in a development environment like Microsoft Visual Studio, most of these exceptions are displayed automatically.</span></span> <span data-ttu-id="6f180-136">Однако некоторые исключения могут быть маскированы с помощью параметров среды разработки, таких как [только мой код](/visualstudio/debugger/just-my-code) Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f180-136">However, some exceptions can be masked by development environment settings such as [Just My Code](/visualstudio/debugger/just-my-code) Visual Studio.</span></span>

 <span data-ttu-id="6f180-137">Независимо от возможностей среды разработки можно использовать возможности трассировки WCF и ведения журнала сообщений для отладки всех исключений и настройки производительности приложений.</span><span class="sxs-lookup"><span data-stu-id="6f180-137">Regardless of the capabilities of your development environment, you can use capabilities of WCF tracing and message logging to debug all exceptions and tune the performance of your applications.</span></span> <span data-ttu-id="6f180-138">Дополнительные сведения см. [в разделе Использование трассировки для устранения неполадок приложения](./diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).</span><span class="sxs-lookup"><span data-stu-id="6f180-138">For more information, see [Using Tracing to Troubleshoot Your Application](./diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).</span></span>

## <a name="performance-issues-and-xmlserializer"></a><span data-ttu-id="6f180-139">Проблемы производительности и XmlSerializer</span><span class="sxs-lookup"><span data-stu-id="6f180-139">Performance Issues and XmlSerializer</span></span>
 <span data-ttu-id="6f180-140">Службы и клиентские приложения, использующие типы данных, сериализуемых при помощи сериализатора <xref:System.Xml.Serialization.XmlSerializer>, создают и компилируют код сериализации для этих типов данных во время выполнения, что может привести к снижению производительности при запуске.</span><span class="sxs-lookup"><span data-stu-id="6f180-140">Services and client applications that use data types that are serializable using the <xref:System.Xml.Serialization.XmlSerializer> generate and compile serialization code for those data types at run time, which can result in slow start-up performance.</span></span>

> [!NOTE]
> <span data-ttu-id="6f180-141">Предварительно созданный код сериализации может использоваться только в клиентских приложениях, а не в службах.</span><span class="sxs-lookup"><span data-stu-id="6f180-141">Pre-generated serialization code can be used only in client applications and not in services.</span></span>

 <span data-ttu-id="6f180-142">[Средство служебной программы метаданных ServiceModel (Svcutil. exe)](servicemodel-metadata-utility-tool-svcutil-exe.md) может улучшить производительность при запуске этих приложений, создавая необходимый код сериализации из скомпилированных сборок для приложения.</span><span class="sxs-lookup"><span data-stu-id="6f180-142">The [ServiceModel Metadata Utility Tool (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md) can improve start-up performance for these applications by generating the necessary serialization code from the compiled assemblies for the application.</span></span> <span data-ttu-id="6f180-143">Дополнительные сведения см. в разделе [как улучшить время запуска клиентских приложений WCF с помощью XmlSerializer](./feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).</span><span class="sxs-lookup"><span data-stu-id="6f180-143">For more information, see [How to: Improve the Startup Time of WCF Client Applications using the XmlSerializer](./feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).</span></span>

## <a name="performance-issues-when-hosting-wcf-services-under-aspnet"></a><span data-ttu-id="6f180-144">Проблемы производительности при размещении служб WCF под ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6f180-144">Performance Issues When Hosting WCF Services Under ASP.NET</span></span>

<span data-ttu-id="6f180-145">Когда служба WCF размещается под IIS и ASP.NET, параметры конфигурации IIS и ASP.NET могут повлиять на пропускную способность и объем занимаемой службой WCF памяти.</span><span class="sxs-lookup"><span data-stu-id="6f180-145">When a WCF service is hosted under IIS and ASP.NET, the configuration settings of IIS and ASP.NET can affect the throughput and memory footprint of the WCF service.</span></span>  <span data-ttu-id="6f180-146">Дополнительные сведения о производительности ASP.NET см. в разделе [улучшение производительности ASP.NET](https://docs.microsoft.com/previous-versions/msp-n-p/ff647787(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="6f180-146">For more information about ASP.NET performance, see [Improving ASP.NET Performance](https://docs.microsoft.com/previous-versions/msp-n-p/ff647787(v=pandp.10)).</span></span> <span data-ttu-id="6f180-147">Есть один параметр, использование которого может иметь непредвиденные последствия. Это <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, который является свойством <xref:System.Web.Configuration.ProcessModelSection>.</span><span class="sxs-lookup"><span data-stu-id="6f180-147">One setting that might have unintended consequences is <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, which is a property of the <xref:System.Web.Configuration.ProcessModelSection>.</span></span> <span data-ttu-id="6f180-148">Если приложение имеет фиксированное или небольшое количество клиентов, изменение параметра <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> на 2 может обеспечить повышение пропускной способности на многопроцессорных компьютерах с близким к 100% использованием ЦП.</span><span class="sxs-lookup"><span data-stu-id="6f180-148">If your application has a fixed or small number of clients, setting <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> to 2 might provide a throughput boost on a multiprocessor machine that has a CPU utilization close to 100%.</span></span> <span data-ttu-id="6f180-149">За такое увеличение производительности приходится платить: оно также влечет за собой повышение использования памяти, что может снизить масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="6f180-149">This increase in performance comes with a cost: it will also cause an increase in memory usage, which could reduce scalability.</span></span>

## <a name="see-also"></a><span data-ttu-id="6f180-150">См. также:</span><span class="sxs-lookup"><span data-stu-id="6f180-150">See also</span></span>

- [<span data-ttu-id="6f180-151">Администрирование и диагностика</span><span class="sxs-lookup"><span data-stu-id="6f180-151">Administration and Diagnostics</span></span>](./diagnostics/index.md)
- [<span data-ttu-id="6f180-152">Большие наборы данных и потоковая передача</span><span class="sxs-lookup"><span data-stu-id="6f180-152">Large Data and Streaming</span></span>](./feature-details/large-data-and-streaming.md)
