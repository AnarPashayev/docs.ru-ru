---
title: Управление доступом для кода
description: Узнайте о механизме управления доступом для кода в .NET, который помогает защитить компьютерные системы от вредоносного мобильного кода.
ms.date: 03/30/2017
helpviewer_keywords:
- named permission sets, code access security
- call stacks
- malicious code
- stack walk
- security [.NET Framework], code access security
- permissions [.NET Framework], code access security
- trusted code
- mobile code security
- unmanaged code, code access security
- granting permissions, code access security
- user authentication, code access security
- code access security
ms.assetid: 859af632-c80d-4736-8d6f-1e01b09ce127
ms.openlocfilehash: b5c32afb26c7b4bf7f8585c43ac11e57ebb5d015
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2020
ms.locfileid: "90554870"
---
# <a name="code-access-security"></a><span data-ttu-id="c751b-103">Управление доступом для кода</span><span class="sxs-lookup"><span data-stu-id="c751b-103">Code Access Security</span></span>

[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]  
  
 <span data-ttu-id="c751b-104">Современные, в высокой степени взаимосвязанные компьютерные системы часто подвержены воздействию кода из разных, иногда неизвестных источников.</span><span class="sxs-lookup"><span data-stu-id="c751b-104">Today's highly connected computer systems are frequently exposed to code originating from various, possibly unknown sources.</span></span> <span data-ttu-id="c751b-105">Код можно вложить в электронную почту, содержащуюся в документах или скачать через Интернет.</span><span class="sxs-lookup"><span data-stu-id="c751b-105">Code can be attached to email, contained in documents, or downloaded over the Internet.</span></span> <span data-ttu-id="c751b-106">К сожалению, многие пользователи уже на собственном опыте испытали действие небезопасного кода, включая вирусы и черви, который может повреждать и уничтожать данные, приводя к потере времени и денег.</span><span class="sxs-lookup"><span data-stu-id="c751b-106">Unfortunately, many computer users have experienced firsthand the effects of malicious mobile code, including viruses and worms, which can damage or destroy data and cost time and money.</span></span>  
  
 <span data-ttu-id="c751b-107">Наиболее распространенные механизмы безопасности предоставляют пользователям права на основе их учетных данных (обычно пароль) и ограничивают ресурсы (часто каталоги и файлы), к которым пользователю разрешен доступ.</span><span class="sxs-lookup"><span data-stu-id="c751b-107">Most common security mechanisms give rights to users based on their credentials (usually a password) and restrict resources (often directories and files) that the user is allowed to access.</span></span> <span data-ttu-id="c751b-108">Однако этот подход неспособен решить некоторые проблемы: пользователи получают код из множества источников, некоторые из которых могут быть ненадежными; код может содержать ошибки или уязвимые места, которые могут использоваться вредоносным кодом. Кроме того, код в некоторых случаях может выполнять действия без ведома пользователя.</span><span class="sxs-lookup"><span data-stu-id="c751b-108">However, this approach fails to address several issues: users obtain code from many sources, some of which might be unreliable; code can contain bugs or vulnerabilities that enable it to be exploited by malicious code; and code sometimes does things that the user does not know it will do.</span></span> <span data-ttu-id="c751b-109">В результате возможно повреждение компьютерных систем и утечка конфиденциальных данных, когда осмотрительные и благонадежные пользователи запускают вредоносное или содержащее множество ошибок программное обеспечение.</span><span class="sxs-lookup"><span data-stu-id="c751b-109">As a result, computer systems can be damaged and private data can be leaked when cautious and trustworthy users run malicious or error-filled software.</span></span> <span data-ttu-id="c751b-110">Большинство механизмов безопасности операционной системы требует, чтобы каждый фрагмент кода был доверенным для выполнения, за исключением сценариев на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="c751b-110">Most operating system security mechanisms require that every piece of code must be trusted in order to run, except perhaps for scripts on a Web page.</span></span> <span data-ttu-id="c751b-111">Таким образом, необходим механизм безопасности с широкой областью применения, позволяющий коду, полученному от одной компьютерной системы, безопасно выполняться в другой системе даже при отсутствии отношений доверия между этими системами.</span><span class="sxs-lookup"><span data-stu-id="c751b-111">Therefore, there is still a need for a widely applicable security mechanism that allows code originating from one computer system to execute with protection on another system, even when there is no trust relationship between the systems.</span></span>  
  
 <span data-ttu-id="c751b-112">В целях защиты компьютерных систем от вредоносного мобильного кода, обеспечения возможности безопасного исполнения кода, поступившего из неизвестных источников, и защиты доверенного кода от преднамеренного или случайного нарушения безопасности платформа .NET Framework предлагает механизм безопасности, называемый управлением доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-112">The .NET Framework provides a security mechanism called code access security to help protect computer systems from malicious mobile code, to allow code from unknown origins to run with protection, and to help prevent trusted code from intentionally or accidentally compromising security.</span></span> <span data-ttu-id="c751b-113">Управление доступом для кода позволяет определять разные уровни надежности для кода, в зависимости от происхождения и других параметров его удостоверения.</span><span class="sxs-lookup"><span data-stu-id="c751b-113">Code access security enables code to be trusted to varying degrees depending on where the code originates and on other aspects of the code's identity.</span></span> <span data-ttu-id="c751b-114">Управление доступом для кода также обеспечивает соблюдение различных уровней доверия для кода, минимизируя количество кода, для выполнения которого требуется полное доверие.</span><span class="sxs-lookup"><span data-stu-id="c751b-114">Code access security also enforces the varying levels of trust on code, which minimizes the amount of code that must be fully trusted in order to run.</span></span> <span data-ttu-id="c751b-115">С помощью управления доступом для кода можно снизить вероятность того, что код будет использован не по назначению вредоносным или содержащим множество ошибок кодом.</span><span class="sxs-lookup"><span data-stu-id="c751b-115">Using code access security can reduce the likelihood that your code will be misused by malicious or error-filled code.</span></span> <span data-ttu-id="c751b-116">Оно может также ограничить вашу ответственность, так как вы можете указать для кода набора операций, разрешенных к выполнению.</span><span class="sxs-lookup"><span data-stu-id="c751b-116">It can reduce your liability, because you can specify the set of operations your code should be allowed to perform.</span></span> <span data-ttu-id="c751b-117">Управление доступом для кода помогает также снизить уровень возможного ущерба от уязвимых мест в коде.</span><span class="sxs-lookup"><span data-stu-id="c751b-117">Code access security can also help minimize the damage that can result from security vulnerabilities in your code.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c751b-118">В .NET Framework 4 были внесены значительные изменения в систему управления доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-118">Major changes have been made to code access security in the .NET Framework 4.</span></span> <span data-ttu-id="c751b-119">Наиболее заметным изменением является [прозрачность безопасности](security-transparent-code.md), но существуют и другие существенные изменения, влияющие на управление доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-119">The most notable change has been [security transparency](security-transparent-code.md), but there are also other significant changes that affect code access security.</span></span> <span data-ttu-id="c751b-120">Сведения об этих изменениях см. в разделе [изменения в системе безопасности](/previous-versions/dotnet/framework/security/security-changes).</span><span class="sxs-lookup"><span data-stu-id="c751b-120">For information about these changes, see [Security Changes](/previous-versions/dotnet/framework/security/security-changes).</span></span>  
  
 <span data-ttu-id="c751b-121">Управление доступом для кода в основном затрагивает код библиотек и приложения с частичным доверием.</span><span class="sxs-lookup"><span data-stu-id="c751b-121">Code access security primarily affects library code and partially trusted applications.</span></span> <span data-ttu-id="c751b-122">Разработчики библиотек должны защищать свой код от несанкционированного доступа из приложений с частичным доверием.</span><span class="sxs-lookup"><span data-stu-id="c751b-122">Library developers must protect their code from unauthorized access from partially trusted applications.</span></span> <span data-ttu-id="c751b-123">Приложения с частичным доверием — это приложения, загружаемые из внешних источников, например Интернета.</span><span class="sxs-lookup"><span data-stu-id="c751b-123">Partially trusted applications are applications that are loaded from external sources such as the Internet.</span></span> <span data-ttu-id="c751b-124">Приложения, установленные на локальном компьютере или в локальной интрасети, выполняются с полным доверием.</span><span class="sxs-lookup"><span data-stu-id="c751b-124">Applications that are installed on your desktop or on the local intranet run in full trust.</span></span> <span data-ttu-id="c751b-125">Безопасность приложений с полным доверием не влияет на управление доступом для кода, если они не помечены как [прозрачные для безопасности](security-transparent-code.md), так как они являются полностью доверенными.</span><span class="sxs-lookup"><span data-stu-id="c751b-125">Full-trust applications are not affected by code access security unless they are marked as [security-transparent](security-transparent-code.md), because they are fully trusted.</span></span> <span data-ttu-id="c751b-126">Единственное ограничение для приложений с полным доверием состоит в том, что приложения с атрибутом <xref:System.Security.SecurityTransparentAttribute> не могут вызывать код, помеченный атрибутом <xref:System.Security.SecurityCriticalAttribute>.</span><span class="sxs-lookup"><span data-stu-id="c751b-126">The only limitation for full-trust applications is that applications that are marked with the <xref:System.Security.SecurityTransparentAttribute> attribute cannot call code that is marked with the <xref:System.Security.SecurityCriticalAttribute> attribute.</span></span> <span data-ttu-id="c751b-127">Приложения с частичным доверием должны запускаться в "песочнице" (например, в браузере Internet Explorer), чтобы к ним применялось управление доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-127">Partially trusted applications must be run in a sandbox (for example, in Internet Explorer) so that code access security can be applied.</span></span> <span data-ttu-id="c751b-128">Если вы загрузили приложение из Интернета и попытаетесь запустить его с рабочего стола, вы получите <xref:System.NotSupportedException> сообщение об ошибке: "предпринята попытка загрузить сборку из сетевого расположения, что привело бы к изолированной сборке в предыдущих версиях .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c751b-128">If you download an application from the Internet and try to run it from your desktop, you will get a <xref:System.NotSupportedException> with the message: "An attempt was made to load an assembly from a network location, which would have caused the assembly to be sandboxed in previous versions of the .NET Framework.</span></span> <span data-ttu-id="c751b-129">Этот выпуск .NET Framework не включает политику CAS по умолчанию, поэтому данная загрузка может быть опасной".</span><span class="sxs-lookup"><span data-stu-id="c751b-129">This release of the .NET Framework does not enable CAS policy by default, so this load may be dangerous."</span></span> <span data-ttu-id="c751b-130">Если вы уверены, что приложение может быть доверенным, можно включить его для запуска с полным доверием с помощью [ \<loadFromRemoteSources> элемента](../configure-apps/file-schema/runtime/loadfromremotesources-element.md).</span><span class="sxs-lookup"><span data-stu-id="c751b-130">If you are sure that the application can be trusted, you can enable it to be run as full trust by using the [\<loadFromRemoteSources> element](../configure-apps/file-schema/runtime/loadfromremotesources-element.md).</span></span> <span data-ttu-id="c751b-131">Сведения о запуске приложения в песочнице см. в разделе [как запустить частично доверенный код в песочнице](how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="c751b-131">For information about running an application in a sandbox, see [How to: Run Partially Trusted Code in a Sandbox](how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
 <span data-ttu-id="c751b-132">Любой управляемый код, предназначенный для среды CLR, получает преимущества управления доступом для кода, даже если он не выполняет ни одного вызова управления доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-132">All managed code that targets the common language runtime receives the benefits of code access security, even if that code does not make a single code access security call.</span></span> <span data-ttu-id="c751b-133">Дополнительные сведения см. в разделе [Code Access Security Basics](code-access-security-basics.md).</span><span class="sxs-lookup"><span data-stu-id="c751b-133">For more information, see [Code Access Security Basics](code-access-security-basics.md).</span></span>  
  
<a name="key_functions"></a>
## <a name="key-functions-of-code-access-security"></a><span data-ttu-id="c751b-134">Ключевые функции управления доступом для кода</span><span class="sxs-lookup"><span data-stu-id="c751b-134">Key Functions of Code Access Security</span></span>  
 <span data-ttu-id="c751b-135">Управление доступом для кода помогает ограничить доступ кода к защищенным ресурсам и операциям.</span><span class="sxs-lookup"><span data-stu-id="c751b-135">Code access security helps limit the access that code has to protected resources and operations.</span></span> <span data-ttu-id="c751b-136">В.NET Framework управление доступом для кода выполняет следующие функции:</span><span class="sxs-lookup"><span data-stu-id="c751b-136">In the .NET Framework, code access security performs the following functions:</span></span>  
  
- <span data-ttu-id="c751b-137">Определяет разрешения и наборы разрешений, представляющих право доступа к различным системным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="c751b-137">Defines permissions and permission sets that represent the right to access various system resources.</span></span>  
  
- <span data-ttu-id="c751b-138">Дает возможность представить в коде требование, чтобы вызывающие его объекты имели какие-то конкретные разрешения.</span><span class="sxs-lookup"><span data-stu-id="c751b-138">Enables code to demand that its callers have specific permissions.</span></span>  
  
- <span data-ttu-id="c751b-139">Дает возможность представить в коде требование, чтобы вызывающие объекты имели цифровую сигнатуру, позволяя таким образом вызывать защищенный код только пользователям из конкретной организации или веб-узла.</span><span class="sxs-lookup"><span data-stu-id="c751b-139">Enables code to demand that its callers possess a digital signature, thus allowing only callers from a particular organization or site to call the protected code.</span></span>  
  
- <span data-ttu-id="c751b-140">Вводит ограничения кода во время выполнения, сравнивая предоставленные разрешения каждого участника в стеке вызовов с разрешениями, которые участники должны иметь.</span><span class="sxs-lookup"><span data-stu-id="c751b-140">Enforces restrictions on code at run time by comparing the granted permissions of every caller on the call stack to the permissions that callers must have.</span></span>  
  
<a name="walking_the_call_stack"></a>
## <a name="walking-the-call-stack"></a><span data-ttu-id="c751b-141">Обход стека вызова</span><span class="sxs-lookup"><span data-stu-id="c751b-141">Walking the Call Stack</span></span>  
 <span data-ttu-id="c751b-142">Чтобы определить, разрешен ли коду доступ к ресурсу или выполнение операции, система безопасности среды выполнения обходит стек вызовов, сравнивая разрешения, выданные каждому вызывающему объекту, с затребованными разрешениями.</span><span class="sxs-lookup"><span data-stu-id="c751b-142">To determine whether code is authorized to access a resource or perform an operation, the runtime's security system walks the call stack, comparing the granted permissions of each caller to the permission being demanded.</span></span> <span data-ttu-id="c751b-143">Если какой-либо вызывающий объект в стеке вызовов не имеет запрашиваемого разрешения, создается исключение безопасности и ему отказывается в доступе.</span><span class="sxs-lookup"><span data-stu-id="c751b-143">If any caller in the call stack does not have the demanded permission, a security exception is thrown and access is refused.</span></span> <span data-ttu-id="c751b-144">Обход стека вызовов предназначен для предотвращения отвлекающих атак, когда менее доверенный код вызывает более доверенный и использует его для выполнения неправомочных действий.</span><span class="sxs-lookup"><span data-stu-id="c751b-144">The stack walk is designed to help prevent luring attacks, in which less-trusted code calls highly trusted code and uses it to perform unauthorized actions.</span></span> <span data-ttu-id="c751b-145">Требование разрешений от всех вызывающих объектов во время выполнения влияет на производительность, но необходимо для защиты кода от отвлекающих атак со стороны менее доверенного кода.</span><span class="sxs-lookup"><span data-stu-id="c751b-145">Demanding permissions of all callers at run time affects performance, but it is essential to help protect code from luring attacks by less-trusted code.</span></span> <span data-ttu-id="c751b-146">Для оптимизации производительности код может выполнять меньшее количество проходов по стеку.</span><span class="sxs-lookup"><span data-stu-id="c751b-146">To optimize performance, you can have your code perform fewer stack walks.</span></span> <span data-ttu-id="c751b-147">Однако убедитесь, что при этом не предоставляются слабые места в системе безопасности.</span><span class="sxs-lookup"><span data-stu-id="c751b-147">However, be sure that you don't expose a security weakness whenever you do this.</span></span>  
  
 <span data-ttu-id="c751b-148">На рисунке ниже показан обход стека, происходящий, когда метод сборки A4 требует, чтобы вызывающие его объекты обладали разрешением P.</span><span class="sxs-lookup"><span data-stu-id="c751b-148">The following illustration shows the stack walk that results when a method in Assembly A4 demands that its callers have permission P.</span></span>  
  
 <span data-ttu-id="c751b-149">![Проверка стека управления доступом для кода](media/slide-10a.gif "slide_10a")</span><span class="sxs-lookup"><span data-stu-id="c751b-149">![Code access security stack walk](media/slide-10a.gif "slide_10a")</span></span>
  
<a name="related_topics"></a>
## <a name="related-articles"></a><span data-ttu-id="c751b-150">Связанные статьи</span><span class="sxs-lookup"><span data-stu-id="c751b-150">Related articles</span></span>
  
|<span data-ttu-id="c751b-151">Заголовок</span><span class="sxs-lookup"><span data-stu-id="c751b-151">Title</span></span>|<span data-ttu-id="c751b-152">Описание</span><span class="sxs-lookup"><span data-stu-id="c751b-152">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="c751b-153">Основы управления доступом для кода</span><span class="sxs-lookup"><span data-stu-id="c751b-153">Code Access Security Basics</span></span>](code-access-security-basics.md)|<span data-ttu-id="c751b-154">Описывается управление доступом для кода и распространенные способы его использования.</span><span class="sxs-lookup"><span data-stu-id="c751b-154">Describes code access security and its most common uses.</span></span>|  
|[<span data-ttu-id="c751b-155">Прозрачный с точки зрения безопасности код, уровень 2</span><span class="sxs-lookup"><span data-stu-id="c751b-155">Security-Transparent Code, Level 2</span></span>](security-transparent-code-level-2.md)|<span data-ttu-id="c751b-156">Описывает модель прозрачности безопасности в .NET Framework 4.</span><span class="sxs-lookup"><span data-stu-id="c751b-156">Describes the security transparency model in the .NET Framework 4.</span></span>|  
|[<span data-ttu-id="c751b-157">Использование библиотек из не вполне надежного кода</span><span class="sxs-lookup"><span data-stu-id="c751b-157">Using Libraries from Partially Trusted Code</span></span>](using-libraries-from-partially-trusted-code.md)|<span data-ttu-id="c751b-158">Описывается, как предоставить доступ к библиотекам и использовать их из неуправляемого код.</span><span class="sxs-lookup"><span data-stu-id="c751b-158">Describes how to enable libraries for use with unmanaged code and how to use libraries from unmanaged code.</span></span>|  
|[<span data-ttu-id="c751b-159">Основные понятия безопасности</span><span class="sxs-lookup"><span data-stu-id="c751b-159">Key Security Concepts</span></span>](../../standard/security/key-security-concepts.md)|<span data-ttu-id="c751b-160">Обзор многих ключевых терминов и принципов, используемых в системе безопасности .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c751b-160">Provides an overview of many of the key terms and concepts used in the .NET Framework security system.</span></span>|  
|[<span data-ttu-id="c751b-161">Безопасность на основе ролей</span><span class="sxs-lookup"><span data-stu-id="c751b-161">Role-Based Security</span></span>](../../standard/security/role-based-security.md)|<span data-ttu-id="c751b-162">Описывается использование безопасности на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="c751b-162">Describes how to incorporate security based on roles.</span></span>|  
|[<span data-ttu-id="c751b-163">службы шифрования</span><span class="sxs-lookup"><span data-stu-id="c751b-163">Cryptographic Services</span></span>](../../standard/security/cryptographic-services.md)|<span data-ttu-id="c751b-164">Описывается использование шифрования в приложениях.</span><span class="sxs-lookup"><span data-stu-id="c751b-164">Describes how to incorporate cryptography into your applications.</span></span>|
