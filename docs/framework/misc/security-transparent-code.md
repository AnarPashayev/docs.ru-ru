---
title: Прозрачный для системы безопасности код
ms.date: 03/30/2017
helpviewer_keywords:
- transparent code
- security-transparent code
ms.assetid: 4f3dd841-82f7-4659-aab0-6d2db2166c65
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 44003cbd0f13d2665c5b753454689c10546325b7
ms.sourcegitcommit: 155012a8a826ee8ab6aa49b1b3a3b532e7b7d9bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66487845"
---
# <a name="security-transparent-code"></a>Прозрачный для системы безопасности код

<a name="top"></a>

[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]

Система безопасности включает в себя три основных компонента, взаимодействующих друг с другом: песочницы, разрешения и компоненты обеспечения безопасности. Технология песочниц включает в себя процесс создания изолированных доменов, в которых определенный код рассматривается как код с полным доверием, а другой код ограничивается набором разрешений, предоставленных песочнице. Код приложения, выполняемый с набором прав песочницы, считается прозрачным (то есть неспособным выполнять действия, влияющие на безопасность). Набор прав, предоставленных песочнице, определяется свидетельством (класс <xref:System.Security.Policy.Evidence>). Свидетельство определяет разрешения, необходимые для песочниц, а также возможные типы создаваемых песочниц. Технологии обеспечения безопасности позволяют прозрачному коду выполнять только те действия, которые соответствуют набору предоставленных прав.

> [!IMPORTANT]
> Политика безопасности была ключевым элементом в предыдущих версиях платформы .NET Framework. Начиная с .NET Framework 4, политика безопасности считается устаревшей. Устранение политики безопасности выполняется независимо от прозрачности безопасности. Дополнительные сведения о влиянии этого изменения, см. в разделе [совместимость политики разграничения доступа кода и миграции](../../../docs/framework/misc/code-access-security-policy-compatibility-and-migration.md).

В этом разделе подробно описывается модель прозрачности. Он содержит следующие подразделы:

- [Назначение модели прозрачности](#purpose)

- [Указание уровня прозрачности](#level)

- [Обеспечение прозрачности](#enforcement)

<a name="purpose"></a>

## <a name="purpose-of-the-transparency-model"></a>Назначение модели прозрачности

Прозрачность — это механизм обеспечения безопасности, который отделяет код, выполняемый в рамках приложения, от кода, выполняемого в рамках инфраструктуры. Технология прозрачности разделяет код, которому разрешено выполнять привилегированные действия (критически важный код, например вызов машинного кода), и код, не имеющий такого разрешения (прозрачный код). Прозрачный код может выполнять команды в рамках используемого набора разрешений, но не может выполнять и содержать критический код, а также быть образованным от него.

Основной целью функции прозрачности является обеспечение простого и эффективного механизма для изоляции различных групп кода на основе привилегий. В контексте модели песочницы такие группы привилегий имеют полное доверие (то есть не ограничены) или частичное доверие (то есть ограничены набором разрешений, предоставленных песочнице).

> [!IMPORTANT]
> Модель прозрачности служит не только для управления доступом для кода. Прозрачность обеспечивается JIT-компилятором и действует вне зависимости от набора прав, предоставленного сборке (включая полное доверие).

Прозрачность появилась в .NET Framework версии 2.0 для упрощения модели безопасности и для облегчения создания и развертывания безопасных библиотек и приложений. Прозрачный код также используется в Microsoft Silverlight для упрощения разработки приложений с частичным доверием.

> [!NOTE]
> При разработке частично доверенного приложения следует помнить о требованиях безопасности для целевых узлов. Вы можете создать приложение, использующее ресурсы, не разрешенные некоторыми узлами. Компиляция приложения пройдет без ошибок, но при его загрузке в размещенную среду возникнет ошибка. Если приложение создано с помощью Visual Studio, вы можете включить отладку в режиме частичного доверия или с ограниченным набором разрешений из среды разработки. Дополнительные сведения см. в разделе [Практическое руководство. отладить приложение ClickOnce с ограниченными разрешениями](/visualstudio/deployment/how-to-debug-a-clickonce-application-with-restricted-permissions). Функция вычисления разрешений, предоставляемая для приложений ClickOnce, также доступна для любого приложения с частичным доверием.

[К началу](#top)

<a name="level"></a>

## <a name="specifying-the-transparency-level"></a>Указание уровня прозрачности

Атрибут уровня сборки <xref:System.Security.SecurityRulesAttribute> явным образом выбирает правила <xref:System.Security.SecurityRuleSet>, которым будет следовать сборка. Правила организованы в многоуровневую систему, где более высокий уровень обеспечивает более строгое применение правил безопасности.

Возможны следующие уровни:

- Уровень 2 (<xref:System.Security.SecurityRuleSet.Level2>) — правила прозрачности платформы .NET Framework 4.

- уровень 1 (<xref:System.Security.SecurityRuleSet.Level1>) — правила прозрачности .NET Framework 2.0.

Основным различием между двумя уровнями безопасности является то, что уровень 1 не применяет правила безопасности для вызовов извне и предназначен только для обеспечения совместимости.

> [!IMPORTANT]
> Прозрачность уровня 1 следует указывать только для совместимости, то есть уровень 1 следует задавать только для кода, разработанного на платформе .NET Framework 3.5 или более ранней версии и использующего атрибут <xref:System.Security.AllowPartiallyTrustedCallersAttribute> или не использующего модель прозрачности. Например, используйте прозрачность уровня 1 для сборок .NET Framework 2.0, которые допускают вызовы из частично доверенных вызывающих объектов (APTCA). Для кода, разработанного для .NET Framework 4 следует используете прозрачность уровня 2.

### <a name="level-2-transparency"></a>Прозрачность уровня 2

Прозрачность уровня 2 появилась в .NET Framework 4. Ключевыми элементами этой модели являются следующие компоненты: прозрачный код, надежный с точки зрения безопасности код и критический с точки зрения безопасности код.

- Прозрачный код (вне зависимости от предоставленных разрешений, в том числе код с полным доверием) может вызывать только другой прозрачный или надежный с точки зрения безопасности код. Если код имеет частичное доверие, то он может выполнять только действия, разрешенные набором разрешений домена. Прозрачный код не может выполнять следующие действия:

  - выполнять операцию <xref:System.Security.CodeAccessPermission.Assert%2A> или повышение привилегий;

  - содержать небезопасный или непроверяемый код;

  - напрямую вызывать критический код;

  - вызывать машинный код или код с атрибутом <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute>;

  - вызывать член, защищенный с помощью <xref:System.Security.Permissions.SecurityAction.LinkDemand>;

  - наследовать от критических типов.

    Кроме того, прозрачные методы не могут переопределять критические виртуальные методы или реализовывать критические методы интерфейсов.

- Надежный с точки зрения безопасности код имеет полное доверие, но может вызываться прозрачным кодом. Он предоставляет ограниченный объем кода с полным доверием. В надежном с точки зрения безопасности коде выполняются проверки на правильность и безопасность.

- Критический с точки зрения безопасности код может вызывать любой код, но не может вызываться из прозрачного кода.

### <a name="level-1-transparency"></a>Прозрачность уровня 1

Модель прозрачности уровня 1 появилась в .NET Framework версии 2.0 и позволяла разработчикам сократить объем кода, требующего аудита безопасности. Несмотря на то, что прозрачность уровня 1 стала общедоступной в версии 2.0, она в основном использовалась только в корпорации Майкрософт для аудита безопасности. Заметки позволяют разработчикам объявлять типы и члены, которые могут повышать уровень разрешений и выполнять другие доверенные (критические с точки зрения безопасности) действия, а также типы и члены, которые не могут выполнять такие действия (прозрачные с точки зрения безопасности). Код, определенный как прозрачный, не требует подробного аудита безопасности. Прозрачность уровня 1 ограничивает применение прозрачности пределами сборки. Другими словами, все открытые типы или члены, которые считаются критическими с точки зрения безопасности, являются таковыми только в пределах сборки. Чтобы обеспечить безопасность для этих типов и членов, когда они вызываются извне, необходимо использовать запросы компоновки с полным доверием. В противном случае открытые видимые критические типы и члены рассматриваются как надежные с точки зрения безопасности и могут вызываться частично доверенным кодом вне сборки.

Модель прозрачности уровня 1 имеет перечисленные ниже ограничения.

- Открытые критические с точки зрения безопасности типы и члены доступны из прозрачного с точки зрения безопасности кода.

- Заметки прозрачности применяются только внутри сборки.

- Критические типы и члены должны использовать запросы компоновки для обеспечения безопасности при вызовах извне.

- Правила наследования не применяются.

- Прозрачный код потенциально способен выполнить вредоносные действия при его запуске с полным доверием.

[К началу](#top)

<a name="enforcement"></a>

## <a name="transparency-enforcement"></a>Обеспечение прозрачности

Правила прозрачности не применяются до вычисления прозрачности. При нарушении правила прозрачности возникает исключение <xref:System.InvalidOperationException>. Время расчета прозрачности зависит от различных факторов и не может быть предсказано заранее. Расчет происходит в последний возможный момент. В .NET Framework 4 расчет прозрачности уровня сборки выполняется раньше, чем в .NET Framework 2.0. Гарантируется только то, что расчет прозрачности будет выполнен к тому моменту, когда он понадобится. Этот похоже на то, как JIT-компилятор изменяет момент компиляции метода и обнаружения всех ошибок в нем. Расчет прозрачности выполняется без внешних проявлений, если в коде нет ошибок прозрачности.

## <a name="see-also"></a>См. также

- [Прозрачный с точки зрения безопасности код, уровень 1](../../../docs/framework/misc/security-transparent-code-level-1.md)
- [Прозрачный с точки зрения безопасности код, уровень 2](../../../docs/framework/misc/security-transparent-code-level-2.md)
