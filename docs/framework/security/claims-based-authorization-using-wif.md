---
title: Авторизация на основе утверждений с использованием WIF
ms.date: 03/30/2017
ms.assetid: e24000a3-8fd8-4c0e-bdf0-39882cc0f6d8
author: BrucePerlerMS
ms.openlocfilehash: 9d20f8fbce916a038fc8224492a4077e1978ed8c
ms.sourcegitcommit: 9b1ac36b6c80176fd4e20eb5bfcbd9d56c3264cf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/28/2019
ms.locfileid: "67422368"
---
# <a name="claims-based-authorization-using-wif"></a>Авторизация на основе утверждений с использованием WIF
В приложении с проверяющей стороной авторизация определяет, к каким ресурсам имеет доступ удостоверение, прошедшее проверку подлинности, и какие операции ему разрешается выполнять по отношению к данным ресурсам. Неправильная или слабая авторизация приводит к утечке информации и хищению данных. В этом разделе представлены допустимые подходы к внедрению авторизации для веб-приложений и служб ASP.NET, учитывающих утверждения, при помощи Windows Identity Foundation (WIF) и одной из служб маркеров безопасности (STS), например службы контроля доступа (ACS) Microsoft Azure.  
  
## <a name="overview"></a>Обзор  
 Начиная с первой версии, .NET Framework предлагает гибкий механизм для внедрения авторизации. Этот механизм основан на двух простых интерфейсах: **IPrincipal** и **IIdentity**. Конкретные реализации **IIdentity** представляют пользователя, прошедшего проверку подлинности. Например, реализация **WindowsIdentity** представляет пользователя, прошедшего проверку подлинности в Active Directory, а **GenericIdentity** — пользователя, чье удостоверение подтверждено с помощью настраиваемого процесса проверки подлинности. Конкретные реализации **IPrincipal** помогают проверять разрешения с помощью ролей, зависящих от хранилища ролей. Например, **WindowsPrincipal** проверяет **WindowsIdentity** на членство в группах Active Directory. Эта проверка выполняется путем вызова метода **IsInRole** в интерфейсе **IPrincipal**. Проверка доступа на основе ролей называется управлением доступом на основе ролей (RBAC). Дополнительные сведения см. в разделе [Управление доступом на основе ролей](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).  Утверждения могут использоваться для передачи информации о ролях в целях поддержки традиционных механизмов авторизации на основе ролей.  
  
 Также утверждения можно применять для принятия более сложных решений по авторизации, не связанных с ролями. Утверждения можно создать на основе практически любой информации о пользователе: возраста, почтового индекса, размера обуви и т. д. Механизм управления доступом, основанный на произвольных утверждениях, называется авторизацией на основе утверждений. Дополнительные сведения см. в разделе [Авторизация на основе утверждений](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).  
  
<a name="BKMK_1"></a>   
## <a name="role-based-access-control"></a>Управление доступом на основе ролей  
 RBAC — это подход к авторизации, согласно которому управление и внедрение пользовательских разрешений осуществляется приложением на основе ролей пользователя. При наличии у пользователя необходимой роли для выполнения того или иного действия ему предоставляется доступ; в противном случае доступ не предоставляется.  
  
### <a name="iprincipalisinrole-method"></a>Метод IPrincipal.IsInRole  
 Чтобы реализовать подход RBAC в приложениях с поддержкой утверждений, используйте **IsInRole()** метод в **IPrincipal** интерфейс, так же, как и в приложениях, не поддерживающей утверждения. Существует несколько способов использования метода **IsInRole()** .  
  
- Явное обращение к методу **IPrincipal.IsInRole("Administrator")** . При использовании данного подхода на выходе получится логическое значение. Используйте его в условных операторах. Его можно произвольно применить в любом сегменте кода.  
  
- Использование требования безопасности **PrincipalPermission.Demand()** . При использовании этого подхода результатом будет исключение, если требование не удовлетворено. Оно должно соответствовать вашей стратегии обработки исключений. Создание исключения может быть гораздо более затратным с точки зрения производительности по сравнению с возвратом логического значения. Такой результат можно применить в любом сегменте кода.  
  
- Использование декларативных атрибутов **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]** . Такой подход называется "декларативным", поскольку он используется для декларации методов. Его нельзя использовать в блоках кода в реализациях метода. Результатом будет исключение, если требование не удовлетворено. Необходимо убедиться, что оно соответствует вашей стратегии обработки исключений.  
  
- Использование авторизации URL-адреса с помощью раздела **\<authorization>** в файле **web.config**. Этот подход используется при управлении авторизацией на уровне URL-адреса. Это наименее детализированный уровень из указанных выше. Преимущество такого подхода состоит в том, что изменения вносятся в файл конфигурации, а следовательно, код не требуется компилировать, чтобы применить изменение.  
  
### <a name="expressing-roles-as-claims"></a>Представление ролей как утверждений  
 При вызове метода **IsInRole()** проверяется наличие этой роли у текущего пользователя. В приложениях, поддерживающих утверждения, эта роль выражается типом утверждения роли, который должен быть доступен в токене. Тип утверждения роли выражается при помощи следующего URI:  
  
 `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
  
 Существует несколько способов добавления типа утверждения роли в токен:  
  
- **Во время выдачи токена**. При проверке подлинности пользователя утверждение роли может быть выдано службой STS поставщика удостоверений либо поставщиком федерации, например службой контроля доступа (ACS) Microsoft Azure.  
  
- **Преобразование произвольных утверждений в тип роли утверждений с помощью ClaimsAuthenticationManager**. ClaimsAuthenticationManager — это один из компонентов WIF. Он предоставляет возможность перехватывать запросы, когда они запускают приложения, проверяя токены и преобразуя их путем добавления, изменения или удаления утверждений. Дополнительные сведения об использовании ClaimsAuthenticationManager для преобразования утверждений см. в разделе [How To: Реализация на основе ролей управления доступом (RBAC) в приложении ASP.NET виду утверждений с помощью WIF и ACS](https://go.microsoft.com/fwlink/?LinkID=247445).  
  
- **Сопоставление произвольных утверждений с типом роли с помощью раздела конфигурации samlSecurityTokenRequirement** — декларативный подход, согласно которому преобразование утверждений выполняется исключительно с помощью конфигурации, а создавать код не требуется.  
  
<a name="BKMK_2"></a>   
## <a name="claims-based-authorization"></a>Авторизация на основе утверждений  
 Авторизация на основе утверждений — это подход, согласно которому система авторизации принимает решение о предоставлении доступа или отказе в доступе на основе произвольной логики, использующей данные, доступные в утверждениях, для принятия такого решения. Помните, что в случае RBAC единственным используемым утверждением являлось утверждение типа роли. Утверждение типа роли использовалось для проверки принадлежности пользователя к определенной роли. Ниже представлен пример процесса принятия системой авторизации решения на основе утверждений:  
  
1. Приложение получает запрос на аутентификацию пользователя.  
  
2. WIF перенаправляет пользователя к поставщику удостоверений. После аутентификации создается запрос приложения с применением связанного токена безопасности, представляющего пользователя и содержащего утверждения о нем. WIF связывает эти утверждения с субъектом, представляющим пользователя.  
  
3. Приложение передает утверждения в механизм логики принятия решений. Это может быть встроенный код, обращение к веб-службе, запрос базы данных, интеллектуальный механизм создания правил или применение ClaimsAuthorizationManager.  
  
4. Механизм принятия решения вычисляет результат на основе утверждений.  
  
5. Доступ предоставляется, если результат имеет значение true, и не предоставляется, если результат имеет значение false. Например, может существовать правило, согласно которому пользователю должно быть не менее 21 года и он должен проживать в штате Вашингтон.  
  
 <xref:System.Security.Claims.ClaimsAuthorizationManager> — полезная система внешнего выражения логики принятия решений для авторизации на основе утверждений в ваших приложениях. ClaimsAuthenticationManager — это один из компонентов WIF, предоставляемый в комплекте с .NET 4.5. ClaimsAuthorizationManager позволяет перехватывать входящие запросы и реализовать любую логику на усмотрение разработчика для принятия решений об авторизации на основе входящих утверждений. Такая возможность приобретает существенное значение, если логику авторизации требуется изменить. В этом случае использование ClaimsAuthorizationManager не влияет на целостность приложения, благодаря чему уменьшается вероятность возникновения ошибки приложения в результате изменения. Дополнительные сведения об использовании ClaimsAuthorizationManager для реализации управления доступом на основе утверждений, см. в разделе [How To: Реализации авторизации утверждений в приложении виду ASP.NET утверждения, с помощью WIF и ACS](https://go.microsoft.com/fwlink/?LinkID=247446).
