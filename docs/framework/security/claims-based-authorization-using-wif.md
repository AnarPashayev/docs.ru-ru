---
title: Авторизация на основе утверждений с использованием WIF
ms.date: 03/30/2017
ms.assetid: e24000a3-8fd8-4c0e-bdf0-39882cc0f6d8
author: BrucePerlerMS
ms.openlocfilehash: e269a168c5aa594684a41a98338d961447acd536
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59312180"
---
# <a name="claims-based-authorization-using-wif"></a><span data-ttu-id="62507-102">Авторизация на основе утверждений с использованием WIF</span><span class="sxs-lookup"><span data-stu-id="62507-102">Claims Based Authorization Using WIF</span></span>
<span data-ttu-id="62507-103">В приложении с проверяющей стороной авторизация определяет, к каким ресурсам имеет доступ удостоверение, прошедшее проверку подлинности, и какие операции ему разрешается выполнять по отношению к данным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="62507-103">In a relying party application, authorization determines what resources an authenticated identity is allowed to access and what operations it is allowed to perform on those resources.</span></span> <span data-ttu-id="62507-104">Неправильная или слабая авторизация приводит к утечке информации и хищению данных.</span><span class="sxs-lookup"><span data-stu-id="62507-104">Improper or weak authorization leads to information disclosure and data tampering.</span></span> <span data-ttu-id="62507-105">В этом разделе представлены допустимые подходы к внедрению авторизации для веб-приложений и служб ASP.NET, учитывающих утверждения, при помощи Windows Identity Foundation (WIF) и одной из служб маркеров безопасности (STS), например службы контроля доступа (ACS) Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="62507-105">This topic outlines the available approaches to implementing authorization for claims-aware ASP.NET web applications and services using Windows Identity Foundation (WIF) and a Security Token Service (STS), for example, the Windows Azure Access Control Service (ACS).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="62507-106">Обзор</span><span class="sxs-lookup"><span data-stu-id="62507-106">Overview</span></span>  
 <span data-ttu-id="62507-107">Начиная с первой версии, .NET Framework предлагает гибкий механизм для внедрения авторизации.</span><span class="sxs-lookup"><span data-stu-id="62507-107">Since its first version, the .NET Framework has offered a flexible mechanism for implementing authorization.</span></span> <span data-ttu-id="62507-108">Этот механизм основан на двух простых интерфейсах: **IPrincipal** и **IIdentity**.</span><span class="sxs-lookup"><span data-stu-id="62507-108">This mechanism is based on two simple interfaces—**IPrincipal** and **IIdentity**.</span></span> <span data-ttu-id="62507-109">Конкретные реализации **IIdentity** представляют пользователя, прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="62507-109">Concrete implementations of **IIdentity** represent an authenticated user.</span></span> <span data-ttu-id="62507-110">Например, реализация **WindowsIdentity** представляет пользователя, прошедшего проверку подлинности в Active Directory, а **GenericIdentity** — пользователя, чье удостоверение подтверждено с помощью настраиваемого процесса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="62507-110">For example, the **WindowsIdentity** implementation represents a user who is authenticated by Active Directory, and **GenericIdentity** represents a user whose identity is verified via a custom authentication process.</span></span> <span data-ttu-id="62507-111">Конкретные реализации **IPrincipal** помогают проверять разрешения с помощью ролей, зависящих от хранилища ролей.</span><span class="sxs-lookup"><span data-stu-id="62507-111">Concrete implementations of **IPrincipal** help to check permissions using roles depending on the role store.</span></span> <span data-ttu-id="62507-112">Например, **WindowsPrincipal** проверяет **WindowsIdentity** на членство в группах Active Directory.</span><span class="sxs-lookup"><span data-stu-id="62507-112">For example, **WindowsPrincipal** checks **WindowsIdentity** for membership in Active Directory groups.</span></span> <span data-ttu-id="62507-113">Эта проверка выполняется путем вызова метода **IsInRole** в интерфейсе **IPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="62507-113">This check is performed by calling the **IsInRole** method on the **IPrincipal** interface.</span></span> <span data-ttu-id="62507-114">Проверка доступа на основе ролей называется управлением доступом на основе ролей (RBAC).</span><span class="sxs-lookup"><span data-stu-id="62507-114">Checking access based on roles is called Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="62507-115">Дополнительные сведения см. в разделе [Управление доступом на основе ролей](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).</span><span class="sxs-lookup"><span data-stu-id="62507-115">For more information, see [Role-Based Access Control](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).</span></span>  <span data-ttu-id="62507-116">Утверждения могут использоваться для передачи информации о ролях в целях поддержки традиционных механизмов авторизации на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="62507-116">Claims can be used to carry information about roles to support familiar, role-based authorization mechanisms.</span></span>  
  
 <span data-ttu-id="62507-117">Также утверждения можно применять для принятия более сложных решений по авторизации, не связанных с ролями.</span><span class="sxs-lookup"><span data-stu-id="62507-117">Claims can also be used to enable more complicated authorization decisions beyond roles.</span></span> <span data-ttu-id="62507-118">Утверждения можно создать на основе практически любой информации о пользователе: возраста, почтового индекса, размера обуви и т. д. Механизм управления доступом, основанный на произвольных утверждениях, называется авторизацией на основе утверждений.</span><span class="sxs-lookup"><span data-stu-id="62507-118">Claims can be based on virtually any information about the user - age, zip code, shoe size, etc. An access control mechanism that is based on arbitrary claims is called claims-based authorization.</span></span> <span data-ttu-id="62507-119">Дополнительные сведения см. в разделе [Авторизация на основе утверждений](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).</span><span class="sxs-lookup"><span data-stu-id="62507-119">For more information, see [Claims-based Authorization](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).</span></span>  
  
<a name="BKMK_1"></a>   
## <a name="role-based-access-control"></a><span data-ttu-id="62507-120">Управление доступом на основе ролей</span><span class="sxs-lookup"><span data-stu-id="62507-120">Role-Based Access Control</span></span>  
 <span data-ttu-id="62507-121">RBAC — это подход к авторизации, согласно которому управление и внедрение пользовательских разрешений осуществляется приложением на основе ролей пользователя.</span><span class="sxs-lookup"><span data-stu-id="62507-121">RBAC is an authorization approach in which user permissions are managed and enforced by an application based on user roles.</span></span> <span data-ttu-id="62507-122">При наличии у пользователя необходимой роли для выполнения того или иного действия ему предоставляется доступ; в противном случае доступ не предоставляется.</span><span class="sxs-lookup"><span data-stu-id="62507-122">If a user has a role that is required to perform an action, the access is granted; otherwise, access is denied.</span></span>  
  
### <a name="iprincipalisinrole-method"></a><span data-ttu-id="62507-123">Метод IPrincipal.IsInRole</span><span class="sxs-lookup"><span data-stu-id="62507-123">IPrincipal.IsInRole Method</span></span>  
 <span data-ttu-id="62507-124">Чтобы реализовать подход RBAC в приложениях, поддерживающих утверждения, используйте метод **IsInRole()** в интерфейсе **IPrinicpal** точно так же, как и в приложениях, не поддерживающих утверждения.</span><span class="sxs-lookup"><span data-stu-id="62507-124">To implement the RBAC approach in claims-aware applications, use the **IsInRole()** method in the **IPrinicpal** interface, just as you would in non-claims-aware applications.</span></span> <span data-ttu-id="62507-125">Существует несколько способов использования метода **IsInRole()**.</span><span class="sxs-lookup"><span data-stu-id="62507-125">There are several ways of using the **IsInRole()** method:</span></span>  
  
-   <span data-ttu-id="62507-126">Явное обращение к методу **IPrincipal.IsInRole("Administrator")**.</span><span class="sxs-lookup"><span data-stu-id="62507-126">Explicitly calling on **IPrincipal.IsInRole("Administrator")**.</span></span> <span data-ttu-id="62507-127">При использовании данного подхода на выходе получится логическое значение.</span><span class="sxs-lookup"><span data-stu-id="62507-127">In this approach, the outcome is a Boolean.</span></span> <span data-ttu-id="62507-128">Используйте его в условных операторах.</span><span class="sxs-lookup"><span data-stu-id="62507-128">Use it in your conditional statements.</span></span> <span data-ttu-id="62507-129">Его можно произвольно применить в любом сегменте кода.</span><span class="sxs-lookup"><span data-stu-id="62507-129">It can be used arbitrarily any place in your code.</span></span>  
  
-   <span data-ttu-id="62507-130">Использование требования безопасности **PrincipalPermission.Demand()**.</span><span class="sxs-lookup"><span data-stu-id="62507-130">Using the security demand **PrincipalPermission.Demand()**.</span></span> <span data-ttu-id="62507-131">При использовании этого подхода результатом будет исключение, если требование не удовлетворено.</span><span class="sxs-lookup"><span data-stu-id="62507-131">In this approach, the outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="62507-132">Оно должно соответствовать вашей стратегии обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="62507-132">This should fit your exception handling strategy.</span></span> <span data-ttu-id="62507-133">Создание исключения может быть гораздо более затратным с точки зрения производительности по сравнению с возвратом логического значения.</span><span class="sxs-lookup"><span data-stu-id="62507-133">Throwing exceptions is much more expensive from a performance perspective compared to returning Boolean.</span></span> <span data-ttu-id="62507-134">Такой результат можно применить в любом сегменте кода.</span><span class="sxs-lookup"><span data-stu-id="62507-134">This can be used any place in your code.</span></span>  
  
-   <span data-ttu-id="62507-135">Использование декларативных атрибутов **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]**.</span><span class="sxs-lookup"><span data-stu-id="62507-135">Using the declarative attributes **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]**.</span></span> <span data-ttu-id="62507-136">Такой подход называется "декларативным", поскольку он используется для декларации методов.</span><span class="sxs-lookup"><span data-stu-id="62507-136">This approach is called declarative, because it is used to decorate methods.</span></span> <span data-ttu-id="62507-137">Его нельзя использовать в блоках кода в реализациях метода.</span><span class="sxs-lookup"><span data-stu-id="62507-137">It cannot be used in code blocks inside the method’s implementations.</span></span> <span data-ttu-id="62507-138">Результатом будет исключение, если требование не удовлетворено.</span><span class="sxs-lookup"><span data-stu-id="62507-138">The outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="62507-139">Необходимо убедиться, что оно соответствует вашей стратегии обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="62507-139">You should make sure that it fits your exception-handling strategy.</span></span>  
  
-   <span data-ttu-id="62507-140">Использование авторизации URL-адреса с помощью раздела **\<authorization>** в файле **web.config**. Этот подход используется при управлении авторизацией на уровне URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="62507-140">Using URL authorization, using the **\<authorization>** section in **web.config**. This approach is suitable when you are managing authorization on a URL level.</span></span> <span data-ttu-id="62507-141">Это наименее детализированный уровень из указанных выше.</span><span class="sxs-lookup"><span data-stu-id="62507-141">This is the most coarse level among those previously mentioned.</span></span> <span data-ttu-id="62507-142">Преимущество такого подхода состоит в том, что изменения вносятся в файл конфигурации, а следовательно, код не требуется компилировать, чтобы применить изменение.</span><span class="sxs-lookup"><span data-stu-id="62507-142">The advantage of this approach is that changes are made in the configuration file, which means that the code should not be compiled to take advantage of the change.</span></span>  
  
### <a name="expressing-roles-as-claims"></a><span data-ttu-id="62507-143">Представление ролей как утверждений</span><span class="sxs-lookup"><span data-stu-id="62507-143">Expressing Roles as Claims</span></span>  
 <span data-ttu-id="62507-144">При вызове метода **IsInRole()** проверяется наличие этой роли у текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="62507-144">When the **IsInRole()** method is called, there is a check made to see if the current user has that role.</span></span> <span data-ttu-id="62507-145">В приложениях, поддерживающих утверждения, эта роль выражается типом утверждения роли, который должен быть доступен в токене.</span><span class="sxs-lookup"><span data-stu-id="62507-145">In claims-aware applications, the role is expressed by a role claim type that should be available in the token.</span></span> <span data-ttu-id="62507-146">Тип утверждения роли выражается при помощи следующего URI:</span><span class="sxs-lookup"><span data-stu-id="62507-146">The role claim type is expressed using the following URI:</span></span>  
  
 `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
  
 <span data-ttu-id="62507-147">Существует несколько способов добавления типа утверждения роли в токен:</span><span class="sxs-lookup"><span data-stu-id="62507-147">There are several ways to enrich a token with a role claim type:</span></span>  
  
-   <span data-ttu-id="62507-148">**Во время выдачи токена**.</span><span class="sxs-lookup"><span data-stu-id="62507-148">**During token issuance**.</span></span> <span data-ttu-id="62507-149">При проверке подлинности пользователя утверждение роли может быть выдано службой STS поставщика удостоверений либо поставщиком федерации, например службой контроля доступа (ACS) Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="62507-149">When a user is authenticated the role claim can be issued by the identity provider STS or by a federation provider such as the Windows Azure Access Control Service (ACS).</span></span>  
  
-   <span data-ttu-id="62507-150">**Преобразование произвольных утверждений в тип роли утверждений с помощью ClaimsAuthenticationManager**.</span><span class="sxs-lookup"><span data-stu-id="62507-150">**Transforming arbitrary claims into of claims role type using ClaimsAuthenticationManager**.</span></span> <span data-ttu-id="62507-151">ClaimsAuthenticationManager — это один из компонентов WIF.</span><span class="sxs-lookup"><span data-stu-id="62507-151">The ClaimsAuthenticationManager is a component that ships as part of WIF.</span></span> <span data-ttu-id="62507-152">Он предоставляет возможность перехватывать запросы, когда они запускают приложения, проверяя токены и преобразуя их путем добавления, изменения или удаления утверждений.</span><span class="sxs-lookup"><span data-stu-id="62507-152">It allows requests to be intercepted when they launch an application, inspecting tokens and transforming them by adding, changing, or removing claims.</span></span> <span data-ttu-id="62507-153">Дополнительные сведения об использовании ClaimsAuthenticationManager для преобразования утверждений см. в разделе [How To: Реализация на основе ролей управления доступом (RBAC) в приложении ASP.NET виду утверждений с помощью WIF и ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span><span class="sxs-lookup"><span data-stu-id="62507-153">For more information about how to use ClaimsAuthenticationManager for transforming claims, see [How To: Implement Role Based Access Control (RBAC) in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span></span>  
  
-   <span data-ttu-id="62507-154">**Сопоставление произвольных утверждений с типом роли с помощью раздела конфигурации samlSecurityTokenRequirement** — декларативный подход, согласно которому преобразование утверждений выполняется исключительно с помощью конфигурации, а создавать код не требуется.</span><span class="sxs-lookup"><span data-stu-id="62507-154">**Mapping arbitrary claims to a role type using the samlSecurityTokenRequirement configuration section**—A declarative approach where the claims transformation is done using only the configuration and no coding is required.</span></span>  
  
<a name="BKMK_2"></a>   
## <a name="claims-based-authorization"></a><span data-ttu-id="62507-155">Авторизация на основе утверждений</span><span class="sxs-lookup"><span data-stu-id="62507-155">Claims-based Authorization</span></span>  
 <span data-ttu-id="62507-156">Авторизация на основе утверждений — это подход, согласно которому система авторизации принимает решение о предоставлении доступа или отказе в доступе на основе произвольной логики, использующей данные, доступные в утверждениях, для принятия такого решения.</span><span class="sxs-lookup"><span data-stu-id="62507-156">Claims-based authorization is an approach where the authorization decision to grant or deny access is based on arbitrary logic that uses data available in claims to make the decision.</span></span> <span data-ttu-id="62507-157">Помните, что в случае RBAC единственным используемым утверждением являлось утверждение типа роли.</span><span class="sxs-lookup"><span data-stu-id="62507-157">Recall that in the case of RBAC, the only claim used was role type claim.</span></span> <span data-ttu-id="62507-158">Утверждение типа роли использовалось для проверки принадлежности пользователя к определенной роли.</span><span class="sxs-lookup"><span data-stu-id="62507-158">A role type claim was used to check if the user belongs to specific role or not.</span></span> <span data-ttu-id="62507-159">Ниже представлен пример процесса принятия системой авторизации решения на основе утверждений:</span><span class="sxs-lookup"><span data-stu-id="62507-159">To illustrate the process of making the authorization decisions using claims-based authorization approach, consider the following steps:</span></span>  
  
1. <span data-ttu-id="62507-160">Приложение получает запрос на аутентификацию пользователя.</span><span class="sxs-lookup"><span data-stu-id="62507-160">The application receives a request that requires the user is authenticated.</span></span>  
  
2. <span data-ttu-id="62507-161">WIF перенаправляет пользователя к поставщику удостоверений. После аутентификации создается запрос приложения с применением связанного токена безопасности, представляющего пользователя и содержащего утверждения о нем.</span><span class="sxs-lookup"><span data-stu-id="62507-161">WIF redirects the user to their identity provider, after they are authenticated the application request is made with an associated security token representing the user containing claims about them.</span></span> <span data-ttu-id="62507-162">WIF связывает эти утверждения с субъектом, представляющим пользователя.</span><span class="sxs-lookup"><span data-stu-id="62507-162">WIF associates those claims with the principal that represents the user.</span></span>  
  
3. <span data-ttu-id="62507-163">Приложение передает утверждения в механизм логики принятия решений.</span><span class="sxs-lookup"><span data-stu-id="62507-163">The application passes the claims to the decision logic mechanism.</span></span> <span data-ttu-id="62507-164">Это может быть встроенный код, обращение к веб-службе, запрос базы данных, интеллектуальный механизм создания правил или применение ClaimsAuthorizationManager.</span><span class="sxs-lookup"><span data-stu-id="62507-164">It can be in-memory code, a call to a web service, a query to a database, a sophisticated rules engine, or using the ClaimsAuthorizationManager.</span></span>  
  
4. <span data-ttu-id="62507-165">Механизм принятия решения вычисляет результат на основе утверждений.</span><span class="sxs-lookup"><span data-stu-id="62507-165">The decision mechanism calculates the outcome based on the claims.</span></span>  
  
5. <span data-ttu-id="62507-166">Доступ предоставляется, если результат имеет значение true, и не предоставляется, если результат имеет значение false.</span><span class="sxs-lookup"><span data-stu-id="62507-166">Access is granted if the outcome is true and denied if it is false.</span></span> <span data-ttu-id="62507-167">Например, может существовать правило, согласно которому пользователю должно быть не менее 21 года и он должен проживать в штате Вашингтон.</span><span class="sxs-lookup"><span data-stu-id="62507-167">For example, the rule might be that the user is of age 21 or above and lives in Washington State.</span></span>  
  
 <span data-ttu-id="62507-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> — полезная система внешнего выражения логики принятия решений для авторизации на основе утверждений в ваших приложениях.</span><span class="sxs-lookup"><span data-stu-id="62507-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> is useful for externalizing the decision logic for  claims-based authorization in your applications.</span></span> <span data-ttu-id="62507-169">ClaimsAuthenticationManager — это один из компонентов WIF, предоставляемый в комплекте с .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="62507-169">ClaimsAuthorizationManager is a WIF component that ships as part of .NET 4.5.</span></span> <span data-ttu-id="62507-170">ClaimsAuthorizationManager позволяет перехватывать входящие запросы и реализовать любую логику на усмотрение разработчика для принятия решений об авторизации на основе входящих утверждений.</span><span class="sxs-lookup"><span data-stu-id="62507-170">ClaimsAuthorizationManager allows you to intercept incoming requests and implement any logic of your choice to make authorization decisions based on the incoming claims.</span></span> <span data-ttu-id="62507-171">Такая возможность приобретает существенное значение, если логику авторизации требуется изменить.</span><span class="sxs-lookup"><span data-stu-id="62507-171">This becomes important when authorization logic needs to be changed.</span></span> <span data-ttu-id="62507-172">В этом случае использование ClaimsAuthorizationManager не влияет на целостность приложения, благодаря чему уменьшается вероятность возникновения ошибки приложения в результате изменения.</span><span class="sxs-lookup"><span data-stu-id="62507-172">In that case, using ClaimsAuthorizationManager will not affect the application’s integrity, thereby reducing the likelihood of an application error as a result of the change.</span></span> <span data-ttu-id="62507-173">Дополнительные сведения об использовании ClaimsAuthorizationManager для реализации управления доступом на основе утверждений, см. в разделе [How To: Реализации авторизации утверждений в приложении виду ASP.NET утверждения, с помощью WIF и ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span><span class="sxs-lookup"><span data-stu-id="62507-173">To learn more about how to use ClaimsAuthorizationManager to implement claims-based access control, see [How To: Implement Claims Authorization in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span></span>
