---
title: Пошаговое руководство. Создание элемента управления Windows Forms, в котором используются преимущества функций Visual Studio, применяемых во время разработки
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Windows Forms controls, creating
- design-time functionality [Windows Forms], Windows Forms
- DocumentDesigner class [Windows Forms]
- walkthroughs [Windows Forms], controls
ms.assetid: 6f487c59-cb38-4afa-ad2e-95edacb1d626
ms.openlocfilehash: c8d04725a576c9e24a4b7d4aec1251516a8c544c
ms.sourcegitcommit: cdf67135a98a5a51913dacddb58e004a3c867802
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69666233"
---
# <a name="walkthrough-creating-a-windows-forms-control-that-takes-advantage-of-visual-studio-design-time-features"></a><span data-ttu-id="3f483-102">Пошаговое руководство. Создание элемента управления Windows Forms, в котором используются преимущества функций Visual Studio, применяемых во время разработки</span><span class="sxs-lookup"><span data-stu-id="3f483-102">Walkthrough: Creating a Windows Forms Control That Takes Advantage of Visual Studio Design-Time Features</span></span>

<span data-ttu-id="3f483-103">Интерфейс времени разработки для пользовательского элемента управления можно расширить путем создания связанного пользовательского конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-103">The design-time experience for a custom control can be enhanced by authoring an associated custom designer.</span></span>

<span data-ttu-id="3f483-104">В этом пошаговом руководстве показано, как создать пользовательский конструктор для пользовательского элемента управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-104">This walkthrough illustrates how to create a custom designer for a custom control.</span></span> <span data-ttu-id="3f483-105">Будет реализован `MarqueeControl` тип и связанный класс конструктора с именем `MarqueeControlRootDesigner`.</span><span class="sxs-lookup"><span data-stu-id="3f483-105">You will implement a `MarqueeControl` type and an associated designer class, called `MarqueeControlRootDesigner`.</span></span>

<span data-ttu-id="3f483-106">`MarqueeControl` Тип реализует экран, аналогичный области театра с анимированными индикаторами и мигающим текстом.</span><span class="sxs-lookup"><span data-stu-id="3f483-106">The `MarqueeControl` type implements a display similar to a theater marquee, with animated lights and flashing text.</span></span>

<span data-ttu-id="3f483-107">Конструктор для этого элемента управления взаимодействует с средой разработки, чтобы обеспечить пользовательский интерфейс во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-107">The designer for this control interacts with the design environment to provide a custom design-time experience.</span></span> <span data-ttu-id="3f483-108">С помощью пользовательского конструктора можно собирать пользовательскую `MarqueeControl` реализацию с анимированными индикаторами и мигающим текстом во многих сочетаниях.</span><span class="sxs-lookup"><span data-stu-id="3f483-108">With the custom designer, you can assemble a custom `MarqueeControl` implementation with animated lights and flashing text in many combinations.</span></span> <span data-ttu-id="3f483-109">Собранный элемент управления можно использовать в форме, как и любой другой элемент управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="3f483-109">You can use the assembled control on a form like any other Windows Forms control.</span></span>

<span data-ttu-id="3f483-110">В данном пошаговом руководстве представлены следующие задачи.</span><span class="sxs-lookup"><span data-stu-id="3f483-110">Tasks illustrated in this walkthrough include:</span></span>

- <span data-ttu-id="3f483-111">Создание проекта</span><span class="sxs-lookup"><span data-stu-id="3f483-111">Creating the Project</span></span>

- <span data-ttu-id="3f483-112">Создание проекта библиотеки элементов управления</span><span class="sxs-lookup"><span data-stu-id="3f483-112">Creating a Control Library Project</span></span>

- <span data-ttu-id="3f483-113">Ссылка на проект пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-113">Referencing the Custom Control Project</span></span>

- <span data-ttu-id="3f483-114">Определение пользовательского элемента управления и его пользовательского конструктора</span><span class="sxs-lookup"><span data-stu-id="3f483-114">Defining a Custom Control and Its Custom Designer</span></span>

- <span data-ttu-id="3f483-115">Создание экземпляра пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-115">Creating an Instance of Your Custom Control</span></span>

- <span data-ttu-id="3f483-116">Настройка проекта для отладки во время разработки</span><span class="sxs-lookup"><span data-stu-id="3f483-116">Setting Up the Project for Design-Time Debugging</span></span>

- <span data-ttu-id="3f483-117">Реализация пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-117">Implementing Your Custom Control</span></span>

- <span data-ttu-id="3f483-118">Создание дочернего элемента управления для пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-118">Creating a Child Control for Your Custom Control</span></span>

- <span data-ttu-id="3f483-119">Создание дочернего элемента управления Маркуибордер</span><span class="sxs-lookup"><span data-stu-id="3f483-119">Create the MarqueeBorder Child Control</span></span>

- <span data-ttu-id="3f483-120">Создание пользовательского конструктора для теневого копирования и свойств фильтра</span><span class="sxs-lookup"><span data-stu-id="3f483-120">Creating a Custom Designer to Shadow and Filter Properties</span></span>

- <span data-ttu-id="3f483-121">Обработка изменений компонентов</span><span class="sxs-lookup"><span data-stu-id="3f483-121">Handling Component Changes</span></span>

- <span data-ttu-id="3f483-122">Добавление команд конструктора в пользовательский конструктор</span><span class="sxs-lookup"><span data-stu-id="3f483-122">Adding Designer Verbs to your Custom Designer</span></span>

- <span data-ttu-id="3f483-123">Создание пользовательского UITypeEditor</span><span class="sxs-lookup"><span data-stu-id="3f483-123">Creating a Custom UITypeEditor</span></span>

- <span data-ttu-id="3f483-124">Тестирование пользовательского элемента управления в конструкторе</span><span class="sxs-lookup"><span data-stu-id="3f483-124">Testing your Custom Control in the Designer</span></span>

<span data-ttu-id="3f483-125">По завершении пользовательский элемент управления будет выглядеть примерно следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3f483-125">When you are finished, your custom control will look something like the following:</span></span>

![Приложение, показывающее текст с текстом и кнопки запуска и окончания.](./media/creating-a-wf-control-design-time-features/demo-marquee-control.gif)

<span data-ttu-id="3f483-127">Полный листинг кода см. в разделе [как Создайте элемент управления Windows Forms, который использует преимущества функций](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/307hck25(v=vs.120))времени разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-127">For the complete code listing, see [How to: Create a Windows Forms Control That Takes Advantage of Design-Time Features](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/307hck25(v=vs.120)).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="3f483-128">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="3f483-128">Prerequisites</span></span>

<span data-ttu-id="3f483-129">Для выполнения этого пошагового руководства вам потребуется Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f483-129">In order to complete this walkthrough, you'll need Visual Studio.</span></span>

## <a name="creating-the-project"></a><span data-ttu-id="3f483-130">Создание проекта</span><span class="sxs-lookup"><span data-stu-id="3f483-130">Creating the Project</span></span>

<span data-ttu-id="3f483-131">Первым шагом является создание проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="3f483-131">The first step is to create the application project.</span></span> <span data-ttu-id="3f483-132">Этот проект будет использоваться для создания приложения, в котором размещается пользовательский элемент управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-132">You will use this project to build the application that hosts the custom control.</span></span>

<span data-ttu-id="3f483-133">Откройте Visual Studio и создайте проект приложения Windows Forms с именем "маркуиконтролтест" (**файл** > **создать** > **проект** >  **C# визуальный** элемент или **Visual Basic**  >  **Классический рабочий стол** **Windows Forms приложение).**  > </span><span class="sxs-lookup"><span data-stu-id="3f483-133">Open Visual Studio and create a Windows Forms Application project called "MarqueeControlTest" (**File** > **New** > **Project** > **Visual C#** or **Visual Basic** > **Classic Desktop** > **Windows Forms Application**).</span></span>

## <a name="creating-a-control-library-project"></a><span data-ttu-id="3f483-134">Создание проекта библиотеки элементов управления</span><span class="sxs-lookup"><span data-stu-id="3f483-134">Creating a Control Library Project</span></span>

<span data-ttu-id="3f483-135">Следующим шагом является создание проекта библиотеки элементов управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-135">The next step is to create the control library project.</span></span> <span data-ttu-id="3f483-136">Будет создан новый пользовательский элемент управления и соответствующий ему пользовательский конструктор.</span><span class="sxs-lookup"><span data-stu-id="3f483-136">You will create a new custom control and its corresponding custom designer.</span></span>

### <a name="to-create-the-control-library-project"></a><span data-ttu-id="3f483-137">Создание проекта библиотеки элементов управления</span><span class="sxs-lookup"><span data-stu-id="3f483-137">To create the control library project</span></span>

1. <span data-ttu-id="3f483-138">Добавьте в решение проект библиотеки элементов управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="3f483-138">Add a Windows Forms Control Library project to the solution.</span></span> <span data-ttu-id="3f483-139">Назовите проект «Маркуиконтроллибрари».</span><span class="sxs-lookup"><span data-stu-id="3f483-139">Name the project "MarqueeControlLibrary."</span></span>

2. <span data-ttu-id="3f483-140">С помощью **Обозреватель решений**удалите элемент управления проекта по умолчанию, удалив исходный файл с именем "UserControl1.cs" или "UserControl1. vb" в зависимости от выбранного языка.</span><span class="sxs-lookup"><span data-stu-id="3f483-140">Using **Solution Explorer**, delete the project's default control by deleting the source file named "UserControl1.cs" or "UserControl1.vb", depending on your language of choice.</span></span> <span data-ttu-id="3f483-141">Дополнительные сведения см. в разделе [Практическое руководство. Удаление, удаление и исключение элементов](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/0ebzhwsk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="3f483-141">For more information, see [How to: Remove, Delete, and Exclude Items](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/0ebzhwsk(v=vs.100)).</span></span>

3. <span data-ttu-id="3f483-142">Добавьте новый <xref:System.Windows.Forms.UserControl> элемент `MarqueeControlLibrary` в проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-142">Add a new <xref:System.Windows.Forms.UserControl> item to the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-143">Присвойте новому исходному файлу базовое имя "Маркуиконтрол".</span><span class="sxs-lookup"><span data-stu-id="3f483-143">Give the new source file a base name of "MarqueeControl."</span></span>

4. <span data-ttu-id="3f483-144">С помощью **Обозреватель решений**создайте новую папку в `MarqueeControlLibrary` проекте.</span><span class="sxs-lookup"><span data-stu-id="3f483-144">Using **Solution Explorer**, create a new folder in the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-145">Дополнительные сведения см. в разделе [Практическое руководство. Добавление новых элементов](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/w0572c5b(v=vs.100))проекта.</span><span class="sxs-lookup"><span data-stu-id="3f483-145">For more information, see [How to: Add New Project Items](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/w0572c5b(v=vs.100)).</span></span> <span data-ttu-id="3f483-146">Назовите новую папку «Design».</span><span class="sxs-lookup"><span data-stu-id="3f483-146">Name the new folder "Design."</span></span>

5. <span data-ttu-id="3f483-147">Щелкните правой кнопкой мыши папку **конструктора** и добавьте новый класс.</span><span class="sxs-lookup"><span data-stu-id="3f483-147">Right-click the **Design** folder and add a new class.</span></span> <span data-ttu-id="3f483-148">Присвойте исходному файлу базовое имя "Маркуиконтролрутдесигнер".</span><span class="sxs-lookup"><span data-stu-id="3f483-148">Give the source file a base name of "MarqueeControlRootDesigner."</span></span>

6. <span data-ttu-id="3f483-149">Вам потребуется использовать типы из сборки System. Design, поэтому добавьте эту ссылку в `MarqueeControlLibrary` проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-149">You will need to use types from the System.Design assembly, so add this reference to the `MarqueeControlLibrary` project.</span></span>

    > [!NOTE]
    > <span data-ttu-id="3f483-150">Чтобы использовать сборку System. Design, проект должен быть предназначен для полной версии .NET Framework, а не .NET Framework клиентского профиля.</span><span class="sxs-lookup"><span data-stu-id="3f483-150">To use the System.Design assembly, your project must target the full version of the .NET Framework, not the .NET Framework Client Profile.</span></span> <span data-ttu-id="3f483-151">Чтобы изменить целевую платформу, см [. раздел как определить целевую версию .NET Framework](/visualstudio/ide/how-to-target-a-version-of-the-dotnet-framework).</span><span class="sxs-lookup"><span data-stu-id="3f483-151">To change the target framework, see [How to: Target a Version of the .NET Framework](/visualstudio/ide/how-to-target-a-version-of-the-dotnet-framework).</span></span>

## <a name="referencing-the-custom-control-project"></a><span data-ttu-id="3f483-152">Ссылка на проект пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-152">Referencing the Custom Control Project</span></span>

<span data-ttu-id="3f483-153">Для тестирования пользовательского элемента `MarqueeControlTest` управления будет использоваться проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-153">You will use the `MarqueeControlTest` project to test the custom control.</span></span> <span data-ttu-id="3f483-154">Тестовый проект будет получать информацию о пользовательском элементе управления при добавлении в нее `MarqueeControlLibrary` ссылки на проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-154">The test project will become aware of the custom control when you add a project reference to the `MarqueeControlLibrary` assembly.</span></span>

### <a name="to-reference-the-custom-control-project"></a><span data-ttu-id="3f483-155">Ссылка на проект пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-155">To reference the custom control project</span></span>

- <span data-ttu-id="3f483-156">В проекте добавьте в `MarqueeControlLibrary` сборку ссылку на проект. `MarqueeControlTest`</span><span class="sxs-lookup"><span data-stu-id="3f483-156">In the `MarqueeControlTest` project, add a project reference to the `MarqueeControlLibrary` assembly.</span></span> <span data-ttu-id="3f483-157">Обязательно используйте вкладку **проекты** в диалоговом окне **Добавление ссылки** вместо непосредственной ссылки на `MarqueeControlLibrary` сборку.</span><span class="sxs-lookup"><span data-stu-id="3f483-157">Be sure to use the **Projects** tab in the **Add Reference** dialog box instead of referencing the `MarqueeControlLibrary` assembly directly.</span></span>

## <a name="defining-a-custom-control-and-its-custom-designer"></a><span data-ttu-id="3f483-158">Определение пользовательского элемента управления и его пользовательского конструктора</span><span class="sxs-lookup"><span data-stu-id="3f483-158">Defining a Custom Control and Its Custom Designer</span></span>
 <span data-ttu-id="3f483-159">Пользовательский элемент управления будет производным от <xref:System.Windows.Forms.UserControl> класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-159">Your custom control will derive from the <xref:System.Windows.Forms.UserControl> class.</span></span> <span data-ttu-id="3f483-160">Это позволяет элементу управления содержать другие элементы управления, а также обеспечивает большую часть функциональных возможностей по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3f483-160">This allows your control to contain other controls, and it gives your control a great deal of default functionality.</span></span>

 <span data-ttu-id="3f483-161">Пользовательский элемент управления будет иметь связанный пользовательский конструктор.</span><span class="sxs-lookup"><span data-stu-id="3f483-161">Your custom control will have an associated custom designer.</span></span> <span data-ttu-id="3f483-162">Это позволяет создать уникальный интерфейс разработки, специально предназначенный для пользовательского элемента управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-162">This allows you to create a unique design experience tailored specifically for your custom control.</span></span>

 <span data-ttu-id="3f483-163">Элемент управления связывается с конструктором с помощью <xref:System.ComponentModel.DesignerAttribute> класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-163">You associate the control with its designer by using the <xref:System.ComponentModel.DesignerAttribute> class.</span></span> <span data-ttu-id="3f483-164">Поскольку вы разрабатываете все поведение пользовательского элемента управления во время разработки, Пользовательский конструктор будет реализовывать <xref:System.ComponentModel.Design.IRootDesigner> интерфейс.</span><span class="sxs-lookup"><span data-stu-id="3f483-164">Because you are developing the entire design-time behavior of your custom control, the custom designer will implement the <xref:System.ComponentModel.Design.IRootDesigner> interface.</span></span>

### <a name="to-define-a-custom-control-and-its-custom-designer"></a><span data-ttu-id="3f483-165">Определение пользовательского элемента управления и его пользовательского конструктора</span><span class="sxs-lookup"><span data-stu-id="3f483-165">To define a custom control and its custom designer</span></span>

1. <span data-ttu-id="3f483-166">Откройте исходный файл в **редакторе кода.** `MarqueeControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-166">Open the `MarqueeControl` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-167">В верхней части файла импортируйте следующие пространства имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-167">At the top of the file, import the following namespaces:</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#220](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrol.cs#220)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#220](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrol.vb#220)]

2. <span data-ttu-id="3f483-168"><xref:System.ComponentModel.DesignerAttribute> Добавьте`MarqueeControl` в объявление класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-168">Add the <xref:System.ComponentModel.DesignerAttribute> to the `MarqueeControl` class declaration.</span></span> <span data-ttu-id="3f483-169">При этом пользовательский элемент управления связывается с его конструктором.</span><span class="sxs-lookup"><span data-stu-id="3f483-169">This associates the custom control with its designer.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#240](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrol.cs#240)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#240](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrol.vb#240)]

3. <span data-ttu-id="3f483-170">Откройте исходный файл в **редакторе кода.** `MarqueeControlRootDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-170">Open the `MarqueeControlRootDesigner` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-171">В верхней части файла импортируйте следующие пространства имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-171">At the top of the file, import the following namespaces:</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#520](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#520)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#520](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#520)]

4. <span data-ttu-id="3f483-172">Измените объявление `MarqueeControlRootDesigner` для наследования <xref:System.Windows.Forms.Design.DocumentDesigner> от класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-172">Change the declaration of `MarqueeControlRootDesigner` to inherit from the <xref:System.Windows.Forms.Design.DocumentDesigner> class.</span></span> <span data-ttu-id="3f483-173">Примените <xref:System.ComponentModel.ToolboxItemFilterAttribute> , чтобы указать взаимодействие конструктора с **панелью элементов**.</span><span class="sxs-lookup"><span data-stu-id="3f483-173">Apply the <xref:System.ComponentModel.ToolboxItemFilterAttribute> to specify the designer interaction with the **Toolbox**.</span></span>

     <span data-ttu-id="3f483-174">**Примечание** . Определение `MarqueeControlRootDesigner` класса было заключено в пространство имен с именем «маркуиконтроллибрари. Design».</span><span class="sxs-lookup"><span data-stu-id="3f483-174">**Note** The definition for the `MarqueeControlRootDesigner` class has been enclosed in a namespace called "MarqueeControlLibrary.Design."</span></span> <span data-ttu-id="3f483-175">Это объявление помещает конструктор в специальное пространство имен, зарезервированное для типов, связанных с конструированием.</span><span class="sxs-lookup"><span data-stu-id="3f483-175">This declaration places the designer in a special namespace reserved for design-related types.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#530](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#530)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#530](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#530)]

5. <span data-ttu-id="3f483-176">Определите конструктор для `MarqueeControlRootDesigner` класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-176">Define the constructor for the `MarqueeControlRootDesigner` class.</span></span> <span data-ttu-id="3f483-177"><xref:System.Diagnostics.Trace.WriteLine%2A> Вставьте оператор в тело конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-177">Insert a <xref:System.Diagnostics.Trace.WriteLine%2A> statement in the constructor body.</span></span> <span data-ttu-id="3f483-178">Это будет полезно в целях отладки.</span><span class="sxs-lookup"><span data-stu-id="3f483-178">This will be useful for debugging purposes.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#540](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#540)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#540](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#540)]

## <a name="creating-an-instance-of-your-custom-control"></a><span data-ttu-id="3f483-179">Создание экземпляра пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-179">Creating an Instance of Your Custom Control</span></span>
 <span data-ttu-id="3f483-180">Чтобы наблюдать за пользовательским поведением элемента управления во время разработки, необходимо поместить экземпляр элемента управления в форму в `MarqueeControlTest` Project.</span><span class="sxs-lookup"><span data-stu-id="3f483-180">To observe the custom design-time behavior of your control, you will place an instance of your control on the form in `MarqueeControlTest` project.</span></span>

### <a name="to-create-an-instance-of-your-custom-control"></a><span data-ttu-id="3f483-181">Создание экземпляра пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-181">To create an instance of your custom control</span></span>

1. <span data-ttu-id="3f483-182">Добавьте новый <xref:System.Windows.Forms.UserControl> элемент `MarqueeControlTest` в проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-182">Add a new <xref:System.Windows.Forms.UserControl> item to the `MarqueeControlTest` project.</span></span> <span data-ttu-id="3f483-183">Присвойте новому исходному файлу базовое имя "Демомаркуиконтрол".</span><span class="sxs-lookup"><span data-stu-id="3f483-183">Give the new source file a base name of "DemoMarqueeControl."</span></span>

2. <span data-ttu-id="3f483-184">Откройте файл в **редакторе кода.** `DemoMarqueeControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-184">Open the `DemoMarqueeControl` file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-185">В верхней части файла импортируйте `MarqueeControlLibrary` пространство имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-185">At the top of the file, import the `MarqueeControlLibrary` namespace:</span></span>

```vb
Imports MarqueeControlLibrary
```

```csharp
using MarqueeControlLibrary;
```

1. <span data-ttu-id="3f483-186">Измените объявление `DemoMarqueeControl` для наследования `MarqueeControl` от класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-186">Change the declaration of `DemoMarqueeControl` to inherit from the `MarqueeControl` class.</span></span>

2. <span data-ttu-id="3f483-187">Выполните построение проекта.</span><span class="sxs-lookup"><span data-stu-id="3f483-187">Build the project.</span></span>

3. <span data-ttu-id="3f483-188">Откройте `Form1` в конструкторе Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="3f483-188">Open `Form1` in the Windows Forms Designer.</span></span>

4. <span data-ttu-id="3f483-189">Найдите вкладку **компоненты маркуиконтролтест** на **панели элементов** и откройте ее.</span><span class="sxs-lookup"><span data-stu-id="3f483-189">Find the **MarqueeControlTest Components** tab in the **Toolbox** and open it.</span></span> <span data-ttu-id="3f483-190">Перетащите элемент `DemoMarqueeControl` из **области элементов** на форму.</span><span class="sxs-lookup"><span data-stu-id="3f483-190">Drag a `DemoMarqueeControl` from the **Toolbox** onto your form.</span></span>

5. <span data-ttu-id="3f483-191">Выполните построение проекта.</span><span class="sxs-lookup"><span data-stu-id="3f483-191">Build the project.</span></span>

## <a name="setting-up-the-project-for-design-time-debugging"></a><span data-ttu-id="3f483-192">Настройка проекта для отладки во время разработки</span><span class="sxs-lookup"><span data-stu-id="3f483-192">Setting Up the Project for Design-Time Debugging</span></span>

<span data-ttu-id="3f483-193">При разработке настраиваемой среды разработки необходимо выполнять отладку элементов управления и компонентов.</span><span class="sxs-lookup"><span data-stu-id="3f483-193">When you are developing a custom design-time experience, it will be necessary to debug your controls and components.</span></span> <span data-ttu-id="3f483-194">Существует простой способ настройки проекта, позволяющий выполнять отладку во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-194">There is a simple way to set up your project to allow debugging at design time.</span></span> <span data-ttu-id="3f483-195">Дополнительные сведения см. в разделе [Пошаговое руководство: Отладка пользовательских элементов управления Windows Forms во](walkthrough-debugging-custom-windows-forms-controls-at-design-time.md)время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-195">For more information, see [Walkthrough: Debugging Custom Windows Forms Controls at Design Time](walkthrough-debugging-custom-windows-forms-controls-at-design-time.md).</span></span>

### <a name="to-set-up-the-project-for-design-time-debugging"></a><span data-ttu-id="3f483-196">Настройка проекта для отладки во время разработки</span><span class="sxs-lookup"><span data-stu-id="3f483-196">To set up the project for design-time debugging</span></span>

1. <span data-ttu-id="3f483-197">Щелкните `MarqueeControlLibrary` правой кнопкой мыши проект и выберите пункт **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="3f483-197">Right-click the `MarqueeControlLibrary` project and select **Properties**.</span></span>

2. <span data-ttu-id="3f483-198">В диалоговом окне "страницы свойств Маркуиконтроллибрари" выберите страницу **Отладка** .</span><span class="sxs-lookup"><span data-stu-id="3f483-198">In the "MarqueeControlLibrary Property Pages" dialog box, select the **Debug** page.</span></span>

3. <span data-ttu-id="3f483-199">В разделе **действие при запуске** выберите **Запуск внешней программы**.</span><span class="sxs-lookup"><span data-stu-id="3f483-199">In the **Start Action** section, select **Start External Program**.</span></span> <span data-ttu-id="3f483-200">Вы будете выполнять отладку отдельного экземпляра Visual Studio, поэтому нажмите кнопку с многоточием![(...) в окно свойств кнопки Visual Studio.](./media/visual-studio-ellipsis-button.png)), чтобы найти интегрированную среду разработки Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f483-200">You will be debugging a separate instance of Visual Studio, so click the ellipsis (![The Ellipsis button (...) in the Properties window of Visual Studio.](./media/visual-studio-ellipsis-button.png)) button to browse for the Visual Studio IDE.</span></span> <span data-ttu-id="3f483-201">Имя исполняемого файла — devenv. exe, и если вы установили в расположение по умолчанию, то его путь —%programfiles%\Microsoft Visual Studio 9.0 \ Common7\IDE\devenv.exe.</span><span class="sxs-lookup"><span data-stu-id="3f483-201">The name of the executable file is devenv.exe, and if you installed to the default location, its path is %programfiles%\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe.</span></span>

4. <span data-ttu-id="3f483-202">Нажмите кнопку ОК, чтобы закрыть диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="3f483-202">Click OK to close the dialog box.</span></span>

5. <span data-ttu-id="3f483-203">Щелкните `MarqueeControlLibrary` проект правой кнопкой мыши и выберите команду "Назначить запускаемым проектом", чтобы включить эту конфигурацию отладки.</span><span class="sxs-lookup"><span data-stu-id="3f483-203">Right-click the `MarqueeControlLibrary` project and select "Set as StartUp Project" to enable this debugging configuration.</span></span>

## <a name="checkpoint"></a><span data-ttu-id="3f483-204">Контрольная точка</span><span class="sxs-lookup"><span data-stu-id="3f483-204">Checkpoint</span></span>

<span data-ttu-id="3f483-205">Теперь все готово для отладки поведения пользовательского элемента управления во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-205">You are now ready to debug the design-time behavior of your custom control.</span></span> <span data-ttu-id="3f483-206">После определения того, что среда отладки настроена правильно, вы проверите связь между пользовательским элементом управления и пользовательским конструктором.</span><span class="sxs-lookup"><span data-stu-id="3f483-206">Once you have determined that the debugging environment is set up correctly, you will test the association between the custom control and the custom designer.</span></span>

### <a name="to-test-the-debugging-environment-and-the-designer-association"></a><span data-ttu-id="3f483-207">Тестирование среды отладки и ассоциации конструктора</span><span class="sxs-lookup"><span data-stu-id="3f483-207">To test the debugging environment and the designer association</span></span>

1. <span data-ttu-id="3f483-208">Откройте исходный файл в **редакторе кода** и поместите точку останова в <xref:System.Diagnostics.Trace.WriteLine%2A> инструкцию. `MarqueeControlRootDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-208">Open the `MarqueeControlRootDesigner` source file in the **Code Editor** and place a breakpoint on the <xref:System.Diagnostics.Trace.WriteLine%2A> statement.</span></span>

2. <span data-ttu-id="3f483-209">Нажмите клавишу F5, чтобы запустить сеанс отладки.</span><span class="sxs-lookup"><span data-stu-id="3f483-209">Press F5 to start the debugging session.</span></span> <span data-ttu-id="3f483-210">Обратите внимание, что создается новый экземпляр Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f483-210">Note that a new instance of Visual Studio is created.</span></span>

3. <span data-ttu-id="3f483-211">В новом экземпляре Visual Studio откройте решение "Маркуиконтролтест".</span><span class="sxs-lookup"><span data-stu-id="3f483-211">In the new instance of Visual Studio, open the "MarqueeControlTest" solution.</span></span> <span data-ttu-id="3f483-212">Решение можно легко найти, выбрав **последние проекты** в меню **файл** .</span><span class="sxs-lookup"><span data-stu-id="3f483-212">You can easily find the solution by selecting **Recent Projects** from the **File** menu.</span></span> <span data-ttu-id="3f483-213">Файл решения "Маркуиконтролтест. sln" будет указан как самый последний использовавшийся файл.</span><span class="sxs-lookup"><span data-stu-id="3f483-213">The "MarqueeControlTest.sln" solution file will be listed as the most recently used file.</span></span>

4. <span data-ttu-id="3f483-214">`DemoMarqueeControl` Откройте в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3f483-214">Open the `DemoMarqueeControl` in the designer.</span></span> <span data-ttu-id="3f483-215">Обратите внимание, что экземпляр отладки Visual Studio получает фокус и выполнение останавливается в точке останова.</span><span class="sxs-lookup"><span data-stu-id="3f483-215">Note that the debugging instance of Visual Studio acquires focus and execution stops at your breakpoint.</span></span> <span data-ttu-id="3f483-216">Нажмите клавишу F5, чтобы продолжить сеанс отладки.</span><span class="sxs-lookup"><span data-stu-id="3f483-216">Press F5 to continue the debugging session.</span></span>

<span data-ttu-id="3f483-217">На этом этапе все готово для разработки и отладки пользовательского элемента управления и связанного с ним пользовательского конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-217">At this point, everything is in place for you to develop and debug your custom control and its associated custom designer.</span></span> <span data-ttu-id="3f483-218">Оставшаяся часть этого пошагового руководства посвящена деталям реализации функций элемента управления и конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-218">The remainder of this walkthrough will concentrate on the details of implementing features of the control and the designer.</span></span>

## <a name="implementing-your-custom-control"></a><span data-ttu-id="3f483-219">Реализация пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-219">Implementing Your Custom Control</span></span>

<span data-ttu-id="3f483-220">`MarqueeControl` —Этос<xref:System.Windows.Forms.UserControl> небольшой настройкой.</span><span class="sxs-lookup"><span data-stu-id="3f483-220">The `MarqueeControl` is a <xref:System.Windows.Forms.UserControl> with a little bit of customization.</span></span> <span data-ttu-id="3f483-221">Он предоставляет два метода: `Start`, который запускает анимацию бегущей строки и `Stop`, в результате которой останавливается анимация.</span><span class="sxs-lookup"><span data-stu-id="3f483-221">It exposes two methods: `Start`, which starts the marquee animation, and `Stop`, which stops the animation.</span></span> <span data-ttu-id="3f483-222">`StartMarquee` `IMarqueeWidget` `StopMarquee` `Stop` `Start` Поскольку содержит дочерние элементы управления, реализующие интерфейс, и перечисляет каждый дочерний элемент управления и вызывают методы и соответственно для каждого дочернего элемента управления. `MarqueeControl` , реализующий интерфейс `IMarqueeWidget`.</span><span class="sxs-lookup"><span data-stu-id="3f483-222">Because the `MarqueeControl` contains child controls that implement the `IMarqueeWidget` interface, `Start` and `Stop` enumerate each child control and call the `StartMarquee` and `StopMarquee` methods, respectively, on each child control that implements `IMarqueeWidget`.</span></span>

<span data-ttu-id="3f483-223">Внешний вид `MarqueeBorder` элементов управления и `MarqueeText` зависит от <xref:System.Windows.Forms.Control.OnLayout%2A> макета, поэтому `MarqueeControl` переопределяет метод и вызывает <xref:System.Windows.Forms.Control.PerformLayout%2A> дочерние элементы управления этого типа.</span><span class="sxs-lookup"><span data-stu-id="3f483-223">The appearance of the `MarqueeBorder` and `MarqueeText` controls is dependent on the layout, so `MarqueeControl` overrides the <xref:System.Windows.Forms.Control.OnLayout%2A> method and calls <xref:System.Windows.Forms.Control.PerformLayout%2A> on child controls of this type.</span></span>

<span data-ttu-id="3f483-224">Это экстент `MarqueeControl` настроек.</span><span class="sxs-lookup"><span data-stu-id="3f483-224">This is the extent of the `MarqueeControl` customizations.</span></span> <span data-ttu-id="3f483-225">`MarqueeBorder` Функции времени выполнения реализуются элементами управления и `MarqueeText` , а `MarqueeBorderDesigner` функции времени разработки реализуются классами и `MarqueeControlRootDesigner` .</span><span class="sxs-lookup"><span data-stu-id="3f483-225">The run-time features are implemented by the `MarqueeBorder` and `MarqueeText` controls, and the design-time features are implemented by the `MarqueeBorderDesigner` and `MarqueeControlRootDesigner` classes.</span></span>

### <a name="to-implement-your-custom-control"></a><span data-ttu-id="3f483-226">Реализация пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-226">To implement your custom control</span></span>

1. <span data-ttu-id="3f483-227">Откройте исходный файл в **редакторе кода.** `MarqueeControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-227">Open the `MarqueeControl` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-228">Реализуйте методы `Stop`и. `Start`</span><span class="sxs-lookup"><span data-stu-id="3f483-228">Implement the `Start` and `Stop` methods.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#260](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrol.cs#260)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#260](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrol.vb#260)]

2. <span data-ttu-id="3f483-229">Переопределите метод <xref:System.Windows.Forms.Control.OnLayout%2A> .</span><span class="sxs-lookup"><span data-stu-id="3f483-229">Override the <xref:System.Windows.Forms.Control.OnLayout%2A> method.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#270](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrol.cs#270)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#270](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrol.vb#270)]

## <a name="creating-a-child-control-for-your-custom-control"></a><span data-ttu-id="3f483-230">Создание дочернего элемента управления для пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-230">Creating a Child Control for Your Custom Control</span></span>

<span data-ttu-id="3f483-231">В `MarqueeControl` будет размещено два вида дочерних элементов управления `MarqueeBorder` : элемент управления и `MarqueeText` элемент управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-231">The `MarqueeControl` will host two kinds of child control: the `MarqueeBorder` control and the `MarqueeText` control.</span></span>

- <span data-ttu-id="3f483-232">`MarqueeBorder`: Этот элемент управления рисует границу «огни» вокруг ее границ.</span><span class="sxs-lookup"><span data-stu-id="3f483-232">`MarqueeBorder`: This control paints a border of "lights" around its edges.</span></span> <span data-ttu-id="3f483-233">Индикаторы помещаются поочередно, поэтому они перемещаются вокруг границы.</span><span class="sxs-lookup"><span data-stu-id="3f483-233">The lights flash in sequence, so they appear to be moving around the border.</span></span> <span data-ttu-id="3f483-234">Скорость, с которой мигают световые индикаторы, определяется свойством `UpdatePeriod`.</span><span class="sxs-lookup"><span data-stu-id="3f483-234">The speed at which the lights flash is controlled by a property called `UpdatePeriod`.</span></span> <span data-ttu-id="3f483-235">Несколько других пользовательских свойств определяют другие аспекты внешнего вида элемента управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-235">Several other custom properties determine other aspects of the control's appearance.</span></span> <span data-ttu-id="3f483-236">Два метода, `StartMarquee` называемые `StopMarquee`и, управляют началом и остановкой анимации.</span><span class="sxs-lookup"><span data-stu-id="3f483-236">Two methods, called `StartMarquee` and `StopMarquee`, control when the animation starts and stops.</span></span>

- <span data-ttu-id="3f483-237">`MarqueeText`: Этот элемент управления закрашивает мигающую строку.</span><span class="sxs-lookup"><span data-stu-id="3f483-237">`MarqueeText`: This control paints a flashing string.</span></span> <span data-ttu-id="3f483-238">Как и `UpdatePeriod` элемент управления, скорость, с которой происходит мигание текста, определяется свойством. `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-238">Like the `MarqueeBorder` control, the speed at which the text flashes is controlled by the `UpdatePeriod` property.</span></span> <span data-ttu-id="3f483-239">Элемент управления также `StartMarquee` имеет методы и `StopMarquee` , общие с `MarqueeBorder` элементом управления. `MarqueeText`</span><span class="sxs-lookup"><span data-stu-id="3f483-239">The `MarqueeText` control also has the `StartMarquee` and `StopMarquee` methods in common with the `MarqueeBorder` control.</span></span>

<span data-ttu-id="3f483-240">Во время `MarqueeControlRootDesigner` разработки позволяет добавлять `MarqueeControl` эти два типа элементов управления в любое сочетание.</span><span class="sxs-lookup"><span data-stu-id="3f483-240">At design time, the `MarqueeControlRootDesigner` allows these two control types to be added to a `MarqueeControl` in any combination.</span></span>

<span data-ttu-id="3f483-241">Общие функции двух элементов управления делятся на интерфейс с именем `IMarqueeWidget`.</span><span class="sxs-lookup"><span data-stu-id="3f483-241">Common features of the two controls are factored into an interface called `IMarqueeWidget`.</span></span> <span data-ttu-id="3f483-242">Это позволяет элементу `MarqueeControl` обнаруживать все дочерние элементы управления, связанные с областью, и давать им специальную обработку.</span><span class="sxs-lookup"><span data-stu-id="3f483-242">This allows the `MarqueeControl` to discover any Marquee-related child controls and give them special treatment.</span></span>

<span data-ttu-id="3f483-243">Чтобы реализовать функцию периодической анимации, вы будете использовать <xref:System.ComponentModel.BackgroundWorker> объекты <xref:System.ComponentModel?displayProperty=nameWithType> из пространства имен.</span><span class="sxs-lookup"><span data-stu-id="3f483-243">To implement the periodic animation feature, you will use <xref:System.ComponentModel.BackgroundWorker> objects from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace.</span></span> <span data-ttu-id="3f483-244">Можно использовать <xref:System.Windows.Forms.Timer> объекты, но при наличии большого `IMarqueeWidget` числа объектов один поток пользовательского интерфейса может не поддерживать анимацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-244">You could use <xref:System.Windows.Forms.Timer> objects, but when many `IMarqueeWidget` objects are present, the single UI thread may be unable to keep up with the animation.</span></span>

### <a name="to-create-a-child-control-for-your-custom-control"></a><span data-ttu-id="3f483-245">Создание дочернего элемента управления для пользовательского элемента управления</span><span class="sxs-lookup"><span data-stu-id="3f483-245">To create a child control for your custom control</span></span>

1. <span data-ttu-id="3f483-246">Добавьте в `MarqueeControlLibrary` проект новый элемент класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-246">Add a new class item to the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-247">Присвойте новому исходному файлу базовое имя "Имаркуивиджет".</span><span class="sxs-lookup"><span data-stu-id="3f483-247">Give the new source file a base name of "IMarqueeWidget."</span></span>

2. <span data-ttu-id="3f483-248">Откройте исходный файл в **редакторе кода** и измените объявление с `class` на: `interface` `IMarqueeWidget`</span><span class="sxs-lookup"><span data-stu-id="3f483-248">Open the `IMarqueeWidget` source file in the **Code Editor** and change the declaration from `class` to `interface`:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#2](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/imarqueewidget.cs#2)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/imarqueewidget.vb#2)]

3. <span data-ttu-id="3f483-249">Добавьте следующий код в `IMarqueeWidget` интерфейс, чтобы предоставить два метода и свойство, управляющие анимацией области.</span><span class="sxs-lookup"><span data-stu-id="3f483-249">Add the following code to the `IMarqueeWidget` interface to expose two methods and a property that manipulate the marquee animation:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#3](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/imarqueewidget.cs#3)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#3](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/imarqueewidget.vb#3)]

4. <span data-ttu-id="3f483-250">Добавьте в `MarqueeControlLibrary` проект новый элемент **пользовательского элемента управления** .</span><span class="sxs-lookup"><span data-stu-id="3f483-250">Add a new **Custom Control** item to the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-251">Присвойте новому исходному файлу базовое имя "Маркуитекст".</span><span class="sxs-lookup"><span data-stu-id="3f483-251">Give the new source file a base name of "MarqueeText."</span></span>

5. <span data-ttu-id="3f483-252">Перетащите компонент из **панели элементов** на элементуправления.`MarqueeText` <xref:System.ComponentModel.BackgroundWorker></span><span class="sxs-lookup"><span data-stu-id="3f483-252">Drag a <xref:System.ComponentModel.BackgroundWorker> component from the **Toolbox** onto your `MarqueeText` control.</span></span> <span data-ttu-id="3f483-253">Этот компонент позволит `MarqueeText` элементу управления обновляться в асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="3f483-253">This component will allow the `MarqueeText` control to update itself asynchronously.</span></span>

6. <span data-ttu-id="3f483-254">В окно свойств установите <xref:System.ComponentModel.BackgroundWorker> для <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> `WorkerReportsProgress`компонентаисвойства значение`true`.</span><span class="sxs-lookup"><span data-stu-id="3f483-254">In the Properties window, set the <xref:System.ComponentModel.BackgroundWorker> component's `WorkerReportsProgress` and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span> <span data-ttu-id="3f483-255">Эти параметры позволяют <xref:System.ComponentModel.BackgroundWorker> компоненту периодически <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> вызывать событие и отменять асинхронные обновления.</span><span class="sxs-lookup"><span data-stu-id="3f483-255">These settings allow the <xref:System.ComponentModel.BackgroundWorker> component to periodically raise the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event and to cancel asynchronous updates.</span></span> <span data-ttu-id="3f483-256">Дополнительные сведения см. в разделе [компонент BackgroundWorker](backgroundworker-component.md).</span><span class="sxs-lookup"><span data-stu-id="3f483-256">For more information, see [BackgroundWorker Component](backgroundworker-component.md).</span></span>

7. <span data-ttu-id="3f483-257">Откройте исходный файл в **редакторе кода.** `MarqueeText`</span><span class="sxs-lookup"><span data-stu-id="3f483-257">Open the `MarqueeText` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-258">В верхней части файла импортируйте следующие пространства имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-258">At the top of the file, import the following namespaces:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#120](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#120)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#120](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#120)]

8. <span data-ttu-id="3f483-259">Измените объявление `MarqueeText` для наследования от <xref:System.Windows.Forms.Label> и для реализации `IMarqueeWidget` интерфейса:</span><span class="sxs-lookup"><span data-stu-id="3f483-259">Change the declaration of `MarqueeText` to inherit from <xref:System.Windows.Forms.Label> and to implement the `IMarqueeWidget` interface:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#130](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#130)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#130](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#130)]

9. <span data-ttu-id="3f483-260">Объявите переменные экземпляра, соответствующие предоставляемым свойствам, и инициализируйте их в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3f483-260">Declare the instance variables that correspond to the exposed properties, and initialize them in the constructor.</span></span> <span data-ttu-id="3f483-261">Поле определяет, следует ли закрасить текст в цвет, заданный `LightColor` свойством. `isLit`</span><span class="sxs-lookup"><span data-stu-id="3f483-261">The `isLit` field determines if the text is to be painted in the color given by the `LightColor` property.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#140](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#140)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#140](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#140)]

10. <span data-ttu-id="3f483-262">Реализовать интерфейс `IMarqueeWidget`.</span><span class="sxs-lookup"><span data-stu-id="3f483-262">Implement the `IMarqueeWidget` interface.</span></span>

    <span data-ttu-id="3f483-263">`StartMarquee` Методыи`StopMarquee` вызывают методыкомпонента<xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> и для запуска и завершения анимации. <xref:System.ComponentModel.BackgroundWorker.RunWorkerAsync%2A> <xref:System.ComponentModel.BackgroundWorker></span><span class="sxs-lookup"><span data-stu-id="3f483-263">The `StartMarquee` and `StopMarquee` methods invoke the <xref:System.ComponentModel.BackgroundWorker> component's <xref:System.ComponentModel.BackgroundWorker.RunWorkerAsync%2A> and <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> methods to start and stop the animation.</span></span>

    <span data-ttu-id="3f483-264">Атрибуты и применяются<xref:System.ComponentModel.BrowsableAttribute.Browsable%2A> к свойству,поэтомуоноотображаетсявпользовательскомразделеокносвойствсименем«бегущая`UpdatePeriod`строка». <xref:System.ComponentModel.CategoryAttribute.Category%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-264">The <xref:System.ComponentModel.CategoryAttribute.Category%2A> and <xref:System.ComponentModel.BrowsableAttribute.Browsable%2A> attributes are applied to the `UpdatePeriod` property so it appears in a custom section of the Properties window called "Marquee."</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#150](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#150)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#150](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#150)]

11. <span data-ttu-id="3f483-265">Реализуйте методы доступа к свойствам.</span><span class="sxs-lookup"><span data-stu-id="3f483-265">Implement the property accessors.</span></span> <span data-ttu-id="3f483-266">Вы будете предоставлять клиентам два свойства: `LightColor` и. `DarkColor`</span><span class="sxs-lookup"><span data-stu-id="3f483-266">You will expose two properties to clients: `LightColor` and `DarkColor`.</span></span> <span data-ttu-id="3f483-267">К этим <xref:System.ComponentModel.BrowsableAttribute.Browsable%2A> свойствам применяются атрибуты и,поэтомусвойстваотображаютсявпользовательскомразделеокносвойствсименем«бегущаястрока».<xref:System.ComponentModel.CategoryAttribute.Category%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-267">The <xref:System.ComponentModel.CategoryAttribute.Category%2A> and <xref:System.ComponentModel.BrowsableAttribute.Browsable%2A> attributes are applied to these properties, so the properties appear in a custom section of the Properties window called "Marquee."</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#160](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#160)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#160](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#160)]

12. <span data-ttu-id="3f483-268">Реализуйте обработчики для <xref:System.ComponentModel.BackgroundWorker> событий <xref:System.ComponentModel.BackgroundWorker.DoWork> компонента и <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> .</span><span class="sxs-lookup"><span data-stu-id="3f483-268">Implement the handlers for the <xref:System.ComponentModel.BackgroundWorker> component's <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> events.</span></span>

    <span data-ttu-id="3f483-269">Обработчик событий закладывается на число миллисекунд, `UpdatePeriod` указанное затем, вызывает <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> событие, пока код не прекратит анимацию, вызвав <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A>. <xref:System.ComponentModel.BackgroundWorker.DoWork></span><span class="sxs-lookup"><span data-stu-id="3f483-269">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler sleeps for the number of milliseconds specified by `UpdatePeriod` then raises the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event, until your code stops the animation by calling <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A>.</span></span>

    <span data-ttu-id="3f483-270">Обработчик <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> событий переключает текст между светлым и темным состоянием, чтобы придать ему внешний вид.</span><span class="sxs-lookup"><span data-stu-id="3f483-270">The <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler toggles the text between its light and dark state to give the appearance of flashing.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#180](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#180)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#180](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#180)]

13. <span data-ttu-id="3f483-271">Переопределите <xref:System.Windows.Forms.Control.OnPaint%2A> метод, чтобы включить анимацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-271">Override the <xref:System.Windows.Forms.Control.OnPaint%2A> method to enable the animation.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#170](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueetext.cs#170)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#170](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueetext.vb#170)]

14. <span data-ttu-id="3f483-272">Нажмите клавишу F6 для построения решения.</span><span class="sxs-lookup"><span data-stu-id="3f483-272">Press F6 to build the solution.</span></span>

## <a name="create-the-marqueeborder-child-control"></a><span data-ttu-id="3f483-273">Создание дочернего элемента управления Маркуибордер</span><span class="sxs-lookup"><span data-stu-id="3f483-273">Create the MarqueeBorder Child Control</span></span>

<span data-ttu-id="3f483-274">Элемент управления является немного более сложным, `MarqueeText` чем элемент управления. `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-274">The `MarqueeBorder` control is slightly more sophisticated than the `MarqueeText` control.</span></span> <span data-ttu-id="3f483-275">Он имеет больше свойств, и анимация в <xref:System.Windows.Forms.Control.OnPaint%2A> методе является более сложной.</span><span class="sxs-lookup"><span data-stu-id="3f483-275">It has more properties and the animation in the <xref:System.Windows.Forms.Control.OnPaint%2A> method is more involved.</span></span> <span data-ttu-id="3f483-276">В принципе, он очень похож на `MarqueeText` элемент управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-276">In principle, it is quite similar to the `MarqueeText` control.</span></span>

<span data-ttu-id="3f483-277">Поскольку элемент управления может иметь дочерние элементы управления, он должен <xref:System.Windows.Forms.Control.Layout> знать о событиях. `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-277">Because the `MarqueeBorder` control can have child controls, it needs to be aware of <xref:System.Windows.Forms.Control.Layout> events.</span></span>

### <a name="to-create-the-marqueeborder-control"></a><span data-ttu-id="3f483-278">Создание элемента управления Маркуибордер</span><span class="sxs-lookup"><span data-stu-id="3f483-278">To create the MarqueeBorder control</span></span>

1. <span data-ttu-id="3f483-279">Добавьте в `MarqueeControlLibrary` проект новый элемент **пользовательского элемента управления** .</span><span class="sxs-lookup"><span data-stu-id="3f483-279">Add a new **Custom Control** item to the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-280">Присвойте новому исходному файлу базовое имя "Маркуибордер".</span><span class="sxs-lookup"><span data-stu-id="3f483-280">Give the new source file a base name of "MarqueeBorder."</span></span>

2. <span data-ttu-id="3f483-281">Перетащите компонент из **панели элементов** на элементуправления.`MarqueeBorder` <xref:System.ComponentModel.BackgroundWorker></span><span class="sxs-lookup"><span data-stu-id="3f483-281">Drag a <xref:System.ComponentModel.BackgroundWorker> component from the **Toolbox** onto your `MarqueeBorder` control.</span></span> <span data-ttu-id="3f483-282">Этот компонент позволит `MarqueeBorder` элементу управления обновляться в асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="3f483-282">This component will allow the `MarqueeBorder` control to update itself asynchronously.</span></span>

3. <span data-ttu-id="3f483-283">В окно свойств установите <xref:System.ComponentModel.BackgroundWorker> для <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> `WorkerReportsProgress`компонентаисвойства значение`true`.</span><span class="sxs-lookup"><span data-stu-id="3f483-283">In the Properties window, set the <xref:System.ComponentModel.BackgroundWorker> component's `WorkerReportsProgress` and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span> <span data-ttu-id="3f483-284">Эти параметры позволяют <xref:System.ComponentModel.BackgroundWorker> компоненту периодически <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> вызывать событие и отменять асинхронные обновления.</span><span class="sxs-lookup"><span data-stu-id="3f483-284">These settings allow the <xref:System.ComponentModel.BackgroundWorker> component to periodically raise the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event and to cancel asynchronous updates.</span></span> <span data-ttu-id="3f483-285">Дополнительные сведения см. в разделе [компонент BackgroundWorker](backgroundworker-component.md).</span><span class="sxs-lookup"><span data-stu-id="3f483-285">For more information, see [BackgroundWorker Component](backgroundworker-component.md).</span></span>

4. <span data-ttu-id="3f483-286">В окно свойств нажмите кнопку события.</span><span class="sxs-lookup"><span data-stu-id="3f483-286">In the Properties window, click the Events button.</span></span> <span data-ttu-id="3f483-287">Присоединение обработчиков <xref:System.ComponentModel.BackgroundWorker.DoWork> для <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> событий и.</span><span class="sxs-lookup"><span data-stu-id="3f483-287">Attach handlers for the <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> events.</span></span>

5. <span data-ttu-id="3f483-288">Откройте исходный файл в **редакторе кода.** `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-288">Open the `MarqueeBorder` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-289">В верхней части файла импортируйте следующие пространства имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-289">At the top of the file, import the following namespaces:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#20](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#20)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#20](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#20)]

6. <span data-ttu-id="3f483-290">Измените объявление `MarqueeBorder` для наследования от <xref:System.Windows.Forms.Panel> и для реализации `IMarqueeWidget` интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3f483-290">Change the declaration of `MarqueeBorder` to inherit from <xref:System.Windows.Forms.Panel> and to implement the `IMarqueeWidget` interface.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#30](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#30)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#30](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#30)]

7. <span data-ttu-id="3f483-291">Объявите два перечисления для `MarqueeBorder` управления состоянием элемента управления: `MarqueeSpinDirection`, которое определяет направление, в котором огни вращается вокруг границы, и `MarqueeLightShape`, определяющий форму огней (квадратный или круглый).</span><span class="sxs-lookup"><span data-stu-id="3f483-291">Declare two enumerations for managing the `MarqueeBorder` control's state: `MarqueeSpinDirection`, which determines the direction in which the lights "spin" around the border, and `MarqueeLightShape`, which determines the shape of the lights (square or circular).</span></span> <span data-ttu-id="3f483-292">Поместите эти объявления перед `MarqueeBorder` объявлением класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-292">Place these declarations before the `MarqueeBorder` class declaration.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#97](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#97)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#97](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#97)]

8. <span data-ttu-id="3f483-293">Объявите переменные экземпляра, соответствующие предоставляемым свойствам, и инициализируйте их в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3f483-293">Declare the instance variables that correspond to the exposed properties, and initialize them in the constructor.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#40](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#40)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#40](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#40)]

9. <span data-ttu-id="3f483-294">Реализовать интерфейс `IMarqueeWidget`.</span><span class="sxs-lookup"><span data-stu-id="3f483-294">Implement the `IMarqueeWidget` interface.</span></span>

    <span data-ttu-id="3f483-295">`StartMarquee` Методыи`StopMarquee` вызывают методыкомпонента<xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> и для запуска и завершения анимации. <xref:System.ComponentModel.BackgroundWorker.RunWorkerAsync%2A> <xref:System.ComponentModel.BackgroundWorker></span><span class="sxs-lookup"><span data-stu-id="3f483-295">The `StartMarquee` and `StopMarquee` methods invoke the <xref:System.ComponentModel.BackgroundWorker> component's <xref:System.ComponentModel.BackgroundWorker.RunWorkerAsync%2A> and <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> methods to start and stop the animation.</span></span>

    <span data-ttu-id="3f483-296">Поскольку элемент управления может содержать дочерние элементы `StartMarquee` управления, метод перечисляет все дочерние `StartMarquee` элементы управления и вызывает методы, реализующие `IMarqueeWidget`. `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-296">Because the `MarqueeBorder` control can contain child controls, the `StartMarquee` method enumerates all child controls and calls `StartMarquee` on those that implement `IMarqueeWidget`.</span></span> <span data-ttu-id="3f483-297">`StopMarquee` Метод имеет аналогичную реализацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-297">The `StopMarquee` method has a similar implementation.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#50](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#50)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#50](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#50)]

10. <span data-ttu-id="3f483-298">Реализуйте методы доступа к свойствам.</span><span class="sxs-lookup"><span data-stu-id="3f483-298">Implement the property accessors.</span></span> <span data-ttu-id="3f483-299">`MarqueeBorder` Элемент управления имеет несколько свойств для управления его внешним видом.</span><span class="sxs-lookup"><span data-stu-id="3f483-299">The `MarqueeBorder` control has several properties for controlling its appearance.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#60](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#60)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#60](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#60)]

11. <span data-ttu-id="3f483-300">Реализуйте обработчики для <xref:System.ComponentModel.BackgroundWorker> событий <xref:System.ComponentModel.BackgroundWorker.DoWork> компонента и <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> .</span><span class="sxs-lookup"><span data-stu-id="3f483-300">Implement the handlers for the <xref:System.ComponentModel.BackgroundWorker> component's <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> events.</span></span>

    <span data-ttu-id="3f483-301">Обработчик событий закладывается на число миллисекунд, `UpdatePeriod` указанное затем, вызывает <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> событие, пока код не прекратит анимацию, вызвав <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A>. <xref:System.ComponentModel.BackgroundWorker.DoWork></span><span class="sxs-lookup"><span data-stu-id="3f483-301">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler sleeps for the number of milliseconds specified by `UpdatePeriod` then raises the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event, until your code stops the animation by calling <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A>.</span></span>

    <span data-ttu-id="3f483-302">Обработчик событий увеличивает расположение «базового» освещения, из которого определяется светлое или темное состояние других источников света, и <xref:System.Windows.Forms.Control.Refresh%2A> вызывает метод, чтобы элемент управления переводился в перерисовку. <xref:System.ComponentModel.BackgroundWorker.ProgressChanged></span><span class="sxs-lookup"><span data-stu-id="3f483-302">The <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler increments the position of the "base" light, from which the light/dark state of the other lights is determined, and calls the <xref:System.Windows.Forms.Control.Refresh%2A> method to cause the control to repaint itself.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#90](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#90)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#90](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#90)]

12. <span data-ttu-id="3f483-303">Реализуйте вспомогательные методы `IsLit` и `DrawLight`.</span><span class="sxs-lookup"><span data-stu-id="3f483-303">Implement the helper methods, `IsLit` and `DrawLight`.</span></span>

    <span data-ttu-id="3f483-304">`IsLit` Метод определяет цвет освещения в заданной позиции.</span><span class="sxs-lookup"><span data-stu-id="3f483-304">The `IsLit` method determines the color of a light at a given position.</span></span> <span data-ttu-id="3f483-305">Лампочки, которые являются «освещенными», рисуются цветом, `LightColor` заданным свойством, а те, которые являются «темными», рисуются `DarkColor` цветом, заданным свойством.</span><span class="sxs-lookup"><span data-stu-id="3f483-305">Lights that are "lit" are drawn in the color given by the `LightColor` property, and those that are "dark" are drawn in the color given by the `DarkColor` property.</span></span>

    <span data-ttu-id="3f483-306">`DrawLight` Метод рисует источник освещения с помощью соответствующего цвета, формы и расположения.</span><span class="sxs-lookup"><span data-stu-id="3f483-306">The `DrawLight` method draws a light using the appropriate color, shape, and position.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#80](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#80)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#80](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#80)]

13. <span data-ttu-id="3f483-307">Переопределите методы <xref:System.Windows.Forms.Control.OnPaint%2A>и. <xref:System.Windows.Forms.Control.OnLayout%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-307">Override the <xref:System.Windows.Forms.Control.OnLayout%2A> and <xref:System.Windows.Forms.Control.OnPaint%2A> methods.</span></span>

    <span data-ttu-id="3f483-308">Метод рисует индикаторы вдоль краев `MarqueeBorder` элемента управления. <xref:System.Windows.Forms.Control.OnPaint%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-308">The <xref:System.Windows.Forms.Control.OnPaint%2A> method draws the lights along the edges of the `MarqueeBorder` control.</span></span>

    <span data-ttu-id="3f483-309">Поскольку метод зависит от измерений `MarqueeBorder` элемента управления, его необходимо вызывать при каждом изменении макета. <xref:System.Windows.Forms.Control.OnPaint%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-309">Because the <xref:System.Windows.Forms.Control.OnPaint%2A> method depends on the dimensions of the `MarqueeBorder` control, you need to call it whenever the layout changes.</span></span> <span data-ttu-id="3f483-310">Чтобы добиться этого, переопределите <xref:System.Windows.Forms.Control.OnLayout%2A> и вызовите метод. <xref:System.Windows.Forms.Control.Refresh%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-310">To achieve this, override <xref:System.Windows.Forms.Control.OnLayout%2A> and call <xref:System.Windows.Forms.Control.Refresh%2A>.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#70](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#70)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#70](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#70)]

## <a name="creating-a-custom-designer-to-shadow-and-filter-properties"></a><span data-ttu-id="3f483-311">Создание пользовательского конструктора для теневого копирования и свойств фильтра</span><span class="sxs-lookup"><span data-stu-id="3f483-311">Creating a Custom Designer to Shadow and Filter Properties</span></span>

<span data-ttu-id="3f483-312">`MarqueeControlRootDesigner` Класс предоставляет реализацию для корневого конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-312">The `MarqueeControlRootDesigner` class provides the implementation for the root designer.</span></span> <span data-ttu-id="3f483-313">Помимо этого конструктора, который работает `MarqueeControl`с, необходим пользовательский конструктор, специально связанный `MarqueeBorder` с элементом управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-313">In addition to this designer, which operates on the `MarqueeControl`, you will need a custom designer that is specifically associated with the `MarqueeBorder` control.</span></span> <span data-ttu-id="3f483-314">Этот конструктор предоставляет настраиваемое поведение, которое подходит для контекста пользовательского корневого конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-314">This designer provides custom behavior that is appropriate in the context of the custom root designer.</span></span>

<span data-ttu-id="3f483-315">В `MarqueeBorderDesigner` частности, выполнит "тень" и отфильтрует определенные `MarqueeBorder` свойства элемента управления, изменив их взаимодействие с средой разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-315">Specifically, the `MarqueeBorderDesigner` will "shadow" and filter certain properties on the `MarqueeBorder` control, changing their interaction with the design environment.</span></span>

<span data-ttu-id="3f483-316">Перехват вызовов метода доступа к свойству компонента называется "тенью".</span><span class="sxs-lookup"><span data-stu-id="3f483-316">Intercepting calls to a component's property accessor is known as "shadowing."</span></span> <span data-ttu-id="3f483-317">Он позволяет конструктору отслеживанить значение, заданное пользователем, и при необходимости передать это значение в разрабатываемый компонент.</span><span class="sxs-lookup"><span data-stu-id="3f483-317">It allows a designer to track the value set by the user and optionally pass that value to the component being designed.</span></span>

<span data-ttu-id="3f483-318">В этом примере <xref:System.Windows.Forms.Control.Visible%2A> свойства и <xref:System.Windows.Forms.Control.Enabled%2A> будут скрыты с `MarqueeBorderDesigner`помощью `MarqueeBorder` , что не позволяет пользователю сделать элемент управления невидимым или отключенным во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-318">For this example, the <xref:System.Windows.Forms.Control.Visible%2A> and <xref:System.Windows.Forms.Control.Enabled%2A> properties will be shadowed by the `MarqueeBorderDesigner`, which prevents the user from making the `MarqueeBorder` control invisible or disabled during design time.</span></span>

<span data-ttu-id="3f483-319">Конструкторы также могут добавлять и удалять свойства.</span><span class="sxs-lookup"><span data-stu-id="3f483-319">Designers can also add and remove properties.</span></span> <span data-ttu-id="3f483-320">В этом примере <xref:System.Windows.Forms.Control.Padding%2A> свойство будет удалено во время разработки, `MarqueeBorder` так как элемент управления программно устанавливает заполнение на основе размера источников света, заданных `LightSize` свойством.</span><span class="sxs-lookup"><span data-stu-id="3f483-320">For this example, the <xref:System.Windows.Forms.Control.Padding%2A> property will be removed at design time, because the `MarqueeBorder` control programmatically sets the padding based on the size of the lights specified by the `LightSize` property.</span></span>

<span data-ttu-id="3f483-321">Базовый класс для `MarqueeBorderDesigner` — <xref:System.ComponentModel.Design.ComponentDesigner>, который содержит методы, которые могут изменять атрибуты, свойства и события, предоставляемые элементом управления во время разработки:</span><span class="sxs-lookup"><span data-stu-id="3f483-321">The base class for `MarqueeBorderDesigner` is <xref:System.ComponentModel.Design.ComponentDesigner>, which has methods that can change the attributes, properties, and events exposed by a control at design time:</span></span>

- <xref:System.ComponentModel.Design.ComponentDesigner.PreFilterProperties%2A>

- <xref:System.ComponentModel.Design.ComponentDesigner.PostFilterProperties%2A>

- <xref:System.ComponentModel.Design.ComponentDesigner.PreFilterAttributes%2A>

- <xref:System.ComponentModel.Design.ComponentDesigner.PostFilterAttributes%2A>

- <xref:System.ComponentModel.Design.ComponentDesigner.PreFilterEvents%2A>

- <xref:System.ComponentModel.Design.ComponentDesigner.PostFilterEvents%2A>

<span data-ttu-id="3f483-322">При изменении открытого интерфейса компонента с помощью этих методов необходимо соблюдать следующие правила.</span><span class="sxs-lookup"><span data-stu-id="3f483-322">When changing the public interface of a component using these methods, you must follow these rules:</span></span>

- <span data-ttu-id="3f483-323">Добавлять или удалять элементы только в `PreFilter` методах</span><span class="sxs-lookup"><span data-stu-id="3f483-323">Add or remove items in the `PreFilter` methods only</span></span>

- <span data-ttu-id="3f483-324">Изменение существующих элементов только в `PostFilter` методах</span><span class="sxs-lookup"><span data-stu-id="3f483-324">Modify existing items in the `PostFilter` methods only</span></span>

- <span data-ttu-id="3f483-325">Всегда вызывайте базовую реализацию сначала в `PreFilter` методах</span><span class="sxs-lookup"><span data-stu-id="3f483-325">Always call the base implementation first in the `PreFilter` methods</span></span>

- <span data-ttu-id="3f483-326">Всегда вызывайте базовую реализацию последней в `PostFilter` методах</span><span class="sxs-lookup"><span data-stu-id="3f483-326">Always call the base implementation last in the `PostFilter` methods</span></span>

<span data-ttu-id="3f483-327">Соблюдение этих правил гарантирует, что все конструкторы в среде времени разработки будут иметь единообразное представление всех разрабатываемых компонентов.</span><span class="sxs-lookup"><span data-stu-id="3f483-327">Adhering to these rules ensures that all designers in the design-time environment have a consistent view of all components being designed.</span></span>

<span data-ttu-id="3f483-328"><xref:System.ComponentModel.Design.ComponentDesigner> Класс предоставляет словарь для управления значениями затененных свойств, что освобождает вас от необходимости создавать конкретные переменные экземпляра.</span><span class="sxs-lookup"><span data-stu-id="3f483-328">The <xref:System.ComponentModel.Design.ComponentDesigner> class provides a dictionary for managing the values of shadowed properties, which relieves you of the need to create specific instance variables.</span></span>

### <a name="to-create-a-custom-designer-to-shadow-and-filter-properties"></a><span data-ttu-id="3f483-329">Создание пользовательского конструктора для теневого копирования и свойств фильтра</span><span class="sxs-lookup"><span data-stu-id="3f483-329">To create a custom designer to shadow and filter properties</span></span>

1. <span data-ttu-id="3f483-330">Щелкните правой кнопкой мыши папку **конструктора** и добавьте новый класс.</span><span class="sxs-lookup"><span data-stu-id="3f483-330">Right-click the **Design** folder and add a new class.</span></span> <span data-ttu-id="3f483-331">Присвойте исходному файлу базовое имя "Маркуибордердесигнер".</span><span class="sxs-lookup"><span data-stu-id="3f483-331">Give the source file a base name of "MarqueeBorderDesigner."</span></span>

2. <span data-ttu-id="3f483-332">Откройте исходный файл в **редакторе кода.** `MarqueeBorderDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-332">Open the `MarqueeBorderDesigner` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-333">В верхней части файла импортируйте следующие пространства имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-333">At the top of the file, import the following namespaces:</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#420](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborderdesigner.cs#420)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#420](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborderdesigner.vb#420)]

3. <span data-ttu-id="3f483-334">Измените объявление `MarqueeBorderDesigner` , чтобы наследовать от <xref:System.Windows.Forms.Design.ParentControlDesigner>.</span><span class="sxs-lookup"><span data-stu-id="3f483-334">Change the declaration of `MarqueeBorderDesigner` to inherit from <xref:System.Windows.Forms.Design.ParentControlDesigner>.</span></span>

    <span data-ttu-id="3f483-335">Поскольку элемент управления может содержать дочерние `MarqueeBorderDesigner` элементы управления, <xref:System.Windows.Forms.Design.ParentControlDesigner>наследует от, который обрабатывает взаимодействие типа «родители-потомки». `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-335">Because the `MarqueeBorder` control can contain child controls, `MarqueeBorderDesigner` inherits from <xref:System.Windows.Forms.Design.ParentControlDesigner>, which handles the parent-child interaction.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#430](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborderdesigner.cs#430)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#430](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborderdesigner.vb#430)]

4. <span data-ttu-id="3f483-336">Переопределите базовую реализацию <xref:System.ComponentModel.Design.ComponentDesigner.PreFilterProperties%2A>.</span><span class="sxs-lookup"><span data-stu-id="3f483-336">Override the base implementation of <xref:System.ComponentModel.Design.ComponentDesigner.PreFilterProperties%2A>.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#450](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborderdesigner.cs#450)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#450](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborderdesigner.vb#450)]

5. <span data-ttu-id="3f483-337">Реализуйте свойства <xref:System.Windows.Forms.Control.Enabled%2A> и <xref:System.Windows.Forms.Control.Visible%2A>.</span><span class="sxs-lookup"><span data-stu-id="3f483-337">Implement the <xref:System.Windows.Forms.Control.Enabled%2A> and <xref:System.Windows.Forms.Control.Visible%2A> properties.</span></span> <span data-ttu-id="3f483-338">Эти реализации затениют свойства элемента управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-338">These implementations shadow the control's properties.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#440](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborderdesigner.cs#440)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#440](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborderdesigner.vb#440)]

## <a name="handling-component-changes"></a><span data-ttu-id="3f483-339">Обработка изменений компонентов</span><span class="sxs-lookup"><span data-stu-id="3f483-339">Handling Component Changes</span></span>
 <span data-ttu-id="3f483-340">Класс предоставляет пользовательские возможности времени разработки `MarqueeControl` для экземпляров. `MarqueeControlRootDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-340">The `MarqueeControlRootDesigner` class provides the custom design-time experience for your `MarqueeControl` instances.</span></span> <span data-ttu-id="3f483-341">Большая часть функций времени разработки наследуется от <xref:System.Windows.Forms.Design.DocumentDesigner> класса; в коде будут реализованы две определенные настройки: обработка изменений компонентов и Добавление команд конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-341">Most of the design-time functionality is inherited from the <xref:System.Windows.Forms.Design.DocumentDesigner> class; your code will implement two specific customizations: handling component changes, and adding designer verbs.</span></span>

 <span data-ttu-id="3f483-342">По мере разработки пользователями `MarqueeControl` своих экземпляров корневой конструктор будет отслеживанию изменений `MarqueeControl` в и его дочерних элементах управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-342">As users design their `MarqueeControl` instances, your root designer will track changes to the `MarqueeControl` and its child controls.</span></span> <span data-ttu-id="3f483-343">Среда разработки предоставляет удобную службу <xref:System.ComponentModel.Design.IComponentChangeService>для отслеживания изменений состояния компонента.</span><span class="sxs-lookup"><span data-stu-id="3f483-343">The design-time environment offers a convenient service, <xref:System.ComponentModel.Design.IComponentChangeService>, for tracking changes to component state.</span></span>

 <span data-ttu-id="3f483-344">Чтобы получить ссылку на эту службу, запросите среду с помощью <xref:System.ComponentModel.Design.ComponentDesigner.GetService%2A> метода.</span><span class="sxs-lookup"><span data-stu-id="3f483-344">You acquire a reference to this service by querying the environment with the <xref:System.ComponentModel.Design.ComponentDesigner.GetService%2A> method.</span></span> <span data-ttu-id="3f483-345">Если запрос выполнен успешно, конструктор может присоединить обработчик для <xref:System.ComponentModel.Design.IComponentChangeService.ComponentChanged> события и выполнить все задачи, необходимые для поддержания стабильного состояния во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-345">If the query is successful, your designer can attach a handler for the <xref:System.ComponentModel.Design.IComponentChangeService.ComponentChanged> event and perform whatever tasks are required to maintain a consistent state at design time.</span></span>

 <span data-ttu-id="3f483-346">В случае `MarqueeControlRootDesigner` класса <xref:System.Windows.Forms.Control.Refresh%2A> метод будет вызываться для каждого `IMarqueeWidget` объекта, содержащегося в `MarqueeControl`.</span><span class="sxs-lookup"><span data-stu-id="3f483-346">In the case of the `MarqueeControlRootDesigner` class, you will call the <xref:System.Windows.Forms.Control.Refresh%2A> method on each `IMarqueeWidget` object contained by the `MarqueeControl`.</span></span> <span data-ttu-id="3f483-347">Это приведет к тому `IMarqueeWidget` , что объект будет правильно перерисовываться при изменении свойств <xref:System.Windows.Forms.Control.Size%2A> , таких как его родительский элемент.</span><span class="sxs-lookup"><span data-stu-id="3f483-347">This will cause the `IMarqueeWidget` object to repaint itself appropriately when properties like its parent's <xref:System.Windows.Forms.Control.Size%2A> are changed.</span></span>

### <a name="to-handle-component-changes"></a><span data-ttu-id="3f483-348">Для управления изменениями компонентов</span><span class="sxs-lookup"><span data-stu-id="3f483-348">To handle component changes</span></span>

1. <span data-ttu-id="3f483-349">Откройте исходный файл в **редакторе кода** и переопределите <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> метод. `MarqueeControlRootDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-349">Open the `MarqueeControlRootDesigner` source file in the **Code Editor** and override the <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> method.</span></span> <span data-ttu-id="3f483-350">Вызовите базовую реализацию <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> запроса и <xref:System.ComponentModel.Design.IComponentChangeService>для.</span><span class="sxs-lookup"><span data-stu-id="3f483-350">Call the base implementation of <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> and query for the <xref:System.ComponentModel.Design.IComponentChangeService>.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#580](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#580)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#580](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#580)]

2. <span data-ttu-id="3f483-351">Реализуйте <xref:System.ComponentModel.Design.IComponentChangeService.OnComponentChanged%2A> обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="3f483-351">Implement the <xref:System.ComponentModel.Design.IComponentChangeService.OnComponentChanged%2A> event handler.</span></span> <span data-ttu-id="3f483-352">Проверьте тип компонента отправки и, если он является `IMarqueeWidget`, вызовите его <xref:System.Windows.Forms.Control.Refresh%2A> метод.</span><span class="sxs-lookup"><span data-stu-id="3f483-352">Test the sending component's type, and if it is an `IMarqueeWidget`, call its <xref:System.Windows.Forms.Control.Refresh%2A> method.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#560](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#560)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#560](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#560)]

## <a name="adding-designer-verbs-to-your-custom-designer"></a><span data-ttu-id="3f483-353">Добавление команд конструктора в пользовательский конструктор</span><span class="sxs-lookup"><span data-stu-id="3f483-353">Adding Designer Verbs to your Custom Designer</span></span>

<span data-ttu-id="3f483-354">Команда конструктора — это команда меню, связанная с обработчиком событий.</span><span class="sxs-lookup"><span data-stu-id="3f483-354">A designer verb is a menu command linked to an event handler.</span></span> <span data-ttu-id="3f483-355">Команды конструктора добавляются в контекстное меню компонента во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-355">Designer verbs are added to a component's shortcut menu at design time.</span></span> <span data-ttu-id="3f483-356">Дополнительные сведения см. в разделе <xref:System.ComponentModel.Design.DesignerVerb>.</span><span class="sxs-lookup"><span data-stu-id="3f483-356">For more information, see <xref:System.ComponentModel.Design.DesignerVerb>.</span></span>

<span data-ttu-id="3f483-357">В конструкторы вы добавите две команды конструктора: **Запустите тест** и **завершите тест**.</span><span class="sxs-lookup"><span data-stu-id="3f483-357">You will add two designer verbs to your designers: **Run Test** and **Stop Test**.</span></span> <span data-ttu-id="3f483-358">Эти глаголы позволяют просматривать поведение во время выполнения в `MarqueeControl` процессе разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-358">These verbs will allow you to view the run-time behavior of the `MarqueeControl` at design time.</span></span> <span data-ttu-id="3f483-359">Эти команды будут добавлены в `MarqueeControlRootDesigner`.</span><span class="sxs-lookup"><span data-stu-id="3f483-359">These verbs will be added to the `MarqueeControlRootDesigner`.</span></span>

<span data-ttu-id="3f483-360">При вызове **запуска теста** обработчик событий команды вызывает `StartMarquee` метод для. `MarqueeControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-360">When **Run Test** is invoked, the verb event handler will call the `StartMarquee` method on the `MarqueeControl`.</span></span> <span data-ttu-id="3f483-361">При вызове `StopMarquee` метода " `MarqueeControl`приостанавливается" обработчик событий команды вызывает метод для.</span><span class="sxs-lookup"><span data-stu-id="3f483-361">When **Stop Test** is invoked, the verb event handler will call the `StopMarquee` method on the `MarqueeControl`.</span></span> <span data-ttu-id="3f483-362">Реализация `StartMarquee` методов и `StopMarquee` вызывает эти методы для вложенных элементов управления, которые реализуют `IMarqueeWidget`, поэтому все `IMarqueeWidget` содержащиеся в нем элементы управления также будут участвовать в тестировании.</span><span class="sxs-lookup"><span data-stu-id="3f483-362">The implementation of the `StartMarquee` and `StopMarquee` methods call these methods on contained controls that implement `IMarqueeWidget`, so any contained `IMarqueeWidget` controls will also participate in the test.</span></span>

### <a name="to-add-designer-verbs-to-your-custom-designers"></a><span data-ttu-id="3f483-363">Добавление команд конструктора в пользовательские конструкторы</span><span class="sxs-lookup"><span data-stu-id="3f483-363">To add designer verbs to your custom designers</span></span>

1. <span data-ttu-id="3f483-364">В классе добавьте обработчики событий с именами `OnVerbRunTest` и `OnVerbStopTest`. `MarqueeControlRootDesigner`</span><span class="sxs-lookup"><span data-stu-id="3f483-364">In the `MarqueeControlRootDesigner` class, add event handlers named `OnVerbRunTest` and `OnVerbStopTest`.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#570](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#570)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#570](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#570)]

2. <span data-ttu-id="3f483-365">Соедините эти обработчики событий с соответствующими командами конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-365">Connect these event handlers to their corresponding designer verbs.</span></span> <span data-ttu-id="3f483-366">`MarqueeControlRootDesigner`наследует <xref:System.ComponentModel.Design.DesignerVerbCollection> от своего базового класса.</span><span class="sxs-lookup"><span data-stu-id="3f483-366">`MarqueeControlRootDesigner` inherits a <xref:System.ComponentModel.Design.DesignerVerbCollection> from its base class.</span></span> <span data-ttu-id="3f483-367">Вы создадите два новых <xref:System.ComponentModel.Design.DesignerVerb> объекта и добавите их в эту коллекцию <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> в методе.</span><span class="sxs-lookup"><span data-stu-id="3f483-367">You will create two new <xref:System.ComponentModel.Design.DesignerVerb> objects and add them to this collection in the <xref:System.Windows.Forms.Design.DocumentDesigner.Initialize%2A> method.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#590](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueecontrolrootdesigner.cs#590)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#590](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueecontrolrootdesigner.vb#590)]

## <a name="creating-a-custom-uitypeeditor"></a><span data-ttu-id="3f483-368">Создание пользовательского UITypeEditor</span><span class="sxs-lookup"><span data-stu-id="3f483-368">Creating a Custom UITypeEditor</span></span>

<span data-ttu-id="3f483-369">При создании пользовательской среды разработки для пользователей часто желательно создать пользовательское взаимодействие с окно свойств.</span><span class="sxs-lookup"><span data-stu-id="3f483-369">When you create a custom design-time experience for users, it is often desirable to create a custom interaction with the Properties window.</span></span> <span data-ttu-id="3f483-370">Это можно сделать, создав <xref:System.Drawing.Design.UITypeEditor>.</span><span class="sxs-lookup"><span data-stu-id="3f483-370">You can accomplish this by creating a <xref:System.Drawing.Design.UITypeEditor>.</span></span> <span data-ttu-id="3f483-371">Дополнительные сведения см. в разделе [Практическое руководство. Создайте редактор](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/fd3kt7d5(v=vs.120))типов пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3f483-371">For more information, see [How to: Create a UI Type Editor](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/fd3kt7d5(v=vs.120)).</span></span>

<span data-ttu-id="3f483-372">`MarqueeBorder` Элемент управления предоставляет несколько свойств в окно свойств.</span><span class="sxs-lookup"><span data-stu-id="3f483-372">The `MarqueeBorder` control exposes several properties in the Properties window.</span></span> <span data-ttu-id="3f483-373">Два из этих свойств `MarqueeSpinDirection` и `MarqueeLightShape` представлены перечислениями.</span><span class="sxs-lookup"><span data-stu-id="3f483-373">Two of these properties, `MarqueeSpinDirection` and `MarqueeLightShape` are represented by enumerations.</span></span> <span data-ttu-id="3f483-374">Чтобы продемонстрировать использование редактора типов пользовательского интерфейса, `MarqueeLightShape` свойство будет иметь связанный <xref:System.Drawing.Design.UITypeEditor> класс.</span><span class="sxs-lookup"><span data-stu-id="3f483-374">To illustrate the use of a UI type editor, the `MarqueeLightShape` property will have an associated <xref:System.Drawing.Design.UITypeEditor> class.</span></span>

### <a name="to-create-a-custom-ui-type-editor"></a><span data-ttu-id="3f483-375">Создание пользовательского редактора типов пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="3f483-375">To create a custom UI type editor</span></span>

1. <span data-ttu-id="3f483-376">Откройте исходный файл в **редакторе кода.** `MarqueeBorder`</span><span class="sxs-lookup"><span data-stu-id="3f483-376">Open the `MarqueeBorder` source file in the **Code Editor**.</span></span>

2. <span data-ttu-id="3f483-377">В определении `MarqueeBorder` класса объявите класс с именем `LightShapeEditor` , производным от <xref:System.Drawing.Design.UITypeEditor>.</span><span class="sxs-lookup"><span data-stu-id="3f483-377">In the definition of the `MarqueeBorder` class, declare a class called `LightShapeEditor` that derives from <xref:System.Drawing.Design.UITypeEditor>.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#96](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#96)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#96](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#96)]

3. <span data-ttu-id="3f483-378">Объявите <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> переменную экземпляра `editorService`с именем.</span><span class="sxs-lookup"><span data-stu-id="3f483-378">Declare an <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> instance variable called `editorService`.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#92](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#92)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#92](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#92)]

4. <span data-ttu-id="3f483-379">Переопределите метод <xref:System.Drawing.Design.UITypeEditor.GetEditStyle%2A> .</span><span class="sxs-lookup"><span data-stu-id="3f483-379">Override the <xref:System.Drawing.Design.UITypeEditor.GetEditStyle%2A> method.</span></span> <span data-ttu-id="3f483-380">Эта реализация возвращает <xref:System.Drawing.Design.UITypeEditorEditStyle.DropDown>, что указывает среде разработки, как `LightShapeEditor`отобразить.</span><span class="sxs-lookup"><span data-stu-id="3f483-380">This implementation returns <xref:System.Drawing.Design.UITypeEditorEditStyle.DropDown>, which tells the design environment how to display the `LightShapeEditor`.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#93](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#93)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#93](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#93)]

5. <span data-ttu-id="3f483-381">Переопределите метод <xref:System.Drawing.Design.UITypeEditor.EditValue%2A> .</span><span class="sxs-lookup"><span data-stu-id="3f483-381">Override the <xref:System.Drawing.Design.UITypeEditor.EditValue%2A> method.</span></span> <span data-ttu-id="3f483-382">Эта реализация запрашивает в среде <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> разработки объект.</span><span class="sxs-lookup"><span data-stu-id="3f483-382">This implementation queries the design environment for an <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> object.</span></span> <span data-ttu-id="3f483-383">В `LightShapeSelectionControl`случае успеха создается.</span><span class="sxs-lookup"><span data-stu-id="3f483-383">If successful, it creates a `LightShapeSelectionControl`.</span></span> <span data-ttu-id="3f483-384">Метод вызывается для `LightShapeEditor`запуска. <xref:System.Windows.Forms.Design.IWindowsFormsEditorService.DropDownControl%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-384">The <xref:System.Windows.Forms.Design.IWindowsFormsEditorService.DropDownControl%2A> method is invoked to start the `LightShapeEditor`.</span></span> <span data-ttu-id="3f483-385">Возвращаемое значение этого вызова возвращается в среду разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-385">The return value from this invocation is returned to the design environment.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#94](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/marqueeborder.cs#94)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#94](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/marqueeborder.vb#94)]

## <a name="creating-a-view-control-for-your-custom-uitypeeditor"></a><span data-ttu-id="3f483-386">Создание элемента управления View для пользовательского UITypeEditor</span><span class="sxs-lookup"><span data-stu-id="3f483-386">Creating a View Control for your Custom UITypeEditor</span></span>

1. <span data-ttu-id="3f483-387">Свойство поддерживает два типа простых фигур: `Square` и `Circle`. `MarqueeLightShape`</span><span class="sxs-lookup"><span data-stu-id="3f483-387">The `MarqueeLightShape` property supports two types of light shapes: `Square` and `Circle`.</span></span> <span data-ttu-id="3f483-388">Вы создадите пользовательский элемент управления, используемый исключительно в целях графического отображения этих значений в окно свойств.</span><span class="sxs-lookup"><span data-stu-id="3f483-388">You will create a custom control used solely for the purpose of graphically displaying these values in the Properties window.</span></span> <span data-ttu-id="3f483-389">Этот пользовательский элемент управления будет использоваться <xref:System.Drawing.Design.UITypeEditor> для взаимодействия с окно свойств.</span><span class="sxs-lookup"><span data-stu-id="3f483-389">This custom control will be used by your <xref:System.Drawing.Design.UITypeEditor> to interact with the Properties window.</span></span>

### <a name="to-create-a-view-control-for-your-custom-ui-type-editor"></a><span data-ttu-id="3f483-390">Создание элемента управления представления для пользовательского редактора типов пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="3f483-390">To create a view control for your custom UI type editor</span></span>

1. <span data-ttu-id="3f483-391">Добавьте новый <xref:System.Windows.Forms.UserControl> элемент `MarqueeControlLibrary` в проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-391">Add a new <xref:System.Windows.Forms.UserControl> item to the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-392">Присвойте новому исходному файлу базовое имя "Лигхтшапеселектионконтрол".</span><span class="sxs-lookup"><span data-stu-id="3f483-392">Give the new source file a base name of "LightShapeSelectionControl."</span></span>

2. <span data-ttu-id="3f483-393">Перетащите два <xref:System.Windows.Forms.Panel> элемента управления из **панели элементов** в `LightShapeSelectionControl`область.</span><span class="sxs-lookup"><span data-stu-id="3f483-393">Drag two <xref:System.Windows.Forms.Panel> controls from the **Toolbox** onto the `LightShapeSelectionControl`.</span></span> <span data-ttu-id="3f483-394">Назовите `squarePanel` их `circlePanel`и.</span><span class="sxs-lookup"><span data-stu-id="3f483-394">Name them `squarePanel` and `circlePanel`.</span></span> <span data-ttu-id="3f483-395">Расположите их параллельно.</span><span class="sxs-lookup"><span data-stu-id="3f483-395">Arrange them side by side.</span></span> <span data-ttu-id="3f483-396">Задайте для <xref:System.Windows.Forms.Panel> свойства обоих элементов управления значение (60, 60). <xref:System.Windows.Forms.Control.Size%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-396">Set the <xref:System.Windows.Forms.Control.Size%2A> property of both <xref:System.Windows.Forms.Panel> controls to (60, 60).</span></span> <span data-ttu-id="3f483-397">Присвойте `squarePanel` свойству элемента управления значение (8, 10). <xref:System.Windows.Forms.Control.Location%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-397">Set the <xref:System.Windows.Forms.Control.Location%2A> property of the `squarePanel` control to (8, 10).</span></span> <span data-ttu-id="3f483-398">Присвойте `circlePanel` свойству элемента управления значение (80, 10). <xref:System.Windows.Forms.Control.Location%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-398">Set the <xref:System.Windows.Forms.Control.Location%2A> property of the `circlePanel` control to (80, 10).</span></span> <span data-ttu-id="3f483-399">Наконец, задайте <xref:System.Windows.Forms.Control.Size%2A> для свойства значение `LightShapeSelectionControl` (150, 80).</span><span class="sxs-lookup"><span data-stu-id="3f483-399">Finally, set the <xref:System.Windows.Forms.Control.Size%2A> property of the `LightShapeSelectionControl` to (150, 80).</span></span>

3. <span data-ttu-id="3f483-400">Откройте исходный файл в **редакторе кода.** `LightShapeSelectionControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-400">Open the `LightShapeSelectionControl` source file in the **Code Editor**.</span></span> <span data-ttu-id="3f483-401">В верхней части файла импортируйте <xref:System.Windows.Forms.Design?displayProperty=nameWithType> пространство имен:</span><span class="sxs-lookup"><span data-stu-id="3f483-401">At the top of the file, import the <xref:System.Windows.Forms.Design?displayProperty=nameWithType> namespace:</span></span>

```vb
Imports System.Windows.Forms.Design
```

```csharp
using System.Windows.Forms.Design;
```

1. <span data-ttu-id="3f483-402">Реализуйте <xref:System.Windows.Forms.Control.Click> обработчики событий `squarePanel` для `circlePanel` элементов управления и.</span><span class="sxs-lookup"><span data-stu-id="3f483-402">Implement <xref:System.Windows.Forms.Control.Click> event handlers for the `squarePanel` and `circlePanel` controls.</span></span> <span data-ttu-id="3f483-403">Эти методы вызывают <xref:System.Windows.Forms.Design.IWindowsFormsEditorService.CloseDropDown%2A> для завершения пользовательского <xref:System.Drawing.Design.UITypeEditor> сеанса редактирования.</span><span class="sxs-lookup"><span data-stu-id="3f483-403">These methods invoke <xref:System.Windows.Forms.Design.IWindowsFormsEditorService.CloseDropDown%2A> to end the custom <xref:System.Drawing.Design.UITypeEditor> editing session.</span></span>

    [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#390](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#390)]
    [!code-vb[System.Windows.Forms.Design.DocumentDesigner#390](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#390)]

2. <span data-ttu-id="3f483-404">Объявите <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> переменную экземпляра `editorService`с именем.</span><span class="sxs-lookup"><span data-stu-id="3f483-404">Declare an <xref:System.Windows.Forms.Design.IWindowsFormsEditorService> instance variable called `editorService`.</span></span>

```vb
Private editorService As IWindowsFormsEditorService
```

```csharp
private IWindowsFormsEditorService editorService;
```

1. <span data-ttu-id="3f483-405">Объявите `MarqueeLightShape` переменную экземпляра `lightShapeValue`с именем.</span><span class="sxs-lookup"><span data-stu-id="3f483-405">Declare a `MarqueeLightShape` instance variable called `lightShapeValue`.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#330](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#330)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#330](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#330)]

2. <span data-ttu-id="3f483-406">`circlePanel` <xref:System.Windows.Forms.Control.Click> `squarePanel` В конструкторе присоедините обработчики событий<xref:System.Windows.Forms.Control.Click> к событиям элементов управления и. `LightShapeSelectionControl`</span><span class="sxs-lookup"><span data-stu-id="3f483-406">In the `LightShapeSelectionControl` constructor, attach the <xref:System.Windows.Forms.Control.Click> event handlers to the `squarePanel` and `circlePanel` controls' <xref:System.Windows.Forms.Control.Click> events.</span></span> <span data-ttu-id="3f483-407">Кроме того, определите перегрузку конструктора, которая `MarqueeLightShape` назначает значение `lightShapeValue` полю в среде разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-407">Also, define a constructor overload that assigns the `MarqueeLightShape` value from the design environment to the `lightShapeValue` field.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#340](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#340)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#340](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#340)]

3. <span data-ttu-id="3f483-408">В методе отсоедините обработчики <xref:System.Windows.Forms.Control.Click>событий. <xref:System.ComponentModel.Component.Dispose%2A></span><span class="sxs-lookup"><span data-stu-id="3f483-408">In the <xref:System.ComponentModel.Component.Dispose%2A> method, detach the <xref:System.Windows.Forms.Control.Click> event handlers.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#350](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#350)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#350](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#350)]

4. <span data-ttu-id="3f483-409">В **обозревателе решений** нажмите кнопку **Показать все файлы**.</span><span class="sxs-lookup"><span data-stu-id="3f483-409">In **Solution Explorer**, click the **Show All Files** button.</span></span> <span data-ttu-id="3f483-410">Откройте файл LightShapeSelectionControl.Designer.cs или лигхтшапеселектионконтрол. Designer. vb и удалите определение <xref:System.ComponentModel.Component.Dispose%2A> метода по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3f483-410">Open the LightShapeSelectionControl.Designer.cs or LightShapeSelectionControl.Designer.vb file, and remove the default definition of the <xref:System.ComponentModel.Component.Dispose%2A> method.</span></span>

5. <span data-ttu-id="3f483-411">Реализуйте свойство `LightShape`.</span><span class="sxs-lookup"><span data-stu-id="3f483-411">Implement the `LightShape` property.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#360](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#360)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#360](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#360)]

6. <span data-ttu-id="3f483-412">Переопределите метод <xref:System.Windows.Forms.Control.OnPaint%2A> .</span><span class="sxs-lookup"><span data-stu-id="3f483-412">Override the <xref:System.Windows.Forms.Control.OnPaint%2A> method.</span></span> <span data-ttu-id="3f483-413">В этой реализации будет нарисован закрашенный квадрат и круг.</span><span class="sxs-lookup"><span data-stu-id="3f483-413">This implementation will draw a filled square and circle.</span></span> <span data-ttu-id="3f483-414">Он также выделяет выбранное значение, рисуя границу вокруг одной или другой фигуры.</span><span class="sxs-lookup"><span data-stu-id="3f483-414">It will also highlight the selected value by drawing a border around one shape or the other.</span></span>

     [!code-csharp[System.Windows.Forms.Design.DocumentDesigner#380](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/CS/lightshapeselectioncontrol.cs#380)]
     [!code-vb[System.Windows.Forms.Design.DocumentDesigner#380](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.Design.DocumentDesigner/VB/lightshapeselectioncontrol.vb#380)]

## <a name="testing-your-custom-control-in-the-designer"></a><span data-ttu-id="3f483-415">Тестирование пользовательского элемента управления в конструкторе</span><span class="sxs-lookup"><span data-stu-id="3f483-415">Testing your Custom Control in the Designer</span></span>

<span data-ttu-id="3f483-416">На этом этапе можно построить `MarqueeControlLibrary` проект.</span><span class="sxs-lookup"><span data-stu-id="3f483-416">At this point, you can build the `MarqueeControlLibrary` project.</span></span> <span data-ttu-id="3f483-417">Протестируйте реализацию, создав элемент управления, который наследует от `MarqueeControl` класса и использует его в форме.</span><span class="sxs-lookup"><span data-stu-id="3f483-417">Test your implementation by creating a control that inherits from the `MarqueeControl` class and using it on a form.</span></span>

### <a name="to-create-a-custom-marqueecontrol-implementation"></a><span data-ttu-id="3f483-418">Создание пользовательской реализации Маркуиконтрол</span><span class="sxs-lookup"><span data-stu-id="3f483-418">To create a custom MarqueeControl implementation</span></span>

1. <span data-ttu-id="3f483-419">Откройте `DemoMarqueeControl` в конструкторе Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="3f483-419">Open `DemoMarqueeControl` in the Windows Forms Designer.</span></span> <span data-ttu-id="3f483-420">При этом создается экземпляр `DemoMarqueeControl` типа, который отображается в экземпляре `MarqueeControlRootDesigner` типа.</span><span class="sxs-lookup"><span data-stu-id="3f483-420">This creates an instance of the `DemoMarqueeControl` type and displays it in an instance of the `MarqueeControlRootDesigner` type.</span></span>

2. <span data-ttu-id="3f483-421">На **панели элементов**откройте вкладку **компоненты маркуиконтроллибрари** . Вы увидите элементы управления `MarqueeBorder` и `MarqueeText` , доступные для выбора.</span><span class="sxs-lookup"><span data-stu-id="3f483-421">In the **Toolbox**, open the **MarqueeControlLibrary Components** tab. You will see the `MarqueeBorder` and `MarqueeText` controls available for selection.</span></span>

3. <span data-ttu-id="3f483-422">Перетащите экземпляр `MarqueeBorder` элемента управления `DemoMarqueeControl` на поверхность конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-422">Drag an instance of the `MarqueeBorder` control onto the `DemoMarqueeControl` design surface.</span></span> <span data-ttu-id="3f483-423">Закрепление `MarqueeBorder` этого элемента управления в родительском элементе управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-423">Dock this `MarqueeBorder` control to the parent control.</span></span>

4. <span data-ttu-id="3f483-424">Перетащите экземпляр `MarqueeText` элемента управления `DemoMarqueeControl` на поверхность конструктора.</span><span class="sxs-lookup"><span data-stu-id="3f483-424">Drag an instance of the `MarqueeText` control onto the `DemoMarqueeControl` design surface.</span></span>

5. <span data-ttu-id="3f483-425">Постройте решение.</span><span class="sxs-lookup"><span data-stu-id="3f483-425">Build the solution.</span></span>

6. <span data-ttu-id="3f483-426">Щелкните `DemoMarqueeControl` правой кнопкой мыши и в контекстном меню выберите пункт **запустить тест** , чтобы запустить анимацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-426">Right-click the `DemoMarqueeControl` and from the shortcut menu select the **Run Test** option to start the animation.</span></span> <span data-ttu-id="3f483-427">Нажмите кнопку " **Закрыть тест** ", чтобы прерывать анимацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-427">Click **Stop Test** to stop the animation.</span></span>

7. <span data-ttu-id="3f483-428">Откройте форму **Form1** в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3f483-428">Open **Form1** in Design view.</span></span>

8. <span data-ttu-id="3f483-429">Поместите два <xref:System.Windows.Forms.Button> элемента управления в форму.</span><span class="sxs-lookup"><span data-stu-id="3f483-429">Place two <xref:System.Windows.Forms.Button> controls on the form.</span></span> <span data-ttu-id="3f483-430">Присвойте `startButton` им `stopButton`имя и и измените <xref:System.Windows.Forms.Control.Text%2A> значения свойств на **Start** и **останавливаться**соответственно.</span><span class="sxs-lookup"><span data-stu-id="3f483-430">Name them `startButton` and `stopButton`, and change the <xref:System.Windows.Forms.Control.Text%2A> property values to **Start** and **Stop**, respectively.</span></span>

9. <span data-ttu-id="3f483-431">Реализуйте <xref:System.Windows.Forms.Control.Click> обработчики событий <xref:System.Windows.Forms.Button> для обоих элементов управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-431">Implement <xref:System.Windows.Forms.Control.Click> event handlers for both <xref:System.Windows.Forms.Button> controls.</span></span>

10. <span data-ttu-id="3f483-432">На **панели элементов**откройте вкладку **компоненты маркуиконтролтест** . Вы увидите `DemoMarqueeControl` доступные для выбора.</span><span class="sxs-lookup"><span data-stu-id="3f483-432">In the **Toolbox**, open the **MarqueeControlTest Components** tab. You will see the `DemoMarqueeControl` available for selection.</span></span>

11. <span data-ttu-id="3f483-433">Перетащите экземпляр `DemoMarqueeControl` на поверхность конструктора **Form1** .</span><span class="sxs-lookup"><span data-stu-id="3f483-433">Drag an instance of `DemoMarqueeControl` onto the **Form1** design surface.</span></span>

12. <span data-ttu-id="3f483-434">В обработчиках `Start` `Stop` `DemoMarqueeControl`событий вызовите методы и для. <xref:System.Windows.Forms.Control.Click></span><span class="sxs-lookup"><span data-stu-id="3f483-434">In the <xref:System.Windows.Forms.Control.Click> event handlers, invoke the `Start` and `Stop` methods on the `DemoMarqueeControl`.</span></span>

```vb
Private Sub startButton_Click(sender As Object, e As System.EventArgs)
    Me.demoMarqueeControl1.Start()
End Sub 'startButton_Click

Private Sub stopButton_Click(sender As Object, e As System.EventArgs)
Me.demoMarqueeControl1.Stop()
End Sub 'stopButton_Click
```

```csharp
private void startButton_Click(object sender, System.EventArgs e)
{
    this.demoMarqueeControl1.Start();
}

private void stopButton_Click(object sender, System.EventArgs e)
{
    this.demoMarqueeControl1.Stop();
}
```

1. <span data-ttu-id="3f483-435">`MarqueeControlTest` Задайте проект в качестве запускаемого проекта и запустите его.</span><span class="sxs-lookup"><span data-stu-id="3f483-435">Set the `MarqueeControlTest` project as the startup project and run it.</span></span> <span data-ttu-id="3f483-436">Вы увидите форму, в которой отображается `DemoMarqueeControl`.</span><span class="sxs-lookup"><span data-stu-id="3f483-436">You will see the form displaying your `DemoMarqueeControl`.</span></span> <span data-ttu-id="3f483-437">Нажмите кнопку " **Пуск** ", чтобы запустить анимацию.</span><span class="sxs-lookup"><span data-stu-id="3f483-437">Click the **Start** button to start the animation.</span></span> <span data-ttu-id="3f483-438">Вы увидите, что текст мигает и индикаторы перемещаются вокруг границы.</span><span class="sxs-lookup"><span data-stu-id="3f483-438">You should see the text flashing and the lights moving around the border.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3f483-439">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="3f483-439">Next Steps</span></span>

<span data-ttu-id="3f483-440">В `MarqueeControlLibrary` примере демонстрируется простая реализация пользовательских элементов управления и связанных с ними конструкторов.</span><span class="sxs-lookup"><span data-stu-id="3f483-440">The `MarqueeControlLibrary` demonstrates a simple implementation of custom controls and associated designers.</span></span> <span data-ttu-id="3f483-441">Сделать этот пример более сложным можно несколькими способами:</span><span class="sxs-lookup"><span data-stu-id="3f483-441">You can make this sample more sophisticated in several ways:</span></span>

- <span data-ttu-id="3f483-442">Измените значения свойств для `DemoMarqueeControl` в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3f483-442">Change the property values for the `DemoMarqueeControl` in the designer.</span></span> <span data-ttu-id="3f483-443">Добавьте дополнительные `MarqueBorder` элементы управления и закрепите их в своих родительских экземплярах, чтобы создать вложенный результат.</span><span class="sxs-lookup"><span data-stu-id="3f483-443">Add more `MarqueBorder` controls and dock them within their parent instances to create a nested effect.</span></span> <span data-ttu-id="3f483-444">Экспериментируйте с различными настройками `UpdatePeriod` для и свойств, связанных с источниками.</span><span class="sxs-lookup"><span data-stu-id="3f483-444">Experiment with different settings for the `UpdatePeriod` and the light-related properties.</span></span>

- <span data-ttu-id="3f483-445">Создайте собственные реализации `IMarqueeWidget`.</span><span class="sxs-lookup"><span data-stu-id="3f483-445">Author your own implementations of `IMarqueeWidget`.</span></span> <span data-ttu-id="3f483-446">Например, можно создать мигающий знак «Neon» или анимированный знак с несколькими изображениями.</span><span class="sxs-lookup"><span data-stu-id="3f483-446">You could, for example, create a flashing "neon sign" or an animated sign with multiple images.</span></span>

- <span data-ttu-id="3f483-447">Дальнейшая настройка взаимодействия во время разработки.</span><span class="sxs-lookup"><span data-stu-id="3f483-447">Further customize the design-time experience.</span></span> <span data-ttu-id="3f483-448">Можно попытаться затенить больше <xref:System.Windows.Forms.Control.Enabled%2A> свойств <xref:System.Windows.Forms.Control.Visible%2A>, чем и, и добавить новые свойства.</span><span class="sxs-lookup"><span data-stu-id="3f483-448">You could try shadowing more properties than <xref:System.Windows.Forms.Control.Enabled%2A> and <xref:System.Windows.Forms.Control.Visible%2A>, and you could add new properties.</span></span> <span data-ttu-id="3f483-449">Добавьте новые команды конструктора для упрощения распространенных задач, таких как закрепление дочерних элементов управления.</span><span class="sxs-lookup"><span data-stu-id="3f483-449">Add new designer verbs to simplify common tasks like docking child controls.</span></span>

- <span data-ttu-id="3f483-450">`MarqueeControl`Лицензия.</span><span class="sxs-lookup"><span data-stu-id="3f483-450">License the `MarqueeControl`.</span></span> <span data-ttu-id="3f483-451">Дополнительные сведения см. в разделе [Практическое руководство. Компоненты и элементы управления](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/fe8b1eh9(v=vs.120))лицензиями.</span><span class="sxs-lookup"><span data-stu-id="3f483-451">For more information, see [How to: License Components and Controls](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/fe8b1eh9(v=vs.120)).</span></span>

- <span data-ttu-id="3f483-452">Управление сериализацией элементов управления и созданием кода для них.</span><span class="sxs-lookup"><span data-stu-id="3f483-452">Control how your controls are serialized and how code is generated for them.</span></span> <span data-ttu-id="3f483-453">Дополнительные сведения см. в разделе [Динамическое создание и компиляция исходного кода](../../reflection-and-codedom/dynamic-source-code-generation-and-compilation.md).</span><span class="sxs-lookup"><span data-stu-id="3f483-453">For more information, see [Dynamic Source Code Generation and Compilation](../../reflection-and-codedom/dynamic-source-code-generation-and-compilation.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="3f483-454">См. также</span><span class="sxs-lookup"><span data-stu-id="3f483-454">See also</span></span>

- <xref:System.Windows.Forms.UserControl>
- <xref:System.Windows.Forms.Design.ParentControlDesigner>
- <xref:System.Windows.Forms.Design.DocumentDesigner>
- <xref:System.ComponentModel.Design.IRootDesigner>
- <xref:System.ComponentModel.Design.DesignerVerb>
- <xref:System.Drawing.Design.UITypeEditor>
- <xref:System.ComponentModel.BackgroundWorker>
- <span data-ttu-id="3f483-455">[Практическое руководство. Создание элемента управления Windows Forms, который использует преимущества функций времени разработки](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/307hck25(v=vs.120))</span><span class="sxs-lookup"><span data-stu-id="3f483-455">[How to: Create a Windows Forms Control That Takes Advantage of Design-Time Features](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/307hck25(v=vs.120))</span></span>
- <span data-ttu-id="3f483-456">[Расширения поддержки времени разработки](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/37899azc(v=vs.120))</span><span class="sxs-lookup"><span data-stu-id="3f483-456">[Extending Design-Time Support](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/37899azc(v=vs.120))</span></span>
- <span data-ttu-id="3f483-457">[Пользовательские конструкторы](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/h51z5c0x(v=vs.120))</span><span class="sxs-lookup"><span data-stu-id="3f483-457">[Custom Designers](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/h51z5c0x(v=vs.120))</span></span>
