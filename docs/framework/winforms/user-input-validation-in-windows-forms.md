---
title: Проверка входных данных пользователя
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: dc56c09677d1054e8f264169b78638fa83bd7d9e
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76734689"
---
# <a name="user-input-validation-in-windows-forms"></a>Проверка введенных пользователем данных в Windows Forms
Когда пользователи вводят данные в приложение, может потребоваться проверить, являются ли данные допустимыми, прежде чем использовать их в приложении. Может потребоваться, чтобы определенные текстовые поля не были нулевой длины, поле было отформатировано как номер телефона или другой тип данных правильного формата или что строка не содержит небезопасный символ, который можно использовать для нарушения безопасности базы данных. Windows Forms предоставляет несколько способов проверки входных данных в приложении.  
  
## <a name="validation-with-the-maskedtextbox-control"></a>Проверка с помощью элемента управления MaskedTextBox  
 Если требуется, чтобы пользователи вводили данные в четко определенном формате, например номер телефона или номер части, это можно сделать быстро и с минимальным кодом с помощью элемента управления <xref:System.Windows.Forms.MaskedTextBox>. *Маска* — это строка, состоящие из символов от языка маскирования, который указывает, какие символы могут быть введены в любом заданной позиции в текстовом поле. Элемент управления отображает набор запросов пользователю. Если пользователь вводит неправильную запись, например, пользователь вводит букву, когда требуется цифра, элемент управления автоматически отклоняет входные данные.  
  
 Язык маскирования, используемый <xref:System.Windows.Forms.MaskedTextBox>, является очень гибким. Он позволяет указать необходимые символы, необязательные символы, литеральные символы, такие как дефисы и круглые скобки, символы валют и разделители дат. Элемент управления также хорошо работает при привязке к источнику данных. Событие <xref:System.Windows.Forms.Binding.Format> в привязке данных можно использовать для переформатирования входящих данных в соответствии с маской, а событие <xref:System.Windows.Forms.Binding.Parse> может использоваться для переформатирования исходящих данных в соответствии со спецификациями поля данных.  
  
 Дополнительные сведения см. в разделе [элемент управления MaskedTextBox](./controls/maskedtextbox-control-windows-forms.md).  
  
## <a name="event-driven-validation"></a>Проверка на основе событий  
 Если требуется полностью программный контроль над проверкой или необходимо выполнить сложные проверки, следует использовать события проверки, встроенные в большинство элементов управления Windows Forms. Каждый элемент управления, принимающий пользовательский ввод в свободной форме, имеет <xref:System.Windows.Forms.Control.Validating> событие, которое возникает каждый раз, когда элементу управления требуется проверка данных. В <xref:System.Windows.Forms.Control.Validating> методе обработки событий можно проверить ввод пользователя несколькими способами. Например, если имеется текстовое поле, которое должно содержать почтовый индекс, можно выполнить проверку следующими способами.  
  
- Если почтовый индекс должен принадлежать к определенной группе почтовых индексов, можно выполнить сравнение строк на входе для проверки данных, вводимых пользователем. Например, если почтовый индекс должен находиться в наборе {10001, 10002, 10003}, то для проверки данных можно использовать сравнение строк.  
  
- Если почтовый индекс должен быть указан в определенной форме, можно использовать регулярные выражения для проверки данных, вводимых пользователем. Например, чтобы проверить форму `#####` или `#####-####`, можно использовать `^(\d{5})(-\d{4})?$`регулярное выражение. Чтобы проверить форму `A#A #A#`, можно использовать `[A-Z]\d[A-Z] \d[A-Z]\d`регулярного выражения. Дополнительные сведения о регулярных выражениях см. в разделе [.NET Framework регулярные выражения](../../standard/base-types/regular-expressions.md) и [примеры регулярных выражений](../../standard/base-types/regular-expression-examples.md).  
  
- Если почтовый индекс должен быть допустимым США почтовым индексом, можно вызвать веб-службу почтового кода, чтобы проверить данные, введенные пользователем.  
  
 Для события <xref:System.Windows.Forms.Control.Validating> предоставляется объект типа <xref:System.ComponentModel.CancelEventArgs>. Если вы определили, что данные элемента управления недопустимы, можно отменить <xref:System.Windows.Forms.Control.Validating> событие, задав свойству <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> этого объекта значение `true`. Если свойство <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> не задано, Windows Forms будет считать, что проверка для этого элемента управления прошла удачно, и вызвать событие <xref:System.Windows.Forms.Control.Validated>.  
  
 Пример кода, который проверяет адрес электронной почты в <xref:System.Windows.Controls.TextBox>, см. в разделе <xref:System.Windows.Forms.Control.Validating>.  
  
### <a name="data-binding-and-event-driven-validation"></a>Привязка данных и проверка на основе событий  
 Проверка очень полезна, если элементы управления привязаны к источнику данных, например к таблице базы данных. С помощью проверки можно убедиться, что данные элемента управления соответствуют формату, требуемому для источника данных, и не содержат специальные символы, такие как кавычки и обратные косые черты, которые могут быть ненадежными.  
  
 При использовании привязки данных данные в элементе управления синхронизируются с источником данных во время выполнения события <xref:System.Windows.Forms.Control.Validating>. При отмене <xref:System.Windows.Forms.Control.Validating> события данные не будут синхронизированы с источником данных.  
  
> [!IMPORTANT]
> Если пользовательская проверка выполняется после события <xref:System.Windows.Forms.Control.Validating>, это не повлияет на привязку данных. Например, если имеется код в <xref:System.Windows.Forms.Control.Validated> событии, которое пытается отменить привязку данных, привязка данных все равно будет выполняться. В этом случае для выполнения проверки в событии <xref:System.Windows.Forms.Control.Validated> измените свойство **режим обновления источника данных** элемента управления (**в разделе (DataBindings)** \\ **(дополнительно)** ) с onvalid **valid** на **Never**и добавьте *Control*`.DataBindings["` *\<YOURFIELD >* `"].WriteValue()` в код проверки.  
  
### <a name="implicit-and-explicit-validation"></a>Явная и явная проверка  
 Итак, когда выполняется проверка данных элемента управления? Это разработчик. В зависимости от потребностей приложения можно использовать явную или явную проверку.  
  
#### <a name="implicit-validation"></a>Неявная проверка  
 При неявном подходе проверки данные проверяются по мере его ввода пользователем. Данные можно проверить по мере ввода данных в элемент управления, прочитав клавиши по мере их нажатия или чаще, когда пользователь получит фокус ввода от одного элемента управления и перейдет к следующему. Этот подход удобен, если вы хотите предоставить пользователю немедленный отзыв о данных по мере их работы.  
  
 Если вы хотите использовать неявную проверку для элемента управления, необходимо задать свойству <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> этого элемента управления значение <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> или <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>. Если отменить событие <xref:System.Windows.Forms.Control.Validating>, поведение элемента управления будет определяться значением, назначенным <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>. Если вы назначили <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, отмена события приведет к возникновению <xref:System.Windows.Forms.Control.Validated> события. Фокус ввода останется на текущем элементе управления до тех пор, пока пользователь не изменит данные на допустимый вход. Если вы назначили <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, событие <xref:System.Windows.Forms.Control.Validated> не будет происходить при отмене события, но фокус по-прежнему будет переходить к следующему элементу управления.  
  
 Присвоение <xref:System.Windows.Forms.AutoValidate.Disable> свойству <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>, полностью предотвращает неявную проверку. Чтобы проверить элементы управления, необходимо будет использовать явную проверку.  
  
#### <a name="explicit-validation"></a>Явная проверка  
 При явном подходе проверки данные проверяются за один раз. Можно проверить данные в ответ на действие пользователя, например нажав кнопку Сохранить или следующую ссылку. При возникновении действия пользователя можно активировать явную проверку одним из следующих способов:  
  
- Вызовите <xref:System.Windows.Forms.ContainerControl.Validate%2A>, чтобы проверить последний элемент управления, чтобы он потерял фокус.  
  
- Вызовите <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A>, чтобы проверить все дочерние элементы управления в форме или контейнере.  
  
- Вызов пользовательского метода для проверки данных в элементах управления вручную.  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a>Поведение неявной проверки по умолчанию для элементов управления Windows Forms  
 Различные элементы управления Windows Forms имеют разные значения по умолчанию для их свойства <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>. В следующей таблице показаны наиболее распространенные элементы управления и их значения по умолчанию.  
  
|Control|Поведение проверки по умолчанию|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|Свойство не предоставлено в Visual Studio|  
|<xref:System.Windows.Forms.ToolStripContainer>|Свойство не предоставлено в Visual Studio|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a>Закрытие формы и Переопределение проверки  
 Когда элемент управления сохраняет фокус, поскольку содержащиеся в нем данные являются недопустимыми, невозможно закрыть родительскую форму одним из обычных способов:  
  
- Нажав кнопку **Закрыть** .  
  
- Выбрав пункт **Закрыть** в меню **система** .  
  
- Вызывая метод <xref:System.Windows.Forms.Form.Close%2A> программным способом.  
  
 Однако в некоторых случаях может потребоваться разрешить пользователю закрывать форму независимо от того, являются ли значения в элементах управления допустимыми. Можно переопределить проверку и закрыть форму, которая по-прежнему содержит недопустимые данные, создав обработчик для события <xref:System.Windows.Forms.Form.FormClosing> формы. В событии задайте для свойства <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> значение `false`. Это приводит к закрытию формы. Дополнительные сведения и пример см. в разделе <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>.  
  
> [!NOTE]
> Если принудительно закрыть форму таким образом, все данные в элементах управления формы, которые еще не были сохранены, теряются. Кроме того, модальные формы не проверяют содержимое элементов управления при их закрытии. Вы по-прежнему можете использовать проверку элемента управления для блокировки фокуса на элемент управления, но не нужно беспокоиться о поведении, связанном с закрытием формы.  
  
## <a name="see-also"></a>См. также раздел

- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>
- <xref:System.Windows.Forms.FormClosingEventArgs?displayProperty=nameWithType>
- [Элемент управления MaskedTextBox](./controls/maskedtextbox-control-windows-forms.md)
- [Примеры регулярных выражений](../../standard/base-types/regular-expression-examples.md)
