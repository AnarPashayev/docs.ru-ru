---
title: Общие сведения о безопасности
ms.date: 03/30/2017
helpviewer_keywords:
- code access security [Windows Forms], Windows Forms
- permissions [Windows Forms], Windows Forms
- Windows Forms, security
- security [Windows Forms], about security
- access control [Windows Forms], Windows Forms
ms.assetid: 4810dc9f-ea23-4ce1-8ea1-657f0ff1d820
ms.openlocfilehash: 9010b45383f856079661359fdf82180526d96dde
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2020
ms.locfileid: "76734852"
---
# <a name="security-in-windows-forms-overview"></a>Общие сведения о безопасности в Windows Forms

До выпуска .NET Framework весь код, выполняемый на компьютере пользователя, имел те же права или разрешения на доступ к ресурсам, которые имел пользователь компьютера. Например, если пользователю был разрешен доступ к файловой системе, то код также получал доступ к файловой системе Если пользователю был разрешен доступ к базе данных, то и коду предоставлялся доступ к ней. Наличие таких прав или разрешений может быть допустимо для кода в исполняемых файлах, которые пользователь собственноручно установил на локальном компьютере, но оно неприемлемо в тех случаях, когда речь идет о потенциально вредоносном коде, поступившем из Интернета или локальной интрасети. Такой код не должен получать доступ к ресурсам компьютера пользователя без его разрешения.

В .NET Framework введена инфраструктура, называемая системой управления доступом для кода, которая позволяет отличать разрешения (или права) от прав, которые имеет пользователь. По умолчанию код, поступающий из Интернета или интрасети, может выполняться только в режиме частичного доверия. В режиме частичного доверия приложение подвергается ряду ограничений: помимо всего прочего, приложению отказано в доступе к локальным жестким дискам, и оно не может запускать неуправляемый код. .NET Framework управляет ресурсами, к которым коду разрешен доступ в зависимости от идентификатора этого кода: от того, откуда он поступил, имеет ли он [сборки со строгими именами](../../standard/assembly/strong-named.md), подписаны ли они сертификатом и т. д.

Технология ClickOnce, используемая для развертывания Windows Forms приложений, помогает упростить разработку приложений, работающих в режиме частичного доверия, с полным доверием или с частичным доверием с повышенными разрешениями. Технология ClickOnce предоставляет такие функции, как повышение уровня разрешений и развертывание доверенных приложений, поэтому приложение может запрашивать полное доверие или повысить уровень разрешений от локального пользователя в ответственном способе.

## <a name="understanding-security-in-the-net-framework"></a>Общее представление о безопасности в .NET Framework

Управление доступом для кода позволяет считать код надежным в той или иной степени в зависимости от происхождения кода и других аспектов его удостоверения. Подробнее о данных, на основании которых среда CLR определяет политику безопасности, см. в разделе [Свидетельство](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/7y5x1hcd(v=vs.100)). Это помогает защитить компьютеры от вредоносного кода, а доверенный код — от умышленного или случайного нарушения безопасности. Управление доступом для кода также позволяет лучше контролировать действия, которые может выполнять приложение, так как вы можете указать только те разрешения, которые необходимы для работы приложения. Управление доступом для кода влияет на весь управляемый код, который предназначен для среды CLR, даже если этот код не производит ни одной проверки разрешений, предоставленных посредством управления доступом для кода. Дополнительные сведения о безопасности в .NET Framework см. в разделе Основные [понятия безопасности](../../standard/security/key-security-concepts.md) и [основы управления доступом для кода](../misc/code-access-security-basics.md).

Если пользователь запускает исполняемый файл Windows Forms непосредственно с веб-сервера или из общей папки, то степень доверия, предоставляемая приложению, зависит от того, где размещается код и как он запущен. При запуске приложения происходит его автоматическая оценка, после которой приложение получает именованный набор разрешений от среды CLR. По умолчанию код на локальном компьютере получает набор разрешений полного доверия, код из локальной сети — набор разрешений локальной интрасети, а код из Интернета — набор разрешений Интернета.

> [!NOTE]
> В .NET Framework версии 1,0 с пакетом обновления 1 (SP1) и 2 (SP2) группа кода зоны Интернета получает набор разрешений Nothing. Во всех остальных выпусках .NET Framework группа кода зоны Интернета получает набор разрешений Интернета.
>
> Разрешения по умолчанию, которые содержатся в этих наборах, приведены в разделе [Политика безопасности по умолчанию](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/03kwzyfc(v=vs.100)). В зависимости от разрешений, которые получает приложение, оно выполняется правильно либо вызывает исключение безопасности.
>
> Многие Windows Forms приложения будут развернуты с помощью ClickOnce. Средства, используемые для создания развертывания ClickOnce, имеют разные параметры безопасности по умолчанию, чем были рассмотрены ранее. Подробнее см. далее в этом разделе.

Разрешения, предоставленные приложению, могут отличаться от разрешений по умолчанию, потому что политика безопасности может быть изменена. Это означает, что приложение может иметь некоторые разрешения на одном компьютере, но не иметь их на другом.

## <a name="developing-a-more-secure-windows-forms-application"></a>Разработка более безопасных приложений Windows Forms

Безопасность важна на всех этапах разработки приложения. Начните с анализа и выполнения [правил написания безопасного кода](../../standard/security/secure-coding-guidelines.md).

Далее необходимо решить, будет ли приложение выполняться в режиме полного или частичного доверия. Выполнение приложения в режиме полного доверия облегчает доступ к ресурсам на локальном компьютере, но подвергает приложение и его пользователей высокому риску нарушения безопасности, если приложение проектировалось и разрабатывалось без строгого соблюдения правил написания безопасного кода. Выполнение приложения в режиме частичного доверия облегчает разработку более безопасных приложений и сокращает риски, но требует более тщательного планирования реализации некоторых возможностей.

Если используется частичное доверие (т. е. наборы разрешений "Интернет" или "Локальная интрасеть"), определите, как должно вести себя приложение в этой среде. Windows Forms предоставляет более безопасные альтернативные способы реализации возможностей приложения в среде с частичным доверием. Определенные части приложения, например отвечающие за доступ к данным, могут быть разработаны и написаны по-разному для среды с частичным доверием и среды с полным доверием. Некоторые возможности Windows Forms, такие как параметры приложения, предназначены для работы в среде с частичным доверием. Подробнее см. в разделе [Общие сведения о параметрах приложений](./advanced/application-settings-overview.md).

Если приложению требуется больше разрешений, чем позволяет среда с частичным доверием, однако предоставлять ему разрешения полного доверия нежелательно, можно работать в режиме частичного доверия, запросив только необходимые дополнительные разрешения. Например, если требуется работать в режиме частичного доверия, но необходимо предоставить приложению доступ только для чтения к каталогу в файловой системе пользователя, можно запросить разрешение <xref:System.Security.Permissions.FileIOPermission> только для этого каталога. При правильном применении этот подход может расширять функциональные возможности приложения и снижать угрозу безопасности для пользователей.

При разработке приложения, которое будет выполняться в среде с частичным доверием, отслеживайте, какие разрешения обязательны для его работы и какие могут использоваться им дополнительно. Когда известны все разрешения, необходимо подать декларативный запрос на разрешения на уровне приложения. Запрос разрешений информирует .NET Framework времени выполнения о том, какие разрешения требуются приложению и какие разрешения он не хочет. Дополнительные сведения о запросе разрешений см. в разделе [Запрос разрешений](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/yd267cce(v=vs.100)).

При запросе необязательных разрешений необходимо обработать исключения безопасности, которые могут возникнуть, если приложение выполнит действие, требующее разрешений, которые не были предоставлены. Корректная обработка исключения <xref:System.Security.SecurityException> гарантирует, что приложение будет продолжать работать. Приложение может использовать исключения для определения того, следует ли отключить ту или иную возможность для пользователя. Например, приложение может отключить команду меню **Сохранить**, если не предоставлено соответствующее разрешение.

Иногда трудно определить, запрошены ли все необходимые разрешения. Например, вызов метода, который на первый взгляд выглядит вполне безобидно, может во время выполнения в какой-то момент обращаться к файловой системе. Если не выполнить развертывание приложения со всеми требуемыми разрешениями, оно может работать корректно при отладке, но отказать при развертывании. Пакет SDK для .NET Framework 2,0 и Visual Studio 2005 содержат средства для вычисления разрешений, необходимых приложению: средство командной строки MT. exe и функция вычисления разрешений в Visual Studio соответственно.

Дополнительные функции обеспечения безопасности Windows Forms описаны в представленных ниже разделах.

|Раздел|Description|
|-----------|-----------------|
|- [Более безопасный доступ к файлам и данным в Windows Forms](more-secure-file-and-data-access-in-windows-forms.md)|Описание доступа к файлам и данным в среде с частичным доверием.|
|- [Более безопасная печать в Windows Forms](more-secure-printing-in-windows-forms.md)|Описание доступа к возможностям печати в среде с частичным доверием.|
|- [Дополнительные вопросы безопасности в формах Windows Forms](additional-security-considerations-in-windows-forms.md)|Описание способов работы с окнами с помощью буфера обмена и вызова неуправляемого кода в среде с частичным доверием.|

### <a name="deploying-an-application-with-the-appropriate-permissions"></a>Развертывание приложения с соответствующими разрешениями

Наиболее распространенным способом развертывания Windows Forms приложения на клиентском компьютере является технология ClickOnce, которая описывает все компоненты, необходимые для работы приложения. Технология ClickOnce использует XML-файлы, называемые манифестами, для описания сборок и файлов, составляющих приложение, а также разрешений, необходимых приложению.

Технология ClickOnce имеет две технологии для запроса повышенных разрешений на клиентском компьютере. Обе технологии основаны на использовании сертификатов Authenticode. Сертификаты предоставляют пользователям некоторые гарантии того, что приложение поступило из надежного источника.

Эти технологии описаны в приведенной ниже таблице.

|Технология повышения уровня разрешений|Description|
|------------------------------------|-----------------|
|Повышение уровня разрешений|Запрашивает пользователя с помощью диалогового окна безопасности при первом запуске приложения. Диалоговое окно **Повышение разрешений** информирует пользователя об издателе приложения, чтобы пользователь мог принять обоснованное решение в отношении того, следует ли предоставлять приложению дополнительное доверие.|
|Развертывание надежных приложений|Предусматривает однократную установку сертификата Authenticode издателя на клиентском компьютере, выполняемую системным администратором. С этого момента любые приложения, подписанные этим сертификатом, будут рассматриваться как надежные, и их можно будет запускать с полным доверием на локальном компьютере без дополнительных запросов.|

Выбор технологии зависит от среды развертывания. Подробнее см. в разделе [Выбор стратегии развертывания ClickOnce](/visualstudio/deployment/choosing-a-clickonce-deployment-strategy).

По умолчанию приложения ClickOnce, развернутые с помощью Visual Studio или средств .NET Framework SDK (Mage. exe и MageUI. exe), настроены на выполнение на клиентском компьютере с полным доверием. При развертывании приложения с помощью частичного доверия или с помощью только некоторых дополнительных разрешений необходимо изменить эту настройку по умолчанию. Это можно сделать с помощью Visual Studio или средства .NET Framework SDK для программы MageUI. exe при настройке развертывания. Дополнительные сведения об использовании MageUI. exe см. в разделе [Пошаговое руководство. Развертывание приложения ClickOnce вручную](/visualstudio/deployment/walkthrough-manually-deploying-a-clickonce-application).  См. также разделы [Практическое руководство. Установка пользовательских разрешений для приложения ClickOnce](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2012/hafybdaa(v=vs.110)) или [Практическое руководство. Установка пользовательских разрешений для приложения ClickOnce](/visualstudio/deployment/how-to-set-custom-permissions-for-a-clickonce-application).

Дополнительные сведения о аспектах безопасности ClickOnce и повышении разрешений см. в разделе [Защита приложений ClickOnce](/visualstudio/deployment/securing-clickonce-applications). Подробнее о развертывании доверенных приложений см. в разделе [Общие сведения о развертывании доверенных приложений](/visualstudio/deployment/trusted-application-deployment-overview).

### <a name="testing-the-application"></a>Тестирование приложения

Если приложение Windows Forms развернуто с помощью Visual Studio, можно включить отладку в режиме частичного доверия или ограниченный набор разрешений из среды разработки.  См. также [руководство. Отладка приложения ClickOnce с ограниченными разрешениями](/visualstudio/deployment/how-to-debug-a-clickonce-application-with-restricted-permissions).

## <a name="see-also"></a>См. также раздел

- [Безопасность Windows Forms](windows-forms-security.md)
- [Основы управления доступом для кода](../misc/code-access-security-basics.md)
- [Развертывание и безопасность технологии ClickOnce](/visualstudio/deployment/clickonce-security-and-deployment)
- [Общие сведения о развертывании доверенных приложений](/visualstudio/deployment/trusted-application-deployment-overview)
- [Mage.exe (средство создания и редактирования манифеста)](../tools/mage-exe-manifest-generation-and-editing-tool.md)
- [MageUI.exe (средство создания и редактирования манифестов, графический клиент)](../tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client.md)
