---
title: Общие сведения о Windows Forms и неуправляемых приложениях
ms.date: 03/30/2017
helpviewer_keywords:
- COM [Windows Forms]
- Windows Forms, unmanaged
- COM interop
- ActiveX controls [Windows Forms], about ActiveX controls
- Windows Forms, interop
ms.assetid: 0a26d99d-8135-4895-8760-c9a2b5f67f14
ms.openlocfilehash: 63631378911a9ba95713e68fb19d8d08176c7562
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61748180"
---
# <a name="windows-forms-and-unmanaged-applications-overview"></a><span data-ttu-id="4f1e8-102">Общие сведения о Windows Forms и неуправляемых приложениях</span><span class="sxs-lookup"><span data-stu-id="4f1e8-102">Windows Forms and Unmanaged Applications Overview</span></span>
<span data-ttu-id="4f1e8-103">Приложения и элементы управления Windows Forms могут взаимодействовать с неуправляемыми приложениями, но с некоторыми оговорками.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-103">Windows Forms applications and controls can interoperate with unmanaged applications, with some caveats.</span></span> <span data-ttu-id="4f1e8-104">В следующих разделах описываются сценарии и конфигурации, которые поддерживаются и не поддерживаются элементами управления и приложениями Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-104">The following sections describe the scenarios and configurations that Windows Forms applications and controls support and those that they do not support.</span></span>  
  
## <a name="windows-forms-controls-and-activex-applications"></a><span data-ttu-id="4f1e8-105">Элементы управления Windows Forms и приложения ActiveX</span><span class="sxs-lookup"><span data-stu-id="4f1e8-105">Windows Forms Controls and ActiveX Applications</span></span>  
 <span data-ttu-id="4f1e8-106">За исключением Microsoft Internet Explorer и Microsoft Foundation Classes (MFC), элементы управления Windows Forms не поддерживаются в приложениях, предназначенных для размещения элементов управления ActiveX.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-106">With the exception of Microsoft Internet Explorer and Microsoft Foundation Classes (MFC), Windows Forms controls are not supported in applications designed to host ActiveX controls.</span></span> <span data-ttu-id="4f1e8-107">Другие приложения и средства разработки, способные размещать элементы управления ActiveX, включая контейнеры для тестирования ActiveX из версий Visual Studio, предшествующих Visual Studio .NET 2003, не поддерживают размещение элементов управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-107">Other applications and development tools that are capable of hosting ActiveX controls, including the ActiveX test containers from versions of Visual Studio that are earlier than Visual Studio .NET 2003, are not supported hosts for Windows Forms controls.</span></span>  
  
 <span data-ttu-id="4f1e8-108">Эти ограничения также применимы к использованию элементов управления Windows Forms посредством COM-взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-108">These constraints also apply to the use of Windows Forms controls through Component Object Model COM interop.</span></span> <span data-ttu-id="4f1e8-109">Использование элемента управления Windows Forms с помощью вызываемой оболочки COM (CCW) поддерживается только в Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-109">The use of a Windows Forms control through a COM callable wrapper (CCW) is supported only in Internet Explorer.</span></span> <span data-ttu-id="4f1e8-110">Подробнее о COM-взаимодействии см. в разделе</span><span class="sxs-lookup"><span data-stu-id="4f1e8-110">For more information about COM interop, see</span></span>  
  
 <span data-ttu-id="4f1e8-111">[COM Interop](../../../visual-basic/programming-guide/com-interop/index.md).</span><span class="sxs-lookup"><span data-stu-id="4f1e8-111">[COM Interop](../../../visual-basic/programming-guide/com-interop/index.md).</span></span>  
  
 <span data-ttu-id="4f1e8-112">В таблице ниже показаны доступные средства размещения ActiveX для элементов управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-112">The following table shows the available ActiveX hosting support for Windows Forms controls.</span></span>  
  
|<span data-ttu-id="4f1e8-113">Версия Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4f1e8-113">Windows Forms version</span></span>|<span data-ttu-id="4f1e8-114">Поддержка</span><span class="sxs-lookup"><span data-stu-id="4f1e8-114">Support</span></span>|  
|---------------------------|-------------|  
|<span data-ttu-id="4f1e8-115">.NET Framework 1.0</span><span class="sxs-lookup"><span data-stu-id="4f1e8-115">.NET Framework version 1.0</span></span>|<span data-ttu-id="4f1e8-116">Internet Explorer 5.01 и более поздние версии</span><span class="sxs-lookup"><span data-stu-id="4f1e8-116">Internet Explorer 5.01 and later versions</span></span>|  
|<span data-ttu-id="4f1e8-117">.NET Framework 1.1 и более поздние версии</span><span class="sxs-lookup"><span data-stu-id="4f1e8-117">.NET Framework version 1.1 and later</span></span>|<span data-ttu-id="4f1e8-118">Internet Explorer 5.01 и более поздние версии</span><span class="sxs-lookup"><span data-stu-id="4f1e8-118">Internet Explorer 5.01 and later versions</span></span><br /><br /> <span data-ttu-id="4f1e8-119">Microsoft Foundation Classes (MFC) 7.0 и более поздние версии</span><span class="sxs-lookup"><span data-stu-id="4f1e8-119">Microsoft Foundation Classes (MFC) 7.0 and later</span></span>|  
  
## <a name="hosting-windows-forms-components-as-activex-controls"></a><span data-ttu-id="4f1e8-120">Размещение компонентов Windows Forms в качестве элементов управления ActiveX</span><span class="sxs-lookup"><span data-stu-id="4f1e8-120">Hosting Windows Forms components as ActiveX controls</span></span>  
 <span data-ttu-id="4f1e8-121">В .NET Framework 1.1 поддержка была расширена для включения MFC 7.0 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-121">In the .NET Framework 1.1, support was extended to include MFC 7.0 and later versions.</span></span> <span data-ttu-id="4f1e8-122">Эта поддержка включает в себя любой контейнер, полностью совместимый с MFC 7.0 или с более поздней версией контейнера элементов управления ActiveX.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-122">This support includes any container that is fully compatible with the MFC 7.0 and later ActiveX control container.</span></span>  
  
 <span data-ttu-id="4f1e8-123">Однако регистрация элементов управления Windows Forms как элементов управления ActiveX не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-123">However, registration of Windows Forms controls as ActiveX controls is not supported.</span></span> <span data-ttu-id="4f1e8-124">Также не поддерживается вызов метода `com.ms.win32.Ole32.CoCreateInstance` для элементов управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-124">Also, calling the `com.ms.win32.Ole32.CoCreateInstance` method for Windows Forms controls is not supported.</span></span> <span data-ttu-id="4f1e8-125">Поддерживается только управляемая активация элементов управления Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-125">Only managed activation of Windows Forms controls is supported.</span></span> <span data-ttu-id="4f1e8-126">После создания элемента управления Windows Forms его можно размещать в приложении MFC так же, как элемент управления ActiveX.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-126">Once you create a Windows Forms control, you can host it in an MFC application just as with an ActiveX control.</span></span>  
  
 <span data-ttu-id="4f1e8-127">Чтобы использовать элементы управления Windows Forms в неуправляемом приложении, необходимо либо разместить среду CLR с помощью неуправляемых интерфейсов API размещения среды CLR, либо использовать возможности взаимодействия C++.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-127">To use Windows Forms controls in your unmanaged application, you must either host the CLR using the unmanaged CLR hosting APIs or use the C++ interop features.</span></span> <span data-ttu-id="4f1e8-128">Рекомендуемым решением является использование возможностей взаимодействия C++.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-128">Using the C++ interop features is the recommended solution.</span></span>  
  
## <a name="windows-forms-in-com-client-applications"></a><span data-ttu-id="4f1e8-129">Windows Forms в клиентских приложениях COM</span><span class="sxs-lookup"><span data-stu-id="4f1e8-129">Windows Forms in COM client applications</span></span>  
 <span data-ttu-id="4f1e8-130">При открытии формы Windows Forms из клиентского приложения COM, такого как приложение Visual Basic 6.0 или приложение MFC, форма может вести себя не так, как ожидается.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-130">When you open a Windows Form from a COM client application, such as a Visual Basic 6.0 application or an MFC application, the form may behave unexpectedly.</span></span> <span data-ttu-id="4f1e8-131">Например, при нажатии клавиши TAB фокус не переходит от одного элемента управления к другому.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-131">For example, when you press the TAB key, the focus does not change from one control to another control.</span></span> <span data-ttu-id="4f1e8-132">При нажатии клавиши ВВОД, если фокус установлен на кнопке, событие кнопки <xref:System.Windows.Forms.Control.Click> не возникает.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-132">When you press the ENTER key while a command button has focus, the button's <xref:System.Windows.Forms.Control.Click> event is not raised.</span></span> <span data-ttu-id="4f1e8-133">Также может наблюдаться и другое неожиданное поведение при нажатии клавиш или действиях мышью.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-133">You may also experience unexpected behavior for keystrokes or mouse activity.</span></span>  
  
 <span data-ttu-id="4f1e8-134">Это происходит из-за того, что неуправляемое приложение не реализует поддержку цикла обработки сообщений, которая необходима для правильной работы формы Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-134">This behavior occurs because the unmanaged application does not implement the message loop support that Windows Forms requires to work correctly.</span></span> <span data-ttu-id="4f1e8-135">Цикл обработки сообщений, реализуемый в клиентском приложении COM, существенно отличается от цикла обработки сообщений Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-135">The message loop provided by the COM client application is fundamentally different from the Windows Forms message loop.</span></span>  
  
 <span data-ttu-id="4f1e8-136">Цикл обработки сообщений приложения является внутренним циклом программы, который получает сообщения из очереди сообщений потока, преобразует их и отправляет приложению для обработки.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-136">An application's message loop is an internal program loop that retrieves messages from a thread's message queue, translates them, and then sends them to the application to be handled.</span></span> <span data-ttu-id="4f1e8-137">Архитектура цикла обработки сообщений для формы Windows Forms отличается от архитектуры, используемой в более ранних приложениях, таких как приложения Visual Basic 6.0 и приложения MFC.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-137">The message loop for a Windows Form does not have the same architecture as message loops that earlier applications, such as Visual Basic 6.0 applications and MFC applications, provide.</span></span> <span data-ttu-id="4f1e8-138">Сообщения окна, которые отправляются в цикл обработки сообщений, могут обрабатываться не так, как ожидает форма Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-138">The window messages that are posted to the message loop may be handled differently than the Windows Form expects.</span></span> <span data-ttu-id="4f1e8-139">Таким образом, может наблюдаться неожиданное поведение.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-139">Therefore, unexpected behavior may occur.</span></span> <span data-ttu-id="4f1e8-140">Могут не работать некоторые сочетания клавиш и некоторые действия мыши, а также могут не возникать некоторые события.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-140">Some keystroke combinations may not work, some mouse activity may not work, or some events may not be raised as expected.</span></span>  
  
## <a name="resolving-interoperability-issues"></a><span data-ttu-id="4f1e8-141">Устранение проблем взаимодействия</span><span class="sxs-lookup"><span data-stu-id="4f1e8-141">Resolving Interoperability Issues</span></span>  
 <span data-ttu-id="4f1e8-142">Эти проблемы можно устранить путем отображения формы в цикле обработки сообщений [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] , который создается с помощью метода <xref:System.Windows.Forms.Application.Run%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="4f1e8-142">You can resolve these problems by displaying the form on a [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] message loop, which is created by using the <xref:System.Windows.Forms.Application.Run%2A?displayProperty=nameWithType> method.</span></span>  
  
 <span data-ttu-id="4f1e8-143">Чтобы исправить работу формы Windows Forms из клиентского приложения COM, необходимо запустить его в цикле обработки сообщений Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-143">To make a Windows Form work correctly from a COM client application, you must run it on a Windows Forms message loop.</span></span> <span data-ttu-id="4f1e8-144">Для этого воспользуйтесь одним из перечисленных ниже подходов.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-144">To do this, use one of the following approaches:</span></span>  
  
- <span data-ttu-id="4f1e8-145">Используйте метод <xref:System.Windows.Forms.Form.ShowDialog%2A?displayProperty=nameWithType> для отображения Windows Form.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-145">Use the <xref:System.Windows.Forms.Form.ShowDialog%2A?displayProperty=nameWithType> method to display the Windows Form.</span></span> <span data-ttu-id="4f1e8-146">Дополнительные сведения см. в разделе [Как Поддержка COM-взаимодействия путем отображения формы Windows Forms с помощью метода ShowDialog](com-interop-by-displaying-a-windows-form-shadow.md).</span><span class="sxs-lookup"><span data-stu-id="4f1e8-146">For more information, see [How to: Support COM Interop by Displaying a Windows Form with the ShowDialog Method](com-interop-by-displaying-a-windows-form-shadow.md).</span></span>  
  
- <span data-ttu-id="4f1e8-147">Запускайте каждую форму Windows Forms в новом потоке.</span><span class="sxs-lookup"><span data-stu-id="4f1e8-147">Display each Windows Form on a new thread.</span></span> <span data-ttu-id="4f1e8-148">Дополнительные сведения см. в разделе [Как Поддержка COM-взаимодействия путем отображения каждой формы Windows Forms в отдельном потоке](how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md).</span><span class="sxs-lookup"><span data-stu-id="4f1e8-148">For more information, see [How to: Support COM Interop by Displaying Each Windows Form on Its Own Thread](how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4f1e8-149">См. также</span><span class="sxs-lookup"><span data-stu-id="4f1e8-149">See also</span></span>

- [<span data-ttu-id="4f1e8-150">Windows Forms и неуправляемые приложения</span><span class="sxs-lookup"><span data-stu-id="4f1e8-150">Windows Forms and Unmanaged Applications</span></span>](windows-forms-and-unmanaged-applications.md)
- [<span data-ttu-id="4f1e8-151">COM-взаимодействие</span><span class="sxs-lookup"><span data-stu-id="4f1e8-151">COM Interop</span></span>](../../../visual-basic/programming-guide/com-interop/index.md)
- [<span data-ttu-id="4f1e8-152">COM-взаимодействие в приложениях .NET Framework</span><span class="sxs-lookup"><span data-stu-id="4f1e8-152">COM Interoperability in .NET Framework Applications</span></span>](../../../visual-basic/programming-guide/com-interop/com-interoperability-in-net-framework-applications.md)
- <span data-ttu-id="4f1e8-153">[Примеры COM-взаимодействия](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/cxcz83xf(v=vs.90))</span><span class="sxs-lookup"><span data-stu-id="4f1e8-153">[COM Interoperability Samples](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/cxcz83xf(v=vs.90))</span></span>
- [<span data-ttu-id="4f1e8-154">Aximp.exe (программа импорта элементов ActiveX форм Windows Forms)</span><span class="sxs-lookup"><span data-stu-id="4f1e8-154">Aximp.exe (Windows Forms ActiveX Control Importer)</span></span>](../../tools/aximp-exe-windows-forms-activex-control-importer.md)
- [<span data-ttu-id="4f1e8-155">Предоставление компонентов .NET Framework клиентам COM</span><span class="sxs-lookup"><span data-stu-id="4f1e8-155">Exposing .NET Framework Components to COM</span></span>](../../interop/exposing-dotnet-components-to-com.md)
- [<span data-ttu-id="4f1e8-156">Упаковка сборки для модели COM</span><span class="sxs-lookup"><span data-stu-id="4f1e8-156">Packaging an Assembly for COM</span></span>](../../interop/packaging-an-assembly-for-com.md)
- [<span data-ttu-id="4f1e8-157">Регистрация сборок в COM</span><span class="sxs-lookup"><span data-stu-id="4f1e8-157">Registering Assemblies with COM</span></span>](../../interop/registering-assemblies-with-com.md)
- [<span data-ttu-id="4f1e8-158">Практическое руководство. Поддержка COM-взаимодействия путем отображения формы Windows Forms с помощью метода ShowDialog</span><span class="sxs-lookup"><span data-stu-id="4f1e8-158">How to: Support COM Interop by Displaying a Windows Form with the ShowDialog Method</span></span>](com-interop-by-displaying-a-windows-form-shadow.md)
- [<span data-ttu-id="4f1e8-159">Практическое руководство. Поддержка COM-взаимодействия путем отображения каждой формы Windows Forms в отдельном потоке</span><span class="sxs-lookup"><span data-stu-id="4f1e8-159">How to: Support COM Interop by Displaying Each Windows Form on Its Own Thread</span></span>](how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md)
