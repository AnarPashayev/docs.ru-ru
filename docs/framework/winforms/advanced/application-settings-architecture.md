---
title: Архитектура параметров приложения
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: a049bbe22d29f02acbc7889bb5d5010ec44f9d15
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2019
ms.locfileid: "65876222"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="f7813-102">Архитектура параметров приложения</span><span class="sxs-lookup"><span data-stu-id="f7813-102">Application Settings Architecture</span></span>
<span data-ttu-id="f7813-103">В этом разделе описываются принципы работы архитектуры параметров приложения и рассматриваются дополнительные возможности архитектуры, такие как сгруппированные параметры и ключи параметров.</span><span class="sxs-lookup"><span data-stu-id="f7813-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="f7813-104">Архитектура параметров приложений позволяет определять строго типизированные параметры с областью приложения или пользователя и сохраняет параметры в сеансах приложения.</span><span class="sxs-lookup"><span data-stu-id="f7813-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="f7813-105">Архитектура предоставляет механизм сохраняемости по умолчанию для сохранения параметров и их загрузки из локальной файловой системы.</span><span class="sxs-lookup"><span data-stu-id="f7813-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="f7813-106">Она также определяет интерфейсы для предоставления пользовательских механизмов сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="f7813-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="f7813-107">Эти интерфейсы позволяют пользовательским компонентам сохранять свои параметры, когда они размещаются в приложении.</span><span class="sxs-lookup"><span data-stu-id="f7813-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="f7813-108">Благодаря ключам параметров компоненты могут раздельно хранить параметры для нескольких экземпляров компонента.</span><span class="sxs-lookup"><span data-stu-id="f7813-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="f7813-109">Определение параметров</span><span class="sxs-lookup"><span data-stu-id="f7813-109">Defining Settings</span></span>  
 <span data-ttu-id="f7813-110">Архитектура параметров приложения используется в ASP.NET и Windows Forms, и он содержит ряд базовых классов, которые являются общими для обеих сред.</span><span class="sxs-lookup"><span data-stu-id="f7813-110">The application settings architecture is used within both ASP.NET and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="f7813-111">Наиболее важным является <xref:System.Configuration.SettingsBase>, который предоставляет доступ к параметрам через коллекцию и предоставляет низкоуровневые методы для загрузки и сохранения параметров.</span><span class="sxs-lookup"><span data-stu-id="f7813-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="f7813-112">Каждая среда реализует свой собственный класс, производный от <xref:System.Configuration.SettingsBase> для обеспечения дополнительных функциональных возможностей параметров для этой среды.</span><span class="sxs-lookup"><span data-stu-id="f7813-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="f7813-113">В приложении Windows Forms все параметры приложения должны быть определены в классе, производном от <xref:System.Configuration.ApplicationSettingsBase> класс, который добавляет следующие функции базовому классу:</span><span class="sxs-lookup"><span data-stu-id="f7813-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
- <span data-ttu-id="f7813-114">Операции загрузки и сохранения более высокого уровня</span><span class="sxs-lookup"><span data-stu-id="f7813-114">Higher-level loading and saving operations</span></span>  
  
- <span data-ttu-id="f7813-115">Поддержка параметров области пользователя</span><span class="sxs-lookup"><span data-stu-id="f7813-115">Support for user-scoped settings</span></span>  
  
- <span data-ttu-id="f7813-116">Возврат для параметров пользователя предопределенных значений по умолчанию</span><span class="sxs-lookup"><span data-stu-id="f7813-116">Reverting a user's settings to the predefined defaults</span></span>  
  
- <span data-ttu-id="f7813-117">Обновление параметров из предыдущей версии приложения</span><span class="sxs-lookup"><span data-stu-id="f7813-117">Upgrading settings from a previous application version</span></span>  
  
- <span data-ttu-id="f7813-118">Проверка параметров, либо до их изменения, либо до их сохранения</span><span class="sxs-lookup"><span data-stu-id="f7813-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="f7813-119">Параметры можно описать с помощью нескольких атрибутов, определенных в <xref:System.Configuration> пространству имен; они описаны в [атрибуты параметров приложения](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="f7813-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="f7813-120">При определении параметра его необходимо применить с помощью <xref:System.Configuration.ApplicationScopedSettingAttribute> или <xref:System.Configuration.UserScopedSettingAttribute>, которая описывает, применяется ли параметр ко всему приложению, или просто для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7813-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="f7813-121">В следующем примере кода определяется пользовательский класс параметров с одним параметром `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="f7813-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="f7813-122">Сохраняемость параметров</span><span class="sxs-lookup"><span data-stu-id="f7813-122">Settings Persistence</span></span>  
 <span data-ttu-id="f7813-123"><xref:System.Configuration.ApplicationSettingsBase> Класс не сохраняемость или загрузку параметров; это выполняет поставщик параметров, а класс, производный от <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="f7813-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="f7813-124">Если класс, производный от <xref:System.Configuration.ApplicationSettingsBase> не указывает поставщика параметров посредством <xref:System.Configuration.SettingsProviderAttribute>, а затем поставщика по умолчанию, <xref:System.Configuration.LocalFileSettingsProvider>, используется.</span><span class="sxs-lookup"><span data-stu-id="f7813-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="f7813-125">Система конфигурации, которая была первоначально выпущена с .NET Framework поддерживает предоставление статических данных конфигурации приложения через файл machine.config локального компьютера или в `app.`файл exe.config, развертываемого вместе с приложение.</span><span class="sxs-lookup"><span data-stu-id="f7813-125">The configuration system that was originally released with the .NET Framework supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="f7813-126"><xref:System.Configuration.LocalFileSettingsProvider> Класс расширяет эту встроенную поддержку одним из следующих способов:</span><span class="sxs-lookup"><span data-stu-id="f7813-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
- <span data-ttu-id="f7813-127">Параметры области приложения могут храниться в файле machine.config или `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="f7813-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="f7813-128">Файл machine.config всегда предназначен только для чтения, тогда как `app`.exe.config для большинства приложений рекомендуется использовать только для чтения с точки зрения безопасности.</span><span class="sxs-lookup"><span data-stu-id="f7813-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
- <span data-ttu-id="f7813-129">Параметры области пользователя могут храниться в файлах `app`.exe.config. В этом случае они обрабатываются как статические значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f7813-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
- <span data-ttu-id="f7813-130">Параметры области пользователя не по умолчанию хранятся в новом файле — *пользователь*.config, где *пользователь* — имя пользователя, который в данный момент выполняет приложение.</span><span class="sxs-lookup"><span data-stu-id="f7813-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="f7813-131">Можно указать значение по умолчанию для параметра области пользователя с <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="f7813-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="f7813-132">Так как во время выполнения приложения параметры области пользователя часто изменяются, файл `user`.config всегда доступен для чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="f7813-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="f7813-133">Во всех трех файлах конфигурации параметры хранятся в формате XML.</span><span class="sxs-lookup"><span data-stu-id="f7813-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="f7813-134">Элементом XML верхнего уровня для параметров области приложения является `<appSettings>`, а `<userSettings>` используется для параметров области пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7813-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="f7813-135">Файл `app`.exe.config, содержащий как параметры области приложения, так и значения по умолчанию для параметров области пользователя, выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7813-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="f7813-136">Определение элементов в разделе параметров приложения файла конфигурации см. в разделе [Схема параметров приложения](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="f7813-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="f7813-137">Привязки параметров</span><span class="sxs-lookup"><span data-stu-id="f7813-137">Settings Bindings</span></span>  
 <span data-ttu-id="f7813-138">Параметры приложения используют архитектуру привязки данных Windows Forms для обеспечения двустороннего обмена обновлениями параметров между объектом параметров и компонентами.</span><span class="sxs-lookup"><span data-stu-id="f7813-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="f7813-139">Если для создания параметров приложения и их назначения свойствам компонентов используется Visual Studio, эти привязки создаются автоматически.</span><span class="sxs-lookup"><span data-stu-id="f7813-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="f7813-140">Параметр приложения можно привязать только к компонента, поддерживающего <xref:System.Windows.Forms.IBindableComponent> интерфейс.</span><span class="sxs-lookup"><span data-stu-id="f7813-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="f7813-141">Кроме того, компонент должен реализовывать событие изменения для конкретного связанного свойства или уведомлять параметры приложений об изменении свойства с помощью <xref:System.ComponentModel.INotifyPropertyChanged> интерфейс.</span><span class="sxs-lookup"><span data-stu-id="f7813-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="f7813-142">Если компонент не реализует <xref:System.Windows.Forms.IBindableComponent> и привязка выполняется с помощью Visual Studio, то свойства привязки будут установлены в первый раз, но не будут обновляться.</span><span class="sxs-lookup"><span data-stu-id="f7813-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="f7813-143">Если компонент реализует <xref:System.Windows.Forms.IBindableComponent> , но уведомления об изменении не поддержки свойств, привязка не будет обновлять файл параметров, при изменении свойства.</span><span class="sxs-lookup"><span data-stu-id="f7813-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="f7813-144">Некоторые компоненты Windows Forms, такие как <xref:System.Windows.Forms.ToolStripItem>, не поддерживают привязку параметров.</span><span class="sxs-lookup"><span data-stu-id="f7813-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="f7813-145">Сериализация параметров</span><span class="sxs-lookup"><span data-stu-id="f7813-145">Settings Serialization</span></span>  
 <span data-ttu-id="f7813-146">Когда <xref:System.Configuration.LocalFileSettingsProvider> необходимо сохранить параметры на диск, он выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="f7813-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1. <span data-ttu-id="f7813-147">Использует отражение для проверки всех свойств, определенных для вашего <xref:System.Configuration.ApplicationSettingsBase> производного класса, поиск, примененные с помощью <xref:System.Configuration.ApplicationScopedSettingAttribute> или <xref:System.Configuration.UserScopedSettingAttribute>.</span><span class="sxs-lookup"><span data-stu-id="f7813-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2. <span data-ttu-id="f7813-148">Сериализует свойство на диск.</span><span class="sxs-lookup"><span data-stu-id="f7813-148">Serializes the property to disk.</span></span> <span data-ttu-id="f7813-149">Сначала пытается вызвать <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> или <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> на тип, связанного с <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="f7813-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="f7813-150">Если это не удается, использует XML-сериализацию.</span><span class="sxs-lookup"><span data-stu-id="f7813-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3. <span data-ttu-id="f7813-151">Распределяет параметры по файлам на основе атрибута параметра.</span><span class="sxs-lookup"><span data-stu-id="f7813-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="f7813-152">При реализации собственного класса параметров можно использовать <xref:System.Configuration.SettingsSerializeAsAttribute> чтобы отметить параметр для настраиваемой или двоичной сериализации с помощью <xref:System.Configuration.SettingsSerializeAs> перечисления.</span><span class="sxs-lookup"><span data-stu-id="f7813-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="f7813-153">Дополнительные сведения о создании собственных классов параметров в коде, см. в разделе [как: Создание параметров приложения](how-to-create-application-settings.md).</span><span class="sxs-lookup"><span data-stu-id="f7813-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="f7813-154">Расположение файлов параметров</span><span class="sxs-lookup"><span data-stu-id="f7813-154">Settings File Locations</span></span>  
 <span data-ttu-id="f7813-155">Расположение файлов `app`.exe.config и *user*.config зависит от способа установки приложения.</span><span class="sxs-lookup"><span data-stu-id="f7813-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="f7813-156">Для приложения на базе Windows Forms, скопировать на локальном компьютере `app`. exe.config будет находиться в той же папке, что базовый каталог основного исполняемого файла приложения, и *пользователя*.config будет находиться в расположение которого задается <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> свойство.</span><span class="sxs-lookup"><span data-stu-id="f7813-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="f7813-157">Для приложения, установленного с помощью [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], оба этих файла будут находиться в каталоге данных [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] в каталоге %InstallRoot%\Documents and Settings\\*имя_пользователя*\Local Settings.</span><span class="sxs-lookup"><span data-stu-id="f7813-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="f7813-158">Место хранения этих файлов будет другим, если пользователь включил перемещаемые профили, что позволит ему определять разные настройки Windows и приложения в случае использования им других компьютеров в домене.</span><span class="sxs-lookup"><span data-stu-id="f7813-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="f7813-159">В этом случае для приложений [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] и не [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] их файлы `app`.exe.config и *user*.config будут находиться в каталоге %InstallRoot%\Documents and Settings\\*имя_пользователя*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="f7813-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="f7813-160">Дополнительные сведения о том, как параметры приложения работают с новой технологией развертывания, см. в разделе [ClickOnce и параметры приложения](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="f7813-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="f7813-161">Дополнительные сведения о каталоге данных [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] см. в разделе [Доступ к локальным и удаленным данным в приложениях ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="f7813-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="f7813-162">Параметры приложения и безопасность</span><span class="sxs-lookup"><span data-stu-id="f7813-162">Application Settings and Security</span></span>  
 <span data-ttu-id="f7813-163">Параметры приложения предназначены для работы в режиме частичного доверия, то есть в среде с ограниченным доступом, которая используется по умолчанию для приложений Windows Forms, размещенных в Интернете или интрасети.</span><span class="sxs-lookup"><span data-stu-id="f7813-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="f7813-164">Для использования параметров приложения с поставщиком параметров по умолчанию специальные разрешения, выходящие за рамки частичного доверия, не нужны.</span><span class="sxs-lookup"><span data-stu-id="f7813-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="f7813-165">При использовании параметров приложения в приложении[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] файл `user`.config хранится в каталоге данных [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f7813-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="f7813-166">Размер файла `user`.config приложения не может превышать квоту каталога данных, заданную в [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f7813-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="f7813-167">Дополнительные сведения см. в разделе [ClickOnce и параметры приложения](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="f7813-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="f7813-168">Поставщики пользовательских настроек</span><span class="sxs-lookup"><span data-stu-id="f7813-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="f7813-169">В архитектуре параметров приложений, есть слабую связь между параметрами приложения класс-оболочку, производный от <xref:System.Configuration.ApplicationSettingsBase>, и связанный поставщик параметров или поставщиков, производный от <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="f7813-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="f7813-170">Эта связь определяется только <xref:System.Configuration.SettingsProviderAttribute> применен к классу-оболочке или его отдельным свойствам.</span><span class="sxs-lookup"><span data-stu-id="f7813-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="f7813-171">Если параметры, поставщик явно не указано, поставщик по умолчанию, <xref:System.Configuration.LocalFileSettingsProvider>, используется.</span><span class="sxs-lookup"><span data-stu-id="f7813-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="f7813-172">В результате такая архитектура позволяет создавать и использовать поставщиков настраиваемых параметров.</span><span class="sxs-lookup"><span data-stu-id="f7813-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="f7813-173">Предположим, что требуется разработать и использовать `SqlSettingsProvider`, то есть поставщика, который будет хранить все данные параметров в базе данных Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f7813-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="f7813-174">Ваш <xref:System.Configuration.SettingsProvider>-получит эти сведения в производном классе его `Initialize` методу в качестве параметра типа <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="f7813-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="f7813-175">Затем вы реализуете <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> метод для получения параметров из хранилища данных, и <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> для их сохранения.</span><span class="sxs-lookup"><span data-stu-id="f7813-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="f7813-176">Поставщик может использовать <xref:System.Configuration.SettingsPropertyCollection> передаваемое <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> чтобы определить имя свойства, тип и область, а также любые другие атрибуты параметров, определенных для этого свойства.</span><span class="sxs-lookup"><span data-stu-id="f7813-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="f7813-177">Вашему поставщику будет необходимо реализовать одно свойство и один метод, реализация которых может оказаться сложной.</span><span class="sxs-lookup"><span data-stu-id="f7813-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="f7813-178"><xref:System.Configuration.SettingsProvider.ApplicationName%2A> Свойство является абстрактным свойством класса <xref:System.Configuration.SettingsProvider>; оно для возврата следующее:</span><span class="sxs-lookup"><span data-stu-id="f7813-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="f7813-179">Ваш производный класс также должен реализовать метод `Initialize`, который не принимает аргументы и не возвращает значения.</span><span class="sxs-lookup"><span data-stu-id="f7813-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="f7813-180">Этот метод не определяется <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="f7813-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="f7813-181">Наконец, необходимо реализовать <xref:System.Configuration.IApplicationSettingsProvider> на поставщика, чтобы обеспечить поддержку обновления параметров, Возврат параметров по умолчанию и обновление параметров из одной версии приложения в другой.</span><span class="sxs-lookup"><span data-stu-id="f7813-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="f7813-182">После реализации и компиляции поставщика необходимо указать, что класс параметров должен использовать этого поставщика вместо значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f7813-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="f7813-183">Для этого через <xref:System.Configuration.SettingsProviderAttribute>.</span><span class="sxs-lookup"><span data-stu-id="f7813-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="f7813-184">Если применяется ко всему классу параметров поставщик используется для каждого параметра, который определяется в классе; Если применяется к отдельным параметрам архитектура параметров приложения использует этого поставщика только для этих параметров и использует <xref:System.Configuration.LocalFileSettingsProvider> для остальных.</span><span class="sxs-lookup"><span data-stu-id="f7813-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="f7813-185">В следующем примере кода показано, как указать классу параметров, что необходимо использовать пользовательского поставщика.</span><span class="sxs-lookup"><span data-stu-id="f7813-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="f7813-186">Поставщик можно вызывать одновременно из нескольких потоков, но он всегда будет выполнять запись данных в одно место хранения. Таким образом, архитектура параметров приложения будет всегда создавать только один экземпляр класса поставщика.</span><span class="sxs-lookup"><span data-stu-id="f7813-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="f7813-187">Следует убедиться, что поставщик является потокобезопасным и позволяет выполнять запись в файлы конфигурации только одному потоку за раз.</span><span class="sxs-lookup"><span data-stu-id="f7813-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="f7813-188">Поставщик должен поддерживать все атрибуты, определенные в параметры <xref:System.Configuration?displayProperty=nameWithType> пространства имен, хотя необходимо по меньшей мере поддерживать <xref:System.Configuration.ApplicationScopedSettingAttribute> и <xref:System.Configuration.UserScopedSettingAttribute>и также должен поддерживать <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="f7813-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="f7813-189">Для тех атрибутов, которые он не поддерживает, поставщик должен завершаться ошибкой без уведомления. Он не должен создавать исключение.</span><span class="sxs-lookup"><span data-stu-id="f7813-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="f7813-190">Если класс параметров использует Недопустимое сочетание атрибутов, тем не менее, такие как применение <xref:System.Configuration.ApplicationScopedSettingAttribute> и <xref:System.Configuration.UserScopedSettingAttribute> тот же параметр — ваш поставщик должен исключение и прервать операцию.</span><span class="sxs-lookup"><span data-stu-id="f7813-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f7813-191">См. также</span><span class="sxs-lookup"><span data-stu-id="f7813-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="f7813-192">Общие сведения о параметрах приложений</span><span class="sxs-lookup"><span data-stu-id="f7813-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="f7813-193">Application Settings for Custom Controls</span><span class="sxs-lookup"><span data-stu-id="f7813-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="f7813-194">ClickOnce и параметры приложения</span><span class="sxs-lookup"><span data-stu-id="f7813-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="f7813-195">Схема параметров приложения</span><span class="sxs-lookup"><span data-stu-id="f7813-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
