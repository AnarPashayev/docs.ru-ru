---
title: Знакомство с приложениями служб Windows
ms.date: 03/30/2017
f1_keywords:
- ServiceController
helpviewer_keywords:
- Windows Service applications, deploying
- OnStop method
- OnPause method
- services, about services
- Service class, Windows Service applications
- framework services, creating services
- ServiceController components, about Windows services
- Win32OwnProcess service type
- services, lifetime
- OnContinue method
- Windows Service applications, about Windows Service applications
- services, states
- service states
- WaitForStatus method
- Win32ShareProcess service type
- Windows Service applications, lifetime
ms.assetid: 1b1b5e67-3ff3-40c0-8154-322cfd6ef0ae
author: ghogen
ms.openlocfilehash: c69210c3d8f35ccab4375cfe7e49e2de147f2289
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64599875"
---
# <a name="introduction-to-windows-service-applications"></a>Знакомство с приложениями служб Windows
Службы Microsoft Windows, ранее известные как службы NT, позволяют создавать долговременные исполняемые приложения, которые запускаются в собственных сеансах Windows. Для этих служб не предусмотрен пользовательский интерфейс. Они могут запускаться автоматически при загрузке компьютера, их также можно приостанавливать и перезапускать. Благодаря этому службы идеально подходят для использования на сервере, а также в ситуациях, когда необходимы долго выполняемые процессы, которые не мешают работе пользователей на том же компьютере. Службы могут выполняться в контексте безопасности определенной учетной записи пользователя, которая отличается от учетной записи вошедшего в систему пользователя или учетной записи компьютера по умолчанию. Дополнительные сведения о службах и сеансах Windows см. в документации по Windows SDK.  
  
 Можно легко создавать службы, создавая приложение, которое устанавливается как служба. Предположим, что вам нужно отслеживать данные счетчика производительности и реагировать на пороговые значения. Можно написать и развернуть приложение-службу Windows для прослушивания данных счетчиков, а затем начать сбор и анализ данных.  
  
 Служба будет создана как проект Microsoft Visual Studio с кодом, который определяет, какие команды могут отправляться службе и какие действия должны быть выполнены при получении этих команд. Команды, которые могут быть отправлены в службу, выполняют запуск, приостановку, возобновление и остановку службы. Также можно выполнять пользовательские команды.  
  
 Созданное приложение можно установить, запустив служебную программу командной строки InstallUtil.exe и передав путь к исполняемому файлу службы. Затем вы можете использовать **диспетчер служб** для запуска, остановки, приостановки, продолжения работы и настройки службы. Можно также выполнять многие из этих задач в узле **Службы** в **обозревателе сервера** или с помощью класса <xref:System.ServiceProcess.ServiceController>.  
  
## <a name="service-applications-vs-other-visual-studio-applications"></a>Приложения-службы и другие приложения Visual Studio  
 Приложения-службы отличаются от других типов проектов следующим образом:  
  
- Скомпилированный исполняемый файл, созданный проектом приложения-службы, должен быть установлен на сервере, прежде чем этот проект можно будет использовать надлежащим способом. Вы не сможете выполнить отладку или запустить приложение службы, нажав клавиши F5 или F11. Вы не сможете сразу же запустить службу или открыть ее код. Вместо этого необходимо установить и запустить службу, а затем подключить отладчик к процессу службы. Дополнительные сведения см. в разделе [Практическое руководство. Отладка приложений служб Windows](../../../docs/framework/windows-services/how-to-debug-windows-service-applications.md).  
  
- В отличие от некоторых типов проектов для приложений-служб необходимо создавать компоненты установки. Компоненты установки устанавливают и регистрируют службу на сервере и создают для нее запись с помощью **диспетчера служб** Windows. Дополнительные сведения см. в разделе [Практическое руководство. Добавление установщиков в приложение-службу](../../../docs/framework/windows-services/how-to-add-installers-to-your-service-application.md).  
  
- Метод `Main` для приложения службы должен выдать команду запуска для служб, которые содержит проект. Метод `Run` загружает службы в **диспетчер служб** на соответствующем сервере. Если вы используете шаблон проекта **служб Windows**, этот метод создается автоматически. Обратите внимание, что загрузка службы — не то же самое, что ее запуск. Дополнительные сведения см. в разделе "Время существования службы".  
  
- Приложения-службы Windows выполняются в отдельной оконной станции, отличной от интерактивной станции вошедшего пользователя. Оконная станция — это безопасный объект, который содержит буфер обмена, набор глобальных атомов и группу объектов рабочего стола. Так как станция службы Windows не является интерактивной, диалоговые окна, отображаемые в приложении-службе Windows, не будут видны, что может привести к зависанию программы. Точно так же сообщения об ошибках должны записываться в журнал событий Windows, а не появляться в пользовательском интерфейсе.  
  
     Классы службы Windows, поддерживаемые платформой .NET Framework, не поддерживают взаимодействие с интерактивными станциями, т. е. станциями вошедшего в систему пользователя. Платформа .NET Framework также не включает классы, которые представляют станции и рабочие столы. Если служба Windows должна взаимодействовать с другими станциями, нужно получить доступ к неуправляемому API Windows. Дополнительные сведения см. в документации по Windows SDK.  
  
     Взаимодействие службы Windows с пользователем или другими станциями необходимо тщательно спроектировать, чтобы включить такие сценарии, когда вошедшего пользователя нет или у пользователя есть непредвиденный набор объектов рабочего стола. В некоторых случаях удобнее создать приложение Windows, которое будет выполняться под управлением пользователя.  
  
- Приложения-службы Windows выполняются в собственном контексте безопасности. Они запускаются, прежде чем пользователь войдет на компьютер Windows, на котором они установлены. Следует тщательно планировать, в какой учетной записи пользователя будет выполняться служба. Если это системная учетная запись, у службы будет больше разрешений и прав на доступ, чем при использовании учетной записи пользователя.  
  
## <a name="service-lifetime"></a>Время существования службы  
 Служба проходит через несколько внутренних состояний за время своего существования. Во-первых, служба устанавливается в системе, в которой она будет выполняться. Этот процесс выполняет установщики для проекта службы и загружает службу в **диспетчер служб** для этого компьютера. **Диспетчер служб** — это основное средство управления службами в Windows.  
  
 Загруженную службу необходимо запустить. Запущенная служба может выполнять свои задачи. Запустите службу из **диспетчера служб** или **обозревателя сервера** либо из кода, вызвав метод <xref:System.ServiceProcess.ServiceController.Start%2A>. Метод <xref:System.ServiceProcess.ServiceController.Start%2A> передает обработку в метод <xref:System.ServiceProcess.ServiceBase.OnStart%2A> приложения и обрабатывает любой код, определенный там.  
  
 Запущенная служба может находиться в этом состоянии бесконечно, пока она не будет остановлена или приостановлена либо работа компьютера не будет завершена. Есть три основных состояния службы: <xref:System.ServiceProcess.ServiceControllerStatus.Running>, <xref:System.ServiceProcess.ServiceControllerStatus.Paused> и <xref:System.ServiceProcess.ServiceControllerStatus.Stopped>. Служба также может сообщать состояние ожидания выполнения команды: <xref:System.ServiceProcess.ServiceControllerStatus.ContinuePending>, <xref:System.ServiceProcess.ServiceControllerStatus.PausePending>, <xref:System.ServiceProcess.ServiceControllerStatus.StartPending> или <xref:System.ServiceProcess.ServiceControllerStatus.StopPending>. Эти состояния указывают, что команда выдана (например, команда для приостановки службы или запуска службы), но еще не выполнена. Вы можете запросить свойство <xref:System.ServiceProcess.ServiceController.Status%2A>, чтобы определить, в каком состоянии находится служба, или использовать <xref:System.ServiceProcess.ServiceController.WaitForStatus%2A>, чтобы выполнить действие при наступлении любого из этих состояний.  
  
 Вы можете приостановить, остановить или возобновить работу службы из **диспетчера служб** или **обозревателя сервера** либо из кода, вызвав методы. Каждое из этих действий вызывает соответствующую процедуру в службе (<xref:System.ServiceProcess.ServiceBase.OnStop%2A>, <xref:System.ServiceProcess.ServiceBase.OnPause%2A> или <xref:System.ServiceProcess.ServiceBase.OnContinue%2A>), в которой можно определить дополнительную обработку на случай изменения состояния службы.  
  
## <a name="types-of-services"></a>Типы служб  
 Есть два типа служб, которые можно создать в Visual Studio с помощью .NET Framework. Службам, которые являются единственными службами в процессе, назначается тип <xref:System.ServiceProcess.ServiceType.Win32OwnProcess>. Службам, которые включены в процесс вместе с другими службами, назначается тип <xref:System.ServiceProcess.ServiceType.Win32ShareProcess>. Тип службы можно получить, запросив свойство <xref:System.ServiceProcess.ServiceController.ServiceType%2A>.  
  
 Вы можете время от времени встречать другие типы служб при выполнении запроса к службам, которые не были созданы в Visual Studio. Дополнительные сведения см. здесь: <xref:System.ServiceProcess.ServiceType>.  
  
## <a name="services-and-the-servicecontroller-component"></a>Службы и компонент ServiceController  
 Компонент <xref:System.ServiceProcess.ServiceController> используется для подключения к установленной службе и изменения ее состояния. С помощью компонента <xref:System.ServiceProcess.ServiceController> вы можете запускать, останавливать, приостанавливать и продолжать работу службы, а также отправлять службе пользовательские команды. Использовать компонент <xref:System.ServiceProcess.ServiceController> при создании приложения-службы не нужно. Фактически, в большинстве случаев компонент <xref:System.ServiceProcess.ServiceController> должен находиться в приложении, отдельном от приложения-службы Windows, которое определяет службу.  
  
 Для получения дополнительной информации см. <xref:System.ServiceProcess.ServiceController>.  
  
## <a name="requirements"></a>Требования  
  
- Службы должны создаваться в проекте **приложения-службы Windows** или другом проекте с поддержкой .NET Framework, который создает исполняемый файл при сборке и наследуется от класса <xref:System.ServiceProcess.ServiceBase>.  
  
- Проекты, которые содержат службы Windows, должны включать компоненты установки для проекта и его служб. Это легко сделать с помощью **окна свойств**. Дополнительные сведения см. в разделе [Практическое руководство. Добавление установщиков в приложение-службу](../../../docs/framework/windows-services/how-to-add-installers-to-your-service-application.md).  
  
## <a name="see-also"></a>См. также

- [Приложения служб Windows](../../../docs/framework/windows-services/index.md)
- [Программная архитектура приложений служб](../../../docs/framework/windows-services/service-application-programming-architecture.md)
- [Практическое руководство. Создание служб Windows](../../../docs/framework/windows-services/how-to-create-windows-services.md)
- [Практическое руководство. Установка и удаление служб](../../../docs/framework/windows-services/how-to-install-and-uninstall-services.md)
- [Практическое руководство. Запуск служб](../../../docs/framework/windows-services/how-to-start-services.md)
- [Практическое руководство. Отладка приложений служб Windows](../../../docs/framework/windows-services/how-to-debug-windows-service-applications.md)
- [Пошаговое руководство: Создание приложения служб Windows в конструкторе компонентов](../../../docs/framework/windows-services/walkthrough-creating-a-windows-service-application-in-the-component-designer.md)
- [Практическое руководство. Добавление установщиков в приложение-службу](../../../docs/framework/windows-services/how-to-add-installers-to-your-service-application.md)
