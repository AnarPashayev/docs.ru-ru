---
title: Управление версиями службы данных (службы WCF Data Services)
ms.date: 03/30/2017
helpviewer_keywords:
- versioning, WCF Data Services
- versioning [WCF Data Services]
- WCF Data Services, versioning
ms.assetid: e3e899cc-7f25-4f67-958f-063f01f79766
ms.openlocfilehash: f82ab4c98e724bbed658a6c77de9c5a5d5c3390f
ms.sourcegitcommit: 43cbde34970f5f38f30c43cd63b9c7e2e83717ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/11/2020
ms.locfileid: "81121529"
---
# <a name="data-service-versioning-wcf-data-services"></a>Управление версиями службы данных (службы WCF Data Services)
Протокол открытых данных (OData) позволяет создавать службы данных, чтобы клиенты могли получить доступ к данным в качестве ресурсов с использованием URI, основанных на модели данных. OData также поддерживает определение операций службы. После первоначального развертывания служб и, возможно, несколько раз на протяжении времени их существования возникает потребность в изменении этих служб. Причин тому немало: изменяющиеся потребности бизнеса, требования информационных технологий или необходимость решить какие-либо другие проблемы. При внесении изменений в существующую службу данных необходимо принять решение, следует ли определить новую версию службы данных и как оптимальным способом свести к минимуму воздействие на существующие клиентские приложения. Этот раздел содержит указания о том, когда и как следует создавать новую версию службы данных. В нем также описывается, как WCF Data Services обрабатывает обмен между клиентами и службами данных, поддерживающими различные версии протокола OData.

## <a name="versioning-a-wcf-data-service"></a>Управление версиями службы данных WCF
 После того как служба данных развернута и данные получены, изменения в службе данных могут стать причиной несовместимости с существующими клиентскими приложениями. Но поскольку изменения часто обусловлены общими бизнес-потребностями службы, необходимо решить, когда и как создать новую версию службы данных с минимальным воздействием на клиентские приложения.

### <a name="data-model-changes-that-recommend-a-new-data-service-version"></a>Изменения в модели данных, при внесении которых рекомендуется перейти на новую версию службы данных
 При рассмотрении вопроса о необходимости публиковать новую версию службы данных важно понимать, как различные изменения могут повлиять на клиентские приложения. Изменения в службе данных, которые могут привести к необходимости создать новую версию службы данных, можно разделить на следующие две категории.

- Изменения в контракте службы, которые включают обновления операций службы, изменения в доступности наборов сущностей (каналы), изменения версии и другие изменения поведения службы.

- Изменения в контракте данных, которые включают изменения в модели данных, форматах каналов или настройках каналов.

 В следующей таблице приведены сведения, для каких видов изменений следует рассмотреть вопрос о публикации новой версии службы данных.

|Тип изменения|Требуется новая версия|Новая версия не нужна|
|--------------------|----------------------------|----------------------------|
|Операции служб|- Добавить новый параметр<br />- Изменение типа возврата<br />- Удалить работу службы|- Удалить существующий параметр<br />- Добавить новую работу службы|
|Поведения служб|- Отключить запросы на подсчет<br />- Отврачивая проекционная поддержка<br />- Увеличение требуемой версии обслуживания данных|- Включить запросы на подсчет<br />- Включить поддержку проекции<br />- Снижение требуемой версии службы данных|
|Разрешения набора сущностей|- Ограничить разрешение сущности<br />- Изменить код ответа (новое значение первой цифры) <sup>1</sup>|- Расслабьте сущность, устанавливаемую разрешения<br />- Изменение кода ответа (то же значение первой цифры)|
|Свойства сущности|- Удалить существующее свойство или отношения<br />- Добавить неневозвратное свойство<br />- Изменить существующее свойство|- Добавить необмаженное свойство<sup>2</sup>|
|Наборы сущностей|- Удалить набор сущности|- Добавить производный тип<br />- Изменение базового типа<br />- Добавление набора сущности|
|Настройка канала|- Изменение отображения сущности-собственности||

 <sup>1</sup> Это может зависеть от того, насколько строго клиентское приложение полагается на получение определенного кода ошибки.

 <sup>2</sup> Вы можете <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> настроить `true` свойство, чтобы клиент проигнорировал любые новые свойства, отправленные службой данных, которые не определены на клиенте. Однако при выполнении вставок свойства, не включенным клиентом в запрос POST, устанавливаются в значения по умолчанию. Для обновлений все данные, существующие в неизвестном клиенту свойстве, могут быть перезаписаны значениями по умолчанию. В этом случае необходимо отправлять обновление как запрос MERGE, который используется по умолчанию. Для получения дополнительной информации [см.](managing-the-data-service-context-wcf-data-services.md)

### <a name="how-to-version-a-data-service"></a>Управление версиями службы данных
 При необходимости новая версия службы данных определяется путем создания нового экземпляра службы с обновленным контрактом службы или моделью данных. Затем новая служба предоставляется с использованием новой конечной точки URI, в чем заключается отличие от предыдущей версии. Пример:

- Старая версия: `http://services.odata.org/Northwind/v1/Northwind.svc/`

- Новая версия: `http://services.odata.org/Northwind/v2/Northwind.svc/`

 При обновлении службы данных необходимо также обновить клиенты на основе новых метаданных службы данных и использовать новый корневой URI. Если возможно, следует сохранить предыдущую версию службы данных для поддержки клиентов, которые еще не обновлены для работы с новой версией. Более старые версии службы данных можно удалить, если они больше не нужны. Необходимо рассмотреть вопрос о сохранении конечной точки URI службы данных во внешнем файле конфигурации.

## <a name="odata-protocol-versions"></a>Версии протокола OData
 По мере выпуска новых версий OData клиентские приложения могут не использовать ту же версию протокола OData, которая поддерживается службой данных. Старое клиентское приложение может получить доступ к службе данных, которая поддерживает новую версию OData. Клиентское приложение может также использовать более новую версию клиентской библиотеки WCF Data Services, которая поддерживает более новую версию OData, чем служба данных, к которой обращаются.

 Службы данных WCF используют поддержку, предоставляемую OData, для обработки таких сценариев версий. Существует также поддержка генерации и использования метаданных модели данных для создания классов обслуживания клиентских данных, когда клиент использует другую версию OData, чем используется служба обработки данных. Для получения дополнительной информации смотрите раздел Протоколная версия в статье [OData: Обзор.](https://www.odata.org/documentation/odata-version-2-0/overview/)

### <a name="version-negotiation"></a>Согласование версий
 Служба данных может быть настроена для определения самой высокой версии протокола OData, которая будет использоваться службой, независимо от запрошенной клиентом версии. Это можно сделать, <xref:System.Data.Services.Common.DataServiceProtocolVersion> указав <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> значение для <xref:System.Data.Services.DataServiceBehavior> свойства используемого службой данных. Для получения дополнительной информации [см.](configuring-the-data-service-wcf-data-services.md)

 Когда приложение использует библиотеки клиентов WCF Data Services для доступа к службе данных, библиотеки автоматически устанавливают эти заголовки на правильные значения, в зависимости от версии OData и функций, используемых в приложении. По умолчанию WCF Data Services использует самую низкую версию протокола, которая поддерживает запрашиваемую операцию.

 В следующей таблице подробно описаны версии .NET Framework и Silverlight, которые включают поддержку WCF Data Services для конкретных версий протокола OData.

|Версия протокола OData|Поддержка введена в...|
|-----------------------------------------------------------------------------------|----------------------------|
|версия 1|- .NET Framework 3.5 Service Pack 1 (SP1)<br />- Silverlight версия 3|
|версия 2|- .NET Рамочная 4<br />- Silverlight версия 4|

### <a name="metadata-versions"></a>Версии метаданных
 По умолчанию WCF Data Services использует версию 1.1 CSDL для представления модели данных. Это всегда справедливо для моделей данных, основанных на поставщике отражения или на специализированном поставщике служб данных. Но если модель данных определена с помощью платформы Entity Framework, возвращаемая версия CSDL та же, что и версия, используемая платформой Entity Framework. Версия CSDL определяется пространством имен [элемента Schema (CSDL).](/ef/ef6/modeling/designer/advanced/edmx/csdl-spec#schema-element-csdl)

 Элемент `DataServices` возвращаемых метаданных содержит также атрибут `DataServiceVersion`, имеющий то же значение, что и заголовок `DataServiceVersion` в ответном сообщении. Клиентские приложения, такие как диалоговая служба **Add Service Reference** в Visual Studio, используют эту информацию для генерации классов обслуживания данных клиентов, которые работают правильно с версией WCF Data Services, вмещающая службу данных. Для получения дополнительной информации смотрите раздел Протоколная версия в статье [OData: Обзор.](https://www.odata.org/documentation/odata-version-2-0/overview/)

## <a name="see-also"></a>См. также

- [Поставщики служб данных](data-services-providers-wcf-data-services.md)
- [Определение служб данных WCF](defining-wcf-data-services.md)
