---
title: Управление версиями службы данных (службы WCF Data Services)
ms.date: 03/30/2017
helpviewer_keywords:
- versioning, WCF Data Services
- versioning [WCF Data Services]
- WCF Data Services, versioning
ms.assetid: e3e899cc-7f25-4f67-958f-063f01f79766
ms.openlocfilehash: 818495cd2f7100f416280ce019321fed3f26aee8
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61765749"
---
# <a name="data-service-versioning-wcf-data-services"></a>Управление версиями службы данных (службы WCF Data Services)
[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] Позволяет создавать службы данных таким образом, клиенты могут обращаться к данным как к ресурсам, с использованием URI, основаны на модели данных. OData также поддерживает определение операций службы. После первоначального развертывания служб и, возможно, несколько раз на протяжении времени их существования возникает потребность в изменении этих служб. Причин тому немало: изменяющиеся потребности бизнеса, требования информационных технологий или необходимость решить какие-либо другие проблемы. При внесении изменений в существующую службу данных необходимо принять решение, следует ли определить новую версию службы данных и как оптимальным способом свести к минимуму воздействие на существующие клиентские приложения. Этот раздел содержит указания о том, когда и как следует создавать новую версию службы данных. Он также описывает, как службы данных WCF обеспечивает обмен между клиентами и службами данных, которые поддерживают разные версии протокола OData.

## <a name="versioning-a-wcf-data-service"></a>Управление версиями службы данных WCF
 После того как служба данных развернута и данные получены, изменения в службе данных могут стать причиной несовместимости с существующими клиентскими приложениями. Но поскольку изменения часто обусловлены общими бизнес-потребностями службы, необходимо решить, когда и как создать новую версию службы данных с минимальным воздействием на клиентские приложения.

### <a name="data-model-changes-that-recommend-a-new-data-service-version"></a>Изменения в модели данных, при внесении которых рекомендуется перейти на новую версию службы данных
 При рассмотрении вопроса о необходимости публиковать новую версию службы данных важно понимать, как различные изменения могут повлиять на клиентские приложения. Изменения в службе данных, которые могут привести к необходимости создать новую версию службы данных, можно разделить на следующие две категории.

- Изменения в контракте службы, которые включают обновления операций службы, изменения в доступности наборов сущностей (каналы), изменения версии и другие изменения поведения службы.

- Изменения в контракте данных, которые включают изменения в модели данных, форматах каналов или настройках каналов.

 В следующей таблице приведены сведения, для каких видов изменений следует рассмотреть вопрос о публикации новой версии службы данных.

|Тип изменения|Требуется новая версия|Новая версия не нужна|
|--------------------|----------------------------|----------------------------|
|Операции служб|-Добавьте новый параметр<br />— Изменение типа возвращаемого значения<br />— Удаление операции службы|— Удаление существующих параметров<br />— Добавление новой операции службы|
|Поведения служб|— Отключение запросов счетчиков<br />— Отключение поддержки проекции<br />-Увеличение необходимой версии службы данных|— Включение запросов счетчиков<br />— Включение поддержки проекции<br />-Уменьшение необходимой версии службы данных|
|Разрешения набора сущностей|-Ограничение разрешений набора сущностей<br />— Изменение кода ответа (новые значения первой цифры) <sup>1</sup>|-Смягчение разрешений набора сущностей<br />— Изменение кода ответа (же значения первой цифры)|
|Свойства сущности|-Удаление существующего свойства или связь<br />-Добавьте свойство, не допускающие значения NULL<br />— Изменение существующего свойства|-Добавьте свойство nullable<sup>2</sup>|
|Наборы сущностей|— Удаление набора сущностей|— Добавление производного типа<br />— Изменение базового типа<br />— Добавление набора сущностей|
|Настройка канала|— Изменения сопоставления свойств сущности||

 <sup>1</sup> это может зависеть от насколько строго клиентское приложение полагается на получение конкретный код ошибки.

 <sup>2</sup> можно задать <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> свойства `true` чтобы клиент игнорировал любые новые свойства отправленных службой данных, не определенные на клиенте. Однако при выполнении вставок свойства, не включенным клиентом в запрос POST, устанавливаются в значения по умолчанию. Для обновлений все данные, существующие в неизвестном клиенту свойстве, могут быть перезаписаны значениями по умолчанию. В этом случае необходимо отправлять обновление как запрос MERGE, который используется по умолчанию. Дополнительные сведения см. в разделе [управление контекстом службы данных](../../../../docs/framework/data/wcf/managing-the-data-service-context-wcf-data-services.md).

### <a name="how-to-version-a-data-service"></a>Управление версиями службы данных
 При необходимости новая версия службы данных определяется путем создания нового экземпляра службы с обновленным контрактом службы или моделью данных. Затем новая служба предоставляется с использованием новой конечной точки URI, в чем заключается отличие от предыдущей версии. Пример:

- Старая версия: `http://services.odata.org/Northwind/v1/Northwind.svc/`

- Новая версия: `http://services.odata.org/Northwind/v2/Northwind.svc/`

 При обновлении службы данных необходимо также обновить клиенты на основе новых метаданных службы данных и использовать новый корневой URI. Если возможно, следует сохранить предыдущую версию службы данных для поддержки клиентов, которые еще не обновлены для работы с новой версией. Более старые версии службы данных можно удалить, если они больше не нужны. Необходимо рассмотреть вопрос о сохранении конечной точки URI службы данных во внешнем файле конфигурации.

## <a name="odata-protocol-versions"></a>Версии протокола OData
 Мере выпуска новых версий OData, клиентские приложения могут не использовать же версию протокола OData, поддерживаемые службой данных. Старое клиентское приложение может получить доступ к службе данных, поддерживающей более новую версию OData. Клиентское приложение может также быть с помощью более новой версии клиентской библиотеки службы данных WCF, которая поддерживает более новая версия OData, чем служба данных, к которому выполняется обращение.

 WCF Data Services использует поддержки, обеспечиваемой OData для обработки таких сценариев управления версиями. Имеется также поддержка создания и использования метаданных модели данных для создания клиентских классов службы данных, когда клиент использует другую версию OData исторических данных использует служба. Дополнительные сведения см. в разделе [OData: Управление версиями протокола](https://go.microsoft.com/fwlink/?LinkId=186071).

### <a name="version-negotiation"></a>Согласование версий
 Служба данных может быть настроена для определения наибольшей версии протокола OData, которая будет использоваться службой, независимо от версии, запрошенной клиентом. Это можно сделать, указав <xref:System.Data.Services.Common.DataServiceProtocolVersion> значение <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> свойство <xref:System.Data.Services.DataServiceBehavior> используется службой данных. Дополнительные сведения см. в разделе [Настройка службы данных](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).

 Когда приложение использует клиентские библиотеки служб WCF Data Services для доступа к службе данных, библиотеки автоматически присваивается эти заголовки правильные значения, в зависимости от версии OData и функции, которые используются в приложении. По умолчанию WCF Data Services использует самую раннюю версию протокола, поддерживающую запрошенную операцию.

 В следующей таблице приведены версии [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] и [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)] , которые включают службы WCF Data Services поддержки определенных версий протокола OData.

|Версия протокола OData|Поддержка введена в...|
|-----------------------------------------------------------------------------------|----------------------------|
|Версия 1|-   [!INCLUDE[netfx35_long](../../../../includes/netfx35-long-md.md)] Пакет обновления 1 (SP1)<br />-   [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)] версия 3|
|Версия 2|-   [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]<br />-Обновление [!INCLUDE[netfx35_long](../../../../includes/netfx35-long-md.md)] с пакетом обновления 1. Можно загрузить и установить это обновление [центра загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=158125).<br />-   [!INCLUDE[silverlight](../../../../includes/silverlight-md.md)] версии 4|
|Версия 3|— Можно загрузить и установить предварительную версию, которая поддерживает OData версии 3 из [центра загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=203885).|

### <a name="metadata-versions"></a>Версии метаданных
 По умолчанию WCF Data Services использует CSDL версии 1.1 для представления модели данных. Это всегда справедливо для моделей данных, основанных на поставщике отражения или на специализированном поставщике служб данных. Но если модель данных определена с помощью платформы [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)], возвращаемая версия CSDL та же, что и версия, используемая платформой [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)]. Версия CSDL определяется пространством имен [элемент схемы (CSDL)](/ef/ef6/modeling/designer/advanced/edmx/csdl-spec#schema-element-csdl).

 Элемент `DataServices` возвращаемых метаданных содержит также атрибут `DataServiceVersion`, имеющий то же значение, что и заголовок `DataServiceVersion` в ответном сообщении. Клиентские приложения, такие как **Add Service Reference** диалоговое окно в Visual Studio, использовать эту информацию для формирования клиентских классов службы данных, которые правильно работают с версией службы данных WCF, в котором размещена служба данных. Дополнительные сведения см. в разделе [OData: Управление версиями протокола](https://go.microsoft.com/fwlink/?LinkId=186071).

## <a name="see-also"></a>См. также

- [Поставщики служб данных](../../../../docs/framework/data/wcf/data-services-providers-wcf-data-services.md)
- [Определение служб данных WCF](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)
