---
title: Защита служб WCF Data Services
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: e09007e786772e838a9aaa76eb8ef7a3fe2b7cca
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79174658"
---
# <a name="securing-wcf-data-services"></a>Защита служб WCF Data Services
В этой теме описаны соображения безопасности, характерные для разработки, развертывания и запуска служб данных WCF и приложений, которые получают доступ к службам, поддерживающим Протокол открытых данных (OData). Вы также должны следовать рекомендациям по созданию безопасных приложений .NET Framework.  
  
При планировании того, как обеспечить безопасность службы OData на основе данных WCF Data Services, необходимо рассмотреть как аутентификацию, процесс обнаружения и проверки личности основного, так и процесс определения того, является ли аутентифицированный принцип доступ к запрашиваемым ресурсам. Следует также рассмотреть необходимость шифрования сообщения с помощью протокола SSL.  
  
## <a name="authenticating-client-requests"></a>Проверка подлинности клиентских запросов  
WCF Data Services не осуществляет никакой собственной аутентификации, а опирается на положения аутентификации хостатора службы передачи данных. Это означает, что служба предполагает, что любой запрос, который она получает, уже был проверен ухом сети и что хост правильно определил принцип запроса надлежащим образом через интерфейсы, предоставляемые WCF Data Services. Эти параметры аутентификации и подходы подробно описаны в многокомпонентной [серии OData и Authentication.](https://devblogs.microsoft.com/odata/?s=%22OData+and+authentication%22)  
  
### <a name="authentication-options-for-a-wcf-data-service"></a>Параметры проверки подлинности для службы данных WCF  
 В приведенной ниже таблице перечислены некоторые из механизмов проверки подлинности, с помощью которых можно выполнять проверку подлинности запросов к службе данных WCF.  
  
|Параметры аутентификации|Описание|  
|----------------------------|-----------------|  
|анонимная аутентификация;|При использовании анонимной проверки подлинности по HTTP любой участник может подключиться к службе данных. Учетные данные для анонимного доступа не требуются. Используйте этот параметр, только если требуется предоставить общий доступ к службе данных.|  
|Обычная и дайджест-проверка подлинности|Для проверки подлинности необходимы учетные данные, состоящие из имени пользователя и пароля. Поддерживает проверку подлинности клиентов, отличных от Windows. **Примечание безопасности:**  Основные учетные данные аутентификации (имя пользователя и пароль) отправляются в ясной и могут быть перехвачены. При дайджест-проверке подлинности отправляется хэш, основанный на переданных учетных данных, что обеспечивает большую безопасность по сравнению с обычной проверкой подлинности. Оба эти метода проверки подлинности уязвимы для атак типа «злоумышленник в середине». При использовании этих методов проверки подлинности следует организовать зашифрованное соединение между клиентом и службой данных с помощью протокола SSL. <br /><br /> Microsoft Internet Information Services (IIS) обеспечивает реализацию как базовой, так и дайджест проверки подлинности для запросов HTTP в ASP.NET приложении. Эта реализация поставщика проверки подлинности Windows позволяет клиентскому приложению .NET Framework передавать учетные данные службе данных в HTTP-заголовке запроса, что дает возможность беспрепятственно согласовывать проверку подлинности пользователя Windows. Для получения дополнительной информации, см [Digest Аутентификация Техническая справка](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc782794(v=ws.10)).<br /><br /> Если вы хотите, чтобы служба данных использовала базовую аутентификацию на основе какой-либо пользовательской службы аутентификации, а не учетных данных Windows, необходимо реализовать пользовательский ADP.NET http Module для проверки подлинности.<br /><br /> Например, как использовать пользовательскую базовую схему аутентификации [OData and Authentication – Part 6 – Custom Basic Authentication](https://devblogs.microsoft.com/odata/odata-and-authentication-part-6-custom-basic-authentication/)с WCF Data Services, см.|  
|Проверка подлинности Windows|Обмен учетными данными на базе Windows происходит с помощью NTLM или Kerberos. Этот механизм более надежен, чем простая или дайджест-проверка подлинности, но он требует, чтобы клиент был приложением на базе Windows. IIS также предоставляет реализацию проверки подлинности Windows для запросов HTTP в ASP.NET приложении. Для получения дополнительной информации [ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/7t6b43z4(v=vs.100))см.<br /><br /> Пример того, как использовать аутентификацию Windows с помощью служб данных WCF, смотрите сообщение в блоге [OData и аутентификация - Часть 2 - Проверка подлинности Windows](https://devblogs.microsoft.com/odata/odata-and-authentication-part-2-windows-authentication/).|  
|ASP.NET формы аутентификации|Проверка подлинности с помощью форм позволяет проверять подлинность пользователей с помощью собственного кода и затем предоставлять маркер проверки подлинности в файле Cookie или в URL-адресе страницы. Проверка подлинности имени пользователя и пароля пользователя выполняется с помощью созданной вами формы входа в систему. Запросы без проверки подлинности перенаправляются на страницу входа, на которой пользователь указывает учетные данные и отправляет их. Если приложение удостоверяет подлинность запроса, система создает билет подлинности, который содержит ключ для повторного запроса данных. Для получения дополнительной [Forms Authentication Provider](https://docs.microsoft.com/previous-versions/aspnet/9wff0kyh(v=vs.100))информации см. **Примечание безопасности:**  По умолчанию файлы cookie, содержащие билет на аутентификацию форм, не защищены при использовании аутентификации форм в ASP.NET веб-приложении. Рассмотрите вариант с защитой как билета проверки подлинности, так и первоначальных учетных данных для входа с помощью SSL. <br /><br /> Пример того, как использовать проверку подлинности форм с помощью служб данных WCF, смотрите в блоге [OData и аутентификации - Часть 7 - Формы аутентификации](https://devblogs.microsoft.com/odata/odata-and-authentication-part-7-forms-authentication/).|  
|Проверка подлинности на основе утверждений|При проверке подлинности на основе утверждений служба данных опирается на доверенную услугу поставщика идентификационных данных «третьей стороны» для проверки подлинности пользователя. Поставщик удостоверений выполняет с положительным результатом проверку подлинности пользователя, который запросил доступ к ресурсам службы данных, и выдает маркер, предоставляющий доступ к запрошенным ресурсам. Затем этот маркер представляется службе данных, которая предоставляет доступ пользователю на базе отношений доверия со службой удостоверений, выдавшей маркер доступа.<br /><br /> Преимущество использования поставщика проверки подлинности на базе утверждений заключается в том, что этот метод можно использовать для проверки подлинности клиентов различных типов между несколькими доверенными доменами. Благодаря применению такого стороннего поставщика, служба данных может быть освобождена от дополнительной нагрузки по поддержке и проверке подлинности пользователей. OAuth 2.0 — это протокол проверки подлинности на основе утверждений, поддерживаемый системой контроля доступа к фабрике приложений Microsoft Azure для федеративной проверки подлинности и реализованный в виде службы. Этот протокол поддерживает службы на основе REST. Например, как использовать OAuth 2.0 с WCF Data [OData and Authentication – Part 8 – OAuth WRAP](https://devblogs.microsoft.com/odata/odata-and-authentication-part-8-oauth-wrap/)Services, см.|  
  
<a name="clientAuthentication"></a>
### <a name="authentication-in-the-client-library"></a>Проверка подлинности в клиентской библиотеке  
 По умолчанию клиентская библиотека WCF Data Services не подает учетные данные при запросе в службу OData. Если службе данных для проверки подлинности пользователя требуются учетные данные, то их можно предоставить в объекте <xref:System.Net.NetworkCredential>, доступном через свойство <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> контекста <xref:System.Data.Services.Client.DataServiceContext>, как показано в следующем примере:  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 Для получения дополнительной информации [см.](specify-client-creds-for-a-data-service-request-wcf.md)  
  
 Когда служба данных требует учетные данные входа в систему, которые нельзя указать с помощью объекта <xref:System.Net.NetworkCredential>, например маркер на базе утверждений или файл cookie, необходимо вручную задать заголовки в HTTP-запросе, обычно это заголовки `Authorization` и `Cookie`. Для получения дополнительной информации о такого сценарии аутентификации, см. [ OData and Authentication – Part 3 – ClientSide Hooks](https://devblogs.microsoft.com/odata/odata-and-authentication-part-3-clientside-hooks/) Например, как установить заголовки HTTP в сообщении запроса, [см.](how-to-set-headers-in-the-client-request-wcf-data-services.md)  
  
## <a name="impersonation"></a>Олицетворение  
 Как правило, служба данных обращается к требуемым ресурсам, например к файлам на сервере или к базе данных, с использованием учетных данных рабочего процесса, в котором размещается служба данных. При использовании олицетворения ASP.NET приложения могут выполняться с помощью идентификации Windows (учетной записи пользователя) пользователя, делающего запрос. Олицетворение обычно используется в приложениях, которым проверку подлинности пользователя обеспечивают службы IIS, а учетные данные участника используются для доступа к требуемым ресурсам. Для получения дополнительной информации см [ASP.NET.](https://docs.microsoft.com/previous-versions/aspnet/xh507fc5(v=vs.100))  
  
## <a name="configuring-data-service-authorization"></a>Настройка авторизации службы данных  
 Авторизация — это предоставление доступа к ресурсам приложений участнику или процессу, определяемому на основе успешно выполненной до этого проверки подлинности. Как правило, для выполнения операций, которые требуются клиентским приложениям, нужно лишь предоставить достаточные права пользователям службы данных.  
  
### <a name="restrict-access-to-data-service-resources"></a>Ограничение доступа к ресурсам службы данных  
 По умолчанию WCF Data Services позволяет предоставлять общий доступ к чтению и записи на ресурсах службы данных (набор сущностей и операции службы) любому пользователю, который может получить доступ к службе данных. Правила, определяющие доступ для чтения и записи, можно задавать отдельно для каждого набора сущностей, предоставляемого службой данных, а также для любой операции службы. Рекомендуется ограничить доступ для чтения и записи только теми ресурсами, которые необходимы клиентскому приложению. Для получения дополнительной информации [см.](configuring-the-data-service-wcf-data-services.md#accessRequirements)  
  
### <a name="implement-role-based-interceptors"></a>Реализация перехватчиков на базе ролей  
 Перехватчики позволяют перехватывать запросы к ресурсам службы данных до того, как они будут обработаны службой данных. Для получения дополнительной [информации см.](interceptors-wcf-data-services.md) Перехватчики позволяют принимать решения об авторизации с учетом того, какой пользователь, прошедший проверку подлинности, выполняет запрос. Например, как ограничить доступ к ресурсам службы данных на основе подлинной идентификации пользователя, [см.](how-to-intercept-data-service-messages-wcf-data-services.md)  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a>Ограничение доступа к хранилищу материализованных данных и локальным ресурсам  
 Учетным записям, используемым для доступа к хранилищу материализованных данных, должны быть предоставлены только те права в базе данных или файловой системе, которых достаточно для выполнения требований службы данных. При использовании анонимной проверки подлинности это будет учетная запись, под которой запущено приложение размещения. Для получения дополнительной информации см. [How to: Develop a WCF Data Service Running on IIS](how-to-develop-a-wcf-data-service-running-on-iis.md). При использовании олицетворения пользователям, прошедшим проверку подлинности, должен предоставляться доступ к этим ресурсам — как правило, в рамках группы Windows.  
  
## <a name="other-security-considerations"></a>Другие вопросы безопасности  
  
### <a name="secure-the-data-in-the-payload"></a>Защита полезных данных  
OData основан на протоколе HTTP. Заголовок HTTP-сообщения может содержать полезные учетные данные пользователя в зависимости от типа проверки подлинности, реализуемого службой данных. Текст сообщения может также содержать полезные пользовательские данные, которые могут требовать защиты. В обоих случаях рекомендуется защищать передачу этих сведений по сети с помощью SSL.  
  
### <a name="ignored-message-headers-and-cookies"></a>Пропускаемые заголовки сообщений и файлы cookie  
 Заголовки HTTP-запросов, отличные от объявляющих типы содержимого и расположения ресурсов, пропускаются и никогда не задаются службой данных.  
  
 Файлы cookie могут использоваться как часть схемы аутентификации, например, с ASP.NET формы аутентификации. Однако любые файлы cookie HTTP, установленные на входящий запрос, игнорируются WCF DataServices. Хозяин службы данных может обрабатывать файлы cookie, но время выполнения WCF Data Services никогда не анализирует и не возвращает файлы cookie. Библиотека клиентов WCF Data Services также не обрабатывает файлы cookie, отправленные в ответ.  
  
### <a name="custom-hosting-requirements"></a>Требования к пользовательскому размещению  
 По умолчанию WCF Data Services создается как ASP.NET приложение, размещенное в IIS. Это позволяет службе данных использовать методы защиты этой платформы. Вы можете определить службы данных WCF, которые размещаются пользовательским хостом. Для получения дополнительной [информации](hosting-the-data-service-wcf-data-services.md)см. Компоненты и платформа, на которой размещается служба данных, должны поддерживать приведенные ниже методы защиты для предотвращения атак на службу данных.  
  
- Ограничение длины URI, принимаемого в запросе к службе данных для всех возможных операций.  
  
- Ограничение размера как входящих, так и исходящих HTTP-сообщений.  
  
- Ограничение общего числа необработанных запросов в любой момент времени.  
  
- Ограничьте размер заголовков HTTP и их значения и предоставьте WCF Data Services доступ к заголовку данных.  
  
- Определение и отражение известных атак, например TCP SYN и атак повторной передачи ранее переданных сообщений.  
  
### <a name="values-are-not-further-encoded"></a>Отсутствие дальнейшего кодирования значений  
 Значения свойств, отправленные в службу данных, не кодируются службой обработки данных WCF. Например, если строковое свойство сущности содержит отформатированное HTML-содержимое, теги не кодируются службой данных в HTML. Кроме того, служба данных не выполняет дальнейшего кодирования значений свойств в ответе. Клиентская библиотека также не выполняет дополнительного кодирования.  
  
### <a name="considerations-for-client-applications"></a>Замечания по клиентским приложениям  
 Следующие соображения безопасности применяются к приложениям, которые используют клиента WCF Data Services для доступа к службам OData:  
  
- Клиентская библиотека предполагает, что протоколы, используемые для доступа к службам данных, обеспечивают требуемый уровень безопасности.  
  
- Клиентская библиотека использует значения по умолчанию для всех параметров времени ожидания и синтаксического анализа базовых транспортных стеков, предоставленных платформой.  
  
- Клиентская библиотека не считывает никакие параметры из файлов конфигурации приложения.  
  
- В клиентской библиотеке не реализовано никаких механизмов междоменного доступа. Вместо этого механизмы предоставляются базовым стеком HTTP.  
  
- Клиентская библиотека не имеет элементов пользовательского интерфейса и никогда не пытается отобразить или вывести получаемые или отправляемые данные.  
  
- Рекомендуется, чтобы клиентские приложения всегда проверяли вводимые пользователем данные, а также все данные, принимаемые от недоверенных служб.  
  
## <a name="see-also"></a>См. также раздел

- [Определение служб данных WCF](defining-wcf-data-services.md)
- [Библиотека клиентов служб данных WCF](wcf-data-services-client-library.md)
