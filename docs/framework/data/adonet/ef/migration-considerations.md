---
title: Вопросы миграции (Entity Framework)
ms.date: 03/30/2017
ms.assetid: c85b6fe8-cc32-4642-8f0a-dc0e5a695936
ms.openlocfilehash: 6453e0960af5a91e5abc40d1ce6002b7733175dd
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64641265"
---
# <a name="migration-considerations-entity-framework"></a>Вопросы миграции (Entity Framework)
Платформа [!INCLUDE[vstecado](../../../../../includes/vstecado-md.md)] Entity Framework предоставляет существующим приложениям ряд преимуществ. Наиболее важным из них является возможность использования концептуальной модели для отделения структур данных, используемых приложением, от схемы в источнике данных. Это позволяет в дальнейшем значительно упростить внесение изменений в модель хранения или сам источник данных, устранив необходимость внесения соответствующих изменений в приложение. Дополнительные сведения о преимуществах использования [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)], см. в разделе [Обзор Entity Framework](../../../../../docs/framework/data/adonet/ef/overview.md) и [модели EDM](../../../../../docs/framework/data/adonet/entity-data-model.md).  
  
 Чтобы воспользоваться преимуществами [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)], можно перенести существующее приложение для [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)]. Некоторые задачи являются общими для всех перенесенных приложений. Их число входит обновление приложения для использования [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] начиная с версии 3.5 с пакетом обновления 1 (SP1), определение моделей и сопоставления и настройка платформы Entity Framework. При переносе приложения на [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] необходимо рассмотреть ряд дополнительных вопросов. Каких именно - зависит от типа переносимого приложения и реализуемых им функциональных возможностей. Этот раздел содержит сведения, которые помогут подобрать наилучший подход при обновлении существующих приложений.  
  
## <a name="general-migration-considerations"></a>Общие рекомендации по переносу  
 Следующие соображения относятся к переносу на [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] любых приложений.  
  
- Любое приложение, использующее [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] начиная с версии 3.5 с пакетом обновления 1 можно перенести на платформу Entity Framework, до тех пор, пока платформу поддерживает поставщик данных для источника данных, используемых приложением.  
  
- Платформа Entity Framework может поддерживать не все функции поставщика источника данных, даже если поставщик поддерживает платформу Entity Framework.  
  
- Большие и сложные приложения не обязательно переносить на платформу Entity Framework сразу и полностью. При этом, однако, те части приложения, которые не используют Entity Framework, будут по-прежнему требовать изменения при изменении источника данных.  
  
- Соединение с поставщиком данных, используемое платформой Entity Framework, может быть общим для нескольких частей приложения, поскольку на платформе [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] для доступа к источнику данных служат поставщики данных [!INCLUDE[vstecado](../../../../../includes/vstecado-md.md)]. Например, поставщик SqlClient используется платформой Entity Framework для доступа к базе данных SQL Server. Дополнительные сведения см. в разделе [поставщик EntityClient для Entity Framework](../../../../../docs/framework/data/adonet/ef/entityclient-provider-for-the-entity-framework.md).  
  
## <a name="common-migration-tasks"></a>Типичные задачи переноса  
 Путь переноса существующего приложения на платформу [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] зависит как от типа приложения, так и от существующей стратегии доступа к данным. Но при переносе любого существующего приложения на платформу [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] всегда приходится выполнять следующие задачи.  
  
> [!NOTE]
>  Все эти задачи выполняются автоматически при использовании средств модели EDM, начиная с версии Visual Studio 2008. Дополнительные сведения см. в разделе [Как Использовать мастер моделей EDM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738677(v=vs.100)).  
  
1. Обновление приложения.  
  
     Проект, созданный с помощью более ранней версии Visual Studio и [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] необходимо обновить для использования с пакетом обновления 1 для Visual Studio 2008 и [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] начиная с версии 3.5 с пакетом обновления 1.  
  
2. Определение моделей и сопоставлений.  
  
     Файлы модели и сопоставления определяют сущности в концептуальной модели, структуры в источнике данных (таблицы, хранимые процедуры, представления и т. д.), а также сопоставление между сущностями и структурами источника данных. Дополнительные сведения см. в разделе [Как Вручную определите модель и файлы сопоставления](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb399785(v=vs.100)).  
  
     Типы, определенные в модели хранения, должны соответствовать именам объектов в источнике данных. Если существующее приложение предоставляет доступ к данным в виде объектов, необходимо убедиться в том, что сущности и свойства, определенные в концептуальной модели, соответствуют именам существующих классов и свойств данных. Дополнительные сведения см. в разделе [Как Настройка файлов моделирования и сопоставления для работы с настраиваемыми объектами](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738625(v=vs.100)).  
  
    > [!NOTE]
    >  Конструктор моделей EDM позволяет переименовывать сущности концептуальной модели для обеспечения соответствия существующим объектам. Дополнительные сведения см. в разделе [конструктора моделей EDM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/cc716685(v=vs.100)).  
  
3. Определение строки соединения.  
  
     В платформе [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] для выполнения запросов к концептуальной модели используется специальный формат строки соединения. В нее инкапсулированы сведения о файлах модели и сопоставления, а также о соединении с источником данных. Дополнительные сведения см. в разделе [Как Определение строки подключения](../../../../../docs/framework/data/adonet/ef/how-to-define-the-connection-string.md).  
  
4. Настройка проекта Visual Studio.  
  
     Ссылки на [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] файлы сборок и модели и сопоставления, которые необходимо добавить в проект Visual Studio. Можно также добавить в проект файлы сопоставления, чтобы выполнялось их развертывание в каталоге, указанном в строке соединения. Дополнительные сведения см. в разделе [Как Вручную настроить проект Entity Framework](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738546(v=vs.100)).  
  
## <a name="considerations-for-applications-with-existing-objects"></a>Приложения с существующими объектами  
 Начиная с [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] версии 4, [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] поддерживает традиционные объекты среды CLR (POCO), которые называются также объектами, игнорирующими сохраняемость. В большинстве случаев существующие объекты могут работать с [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] при внесении незначительных изменений. Дополнительные сведения см. в разделе [работа с сущностями POCO](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd456853(v=vs.100)). Можно также перенести приложение [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] и использовать классы данных, сформированные средствами платформы Entity Framework. Дополнительные сведения см. в разделе [Как Использовать мастер моделей EDM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738677(v=vs.100)).  
  
## <a name="considerations-for-applications-that-use-adonet-providers"></a>Приложения, использующие поставщики ADO.NET  
 [!INCLUDE[vstecado](../../../../../includes/vstecado-md.md)] Поставщики, например, SqlClient, позволяют выполнять запросы к источнику данных, возвращающие табличные данные. Данные также могут быть загружены в [!INCLUDE[vstecado](../../../../../includes/vstecado-md.md)] набора данных. В следующем списке приведены соображения по обновлению приложений, пользующихся существующими поставщиками [!INCLUDE[vstecado](../../../../../includes/vstecado-md.md)].  
  
- Отображение табличных данных с помощью модуля чтения данных.  

  Можно попробовать выполнить [!INCLUDE[esql](../../../../../includes/esql-md.md)] запросов с помощью поставщика EntityClient и перечисление по возвращенному <xref:System.Data.EntityClient.EntityDataReader> объекта. Этим способом следует пользоваться только в том случае, если приложение отображает табличные данные с помощью модуля чтения данных и не нуждается в предоставляемых [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] возможностях по материализации данных в объекты, отслеживанию изменений и выполнению обновлений. Можно продолжать пользоваться существующим кодом доступа к данным, который выполняет обновления источника данных, но пользоваться для этого соединением, доступным через свойство <xref:System.Data.EntityClient.EntityConnection.StoreConnection%2A> объекта <xref:System.Data.EntityClient.EntityConnection>. Дополнительные сведения см. в разделе [поставщик EntityClient для Entity Framework](../../../../../docs/framework/data/adonet/ef/entityclient-provider-for-the-entity-framework.md).  
  
- Работа с DataSet.  

  [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] Предоставляет многие из те же функциональные возможности DataSet, включая сохраняемость в памяти, отслеживание изменений, привязку данных и сериализацию объектов в виде XML-данных. Дополнительные сведения см. в разделе [работа с объектами](../../../../../docs/framework/data/adonet/ef/working-with-objects.md).  
  
  Если [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] не предоставляет функциональные возможности DataSet, необходимые для приложения, вы все равно можете воспользоваться преимуществами запросов LINQ с помощью [!INCLUDE[linq_dataset](../../../../../includes/linq-dataset-md.md)]. Дополнительные сведения см. в разделе [LINQ to DataSet](../../../../../docs/framework/data/adonet/linq-to-dataset.md).  
  
## <a name="considerations-for-applications-that-bind-data-to-controls"></a>Приложения с привязкой данных к элементам управления  
 [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] Позволяет инкапсулировать данные в источнике данных, такие как DataSet или элемент [!INCLUDE[vstecasp](../../../../../includes/vstecasp-md.md)] элемент управления источником данных и затем привязать элементы пользовательского интерфейса к этим элементам управления данными. В следующем списке приведены соображения, касающиеся привязки элементов управления к данным платформы Entity Framework.  
  
- Привязка данных к элементам управления.  

  При запросе концептуальной модели, [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] возвращает данные в виде объектов, которые являются экземплярами типов сущностей. Эти объекты могут быть привязаны непосредственно к элементам управления, причем такая привязка поддерживает обновления. Это означает, что изменения данных в элементе управления, например строки в <xref:System.Windows.Forms.DataGridView>, автоматически сохраняются в базу данных при <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> вызывается метод.  
  
  Если в приложении применяется перечисление результатов запроса для отображения данных в <xref:System.Windows.Forms.DataGridView> или любом другом элементе управления, поддерживающем привязку к данным, то можно модифицировать это приложение для привязки элемента управления к результату <xref:System.Data.Objects.ObjectQuery%601>.  
  
  Дополнительные сведения см. в разделе [привязка объектов к элементам управления](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738469(v=vs.100)).  
  
- Элементы управления источником данных [!INCLUDE[vstecasp](../../../../../includes/vstecasp-md.md)].  

  [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] Включает элемент управления источником данных, разработанная для упрощения привязки данных в [!INCLUDE[vstecasp](../../../../../includes/vstecasp-md.md)] веб-приложений. Дополнительные сведения см. в разделе [Обзор элемента управления EntityDataSource веб-сервера](https://docs.microsoft.com/previous-versions/aspnet/cc488502(v=vs.100)).  
  
## <a name="other-considerations"></a>Другие вопросы  
 Далее приведены вопросы, которые могут потребовать рассмотрения при переносе на платформу Entity Framework некоторых типов приложений.  
  
- Приложения, реализующие службы данных.  

  Веб-службы и приложения, созданные на основе технологии WCF, предоставляют доступ к данным из базового источника данных с использованием формата обмена сообщениями «запрос-ответ» XML. Платформа [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] поддерживает сериализацию объектов сущностей с использованием двоичной сериализации, сериализации XML или контрактной сериализации данных WCF. Двоичная сериализация и сериализация WCF поддерживают полную сериализацию графов объектов. Дополнительные сведения см. в разделе [сборка N-уровневых приложений](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896304(v=vs.100)).  
  
- Приложения, использующие XML-данные.  

  Сериализация объектов позволяет создать службы данных на платформе [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)]. Такие службы поставляют данные приложениям, принимающим XML-данные, например, интернет-приложениям на основе технологии AJAX. В этом случае попробуйте использовать [!INCLUDE[ssAstoria](../../../../../includes/ssastoria-md.md)]. Эти службы данных основаны на модели EDM и обеспечивают динамический доступ к данным сущностей через стандартные операции Representational State Transfer (REST) HTTP, такие как GET PUT и POST. Дополнительные сведения см. в разделе [Службы данных WCF 4.5](../../../../../docs/framework/data/wcf/index.md).  
  
  Платформа [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] не поддерживает собственный тип данных XML. Это означает, что если сущность сопоставлена с таблицей, имеющей XML-столбец, то эквивалентное свойство сущности для столбца XML является строковым. Объекты могут быть отсоединены и сериализованы в виде XML. Дополнительные сведения см. в разделе [сериализация объектов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738446(v=vs.100)).  
  
  Если в приложении необходимо предусмотреть возможность запрашивать XML-данных, то можно воспользоваться преимуществами запросов LINQ на основе применения LINQ to XML. Дополнительные сведения см. в разделе [LINQ to XML (C#)](../../../../csharp/programming-guide/concepts/linq/linq-to-xml.md) или [LINQ to XML (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-to-xml.md).  
  
- Приложения, сохраняющие состояние.  

  [!INCLUDE[vstecasp](../../../../../includes/vstecasp-md.md)] Веб-приложений часто необходимо поддерживать состояние веб-страницы или сеанса пользователя. Объекты в <xref:System.Data.Objects.ObjectContext> экземпляр хранятся в состоянии просмотра на клиенте или в состоянии сеанса на сервере и позднее извлекаются и повторно присоединить к новому контексту объекта. Дополнительные сведения см. в разделе [присоединение и отсоединение объектов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896271(v=vs.100)).  
  
## <a name="see-also"></a>См. также

- [Требования к развертыванию](../../../../../docs/framework/data/adonet/ef/deployment-considerations.md)
- [Терминология платформы Entity Framework](../../../../../docs/framework/data/adonet/ef/terminology.md)
