---
title: Сведения о производительности (Entity Framework)
ms.date: 03/30/2017
ms.assetid: 61913f3b-4f42-4d9b-810f-2a13c2388a4a
ms.openlocfilehash: ec7f3571f60dc7f10816cad90911e50d271a9ce1
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59324049"
---
# <a name="performance-considerations-entity-framework"></a><span data-ttu-id="8cca8-102">Сведения о производительности (Entity Framework)</span><span class="sxs-lookup"><span data-stu-id="8cca8-102">Performance Considerations (Entity Framework)</span></span>
<span data-ttu-id="8cca8-103">В этом подразделе описаны характеристики производительности платформы ADO.NET Entity Framework, а также приведены соображения по повышению производительности приложений платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="8cca8-103">This topic describes performance characteristics of the ADO.NET Entity Framework and provides some considerations to help improve the performance of Entity Framework applications.</span></span>  
  
## <a name="stages-of-query-execution"></a><span data-ttu-id="8cca8-104">Этапы выполнения запросов</span><span class="sxs-lookup"><span data-stu-id="8cca8-104">Stages of Query Execution</span></span>  
 <span data-ttu-id="8cca8-105">Чтобы лучше понять специфику производительности запросов платформы Entity Framework, необходимо разобраться с операциями, которые совершаются при выполнении запроса к концептуальной модели и при возврате данных в виде объектов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-105">In order to better understand the performance of queries in the Entity Framework, it is helpful to understand the operations that occur when a query executes against a conceptual model and returns data as objects.</span></span> <span data-ttu-id="8cca8-106">В следующей таблице описан этот ряд операций.</span><span class="sxs-lookup"><span data-stu-id="8cca8-106">The following table describes this series of operations.</span></span>  
  
|<span data-ttu-id="8cca8-107">Операция</span><span class="sxs-lookup"><span data-stu-id="8cca8-107">Operation</span></span>|<span data-ttu-id="8cca8-108">Относительные затраты</span><span class="sxs-lookup"><span data-stu-id="8cca8-108">Relative Cost</span></span>|<span data-ttu-id="8cca8-109">Частота</span><span class="sxs-lookup"><span data-stu-id="8cca8-109">Frequency</span></span>|<span data-ttu-id="8cca8-110">Комментарии</span><span class="sxs-lookup"><span data-stu-id="8cca8-110">Comments</span></span>|  
|---------------|-------------------|---------------|--------------|  
|<span data-ttu-id="8cca8-111">Загрузка метаданных</span><span class="sxs-lookup"><span data-stu-id="8cca8-111">Loading metadata</span></span>|<span data-ttu-id="8cca8-112">Средняя</span><span class="sxs-lookup"><span data-stu-id="8cca8-112">Moderate</span></span>|<span data-ttu-id="8cca8-113">По одному разу в каждом домене приложения.</span><span class="sxs-lookup"><span data-stu-id="8cca8-113">Once in each application domain.</span></span>|<span data-ttu-id="8cca8-114">Метаданные модели и сопоставления, используемые платформой Entity Framework, загружаются в <xref:System.Data.Metadata.Edm.MetadataWorkspace>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-114">Model and mapping metadata used by the Entity Framework is loaded into a <xref:System.Data.Metadata.Edm.MetadataWorkspace>.</span></span> <span data-ttu-id="8cca8-115">Эти метаданные собираются глобально и доступны другим экземплярам <xref:System.Data.Objects.ObjectContext> в том же домене приложения.</span><span class="sxs-lookup"><span data-stu-id="8cca8-115">This metadata is cached globally and is available to other instances of <xref:System.Data.Objects.ObjectContext> in the same application domain.</span></span>|  
|<span data-ttu-id="8cca8-116">Открытие подключения базы данных</span><span class="sxs-lookup"><span data-stu-id="8cca8-116">Opening the database connection</span></span>|<span data-ttu-id="8cca8-117">Средняя<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-117">Moderate<sup>1</sup></span></span>|<span data-ttu-id="8cca8-118">При необходимости.</span><span class="sxs-lookup"><span data-stu-id="8cca8-118">As needed.</span></span>|<span data-ttu-id="8cca8-119">Поскольку открытое подключение к базе данных потребляет значительные ресурсы, [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] открывает и закрывает подключение к базе данных только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="8cca8-119">Because an open connection to the database consumes a valuable resource, the [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] opens and closes the database connection only as needed.</span></span> <span data-ttu-id="8cca8-120">Кроме того, соединение можно открыть явно.</span><span class="sxs-lookup"><span data-stu-id="8cca8-120">You can also explicitly open the connection.</span></span> <span data-ttu-id="8cca8-121">Дополнительные сведения см. в разделе [Управление соединениями и транзакциями](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-121">For more information, see [Managing Connections and Transactions](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span></span>|  
|<span data-ttu-id="8cca8-122">Создание представлений...</span><span class="sxs-lookup"><span data-stu-id="8cca8-122">Generating views</span></span>|<span data-ttu-id="8cca8-123">High</span><span class="sxs-lookup"><span data-stu-id="8cca8-123">High</span></span>|<span data-ttu-id="8cca8-124">По одному разу в каждом домене приложения.</span><span class="sxs-lookup"><span data-stu-id="8cca8-124">Once in each application domain.</span></span> <span data-ttu-id="8cca8-125">(могут создаваться предварительно.)</span><span class="sxs-lookup"><span data-stu-id="8cca8-125">(Can be pre-generated.)</span></span>|<span data-ttu-id="8cca8-126">Прежде чем платформа Entity Framework сможет выполнять запросы к концептуальной модели или сохранять изменения в источнике данных, ей необходимо создать набор локальных представлений запросов для доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-126">Before the Entity Framework can execute a query against a conceptual model or save changes to the data source, it must generate a set of local query views to access the database.</span></span> <span data-ttu-id="8cca8-127">В связи с высокими затратами на создание этих представлений их можно создать заранее и добавить в проект во время разработки.</span><span class="sxs-lookup"><span data-stu-id="8cca8-127">Because of the high cost of generating these views, you can pre-generate the views and add them to the project at design-time.</span></span> <span data-ttu-id="8cca8-128">Дополнительные сведения см. в разделе [Как Предварительное создание представлений для повышения производительности запросов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896240(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-128">For more information, see [How to: Pre-Generate Views to Improve Query Performance](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896240(v=vs.100)).</span></span>|  
|<span data-ttu-id="8cca8-129">Подготовка запроса</span><span class="sxs-lookup"><span data-stu-id="8cca8-129">Preparing the query</span></span>|<span data-ttu-id="8cca8-130">Средняя<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-130">Moderate<sup>2</sup></span></span>|<span data-ttu-id="8cca8-131">Один раз для каждого уникального запроса.</span><span class="sxs-lookup"><span data-stu-id="8cca8-131">Once for each unique query.</span></span>|<span data-ttu-id="8cca8-132">Включает затраты на создание команды запроса, создание дерева команд на базе метаданных модели и сопоставления, а также определение вида возвращаемых данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-132">Includes the costs to compose the query command, generate a command tree based on model and mapping metadata, and define the shape of the returned data.</span></span> <span data-ttu-id="8cca8-133">Теперь как команды запросов Entity SQL, так и запросы LINQ кэшируются, поэтому при последующем выполнении один и тот же запрос занимает еще меньше времени.</span><span class="sxs-lookup"><span data-stu-id="8cca8-133">Because now both Entity SQL query commands and LINQ queries are cached, later executions of the same query take less time.</span></span> <span data-ttu-id="8cca8-134">Можно по-прежнему использовать скомпилированные запросы LINQ для снижения затрат при последующем выполнении, и скомпилированные запросы могут быть более эффективными, чем запросы LINQ, которые автоматически сохраняются в кэше.</span><span class="sxs-lookup"><span data-stu-id="8cca8-134">You can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="8cca8-135">Дополнительные сведения см. в разделе [компилированные запросы (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/compiled-queries-linq-to-entities.md).</span><span class="sxs-lookup"><span data-stu-id="8cca8-135">For more information, see [Compiled Queries  (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/compiled-queries-linq-to-entities.md).</span></span> <span data-ttu-id="8cca8-136">Общие сведения о выполнении запросов LINQ см. в разделе [LINQ to Entities](../../../../../docs/framework/data/adonet/ef/language-reference/linq-to-entities.md).</span><span class="sxs-lookup"><span data-stu-id="8cca8-136">For general information about LINQ query execution, see [LINQ to Entities](../../../../../docs/framework/data/adonet/ef/language-reference/linq-to-entities.md).</span></span> <span data-ttu-id="8cca8-137">**Примечание.**  Тем не менее запросы LINQ to Entities, которые применяют оператор `Enumerable.Contains` к коллекции в памяти, автоматически не кэшируются.</span><span class="sxs-lookup"><span data-stu-id="8cca8-137">**Note:**  LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="8cca8-138">Также в скомпилированных запросах LINQ не допускаются коллекции в памяти с параметрами.</span><span class="sxs-lookup"><span data-stu-id="8cca8-138">Also parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>|  
|<span data-ttu-id="8cca8-139">Выполнение запроса</span><span class="sxs-lookup"><span data-stu-id="8cca8-139">Executing the query</span></span>|<span data-ttu-id="8cca8-140">Низкий<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-140">Low<sup>2</sup></span></span>|<span data-ttu-id="8cca8-141">Один раз для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="8cca8-141">Once for each query.</span></span>|<span data-ttu-id="8cca8-142">Затраты на выполнение команды к источнику данных с помощью поставщика данных ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8cca8-142">The cost of executing the command against the data source by using the ADO.NET data provider.</span></span> <span data-ttu-id="8cca8-143">Поскольку большинство источников данных кэширует планы запросов, при последующем выполнении один и тот же запрос может занимать меньше времени.</span><span class="sxs-lookup"><span data-stu-id="8cca8-143">Because most data sources cache query plans, later executions of the same query may take even less time.</span></span>|  
|<span data-ttu-id="8cca8-144">Загрузка и проверка типов</span><span class="sxs-lookup"><span data-stu-id="8cca8-144">Loading and validating types</span></span>|<span data-ttu-id="8cca8-145">Низкий<sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-145">Low<sup>3</sup></span></span>|<span data-ttu-id="8cca8-146">Один раз для каждого элемента <xref:System.Data.Objects.ObjectContext>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-146">Once for each <xref:System.Data.Objects.ObjectContext> instance.</span></span>|<span data-ttu-id="8cca8-147">Типы загружаются и проверяются относительно типов, определенных в концептуальной модели.</span><span class="sxs-lookup"><span data-stu-id="8cca8-147">Types are loaded and validated against the types that the conceptual model defines.</span></span>|  
|<span data-ttu-id="8cca8-148">Отслеживание</span><span class="sxs-lookup"><span data-stu-id="8cca8-148">Tracking</span></span>|<span data-ttu-id="8cca8-149">Низкий<sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-149">Low<sup>3</sup></span></span>|<span data-ttu-id="8cca8-150">Один раз для каждого объекта, возвращаемого запросом.</span><span class="sxs-lookup"><span data-stu-id="8cca8-150">Once for each object that a query returns.</span></span> <span data-ttu-id="8cca8-151"><sup>4</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-151"><sup>4</sup></span></span>|<span data-ttu-id="8cca8-152">Если запрос использует параметр слияния <xref:System.Data.Objects.MergeOption.NoTracking>, то этот шаг не влияет на производительность.</span><span class="sxs-lookup"><span data-stu-id="8cca8-152">If a query uses the <xref:System.Data.Objects.MergeOption.NoTracking> merge option, this stage does not affect performance.</span></span><br /><br /> <span data-ttu-id="8cca8-153">Если запрос использует параметры слияния <xref:System.Data.Objects.MergeOption.AppendOnly>, <xref:System.Data.Objects.MergeOption.PreserveChanges> или <xref:System.Data.Objects.MergeOption.OverwriteChanges>, то результаты запроса отслеживаются в <xref:System.Data.Objects.ObjectStateManager>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-153">If the query uses the <xref:System.Data.Objects.MergeOption.AppendOnly>, <xref:System.Data.Objects.MergeOption.PreserveChanges>, or <xref:System.Data.Objects.MergeOption.OverwriteChanges> merge option, query results are tracked in the <xref:System.Data.Objects.ObjectStateManager>.</span></span> <span data-ttu-id="8cca8-154">Для каждого отслеживаемого объекта, возвращаемого запросом, создается ключ <xref:System.Data.EntityKey>, который используется для создания <xref:System.Data.Objects.ObjectStateEntry> в <xref:System.Data.Objects.ObjectStateManager>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-154">An <xref:System.Data.EntityKey> is generated for each tracked object that the query returns and is used to create an <xref:System.Data.Objects.ObjectStateEntry> in the <xref:System.Data.Objects.ObjectStateManager>.</span></span> <span data-ttu-id="8cca8-155">Если для <xref:System.Data.Objects.ObjectStateEntry> можно найти существующий объект <xref:System.Data.EntityKey>, то возвращается существующий объект.</span><span class="sxs-lookup"><span data-stu-id="8cca8-155">If an existing <xref:System.Data.Objects.ObjectStateEntry> can be found for the <xref:System.Data.EntityKey>, the existing object is returned.</span></span> <span data-ttu-id="8cca8-156">Если используется параметр <xref:System.Data.Objects.MergeOption.PreserveChanges> или <xref:System.Data.Objects.MergeOption.OverwriteChanges>, то объект обновляется до возвращения.</span><span class="sxs-lookup"><span data-stu-id="8cca8-156">If the <xref:System.Data.Objects.MergeOption.PreserveChanges>, or <xref:System.Data.Objects.MergeOption.OverwriteChanges> option is used, the object is updated before it is returned.</span></span><br /><br /> <span data-ttu-id="8cca8-157">Дополнительные сведения см. в разделе [разрешение идентичности, управление состоянием и отслеживание изменений](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896269(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-157">For more information, see [Identity Resolution, State Management, and Change Tracking](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896269(v=vs.100)).</span></span>|  
|<span data-ttu-id="8cca8-158">Материализация объектов</span><span class="sxs-lookup"><span data-stu-id="8cca8-158">Materializing the objects</span></span>|<span data-ttu-id="8cca8-159">Средняя<sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-159">Moderate<sup>3</sup></span></span>|<span data-ttu-id="8cca8-160">Один раз для каждого объекта, возвращаемого запросом.</span><span class="sxs-lookup"><span data-stu-id="8cca8-160">Once for each object that a query returns.</span></span> <span data-ttu-id="8cca8-161"><sup>4</sup></span><span class="sxs-lookup"><span data-stu-id="8cca8-161"><sup>4</sup></span></span>|<span data-ttu-id="8cca8-162">Процесс считывания возвращенного объекта <xref:System.Data.Common.DbDataReader>, создания объектов и установки значений свойств, основанных на значениях в каждом экземпляре класса <xref:System.Data.Common.DbDataRecord>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-162">The process of reading the returned <xref:System.Data.Common.DbDataReader> object and creating objects and setting property values that are based on the values in each instance of the <xref:System.Data.Common.DbDataRecord> class.</span></span> <span data-ttu-id="8cca8-163">Если объект уже существует в классе <xref:System.Data.Objects.ObjectContext> и в запросе используются параметры слияния <xref:System.Data.Objects.MergeOption.AppendOnly> или <xref:System.Data.Objects.MergeOption.PreserveChanges>, то этот шаг не влияет на производительность.</span><span class="sxs-lookup"><span data-stu-id="8cca8-163">If the object already exists in the <xref:System.Data.Objects.ObjectContext> and the query uses the <xref:System.Data.Objects.MergeOption.AppendOnly> or <xref:System.Data.Objects.MergeOption.PreserveChanges> merge options, this stage does not affect performance.</span></span> <span data-ttu-id="8cca8-164">Дополнительные сведения см. в разделе [разрешение идентичности, управление состоянием и отслеживание изменений](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896269(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-164">For more information, see [Identity Resolution, State Management, and Change Tracking](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896269(v=vs.100)).</span></span>|  
  
 <span data-ttu-id="8cca8-165"><sup>1</sup> при поставщик источника данных реализована организация пулов соединений, затраты на открытие подключения распространяется по всему пулу.</span><span class="sxs-lookup"><span data-stu-id="8cca8-165"><sup>1</sup> When a data source provider implements connection pooling, the cost of opening a connection is distributed across the pool.</span></span> <span data-ttu-id="8cca8-166">Поставщик .NET для SQL Server поддерживает организацию пулов соединений.</span><span class="sxs-lookup"><span data-stu-id="8cca8-166">The .NET Provider for SQL Server supports connection pooling.</span></span>  
  
 <span data-ttu-id="8cca8-167"><sup>2</sup> затраты возрастают с повышением сложности запросов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-167"><sup>2</sup> Cost increases with increased query complexity.</span></span>  
  
 <span data-ttu-id="8cca8-168"><sup>3</sup> общие затраты возрастают пропорционально числу объектов, возвращенных запросом.</span><span class="sxs-lookup"><span data-stu-id="8cca8-168"><sup>3</sup> Total cost increases proportional to the number of objects returned by the query.</span></span>  
  
 <span data-ttu-id="8cca8-169"><sup>4</sup> эти издержки не нужны для запросов EntityClient, поскольку они возвращают <xref:System.Data.EntityClient.EntityDataReader> вместо объектов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-169"><sup>4</sup> This overhead is not required for EntityClient queries because EntityClient queries return an <xref:System.Data.EntityClient.EntityDataReader> instead of objects.</span></span> <span data-ttu-id="8cca8-170">Дополнительные сведения см. в разделе [поставщик EntityClient для Entity Framework](../../../../../docs/framework/data/adonet/ef/entityclient-provider-for-the-entity-framework.md).</span><span class="sxs-lookup"><span data-stu-id="8cca8-170">For more information, see [EntityClient Provider for the Entity Framework](../../../../../docs/framework/data/adonet/ef/entityclient-provider-for-the-entity-framework.md).</span></span>  
  
## <a name="additional-considerations"></a><span data-ttu-id="8cca8-171">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="8cca8-171">Additional Considerations</span></span>  
 <span data-ttu-id="8cca8-172">Ниже приведены дополнительные соображения по факторам, способным влиять на производительность приложений Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="8cca8-172">The following are other considerations that may affect the performance of Entity Framework applications.</span></span>  
  
### <a name="query-execution"></a><span data-ttu-id="8cca8-173">Выполнение запроса</span><span class="sxs-lookup"><span data-stu-id="8cca8-173">Query Execution</span></span>  
 <span data-ttu-id="8cca8-174">Поскольку запросы могут быть ресурсоемкими, учитывайте, в каком участке кода и на каком компьютере выполняется запрос.</span><span class="sxs-lookup"><span data-stu-id="8cca8-174">Because queries can be resource intensive, consider at what point in your code and on what computer a query is executed.</span></span>  
  
#### <a name="deferred-versus-immediate-execution"></a><span data-ttu-id="8cca8-175">Отложенное или немедленное выполнение</span><span class="sxs-lookup"><span data-stu-id="8cca8-175">Deferred versus immediate execution</span></span>  
 <span data-ttu-id="8cca8-176">При создании запроса <xref:System.Data.Objects.ObjectQuery%601> или LINQ запрос может выполняться не сразу.</span><span class="sxs-lookup"><span data-stu-id="8cca8-176">When you create an <xref:System.Data.Objects.ObjectQuery%601> or LINQ query, the query may not be executed immediately.</span></span> <span data-ttu-id="8cca8-177">Выполнение запроса откладывается до тех пор, пока не понадобятся его результаты, например результаты перечисления `foreach` (C#) или `For Each` (Visual Basic), либо если запрос должен заполнить коллекцию <xref:System.Collections.Generic.List%601>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-177">Query execution is deferred until the results are needed, such as during a `foreach` (C#) or `For Each` (Visual Basic) enumeration or when it is assigned to fill a <xref:System.Collections.Generic.List%601> collection.</span></span> <span data-ttu-id="8cca8-178">Выполнение запроса начинается немедленно при вызове метода <xref:System.Data.Objects.ObjectQuery%601.Execute%2A> в <xref:System.Data.Objects.ObjectQuery%601> либо при вызове метода LINQ, возвращающего одноэлементный запрос, например <xref:System.Linq.Enumerable.First%2A> или <xref:System.Linq.Enumerable.Any%2A>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-178">Query execution begins immediately when you call the <xref:System.Data.Objects.ObjectQuery%601.Execute%2A> method on an <xref:System.Data.Objects.ObjectQuery%601> or when you call a LINQ method that returns a singleton query, such as <xref:System.Linq.Enumerable.First%2A> or <xref:System.Linq.Enumerable.Any%2A>.</span></span> <span data-ttu-id="8cca8-179">Дополнительные сведения см. в разделе [запросы объектов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896241(v=vs.100)) и [выполнение запросов (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/query-execution.md).</span><span class="sxs-lookup"><span data-stu-id="8cca8-179">For more information, see [Object Queries](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896241(v=vs.100)) and [Query Execution (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/query-execution.md).</span></span>  
  
#### <a name="client-side-execution-of-linq-queries"></a><span data-ttu-id="8cca8-180">Выполнение запросов LINQ на стороне клиента</span><span class="sxs-lookup"><span data-stu-id="8cca8-180">Client-side execution of LINQ queries</span></span>  
 <span data-ttu-id="8cca8-181">Хотя запрос LINQ выполняется на том компьютере, где размещен источник данных, некоторые части запроса LINQ могут обрабатываться на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="8cca8-181">Although the execution of a LINQ query occurs on the computer that hosts the data source, some parts of a LINQ query may be evaluated on the client computer.</span></span> <span data-ttu-id="8cca8-182">Дополнительные сведения см. в разделе выполнения Store [выполнение запросов (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/query-execution.md).</span><span class="sxs-lookup"><span data-stu-id="8cca8-182">For more information, see the Store Execution section of [Query Execution (LINQ to Entities)](../../../../../docs/framework/data/adonet/ef/language-reference/query-execution.md).</span></span>  
  
### <a name="query-and-mapping-complexity"></a><span data-ttu-id="8cca8-183">Сложность запросов и сопоставления</span><span class="sxs-lookup"><span data-stu-id="8cca8-183">Query and Mapping Complexity</span></span>  
 <span data-ttu-id="8cca8-184">Сложность отдельных запросов и сопоставления в модели сущности значительно влияет на производительность запросов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-184">The complexity of individual queries and of the mapping in the entity model will have a significant effect on query performance.</span></span>  
  
#### <a name="mapping-complexity"></a><span data-ttu-id="8cca8-185">Сложность сопоставления</span><span class="sxs-lookup"><span data-stu-id="8cca8-185">Mapping complexity</span></span>  
 <span data-ttu-id="8cca8-186">Модели, более сложные, чем простое однозначное сопоставление между сущностями в концептуальной модели и таблицах в режиме хранилища, приводят к созданию более сложных команд, чем модели с однозначным сопоставлением.</span><span class="sxs-lookup"><span data-stu-id="8cca8-186">Models that are more complex than a simple one-to-one mapping between entities in the conceptual model and tables in the storage model generate more complex commands than models that have a one-to-one mapping.</span></span>  
  
#### <a name="query-complexity"></a><span data-ttu-id="8cca8-187">Сложность запросов</span><span class="sxs-lookup"><span data-stu-id="8cca8-187">Query complexity</span></span>  
 <span data-ttu-id="8cca8-188">Запросы, требующие большого числа соединений в командах, выполняемых с источником данных или возвращающих большой объем данных, могут влиять на производительность следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8cca8-188">Queries that require a large number of joins in the commands that are executed against the data source or that return a large amount of data may affect performance in the following ways:</span></span>  
  
-   <span data-ttu-id="8cca8-189">Запросы к концептуальной модели, которые кажутся простыми, могут приводить к выполнению более сложных запросов к источнику данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-189">Queries against a conceptual model that seem simple may result in the execution of more complex queries against the data source.</span></span> <span data-ttu-id="8cca8-190">Это может происходить как следствие преобразования платформой Entity Framework запроса к концептуальной модели в эквивалентный запрос к источнику данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-190">This can occur because the Entity Framework translates a query against a conceptual model into an equivalent query against the data source.</span></span> <span data-ttu-id="8cca8-191">Если один набор сущностей, заданный в концептуальной модели, сопоставляется с несколькими таблицами источника данных либо если связь между сущностями сопоставлена с соединяемой таблицей, то команда запроса к источнику данных может потребовать одного или нескольких соединений.</span><span class="sxs-lookup"><span data-stu-id="8cca8-191">When a single entity set in the conceptual model maps to more than one table in the data source, or when a relationship between entities is mapped to a join table, the query command executed against the data source query may require one or more joins.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="8cca8-192">Чтобы просмотреть команды, выполняемые по источнику данных для данного запроса, воспользуйтесь методом <xref:System.Data.Objects.ObjectQuery.ToTraceString%2A> классов <xref:System.Data.Objects.ObjectQuery%601> или <xref:System.Data.EntityClient.EntityCommand>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-192">Use the <xref:System.Data.Objects.ObjectQuery.ToTraceString%2A> method of the <xref:System.Data.Objects.ObjectQuery%601> or <xref:System.Data.EntityClient.EntityCommand> classes to view the commands that are executed against the data source for a given query.</span></span> <span data-ttu-id="8cca8-193">Дополнительные сведения см. в разделе [Как Просмотреть команды Store](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896348(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-193">For more information, see [How to: View the Store Commands](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896348(v=vs.100)).</span></span>  
  
-   <span data-ttu-id="8cca8-194">Вложенные запросы Entity SQL могут создавать соединения на сервере, а также возвращать большое количество строк.</span><span class="sxs-lookup"><span data-stu-id="8cca8-194">Nested Entity SQL queries may create joins on the server and can return a large number of rows.</span></span>  
  
     <span data-ttu-id="8cca8-195">Далее приведен пример вложенного запроса в предложении проекции:</span><span class="sxs-lookup"><span data-stu-id="8cca8-195">The following is an example of a nested query in a projection clause:</span></span>  
  
    ```  
    SELECT c, (SELECT c, (SELECT c FROM AdventureWorksModel.Vendor AS c  ) As Inner2   
        FROM AdventureWorksModel.JobCandidate AS c  ) As Inner1   
        FROM AdventureWorksModel.EmployeeDepartmentHistory AS c  
    ```  
  
     <span data-ttu-id="8cca8-196">Кроме того, подобные запросы заставляют конвейер запросов создавать одиночный запрос с дублированием объектов во вложенных запросах.</span><span class="sxs-lookup"><span data-stu-id="8cca8-196">In addition, such queries cause the query pipeline to generate a single query with duplication of objects across nested queries.</span></span> <span data-ttu-id="8cca8-197">В результате одиночный столбец может дублироваться несколько раз.</span><span class="sxs-lookup"><span data-stu-id="8cca8-197">Because of this, a single column may be duplicated multiple times.</span></span> <span data-ttu-id="8cca8-198">В некоторых базах данных, в том числе SQL Server, это может приводить к чрезмерному значительному разрастанию таблицы TempDB, что снижает производительность сервера.</span><span class="sxs-lookup"><span data-stu-id="8cca8-198">On some databases, including SQL Server, this can cause the TempDB table to grow very large, which can decrease server performance.</span></span> <span data-ttu-id="8cca8-199">Вложенные запросы следует выполнять с осторожностью.</span><span class="sxs-lookup"><span data-stu-id="8cca8-199">Care should be taken when you execute nested queries.</span></span>  
  
-   <span data-ttu-id="8cca8-200">Любые запросы, возвращающие большие объемы данных, могут снижать производительность, если клиент выполняет операции, использующие ресурсы пропорционально объему результирующего набора.</span><span class="sxs-lookup"><span data-stu-id="8cca8-200">Any queries that return a large amount of data can cause decreased performance if the client is performing operations that consume resources in a way that is proportional to the size of the result set.</span></span> <span data-ttu-id="8cca8-201">В таких случаях, возможно, стоит ограничить объем данных, возвращаемых запросом.</span><span class="sxs-lookup"><span data-stu-id="8cca8-201">In such cases, you should consider limiting the amount of data returned by the query.</span></span> <span data-ttu-id="8cca8-202">Дополнительные сведения см. в разделе [Как Постранично просмотреть результаты запроса](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738702(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-202">For more information, see [How to: Page Through Query Results](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738702(v=vs.100)).</span></span>  
  
 <span data-ttu-id="8cca8-203">Любые команды, автоматически созданные платформой Entity Framework, могут оказываться сложнее аналогичных команд, написанных вручную разработчиком базы данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-203">Any commands automatically generated by the Entity Framework may be more complex than similar commands written explicitly by a database developer.</span></span> <span data-ttu-id="8cca8-204">Если требуется явный контроль над командами, выполняемыми с источником данных, подумайте об определении сопоставления с возвращающей табличное значение функцией или хранимой процедурой.</span><span class="sxs-lookup"><span data-stu-id="8cca8-204">If you need explicit control over the commands executed against your data source, consider defining a mapping to a table-valued function or stored procedure.</span></span>  
  
#### <a name="relationships"></a><span data-ttu-id="8cca8-205">Отношения</span><span class="sxs-lookup"><span data-stu-id="8cca8-205">Relationships</span></span>  
 <span data-ttu-id="8cca8-206">Для оптимальной производительности запросов необходимо определить связи между сущностями как в виде ассоциаций в модели сущности, так и в виде логических связей в источнике данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-206">For optimal query performance, you must define relationships between entities both as associations in the entity model and as logical relationships in the data source.</span></span>  
  
### <a name="query-paths"></a><span data-ttu-id="8cca8-207">Пути запроса</span><span class="sxs-lookup"><span data-stu-id="8cca8-207">Query Paths</span></span>  
 <span data-ttu-id="8cca8-208">По умолчанию при выполнении запроса <xref:System.Data.Objects.ObjectQuery%601> связанные объекты не возвращаются (хотя возвращаются объекты, представляющие сами связи).</span><span class="sxs-lookup"><span data-stu-id="8cca8-208">By default, when you execute an <xref:System.Data.Objects.ObjectQuery%601>, related objects are not returned (although objects that represent the relationships themselves are).</span></span> <span data-ttu-id="8cca8-209">Связанные объекты можно загрузить одним из трех способов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-209">You can load related objects in one of three ways:</span></span>  
  
1. <span data-ttu-id="8cca8-210">Задайте путь запроса до выполнения <xref:System.Data.Objects.ObjectQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-210">Set the query path before the <xref:System.Data.Objects.ObjectQuery%601> is executed.</span></span>  
  
2. <span data-ttu-id="8cca8-211">Вызовите метод `Load` для свойства навигации, доступного для объекта.</span><span class="sxs-lookup"><span data-stu-id="8cca8-211">Call the `Load` method on the navigation property that the object exposes.</span></span>  
  
3. <span data-ttu-id="8cca8-212">Установите параметр <xref:System.Data.Objects.ObjectContextOptions.LazyLoadingEnabled%2A> объекта <xref:System.Data.Objects.ObjectContext> в значение `true`.</span><span class="sxs-lookup"><span data-stu-id="8cca8-212">Set the <xref:System.Data.Objects.ObjectContextOptions.LazyLoadingEnabled%2A> option on the <xref:System.Data.Objects.ObjectContext> to `true`.</span></span> <span data-ttu-id="8cca8-213">Обратите внимание, что это выполняется автоматически при создании кода уровня объекта с [конструктора моделей EDM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/cc716685(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-213">Note that this is done automatically when you generate object-layer code with the [Entity Data Model Designer](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/cc716685(v=vs.100)).</span></span> <span data-ttu-id="8cca8-214">Дополнительные сведения см. в разделе [созданные общие сведения о коде](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/cc982041(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-214">For more information see [Generated Code Overview](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/cc982041(v=vs.100)).</span></span>  
  
 <span data-ttu-id="8cca8-215">При выборе параметра помните, что придется соблюдать баланс между числом запросов к базе данных и объемом данных, возвращаемых в одном запросе.</span><span class="sxs-lookup"><span data-stu-id="8cca8-215">When you consider which option to use, be aware that there is a tradeoff between the number of requests against the database and the amount of data returned in a single query.</span></span> <span data-ttu-id="8cca8-216">Дополнительные сведения см. в разделе [загрузка связанных объектов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896272(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-216">For more information, see [Loading Related Objects](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896272(v=vs.100)).</span></span>  
  
#### <a name="using-query-paths"></a><span data-ttu-id="8cca8-217">Использование путей запроса</span><span class="sxs-lookup"><span data-stu-id="8cca8-217">Using query paths</span></span>  
 <span data-ttu-id="8cca8-218">Пути запроса определяют граф объектов, возвращаемых запросом.</span><span class="sxs-lookup"><span data-stu-id="8cca8-218">Query paths define the graph of objects that a query returns.</span></span> <span data-ttu-id="8cca8-219">При указании пути запроса для возврата всех определенных в нем объектов требуется только один запрос к базе данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-219">When you define a query path, only a single request against the database is required to return all objects that the path defines.</span></span> <span data-ttu-id="8cca8-220">Использование путей запроса может привести к тому, что над источником данных будут выполняться сложные команды из, на первый взгляд, простых запросов к объектам.</span><span class="sxs-lookup"><span data-stu-id="8cca8-220">Using query paths can result in complex commands being executed against the data source from seemingly simple object queries.</span></span> <span data-ttu-id="8cca8-221">Происходит это потому, что для возвращения связанных объектов в рамках одного запроса требуется одно или несколько соединений.</span><span class="sxs-lookup"><span data-stu-id="8cca8-221">This occurs because one or more joins are required to return related objects in a single query.</span></span> <span data-ttu-id="8cca8-222">Сложность будет выше в запросах к сложным моделям сущностей, таким как, например, сущность с наследованием или путь, содержащий связи «многие ко многим».</span><span class="sxs-lookup"><span data-stu-id="8cca8-222">This complexity is greater in queries against a complex entity model, such as an entity with inheritance or a path that includes many-to-many relationships.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8cca8-223">Используйте метод <xref:System.Data.Objects.ObjectQuery.ToTraceString%2A>, чтобы увидеть команду, которая будет сформирована методом <xref:System.Data.Objects.ObjectQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-223">Use the <xref:System.Data.Objects.ObjectQuery.ToTraceString%2A> method to see the command that will be generated by an <xref:System.Data.Objects.ObjectQuery%601>.</span></span> <span data-ttu-id="8cca8-224">Дополнительные сведения см. в разделе [Как Просмотреть команды Store](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896348(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-224">For more information, see [How to: View the Store Commands](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896348(v=vs.100)).</span></span>  
  
 <span data-ttu-id="8cca8-225">Когда путь запроса содержит слишком много связанных объектов или эти объекты содержат слишком много строковых данных, источник данных может оказаться не в состоянии выполнить запрос.</span><span class="sxs-lookup"><span data-stu-id="8cca8-225">When a query path includes too many related objects or the objects contain too much row data, the data source might be unable to complete the query.</span></span> <span data-ttu-id="8cca8-226">Это происходит, если запросу требуется промежуточное временное хранилище, которое превышает возможности источника данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-226">This occurs if the query requires intermediate temporary storage that exceeds the capabilities of the data source.</span></span> <span data-ttu-id="8cca8-227">В этом случае можно снизить сложность запроса к источнику данных путем явной загрузки связанных объектов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-227">When this occurs, you can reduce the complexity of the data source query by explicitly loading related objects.</span></span>  
  
#### <a name="explicitly-loading-related-objects"></a><span data-ttu-id="8cca8-228">Явная загрузка связанных объектов</span><span class="sxs-lookup"><span data-stu-id="8cca8-228">Explicitly loading related objects</span></span>  
 <span data-ttu-id="8cca8-229">Явно загрузить связанные объекты можно, вызвав метод `Load` для свойства навигации, возвращающего <xref:System.Data.Objects.DataClasses.EntityCollection%601> или <xref:System.Data.Objects.DataClasses.EntityReference%601>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-229">You can explicitly load related objects by calling the `Load` method on a navigation property that returns an <xref:System.Data.Objects.DataClasses.EntityCollection%601> or <xref:System.Data.Objects.DataClasses.EntityReference%601>.</span></span> <span data-ttu-id="8cca8-230">При явной загрузке объектов требуется выполнять цикл обмена данными с базой данных при каждом вызове метода `Load`.</span><span class="sxs-lookup"><span data-stu-id="8cca8-230">Explicitly loading objects requires a round-trip to the database every time `Load` is called.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8cca8-231">Если при циклической обработке коллекции возвращенных объектов, например при использовании инструкции `Load` (`foreach` в Visual Basic), вызывается метод `For Each`, поставщик для каждого конкретного источника данных должен поддерживать несколько активных результирующих наборов на одном соединении.</span><span class="sxs-lookup"><span data-stu-id="8cca8-231">if you call `Load` while looping through a collection of returned objects, such as when you use the `foreach` statement (`For Each` in Visual Basic), the data source-specific provider must support multiple active results sets on a single connection.</span></span> <span data-ttu-id="8cca8-232">Для базы данных SQL Server в строке подключения поставщика необходимо указать значение `MultipleActiveResultSets = true`.</span><span class="sxs-lookup"><span data-stu-id="8cca8-232">For a SQL Server database, you must specify a value of `MultipleActiveResultSets = true` in the provider connection string.</span></span>  
  
 <span data-ttu-id="8cca8-233">Можно также использовать метод <xref:System.Data.Objects.ObjectContext.LoadProperty%2A>, если сущности не имеют свойств <xref:System.Data.Objects.DataClasses.EntityCollection%601> и <xref:System.Data.Objects.DataClasses.EntityReference%601>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-233">You can also use the <xref:System.Data.Objects.ObjectContext.LoadProperty%2A> method when there is no <xref:System.Data.Objects.DataClasses.EntityCollection%601> or <xref:System.Data.Objects.DataClasses.EntityReference%601> properties on entities.</span></span> <span data-ttu-id="8cca8-234">Это может оказаться полезным в том случае, если используются сущности POCO.</span><span class="sxs-lookup"><span data-stu-id="8cca8-234">This is useful when you are using POCO entities.</span></span>  
  
 <span data-ttu-id="8cca8-235">Хотя явная загрузка связанных объектов сократит число соединений и объем избыточных данных, метод `Load` потребует повторного соединения к базе данных, что может привести к повышении накладных расходов при загрузке большого числа объектов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-235">Although explicitly loading related objects will reduce the number of joins and reduced the amount of redundant data, `Load` requires repeated connections to the database, which can become costly when explicitly loading a large number of objects.</span></span>  
  
### <a name="saving-changes"></a><span data-ttu-id="8cca8-236">Сохранение изменений</span><span class="sxs-lookup"><span data-stu-id="8cca8-236">Saving Changes</span></span>  
 <span data-ttu-id="8cca8-237">При вызове метода <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> для <xref:System.Data.Objects.ObjectContext> для каждого добавленного, обновленного или удаленного объекта в контексте создается отдельная команда создания, обновления или удаления.</span><span class="sxs-lookup"><span data-stu-id="8cca8-237">When you call the <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> method on an <xref:System.Data.Objects.ObjectContext>, a separate create, update, or delete command is generated for every added, updated, or deleted object in the context.</span></span> <span data-ttu-id="8cca8-238">Эти команды выполняются для источника данных в единой транзакции.</span><span class="sxs-lookup"><span data-stu-id="8cca8-238">These commands are executed on the data source in a single transaction.</span></span> <span data-ttu-id="8cca8-239">Как и в случае с запросами, производительность операций создания, обновления и удаления зависит от сложности сопоставления в концептуальной модели.</span><span class="sxs-lookup"><span data-stu-id="8cca8-239">As with queries, the performance of create, update, and delete operations depends on the complexity of the mapping in the conceptual model.</span></span>  
  
### <a name="distributed-transactions"></a><span data-ttu-id="8cca8-240">Распределенные транзакции</span><span class="sxs-lookup"><span data-stu-id="8cca8-240">Distributed Transactions</span></span>  
 <span data-ttu-id="8cca8-241">Операции в явной транзакции, требующие ресурсов, управляемых координатором распределенных транзакций (DTC), будут гораздо затратнее, чем схожая операция, не требующая его использования.</span><span class="sxs-lookup"><span data-stu-id="8cca8-241">Operations in an explicit transaction that require resources that are managed by the distributed transaction coordinator (DTC) will be much more expensive than a similar operation that does not require the DTC.</span></span> <span data-ttu-id="8cca8-242">Повышение уровня явных транзакций до DTC будет происходить в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="8cca8-242">Promotion to the DTC will occur in the following situations:</span></span>  
  
-   <span data-ttu-id="8cca8-243">Явная транзакция с операцией для базы данных SQL Server 2000 или другого источника данных, который всегда повышает уровень явных транзакций до DTC.</span><span class="sxs-lookup"><span data-stu-id="8cca8-243">An explicit transaction with an operation against a SQL Server 2000 database or other data source that always promote explicit transactions to the DTC.</span></span>  
  
-   <span data-ttu-id="8cca8-244">Явная транзакция с операцией для SQL Server 2005, если соединение управляется [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cca8-244">An explicit transaction with an operation against SQL Server 2005 when the connection is managed by the [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)].</span></span> <span data-ttu-id="8cca8-245">Причина этого заключается в том, что SQL Server 2005 передает транзакцию в DTC при каждом закрытии и повторном открытии соединения в пределах одной транзакции, что является поведением [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8cca8-245">This occurs because SQL Server 2005 promotes to a DTC whenever a connection is closed and reopened within a single transaction, which is the default behavior of the [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)].</span></span> <span data-ttu-id="8cca8-246">Такое повышение уровня до DTC не происходит при использовании SQL Server 2008.</span><span class="sxs-lookup"><span data-stu-id="8cca8-246">This DTC promotion does not occur when using SQL Server 2008.</span></span> <span data-ttu-id="8cca8-247">Чтобы избежать такого повышения уровня при работе с SQL Server 2005, необходимо явно открывать и закрывать соединение в пределах одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="8cca8-247">To avoid this promotion when using SQL Server 2005, you must explicitly open and close the connection within the transaction.</span></span> <span data-ttu-id="8cca8-248">Дополнительные сведения см. в разделе [Управление соединениями и транзакциями](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-248">For more information, see [Managing Connections and Transactions](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span></span>  
  
 <span data-ttu-id="8cca8-249">Явная транзакция используется, если в пределах транзакции <xref:System.Transactions> выполняется одна или несколько операций.</span><span class="sxs-lookup"><span data-stu-id="8cca8-249">An explicit transaction is used when one or more operations are executed inside a <xref:System.Transactions> transaction.</span></span> <span data-ttu-id="8cca8-250">Дополнительные сведения см. в разделе [Управление соединениями и транзакциями](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-250">For more information, see [Managing Connections and Transactions](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span></span>  
  
## <a name="strategies-for-improving-performance"></a><span data-ttu-id="8cca8-251">Стратегии повышения производительности</span><span class="sxs-lookup"><span data-stu-id="8cca8-251">Strategies for Improving Performance</span></span>  
 <span data-ttu-id="8cca8-252">Ниже перечислены методики, позволяющие повысить общую производительность запросов платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="8cca8-252">You can improve the overall performance of queries in the Entity Framework by using the following strategies.</span></span>  
  
#### <a name="pre-generate-views"></a><span data-ttu-id="8cca8-253">Предварительное создание представлений</span><span class="sxs-lookup"><span data-stu-id="8cca8-253">Pre-generate views</span></span>  
 <span data-ttu-id="8cca8-254">Создание представлений на базе модели сущностей - это значительная статья расходов при первом выполнении запроса приложением.</span><span class="sxs-lookup"><span data-stu-id="8cca8-254">Generating views based on an entity model is a significant cost the first time that an application executes a query.</span></span> <span data-ttu-id="8cca8-255">С помощью программы EdmGen.exe можно заранее создавать представления в виде файлов с кодом Visual Basic или C#, которые будут добавляться в проект во время проектирования.</span><span class="sxs-lookup"><span data-stu-id="8cca8-255">Use the EdmGen.exe utility to pre-generate views as a Visual Basic or C# code file that can be added to the project during design.</span></span> <span data-ttu-id="8cca8-256">Можно также использовать средства преобразования текстовых шаблонов для создания представлений до компиляции.</span><span class="sxs-lookup"><span data-stu-id="8cca8-256">You could also use the Text Template Transformation Toolkit to generate pre-compiled views.</span></span> <span data-ttu-id="8cca8-257">Предварительно созданные представления во время выполнения будут проверяться на согласованность с текущей версией указанной модели сущностей.</span><span class="sxs-lookup"><span data-stu-id="8cca8-257">Pre-generated views are validated at runtime to ensure that they are consistent with the current version of the specified entity model.</span></span> <span data-ttu-id="8cca8-258">Дополнительные сведения см. в разделе [Как Предварительное создание представлений для повышения производительности запросов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896240(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-258">For more information, see [How to: Pre-Generate Views to Improve Query Performance](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896240(v=vs.100)).</span></span>
  
 <span data-ttu-id="8cca8-259">При работе с очень большими моделями нужно принимать во внимание следующие соображения.</span><span class="sxs-lookup"><span data-stu-id="8cca8-259">When working with very large models, the following consideration applies:</span></span>  
  
 <span data-ttu-id="8cca8-260">Формат метаданных .NET ограничивает число символов пользовательской строки в заданном двоичном блоке до 16 777 215 (0xFFFFFF).</span><span class="sxs-lookup"><span data-stu-id="8cca8-260">The .NET metadata format limits the number of user string characters in a given binary to 16,777,215 (0xFFFFFF).</span></span> <span data-ttu-id="8cca8-261">Если при создании представлений для очень большой модели файл представления достигает ограничения размера, вы получите «не осталось логического пространства для создания дополнительных пользовательских строк.»</span><span class="sxs-lookup"><span data-stu-id="8cca8-261">If you are generating views for a very large model and the view file reaches this size limit, you will get the "No logical space left to create more user strings."</span></span> <span data-ttu-id="8cca8-262">Ошибка компиляции.</span><span class="sxs-lookup"><span data-stu-id="8cca8-262">compile error.</span></span> <span data-ttu-id="8cca8-263">Это ограничение имеет силу для всех управляемых библиотек.</span><span class="sxs-lookup"><span data-stu-id="8cca8-263">This size limitation applies to all managed binaries.</span></span> <span data-ttu-id="8cca8-264">Дополнительные сведения см. в разделе [блог](https://go.microsoft.com/fwlink/?LinkId=201476) показано, как избежать ошибок при работе с большими и сложными моделями.</span><span class="sxs-lookup"><span data-stu-id="8cca8-264">For more information see the [blog](https://go.microsoft.com/fwlink/?LinkId=201476) that demonstrates how to avoid the error when working with large and complex models.</span></span>  
  
#### <a name="consider-using-the-notracking-merge-option-for-queries"></a><span data-ttu-id="8cca8-265">Рассмотрите возможность использования параметра слияния NoTracking для запросов</span><span class="sxs-lookup"><span data-stu-id="8cca8-265">Consider using the NoTracking merge option for queries</span></span>  
 <span data-ttu-id="8cca8-266">Для отслеживания возвращаемых объектов в контексте объекта требуются определенные затраты.</span><span class="sxs-lookup"><span data-stu-id="8cca8-266">There is a cost required to track returned objects in the object context.</span></span> <span data-ttu-id="8cca8-267">Для распознавания изменений в объектах и гарантии того, что несколько запросов к одной логической сущности возвратят один экземпляр объекта, требуется, чтобы объекты были присоединены к экземпляру <xref:System.Data.Objects.ObjectContext>.</span><span class="sxs-lookup"><span data-stu-id="8cca8-267">Detecting changes to objects and ensuring that multiple requests for the same logical entity return the same object instance requires that objects be attached to an <xref:System.Data.Objects.ObjectContext> instance.</span></span> <span data-ttu-id="8cca8-268">Если вы не планируете для обновления или удаления объектов и не требуют управления удостоверениями, рассмотрите возможность использования <xref:System.Data.Objects.MergeOption.NoTracking> параметры слияния, при выполнении запросов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-268">If you do not plan to make updates or deletes to objects and do not require identity management, consider using the <xref:System.Data.Objects.MergeOption.NoTracking> merge options when you execute queries.</span></span>  
  
#### <a name="return-the-correct-amount-of-data"></a><span data-ttu-id="8cca8-269">Возвращение правильного объема данных</span><span class="sxs-lookup"><span data-stu-id="8cca8-269">Return the correct amount of data</span></span>  
 <span data-ttu-id="8cca8-270">В некоторых случаях указание пути запроса с помощью метода <xref:System.Data.Objects.ObjectQuery%601.Include%2A> выполняется гораздо быстрее, поскольку требуется меньше циклов обмена данными с базой данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-270">In some scenarios, specifying a query path using the <xref:System.Data.Objects.ObjectQuery%601.Include%2A> method is much faster because it requires fewer round trips to the database.</span></span> <span data-ttu-id="8cca8-271">Однако в других сценариях дополнительные циклы обмена данными с базой данных при загрузке связанных объектов могут выполняться быстрее, поскольку более простые запросы с меньшим количеством соединений ведут к меньшей избыточности данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-271">However, in other scenarios, additional round trips to the database to load related objects may be faster because the simpler queries with fewer joins result in less redundancy of data.</span></span> <span data-ttu-id="8cca8-272">В связи с этим рекомендуется проверять производительность разных способов получения связанных объектов.</span><span class="sxs-lookup"><span data-stu-id="8cca8-272">Because of this, we recommend that you test the performance of various ways to retrieve related objects.</span></span> <span data-ttu-id="8cca8-273">Дополнительные сведения см. в разделе [загрузка связанных объектов](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896272(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-273">For more information, see [Loading Related Objects](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896272(v=vs.100)).</span></span>  
  
 <span data-ttu-id="8cca8-274">Чтобы избежать возвращения слишком большого объема данных в одном запросе, можно прибегнуть к подкачке страниц результатов запроса, что даст более простые в управлении группы.</span><span class="sxs-lookup"><span data-stu-id="8cca8-274">To avoid returning too much data in a single query, consider paging the results of the query into more manageable groups.</span></span> <span data-ttu-id="8cca8-275">Дополнительные сведения см. в разделе [Как Постранично просмотреть результаты запроса](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738702(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-275">For more information, see [How to: Page Through Query Results](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738702(v=vs.100)).</span></span>  
  
#### <a name="limit-the-scope-of-the-objectcontext"></a><span data-ttu-id="8cca8-276">Ограничение области объекта ObjectContext</span><span class="sxs-lookup"><span data-stu-id="8cca8-276">Limit the scope of the ObjectContext</span></span>  
 <span data-ttu-id="8cca8-277">В большинстве случаев следует создавать экземпляр <xref:System.Data.Objects.ObjectContext> внутри инструкции `using` (`Using…End Using` в Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="8cca8-277">In most cases, you should create an <xref:System.Data.Objects.ObjectContext> instance within a `using` statement (`Using…End Using` in Visual Basic).</span></span> <span data-ttu-id="8cca8-278">Это может повысить производительность, поскольку гарантирует автоматическое удаление ресурсов, связанных с контекстом объекта, при выходе из блока инструкции в коде.</span><span class="sxs-lookup"><span data-stu-id="8cca8-278">This can increase performance by ensuring that the resources associated with the object context are disposed automatically when the code exits the statement block.</span></span> <span data-ttu-id="8cca8-279">Однако, если элементы управления привязаны к объектам, управляемым контекстом объекта, экземпляр <xref:System.Data.Objects.ObjectContext> следует сохранять до тех пор, пока требуется привязка, а удалять его - вручную.</span><span class="sxs-lookup"><span data-stu-id="8cca8-279">However, when controls are bound to objects managed by the object context, the <xref:System.Data.Objects.ObjectContext> instance should be maintained as long as the binding is needed and disposed of manually.</span></span> <span data-ttu-id="8cca8-280">Дополнительные сведения см. в разделе [Управление соединениями и транзакциями](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-280">For more information, see [Managing Connections and Transactions](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span></span>  
  
#### <a name="consider-opening-the-database-connection-manually"></a><span data-ttu-id="8cca8-281">Рассмотрите возможность подключения базы данных вручную</span><span class="sxs-lookup"><span data-stu-id="8cca8-281">Consider opening the database connection manually</span></span>  
 <span data-ttu-id="8cca8-282">Если приложение выполняет серию запросов объектов или часто вызывает метод <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> для сохранения создания, обновления и удаления, выполняемых к источнику данных, [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] приходится постоянно открывать и закрывать соединение с источником данных.</span><span class="sxs-lookup"><span data-stu-id="8cca8-282">When your application executes a series of object queries or frequently calls <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> to persist create, update, and delete operations to the data source, the [!INCLUDE[adonet_ef](../../../../../includes/adonet-ef-md.md)] must continuously open and close the connection to the data source.</span></span> <span data-ttu-id="8cca8-283">В таких случаях следует попробовать вручную открывать соединение в начале этих операций и либо закрывать, либо удалять соединение по их завершении.</span><span class="sxs-lookup"><span data-stu-id="8cca8-283">In these situations, consider manually opening the connection at the start of these operations and either closing or disposing of the connection when the operations are complete.</span></span> <span data-ttu-id="8cca8-284">Дополнительные сведения см. в разделе [Управление соединениями и транзакциями](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="8cca8-284">For more information, see [Managing Connections and Transactions](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896325(v=vs.100)).</span></span>  
  
## <a name="performance-data"></a><span data-ttu-id="8cca8-285">Данные производительности</span><span class="sxs-lookup"><span data-stu-id="8cca8-285">Performance Data</span></span>  
 <span data-ttu-id="8cca8-286">Некоторые данные производительности для платформы Entity Framework опубликованы в приведенных ниже сообщениях на [блога группы разработчиков ADO.NET](https://go.microsoft.com/fwlink/?LinkId=91905):</span><span class="sxs-lookup"><span data-stu-id="8cca8-286">Some performance data for the Entity Framework is published in the following posts on the [ADO.NET team blog](https://go.microsoft.com/fwlink/?LinkId=91905):</span></span>  
  
-   [<span data-ttu-id="8cca8-287">Обзор производительности платформы ADO.NET Entity Framework — часть 1</span><span class="sxs-lookup"><span data-stu-id="8cca8-287">Exploring the Performance of the ADO.NET Entity Framework - Part 1</span></span>](https://go.microsoft.com/fwlink/?LinkId=123907)  
  
-   [<span data-ttu-id="8cca8-288">Обзор производительности платформы ADO.NET Entity Framework — часть 2</span><span class="sxs-lookup"><span data-stu-id="8cca8-288">Exploring the Performance of the ADO.NET Entity Framework – Part 2</span></span>](https://go.microsoft.com/fwlink/?LinkId=123909)  
  
-   [<span data-ttu-id="8cca8-289">Сравнение производительности платформы ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="8cca8-289">ADO.NET Entity Framework Performance Comparison</span></span>](https://go.microsoft.com/fwlink/?LinkID=123913)  
  
## <a name="see-also"></a><span data-ttu-id="8cca8-290">См. также</span><span class="sxs-lookup"><span data-stu-id="8cca8-290">See also</span></span>

- [<span data-ttu-id="8cca8-291">Вопросы разработки и развертывания</span><span class="sxs-lookup"><span data-stu-id="8cca8-291">Development and Deployment Considerations</span></span>](../../../../../docs/framework/data/adonet/ef/development-and-deployment-considerations.md)
