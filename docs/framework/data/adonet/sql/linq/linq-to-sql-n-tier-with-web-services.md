---
title: N-уровневое использование LINQ to SQL с веб-службами
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 4fafaa60dd75def98b486e18faa5bd3ecd1d6315
ms.sourcegitcommit: 7f616512044ab7795e32806578e8dc0c6a0e038f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2019
ms.locfileid: "67743048"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a>N-уровневое использование LINQ to SQL с веб-службами
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] предназначен специально для использования на среднем уровне слабо связанных доступа к данным (DAL), например веб-службы. Если уровнем представления данных является веб-страница ASP.NET, то для управления передачей данных между пользовательским интерфейсом и <xref:System.Web.UI.WebControls.LinqDataSource> на среднем уровне используется серверный веб-элемент управления [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]. Если уровень представления данных не является страницей ASP.NET, то и на среднем уровне, и на уровне представления данных необходимо выполнить дополнительные действия по управлению сериализацией и десериализацией данных.  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a>Настройка технологии LINQ to SQL на среднем уровне  
 Средний уровень веб-службы или многоуровневого приложения содержит контекст данных и классы сущностей. Эти классы можно создать вручную или с помощью SQLMetal.exe или реляционного конструктора объектов, как описано в документации. Во время разработки можно сделать класс сущностей сериализуемым. Дополнительные сведения см. в разделе [Практическое руководство. Обеспечить сериализацию сущностей](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md). Другой способ заключается в создании отдельного набора классов, инкапсулирующих данные, которые необходимо сериализовать, и последующем проецировании данных в эти сериализуемые типы при их возвращении в запросах [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].  
  
 Затем следует определить интерфейс с методами, которые клиенты будут вызывать для извлечения, вставки и обновления данных. Методы интерфейса заключают запросы [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] в оболочку. Для обработки удаленных вызовов методов и сериализации данных можно использовать любой вид механизма сериализации. Единственное требование заключается в том, что если в объектной модели существуют циклические или двунаправленные отношения, например между классами "Customers" и "Orders" в стандартной объектной модели "Northwind", то необходимо использовать сериализатор, который поддерживает такие отношения. Сериализатор Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> поддерживает двунаправленные отношения, а сериализатор XmlSerializer, который используется для веб-служб, не совместимых с WCF, не поддерживает. Если используется сериализатор XmlSerializer, то необходимо убедиться, что в объектной модели отсутствуют циклические связи.  
  
 Дополнительные сведения о Windows Communication Foundation, см. в разделе [службы Windows Communication Foundation и WCF Data Services в Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).  
  
 Реализуйте бизнес-правила и другую логику, относящуюся к домену, используя разделяемые классы и методы в классе <xref:System.Data.Linq.DataContext> и классах сущностей для обработки событий [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] времени выполнения. Дополнительные сведения см. в разделе [реализации бизнес-логики N-уровневых](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).  
  
## <a name="defining-the-serializable-types"></a>Определение сериализуемых типов  
 Клиент или уровень представления данных должен иметь определения типов для классов, которые он будет получать от среднего уровня. Данные типы могут сами быть классами сущностей или представлять собой особые классы, которые включают только определенные поля из классов сущностей для удаленного взаимодействия. В любом случае [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] является полностью технология как уровень представления данных определений этих типов. Например, уровень представления данных может использовать технологию WCF для автоматического создания типов, содержать копию библиотеки DLL, в которой определены эти типы или определить собственные версии типов.  
  
## <a name="retrieving-and-inserting-data"></a>Извлечение и вставка данных  
 Средний уровень определяет интерфейс, указывающий, как уровень представления данных получает доступ к данным. Например, `GetProductByID(int productID)` или `GetCustomers()`. На среднем уровне тело метода обычно создает новый экземпляр класса <xref:System.Data.Linq.DataContext> и выполняет запрос к одной или нескольким своим таблицам. Затем средний уровень возвращает результат в виде интерфейса <xref:System.Collections.Generic.IEnumerable%601>, где `T` является классом сущностей или другим типом, используемым для сериализации. Уровень представления данных никогда не отправляет переменные запроса непосредственно на средний уровень и не получает этих переменных из среднего уровня. Оба уровня обмениваются значениями, объектами и коллекциями конкретных данных. После получения коллекции уровень представления данных при необходимости может использовать технологию [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects для выполнения запроса к этой коллекции.  
  
 При вставке данных уровень представления может создать новый объект и отправить его на средний уровень или указать среднему уровню создать объект на основе предоставленных им значений. В общем случае извлечение и вставка данных в многоуровневых приложениях не сильно отличается от аналогичного процесса в двухуровневых приложениях. Дополнительные сведения см. в разделе [запрос в базу данных](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) и [внесение и отправка изменений данных](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).  
  
## <a name="tracking-changes-for-updates-and-deletes"></a>Отслеживание изменений для обновления и удаления  
 Технология [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] поддерживает оптимистический параллелизм, основанный на отметках времени (также называемых RowVersions) или на исходных значениях. Если таблицам базы данных присвоены метки времени, то для операций обновления и удаления требуются некоторые дополнительные действия либо на среднем уровне, либо на уровне представления данных. Однако если для проверок на оптимистический параллелизм необходимо использовать исходные значения, то ответственность за отслеживание этих значений и отправку их обратно при выполнении обновлений лежит на уровне представления данных. Причиной этого является тот факт, что изменения сущностей, выполненные на уровне представления данных, не отслеживаются на среднем уровне. В действительности, исходное извлечение сущности и окончательное его обновление обычно выполняется двумя совершенно различными экземплярами класса <xref:System.Data.Linq.DataContext>.  
  
 Чем больше количество изменений, выполненных на уровне представления данных, тем сложнее становится отслеживать эти изменения и отправлять их в пакетах обратно на средний уровень. Реализация механизма передачи изменений полностью зависит от приложения. Единственное требование заключается в том, что технологии [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] должны быть предоставлены исходные значений, которые необходимы для выполнения проверок на оптимистический параллелизм.  
  
 Дополнительные сведения см. в разделе [извлечение данных и операции CUD в N-уровневых приложениях (LINQ to SQL) и](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).  
  
## <a name="see-also"></a>См. также

- [N-уровневые и удаленные приложения и LINQ to SQL](../../../../../../docs/framework/data/adonet/sql/linq/n-tier-and-remote-applications-with-linq-to-sql.md)
- [Обзор управления LinqDataSource Web Server](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))
