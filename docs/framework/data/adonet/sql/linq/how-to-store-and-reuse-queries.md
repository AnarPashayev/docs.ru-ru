---
title: Практическое руководство. Как хранить и повторно использовать запросы
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a012bd79-1809-45e3-adea-0229532396cc
ms.openlocfilehash: aae1cf3faf2ecb3d8e9511390cdaa1e004905bea
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91197096"
---
# <a name="how-to-store-and-reuse-queries"></a><span data-ttu-id="679cf-102">Практическое руководство. Как хранить и повторно использовать запросы</span><span class="sxs-lookup"><span data-stu-id="679cf-102">How to: Store and Reuse Queries</span></span>

<span data-ttu-id="679cf-103">При наличии приложения, которое неоднократно выполняет схожие по структуре запросы, можно существенно увеличить производительность, если скомпилировать запрос один раз и затем выполнить его несколько раз с различными параметрами.</span><span class="sxs-lookup"><span data-stu-id="679cf-103">When you have an application that executes structurally similar queries many times, you can often increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="679cf-104">Например, приложению может потребоваться получение всех клиентов из определенного города; название города указывается пользователем в форме во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="679cf-104">For example, an application might have to retrieve all the customers who are in a particular city, where the city is specified at runtime by the user in a form.</span></span> [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="679cf-105">поддерживает использование *скомпилированных запросов* для этой цели.</span><span class="sxs-lookup"><span data-stu-id="679cf-105">supports the use of *compiled queries* for this purpose.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="679cf-106">Данный метод использования удобен для большинства случаев применения скомпилированных запросов.</span><span class="sxs-lookup"><span data-stu-id="679cf-106">This pattern of usage represents the most common use for compiled queries.</span></span> <span data-ttu-id="679cf-107">Возможны и другие методы.</span><span class="sxs-lookup"><span data-stu-id="679cf-107">Other approaches are possible.</span></span> <span data-ttu-id="679cf-108">Например, скомпилированные запросы можно сохранить в качестве статических членов разделяемого класса, который расширяет код, созданный конструктором.</span><span class="sxs-lookup"><span data-stu-id="679cf-108">For example, compiled queries can be stored as static members on a partial class that extends the code generated by the designer.</span></span>  
  
## <a name="example"></a><span data-ttu-id="679cf-109">Пример</span><span class="sxs-lookup"><span data-stu-id="679cf-109">Example</span></span>  

 <span data-ttu-id="679cf-110">Во многих сценариях может потребоваться повторно использовать запросы в разных потоках.</span><span class="sxs-lookup"><span data-stu-id="679cf-110">In many scenarios you might want to reuse the queries across thread boundaries.</span></span> <span data-ttu-id="679cf-111">В таких случаях особенно эффективным становится метод сохранения скомпилированных запросов в статических переменных.</span><span class="sxs-lookup"><span data-stu-id="679cf-111">In such cases, storing the compiled queries in static variables is especially effective.</span></span> <span data-ttu-id="679cf-112">В следующем примере кода предполагается, что класс `Queries` предназначен для хранения скомпилированных запросов, а класс "Northwind" представляет строго типизированный класс <xref:System.Data.Linq.DataContext>.</span><span class="sxs-lookup"><span data-stu-id="679cf-112">The following code example assumes a `Queries` class designed to store compiled queries, and assumes a Northwind class that represents a strongly typed <xref:System.Data.Linq.DataContext>.</span></span>  
  
 [!code-csharp[DLinqQuerying#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#6)]
 [!code-vb[DLinqQuerying#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#6)]  
  
 [!code-csharp[DLinqQuerying#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#7)]
 [!code-vb[DLinqQuerying#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#7)]  
  
## <a name="example"></a><span data-ttu-id="679cf-113">Пример</span><span class="sxs-lookup"><span data-stu-id="679cf-113">Example</span></span>  

 <span data-ttu-id="679cf-114">В настоящее время нельзя хранить запросы (в статических переменных), возвращающие *Анонимный тип*, поскольку тип не имеет имени для предоставления в качестве универсального аргумента.</span><span class="sxs-lookup"><span data-stu-id="679cf-114">You cannot currently store (in static variables) queries that return an *anonymous type*, because type has no name to provide as a generic argument.</span></span> <span data-ttu-id="679cf-115">В следующем примере демонстрируется, как можно решить эту проблему, создавая тип, представляющий результат, а затем используя его как универсальный аргумент.</span><span class="sxs-lookup"><span data-stu-id="679cf-115">The following example shows how you can work around the issue by creating a type that can represent the result, and then use it as a generic argument.</span></span>  
  
 [!code-csharp[DLinqQuerying#8](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#8)]
 [!code-vb[DLinqQuerying#8](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#8)]  
  
## <a name="see-also"></a><span data-ttu-id="679cf-116">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="679cf-116">See also</span></span>

- <xref:System.Data.Linq.CompiledQuery>
- [<span data-ttu-id="679cf-117">Основные принципы запросов</span><span class="sxs-lookup"><span data-stu-id="679cf-117">Query Concepts</span></span>](query-concepts.md)
- [<span data-ttu-id="679cf-118">Запрос к базе данных</span><span class="sxs-lookup"><span data-stu-id="679cf-118">Querying the Database</span></span>](querying-the-database.md)
