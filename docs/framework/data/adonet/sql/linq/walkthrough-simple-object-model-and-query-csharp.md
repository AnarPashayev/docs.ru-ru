---
title: Пошаговое руководство. Простая модель объектов и простой запрос (C#)
ms.date: 03/30/2017
ms.assetid: 419961cc-92d6-45f5-ae8a-d485bdde3a37
ms.openlocfilehash: a9b3b57e37331cd13f2cd30b8a7663f2fb39d8c1
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2019
ms.locfileid: "70792132"
---
# <a name="walkthrough-simple-object-model-and-query-c"></a>Пошаговое руководство. Простая модель объектов и простой запрос (C#)

В данном пошаговом руководстве представлен основной и полный сценарий [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] с подробным объяснением выполняемых действий. В нем создается класс сущностей, который моделирует таблицу Customers в учебной базе данных Northwind. После этого создается простой запрос на получение списка клиентов, находящихся в Лондоне.

Данное руководство ориентировано на создание кода, чтобы продемонстрировать основные понятия технологии [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]. Как правило, для создания объектной модели следует использовать реляционный конструктор объектов.

[!INCLUDE[note_settings_general](../../../../../../includes/note-settings-general-md.md)]

Это пошаговое руководство было написано с использованием параметров разработки Visual C#.

## <a name="prerequisites"></a>Предварительные требования

- Для хранения файлов используется выделенная папка ("c:\linqtest5"). Прежде чем приступить к выполнению задач, создайте такую папку.

- В данном пошаговом руководстве требуется доступ к учебной базе данных Northwind. Если база данных не установлена на компьютере разработчика, загрузите ее с веб-узла Центра загрузки Майкрософт. Инструкции см. в разделе [Загрузка образцов баз данных](downloading-sample-databases.md). После загрузки базы данных скопируйте файл в папку c:\linqtest5.

## <a name="overview"></a>Обзор

Данное пошаговое руководство состоит из шести основных задач.

- [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] Создание решения в Visual Studio.

- Сопоставление класса с таблицей базы данных.

- Назначение свойств классу для представления столбцов базы данных.

- Указание подключения к базе данных Northwind.

- Создание простого запроса к базе данных.

- Выполнение запроса и просмотр результатов.

## <a name="creating-a-linq-to-sql-solution"></a>Создание решения LINQ to SQL

В этой первой задаче вы создадите решение Visual Studio, содержащее необходимые ссылки для сборки и запуска [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] проекта.

### <a name="to-create-a-linq-to-sql-solution"></a>Создание решения LINQ to SQL

1. В меню **файл** Visual Studio наведите указатель на пункт **создать**и выберите пункт **проект**.

2. На панели **типы проектов** диалогового окна **Новый проект** нажмите кнопку **визуальный C#** элемент.

3. В области **Шаблоны** щелкните **Консольное приложение**.

4. В поле **имя** введите **линкконсолеапп**.

5. В поле **Расположение** проверьте, где вы хотите сохранить файлы проекта.

6. Нажмите кнопку **ОК**.

## <a name="adding-linq-references-and-directives"></a>Добавление ссылок и директив LINQ

В этом пошаговом руководстве используются сборки, которые могут быть не установлены по умолчанию в проект. Если System. Data. LINQ не указан в качестве ссылки в проекте (разверните узел **ссылки** в **Обозреватель решений**), добавьте его, как описано в следующих шагах.

### <a name="to-add-systemdatalinq"></a>Добавление сборки System.Data.Linq

1. В **Обозреватель решений**щелкните правой кнопкой мыши элемент **ссылки**и выберите команду **Добавить ссылку**.

2. В диалоговом окне **Добавление ссылки** щелкните **.NET**, выберите сборку System. Data. LINQ и нажмите кнопку **ОК**.

     Сборка будет добавлена в проект.

3. Добавьте следующие директивы в начало **Program.CS**:

     [!code-csharp[DLinqWalk1CS#1](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1CS/cs/Program.cs#1)]

## <a name="mapping-a-class-to-a-database-table"></a>Сопоставление класса с таблицей базы данных

На этом этапе создается класс, который сопоставляется с таблицей базы данных. Такой класс называется *классом сущностей*. Обратите внимание, что сопоставление осуществляется простым добавлением атрибута <xref:System.Data.Linq.Mapping.TableAttribute>. Свойство <xref:System.Data.Linq.Mapping.TableAttribute.Name%2A> задает имя таблицы в базе данных.

### <a name="to-create-an-entity-class-and-map-it-to-a-database-table"></a>Создание класса сущностей и его сопоставление с таблицей базы данных

- Введите или вставьте следующий код в Program.cs непосредственно перед объявлением класса `Program`.

     [!code-csharp[DLinqWalk1CS#2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1CS/cs/Program.cs#2)]

## <a name="designating-properties-on-the-class-to-represent-database-columns"></a>Назначение свойств классу для представления столбцов базы данных.

На этом этапе выполняется несколько задач.

- Используется атрибут <xref:System.Data.Linq.Mapping.ColumnAttribute> для назначения классу сущностей свойств `CustomerID` и `City`, представляющих столбцы в таблице базы данных.

- Назначается свойство `CustomerID`, представляющее столбец первичного ключа в базе данных.

- Назначаются поля `_CustomerID` и `_City` для закрытого хранения. После этого [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] сможет напрямую сохранять и извлекать значения, вместо вызова открытых методов доступа, которые могут содержать бизнес-логику.

### <a name="to-represent-characteristics-of-two-database-columns"></a>Представление характеристик двух столбцов базы данных

- Для класса `Customer` введите или вставьте следующий код в Program.cs в фигурных скобках.

     [!code-csharp[DLinqWalk1CS#3](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1CS/cs/Program.cs#3)]

## <a name="specifying-the-connection-to-the-northwind-database"></a>Указание подключения к базе данных Northwind

На этом этапе для установки подключения между основанными на коде структурами данных и самой базой данных используется объект <xref:System.Data.Linq.DataContext>. Основным каналом, через который извлекаются объекты из базы данных и отправляются изменения, является класс <xref:System.Data.Linq.DataContext>.

Также объявляется объект `Table<Customer>`, который действует как логическая типизированная таблица для запросов к таблице Customers в базе данных. Эти запросы создаются и выполняются в последующих действиях.

### <a name="to-specify-the-database-connection"></a>Указание подключения к базе данных

- Введите или вставьте следующий код в метод `Main`.

     Обратите внимание, что файл `northwnd.mdf` находится в папке "linqtest5". Дополнительные сведения см. в разделе "Предварительные требования" ранее в этом руководстве.

     [!code-csharp[DLinqWalk1CS#4](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1CS/cs/Program.cs#4)]

## <a name="creating-a-simple-query"></a>Создание простого запроса

На этом этапе создается запрос для поиска клиентов из таблицы Customers базы данных, находящихся в Лондоне. Код запроса, создаваемый на этом шаге, только описывает запрос. но не выполняет его. Этот подход называется *отложенным выполнением*. Дополнительные сведения см. в разделе [Введение в запросы LINQ (C#)](../../../../../csharp/programming-guide/concepts/linq/introduction-to-linq-queries.md).

Можно также записать выходные данные в журнал, чтобы продемонстрировать команды SQL, создаваемые технологией [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]. Возможность ведения журнала (которая использует метод <xref:System.Data.Linq.DataContext.Log%2A>) очень полезна при отладке, а также при проверке того, что команды, отправляемые в базу данных, точно соответствуют запросу.

### <a name="to-create-a-simple-query"></a>Создание простого запроса

- Введите или вставьте следующий код в метод `Main` после объявления `Table<Customer>`.

     [!code-csharp[DLinqWalk1ACS#5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1ACS/cs/Program.cs#5)]

## <a name="executing-the-query"></a>Выполнение запроса

На этом шаге производится фактическое выполнение запроса. Выражения запроса, созданные на предыдущем этапе, не оцениваются до тех пор, пока не понадобятся результаты. После начала итерации `foreach` выполняется команда SQL для базы данных и материализуются объекты.

### <a name="to-execute-the-query"></a>Порядок выполнения запроса

1. Введите или вставьте следующий код в конце метода `Main` (после описания запроса).

     [!code-csharp[DLinqWalk1ACS#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk1ACS/cs/Program.cs#6)]

2. Нажмите клавишу F5, чтобы начать отладку приложения.

    > [!NOTE]
    > Если приложение создает ошибку во время выполнения, см. [Пошаговые руководства](learning-by-walkthroughs.md)в разделе Устранение неполадок.

     В окне консоли отображаются следующие результаты запроса.

     `ID=AROUT, City=London`

     `ID=BSBEV, City=London`

     `ID=CONSH, City=London`

     `ID=EASTC, City=London`

     `ID=NORTS, City=London`

     `ID=SEVES, City=London`

3. Чтобы закрыть приложение, в окне консоли нажмите клавишу ВВОД.

## <a name="next-steps"></a>Следующие шаги

В [этом пошаговом руководстве: В разделе "запросы поC#связям](walkthrough-querying-across-relationships-csharp.md) " () сохраняется, где заканчивается это пошаговое руководство. В пошаговом руководстве запрос по [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] связям показано, как можно выполнять запросы к нескольким таблицам, как и к *объединениям* в реляционной базе данных.

Если требуется выполнить пошаговое руководство "Выполнение запросов в связях", необходимо сохранить решение, созданное в процессе только что завершенного пошагового руководства. Это условие является обязательным.

## <a name="see-also"></a>См. также

- [Обучение с использованием пошаговых руководств](learning-by-walkthroughs.md)
