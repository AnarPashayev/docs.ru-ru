---
title: Авторизация и разрешения в SQL Server
description: Узнайте, как явно предоставить разрешения на создание объектов базы данных, доступных пользователям в SQL Server с помощью ADO.NET.
ms.date: 03/30/2017
ms.assetid: d340405c-91f4-4837-a3cc-a238ee89888a
ms.openlocfilehash: eb01e29b36da5e1793b9176301a968a42115d19c
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/02/2020
ms.locfileid: "84286537"
---
# <a name="authorization-and-permissions-in-sql-server"></a><span data-ttu-id="1e19a-103">Авторизация и разрешения в SQL Server</span><span class="sxs-lookup"><span data-stu-id="1e19a-103">Authorization and Permissions in SQL Server</span></span>
<span data-ttu-id="1e19a-104">После создания объектов базы данных необходимо явно предоставить разрешения, чтобы сделать их доступными для пользователей.</span><span class="sxs-lookup"><span data-stu-id="1e19a-104">When you create database objects, you must explicitly grant permissions to make them accessible to users.</span></span> <span data-ttu-id="1e19a-105">Каждый защищаемый объект имеет разрешения, которые могут быть предоставлены участнику с помощью инструкций разрешения.</span><span class="sxs-lookup"><span data-stu-id="1e19a-105">Every securable object has permissions that can be granted to a principal using permission statements.</span></span>  
  
## <a name="the-principle-of-least-privilege"></a><span data-ttu-id="1e19a-106">Принцип минимальных привилегий</span><span class="sxs-lookup"><span data-stu-id="1e19a-106">The Principle of Least Privilege</span></span>  
 <span data-ttu-id="1e19a-107">Подход к разработке приложений на основе учетных записей пользователей с минимальными правами доступа (LUA) представляет собой важной часть оборонительной, всесторонней стратегии противостояния угрозам безопасности.</span><span class="sxs-lookup"><span data-stu-id="1e19a-107">Developing an application using a least-privileged user account (LUA) approach is an important part of a defensive, in-depth strategy for countering security threats.</span></span> <span data-ttu-id="1e19a-108">Подход LUA гарантирует то, что пользователи будут следовать принципу минимальных разрешений и всегда регистрироваться с помощью ограниченных учетных записей пользователя.</span><span class="sxs-lookup"><span data-stu-id="1e19a-108">The LUA approach ensures that users follow the principle of least privilege and always log on with limited user accounts.</span></span> <span data-ttu-id="1e19a-109">Административные задачи подразделяются на категории с использованием предопределенных ролей сервера, а возможность применения предопределенной роли сервера `sysadmin` строго ограничивается.</span><span class="sxs-lookup"><span data-stu-id="1e19a-109">Administrative tasks are broken out using fixed server roles, and the use of the `sysadmin` fixed server role is severely restricted.</span></span>  
  
 <span data-ttu-id="1e19a-110">Всегда следуйте принципу минимальных прав при предоставлении разрешений пользователям базы данных.</span><span class="sxs-lookup"><span data-stu-id="1e19a-110">Always follow the principle of least privilege when granting permissions to database users.</span></span> <span data-ttu-id="1e19a-111">Предоставляйте минимальные разрешения, необходимые пользователю или роли для выполнения каждой конкретной задачи.</span><span class="sxs-lookup"><span data-stu-id="1e19a-111">Grant the minimum permissions necessary to a user or role to accomplish a given task.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="1e19a-112">Разработка и проверка приложений с использованием подхода LUA вносит дополнительные сложности в процесс разработки.</span><span class="sxs-lookup"><span data-stu-id="1e19a-112">Developing and testing an application using the LUA approach adds a degree of difficulty to the development process.</span></span> <span data-ttu-id="1e19a-113">Проще создавать объекты и разрабатывать код, будучи зарегистрированным в качестве системного администратора или владельца базы данных, чем при использовании учетной записи LUA.</span><span class="sxs-lookup"><span data-stu-id="1e19a-113">It is easier to create objects and write code while logged on as a system administrator or database owner than it is using a LUA account.</span></span> <span data-ttu-id="1e19a-114">Но разработка приложений в рамках высоко привилегированной учетной записи может не дать почувствовать влияния уменьшенных функциональных возможностей, которые обнаруживаются при попытке наименее привилегированных пользователей эксплуатировать приложение, для надлежащего функционирования которого требуется более высокий уровень разрешений.</span><span class="sxs-lookup"><span data-stu-id="1e19a-114">However, developing applications using a highly privileged account can obfuscate the impact of reduced functionality when least privileged users attempt to run an application that requires elevated permissions in order to function correctly.</span></span> <span data-ttu-id="1e19a-115">А после того как пользователям будут предоставлены чрезмерные разрешения, чтобы они могли вновь приобрести утраченные функциональные возможности, приложение может оказаться уязвимым для атаки.</span><span class="sxs-lookup"><span data-stu-id="1e19a-115">Granting excessive permissions to users in order to reacquire lost functionality can leave your application vulnerable to attack.</span></span> <span data-ttu-id="1e19a-116">Проектирование, разработка и проверка приложения в условиях регистрации в учетной записи LUA требуют дисциплинированного подхода к планированию безопасности, что позволяет избежать неприятных сюрпризов и избавиться от стремления предоставлять расширенные права в целях скорейшего возобновления работы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-116">Designing, developing and testing your application logged on with a LUA account enforces a disciplined approach to security planning that eliminates unpleasant surprises and the temptation to grant elevated privileges as a quick fix.</span></span> <span data-ttu-id="1e19a-117">Для проверки можно использовать имя входа SQL Server, даже если приложение предназначено для развертывания и эксплуатации с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="1e19a-117">You can use a SQL Server login for testing even if your application is intended to deploy using Windows authentication.</span></span>  
  
## <a name="role-based-permissions"></a><span data-ttu-id="1e19a-118">Разрешения на основе ролей</span><span class="sxs-lookup"><span data-stu-id="1e19a-118">Role-Based Permissions</span></span>  
 <span data-ttu-id="1e19a-119">Если разрешения предоставляются ролям, а не пользователям, то администрирование средств безопасности упрощается.</span><span class="sxs-lookup"><span data-stu-id="1e19a-119">Granting permissions to roles rather than to users simplifies security administration.</span></span> <span data-ttu-id="1e19a-120">Наборы разрешений, назначенные ролям, становятся унаследованными всеми членами роли.</span><span class="sxs-lookup"><span data-stu-id="1e19a-120">Permission sets that are assigned to roles are inherited by all members of the role.</span></span> <span data-ttu-id="1e19a-121">Проще добавлять или удалять пользователей из состава членов роли, чем повторно создавать отдельные наборы разрешений для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="1e19a-121">It is easier to add or remove users from a role than it is to recreate separate permission sets for individual users.</span></span> <span data-ttu-id="1e19a-122">Роли могут быть вложенными; но применение слишком большого количества уровней вложенности может привести к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="1e19a-122">Roles can be nested; however, too many levels of nesting can degrade performance.</span></span> <span data-ttu-id="1e19a-123">Можно также вводить пользователей в состав членов предопределенных ролей базы данных в целях упрощения задачи назначения разрешений.</span><span class="sxs-lookup"><span data-stu-id="1e19a-123">You can also add users to fixed database roles to simplify assigning permissions.</span></span>  
  
 <span data-ttu-id="1e19a-124">Можно предоставлять разрешения на уровне схемы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-124">You can grant permissions at the schema level.</span></span> <span data-ttu-id="1e19a-125">Пользователи автоматически наследуют разрешения на все новые объекты, создаваемые в схеме; после создания новых объектов не требуется предоставлять для них разрешения.</span><span class="sxs-lookup"><span data-stu-id="1e19a-125">Users automatically inherit permissions on all new objects created in the schema; you do not need to grant permissions as new objects are created.</span></span>  
  
## <a name="permissions-through-procedural-code"></a><span data-ttu-id="1e19a-126">Управление разрешениями с помощью процедурного кода</span><span class="sxs-lookup"><span data-stu-id="1e19a-126">Permissions Through Procedural Code</span></span>  
 <span data-ttu-id="1e19a-127">Инкапсуляция средств доступа к данным с помощью таких модулей, как хранимые процедуры и определяемые пользователем функции, позволяет создать для приложения дополнительный уровень защиты.</span><span class="sxs-lookup"><span data-stu-id="1e19a-127">Encapsulating data access through modules such as stored procedures and user-defined functions provides an additional layer of protection around your application.</span></span> <span data-ttu-id="1e19a-128">Чтобы исключить для пользователей возможность непосредственно взаимодействовать с объектами базы данных, можно предоставлять им разрешения только на хранимые процедуры или функции и отказывать в предоставлении разрешений на базовые объекты, такие как таблицы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-128">You can prevent users from directly interacting with database objects by granting permissions only to stored procedures or functions while denying permissions to underlying objects such as tables.</span></span> <span data-ttu-id="1e19a-129">В СУБД SQL Server такая цель достигается путем формирования цепочек владения.</span><span class="sxs-lookup"><span data-stu-id="1e19a-129">SQL Server achieves this by ownership chaining.</span></span>  
  
## <a name="permission-statements"></a><span data-ttu-id="1e19a-130">Инструкции разрешения</span><span class="sxs-lookup"><span data-stu-id="1e19a-130">Permission Statements</span></span>  
 <span data-ttu-id="1e19a-131">Три инструкции разрешения языка Transact-SQL описаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="1e19a-131">The three Transact-SQL permission statements are described in the following table.</span></span>  
  
|<span data-ttu-id="1e19a-132">Инструкция разрешения</span><span class="sxs-lookup"><span data-stu-id="1e19a-132">Permission Statement</span></span>|<span data-ttu-id="1e19a-133">Описание</span><span class="sxs-lookup"><span data-stu-id="1e19a-133">Description</span></span>|  
|--------------------------|-----------------|  
|<span data-ttu-id="1e19a-134">GRANT</span><span class="sxs-lookup"><span data-stu-id="1e19a-134">GRANT</span></span>|<span data-ttu-id="1e19a-135">Предоставляет разрешение.</span><span class="sxs-lookup"><span data-stu-id="1e19a-135">Grants a permission.</span></span>|  
|<span data-ttu-id="1e19a-136">REVOKE</span><span class="sxs-lookup"><span data-stu-id="1e19a-136">REVOKE</span></span>|<span data-ttu-id="1e19a-137">Отменяет разрешение.</span><span class="sxs-lookup"><span data-stu-id="1e19a-137">Revokes a permission.</span></span> <span data-ttu-id="1e19a-138">Это — состояние нового объекта, предусмотренное по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1e19a-138">This is the default state of a new object.</span></span> <span data-ttu-id="1e19a-139">Разрешение, в котором отказано пользователю или роли, все еще может быть унаследовано от других групп или ролей, в которые назначен участник.</span><span class="sxs-lookup"><span data-stu-id="1e19a-139">A permission revoked from a user or role can still be inherited from other groups or roles to which the principal is assigned.</span></span>|  
|<span data-ttu-id="1e19a-140">DENY</span><span class="sxs-lookup"><span data-stu-id="1e19a-140">DENY</span></span>|<span data-ttu-id="1e19a-141">Инструкция DENY отменяет разрешение так, что его нельзя больше унаследовать.</span><span class="sxs-lookup"><span data-stu-id="1e19a-141">DENY revokes a permission so that it cannot be inherited.</span></span> <span data-ttu-id="1e19a-142">Инструкция DENY имеет наивысший приоритет по сравнению со всеми инструкциями разрешения, однако действие инструкции DENY не распространяется на владельцев объектов или на членов роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="1e19a-142">DENY takes precedence over all permissions, except DENY does not apply to object owners or members of `sysadmin`.</span></span> <span data-ttu-id="1e19a-143">Если осуществляется отзыв разрешений с помощью инструкции DENY на какой-либо объект по отношению к роли `public`, то этот отзыв распространяется на всех пользователей и все роли, кроме владельцев объекта и членов роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="1e19a-143">If you DENY permissions on an object to the `public` role it is denied to all users and roles except for object owners and `sysadmin` members.</span></span>|  
  
- <span data-ttu-id="1e19a-144">Инструкция GRANT позволяет назначать группе или роли разрешения, которые могут быть унаследованы пользователями базы данных.</span><span class="sxs-lookup"><span data-stu-id="1e19a-144">The GRANT statement can assign permissions to a group or role that can be inherited by database users.</span></span> <span data-ttu-id="1e19a-145">Но инструкция DENY имеет более высокий приоритет по сравнению со всеми другими инструкциями разрешения.</span><span class="sxs-lookup"><span data-stu-id="1e19a-145">However, the DENY statement takes precedence over all other permission statements.</span></span> <span data-ttu-id="1e19a-146">Поэтому пользователь, которому было отказано в разрешении, не сможет унаследовать его от другой роли.</span><span class="sxs-lookup"><span data-stu-id="1e19a-146">Therefore, a user who has been denied a permission cannot inherit it from another role.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1e19a-147">Членам предопределенной роли сервера `sysadmin` и владельцам объекта не может быть отказано в разрешениях.</span><span class="sxs-lookup"><span data-stu-id="1e19a-147">Members of the `sysadmin` fixed server role and object owners cannot be denied permissions.</span></span>  
  
## <a name="ownership-chains"></a><span data-ttu-id="1e19a-148">Цепочки владения</span><span class="sxs-lookup"><span data-stu-id="1e19a-148">Ownership Chains</span></span>  
 <span data-ttu-id="1e19a-149">SQL Server гарантирует, что только участники, которым были предоставлены разрешения, могут получить доступ к объектам.</span><span class="sxs-lookup"><span data-stu-id="1e19a-149">SQL Server ensures that only principals that have been granted permission can access objects.</span></span> <span data-ttu-id="1e19a-150">Если несколько объектов базы данных последовательно обращаются друг к другу, то такая последовательность известна как цепочка.</span><span class="sxs-lookup"><span data-stu-id="1e19a-150">When multiple database objects access each other, the sequence is known as a chain.</span></span> <span data-ttu-id="1e19a-151">В СУБД SQL Server при прохождении по ссылкам в цепочке владения проверка разрешений происходит иначе, чем при получении доступа отдельно к каждому объекту.</span><span class="sxs-lookup"><span data-stu-id="1e19a-151">When SQL Server is traversing the links in the chain, it evaluates permissions differently than it would if it were accessing each item separately.</span></span> <span data-ttu-id="1e19a-152">Если доступ к объекту осуществляется с помощью цепочки владения, то в SQL Server вначале сравнивается владелец объекта с владельцем вызывающего объекта (который представляет предыдущую ссылку в цепочке).</span><span class="sxs-lookup"><span data-stu-id="1e19a-152">When an object is accessed through a chain, SQL Server first compares the object's owner to the owner of the calling object (the previous link in the chain).</span></span> <span data-ttu-id="1e19a-153">Если оба объекта имеют одного владельца, то разрешения для объекта, указанного в ссылке, не проверяются.</span><span class="sxs-lookup"><span data-stu-id="1e19a-153">If both objects have the same owner, permissions on the referenced object are not checked.</span></span> <span data-ttu-id="1e19a-154">После обнаружения любой ситуации, в которой доступ к объекту осуществляется со стороны объекта, имеющего другого владельца, цепочка владения разрывается и в SQL Server должна быть выполнена проверка контекста безопасности вызывающего объекта.</span><span class="sxs-lookup"><span data-stu-id="1e19a-154">Whenever an object accesses another object that has a different owner, the ownership chain is broken and SQL Server must check the caller's security context.</span></span>  
  
## <a name="procedural-code-and-ownership-chaining"></a><span data-ttu-id="1e19a-155">Процедурный код и формирование цепочки владения</span><span class="sxs-lookup"><span data-stu-id="1e19a-155">Procedural Code and Ownership Chaining</span></span>  
 <span data-ttu-id="1e19a-156">Предположим, что пользователю предоставлены права на выполнение хранимой процедуры, которая предназначена для выборки данных из таблицы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-156">Suppose that a user is granted execute permissions on a stored procedure that selects data from a table.</span></span> <span data-ttu-id="1e19a-157">Если хранимая процедура и таблица имеют одного и того же владельца, то пользователю не требуется предоставлять какие-либо разрешения на таблицу и ему может быть даже отказано в таких разрешениях.</span><span class="sxs-lookup"><span data-stu-id="1e19a-157">If the stored procedure and the table have the same owner, the user doesn't need to be granted any permissions on the table and can even be denied permissions.</span></span> <span data-ttu-id="1e19a-158">Но если хранимая процедура и таблица имеют разных владельцев, то в СУБД SQL Server требуется проверить разрешения пользователя на таблицу, прежде чем предоставить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="1e19a-158">However, if the stored procedure and the table have different owners, SQL Server must check the user's permissions on the table before allowing access to the data.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1e19a-159">Формирование цепочки владения не применяется в случае выполнения динамических инструкций SQL.</span><span class="sxs-lookup"><span data-stu-id="1e19a-159">Ownership chaining does not apply in the case of dynamic SQL statements.</span></span> <span data-ttu-id="1e19a-160">Чтобы вызвать процедуру, в которой выполняется инструкция SQL, вызывающему объекту необходимо предоставить разрешения на базовые таблицы, в результате чего приложение становится уязвимым для атаки путем внедрения кода SQL.</span><span class="sxs-lookup"><span data-stu-id="1e19a-160">To call a procedure that executes an SQL statement, the caller must be granted permissions on the underlying tables, leaving your application vulnerable to SQL Injection attack.</span></span> <span data-ttu-id="1e19a-161">SQL Server предоставляет новые механизмы, такие как олицетворение и подписание модулей с помощью сертификатов, не требующие предоставления разрешений на базовые таблицы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-161">SQL Server provides new mechanisms, such as impersonation and signing modules with certificates, that do not require granting permissions on the underlying tables.</span></span> <span data-ttu-id="1e19a-162">Эти механизмы могут также использоваться для работы с хранимыми процедурами среды CLR.</span><span class="sxs-lookup"><span data-stu-id="1e19a-162">These can also be used with CLR stored procedures.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="1e19a-163">Внешние ресурсы</span><span class="sxs-lookup"><span data-stu-id="1e19a-163">External Resources</span></span>  
 <span data-ttu-id="1e19a-164">Для получения дополнительных сведений см. следующие ресурсы.</span><span class="sxs-lookup"><span data-stu-id="1e19a-164">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="1e19a-165">Ресурс</span><span class="sxs-lookup"><span data-stu-id="1e19a-165">Resource</span></span>|<span data-ttu-id="1e19a-166">Описание</span><span class="sxs-lookup"><span data-stu-id="1e19a-166">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="1e19a-167">Разрешения</span><span class="sxs-lookup"><span data-stu-id="1e19a-167">Permissions</span></span>](/sql/relational-databases/security/permissions-database-engine)|<span data-ttu-id="1e19a-168">Содержит разделы, описывающие иерархию разрешений, представления каталога и разрешения предопределенных ролей сервера и базы данных.</span><span class="sxs-lookup"><span data-stu-id="1e19a-168">Contains topics describing permissions hierarchy, catalog views, and permissions of fixed server and database roles.</span></span>|
  
## <a name="see-also"></a><span data-ttu-id="1e19a-169">См. также</span><span class="sxs-lookup"><span data-stu-id="1e19a-169">See also</span></span>

- [<span data-ttu-id="1e19a-170">Защита приложений ADO.NET</span><span class="sxs-lookup"><span data-stu-id="1e19a-170">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="1e19a-171">Сценарии безопасности приложений в SQL Server</span><span class="sxs-lookup"><span data-stu-id="1e19a-171">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="1e19a-172">Аутентификация в SQL Server</span><span class="sxs-lookup"><span data-stu-id="1e19a-172">Authentication in SQL Server</span></span>](authentication-in-sql-server.md)
- [<span data-ttu-id="1e19a-173">Роли сервера и базы данных в SQL Server</span><span class="sxs-lookup"><span data-stu-id="1e19a-173">Server and Database Roles in SQL Server</span></span>](server-and-database-roles-in-sql-server.md)
- [<span data-ttu-id="1e19a-174">Владение и отделение пользователей от схем в SQL Server</span><span class="sxs-lookup"><span data-stu-id="1e19a-174">Ownership and User-Schema Separation in SQL Server</span></span>](ownership-and-user-schema-separation-in-sql-server.md)
- [<span data-ttu-id="1e19a-175">Общие сведения об ADO.NET</span><span class="sxs-lookup"><span data-stu-id="1e19a-175">ADO.NET Overview</span></span>](../ado-net-overview.md)
