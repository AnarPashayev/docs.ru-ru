---
title: Пользовательские экземпляры SQL Server, экспресс-выпуск
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
ms.openlocfilehash: b456549daefa0fdf67524b0b039a091652cf41ff
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61876282"
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="4b58b-102">Пользовательские экземпляры SQL Server, экспресс-выпуск</span><span class="sxs-lookup"><span data-stu-id="4b58b-102">SQL Server Express User Instances</span></span>
<span data-ttu-id="4b58b-103">Выпуск Microsoft SQL Server Express Edition (SQL Server Express) поддерживает пользовательский экземпляр, который доступен только при использовании поставщика данных .NET Framework для SQL Server (`SqlClient`).</span><span class="sxs-lookup"><span data-stu-id="4b58b-103">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="4b58b-104">Пользовательским экземпляром является отдельный экземпляр компонента SQL Server Express Database Engine, который формируется родительским экземпляром.</span><span class="sxs-lookup"><span data-stu-id="4b58b-104">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="4b58b-105">Пользовательские экземпляры позволяют пользователям, не являющимся администраторами на их локальных компьютерах, присоединяться и подключаться к базам данных SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="4b58b-105">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="4b58b-106">Каждый экземпляр выполняется в контексте безопасности отдельного пользователя, один экземпляр на одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="4b58b-106">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="4b58b-107">Возможности пользовательского экземпляра</span><span class="sxs-lookup"><span data-stu-id="4b58b-107">User Instance Capabilities</span></span>  
 <span data-ttu-id="4b58b-108">Пользовательские экземпляры полезны для пользователей, работающих в операционной системе Windows под учетной записью с наименьшими правами доступа (LUA), т. к. у каждого пользователя имеются права доступа системного администратора SQL Server (`sysadmin`) на экземпляре, выполняющемся на его компьютере, при этом нет необходимости иметь также права администратора Windows.</span><span class="sxs-lookup"><span data-stu-id="4b58b-108">User instances are useful for users who are running Windows under a least-privilege user account (LUA) because each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on her computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="4b58b-109">Программное обеспечение, выполняющееся в пользовательском экземпляре с ограниченными разрешениями, не может выполнять общесистемные изменения, т. к. экземпляр SQL Server Express выполняется под учетной записью пользователя без прав администратора Windows и не как служба.</span><span class="sxs-lookup"><span data-stu-id="4b58b-109">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="4b58b-110">Каждый пользовательский экземпляр изолирован от родительского и любых других пользовательских экземпляров, выполняющихся на том же компьютере.</span><span class="sxs-lookup"><span data-stu-id="4b58b-110">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="4b58b-111">Базы данных, выполняющиеся в пользовательском экземпляре, открываются только в однопользовательском режиме, и для нескольких пользователей невозможно подключаться к базам данных, выполняющимся в пользовательском экземпляре.</span><span class="sxs-lookup"><span data-stu-id="4b58b-111">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="4b58b-112">Репликация и распределенные запросы для пользовательских экземпляров также отключены.</span><span class="sxs-lookup"><span data-stu-id="4b58b-112">Replication and distributed queries are also disabled for user instances.</span></span>  
  
 <span data-ttu-id="4b58b-113">Дополнительные сведения см. в разделе «Пользовательские экземпляры» электронной документации по SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b58b-113">For more information, see "User Instances" in SQL Server Books Online.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-114">Пользовательские экземпляры не нужны для пользователей, которые уже являются администраторами на своих собственных компьютерах, или для сценариев, включающих несколько пользователей баз данных.</span><span class="sxs-lookup"><span data-stu-id="4b58b-114">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="4b58b-115">Включение пользовательских экземпляров</span><span class="sxs-lookup"><span data-stu-id="4b58b-115">Enabling User Instances</span></span>  
 <span data-ttu-id="4b58b-116">Для формирования пользовательских экземпляров должен выполняться родительский экземпляр SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="4b58b-116">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="4b58b-117">Пользовательские экземпляры включены по умолчанию, когда SQL Server Express установлен, и явным образом включен или отключен администратором системы, выполняющим **sp_configure** системной хранимой процедуры на родительском экземпляре.</span><span class="sxs-lookup"><span data-stu-id="4b58b-117">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```  
-- Enable user instances.  
sp_configure 'user instances enabled','1'   
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="4b58b-118">Для пользовательских экземпляров поддерживается только сетевой протокол локальных именованных каналов.</span><span class="sxs-lookup"><span data-stu-id="4b58b-118">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="4b58b-119">Пользовательский экземпляр не может быть запущен на удаленном экземпляре SQL Server, и имена входа SQL Server не разрешаются.</span><span class="sxs-lookup"><span data-stu-id="4b58b-119">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="4b58b-120">Соединение с пользовательским экземпляром</span><span class="sxs-lookup"><span data-stu-id="4b58b-120">Connecting to a User Instance</span></span>  
 <span data-ttu-id="4b58b-121">`User Instance` И `AttachDBFilename` <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> ключевые слова поддерживают <xref:System.Data.SqlClient.SqlConnection> для подключения к пользовательскому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="4b58b-121">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="4b58b-122">Пользовательские экземпляры также поддерживаются свойствами <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` и `AttachDBFilename`.</span><span class="sxs-lookup"><span data-stu-id="4b58b-122">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="4b58b-123">Следует отметить следующее относительно образца строки соединения, показанного далее.</span><span class="sxs-lookup"><span data-stu-id="4b58b-123">Note the following about the sample connection string shown below:</span></span>  
  
- <span data-ttu-id="4b58b-124">Ключевое слово `Data Source` ссылается на родительский экземпляр SQL Server Express, который формирует пользовательский экземпляр.</span><span class="sxs-lookup"><span data-stu-id="4b58b-124">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="4b58b-125">Экземпляром по умолчанию является .\sqlexpress.</span><span class="sxs-lookup"><span data-stu-id="4b58b-125">The default instance is .\sqlexpress.</span></span>  
  
- <span data-ttu-id="4b58b-126">Параметру `Integrated Security` задается значение `true`.</span><span class="sxs-lookup"><span data-stu-id="4b58b-126">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="4b58b-127">Чтобы подключиться к пользовательскому экземпляру, требуется проверка подлинности Windows; имена входа SQL Server не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="4b58b-127">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
- <span data-ttu-id="4b58b-128">Для `User Instance` установлено значение `true`, которое вызывает экземпляр пользователя.</span><span class="sxs-lookup"><span data-stu-id="4b58b-128">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="4b58b-129">(По умолчанию используется `false`.)</span><span class="sxs-lookup"><span data-stu-id="4b58b-129">(The default is `false`.)</span></span>  
  
- <span data-ttu-id="4b58b-130">Ключевое слово строки соединения `AttachDbFileName` служит для прикрепления первичного файла базы данных (MDF), который должен включать полный путь имени.</span><span class="sxs-lookup"><span data-stu-id="4b58b-130">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="4b58b-131">Ключевое слово `AttachDbFileName` также соответствует ключам «расширенные свойства» и «исходное имя файла» в строке соединения <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="4b58b-131">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
- <span data-ttu-id="4b58b-132">Строка подстановки `|DataDirectory|`, заключенная в символы конвейера, ссылается на каталог данных приложения, открывающего соединение, и предоставляет относительный путь, указывающий местоположение баз данных MDF и LDF, а также файлы журналов.</span><span class="sxs-lookup"><span data-stu-id="4b58b-132">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="4b58b-133">Если нужно найти эти файлы, необходимо предоставить полный путь к файлам.</span><span class="sxs-lookup"><span data-stu-id="4b58b-133">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-134">Свойства <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> и <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> также можно использовать для создания строки подключения во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-134">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="4b58b-135">С помощью &#124;DataDirectory&#124; строка подстановки</span><span class="sxs-lookup"><span data-stu-id="4b58b-135">Using the &#124;DataDirectory&#124; Substitution String</span></span>  
 <span data-ttu-id="4b58b-136">Свойство `AttachDbFileName` в ADO.NET 2.0 было расширено, в нем появилась строка подстановки `|DataDirectory|` (заключается в символы прямой черты).</span><span class="sxs-lookup"><span data-stu-id="4b58b-136">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="4b58b-137">`DataDirectory` в сочетании со свойством `AttachDbFileName` позволяет указать относительный путь к файлу данных, тем самым позволяя разработчикам создавать строки соединения без указания полного пути к источнику данных.</span><span class="sxs-lookup"><span data-stu-id="4b58b-137">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="4b58b-138">Физическое расположение, на которое указывает `DataDirectory`, зависит от типа приложения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-138">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="4b58b-139">В этом примере нужный файл Northwind.mdf находится в папке приложения \app_data.</span><span class="sxs-lookup"><span data-stu-id="4b58b-139">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="4b58b-140">Если используется строка подстановки `DataDirectory`, то полученный в результате путь к файлу может находиться выше в структуре каталогов, чем каталог, на который указывает строка подстановки.</span><span class="sxs-lookup"><span data-stu-id="4b58b-140">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="4b58b-141">Например, если полностью развернутая строка `DataDirectory` - это C:\AppDirectory\app_data, то показанный выше образец строки соединения работает, поскольку находится ниже c:\AppDirectory.</span><span class="sxs-lookup"><span data-stu-id="4b58b-141">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="4b58b-142">Но попытка задать `DataDirectory` как `|DataDirectory|\..\data` завершится ошибкой, потому что «\data» не является подкаталогом «\AppDirectory».</span><span class="sxs-lookup"><span data-stu-id="4b58b-142">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="4b58b-143">Если в строке соединения содержится неправильно сформированная строка подстановки, то будет вызвано исключение <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="4b58b-143">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-144"><xref:System.Data.SqlClient> преобразует строки подстановки в полные пути файловой системы локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="4b58b-144"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="4b58b-145">Поэтому удалите неподдерживаемые пути удаленного сервера, HTTP и UNC.</span><span class="sxs-lookup"><span data-stu-id="4b58b-145">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="4b58b-146">Исключение вызывается при открытии соединения, если сервер не расположен на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="4b58b-146">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="4b58b-147">Если <xref:System.Data.SqlClient.SqlConnection> открыто, оно перенаправляется от экземпляра по умолчанию SQL Server Express на инициированный экземпляр времени исполнения, выполняющийся под учетной записью вызывающего.</span><span class="sxs-lookup"><span data-stu-id="4b58b-147">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-148">Может быть необходимым увеличить значение <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A>, т. к. для пользовательских экземпляров может понадобиться для загрузки больше времени, чем для обычных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="4b58b-148">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="4b58b-149">В следующем фрагменте кода открывается новое `SqlConnection`, отображается строка соединения в окне консоли, а затем при выходе из блока кода `using` подключение закрывается.</span><span class="sxs-lookup"><span data-stu-id="4b58b-149">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =   
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",   
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-150">Пользовательские экземпляры не поддерживаются в коде среды CLR, который выполняется внутри SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b58b-150">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="4b58b-151"><xref:System.InvalidOperationException> вызывается, если `Open` вызывается на <xref:System.Data.SqlClient.SqlConnection>, которое имеет `User Instance=true` в строке соединения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-151">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="4b58b-152">Время существования соединения пользовательского экземпляра</span><span class="sxs-lookup"><span data-stu-id="4b58b-152">Lifetime of a User Instance Connection</span></span>  
 <span data-ttu-id="4b58b-153">В отличие от версий SQL Server, которые выполняется как служба, экземпляры SQL Server Express не нужно запускать и останавливать вручную.</span><span class="sxs-lookup"><span data-stu-id="4b58b-153">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="4b58b-154">Каждый раз, когда пользователь входит в систему и подключается к пользовательскому интерфейсу, пользовательский экземпляр запускается, если он еще не запущен.</span><span class="sxs-lookup"><span data-stu-id="4b58b-154">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="4b58b-155">Базы данных пользовательского экземпляра имеют параметр `AutoClose`, установленный таким образом, что база данных автоматически завершает работу после периода неактивности.</span><span class="sxs-lookup"><span data-stu-id="4b58b-155">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="4b58b-156">Запущенный процесс sqlservr.exe выполняется в течение ограниченного времени ожидания после закрытия последнего соединения с экземпляром, так что его не нужно перезапускать, если другое соединение открыто до истечения времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="4b58b-156">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="4b58b-157">Пользовательский экземпляр автоматически завершает работу, если до истечения времени ожидания не открывается ни одного нового соединения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-157">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="4b58b-158">Длительность периода ожидания для пользовательского экземпляра системным администратором на родительском экземпляре можно задать с помощью **sp_configure** изменение **время ожидания пользовательского экземпляра** параметр.</span><span class="sxs-lookup"><span data-stu-id="4b58b-158">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="4b58b-159">Значение по умолчанию - 60 минут.</span><span class="sxs-lookup"><span data-stu-id="4b58b-159">The default is 60 minutes.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-160">Если `Min Pool Size` используется в строке соединения со значением, большим нуля, организаторов пулов соединений будет всегда поддерживать несколько открытых соединений и пользовательский экземпляр не будет завершать свою работу.</span><span class="sxs-lookup"><span data-stu-id="4b58b-160">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="4b58b-161">Работа пользовательских экземпляров</span><span class="sxs-lookup"><span data-stu-id="4b58b-161">How User Instances Work</span></span>  
 <span data-ttu-id="4b58b-162">При первом создании пользовательского экземпляра создается для каждого пользователя **master** и **msdb** системные базы данных копируются из папки Template Data в путь в репозитории данных локального приложения пользователя каталог для монопольного использования пользовательским экземпляром.</span><span class="sxs-lookup"><span data-stu-id="4b58b-162">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="4b58b-163">Обычно это путь `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span><span class="sxs-lookup"><span data-stu-id="4b58b-163">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="4b58b-164">При запуске пользовательский экземпляр, **tempdb**, журнала и трассировки файлы также записываются в этот каталог.</span><span class="sxs-lookup"><span data-stu-id="4b58b-164">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="4b58b-165">Создается имя экземпляра, уникальное для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4b58b-165">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="4b58b-166">По умолчанию всем членам группы Windows Builtin\Users предоставляются разрешения для подключения к локальному экземпляру, а также разрешения на чтение и выполнение в выполняемых файлах SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b58b-166">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="4b58b-167">После проверки учетных данных вызывающего пользователя, на которых основан пользовательский экземпляр, пользователь становится `sysadmin` на этом экземпляре.</span><span class="sxs-lookup"><span data-stu-id="4b58b-167">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="4b58b-168">Для пользовательских экземпляров включена только общая память, это означает, что возможны только операции на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="4b58b-168">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="4b58b-169">Пользователям необходимо предоставить разрешения как для чтения, так и для записи в файлы MDF и LDF, указанные в строке соединения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-169">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4b58b-170">Файлы MDF и LDF представляют файлы базы данных и журнала соответственно.</span><span class="sxs-lookup"><span data-stu-id="4b58b-170">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="4b58b-171">Эти два файла являются согласованным набором, так что во время операций резервного копирования и восстановления следует проявлять осторожность.</span><span class="sxs-lookup"><span data-stu-id="4b58b-171">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="4b58b-172">Файл базы данных содержит сведения о точной версии файла журнала, и база данных не откроется, если она сочетается с неверным файлом журнала.</span><span class="sxs-lookup"><span data-stu-id="4b58b-172">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="4b58b-173">Для предотвращения повреждения данных база данных в пользовательском экземпляре открывается с монопольным доступом.</span><span class="sxs-lookup"><span data-stu-id="4b58b-173">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="4b58b-174">Если два разных пользовательских интерфейса используют одну и ту же общую базу данных на одном компьютере, пользователь на первом экземпляре должен закрыть базу данных перед тем, как ее можно будет открыть на втором экземпляре.</span><span class="sxs-lookup"><span data-stu-id="4b58b-174">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="4b58b-175">Сценарии пользовательских экземпляров</span><span class="sxs-lookup"><span data-stu-id="4b58b-175">User Instance Scenarios</span></span>  
 <span data-ttu-id="4b58b-176">Пользовательские экземпляры предоставляют разработчикам приложений баз данных хранилище данных SQL Server, которое не зависит от разработчиков, имеющих административные учетные записи в своих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="4b58b-176">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="4b58b-177">Пользовательские экземпляры основаны на модели Access/Jet, в которой приложение базы данных просто соединяется с файлом, и пользователь автоматически имеет все разрешения на всех объектах базы данных без необходимости вмешательства системного администратора для предоставления разрешений.</span><span class="sxs-lookup"><span data-stu-id="4b58b-177">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="4b58b-178">Они предназначены для работы в ситуациях, в которых пользователь работает с учетной записью, имеющей наименьшие права доступа (LUA), и не имеет административных прав доступа на сервере или локальном компьютере, но ему нужно создавать объекты и приложения базы данных.</span><span class="sxs-lookup"><span data-stu-id="4b58b-178">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="4b58b-179">Пользовательские экземпляры позволяют пользователям создавать экземпляры во время выполнения в своем собственном контексте безопасности, а не в контексте безопасности системной службы с более широкими правами доступа.</span><span class="sxs-lookup"><span data-stu-id="4b58b-179">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="4b58b-180">Пользовательские экземпляры должны использоваться только в сценариях, в которых все использующие его приложения являются полностью доверенными.</span><span class="sxs-lookup"><span data-stu-id="4b58b-180">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="4b58b-181">Сценарии пользовательских экземпляров включают следующее.</span><span class="sxs-lookup"><span data-stu-id="4b58b-181">User instance scenarios include:</span></span>  
  
- <span data-ttu-id="4b58b-182">Однопользовательское приложение, в котором обмен данными не требуется.</span><span class="sxs-lookup"><span data-stu-id="4b58b-182">Any single-user application where sharing data is not required.</span></span>  
  
- <span data-ttu-id="4b58b-183">Развертывание ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="4b58b-183">ClickOnce deployment.</span></span> <span data-ttu-id="4b58b-184">Если .NET Framework 2.0 (или более поздняя версия) и SQL Server Express уже установлены на целевом компьютере, пакет установки, загруженный как результат действия ClickOnce, может быть установлен и использован пользователями, не имеющими административных привилегий.</span><span class="sxs-lookup"><span data-stu-id="4b58b-184">If the .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="4b58b-185">Следует отметить, что администратор должен установить SQL Server Express, если он является частью установки.</span><span class="sxs-lookup"><span data-stu-id="4b58b-185">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="4b58b-186">Дополнительные сведения см. в разделе [ClickOnce Deployment for Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span><span class="sxs-lookup"><span data-stu-id="4b58b-186">For more information, see [ClickOnce Deployment for Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span></span>
  
- <span data-ttu-id="4b58b-187">Специальное размещение ASP.NET с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="4b58b-187">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="4b58b-188">Один экземпляр SQL Server Express может быть размещен в интрасети.</span><span class="sxs-lookup"><span data-stu-id="4b58b-188">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="4b58b-189">Приложение подключается с использованием учетной записи ASPNET Windows, а не при помощи олицетворения.</span><span class="sxs-lookup"><span data-stu-id="4b58b-189">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="4b58b-190">Пользовательские экземпляры не должны использоваться для сценариев сторонних производителей или общего размещения, где все приложения используют общий пользовательский экземпляр и больше не остаются изолированными друг от друга.</span><span class="sxs-lookup"><span data-stu-id="4b58b-190">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4b58b-191">См. также</span><span class="sxs-lookup"><span data-stu-id="4b58b-191">See also</span></span>

- [<span data-ttu-id="4b58b-192">SQL Server и ADO.NET</span><span class="sxs-lookup"><span data-stu-id="4b58b-192">SQL Server and ADO.NET</span></span>](../../../../../docs/framework/data/adonet/sql/index.md)
- [<span data-ttu-id="4b58b-193">Строки подключения</span><span class="sxs-lookup"><span data-stu-id="4b58b-193">Connection Strings</span></span>](../../../../../docs/framework/data/adonet/connection-strings.md)
- [<span data-ttu-id="4b58b-194">Подключение к источнику данных</span><span class="sxs-lookup"><span data-stu-id="4b58b-194">Connecting to a Data Source</span></span>](../../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)
- [<span data-ttu-id="4b58b-195">Центр разработчиков наборов данных и управляемых поставщиков ADO.NET</span><span class="sxs-lookup"><span data-stu-id="4b58b-195">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
