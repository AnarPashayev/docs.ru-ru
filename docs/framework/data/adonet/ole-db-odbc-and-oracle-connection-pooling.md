---
title: OLE DB, ODBC и объединение подключений в пул в Oracle
ms.date: 03/30/2017
ms.assetid: 2bd83b1e-3ea9-43c4-bade-d9cdb9bbbb04
ms.openlocfilehash: 58ea5aa54a0f6acbc8d2400dd04eeba9ff498055
ms.sourcegitcommit: 8c99457955fc31785b36b3330c4ab6ce7984a7ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/29/2019
ms.locfileid: "75545040"
---
# <a name="ole-db-odbc-and-oracle-connection-pooling"></a><span data-ttu-id="f7021-102">Пулы соединений OLE DB, ODBC и Oracle</span><span class="sxs-lookup"><span data-stu-id="f7021-102">OLE DB, ODBC, and Oracle connection pooling</span></span>

<span data-ttu-id="f7021-103">Организация пулов соединений может существенно улучшить производительность и масштабируемость приложения.</span><span class="sxs-lookup"><span data-stu-id="f7021-103">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="f7021-104">В этом разделе обсуждаются пулы соединений для .NET Framework поставщиков данных для OLE DB, ODBC и Oracle.</span><span class="sxs-lookup"><span data-stu-id="f7021-104">This section discusses connection pooling for the .NET Framework data providers for OLE DB, ODBC, and Oracle.</span></span>

## <a name="oledb"></a><span data-ttu-id="f7021-105">OleDb</span><span class="sxs-lookup"><span data-stu-id="f7021-105">OleDb</span></span>

<span data-ttu-id="f7021-106">Поставщик данных .NET Framework для OLE DB автоматически создает пулы соединений, используя пулы сеанса OLE DB.</span><span class="sxs-lookup"><span data-stu-id="f7021-106">The .NET Framework Data Provider for OLE DB automatically pools connections using OLE DB session pooling.</span></span> <span data-ttu-id="f7021-107">Аргументы строки соединения могут использоваться для включения или отключения служб OLE DB, включая службы пулов.</span><span class="sxs-lookup"><span data-stu-id="f7021-107">Connection string arguments can be used to enable or disable OLE DB services including pooling.</span></span> <span data-ttu-id="f7021-108">Например, следующая строка соединения отключает пулы сеанса OLE DB и автоматическое прикрепление транзакций.</span><span class="sxs-lookup"><span data-stu-id="f7021-108">For example, the following connection string disables OLE DB session pooling and automatic transaction enlistment.</span></span>

```csharp
Provider=SQLOLEDB;OLE DB Services=-4;Data Source=localhost;Integrated Security=SSPI;
```

 <span data-ttu-id="f7021-109">Рекомендуется всегда закрывать или удалять соединение при завершении работы, чтобы вернуть его в пул.</span><span class="sxs-lookup"><span data-stu-id="f7021-109">We recommend that you always close or dispose of a connection when you are finished using it in order to return the connection to the pool.</span></span> <span data-ttu-id="f7021-110">Соединения, которые явно не закрыты, нельзя вернуть в пул.</span><span class="sxs-lookup"><span data-stu-id="f7021-110">Connections that are not explicitly closed may not get returned to the pool.</span></span> <span data-ttu-id="f7021-111">Например, соединение, которое вышло за пределы области, но явно закрыто не было, будет возвращено в пул соединений только в том случае, если был достигнут максимальный размер этого пула, а соединение еще действует.</span><span class="sxs-lookup"><span data-stu-id="f7021-111">For example, a connection that has gone out of scope but that has not been explicitly closed will only be returned to the connection pool if the maximum pool size has been reached and the connection is still valid.</span></span>

 <span data-ttu-id="f7021-112">Дополнительные сведения о OLE DB сеансах или пулах ресурсов, а также о том, как отключить пулы путем переопределения значений по умолчанию службы поставщика OLE DB, см. в разделе [руководство программиста OLE DB](https://docs.microsoft.com/previous-versions/windows/desktop/ms713643(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="f7021-112">For more information about OLE DB session or resource pooling, as well as how to disable pooling by overriding OLE DB provider service defaults, see the [OLE DB Programmer's Guide](https://docs.microsoft.com/previous-versions/windows/desktop/ms713643(v=vs.85)).</span></span>

## <a name="odbc"></a><span data-ttu-id="f7021-113">ODBC</span><span class="sxs-lookup"><span data-stu-id="f7021-113">ODBC</span></span>
 <span data-ttu-id="f7021-114">Пулы соединений поставщика данных .NET Framework для ODBC управляются диспетчером драйверов ODBC для этого соединения и не зависят от поставщика данных .NET Framework для ODBC.</span><span class="sxs-lookup"><span data-stu-id="f7021-114">Connection pooling for the .NET Framework Data Provider for ODBC is managed by the ODBC Driver Manager that is used for the connection, and is not affected by the .NET Framework Data Provider for ODBC.</span></span>

 <span data-ttu-id="f7021-115">Чтобы включить или отключить пулы подключений, откройте оснастку « **Администратор источников данных ODBC** » в папке «Администрирование» панели управления.</span><span class="sxs-lookup"><span data-stu-id="f7021-115">To enable or disable connection pooling, open **ODBC Data Source Administrator** in the Administrative Tools folder of Control Panel.</span></span> <span data-ttu-id="f7021-116">Вкладка **пул соединений** позволяет указать параметры пула соединений для каждого установленного драйвера ODBC.</span><span class="sxs-lookup"><span data-stu-id="f7021-116">The **Connection Pooling** tab allows you to specify connection pooling parameters for each ODBC driver installed.</span></span> <span data-ttu-id="f7021-117">Изменения пулов соединений для определенного драйвера ODBC влияют на все приложения, использующие этот драйвер ODBC.</span><span class="sxs-lookup"><span data-stu-id="f7021-117">Connection pooling changes for a specific ODBC driver affect all applications that use that ODBC driver.</span></span>

## <a name="oracleclient"></a><span data-ttu-id="f7021-118">OracleClient</span><span class="sxs-lookup"><span data-stu-id="f7021-118">OracleClient</span></span>
 <span data-ttu-id="f7021-119">Поставщик данных .NET Framework для Oracle автоматически поддерживает пулы соединений для клиентского приложения ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f7021-119">The .NET Framework Data Provider for Oracle provides connection pooling automatically for your ADO.NET client application.</span></span> <span data-ttu-id="f7021-120">Для управления пулами соединений можно также указать несколько модификаторов строки соединения (см. подраздел «Управление пулами соединений с помощью ключевых слов строки соединения» ниже в этом разделе).</span><span class="sxs-lookup"><span data-stu-id="f7021-120">You can also supply several connection string modifiers to control connection pooling behavior (see "Controlling Connection Pooling with Connection String Keywords," later in this topic).</span></span>

### <a name="create-and-assign-pools"></a><span data-ttu-id="f7021-121">Создание и назначение пулов</span><span class="sxs-lookup"><span data-stu-id="f7021-121">Create and assign pools</span></span>
 <span data-ttu-id="f7021-122">При открытии соединения создается пул соединений на основе существующего алгоритма сопоставления, связывающего этот пул со строкой соединения.</span><span class="sxs-lookup"><span data-stu-id="f7021-122">When a connection is opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="f7021-123">Каждый пул соединений связывается с отдельной строкой соединения.</span><span class="sxs-lookup"><span data-stu-id="f7021-123">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="f7021-124">При открытии нового соединения, если строка соединения не соответствует в точности существующему пулу, создается новый пул.</span><span class="sxs-lookup"><span data-stu-id="f7021-124">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span>

 <span data-ttu-id="f7021-125">После создания пулы соединений не освобождаются, пока не завершится активный процесс.</span><span class="sxs-lookup"><span data-stu-id="f7021-125">Once created, connection pools are not destroyed until the active process ends.</span></span> <span data-ttu-id="f7021-126">На поддержку неактивных или пустых пулов затрачивается очень мало системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f7021-126">Maintaining inactive or empty pools uses very few system resources.</span></span>

### <a name="connection-addition"></a><span data-ttu-id="f7021-127">Добавление соединения</span><span class="sxs-lookup"><span data-stu-id="f7021-127">Connection Addition</span></span>
 <span data-ttu-id="f7021-128">Пул соединений создается для каждой уникальной строки соединения.</span><span class="sxs-lookup"><span data-stu-id="f7021-128">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="f7021-129">При создании пула создается множество объектов соединения, которые добавляются в пул для удовлетворения требования к минимальному размеру пула.</span><span class="sxs-lookup"><span data-stu-id="f7021-129">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="f7021-130">Соединения добавляются в пул по мере надобности, пока не будет достигнут максимальный размер пула.</span><span class="sxs-lookup"><span data-stu-id="f7021-130">Connections are added to the pool as needed, up to the maximum pool size.</span></span>

 <span data-ttu-id="f7021-131">Когда запрашивается объект <xref:System.Data.OracleClient.OracleConnection>, он извлекается из пула при наличии подходящего соединения.</span><span class="sxs-lookup"><span data-stu-id="f7021-131">When an <xref:System.Data.OracleClient.OracleConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="f7021-132">Соединение считается подходящим, если оно в настоящий момент не используется, имеет соответствующий контекст транзакции или не связано с каким-либо контекстом транзакции, а также имеет допустимую ссылку на сервер.</span><span class="sxs-lookup"><span data-stu-id="f7021-132">To be usable, the connection must currently be unused, have a matching transaction context or not be associated with any transaction context, and have a valid link to the server.</span></span>

 <span data-ttu-id="f7021-133">Если достигнут максимальный размер пула, а пригодные соединения недоступны, запрос помещается в очередь.</span><span class="sxs-lookup"><span data-stu-id="f7021-133">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="f7021-134">Средство управления пулом соединений обрабатывает эти запросы, перераспределяя соединения по мере их освобождения.</span><span class="sxs-lookup"><span data-stu-id="f7021-134">The connection pooler satisfies these requests by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="f7021-135">Соединения освобождаются обратно в пул при закрытии или ликвидации.</span><span class="sxs-lookup"><span data-stu-id="f7021-135">Connections are released back into the pool when they are closed or disposed.</span></span>

### <a name="connection-removal"></a><span data-ttu-id="f7021-136">Удаление соединений</span><span class="sxs-lookup"><span data-stu-id="f7021-136">Connection Removal</span></span>
 <span data-ttu-id="f7021-137">Пул подключений удаляет подключение из пула после бездействия в течение продолжительного периода времени или в случае, если пул обнаруживает, что подключение к серверу было разорвано.</span><span class="sxs-lookup"><span data-stu-id="f7021-137">The connection pooler removes a connection from the pool after it has been idle for an extended period of time or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="f7021-138">Это можно обнаружить только после попытки установить связь с сервером.</span><span class="sxs-lookup"><span data-stu-id="f7021-138">This can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="f7021-139">При обнаружении соединения, которое больше не имеет связи с сервером, оно помечается как недействительное.</span><span class="sxs-lookup"><span data-stu-id="f7021-139">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="f7021-140">Средство управления пулом соединений периодически просматривает пулы соединений в поиске объектов, освобожденных в пул и маркированных как недопустимые.</span><span class="sxs-lookup"><span data-stu-id="f7021-140">The connection pooler periodically scans connection pools looking for objects that have been released to the pool and are marked as invalid.</span></span> <span data-ttu-id="f7021-141">Эти соединения удаляются.</span><span class="sxs-lookup"><span data-stu-id="f7021-141">These connections are then permanently removed.</span></span>

 <span data-ttu-id="f7021-142">Если существует соединение с пропавшим сервером, его можно извлечь из пула, если организатор пулов соединений не обнаружил разрыва соединения и не отметил его как недействительное.</span><span class="sxs-lookup"><span data-stu-id="f7021-142">If a connection exists to a server that has disappeared, this connection can be drawn from the pool if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="f7021-143">Если это происходит, вызывается исключение.</span><span class="sxs-lookup"><span data-stu-id="f7021-143">When this occurs, an exception is generated.</span></span> <span data-ttu-id="f7021-144">Однако чтобы освободить соединение обратно в пул, его нужно закрыть.</span><span class="sxs-lookup"><span data-stu-id="f7021-144">However, you must still close the connection in order to release it back into the pool.</span></span>

 <span data-ttu-id="f7021-145">В методе `Close` вашего класса нельзя вызывать методы `Dispose` или `Connection` объектов `DataReader`, `Finalize` или любого другого управляемого объекта.</span><span class="sxs-lookup"><span data-stu-id="f7021-145">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="f7021-146">В методе завершения следует только освобождать неуправляемые ресурсы, которыми ваш класс непосредственно владеет.</span><span class="sxs-lookup"><span data-stu-id="f7021-146">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="f7021-147">Если класс не владеет какими-либо неуправляемыми ресурсами, не включайте в его определение метод `Finalize`.</span><span class="sxs-lookup"><span data-stu-id="f7021-147">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="f7021-148">Дополнительные сведения см. в разделе [Сборка мусора](../../../standard/garbage-collection/index.md).</span><span class="sxs-lookup"><span data-stu-id="f7021-148">For more information, see [Garbage Collection](../../../standard/garbage-collection/index.md).</span></span>

### <a name="transaction-support"></a><span data-ttu-id="f7021-149">Поддержка транзакций</span><span class="sxs-lookup"><span data-stu-id="f7021-149">Transaction Support</span></span>
 <span data-ttu-id="f7021-150">Соединения выбираются из пула и назначаются в зависимости от контекста транзакции.</span><span class="sxs-lookup"><span data-stu-id="f7021-150">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="f7021-151">Контексты запрашивающего потока и назначенного соединения должны совпадать.</span><span class="sxs-lookup"><span data-stu-id="f7021-151">The context of the requesting thread and the assigned connection must match.</span></span> <span data-ttu-id="f7021-152">Таким образом, каждый пул подключений делится на соединения без связанного контекста транзакции и на *N* подразделений, каждый из которых содержит соединения с определенным контекстом транзакции.</span><span class="sxs-lookup"><span data-stu-id="f7021-152">Therefore, each connection pool is subdivided into connections with no associated transaction context and into *N* subdivisions that each contain connections with a particular transaction context.</span></span>

 <span data-ttu-id="f7021-153">При закрытии соединения оно освобождается обратно в пул и в соответствующий подраздел в зависимости от его контекста транзакции.</span><span class="sxs-lookup"><span data-stu-id="f7021-153">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="f7021-154">Поэтому можно закрыть соединение без создания ошибки, даже если распределенная транзакция все еще находится в ожидании.</span><span class="sxs-lookup"><span data-stu-id="f7021-154">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="f7021-155">Это позволяет позднее зафиксировать или прервать распределенную транзакцию.</span><span class="sxs-lookup"><span data-stu-id="f7021-155">This allows you to commit or abort the distributed transaction at a later time.</span></span>

### <a name="control-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="f7021-156">Управление пулами соединений с помощью ключевых слов строки подключения</span><span class="sxs-lookup"><span data-stu-id="f7021-156">Control Connection Pooling with Connection String Keywords</span></span>
 <span data-ttu-id="f7021-157">Свойство <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> объекта <xref:System.Data.OracleClient.OracleConnection> поддерживает пары «ключ-значение» из строки соединения, с помощью которых можно изменять логику организации пулов соединений.</span><span class="sxs-lookup"><span data-stu-id="f7021-157">The <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> property of the <xref:System.Data.OracleClient.OracleConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span>

 <span data-ttu-id="f7021-158">В следующей таблице приводятся значения <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A>, которые можно использовать для настройки пулов соединений.</span><span class="sxs-lookup"><span data-stu-id="f7021-158">The following table describes the <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> values you can use to adjust connection pooling behavior.</span></span>

|<span data-ttu-id="f7021-159">Name</span><span class="sxs-lookup"><span data-stu-id="f7021-159">Name</span></span>|<span data-ttu-id="f7021-160">Default</span><span class="sxs-lookup"><span data-stu-id="f7021-160">Default</span></span>|<span data-ttu-id="f7021-161">Описание</span><span class="sxs-lookup"><span data-stu-id="f7021-161">Description</span></span>|
|----------|-------------|-----------------|
|`Connection Lifetime`|<span data-ttu-id="f7021-162">0</span><span class="sxs-lookup"><span data-stu-id="f7021-162">0</span></span>|<span data-ttu-id="f7021-163">Если соединение возвращается в пул, время его создания сравнивается с текущим временем и соединение уничтожается, если этот промежуток времени (в секундах) превышает значение, заданное параметром `Connection Lifetime`.</span><span class="sxs-lookup"><span data-stu-id="f7021-163">When a connection is returned to the pool, its creation time is compared with the current time, and the connection is destroyed if that time span (in seconds) exceeds the value specified by `Connection Lifetime`.</span></span> <span data-ttu-id="f7021-164">Эта возможность полезна в кластеризованных конфигурациях для принудительной балансировки нагрузки между выполняющимся сервером и сервером, только что переведенным в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="f7021-164">This is useful in clustered configurations to force load balancing between a running server and a server just brought online.</span></span><br /><br /> <span data-ttu-id="f7021-165">Значение ноль (0) означает максимальное время ожидания для соединений в пуле.</span><span class="sxs-lookup"><span data-stu-id="f7021-165">A value of zero (0) will cause pooled connections to have the maximum time-out.</span></span>|
|`Enlist`|<span data-ttu-id="f7021-166">'true'</span><span class="sxs-lookup"><span data-stu-id="f7021-166">'true'</span></span>|<span data-ttu-id="f7021-167">При значении `true` средство управления пулом автоматически прикрепляет соединение к текущему контексту транзакции потока создания, если контекст транзакции существует.</span><span class="sxs-lookup"><span data-stu-id="f7021-167">When `true`, the pooler automatically enlists the connection in the current transaction context of the creation thread if a transaction context exists.</span></span>|
|`Max Pool Size`|<span data-ttu-id="f7021-168">100</span><span class="sxs-lookup"><span data-stu-id="f7021-168">100</span></span>|<span data-ttu-id="f7021-169">Максимальное число разрешенных соединений в пуле.</span><span class="sxs-lookup"><span data-stu-id="f7021-169">The maximum number of connections allowed in the pool.</span></span>|
|`Min Pool Size`|<span data-ttu-id="f7021-170">0</span><span class="sxs-lookup"><span data-stu-id="f7021-170">0</span></span>|<span data-ttu-id="f7021-171">Минимальное число поддерживаемых соединений в пуле.</span><span class="sxs-lookup"><span data-stu-id="f7021-171">The minimum number of connections maintained in the pool.</span></span>|
|`Pooling`|<span data-ttu-id="f7021-172">'true'</span><span class="sxs-lookup"><span data-stu-id="f7021-172">'true'</span></span>|<span data-ttu-id="f7021-173">При значении `true` соединение извлекается из соответствующего пула или при необходимости создается и добавляется в соответствующий пул.</span><span class="sxs-lookup"><span data-stu-id="f7021-173">When `true`, the connection is drawn from the appropriate pool, or if necessary, created and added to the appropriate pool.</span></span>|

## <a name="see-also"></a><span data-ttu-id="f7021-174">См. также:</span><span class="sxs-lookup"><span data-stu-id="f7021-174">See also</span></span>

- [<span data-ttu-id="f7021-175">Объединение подключений в пул</span><span class="sxs-lookup"><span data-stu-id="f7021-175">Connection Pooling</span></span>](connection-pooling.md)
- [<span data-ttu-id="f7021-176">Performance Counters</span><span class="sxs-lookup"><span data-stu-id="f7021-176">Performance Counters</span></span>](performance-counters.md)
- [<span data-ttu-id="f7021-177">Общие сведения об ADO.NET</span><span class="sxs-lookup"><span data-stu-id="f7021-177">ADO.NET Overview</span></span>](ado-net-overview.md)
