---
title: Упаковка и развертывание ресурсов в приложениях .NET
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- deploying applications [.NET Framework], resources
- resource files, deploying
- hub-and-spoke resource deployment model
- resource files, packaging
- application resources, packaging
- single resource assembly
- satellite assemblies
- default culture for applications
- names [.NET Framework], resources
- fallback process for resources
- grouping cultures
- application resources, deploying
- application resources, naming conventions
- culture, packaging and deploying resources
- resource files, naming conventions
- packaging application resources
- application resources, fallback processes
- resource files, fallback processes
- localizing resources
- neutral cultures
ms.assetid: b224d7c0-35f8-4e82-a705-dd76795e8d16
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 19f1d3d1d94db885938a5da3f3b66c8e554205b5
ms.sourcegitcommit: 438919211260bb415fc8f96ca3eabc33cf2d681d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2019
ms.locfileid: "59611397"
---
# <a name="packaging-and-deploying-resources-in-net-apps"></a><span data-ttu-id="2c482-102">Упаковка и развертывание ресурсов в приложениях .NET</span><span class="sxs-lookup"><span data-stu-id="2c482-102">Packaging and Deploying Resources in .NET Apps</span></span>

<span data-ttu-id="2c482-103">Приложения зависят от диспетчера ресурсов платформы .NET Framework, представленного классом <xref:System.Resources.ResourceManager>, для извлечения локализованных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-103">Applications rely on the .NET Framework Resource Manager, represented by the <xref:System.Resources.ResourceManager> class, to retrieve localized resources.</span></span> <span data-ttu-id="2c482-104">Диспетчер ресурсов предполагает, что модель "звезда" используется для упаковки и развертывания ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-104">The Resource Manager assumes that a hub and spoke model is used to package and deploy resources.</span></span> <span data-ttu-id="2c482-105">Центр в этой модели — основная сборка, которая содержит нелокализуемый исполняемый код и ресурсы для единственного языка и региональных параметров, называемого нейтральным или языком и региональными параметрами по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2c482-105">The hub is the main assembly that contains the nonlocalizable executable code and the resources for a single culture, called the neutral or default culture.</span></span> <span data-ttu-id="2c482-106">Язык и региональные параметры по умолчанию являются резервными языком и региональными параметрами; это язык и региональные параметры, чьи ресурсы используются при невозможности найти локализованные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2c482-106">The default culture is the fallback culture for the application; it is the culture whose resources are used if localized resources cannot be found.</span></span> <span data-ttu-id="2c482-107">Каждый луч звезды ведет к вспомогательной сборке, которая содержит ресурсы для одного языка и региональных параметров, но не содержит кода.</span><span class="sxs-lookup"><span data-stu-id="2c482-107">Each spoke connects to a satellite assembly that contains the resources for a single culture, but does not contain any code.</span></span>

<span data-ttu-id="2c482-108">У этой модели несколько преимуществ.</span><span class="sxs-lookup"><span data-stu-id="2c482-108">There are several advantages to this model:</span></span>

- <span data-ttu-id="2c482-109">После развертывания приложения в него можно последовательно добавлять ресурсы для новых языков и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-109">You can incrementally add resources for new cultures after you have deployed an application.</span></span> <span data-ttu-id="2c482-110">Так как разработка ресурсов для конкретных языков и региональных параметров может занять продолжительное время, эта модель дает возможность сначала выпустить главное приложение, а в дальнейшем постепенно дополнять его ресурсами для других языков и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-110">Because subsequent development of culture-specific resources can require a significant amount of time, this allows you to release your main application first, and deliver culture-specific resources at a later date.</span></span>

- <span data-ttu-id="2c482-111">Вспомогательные сборки приложения можно обновлять и изменять без перекомпиляции всего приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-111">You can update and change an application's satellite assemblies without recompiling the application.</span></span>

- <span data-ttu-id="2c482-112">В приложение можно загружать только те вспомогательные сборки, которые содержат ресурсы, необходимые для конкретного языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-112">An application needs to load only those satellite assemblies that contain the resources needed for a particular culture.</span></span> <span data-ttu-id="2c482-113">Такой подход существенно снижает затраты системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-113">This can significantly reduce the use of system resources.</span></span>

 <span data-ttu-id="2c482-114">Тем не менее у этой модели существует ряд недостатков.</span><span class="sxs-lookup"><span data-stu-id="2c482-114">However, there are also disadvantages to this model:</span></span>

- <span data-ttu-id="2c482-115">Необходимо управлять множеством наборов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-115">You must manage multiple sets of resources.</span></span>

- <span data-ttu-id="2c482-116">Увеличиваются первоначальные затраты ресурсов на тестирование приложения, так как требуется проверять несколько конфигураций.</span><span class="sxs-lookup"><span data-stu-id="2c482-116">The initial cost of testing an application increases, because you must test several configurations.</span></span> <span data-ttu-id="2c482-117">Следует заметить, что в долгосрочной перспективе проще и дешевле протестировать одно основное приложение и ряд вспомогательных сборок, чем тестировать и сопровождать несколько параллельных версий на разных языках.</span><span class="sxs-lookup"><span data-stu-id="2c482-117">Note that in the long term it will be easier and less expensive to test one core application with several satellites, than to test and maintain several parallel international versions.</span></span>

## <a name="resource-naming-conventions"></a><span data-ttu-id="2c482-118">Соглашения об именовании ресурсов</span><span class="sxs-lookup"><span data-stu-id="2c482-118">Resource Naming Conventions</span></span>

<span data-ttu-id="2c482-119">В процессе упаковки ресурсов приложения им необходимо присваивать имена в соответствии с соглашениями об именовании, которые применяются в среде CLR.</span><span class="sxs-lookup"><span data-stu-id="2c482-119">When you package your application's resources, you must name them using the resource naming conventions that the common language runtime expects.</span></span> <span data-ttu-id="2c482-120">Среда определяет ресурс по имени языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-120">The runtime identifies a resource by its culture name.</span></span> <span data-ttu-id="2c482-121">Каждому языку и региональным параметрам присваивается уникальное имя, которое обычно представляет собой сочетание имени языка из двух строчных букв и (при необходимости) имени региона из двух прописных букв, обозначающего данную страну или регион.</span><span class="sxs-lookup"><span data-stu-id="2c482-121">Each culture is given a unique name, which is usually a combination of a two-letter, lowercase culture name associated with a language and, if required, a two-letter, uppercase subculture name associated with a country or region.</span></span> <span data-ttu-id="2c482-122">Имя субъязыка и региональных параметров следует за именем языка через дефис (-).</span><span class="sxs-lookup"><span data-stu-id="2c482-122">The subculture name follows the culture name, separated by a dash (-).</span></span> <span data-ttu-id="2c482-123">Примеры включают ja-JP для Японии (японский язык), en-US для США (английский язык), de-DE для Германии (немецкий язык) или de-AT для Австрии (немецкий язык).</span><span class="sxs-lookup"><span data-stu-id="2c482-123">Examples include ja-JP for Japanese as spoken in Japan, en-US for English as spoken in the United States, de-DE for German as spoken in Germany, or de-AT for German as spoken in Austria.</span></span> <span data-ttu-id="2c482-124">Полный список имен языков и региональных параметров см. в [справочнике по API поддержки национальных языков (NLS)](https://go.microsoft.com/fwlink/?LinkId=200048) в центре разработчиков Go Global.</span><span class="sxs-lookup"><span data-stu-id="2c482-124">See the [National Language Support (NLS) API Reference](https://go.microsoft.com/fwlink/?LinkId=200048) at the Go Global Developer Center for a complete list of culture names.</span></span>

> [!NOTE]
> <span data-ttu-id="2c482-125">Сведения о создании файлов ресурсов см. в разделе [Создание файлов ресурсов](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md) и [Создание вспомогательных сборок](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md).</span><span class="sxs-lookup"><span data-stu-id="2c482-125">For information about creating resource files, see [Creating Resource Files](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md) and [Creating Satellite Assemblies](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md).</span></span>

<a name="cpconpackagingdeployingresourcesanchor1"></a>

## <a name="the-resource-fallback-process"></a><span data-ttu-id="2c482-126">Процесс использования резервных ресурсов</span><span class="sxs-lookup"><span data-stu-id="2c482-126">The Resource Fallback Process</span></span>

<span data-ttu-id="2c482-127">В звездообразной модели упаковки и развертывания ресурсов для поиска подходящих ресурсов используется процесс перехода к резервному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="2c482-127">The hub and spoke model for packaging and deploying resources uses a fallback process to locate appropriate resources.</span></span> <span data-ttu-id="2c482-128">Если приложение запрашивает локализованный ресурс, который оказывается недоступен, среда CLR ищет в иерархии языков и региональных параметров подходящий резервный ресурс, который наиболее точно соответствует запросу пользователя, и только в крайнем случае выдает исключение.</span><span class="sxs-lookup"><span data-stu-id="2c482-128">If an application requests a localized resource  that is unavailable, the common language runtime searches the hierarchy of cultures for an appropriate fallback resource that most closely matches the user's application's request, and throws an exception only as a last resort.</span></span> <span data-ttu-id="2c482-129">На каждом уровне иерархии производится поиск, и если подходящий ресурс найден, среда выполнения использует его.</span><span class="sxs-lookup"><span data-stu-id="2c482-129">At each level of the hierarchy, if an appropriate resource is found, the runtime uses it.</span></span> <span data-ttu-id="2c482-130">Если ресурс не найден, поиск продолжается на следующем уровне.</span><span class="sxs-lookup"><span data-stu-id="2c482-130">If the resource is not found, the search continues at the next level.</span></span>

<span data-ttu-id="2c482-131">Чтобы повысить эффективность поиска, примените атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute> к главной сборке и передайте его имени нейтрального языка, который будет использоваться с главной сборкой.</span><span class="sxs-lookup"><span data-stu-id="2c482-131">To improve lookup performance, apply the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to your main assembly, and pass it the name of the neutral language that will work with your main assembly.</span></span>

### <a name="net-framework-resource-fallback-process"></a><span data-ttu-id="2c482-132">Процесс использования резервных ресурсов .NET Framework</span><span class="sxs-lookup"><span data-stu-id="2c482-132">.NET Framework resource fallback process</span></span>

<span data-ttu-id="2c482-133">Процесс использования резервных ресурсов .NET Framework включает следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="2c482-133">The .NET Framework resource fallback process involves the following steps:</span></span>

> [!TIP]
> <span data-ttu-id="2c482-134">Можно использовать элемент конфигурации [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md), чтобы оптимизировать процесс использования резервных ресурсов и процесс, с помощью которого среда выполнения осуществляет проверку сборок ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-134">You may be able to use the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) configuration element to optimize the resource fallback process and the process by which the runtime probes for resource assemblies.</span></span> <span data-ttu-id="2c482-135">Дополнительные сведения см. в разделе [Оптимизация процесса использования резервных ресурсов](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#Optimizing).</span><span class="sxs-lookup"><span data-stu-id="2c482-135">For more information, see the [Optimizing the Resource Fallback Process](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#Optimizing) section.</span></span>

1. <span data-ttu-id="2c482-136">В первую очередь среда выполнения проверяет [глобальный кэш сборок](../../../docs/framework/app-domains/gac.md) на наличие сборки, соответствующей приложению по региональным параметрам.</span><span class="sxs-lookup"><span data-stu-id="2c482-136">The runtime first checks the [global assembly cache](../../../docs/framework/app-domains/gac.md) for an assembly that matches the requested culture for your application.</span></span>

     <span data-ttu-id="2c482-137">Глобальный кэш сборок может хранить сборки ресурсов, которые используются несколькими приложениями.</span><span class="sxs-lookup"><span data-stu-id="2c482-137">The global assembly cache can store resource assemblies that are shared by many applications.</span></span> <span data-ttu-id="2c482-138">Это избавляет от необходимости включать конкретные наборы ресурсов в структуру каталогов для каждого разрабатываемого приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-138">This frees you from having to include specific sets of resources in the directory structure of every application you create.</span></span> <span data-ttu-id="2c482-139">Если среда выполнения находит ссылку на сборку, она просматривает эту сборку в поисках требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-139">If the runtime finds a reference to the assembly, it searches the assembly for the requested resource.</span></span> <span data-ttu-id="2c482-140">Если среда выполнения обнаруживает в сборке нужную запись, она использует запрошенный ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-140">If it finds the entry in the assembly, it uses the requested resource.</span></span> <span data-ttu-id="2c482-141">Если она не находит записи, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-141">If it doesn't find the entry, it continues the search.</span></span>

2. <span data-ttu-id="2c482-142">Затем среда выполнения проверяет каталог выполняемой в данный момент сборки на наличие подкаталога, соответствующего запрошенному языку и региональным параметрам.</span><span class="sxs-lookup"><span data-stu-id="2c482-142">The runtime next checks the directory of the currently executing assembly for a subdirectory that matches the requested culture.</span></span> <span data-ttu-id="2c482-143">Если подкаталог найден, среда выполнения ищет в нем допустимую вспомогательную сборку для запрошенного языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-143">If it finds the subdirectory, it searches that subdirectory for a valid satellite assembly for the requested culture.</span></span> <span data-ttu-id="2c482-144">Далее она просматривает вспомогательную сборку в поисках запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-144">The runtime then searches the satellite assembly for the requested resource.</span></span> <span data-ttu-id="2c482-145">Если ресурс обнаружен в сборке, среда выполнения использует его.</span><span class="sxs-lookup"><span data-stu-id="2c482-145">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2c482-146">Если ресурс не найден, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-146">If it doesn't find the resource, it continues the search.</span></span>

3. <span data-ttu-id="2c482-147">Далее среда выполнения запрашивает установщик Windows определить, должна ли вспомогательная сборка быть установлена по требованию.</span><span class="sxs-lookup"><span data-stu-id="2c482-147">The runtime next queries the Windows Installer to determine whether the satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="2c482-148">В таком случае производится обработка установки, загрузка сборки и поиск ее или запрошенных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-148">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="2c482-149">Если ресурс обнаружен в сборке, среда выполнения использует его.</span><span class="sxs-lookup"><span data-stu-id="2c482-149">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2c482-150">Если ресурс не найден, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-150">If it doesn't find the resource, it continues the search.</span></span>

4. <span data-ttu-id="2c482-151">Среда выполнения вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>, чтобы указать, что не удалось найти вспомогательную сборку.</span><span class="sxs-lookup"><span data-stu-id="2c482-151">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2c482-152">При обработке события обработчик событий может возвратить ссылку на вспомогательную сборку, чьи ресурсы будут использованы для поиска.</span><span class="sxs-lookup"><span data-stu-id="2c482-152">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="2c482-153">В противном случае обработчик событий возвращает `null` и продолжается поиск.</span><span class="sxs-lookup"><span data-stu-id="2c482-153">Otherwise, the event handler returns `null` and the search continues.</span></span>

5. <span data-ttu-id="2c482-154">Затем среда выполнения снова просматривает глобальный кэш сборок, на этот раз в поисках родительской сборки запрошенного языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-154">The runtime next searches the global assembly cache again, this time for the parent assembly of the requested culture.</span></span> <span data-ttu-id="2c482-155">Если родительская сборка присутствует в глобальном кэше сборок, среда выполнения ищет в ней ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-155">If the parent assembly exists in the global assembly cache, the runtime searches the assembly for the requested resource.</span></span>

     <span data-ttu-id="2c482-156">Родительский язык и региональные параметры определяются в качестве подходящих резервных языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-156">The parent culture is defined as the appropriate fallback culture.</span></span> <span data-ttu-id="2c482-157">Родительские сборки рекомендуется использовать в качестве резервных ресурсов, так как предоставление любых ресурсов является более желательным, чем порождение исключения.</span><span class="sxs-lookup"><span data-stu-id="2c482-157">Consider parents as fallback candidates, because providing any resource is preferable to throwing an exception.</span></span> <span data-ttu-id="2c482-158">Этот процесс также позволяет многократно использовать ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2c482-158">This process also allows you to reuse resources.</span></span> <span data-ttu-id="2c482-159">Включать ресурс на родительском уровне следует только в том случае, если дочерняя культурная среда не требует локализации запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-159">You should include a particular resource at the parent level only if the child culture doesn't need to localize the requested resource.</span></span> <span data-ttu-id="2c482-160">Например, если заданы вспомогательные сборки для культурных сред `en` (нейтральный английский), `en-GB` (английский, используемый в Великобритании) и `en-US` (английский, используемый в США), то сборка `en` будет содержать общие термины, а в сборках `en-GB` и `en-US` достаточно переопределить только те термины, которые отличаются в этих языках.</span><span class="sxs-lookup"><span data-stu-id="2c482-160">For example, if you supply satellite assemblies for `en` (neutral English), `en-GB` (English as spoken in the United Kingdom), and `en-US` (English as spoken in the United States), the `en` satellite would contain the common terminology, and the `en-GB` and `en-US` satellites could provide overrides for only those terms that differ.</span></span>

6. <span data-ttu-id="2c482-161">Затем среда выполнения проверяет каталог текущей сборки на наличие родительского каталога.</span><span class="sxs-lookup"><span data-stu-id="2c482-161">The runtime next checks the directory of the currently executing assembly to see if it contains a parent directory.</span></span> <span data-ttu-id="2c482-162">Если родительский каталог существует, среда выполнения ищет в нем допустимую вспомогательную сборку для родительского языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-162">If a parent directory exists, the runtime searches the directory for a valid satellite assembly for the parent culture.</span></span> <span data-ttu-id="2c482-163">Если сборка найдена, среда выполнения просматривает ее в поисках запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-163">If it finds the assembly, the runtime searches the assembly for the requested resource.</span></span> <span data-ttu-id="2c482-164">Если ресурс обнаружен, он используется.</span><span class="sxs-lookup"><span data-stu-id="2c482-164">If it finds the resource, it uses it.</span></span> <span data-ttu-id="2c482-165">Если ресурс не найден, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-165">If it doesn't find the resource, it continues the search.</span></span>

7. <span data-ttu-id="2c482-166">Далее среда выполнения запрашивает установщик Windows, чтобы определить, следует ли устанавливать родительскую вспомогательную сборку по требованию.</span><span class="sxs-lookup"><span data-stu-id="2c482-166">The runtime next queries the Windows Installer to determine whether the parent satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="2c482-167">Если да, производится обработка установки, загрузка сборки и поиск ее или запрошенных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2c482-167">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="2c482-168">Если ресурс обнаружен в сборке, среда выполнения использует его.</span><span class="sxs-lookup"><span data-stu-id="2c482-168">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2c482-169">Если ресурс не найден, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-169">If it doesn't find the resource, it continues the search.</span></span>

8. <span data-ttu-id="2c482-170">Среда выполнения вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>, чтобы указать, что не удалось найти подходящий резервный ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-170">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find an appropriate fallback resource.</span></span> <span data-ttu-id="2c482-171">При обработке события обработчик событий может возвратить ссылку на вспомогательную сборку, чьи ресурсы будут использованы для поиска.</span><span class="sxs-lookup"><span data-stu-id="2c482-171">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="2c482-172">В противном случае обработчик событий возвращает `null` и продолжается поиск.</span><span class="sxs-lookup"><span data-stu-id="2c482-172">Otherwise, the event handler returns `null` and the search continues.</span></span>

9. <span data-ttu-id="2c482-173">Далее среда выполнения просматривает родительские сборки по нескольким уровням, выполняя на каждом из них те же действия, что и на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="2c482-173">The runtime next searches parent assemblies, as in the previous three steps, through many potential levels.</span></span> <span data-ttu-id="2c482-174">Каждый язык и региональные параметры имеют только одного родителя, который определен с помощью свойства <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType>, при этом родитель может иметь собственного родителя.</span><span class="sxs-lookup"><span data-stu-id="2c482-174">Each culture has only one parent, which is defined by the <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> property, but a parent might have its own parent.</span></span> <span data-ttu-id="2c482-175">Поиск родительского языка и региональных параметров останавливается, когда свойство <xref:System.Globalization.CultureInfo.Parent%2A> языка и региональных параметров возвращает <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>; для перехода к резервным ресурсам инвариантный язык и региональные параметры не должны являться родительским языком и региональными параметрами или языком и региональными параметрами, которые могут иметь ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2c482-175">The search for parent cultures stops when a culture's <xref:System.Globalization.CultureInfo.Parent%2A> property returns <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>; for resource fallback, the invariant culture is not considered a parent culture or a culture that can have resources.</span></span>

10. <span data-ttu-id="2c482-176">Если после просмотра первоначально заданного языка и региональных параметров и всех родительских сред ресурс не найден, используется ресурс стандартного (запасного) языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-176">If the culture that was originally specified and all parents have been searched and the resource is still not found, the resource for the default (fallback) culture is used.</span></span> <span data-ttu-id="2c482-177">Обычно ресурсы для языка региональных параметров по умолчанию включены в основную сборку приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-177">Typically, the resources for the default culture are included in the main application assembly.</span></span> <span data-ttu-id="2c482-178">Но можно задать значение <xref:System.Resources.UltimateResourceFallbackLocation.Satellite> для свойства <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> атрибута <xref:System.Resources.NeutralResourcesLanguageAttribute>, чтобы указать, что конечное расположение резервных ресурсов является вспомогательной сборкой, а не основной сборкой.</span><span class="sxs-lookup"><span data-stu-id="2c482-178">However, you can specify a value of <xref:System.Resources.UltimateResourceFallbackLocation.Satellite> for the <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> property of the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the ultimate fallback location for resources is a satellite assembly, rather than the main assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2c482-179">Стандартный ресурс является единственным ресурсом, компилируемым вместе с основной сборкой.</span><span class="sxs-lookup"><span data-stu-id="2c482-179">The default resource is the only resource that can be compiled with the main assembly.</span></span> <span data-ttu-id="2c482-180">Если с помощью атрибута <xref:System.Resources.NeutralResourcesLanguageAttribute> в качестве конечного расположения запасных ресурсов не задана вспомогательная сборка, в качестве такого расположения (конечного родительского объекта) используется основная сборка.</span><span class="sxs-lookup"><span data-stu-id="2c482-180">Unless you specify a satellite assembly by using the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute, it is the ultimate fallback (final parent).</span></span> <span data-ttu-id="2c482-181">Поэтому рекомендуется всегда включать стандартный набор ресурсов в основную сборку.</span><span class="sxs-lookup"><span data-stu-id="2c482-181">Therefore, we recommend that you always include a default set of resources in your main assembly.</span></span> <span data-ttu-id="2c482-182">Это помогает избежать появления исключений.</span><span class="sxs-lookup"><span data-stu-id="2c482-182">This helps prevent exceptions from being thrown.</span></span> <span data-ttu-id="2c482-183">Стандартный файл ресурсов обеспечивает запасной вариант для всех ресурсов и гарантирует, что пользователю всегда будет предоставлен хотя бы один ресурс, даже если он не связан с определенным языком и региональными параметрами.</span><span class="sxs-lookup"><span data-stu-id="2c482-183">By including a default resource, file you provide a fallback for all resources and ensure that at least one resource is always present for the user, even if it is not culturally specific.</span></span>

11. <span data-ttu-id="2c482-184">В конечном итоге, если среда выполнения не находит ресурса для стандартного (резервного) языка и региональных параметров, порождается исключение <xref:System.Resources.MissingManifestResourceException> или <xref:System.Resources.MissingSatelliteAssemblyException>, указывающее на то, что ресурс не может быть найден.</span><span class="sxs-lookup"><span data-stu-id="2c482-184">Finally, if the runtime doesn't find a resource for a default (fallback) culture, a <xref:System.Resources.MissingManifestResourceException> or <xref:System.Resources.MissingSatelliteAssemblyException> exception is thrown to indicate that the resource could not be found.</span></span>

<span data-ttu-id="2c482-185">Предположим, что приложение запрашивает ресурс, локализованный для испанского языка (Мексика) (язык и региональные параметры `es-MX`).</span><span class="sxs-lookup"><span data-stu-id="2c482-185">For example, suppose the application requests a resource localized for Spanish (Mexico) (the `es-MX` culture).</span></span> <span data-ttu-id="2c482-186">Сначала среда выполнения осуществит поиск в глобальном кэше сборок для сборки, которая соответствует `es-MX`, но не обнаружит ее.</span><span class="sxs-lookup"><span data-stu-id="2c482-186">The runtime first searches the global assembly cache for the assembly that matches `es-MX`, but doesn't find it.</span></span> <span data-ttu-id="2c482-187">Затем, не найдя такой сборки, среда выполнения ищет каталог `es-MX` в каталоге выполняемой в данный момент сборки.</span><span class="sxs-lookup"><span data-stu-id="2c482-187">The runtime then searches the directory of the currently executing assembly for an `es-MX` directory.</span></span> <span data-ttu-id="2c482-188">Если этот поиск также не приносит результатов, среда выполнения снова просматривает глобальный кэш сборок в поисках родительской сборки, соответствующей резервному языку, в данном случае — `es` (испанский язык).</span><span class="sxs-lookup"><span data-stu-id="2c482-188">Failing that, the runtime searches the global assembly cache again for a parent assembly that reflects the appropriate fallback culture — in this case, `es` (Spanish).</span></span> <span data-ttu-id="2c482-189">Если родительская сборка не найдена, среда выполнения просматривает все возможные уровни родительских сборок для языка и региональных параметров `es-MX`, пока не найдет соответствующий ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-189">If the parent assembly is not found, the runtime searches all potential levels of parent assemblies for the `es-MX` culture until it finds a corresponding resource.</span></span> <span data-ttu-id="2c482-190">Если ресурс не будет найден, среда выполнения использует ресурс для языка и региональных параметров по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2c482-190">If a resource isn't found, the runtime uses the resource for the default culture.</span></span>

<a name="Optimizing"></a>

#### <a name="optimizing-the-net-framework-resource-fallback-process"></a><span data-ttu-id="2c482-191">Оптимизация процесса использования резервных ресурсов .NET Framework</span><span class="sxs-lookup"><span data-stu-id="2c482-191">Optimizing the .NET Framework Resource Fallback Process</span></span>

<span data-ttu-id="2c482-192">В следующих случаях можно оптимизировать процесс, с помощью которого среда выполнения ищет ресурсы во вспомогательных сборках.</span><span class="sxs-lookup"><span data-stu-id="2c482-192">Under the following conditions, you can optimize the process by which the runtime searches for resources in satellite assemblies</span></span>

- <span data-ttu-id="2c482-193">Вспомогательные сборки развертываются в том же месте, что и сборка кода.</span><span class="sxs-lookup"><span data-stu-id="2c482-193">Satellite assemblies are deployed in the same location as the code assembly.</span></span> <span data-ttu-id="2c482-194">Если сборка кода установлена в [глобальный кэш сборок](../../../docs/framework/app-domains/gac.md), вспомогательные сборки также устанавливаются в глобальный кэш сборок.</span><span class="sxs-lookup"><span data-stu-id="2c482-194">If the code assembly is installed in the [Global Assembly Cache](../../../docs/framework/app-domains/gac.md), satellite assemblies are also installed in the global assembly cache.</span></span> <span data-ttu-id="2c482-195">Если сборка кода установлена в каталоге, то вспомогательные сборки установлены в папках языка и региональных параметров данного каталога.</span><span class="sxs-lookup"><span data-stu-id="2c482-195">If the code assembly is installed in a directory, satellite assemblies are installed in culture-specific folders of that directory.</span></span>

- <span data-ttu-id="2c482-196">Вспомогательные сборки не устанавливаются по требованию.</span><span class="sxs-lookup"><span data-stu-id="2c482-196">Satellite assemblies are not installed on demand.</span></span>

- <span data-ttu-id="2c482-197">Код приложения не обрабатывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c482-197">Application code does not handle the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

<span data-ttu-id="2c482-198">Оптимизируйте поиск вспомогательных сборок, включив элемент [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) и задав для его атрибута `enabled` в файле конфигурации приложения значение `true`, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="2c482-198">You optimize the probe for satellite assemblies by including the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) element and setting its `enabled` attribute to `true` in the application configuration file, as shown in the following example.</span></span>

```xml
<configuration>
   <runtime>
      <relativeBindForResources enabled="true" />
   </runtime>
</configuration>
```

<span data-ttu-id="2c482-199">Оптимизированный поиск для вспомогательных сборок — функция по требованию.</span><span class="sxs-lookup"><span data-stu-id="2c482-199">The optimized probe for satellite assemblies is an opt-in feature.</span></span> <span data-ttu-id="2c482-200">Иными словами, среда выполнения выполняет действия, описанные в разделе [Процесс использования резервных ресурсов](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1), если элемент [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) не представлен в файле конфигурации приложения и его атрибут `enabled` не имеет значение `true`.</span><span class="sxs-lookup"><span data-stu-id="2c482-200">That is, the runtime follows the steps documented in [The Resource Fallback Process](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1) unless the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) element is present in the application's configuration file and its `enabled` attribute is set to `true`.</span></span> <span data-ttu-id="2c482-201">Если это так, то процесс проверки вспомогательной сборки изменяется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-201">If this is the case, the process of probing for a satellite assembly is modified as follows:</span></span>

- <span data-ttu-id="2c482-202">Среда выполнения использует расположение родительской сборки кода для проверки вспомогательной сборки.</span><span class="sxs-lookup"><span data-stu-id="2c482-202">The runtime uses the location of the parent code assembly to probe for the satellite assembly.</span></span> <span data-ttu-id="2c482-203">Если родительская сборка установлена в глобальном кэше сборок, среда выполнения проверяет кэш, но не в папке приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-203">If the parent assembly is installed in the global assembly cache, the runtime probes in the cache but not in the application's directory.</span></span> <span data-ttu-id="2c482-204">Если родительская сборка установлена в каталоге приложения, среда выполнения проверяет в каталоге приложения, но не в глобальном кэше сборок.</span><span class="sxs-lookup"><span data-stu-id="2c482-204">If the parent assembly is installed in an application directory, the runtime probes in the application directory but not in the global assembly cache.</span></span>

- <span data-ttu-id="2c482-205">Среда выполнения не запрашивает установщик Windows для установки вспомогательных сборок по требованию.</span><span class="sxs-lookup"><span data-stu-id="2c482-205">The runtime doesn't query the Windows Installer for on-demand installation of satellite assemblies.</span></span>

- <span data-ttu-id="2c482-206">Если поиск конкретной сборки ресурсов завершается неудачей, среда выполнения не вызывает событие <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c482-206">If the probe for a particular resource assembly fails, the runtime does not raise the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

### <a name="net-core-resource-fallback-process"></a><span data-ttu-id="2c482-207">Процесс использования резервных ресурсов .NET Core</span><span class="sxs-lookup"><span data-stu-id="2c482-207">.NET Core resource fallback process</span></span>

<span data-ttu-id="2c482-208">Процесс использования резервных ресурсов .NET Core включает следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="2c482-208">The .NET Core resource fallback process involves the following steps:</span></span>

1. <span data-ttu-id="2c482-209">Среда выполнения пытается загрузить вспомогательную сборку для запрошенного языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-209">The runtime attempts to load a satellite assembly for the requested culture.</span></span>
     * <span data-ttu-id="2c482-210">Проверяет каталог выполняемой в данный момент сборки на наличие подкаталога, соответствующего запрошенному языку и региональным параметрам.</span><span class="sxs-lookup"><span data-stu-id="2c482-210">Checks the directory of the currently executing assembly for a subdirectory that matches the requested culture.</span></span> <span data-ttu-id="2c482-211">Если подкаталог найден, среда выполнения ищет в нем допустимую вспомогательную сборку для запрошенного языка и региональных параметров и загружает ее.</span><span class="sxs-lookup"><span data-stu-id="2c482-211">If it finds the subdirectory, it searches that subdirectory for a valid satellite assembly for the requested culture and loads it.</span></span>

       > [!NOTE]
       > <span data-ttu-id="2c482-212">В операционных системах с файловыми системами, учитывающими регистр (например, Linux и macOS), поиск подкаталога с именем языка и региональных параметров выполняется с учетом регистра.</span><span class="sxs-lookup"><span data-stu-id="2c482-212">On operating systems with case-sensitive file systems (that is, Linux and macOS), the culture name subdirectory search is case-sensitive.</span></span> <span data-ttu-id="2c482-213">Имя подкаталога должно точно соответствовать регистру <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType> (например, `es` или `es-MX`).</span><span class="sxs-lookup"><span data-stu-id="2c482-213">The subdirectory name must exactly match the case of the <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType> (for example, `es` or `es-MX`).</span></span>

       > [!NOTE]
       > <span data-ttu-id="2c482-214">Если программист создал контекст загрузки настраиваемой сборки, производный от <xref:System.Runtime.Loader.AssemblyLoadContext>, то ситуация усложняется.</span><span class="sxs-lookup"><span data-stu-id="2c482-214">If the programmer has derived a custom assembly load context from <xref:System.Runtime.Loader.AssemblyLoadContext>, the situation is complicated.</span></span> <span data-ttu-id="2c482-215">Если выполняемая сборка была загружена в настраиваемый контекст, среда выполнения загружает вспомогательную сборку в этот контекст.</span><span class="sxs-lookup"><span data-stu-id="2c482-215">If the executing assembly was loaded into the custom context, the runtime loads the satellite assembly into the custom context.</span></span> <span data-ttu-id="2c482-216">Подробности выходят за рамки этого документа.</span><span class="sxs-lookup"><span data-stu-id="2c482-216">The details are out of scope for this document.</span></span> <span data-ttu-id="2c482-217">См. раздел <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="2c482-217">See  <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

     * <span data-ttu-id="2c482-218">Если вспомогательная сборка не нашлась, <xref:System.Runtime.Loader.AssemblyLoadContext> вызывает событие <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType>, чтобы указать, что ее не удалось найти.</span><span class="sxs-lookup"><span data-stu-id="2c482-218">If a satellite assemble has not been found, the <xref:System.Runtime.Loader.AssemblyLoadContext> raises the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2c482-219">При обработке события обработчик событий может загрузить и возвратить ссылку на вспомогательную сборку.</span><span class="sxs-lookup"><span data-stu-id="2c482-219">If you choose to handle the event, your event handler can load and return a reference to the satellite assembly.</span></span>
     * <span data-ttu-id="2c482-220">Если вспомогательная сборка по-прежнему не была найдена, AssemblyLoadContext вызывает AppDomain для запуска события <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>, чтобы указать, что ее не удалось найти.</span><span class="sxs-lookup"><span data-stu-id="2c482-220">If a satellite assembly still has not been found, the AssemblyLoadContext causes the AppDomain to trigger an <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="2c482-221">При обработке события обработчик событий может загрузить и возвратить ссылку на вспомогательную сборку.</span><span class="sxs-lookup"><span data-stu-id="2c482-221">If you choose to handle the event, your event handler can load and return a reference to the satellite assembly.</span></span>

2. <span data-ttu-id="2c482-222">Если вспомогательная сборка нашлась, среда выполнения просматривает ее в поисках запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-222">If a satellite assembly is found, the runtime searches it for the requested resource.</span></span> <span data-ttu-id="2c482-223">Если ресурс обнаружен в сборке, среда выполнения использует его.</span><span class="sxs-lookup"><span data-stu-id="2c482-223">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="2c482-224">Если ресурс не найден, поиск продолжается.</span><span class="sxs-lookup"><span data-stu-id="2c482-224">If it doesn't find the resource, it continues the search.</span></span>

     > [!NOTE]
     > <span data-ttu-id="2c482-225">Чтобы найти ресурс во вспомогательной сборке, среда выполнения выполняет поиск файла ресурсов по запросу <xref:System.Resources.ResourceManager> для текущего <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c482-225">To find a resource within the satellite assembly, the runtime searches for the resource file requested by the <xref:System.Resources.ResourceManager> for the current <xref:System.Globalization.CultureInfo.Name?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2c482-226">В файле ресурсов она выполняет поиск имени запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-226">Within the resource file it searches for the requested resource name.</span></span> <span data-ttu-id="2c482-227">Если имя не найдено, ресурс обрабатывается как ненайденный.</span><span class="sxs-lookup"><span data-stu-id="2c482-227">If either is not found, the resource is treated as not found.</span></span>

3. <span data-ttu-id="2c482-228">Среда выполнения затем выполняет поиск родительских сборок языка и региональных параметров по нескольким уровням, повторяя каждый раз действия 1 и 2.</span><span class="sxs-lookup"><span data-stu-id="2c482-228">The runtime next searches the parent culture assemblies through many potential levels, each time repeating steps 1 & 2.</span></span>

     <span data-ttu-id="2c482-229">Родительский язык и региональные параметры определяются в качестве подходящих резервных языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-229">The parent culture is defined as an appropriate fallback culture.</span></span> <span data-ttu-id="2c482-230">Родительские сборки рекомендуется использовать в качестве резервных ресурсов, так как предоставление любых ресурсов является более желательным, чем порождение исключения.</span><span class="sxs-lookup"><span data-stu-id="2c482-230">Consider parents as fallback candidates, because providing any resource is preferable to throwing an exception.</span></span> <span data-ttu-id="2c482-231">Этот процесс также позволяет многократно использовать ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2c482-231">This process also allows you to reuse resources.</span></span> <span data-ttu-id="2c482-232">Включать ресурс на родительском уровне следует только в том случае, если дочерняя культурная среда не требует локализации запрошенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2c482-232">You should include a particular resource at the parent level only if the child culture doesn't need to localize the requested resource.</span></span> <span data-ttu-id="2c482-233">Например, если заданы вспомогательные сборки для культурных сред `en` (нейтральный английский), `en-GB` (английский, используемый в Великобритании) и `en-US` (английский, используемый в США), то сборка `en` содержит общие термины, а в сборках `en-GB` и `en-US` достаточно переопределить только те термины, которые отличаются в этих языках.</span><span class="sxs-lookup"><span data-stu-id="2c482-233">For example, if you supply satellite assemblies for `en` (neutral English), `en-GB` (English as spoken in the United Kingdom), and `en-US` (English as spoken in the United States), the `en` satellite contains the common terminology, and the `en-GB` and `en-US` satellites provides overrides for only those terms that differ.</span></span>

     <span data-ttu-id="2c482-234">Каждый язык и региональные параметры имеют только одного родителя, который определен с помощью свойства <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType>, при этом родитель может иметь собственного родителя.</span><span class="sxs-lookup"><span data-stu-id="2c482-234">Each culture has only one parent, which is defined by the <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> property, but a parent might have its own parent.</span></span> <span data-ttu-id="2c482-235">Поиск родительского языка и региональных параметров останавливается, когда свойство языка и региональных параметров <xref:System.Globalization.CultureInfo.Parent%2A> возвращает <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c482-235">The search for parent cultures stops when a culture's <xref:System.Globalization.CultureInfo.Parent%2A> property returns <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2c482-236">Для перехода к резервным ресурсам инвариантные язык и региональные параметры не должны являться родительским языком и региональными параметрами или языком и региональными параметрами, которые могут иметь ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2c482-236">For resource fallback, the invariant culture is not considered a parent culture or a culture that can have resources.</span></span>

4. <span data-ttu-id="2c482-237">Если после просмотра первоначально заданного языка и региональных параметров и всех родительских сред ресурс не найден, используется ресурс стандартного (запасного) языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="2c482-237">If the culture that was originally specified and all parents have been searched and the resource is still not found, the resource for the default (fallback) culture is used.</span></span> <span data-ttu-id="2c482-238">Обычно ресурсы для языка региональных параметров по умолчанию включены в основную сборку приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-238">Typically, the resources for the default culture are included in the main application assembly.</span></span> <span data-ttu-id="2c482-239">Но можно задать значение <xref:System.Resources.UltimateResourceFallbackLocation.Satellite?displayProperty.nameWithType> для свойства <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A>, чтобы указать, что конечное расположение резервных ресурсов является вспомогательной, а не основной сборкой.</span><span class="sxs-lookup"><span data-stu-id="2c482-239">However, you can specify a value of <xref:System.Resources.UltimateResourceFallbackLocation.Satellite?displayProperty.nameWithType> for the <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> property to indicate that the ultimate fallback location for resources is a satellite assembly rather than the main assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2c482-240">Стандартный ресурс является единственным ресурсом, компилируемым вместе с основной сборкой.</span><span class="sxs-lookup"><span data-stu-id="2c482-240">The default resource is the only resource that can be compiled with the main assembly.</span></span> <span data-ttu-id="2c482-241">Если с помощью атрибута <xref:System.Resources.NeutralResourcesLanguageAttribute> в качестве конечного расположения запасных ресурсов не задана вспомогательная сборка, в качестве такого расположения (конечного родительского объекта) используется основная сборка.</span><span class="sxs-lookup"><span data-stu-id="2c482-241">Unless you specify a satellite assembly by using the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute, it is the ultimate fallback (final parent).</span></span> <span data-ttu-id="2c482-242">Поэтому рекомендуется всегда включать стандартный набор ресурсов в основную сборку.</span><span class="sxs-lookup"><span data-stu-id="2c482-242">Therefore, we recommend that you always include a default set of resources in your main assembly.</span></span> <span data-ttu-id="2c482-243">Это помогает избежать появления исключений.</span><span class="sxs-lookup"><span data-stu-id="2c482-243">This helps prevent exceptions from being thrown.</span></span> <span data-ttu-id="2c482-244">Стандартный файл ресурсов обеспечивает запасной вариант для всех ресурсов и гарантирует, что пользователю всегда будет предоставлен хотя бы один ресурс, даже если он не связан с определенным языком и региональными параметрами.</span><span class="sxs-lookup"><span data-stu-id="2c482-244">By including a default resource file, you provide a fallback for all resources and ensure that at least one resource is always present for the user, even if it is not culturally specific.</span></span>

5. <span data-ttu-id="2c482-245">В конечном итоге, если среда выполнения не находит файл ресурсов для стандартного (резервного) языка и региональных параметров, порождается исключение <xref:System.Resources.MissingManifestResourceException> или <xref:System.Resources.MissingSatelliteAssemblyException>, указывающее на то, что ресурс не может быть найден.</span><span class="sxs-lookup"><span data-stu-id="2c482-245">Finally, if the runtime doesn't find a resource file for a default (fallback) culture, a <xref:System.Resources.MissingManifestResourceException> or <xref:System.Resources.MissingSatelliteAssemblyException> exception is thrown to indicate that the resource could not be found.</span></span> <span data-ttu-id="2c482-246">Если файл ресурсов найден, но запрошенный ресурс отсутствует, то запрос возвращает `null`.</span><span class="sxs-lookup"><span data-stu-id="2c482-246">If the resource file is found but the requested resource is not present the request returns `null`.</span></span>

### <a name="ultimate-fallback-to-satellite-assembly"></a><span data-ttu-id="2c482-247">Определение вспомогательной сборки в качестве конечного расположения резервных ресурсов</span><span class="sxs-lookup"><span data-stu-id="2c482-247">Ultimate Fallback to Satellite Assembly</span></span>

<span data-ttu-id="2c482-248">При необходимости можно удалить ресурсы из основной сборки и указать, что среда выполнения должна загрузить обычные резервные ресурсы из вспомогательной сборки, которая соответствует определенному языку и региональным параметрам.</span><span class="sxs-lookup"><span data-stu-id="2c482-248">You can optionally remove resources from the main assembly and specify that the runtime should load the ultimate fallback resources from a satellite assembly that corresponds to a specific culture.</span></span> <span data-ttu-id="2c482-249">Для управления процессом перехода на резервные ресурсы используется конструктор <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29?displayProperty=nameWithType> и указывается значение для параметра <xref:System.Resources.UltimateResourceFallbackLocation>, определяющее, должен ли диспетчер ресурсов извлечь резервные ресурсы из основной сборки или из вспомогательной сборки.</span><span class="sxs-lookup"><span data-stu-id="2c482-249">To control the fallback process, you use the <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29?displayProperty=nameWithType> constructor and supply a value for the <xref:System.Resources.UltimateResourceFallbackLocation> parameter that specifies whether Resource Manager should extract the fallback resources from the main assembly or from a satellite assembly.</span></span>

<span data-ttu-id="2c482-250">В следующем примере .NET Framework используется атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute> для хранения резервных ресурсов приложения во вспомогательной сборке для французского языка (`fr`).</span><span class="sxs-lookup"><span data-stu-id="2c482-250">The following .NET Framework example uses the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to store an application's fallback resources in a satellite assembly for the French (`fr`) language.</span></span> <span data-ttu-id="2c482-251">Пример содержит два текстовых файла ресурсов, которые определяют один строковой ресурс `Greeting`.</span><span class="sxs-lookup"><span data-stu-id="2c482-251">The example has two text-based resource files that define a single string resource named `Greeting`.</span></span> <span data-ttu-id="2c482-252">Первый файл resources.fr.txt содержит французский языковой ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-252">The first, resources.fr.txt, contains a French language resource.</span></span>

```
Greeting=Bon jour!
```

<span data-ttu-id="2c482-253">Второй файл resources.ru.txt содержит русский языковой ресурс.</span><span class="sxs-lookup"><span data-stu-id="2c482-253">The second, resources,ru.txt, contains a Russian language resource.</span></span>

```
Greeting=Добрый день
```

<span data-ttu-id="2c482-254">Эти файлы компилируются в файлы с расширением RESOURCES путем запуска [генератора файловых ресурсов (Resgen.exe)](../../../docs/framework/tools/resgen-exe-resource-file-generator.md) из командной строки.</span><span class="sxs-lookup"><span data-stu-id="2c482-254">These two files are compiled to .resources files by running the [resource file generator (Resgen.exe)](../../../docs/framework/tools/resgen-exe-resource-file-generator.md) from the command line.</span></span> <span data-ttu-id="2c482-255">Для ресурса французского языка команда выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-255">For the French language resource, the command is:</span></span>

<span data-ttu-id="2c482-256">**resgen.exe resources.fr.txt**</span><span class="sxs-lookup"><span data-stu-id="2c482-256">**resgen.exe resources.fr.txt**</span></span>

<span data-ttu-id="2c482-257">Для ресурса русского языка команда выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-257">For the Russian language resource, the command is:</span></span>

<span data-ttu-id="2c482-258">**resgen.exe resources.ru.txt**</span><span class="sxs-lookup"><span data-stu-id="2c482-258">**resgen.exe resources.ru.txt**</span></span>

<span data-ttu-id="2c482-259">RESOURCES-файлы внедряются в библиотеки DLL путем запуска из командной строки [компоновщика сборок (Al.exe)](../../../docs/framework/tools/al-exe-assembly-linker.md) для ресурса французского языка следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-259">The .resources files are embedded into dynamic link libraries by running [assembly linker (Al.exe)](../../../docs/framework/tools/al-exe-assembly-linker.md) from the command line for the French language resource as follows:</span></span>

<span data-ttu-id="2c482-260">**al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll**</span><span class="sxs-lookup"><span data-stu-id="2c482-260">**al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll**</span></span>

<span data-ttu-id="2c482-261">и для ресурса русского языка — следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-261">and for the Russian language resource as follows:</span></span>

<span data-ttu-id="2c482-262">**al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll**</span><span class="sxs-lookup"><span data-stu-id="2c482-262">**al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll**</span></span>

<span data-ttu-id="2c482-263">Исходный код приложения находится в файле с именем Example1.cs или Example1.vb.</span><span class="sxs-lookup"><span data-stu-id="2c482-263">The application source code resides in a file named Example1.cs or Example1.vb.</span></span> <span data-ttu-id="2c482-264">Он содержит атрибут <xref:System.Resources.NeutralResourcesLanguageAttribute>, чтобы указать, что по умолчанию ресурс приложения находится в подкаталоге fr.</span><span class="sxs-lookup"><span data-stu-id="2c482-264">It includes the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the default application resource is in the fr subdirectory.</span></span> <span data-ttu-id="2c482-265">Он создает диспетчер ресурсов, получает значение ресурса `Greeting` и выводит его на консоль.</span><span class="sxs-lookup"><span data-stu-id="2c482-265">It instantiates the Resource Manager, retrieves the value of the `Greeting` resource, and displays it to the console.</span></span>

[!code-csharp[Conceptual.Resources.Packaging#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.resources.packaging/cs/example1.cs#1)]
[!code-vb[Conceptual.Resources.Packaging#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.resources.packaging/vb/example1.vb#1)]

<span data-ttu-id="2c482-266">Можно скомпилировать исходный код C# в командной строке следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2c482-266">You can then compile C# source code from the command line as follows:</span></span>

```console
csc Example1.cs
```

<span data-ttu-id="2c482-267">Команды для компилятора Visual Basic очень похожа:</span><span class="sxs-lookup"><span data-stu-id="2c482-267">The command for the Visual Basic compiler is very similar:</span></span>

```console
vbc Example1.vb
```

<span data-ttu-id="2c482-268">Так как нет никаких ресурсов, внедренных в основную сборку, не нужно компилировать с помощью параметра `/resource`.</span><span class="sxs-lookup"><span data-stu-id="2c482-268">Because there are no resources embedded in the main assembly, you do not have to compile by using the `/resource` switch.</span></span>

<span data-ttu-id="2c482-269">При запуске примера из системы, язык которой является отличным от русского языка, он выводит следующие результаты:</span><span class="sxs-lookup"><span data-stu-id="2c482-269">When you run the example from a system whose language is anything other than Russian, it displays the following output:</span></span>

```
Bon jour!
```

## <a name="suggested-packaging-alternative"></a><span data-ttu-id="2c482-270">Предлагаемые альтернативные методы упаковки</span><span class="sxs-lookup"><span data-stu-id="2c482-270">Suggested Packaging Alternative</span></span>

<span data-ttu-id="2c482-271">Финансовые или временные ограничения могут помешать создать набора ресурсов для каждого региона, который поддерживается этим приложением.</span><span class="sxs-lookup"><span data-stu-id="2c482-271">Time or budget constraints might prevent you from creating a set of resources for every subculture that your application supports.</span></span> <span data-ttu-id="2c482-272">Вместо этого можно создать одну вспомогательную сборку для родительского языка и региональных параметров, которую могут использовать все связанные языки и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="2c482-272">Instead, you can create a single satellite assembly for a parent culture that all related subcultures can use.</span></span> <span data-ttu-id="2c482-273">Например, можно создать одну вспомогательную сборку для английского языка (en), которая будет вызываться пользователями при запросе англоязычных ресурсов для конкретного региона, и одну сборку на немецком (de) для пользователей, запрашивающих ресурсы немецкоязычной версии для определенного региона.</span><span class="sxs-lookup"><span data-stu-id="2c482-273">For example, you can provide a single English satellite assembly (en) that is retrieved by users who request region-specific English resources, and a single German satellite assembly (de) for users who request region-specific German resources.</span></span> <span data-ttu-id="2c482-274">Так, запросы ресурсов для немецкоязычной версии Германии (de-DE), немецкоязычной версии Австрии (de-AT) и немецкоязычной версии Швейцарии (de-CH) будут переданы во вспомогательную сборку для немецкого языка (de).</span><span class="sxs-lookup"><span data-stu-id="2c482-274">For example, requests for German as spoken in Germany (de-DE), Austria (de-AT), and Switzerland (de-CH) would fall back to the German satellite assembly (de).</span></span> <span data-ttu-id="2c482-275">Стандартные ресурсы представляют собой окончательные запасные варианты, поэтому в этом качестве следует использовать ресурсы, которые будут запрашиваться большинством пользователей создаваемого приложения, поэтому необходимо выбирать эти ресурсы внимательно.</span><span class="sxs-lookup"><span data-stu-id="2c482-275">The default resources are the final fallback and therefore should be the resources that will be requested by the majority of your application's users, so choose these resources carefully.</span></span> <span data-ttu-id="2c482-276">В данном подходе будут задействованы ресурсы более общего характера, что позволит существенно снизить затраты на локализацию приложения.</span><span class="sxs-lookup"><span data-stu-id="2c482-276">This approach deploys resources that are less culturally specific, but can significantly reduce your application's localization costs.</span></span>

## <a name="see-also"></a><span data-ttu-id="2c482-277">См. также</span><span class="sxs-lookup"><span data-stu-id="2c482-277">See also</span></span>

- [<span data-ttu-id="2c482-278">Ресурсы в приложениях для настольных систем</span><span class="sxs-lookup"><span data-stu-id="2c482-278">Resources in Desktop Apps</span></span>](../../../docs/framework/resources/index.md)
- [<span data-ttu-id="2c482-279">Глобальный кэш сборок</span><span class="sxs-lookup"><span data-stu-id="2c482-279">Global Assembly Cache</span></span>](../../../docs/framework/app-domains/gac.md)
- [<span data-ttu-id="2c482-280">Создание файлов ресурсов</span><span class="sxs-lookup"><span data-stu-id="2c482-280">Creating Resource Files</span></span>](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md)
- [<span data-ttu-id="2c482-281">Создание вспомогательных сборок</span><span class="sxs-lookup"><span data-stu-id="2c482-281">Creating Satellite Assemblies</span></span>](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md)
