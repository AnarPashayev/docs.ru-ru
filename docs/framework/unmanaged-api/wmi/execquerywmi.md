---
title: Функция Ексеккуеривми (Справочник по неуправляемым API)
description: Функция Ексеккуеривми выполняет запрос для получения объектов.
ms.date: 11/06/2017
api_name:
- ExecQueryWmi
api_location:
- WMINet_Utils.dll
api_type:
- DLLExport
f1_keywords:
- ExecQueryWmi
helpviewer_keywords:
- ExecQueryWmi function [.NET WMI and performance counters]
topic_type:
- Reference
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: b8547d306819e85b838f1160d9912dd43e42f2f3
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2019
ms.locfileid: "70798685"
---
# <a name="execquerywmi-function"></a>Функция ExecQueryWmi

Выполняет запрос для получения объектов.

[!INCLUDE[internalonly-unmanaged](../../../../includes/internalonly-unmanaged.md)]

## <a name="syntax"></a>Синтаксис

```cpp
HRESULT ExecQueryWmi (
   [in] BSTR                    strQueryLanguage,
   [in] BSTR                    strQuery,
   [in] long                    lFlags,
   [in] IWbemContext*           pCtx,
   [out] IEnumWbemClassObject** ppEnum,
   [in] DWORD                   authLevel,
   [in] DWORD                   impLevel,
   [in] IWbemServices*          pCurrentNamespace,
   [in] BSTR                    strUser,
   [in] BSTR                    strPassword,
   [in] BSTR                    strAuthority
);
```

## <a name="parameters"></a>Параметры

`strQueryLanguage`\
окне Строка с допустимым языком запросов, поддерживаемой службой управления Windows. Оно должно быть "WQL", акронимом для язык запросов WMI.

`strQuery`\
окне Текст запроса. Этот параметр не может `null`быть.

`lFlags`\
окне Сочетание флагов, влияющих на поведение этой функции. Следующие значения определены в файле заголовка *вбемкли. h* , или их можно определить как константы в коде:

| Константа | Значение  | Описание  |
|---------|---------|---------|
| `WBEM_FLAG_USE_AMENDED_QUALIFIERS` | 0x20000 | Если параметр задан, функция получает измененные квалификаторы, хранящиеся в локализованном пространстве имен языкового стандарта текущего соединения. <br/> Если значение не задано, функция извлекает только квалификаторы, хранящиеся в пространстве имен immediate. |
| `WBEM_FLAG_RETURN_IMMEDIATELY` | 0x10 | Флаг вызывает вызов семисинчронаус. |
| `WBEM_FLAG_FORWARD_ONLY` | 0x20 | Функция возвращает перечислитель только для перенаправления. Как правило, перечислители выполняются быстрее и используют меньше памяти, чем обычные перечислители, но не допускают вызовы для [клонирования](clone.md). |
| `WBEM_FLAG_BIDIRECTIONAL` | 0 | Инструментарий WMI удерживает указатели на объекты в перечислении до их освобождения. |
| `WBEM_FLAG_ENSURE_LOCATABLE` | 0x100 | Гарантирует, что все возвращенные объекты будут содержать достаточно информации, чтобы системные свойства, такие как **__Path**, **__RELPATH**и **__SERVER**, не `null`были. |
| `WBEM_FLAG_PROTOTYPE` | 2 | Этот флаг используется для создания прототипов. Он не выполняет запрос и вместо этого возвращает объект, который выглядит как типичный объект результата. |
| `WBEM_FLAG_DIRECT_READ` | 0x200 | Вызывает прямой доступ к поставщику для указанного класса, не обращаясь к его родительскому классу или подклассам. |

Для наилучшей производительности рекомендуется использовать флаги `WBEM_FLAG_RETURN_IMMEDIATELY`. `WBEM_FLAG_FORWARD_ONLY`

`pCtx`\
окне Как правило, это значение `null`равно. В противном случае он является указателем на экземпляр [ивбемконтекст](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext) , который может использоваться поставщиком, который предоставляет запрошенные классы.

`ppEnum`\
заполняет Если ошибка не возникает, получает указатель на перечислитель, позволяющий вызывающему объекту получить экземпляры в результирующем наборе запроса. Запрос может иметь результирующий набор с нулевым числом экземпляров. Дополнительные сведения см. в разделе ["Примечания"](#remarks) .

`authLevel`\
окне Уровень авторизации.

`impLevel`\
окне Уровень олицетворения.

`pCurrentNamespace`\
окне Указатель на объект [IWbemServices](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices) , представляющий текущее пространство имен.

`strUser`\
окне Имя пользователя. Дополнительные сведения см. в описании функции [коннектсервервми](connectserverwmi.md) .

`strPassword`\
окне Пароль. Дополнительные сведения см. в описании функции [коннектсервервми](connectserverwmi.md) .

`strAuthority`\
окне Доменное имя пользователя. Дополнительные сведения см. в описании функции [коннектсервервми](connectserverwmi.md) .

## <a name="return-value"></a>Возвращаемое значение

Следующие значения, возвращаемые этой функцией, определены в файле заголовка *вбемкли. h* , или их можно определить как константы в коде:

|Константа  |Значение  |Описание  |
|---------|---------|---------|
| `WBEM_E_ACCESS_DENIED` | 0x80041003 | Пользователь не имеет разрешения на просмотр одного или нескольких классов, которые может возвращать функция. |
| `WBEM_E_FAILED` | 0x80041001 | Произошла неопределенная ошибка. |
| `WBEM_E_INVALID_PARAMETER` | 0x80041008 | Недопустимый параметр. |
| `WBEM_E_INVALID_QUERY` | 0x80041017 | В запросе возникла синтаксическая ошибка. |
| `WBEM_E_INVALID_QUERY_TYPE` | 0x80041018 | Запрошенный язык запросов не поддерживается. |
| `WBEM_E_QUOTA_VIOLATION` | 0x8004106c | Запрос слишком сложен. |
| `WBEM_E_OUT_OF_MEMORY` | 0x80041006 | Недостаточно памяти для завершения операции. |
| `WBEM_E_SHUTTING_DOWN` | 0x80041033 | Вероятно, Инструментарий WMI остановлен и перезапущен. Снова вызовите [коннектсервервми](connectserverwmi.md) . |
| `WBEM_E_TRANSPORT_FAILURE` | 0x80041015 | Не удалось создать ссылку на удаленный вызов процедур (RPC) между текущим процессом и WMI. |
| `WBEM_E_NOT_FOUND` | 0x80041002 | В запросе указан несуществующий класс. |
| `WBEM_S_NO_ERROR` | 0 | Вызов функции выполнен успешно.  |

## <a name="remarks"></a>Примечания

Эта функция заключает вызов метода [IWbemServices:: ExecQuery](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemservices-execquery) .

Эта функция обрабатывает запрос, указанный в `strQuery` параметре, и создает перечислитель, с помощью которого вызывающий может получить доступ к результатам запроса. Перечислитель является указателем на интерфейс [иенумвбемклассобжект](/windows/desktop/api/wbemcli/nn-wbemcli-ienumwbemclassobject) ; результаты запроса представляют собой экземпляры объектов класса, доступ к которым можно получить через интерфейс [ивбемклассобжект](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemclassobject) .

Существует ряд ограничений на количество `AND` ключевых слов и `OR` , которые могут использоваться в запросах WQL. Большое количество ключевых слов WQL, используемых в сложном запросе, может привести к тому `WBEM_E_QUOTA_VIOLATION` , `HRESULT` что инструментарий WMI возвращает код ошибки (или 0x8004106c) как значение. Ограничение ключевых слов WQL зависит от того, насколько сложным является запрос.

Если вызов функции завершается неудачно, можно получить дополнительные сведения об ошибке, вызвав функцию [жетерроринфо](geterrorinfo.md) .

## <a name="requirements"></a>Требования

**Платформ** См. раздел [Требования к системе](../../get-started/system-requirements.md).

**Заголовок.** WMINet_Utils. idl

**Версии платформы .NET Framework:** [!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]

## <a name="see-also"></a>См. также

- [WMI и счетчики производительности (Справочник по неуправляемым интерфейсам API)](index.md)
