---
title: Проблемы при переходе на .NET Framework 4
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: c1c3298d87ad0f481fa30182e40cd5edcd535d6a
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73975622"
---
# <a name="net-framework-4-migration-issues"></a><span data-ttu-id="f612d-102">Проблемы при переходе на .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="f612d-102">.NET Framework 4 migration issues</span></span>

<span data-ttu-id="f612d-103">В этом разделе описываются проблемы при переходе между .NET Framework 3.5 с пакетом обновления 1 (SP1) и .NET Framework 4, в том числе исправления, изменения для соответствия стандартам и обеспечения безопасности, а также изменения, внесенные на основе отзывов пользователей.</span><span class="sxs-lookup"><span data-stu-id="f612d-103">This topic describes migration issues between the .NET Framework version 3.5 Service Pack 1 and the .NET Framework version 4, including fixes, changes for standards compliance and security, and changes based on customer feedback.</span></span> <span data-ttu-id="f612d-104">Большинство изменений не требуют каких-либо программных изменений в ваших приложениях.</span><span class="sxs-lookup"><span data-stu-id="f612d-104">Most of these changes do not require any programming modifications in your applications.</span></span> <span data-ttu-id="f612d-105">Случаи, требующие изменений, описаны в столбце "Рекомендованные изменения" таблицы.</span><span class="sxs-lookup"><span data-stu-id="f612d-105">For those that may involve modifications, see the Recommended changes column of the table.</span></span> <span data-ttu-id="f612d-106">Важные изменения классифицированы по областям, например ASP.NET и Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="f612d-106">Notable changes are broken down by area, for example, ASP.NET and Windows Presentation Foundation (WPF).</span></span>

<span data-ttu-id="f612d-107">Более общий обзор рассмотренных в этом разделе проблем см. в [руководстве по переходу на .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-107">For a higher-level overview of the issues in this topic, see the [Migration Guide to the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).</span></span>

<span data-ttu-id="f612d-108">Сведения о новых возможностях см. в разделе [Новые возможности .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-108">For information about new features, see [What's New in the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).</span></span>

## <a name="aspnet-and-web"></a><span data-ttu-id="f612d-109">ASP.NET и Интернет</span><span class="sxs-lookup"><span data-stu-id="f612d-109">ASP.NET and Web</span></span>

<span data-ttu-id="f612d-110">Пространства имен: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; сборки: System.Web (в System.Web.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-110">Namespaces: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; assembly: System.Web (in System.Web.dll)</span></span>

| <span data-ttu-id="f612d-111">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-111">Feature</span></span> | <span data-ttu-id="f612d-112">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-112">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-113">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-113">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-114">**Файлы описания браузеров**</span><span class="sxs-lookup"><span data-stu-id="f612d-114">**Browser definition files**</span></span> | <span data-ttu-id="f612d-115">Файлы описания браузеров обновлены: теперь они включают сведения о новых и обновленных браузерах и устройствах.</span><span class="sxs-lookup"><span data-stu-id="f612d-115">The browser definition files have been updated to include information about new and updated browsers and devices.</span></span> <span data-ttu-id="f612d-116">Устаревшие браузеры и устройства (например, Netscape Navigator) удалены; добавлены новые браузеры и устройства (например, Google Chrome и Apple iPhone).</span><span class="sxs-lookup"><span data-stu-id="f612d-116">Older browsers and devices such as Netscape Navigator have been removed, and newer browsers and devices such as Google Chrome and Apple iPhone have been added.</span></span><br><br><span data-ttu-id="f612d-117">Если ваше приложение содержит пользовательские описания браузеров, унаследованные от одного из удаленных описаний браузеров, произойдет ошибка.</span><span class="sxs-lookup"><span data-stu-id="f612d-117">If your application contains custom browser definitions that inherit from one of the browser definitions that have been removed, you will see an error.</span></span><br><br><span data-ttu-id="f612d-118">Объект <xref:System.Web.HttpBrowserCapabilities> (предоставляемый свойством `Request.Browse` страницы) управляется файлами описания браузеров.</span><span class="sxs-lookup"><span data-stu-id="f612d-118">The <xref:System.Web.HttpBrowserCapabilities> object (which is exposed by the page's `Request.Browse` property) is driven by the browser definition files.</span></span> <span data-ttu-id="f612d-119">Поэтому информация, возвращаемая при обращении к свойству этого объекта в ASP.NET 4, может отличаться от информации, возвращаемой в более ранней версии ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f612d-119">Therefore, the information that is returned by accessing a property of this object in ASP.NET 4 might be different than the information that was returned in an earlier version of ASP.NET.</span></span> | <span data-ttu-id="f612d-120">Если в вашем приложении используются старые файлы описания браузеров, их можно скопировать из следующей папки:</span><span class="sxs-lookup"><span data-stu-id="f612d-120">If your application relies on the old browser definition files, you can copy them from the following folder:</span></span><br><br><span data-ttu-id="f612d-121">*Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers*</span><span class="sxs-lookup"><span data-stu-id="f612d-121">*Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers*</span></span><br><br><span data-ttu-id="f612d-122">Скопируйте файлы в соответствующую папку *\\CONFIG\\Browsers* для ASP.NET 4.</span><span class="sxs-lookup"><span data-stu-id="f612d-122">Copy the files into the corresponding *\\CONFIG\\Browsers* folder for ASP.NET 4.</span></span> <span data-ttu-id="f612d-123">После копирования файлов запустите программу командной строки [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)).</span><span class="sxs-lookup"><span data-stu-id="f612d-123">After you copy the files, run the [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) command-line tool.</span></span> <span data-ttu-id="f612d-124">Дополнительные сведения см. на веб-сайте [https://www.asp.net/mobile](/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="f612d-124">For more information, see the [https://www.asp.net/mobile](/aspnet/mobile/overview) Web site.</span></span> |
| <span data-ttu-id="f612d-125">**Дочерние приложения, работающие под управлением нескольких версий ASP.NET**</span><span class="sxs-lookup"><span data-stu-id="f612d-125">**Child applications running under mixed versions of ASP.NET**</span></span> | <span data-ttu-id="f612d-126">Приложения ASP.NET 4, которые настроены как дочерние для приложений, использующих предыдущие версии ASP.NET, могут не запускаться из-за ошибок конфигурации или компиляции.</span><span class="sxs-lookup"><span data-stu-id="f612d-126">ASP.NET 4 applications that are configured as children of applications that run earlier versions of ASP.NET might fail to start because of configuration or compilation errors.</span></span> <span data-ttu-id="f612d-127">Конкретная ошибка зависит от того, где выполняется приложение — в IIS 6.0 или в IIS 7 либо IIS 7.5.</span><span class="sxs-lookup"><span data-stu-id="f612d-127">The specific error that occurs depends on whether the application runs under IIS 6.0, or under IIS 7 or IIS 7.5.</span></span> | <span data-ttu-id="f612d-128">Чтобы система конфигурации правильно распознавала приложение ASP.NET 4, можно внести изменения в файлы конфигурации затронутых приложений.</span><span class="sxs-lookup"><span data-stu-id="f612d-128">You can make changes to the configuration files of the affected applications so that the configuration system correctly recognizes the ASP.NET 4 application.</span></span> <span data-ttu-id="f612d-129">Сведения об изменениях, которые необходимо внести, см. в разделе ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications ("Дочерние приложения ASP.NET 4 не запускаются, если родительскими приложениями являются приложения ASP.NET 2.0 или ASP.NET 3.5") статьи [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) ("Критические изменения в ASP.NET 4").</span><span class="sxs-lookup"><span data-stu-id="f612d-129">For information about the changes you must make, see the section "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="f612d-130">**Изменения ClientID**</span><span class="sxs-lookup"><span data-stu-id="f612d-130">**ClientID changes**</span></span> | <span data-ttu-id="f612d-131">Новый параметр `clientIDMode` в ASP.NET 4 позволяет задать способ создания платформой ASP.NET атрибута `id` для HTML-элементов.</span><span class="sxs-lookup"><span data-stu-id="f612d-131">The new `clientIDMode` setting in ASP.NET 4 lets you specify how ASP.NET generates the `id` attribute for HTML elements.</span></span> <span data-ttu-id="f612d-132">В более ранних версиях ASP.NET поведение по умолчанию соответствовало значению `AutoID` параметра `clientIDMode`.</span><span class="sxs-lookup"><span data-stu-id="f612d-132">In previous versions of ASP.NET, the default behavior was equivalent to the `AutoID` setting of `clientIDMode`.</span></span> <span data-ttu-id="f612d-133">Теперь значение по умолчанию — `Predictable`.</span><span class="sxs-lookup"><span data-stu-id="f612d-133">The default setting is now `Predictable`.</span></span> <span data-ttu-id="f612d-134">Дополнительные сведения см. в разделе [Идентификация элементов управления Web Forms](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-134">For more information, see [ASP.NET Web Server Control Identification](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29).</span></span> | <span data-ttu-id="f612d-135">Если для обновления приложения с версии ASP.NET 2.0 или ASP.NET 3.5 используется Visual Studio, средство автоматически добавит в файл Web.config параметр, сохраняющий поведение предыдущих версий платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f612d-135">If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves the behavior of earlier versions of the .NET Framework.</span></span> <span data-ttu-id="f612d-136">Однако если вы обновляете приложение путем изменения пула приложения в IIS, задавая .NET Framework 4 как целевую платформу, ASP.NET использует новый режим по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f612d-136">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new mode by default.</span></span> <span data-ttu-id="f612d-137">Чтобы отключить новый режим идентификатора клиента, добавьте в файл Web.config следующий параметр:</span><span class="sxs-lookup"><span data-stu-id="f612d-137">To disable the new client ID mode, add the following setting to the Web.config file:</span></span><br><br>`<pages clientIDMode="AutoID" />` |
| <span data-ttu-id="f612d-138">**Управление доступом для кода (CAS)**</span><span class="sxs-lookup"><span data-stu-id="f612d-138">**Code access security (CAS)**</span></span> | <span data-ttu-id="f612d-139">Функции NET ASP.NET 2.0, добавленные в ASP.NET 3.5, используют модель управления доступом для кода .NET Framework 1.1 и .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="f612d-139">ASP.NET 2.0 NET features that were added in ASP.NET 3.5 use the .NET Framework 1.1 and .NET Framework 2.0 code access security (CAS) model.</span></span> <span data-ttu-id="f612d-140">Однако реализация управления доступом для кода в ASP.NET 4 значительно усовершенствована.</span><span class="sxs-lookup"><span data-stu-id="f612d-140">However, the implementation of CAS in ASP.NET 4 has been substantially overhauled.</span></span> <span data-ttu-id="f612d-141">В результате приложения ASP.NET с частичным доверием, которые зависят от выполнения доверенного кода в глобальном кэше сборок, могут давать сбой с различными исключениями безопасности.</span><span class="sxs-lookup"><span data-stu-id="f612d-141">As a result, partial-trust ASP.NET applications that rely on trusted code running in the global assembly cache might fail with various security exceptions.</span></span> <span data-ttu-id="f612d-142">Приложения с частичным доверием, которые зависят от расширенных изменений в политике разграничения доступа кода компьютера, также могут давать сбои и создавать исключения безопасности.</span><span class="sxs-lookup"><span data-stu-id="f612d-142">Partial-trust applications that rely on extensive modifications to machine CAS policy might also fail and throw security exceptions.</span></span> | <span data-ttu-id="f612d-143">Поведение приложений ASP.NET 4 с частичным доверием можно изменить на поведение версий ASP.NET 1.1 и 2.0, используя новый атрибут `legacyCasModel` в элементе конфигурации `trust`, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="f612d-143">You can revert partial-trust ASP.NET 4 applications to the behavior of ASP.NET 1.1 and 2.0 by using the new `legacyCasModel` attribute in the `trust` configuration element, as shown in the following example:</span></span><br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br><span data-ttu-id="f612d-144">Внимание! Возврат к более старой модели управления доступом для кода может привести к снижению уровня безопасности.</span><span class="sxs-lookup"><span data-stu-id="f612d-144">Important: Reverting to the older CAS model might represent reduced security.</span></span><br><br><span data-ttu-id="f612d-145">Дополнительные сведения о новой модели управления доступом для кода в ASP.NET 4 см. в разделе [Управление доступом для кода для приложения ASP.NET 4](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="f612d-145">For more information about the new ASP.NET 4 code access security model, see [Code Access Security in ASP.NET 4 Applications](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)).</span></span> |
| <span data-ttu-id="f612d-146">**Файлы конфигурации**</span><span class="sxs-lookup"><span data-stu-id="f612d-146">**Configuration files**</span></span> | <span data-ttu-id="f612d-147">Корневые файлы конфигурации (machine.config и корневой файл Web.config) для .NET Framework и ASP.NET 4 обновлены и теперь включают большую часть стандартных сведений конфигурации, которые в ASP.NET 3.5 находились в файлах Web.config приложения.</span><span class="sxs-lookup"><span data-stu-id="f612d-147">The root configuration files (the machine.config file and the root Web.config file) for the .NET Framework and ASP.NET 4 have been updated to include most of the boilerplate configuration information that was found in the application Web.config files in ASP.NET 3.5.</span></span> <span data-ttu-id="f612d-148">Так как системы конфигурации управляемых служб IIS 7 и IIS 7.5 очень сложны, выполнение приложений ASP.NET 3.5 на платформе ASP.NET 4 и с IIS 7 или IIS 7.5 может привести к ошибкам ASP.NET или ошибкам IIS.</span><span class="sxs-lookup"><span data-stu-id="f612d-148">Because of the complexity of the managed IIS 7 and IIS 7.5 configuration systems, running ASP.NET 3.5 applications under ASP.NET 4 and under IIS 7 and IIS 7.5 can result in either ASP.NET errors or IIS errors.</span></span> | <span data-ttu-id="f612d-149">Обновите приложения ASP.NET 3.5 до ASP.NET 4 с помощью средств обновления проектов в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f612d-149">Upgrade ASP.NET 3.5 applications to ASP.NET 4 by using the project upgrade tools in Visual Studio.</span></span> <span data-ttu-id="f612d-150">Visual Studio 2010 автоматически изменяет файл Web.config приложения ASP.NET 3.5 так, чтобы он включал в себя соответствующие параметры для ASP.NET 4.</span><span class="sxs-lookup"><span data-stu-id="f612d-150">Visual Studio 2010 automatically modifies the ASP.NET 3.5 application's Web.config file to contain the appropriate settings for ASP.NET 4.</span></span><br><br><span data-ttu-id="f612d-151">Однако приложения ASP.NET 3.5 можно запускать, используя .NET Framework 4, без повторной компиляции.</span><span class="sxs-lookup"><span data-stu-id="f612d-151">However, you can run ASP.NET 3.5 applications using the .NET Framework 4 without recompilation.</span></span> <span data-ttu-id="f612d-152">В таком случае может потребоваться вручную изменить файл Web.config приложения перед его запуском на платформе .NET Framework 4 и с IIS 7 или IIS 7.5.</span><span class="sxs-lookup"><span data-stu-id="f612d-152">In that case, you might have to manually modify the application's Web.config file before you run the application under the .NET Framework 4 and under IIS 7 or IIS 7.5.</span></span> <span data-ttu-id="f612d-153">Конкретное изменение, которое требуется внести, зависит от сочетания вашего программного обеспечения с учетом пакетов обновления.</span><span class="sxs-lookup"><span data-stu-id="f612d-153">The specific change you must make depends on the combination of software you are working with, including Service Pack (SP) releases.</span></span> <span data-ttu-id="f612d-154">Сведения о возможных сочетаниях программного обеспечения, на которые влияет данное изменение, и о том, как разрешить проблемы, связанные с определенными сочетаниями, см. в разделе Configuration Errors Related to New ASP.NET 4 Root Configuration ("Ошибки конфигурации, связанные с новой корневой конфигурацией ASP.NET 4") статьи [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) ("Критические изменения в ASP.NET 4").</span><span class="sxs-lookup"><span data-stu-id="f612d-154">For information about the possible software combinations that are affected by this change and how to resolve problems with specific combinations, see the section "Configuration Errors Related to New ASP.NET 4 Root Configuration" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="f612d-155">**Отрисовка элементов управления**</span><span class="sxs-lookup"><span data-stu-id="f612d-155">**Control rendering**</span></span> | <span data-ttu-id="f612d-156">В более ранних версиях ASP.NET некоторые элементы управления создавали разметку, которую нельзя было отключить.</span><span class="sxs-lookup"><span data-stu-id="f612d-156">In previous versions of ASP.NET, some controls emitted markup that you could not disable.</span></span> <span data-ttu-id="f612d-157">В ASP.NET 4 по умолчанию такой тип разметки больше не создается.</span><span class="sxs-lookup"><span data-stu-id="f612d-157">By default, this type of markup is no longer generated in ASP.NET 4.</span></span> <span data-ttu-id="f612d-158">Изменения касаются перечисленных ниже элементов управления.</span><span class="sxs-lookup"><span data-stu-id="f612d-158">The rendering changes affect the following controls:</span></span><br><br><span data-ttu-id="f612d-159">\* Элементы управления `Image` и `ImageButton` больше не отрисовывают атрибут `border="0"`.</span><span class="sxs-lookup"><span data-stu-id="f612d-159">\* The `Image` and `ImageButton` controls no longer render a `border="0"` attribute.</span></span><br><span data-ttu-id="f612d-160">\* Класс `BaseValidator` и проверочные элементы управления, производные от него, по умолчанию больше не отрисовывают текст красного цвета.</span><span class="sxs-lookup"><span data-stu-id="f612d-160">\* The `BaseValidator` class and validation controls that derive from it no longer render red text by default.</span></span><br><span data-ttu-id="f612d-161">\* Элемент управления `HtmlForm` не отрисовывает атрибут `name`.</span><span class="sxs-lookup"><span data-stu-id="f612d-161">\* The `HtmlForm` control does not render a `name` attribute.</span></span><br><span data-ttu-id="f612d-162">\* Элемент управления `Table` больше не отрисовывает атрибут `border="0"`.</span><span class="sxs-lookup"><span data-stu-id="f612d-162">\* The `Table` control no longer renders a `border="0"` attribute.</span></span><br><br><span data-ttu-id="f612d-163">Элементы управления, не предназначенные для пользовательского ввода (например, элемент управления `Label`), больше не отрисовывают атрибут `disabled="disabled"`, если свойство `Enabled` имеет значение `false` (или если этот параметр унаследован ими от контейнерного элемента управления).</span><span class="sxs-lookup"><span data-stu-id="f612d-163">Controls that are not designed for user input (for example, the `Label` control) no longer render the `disabled="disabled"` attribute if their `Enabled` property is set to `false` (or if they inherit this setting from a container control).</span></span> | <span data-ttu-id="f612d-164">Если вы используете Visual Studio для обновления своего приложения с версии ASP.NET 2.0 или ASP.NET 3.5, средство автоматически добавляет в файл Web.config параметр, сохраняющий традиционную отрисовку.</span><span class="sxs-lookup"><span data-stu-id="f612d-164">If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves legacy rendering.</span></span> <span data-ttu-id="f612d-165">Однако если вы обновляете приложение путем изменения пула приложений в IIS, задавая .NET Framework 4 как целевую платформу, ASP.NET использует новый режим отрисовки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f612d-165">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new rendering mode by default.</span></span> <span data-ttu-id="f612d-166">Чтобы отключить новый режим отрисовки, добавьте в файл Web.config следующий параметр:</span><span class="sxs-lookup"><span data-stu-id="f612d-166">To disable the new rendering mode, add the following setting to the Web.config file:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| <span data-ttu-id="f612d-167">**Обработчики событий в документах по умолчанию**</span><span class="sxs-lookup"><span data-stu-id="f612d-167">**Event handlers in default documents**</span></span> | <span data-ttu-id="f612d-168">ASP.NET 4 отображает значение атрибута `action` HTML-элемента `form` как пустую строку, когда запрос обращен к URL-адресу без расширения, с которым сопоставлен документ по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f612d-168">ASP.NET  4 renders the HTML `form` element's `action` attribute value as an empty string when a request is made to an extensionless URL that has a default document mapped to it.</span></span> <span data-ttu-id="f612d-169">В более ранних выпусках ASP.NET запрос к `http://contoso.com` привел бы к запросу к Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="f612d-169">In earlier releases of ASP.NET, a request to `http://contoso.com` would result in a request to Default.aspx.</span></span> <span data-ttu-id="f612d-170">В этом документе открывающий тег `form` отображался бы, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="f612d-170">In that document, the opening `form` tag would be rendered as in the following example:</span></span><br><br>`<form action="Default.aspx" />`<br><br><span data-ttu-id="f612d-171">В ASP.NET 4 запрос к `http://contoso.com` также приводит к запросу к Default.aspx, но ASP.NET теперь отображает открывающий HTML-тег `form`, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="f612d-171">In ASP.NET 4, a request to `http://contoso.com` also results in a request to Default.aspx, but ASP.NET now renders the HTML opening `form` tag as in the following example:</span></span><br><br>`<form action="" />`<br><br><span data-ttu-id="f612d-172">Когда атрибут `action` является пустой строкой, объект `DefaultDocumentModule` служб IIS создает дочерний запрос к Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="f612d-172">When the `action` attribute is an empty string, the IIS `DefaultDocumentModule` object creates a child request to Default.aspx.</span></span> <span data-ttu-id="f612d-173">В большинстве случаев этот дочерний запрос прозрачен для кода приложения и страница Default.aspx запускается нормально.</span><span class="sxs-lookup"><span data-stu-id="f612d-173">Under most conditions, this child request is transparent to application code, and the Default.aspx page runs normally.</span></span> <span data-ttu-id="f612d-174">Однако возможное взаимодействие между управляемым кодом и интегрированным режимом IIS 7 или IIS 7.5 может привести к тому, что управляемые ASPX-страницы перестанут работать корректно во время выполнения дочернего запроса.</span><span class="sxs-lookup"><span data-stu-id="f612d-174">However, a potential interaction between managed code and IIS 7 or IIS 7.5 Integrated mode can cause managed .aspx pages to stop working properly during the child request.</span></span> <span data-ttu-id="f612d-175">При выполнении описанных ниже условий дочерний запрос к ASPX-документу по умолчанию приведет к ошибке или неожиданному поведению.</span><span class="sxs-lookup"><span data-stu-id="f612d-175">If the following conditions occur, the child request to a default .aspx document will result in an error or in unexpected behavior:</span></span><br><br><span data-ttu-id="f612d-176">\* На ASPX-странице, отправляемой браузеру, атрибут `action` элемента `form` имеет значение "".</span><span class="sxs-lookup"><span data-stu-id="f612d-176">\* An .aspx page is sent to the browser with the `form` element's `action` attribute set to "".</span></span><br><span data-ttu-id="f612d-177">\* Форма отправляется обратно платформе ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f612d-177">\* The form is posted back to ASP.NET.</span></span><br><span data-ttu-id="f612d-178">\* Управляемый HTTP-модуль считывает некоторую часть тела сущности, например `Request.Form` или `Request.Params`.</span><span class="sxs-lookup"><span data-stu-id="f612d-178">\* A managed HTTP module reads some part of the entity body, such as `Request.Form` or `Request.Params`.</span></span> <span data-ttu-id="f612d-179">Это приводит к тому, что тело сущности запроса POST считывается в управляемую память.</span><span class="sxs-lookup"><span data-stu-id="f612d-179">This causes the entity body of the POST request to be read into managed memory.</span></span> <span data-ttu-id="f612d-180">В результате тело сущности становится недоступным для модулей машинного кода, запущенных в интегрированном режиме IIS 7 или IIS 7.5.</span><span class="sxs-lookup"><span data-stu-id="f612d-180">As a result, the entity body is no longer available to any native code modules that are running in IIS 7 or IIS 7.5 Integrated mode.</span></span><br><span data-ttu-id="f612d-181">\* Объект `DefaultDocumentModule` служб IIS со временем выполняется и создает дочерний запрос к документу Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="f612d-181">\* The IIS `DefaultDocumentModule` object eventually runs and creates a child request to the Default.aspx document.</span></span> <span data-ttu-id="f612d-182">Однако так как тело сущности уже было считано частью управляемого кода, тело сущности для отправки в дочерний запрос отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-182">However, because the entity body has already been read by a piece of managed code, there is no entity body available to send to the child request.</span></span><br><span data-ttu-id="f612d-183">\* При выполнении HTTP-конвейера для дочернего запроса обработчик ASPX-файлов запускается на этапе выполнения обработчика.</span><span class="sxs-lookup"><span data-stu-id="f612d-183">\* When the HTTP pipeline runs for the child request, the handler for .aspx files runs during the handler-execute phase.</span></span><br><br><span data-ttu-id="f612d-184">Так как тела сущности нет, нет и переменных формы и состояния просмотра.</span><span class="sxs-lookup"><span data-stu-id="f612d-184">Because there is no entity body, there are no form variables and no view state.</span></span> <span data-ttu-id="f612d-185">Поэтому нет информации, позволяющей обработчику ASPX-страницы определить, какое событие должно вызываться (если такое событие имеется).</span><span class="sxs-lookup"><span data-stu-id="f612d-185">Therefore there is no information available for the .aspx page handler to determine what event (if any) should be raised.</span></span> <span data-ttu-id="f612d-186">В результате для соответствующей ASPX-страницы ни один из обработчиков событий обратной передачи не выполняется.</span><span class="sxs-lookup"><span data-stu-id="f612d-186">As a result, none of the postback event handlers for the affected .aspx page run.</span></span> | <span data-ttu-id="f612d-187">Сведения о том, как обойти проблемы, которые могут возникнуть в результате этого изменения, см. в разделе Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode ("Обработчики событий могут не вызываться в документе по умолчанию в интегрированном режиме IIS 7 или IIS 7.5") статьи [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) ("Критические изменения в ASP.NET 4").</span><span class="sxs-lookup"><span data-stu-id="f612d-187">For information about ways to work around problems that might arise as a result of this change, see "Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="f612d-188">**Алгоритм хэширования**</span><span class="sxs-lookup"><span data-stu-id="f612d-188">**Hashing algorithm**</span></span> | <span data-ttu-id="f612d-189">ASP.NET использует как алгоритм шифрования, так и алгоритм хэширования для обеспечения безопасности данных, например файлов cookie проверки подлинности форм и состояния просмотра.</span><span class="sxs-lookup"><span data-stu-id="f612d-189">ASP.NET uses both encryption and hashing algorithms to help secure data such as forms authentication cookies and view state.</span></span> <span data-ttu-id="f612d-190">По умолчанию ASP.NET 4 использует алгоритм <xref:System.Security.Cryptography.HMACSHA256> для операций хэширования файлов cookie и состояния просмотра.</span><span class="sxs-lookup"><span data-stu-id="f612d-190">By default, ASP.NET 4 uses the <xref:System.Security.Cryptography.HMACSHA256> algorithm for hash operations on cookies and view state.</span></span> <span data-ttu-id="f612d-191">В более ранних версиях ASP.NET использовался более старый алгоритм <xref:System.Security.Cryptography.HMACSHA1>.</span><span class="sxs-lookup"><span data-stu-id="f612d-191">Earlier versions of ASP.NET used the older <xref:System.Security.Cryptography.HMACSHA1> algorithm.</span></span> | <span data-ttu-id="f612d-192">При запуске приложений, использующих как ASP.NET 2.0, так и ASP.NET 4, если данные, такие как файлы cookie проверки подлинности форм, должны использоваться разными версиями .NET Framework, необходимо настроить веб-приложение ASP.NET 4 так, чтобы в нем применялся более старый алгоритм <xref:System.Security.Cryptography.HMACSHA1>. Для этого в файл Web.config нужно добавить следующий параметр:</span><span class="sxs-lookup"><span data-stu-id="f612d-192">If you run applications that mix ASP.NET 2.0 and ASP.NET 4, where data such as forms authentication cookies must work across .NET Framework versions, configure an ASP.NET 4 Web application to use the older <xref:System.Security.Cryptography.HMACSHA1> algorithm by adding the following setting in the Web.config file:</span></span><br><br>`<machineKey validation="SHA1" />` |
| <span data-ttu-id="f612d-193">**Размещение элементов управления в Internet Explorer**</span><span class="sxs-lookup"><span data-stu-id="f612d-193">**Hosting controls in Internet Explorer**</span></span> | <span data-ttu-id="f612d-194">Элементы управления Windows Forms можно больше не размещать в Internet Explorer, так как существуют более предпочтительные решения для размещения элементов управления в веб-приложениях.</span><span class="sxs-lookup"><span data-stu-id="f612d-194">You can no longer host Windows Forms controls in the Internet Explorer, because there are better solutions for hosting controls on the Web.</span></span> <span data-ttu-id="f612d-195">Поэтому сборки IEHost.dll и IEExec.exe удалены из платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f612d-195">Therefore, the IEHost.dll and IEExec.exe assemblies have been removed from the .NET Framework.</span></span> | <span data-ttu-id="f612d-196">Для разработки пользовательских элементов управления в веб-приложениях можно использовать указанные ниже технологии.</span><span class="sxs-lookup"><span data-stu-id="f612d-196">You can use the following technologies for custom control development in Web applications:</span></span><br><br><span data-ttu-id="f612d-197">\* Можно создать приложение Silverlight и настроить его для работы вне браузера.</span><span class="sxs-lookup"><span data-stu-id="f612d-197">\* You can create a Silverlight application and configure it to run outside the browser.</span></span> <span data-ttu-id="f612d-198">Дополнительные сведения см. в разделе [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29) ("Поддержка вне браузера").</span><span class="sxs-lookup"><span data-stu-id="f612d-198">For more information, see [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29).</span></span><br><span data-ttu-id="f612d-199">\* Можно создать XAML-приложение браузера (XBAP), чтобы воспользоваться возможностями WPF (на клиентских компьютерах должна быть установлена платформа .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="f612d-199">\* You can build a XAML browser application (XBAP) to take advantage of WPF capabilities (requires the .NET Framework on client machines).</span></span> <span data-ttu-id="f612d-200">Дополнительные сведения см. в разделе [Общие сведения о приложениях браузера WPF XAML](../wpf/app-development/wpf-xaml-browser-applications-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f612d-200">For more information, see [WPF XAML Browser Applications Overview](../wpf/app-development/wpf-xaml-browser-applications-overview.md).</span></span> |
| <span data-ttu-id="f612d-201">**Методы HtmlEncode и UrlEncode**</span><span class="sxs-lookup"><span data-stu-id="f612d-201">**HtmlEncode and UrlEncode methods**</span></span> | <span data-ttu-id="f612d-202">Методы `HtmlEncode` и `UrlEncode` классов <xref:System.Web.HttpUtility> и <xref:System.Web.HttpServerUtility> обновлены и теперь кодируют символ одинарной кавычки (') указанным ниже образом.</span><span class="sxs-lookup"><span data-stu-id="f612d-202">The `HtmlEncode` and `UrlEncode` methods of the <xref:System.Web.HttpUtility> and <xref:System.Web.HttpServerUtility> classes have been updated to encode the single quotation mark character (') as follows:</span></span><br><br><span data-ttu-id="f612d-203">\* Метод `HtmlEncode` кодирует экземпляры одинарной кавычки как `&#39;`.</span><span class="sxs-lookup"><span data-stu-id="f612d-203">\* The `HtmlEncode` method encodes instances of the single quotation mark as `&#39;`</span></span><br><span data-ttu-id="f612d-204">\* Метод `UrlEncode` кодирует экземпляры одинарной кавычки как `%27`.</span><span class="sxs-lookup"><span data-stu-id="f612d-204">\* The `UrlEncode` method encodes instances of the single quotation mark as `%27`</span></span> | <span data-ttu-id="f612d-205">Просмотрите в коде места, где используются методы `HtmlEncode` и `UrlEncode`, и убедитесь в том, что изменение кодирования не повлияет на ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="f612d-205">Examine your code for places where you use the `HtmlEncode` and `UrlEncode` methods, and make sure that the change in encoding does not result in a change that would affect your application.</span></span> |
| <span data-ttu-id="f612d-206">**Ошибки HttpException в приложениях ASP.NET 2.0**</span><span class="sxs-lookup"><span data-stu-id="f612d-206">**HttpException errors in ASP.NET 2.0 applications**</span></span> | <span data-ttu-id="f612d-207">После включения ASP.NET 4 в IIS 6 приложения ASP.NET 2.0, работающие в IIS 6 (в Windows Server 2003 или Windows Server 2003 R2), могут вызывать ошибки наподобие следующей: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.`</span><span class="sxs-lookup"><span data-stu-id="f612d-207">After ASP.NET 4 has been enabled on IIS 6, ASP.NET 2.0 applications that run on IIS 6 (in either Windows Server 2003 or Windows Server 2003 R2) might generate errors such as the following: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.`</span></span> | <span data-ttu-id="f612d-208">\* Если ASP.NET 4 не требуется для работы веб-сайта, измените сопоставление сайта для использования ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="f612d-208">\* If ASP.NET 4 is not required in order to run the Web site, remap the site to use ASP.NET 2.0 instead.</span></span><br><br><span data-ttu-id="f612d-209">-или-</span><span class="sxs-lookup"><span data-stu-id="f612d-209">-or-</span></span><br><br><span data-ttu-id="f612d-210">\* Если ASP.NET 4 требуется для запуска веб-сайта, переместите любые дочерние виртуальные каталоги ASP.NET 2.0 на другой веб-сайт, который сопоставлен с ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="f612d-210">\* If ASP.NET 4 is required in order to run the Web site, move any child ASP.NET 2.0 virtual directories to a different Web site that is mapped to ASP.NET 2.0.</span></span><br><br><span data-ttu-id="f612d-211">-или-</span><span class="sxs-lookup"><span data-stu-id="f612d-211">-or-</span></span><br><br><span data-ttu-id="f612d-212">\* Отключите URL-адреса без расширений.</span><span class="sxs-lookup"><span data-stu-id="f612d-212">\* Disable extensionless URLs.</span></span> <span data-ttu-id="f612d-213">Дополнительные сведения см. в разделе ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd ("Приложения ASP.NET 2.0 могут вызывать ошибки HttpException, в которых указывается eurl.axd") статьи [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) ("Критические изменения в ASP.NET 4").</span><span class="sxs-lookup"><span data-stu-id="f612d-213">For more information, see "ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="f612d-214">**Типы членства**</span><span class="sxs-lookup"><span data-stu-id="f612d-214">**Membership types**</span></span> | <span data-ttu-id="f612d-215">Некоторые типы (например, <xref:System.Web.Security.MembershipProvider>), используемые в членстве ASP.NET, перемещены из сборки System.Web.dll в сборку System.Web.ApplicationServices.dll.</span><span class="sxs-lookup"><span data-stu-id="f612d-215">Some types (for example, <xref:System.Web.Security.MembershipProvider>) that are used in ASP.NET membership have been moved from System.Web.dll to the System.Web.ApplicationServices.dll assembly.</span></span> <span data-ttu-id="f612d-216">Типы были перемещены для устранения проблемы зависимостей уровней архитектуры между типами в клиенте и в расширенных SKU платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f612d-216">The types were moved in order to resolve architectural layering dependencies between types in the client and in extended .NET Framework SKUs.</span></span> | <span data-ttu-id="f612d-217">Библиотеки классов, обновленные с предыдущих версий ASP.NET и использующие перемещенные типы членства, могут не компилироваться при использовании в проекте ASP.NET 4.</span><span class="sxs-lookup"><span data-stu-id="f612d-217">Class libraries that have been upgraded from earlier versions of ASP.NET and that use membership types that have been moved might fail to compile when used in an ASP.NET 4 project.</span></span> <span data-ttu-id="f612d-218">В этом случае добавьте в сборку System.Web.ApplicationServices.dll ссылку из проекта библиотеки классов.</span><span class="sxs-lookup"><span data-stu-id="f612d-218">If so, add a reference in the class library project to System.Web.ApplicationServices.dll.</span></span> |
| <span data-ttu-id="f612d-219">**Изменения в элементе управления Menu**</span><span class="sxs-lookup"><span data-stu-id="f612d-219">**Menu control changes**</span></span> | <span data-ttu-id="f612d-220">Изменения, внесенные в элемент управления <xref:System.Web.UI.WebControls.Menu>, приводят к описанному ниже поведению.</span><span class="sxs-lookup"><span data-stu-id="f612d-220">Changes to the <xref:System.Web.UI.WebControls.Menu> control result in the following behavior:</span></span><br><br><span data-ttu-id="f612d-221">\* Если для <xref:System.Web.UI.WebControls.MenuRenderingMode> задано значение `List` или для <xref:System.Web.UI.WebControls.MenuRenderingMode> задано значение `Default` и для <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> — значение `4.0` или выше, свойство <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> не действует.</span><span class="sxs-lookup"><span data-stu-id="f612d-221">\* If <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `List`, or if <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `Default` and <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> is set to `4.0` or later, the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property has no effect.</span></span><br><span data-ttu-id="f612d-222">\* Если путь, заданный в свойствах <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> и <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl>, содержит обратную косую черту (\\), изображения не отрисовываются.</span><span class="sxs-lookup"><span data-stu-id="f612d-222">\* If the path that is set in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> and <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> properties contains a backslash (\\), the images do not render.</span></span> <span data-ttu-id="f612d-223">(В предыдущих версиях ASP.NET путь мог содержать обратную косую черту.)</span><span class="sxs-lookup"><span data-stu-id="f612d-223">(In earlier versions of ASP.NET, the path could include a backslash.)</span></span> | <span data-ttu-id="f612d-224">\* Вместо задания свойства <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> для отдельных пунктов меню задайте свойство <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> или <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> родительского элемента управления <xref:System.Web.UI.WebControls.Menu>.</span><span class="sxs-lookup"><span data-stu-id="f612d-224">\* Instead of setting the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property for individual menu items, set the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> of the parent <xref:System.Web.UI.WebControls.Menu> control.</span></span><br><br><span data-ttu-id="f612d-225">-или-</span><span class="sxs-lookup"><span data-stu-id="f612d-225">-or-</span></span><br><br><span data-ttu-id="f612d-226">Для <xref:System.Web.UI.WebControls.MenuRenderingMode> задайте значение `Table` либо для <xref:System.Web.UI.WebControls.MenuRenderingMode> задайте значение `Default` и для <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> — значение `3.5`.</span><span class="sxs-lookup"><span data-stu-id="f612d-226">Set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Table`, or set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Default` and set <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> to `3.5`.</span></span> <span data-ttu-id="f612d-227">Эти параметры предписывают элементу управления <xref:System.Web.UI.WebControls.Menu> использовать структуру на основе таблицы HTML, которую он использовал в предыдущих версиях ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f612d-227">These settings cause the <xref:System.Web.UI.WebControls.Menu> control to use the HTML table-based layout that it used in earlier versions of ASP.NET.</span></span><br><span data-ttu-id="f612d-228">\* Если путь в свойстве <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> или <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> содержит обратную косую черту (\\), замените ее на обычную косую черту (/).</span><span class="sxs-lookup"><span data-stu-id="f612d-228">\* If the path in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> property contains a backslash (\\), substitute a slash character (/).</span></span> |
| <span data-ttu-id="f612d-229">**Мобильная сборка в файле Web.config**</span><span class="sxs-lookup"><span data-stu-id="f612d-229">**Mobile assembly in Web.config file**</span></span> | <span data-ttu-id="f612d-230">В предыдущих версиях ASP.NET ссылка на сборку System.Web.Mobile.dll была включена в корневой файл Web.config раздела `assemblies` в `system.web`/`compilation`.</span><span class="sxs-lookup"><span data-stu-id="f612d-230">In previous versions of ASP.NET, a reference to the System.Web.Mobile.dll assembly was included in the root Web.config file in the `assemblies` section under `system.web`/`compilation`.</span></span> <span data-ttu-id="f612d-231">Для повышения производительности ссылка на эту сборку удалена.</span><span class="sxs-lookup"><span data-stu-id="f612d-231">To improve performance, the reference to this assembly has been removed.</span></span><br><br><span data-ttu-id="f612d-232">Примечание. Сборка System.Web.Mobile.dll и мобильные элементы управления ASP.NET включены в ASP.NET 4, но использовать их не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="f612d-232">Note: The System.Web.Mobile.dll assembly and the ASP.NET mobile controls are included in ASP.NET 4, but they are deprecated.</span></span> | <span data-ttu-id="f612d-233">Если требуется использовать типы из этой сборки, добавьте ссылку на нее в корневой файл Web.config или в файл Web.config приложения.</span><span class="sxs-lookup"><span data-stu-id="f612d-233">If you want to use types from this assembly, add a reference to the assembly in either the root Web.config file or in an application Web.config file.</span></span> |
| <span data-ttu-id="f612d-234">**Кэширование выходных данных**</span><span class="sxs-lookup"><span data-stu-id="f612d-234">**Output caching**</span></span> | <span data-ttu-id="f612d-235">В ASP.NET 1.0 ошибка приводила к тому, что кэшированные страницы с параметром кэша выходных данных `Location="ServerAndClient"` создавали HTTP-заголовок `Vary:*` в ответе.</span><span class="sxs-lookup"><span data-stu-id="f612d-235">In ASP.NET 1.0, a bug caused cached pages that specified `Location="ServerAndClient"` as an output€“cache setting to emit a `Vary:*` HTTP header in the response.</span></span> <span data-ttu-id="f612d-236">Таким образом, клиентские браузеры получали указание никогда не кэшировать такую страницу локально.</span><span class="sxs-lookup"><span data-stu-id="f612d-236">This had the effect of telling client browsers to never cache the page locally.</span></span> <span data-ttu-id="f612d-237">В ASP.NET 1.1 был добавлен метод <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>, который можно было вызвать для подавления заголовка `Vary:*`.</span><span class="sxs-lookup"><span data-stu-id="f612d-237">In ASP.NET 1.1, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method was added, which could be called in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="f612d-238">Однако отчеты об ошибках позволяют предположить, что разработчики не знают о поведении метода `SetOmitVaryStar`.</span><span class="sxs-lookup"><span data-stu-id="f612d-238">However, bug reports suggest that developers are unaware of the existing `SetOmitVaryStar` behavior.</span></span><br><br><span data-ttu-id="f612d-239">В ASP.NET 4 HTTP-заголовок `Vary:*` больше не создается для ответов, задающих следующую директиву:</span><span class="sxs-lookup"><span data-stu-id="f612d-239">In ASP.NET 4, the `Vary:*` HTTP header is no longer emitted from responses that specify the following directive:</span></span><br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br><span data-ttu-id="f612d-240">Поэтому метод <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> больше не требуется для подавления заголовка `Vary:*`.</span><span class="sxs-lookup"><span data-stu-id="f612d-240">As a result, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method is no longer needed in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="f612d-241">В приложениях, в которых атрибут `Location` имеет значение ServerAndClient, страницы можно будет кэшировать в браузере, не вызывая метод <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>.</span><span class="sxs-lookup"><span data-stu-id="f612d-241">In applications that specify "ServerAndClient" for the `Location` attribute, pages will be cacheable in the browser without requiring that you call <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>.</span></span> | <span data-ttu-id="f612d-242">Если страницы в приложении должны создавать заголовок `Vary:*`, следует вызвать метод <xref:System.Web.HttpResponse.AppendHeader%2A>, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="f612d-242">If pages in the application must emit `Vary:*`, call the <xref:System.Web.HttpResponse.AppendHeader%2A> method as shown in the following example:</span></span><br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br><span data-ttu-id="f612d-243">Кроме того, можно изменить значение атрибута `Location` кэширования выходных данных на Server.</span><span class="sxs-lookup"><span data-stu-id="f612d-243">Alternatively, you can change the value of the output caching `Location` attribute to "Server".</span></span> |
| <span data-ttu-id="f612d-244">**Разбор страниц**</span><span class="sxs-lookup"><span data-stu-id="f612d-244">**Page parsing**</span></span> | <span data-ttu-id="f612d-245">Анализатор веб-страниц ASP.NET (ASPX-файлов) и пользовательских элементов управления (ASCX-файлов) в ASP.NET 4 работает строже, чем в предыдущих версиях ASP.NET, и помечает флагом недопустимости больше разметки, чем в предыдущих версиях.</span><span class="sxs-lookup"><span data-stu-id="f612d-245">The page parser for ASP.NET Web pages (.aspx files) and user controls (.ascx files) is stricter in ASP.NET 4 than in earlier versions of ASP.NET, and it flags more markup as invalid than in earlier versions.</span></span> | <span data-ttu-id="f612d-246">Проанализируйте сообщения об ошибках, появляющиеся при выполнении страницы, и исправьте ошибки, возникающие из-за недопустимой разметки.</span><span class="sxs-lookup"><span data-stu-id="f612d-246">Examine error messages that are produced when a page runs and fix errors that result from invalid markup.</span></span> |
| <span data-ttu-id="f612d-247">**Типы Passport**</span><span class="sxs-lookup"><span data-stu-id="f612d-247">**Passport types**</span></span> | <span data-ttu-id="f612d-248">Поддержка Passport, встроенная в ASP.NET 2.0, устарела и теперь не обеспечивается из-за изменений в службе Passport (теперь используется пакет SDK Live ID).</span><span class="sxs-lookup"><span data-stu-id="f612d-248">The Passport support built into ASP.NET 2.0 is obsolete and is unsupported due to changes in Passport (now Live ID SDK).</span></span> <span data-ttu-id="f612d-249">Поэтому типы, связанные со службой Passport в пространстве имен <xref:System.Web.Security>, теперь помечены атрибутом `ObsoleteAttribute`.</span><span class="sxs-lookup"><span data-stu-id="f612d-249">As a result, the types related to Passport in <xref:System.Web.Security> are now marked with the `ObsoleteAttribute` attribute.</span></span> | <span data-ttu-id="f612d-250">Измените код, в котором используются типы Passport в пространстве имен <xref:System.Web.Security> (например, <xref:System.Web.Security.PassportIdentity>), так, чтобы в нем использовался пакет SDK Windows Live ID.</span><span class="sxs-lookup"><span data-stu-id="f612d-250">Change any code you have that uses Passport types in the <xref:System.Web.Security> namespace (for example, <xref:System.Web.Security.PassportIdentity>) to use the Windows Live ID SDK.</span></span> |
| <span data-ttu-id="f612d-251">**Сведения PathInfo в свойстве FilePath**</span><span class="sxs-lookup"><span data-stu-id="f612d-251">**PathInfo information in the FilePath property**</span></span> | <span data-ttu-id="f612d-252">ASP.NET 4 больше не включает значение `PathInfo` в возвращаемые значения таких свойств, как <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath> и <xref:System.Web.HttpRequest.CurrentExecutionFilePath>.</span><span class="sxs-lookup"><span data-stu-id="f612d-252">ASP.NET 4 no longer includes the `PathInfo` value in the return values from properties such as <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>, and <xref:System.Web.HttpRequest.CurrentExecutionFilePath>.</span></span> <span data-ttu-id="f612d-253">Вместо этого сведения `PathInfo` доступны в свойстве <xref:System.Web.HttpRequest.PathInfo>.</span><span class="sxs-lookup"><span data-stu-id="f612d-253">Instead, the `PathInfo` information is available in <xref:System.Web.HttpRequest.PathInfo>.</span></span> <span data-ttu-id="f612d-254">Рассмотрим следующий фрагмент URL-адреса:</span><span class="sxs-lookup"><span data-stu-id="f612d-254">For example, imagine the following URL fragment:</span></span><br><br>`/testapp/Action.mvc/SomeAction`<br><br><span data-ttu-id="f612d-255">В более ранних версиях ASP.NET свойства <xref:System.Web.HttpRequest> имели бы следующие значения:</span><span class="sxs-lookup"><span data-stu-id="f612d-255">In earlier versions of ASP.NET, <xref:System.Web.HttpRequest> properties have the following values:</span></span><br><br><span data-ttu-id="f612d-256">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`</span><span class="sxs-lookup"><span data-stu-id="f612d-256">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`</span></span><br><span data-ttu-id="f612d-257">\* <xref:System.Web.HttpRequest.PathInfo>: (пусто)</span><span class="sxs-lookup"><span data-stu-id="f612d-257">\* <xref:System.Web.HttpRequest.PathInfo>: (empty)</span></span><br><br><span data-ttu-id="f612d-258">В ASP.NET 4 свойства <xref:System.Web.HttpRequest> вместо этого имеют следующие значения:</span><span class="sxs-lookup"><span data-stu-id="f612d-258">In ASP.NET 4, <xref:System.Web.HttpRequest> properties instead have the following values:</span></span><br><br><span data-ttu-id="f612d-259">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`</span><span class="sxs-lookup"><span data-stu-id="f612d-259">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`</span></span><br><span data-ttu-id="f612d-260">\* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction`</span><span class="sxs-lookup"><span data-stu-id="f612d-260">\* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction`</span></span> | <span data-ttu-id="f612d-261">Найдите места в коде, где для получения сведений о пути используются свойства класса <xref:System.Web.HttpRequest>. Измените код в соответствии с изменением способа получения сведений о пути.</span><span class="sxs-lookup"><span data-stu-id="f612d-261">Examine your code for places where you rely on properties of the <xref:System.Web.HttpRequest> class to return path information; change the code to reflect the changes in how path information is returned.</span></span> |
| <span data-ttu-id="f612d-262">**Проверка запросов**</span><span class="sxs-lookup"><span data-stu-id="f612d-262">**Request validation**</span></span> | <span data-ttu-id="f612d-263">Чтобы улучшить проверку запросов, проверка запроса ASP.NET теперь вызывается раньше в жизненном цикле запроса.</span><span class="sxs-lookup"><span data-stu-id="f612d-263">To improve request validation, the ASP.NET request validation is invoked earlier in the request life cycle.</span></span> <span data-ttu-id="f612d-264">В результате проверка запросов выполняется для запросов, предназначенных не для ASPX-файлов, а, например, для вызовов веб-служб и для пользовательских обработчиков.</span><span class="sxs-lookup"><span data-stu-id="f612d-264">As a result, request validation runs for requests that are not for .aspx files, such as for Web service calls and for custom handlers.</span></span> <span data-ttu-id="f612d-265">Проверка запросов также будет активна при выполнении пользовательских HTTP-модулей в конвейере обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="f612d-265">Request validation will also be active when custom HTTP modules are running in the request processing pipeline.</span></span><br><br><span data-ttu-id="f612d-266">В результате этого изменения запросы ресурсов, отличных от ASPX-файлов, могут приводить к ошибкам проверки запросов.</span><span class="sxs-lookup"><span data-stu-id="f612d-266">As a result of this change, requests for resources other than .aspx files might throw request validation errors.</span></span> <span data-ttu-id="f612d-267">Выполнение пользовательского кода в конвейере запросов (например, пользовательских HTTP-модулей) также может приводить к ошибкам проверки запросов.</span><span class="sxs-lookup"><span data-stu-id="f612d-267">Custom code that runs in the request pipeline (for example, custom HTTP modules) might also throw request validation errors.</span></span> | <span data-ttu-id="f612d-268">Если необходимо, чтобы проверка запроса выполнялась только для ASPX-страниц, можно вернуться к старому поведению, задав в файле веб-конфигурации следующий параметр:</span><span class="sxs-lookup"><span data-stu-id="f612d-268">If necessary, you can revert to the old behavior of having only .aspx pages triggering request validation by using the following setting in the Web configuration file:</span></span><br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br><span data-ttu-id="f612d-269">Предупреждение: В случае возврата к старому поведению убедитесь, что весь код в существующих обработчиках и модулях, а также другой пользовательский код выполняют проверки на предмет потенциально опасных входных данных HTTP, которые могут представлять векторы атак XSS.</span><span class="sxs-lookup"><span data-stu-id="f612d-269">Warning: If you revert to the old behavior, make sure that all code in existing handlers, modules, and other custom code performs checks for potentially unsafe HTTP inputs that could be XSS attack vectors.</span></span> |
| <span data-ttu-id="f612d-270">**Routing**</span><span class="sxs-lookup"><span data-stu-id="f612d-270">**Routing**</span></span> | <span data-ttu-id="f612d-271">Если вы создаете веб-сайт на базе файловой системы в Visual Studio 2010 и он находится в папке, в имени которой есть точка (.), маршрутизация URL-адресов не будет работать надежно.</span><span class="sxs-lookup"><span data-stu-id="f612d-271">If you create a file system Web site in Visual Studio 2010 and the Web site is in a folder that contains a dot (.) in the folder name, URL routing will not work reliably.</span></span> <span data-ttu-id="f612d-272">От некоторых виртуальных путей будет возвращаться ошибка HTTP 404.</span><span class="sxs-lookup"><span data-stu-id="f612d-272">An HTTP 404 error is returned from some virtual paths.</span></span> <span data-ttu-id="f612d-273">Причина в том, что Visual Studio 2010 запускает сервер Visual Studio Development Server, используя неправильный путь к корневому виртуальному каталогу.</span><span class="sxs-lookup"><span data-stu-id="f612d-273">This occurs because Visual Studio 2010 launches the Visual Studio Development Server using an incorrect path for the root virtual directory.</span></span> | <span data-ttu-id="f612d-274">\* На странице **Свойства** веб-сайта на базе файловой системы измените значение атрибута **Виртуальный путь** на "/".</span><span class="sxs-lookup"><span data-stu-id="f612d-274">\* In the **Properties** page for the file-based Web site, change the **Virtual Path** attribute to "/".</span></span><br><br><span data-ttu-id="f612d-275">-или-</span><span class="sxs-lookup"><span data-stu-id="f612d-275">-or-</span></span><br><br><span data-ttu-id="f612d-276">\* Создайте проект веб-приложения вместо проекта веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="f612d-276">\* Create a Web application project instead of a Web site project.</span></span> <span data-ttu-id="f612d-277">В проектах веб-приложений такой проблемы не существует, и маршрутизация URL-адресов работает, даже если в имени папки проекта есть точка.</span><span class="sxs-lookup"><span data-stu-id="f612d-277">Web application projects do not have this issue, and URL routing works even if the project folder has a dot in its name.</span></span><br><br><span data-ttu-id="f612d-278">-или-</span><span class="sxs-lookup"><span data-stu-id="f612d-278">-or-</span></span><br><br><span data-ttu-id="f612d-279">\* Создайте веб-сайт на базе HTTP, размещенный в IIS.</span><span class="sxs-lookup"><span data-stu-id="f612d-279">\* Create an HTTP-based Web site that is hosted in IIS.</span></span> <span data-ttu-id="f612d-280">Веб-сайты, размещенные в IIS, могут содержать точки в виртуальном пути и в имени папки файла проекта.</span><span class="sxs-lookup"><span data-stu-id="f612d-280">IIS-hosted Web sites can have dots in the virtual path as well as in the project file folder.</span></span> |
| <span data-ttu-id="f612d-281">**Сайты SharePoint**</span><span class="sxs-lookup"><span data-stu-id="f612d-281">**SharePoint sites**</span></span> | <span data-ttu-id="f612d-282">При попытке запустить веб-сайт ASP.NET 4, который развернут как дочерний элемент веб-сайта SharePoint, содержащего настраиваемый уровень частичного доверия с именем `WSS_Minimal`, появляется следующее сообщение об ошибке:</span><span class="sxs-lookup"><span data-stu-id="f612d-282">If you try to run an ASP.NET 4 Web site that is deployed as a child of a SharePoint Web site that contains a custom partial-trust level named `WSS_Minimal`, you will see the following error:</span></span><br><br>`Could not find permission set named 'ASP.Net'.` | <span data-ttu-id="f612d-283">В настоящее время нет версий SharePoint, совместимых с ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f612d-283">Currently, no versions of SharePoint are compatible with ASP.NET.</span></span> <span data-ttu-id="f612d-284">Поэтому не следует пытаться запустить веб-сайт ASP.NET 4 как дочерний элемент веб-сайта SharePoint.</span><span class="sxs-lookup"><span data-stu-id="f612d-284">As a result, you should not attempt to run an ASP.NET 4 Web site as a child of a SharePoint Web site.</span></span> |
| <span data-ttu-id="f612d-285">**Стандарты XHTML 1.1**</span><span class="sxs-lookup"><span data-stu-id="f612d-285">**XHTML 1.1 standards**</span></span> | <span data-ttu-id="f612d-286">Чтобы обеспечить соответствие стандартам XHTML 1.1 для новых веб-сайтов, элементы управления ASP.NET в .NET Framework 4 создают код HTML, соответствующий XHTML 1.1.</span><span class="sxs-lookup"><span data-stu-id="f612d-286">To enable XHTML 1.1 compliance for new Web sites, the ASP.NET controls in the .NET Framework 4 will generate XHTML 1.1 compliant HTML.</span></span> <span data-ttu-id="f612d-287">Такая отрисовка включается следующим параметром в элементе `<system.Web>` файла Web.config:</span><span class="sxs-lookup"><span data-stu-id="f612d-287">This rendering is enabled using the following option in the Web.config file inside the `<system.Web>` element:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br><span data-ttu-id="f612d-288">По умолчанию параметр имеет значение 4.0.</span><span class="sxs-lookup"><span data-stu-id="f612d-288">This option is set by default to 4.0.</span></span> <span data-ttu-id="f612d-289">В веб-проектах, обновленных от Visual Studio 2008 до более новой версии, этот параметр имеет значение 3.5 для совместимости.</span><span class="sxs-lookup"><span data-stu-id="f612d-289">Web projects that are upgraded from Visual Studio 2008 have the 3.5 setting enabled for compatibility.</span></span> | <span data-ttu-id="f612d-290">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-290">None.</span></span> |

## <a name="core"></a><span data-ttu-id="f612d-291">Ядро</span><span class="sxs-lookup"><span data-stu-id="f612d-291">Core</span></span>

### <a name="general-features"></a><span data-ttu-id="f612d-292">Общие возможности</span><span class="sxs-lookup"><span data-stu-id="f612d-292">General features</span></span>

| <span data-ttu-id="f612d-293">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-293">Feature</span></span> | <span data-ttu-id="f612d-294">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-294">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-295">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-295">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-296">**CardSpace**</span><span class="sxs-lookup"><span data-stu-id="f612d-296">**CardSpace**</span></span> | <span data-ttu-id="f612d-297">Компонент Windows CardSpace больше не включается в платформу .NET Framework; он предоставляется отдельно.</span><span class="sxs-lookup"><span data-stu-id="f612d-297">Windows CardSpace is no longer included in the .NET Framework; it is provided separately.</span></span> | <span data-ttu-id="f612d-298">Скачайте Windows CardSpace из [Центра загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=199868).</span><span class="sxs-lookup"><span data-stu-id="f612d-298">Download Windows CardSpace from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?LinkId=199868).</span></span> |
| <span data-ttu-id="f612d-299">**Файлы конфигурации**</span><span class="sxs-lookup"><span data-stu-id="f612d-299">**Configuration files**</span></span> | <span data-ttu-id="f612d-300">Внесены исправления в отношении доступа платформы .NET Framework к файлам конфигурации приложений.</span><span class="sxs-lookup"><span data-stu-id="f612d-300">Corrections have been made in how the .NET Framework accesses application configuration files.</span></span> | <span data-ttu-id="f612d-301">Если файл конфигурации приложения имеет имя *имя_приложения.config*, переименуйте его в файл *имя_приложения.exe.config*. Например, переименуйте файл *MyApp.config* в файл *MyApp.exe.config*.</span><span class="sxs-lookup"><span data-stu-id="f612d-301">If your application configuration file is named *application-name.config*, rename it to *application-name.exe.config*. For example, rename *MyApp.config* to *MyApp.exe.config*.</span></span> |
| <span data-ttu-id="f612d-302">**Компилятор кода C#**</span><span class="sxs-lookup"><span data-stu-id="f612d-302">**C# code compiler**</span></span> | <span data-ttu-id="f612d-303">Классы `Compiler`, `CompilerError` и `ErrorLevel`, которые находились в пространстве имен <xref:Microsoft.CSharp>, больше не доступны, и их сборка (cscompmgd.dll) больше не включается в платформу .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f612d-303">The `Compiler`, `CompilerError`, and `ErrorLevel` classes that were in the <xref:Microsoft.CSharp> namespace are no longer available, and their assembly (cscompmgd.dll) is no longer included in the .NET Framework.</span></span> | <span data-ttu-id="f612d-304">Используйте класс <xref:System.CodeDom.Compiler.CodeDomProvider> и другие классы в пространстве имен <xref:System.CodeDom.Compiler>.</span><span class="sxs-lookup"><span data-stu-id="f612d-304">Use the <xref:System.CodeDom.Compiler.CodeDomProvider> class and other classes in the <xref:System.CodeDom.Compiler> namespace.</span></span> <span data-ttu-id="f612d-305">Дополнительные сведения см. в разделе [Использование CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-305">For more information, see [Using the CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29).</span></span> |
| <span data-ttu-id="f612d-306">**Размещение** (неуправляемый интерфейс API)</span><span class="sxs-lookup"><span data-stu-id="f612d-306">**Hosting** (unmanaged API)</span></span> | <span data-ttu-id="f612d-307">Чтобы улучшить возможности размещения, некоторые API активации размещения стали нерекомендуемыми.</span><span class="sxs-lookup"><span data-stu-id="f612d-307">To improve hosting capabilities, some of the hosting activation APIs have been deprecated.</span></span> <span data-ttu-id="f612d-308">Функции внутрипроцессного параллельного выполнения позволяют приложению загружать и запускать несколько версий .NET Framework в одном процессе.</span><span class="sxs-lookup"><span data-stu-id="f612d-308">In-process side-by-side execution features enable an application to load and start multiple versions of the .NET Framework in the same process.</span></span> <span data-ttu-id="f612d-309">Например, можно запускать приложения, которые загружают надстройки (или компоненты), созданные на основе .NET Framework 2.0 с пакетом обновления 1 (SP1) и .NET Framework 4, в одном и том же процессе.</span><span class="sxs-lookup"><span data-stu-id="f612d-309">For example, you can run applications that load add-ins (or components) that are based on the .NET Framework 2.0 SP1 and add-ins that are based on the .NET Framework 4 in the same process.</span></span> <span data-ttu-id="f612d-310">Более старые компоненты продолжают использовать более раннюю версию платформы .NET Framework, а новые компоненты используют ее новую версию.</span><span class="sxs-lookup"><span data-stu-id="f612d-310">Older components continue to use the older .NET Framework version, and new components use the new .NET Framework version.</span></span> | <span data-ttu-id="f612d-311">Используйте конфигурацию, описанную в разделе [Внутрипроцессное параллельное выполнение](../deployment/in-process-side-by-side-execution.md).</span><span class="sxs-lookup"><span data-stu-id="f612d-311">Use the configurations described in [In-Process Side-by-Side Execution](../deployment/in-process-side-by-side-execution.md).</span></span> |
| <span data-ttu-id="f612d-312">**Новая модель безопасности**</span><span class="sxs-lookup"><span data-stu-id="f612d-312">**New security model**</span></span> | <span data-ttu-id="f612d-313">Политика разграничения доступа кода отключена и заменена упрощенной моделью, как описано в разделе [Изменения системы безопасности в платформе .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-313">The code access security (CAS) policy has been turned off and replaced with a simplified model, as described in [Security Changes in the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29).</span></span> | <span data-ttu-id="f612d-314">Если ваши приложения зависят от управления доступом для кода, могут потребоваться изменения.</span><span class="sxs-lookup"><span data-stu-id="f612d-314">Modifications may be required if you depend on CAS in your applications.</span></span> <span data-ttu-id="f612d-315">Дополнительные сведения см. в разделе [Совместимость политики разграничения доступа кода и ее миграция](../misc/code-access-security-policy-compatibility-and-migration.md).</span><span class="sxs-lookup"><span data-stu-id="f612d-315">For more information, see [Code Access Security Policy Compatibility and Migration](../misc/code-access-security-policy-compatibility-and-migration.md).</span></span> |

### <a name="date-and-time"></a><span data-ttu-id="f612d-316">Дата и время</span><span class="sxs-lookup"><span data-stu-id="f612d-316">Date and time</span></span>

<span data-ttu-id="f612d-317">Пространство имен: <xref:System>; сборка: mscorlib (в mscorlib.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-317">Namespace: <xref:System>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="f612d-318">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-318">Feature</span></span> | <span data-ttu-id="f612d-319">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-319">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-320">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-320">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-321">**Летнее время**</span><span class="sxs-lookup"><span data-stu-id="f612d-321">**Daylight savings**</span></span> | <span data-ttu-id="f612d-322">Для соответствия системным часам свойства времени (такие как <xref:System.TimeZoneInfo.Local> и <xref:System.DateTime.Now>) теперь используют правила операционной системы вместо других данных .NET Framework для перехода на летнее время.</span><span class="sxs-lookup"><span data-stu-id="f612d-322">To be consistent with the system clock, time properties (such as <xref:System.TimeZoneInfo.Local> and <xref:System.DateTime.Now>) now use operating system rules instead of other .NET Framework data for daylight saving time operations.</span></span> | <span data-ttu-id="f612d-323">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-323">None.</span></span> |
| <span data-ttu-id="f612d-324">**Форматирование строк**</span><span class="sxs-lookup"><span data-stu-id="f612d-324">**Formatting strings**</span></span> | <span data-ttu-id="f612d-325">Для поддержки форматирования, учитывающего язык и региональные параметры, структура <xref:System.TimeSpan> содержит новые перегрузки методов `ToString`, `Parse` и `TryParse`, а также новые методы `ParseExact` и `TryParseExact`.</span><span class="sxs-lookup"><span data-stu-id="f612d-325">To support culture-sensitive formatting, the <xref:System.TimeSpan> structure includes new overloads of the `ToString`, `Parse`, and `TryParse` methods in addition to new `ParseExact` and `TryParseExact` methods.</span></span> | <span data-ttu-id="f612d-326">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-326">None.</span></span> |

### <a name="globalization"></a><span data-ttu-id="f612d-327">Глобализация</span><span class="sxs-lookup"><span data-stu-id="f612d-327">Globalization</span></span>

<span data-ttu-id="f612d-328">Список новых нейтральных и специальных наборов языков и региональных параметров см. в разделе [Новые возможности глобализации и локализации](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).</span><span class="sxs-lookup"><span data-stu-id="f612d-328">For a list of new neutral and specific cultures, see [What's New in Globalization and Localization](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).</span></span>

<span data-ttu-id="f612d-329">Пространство имен: <xref:System.Globalization>; сборка: mscorlib (в mscorlib.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-329">Namespace: <xref:System.Globalization>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="f612d-330">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-330">Feature</span></span> | <span data-ttu-id="f612d-331">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-331">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-332">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-332">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-333">**Имена языков и региональных параметров**</span><span class="sxs-lookup"><span data-stu-id="f612d-333">**Culture names**</span></span> | <span data-ttu-id="f612d-334">Перечисленные ниже изменения имен затрагивают немецкий, мальдивский и африканские языки и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="f612d-334">The following name changes affect the German, Divehi, and African cultures:</span></span><br><br><span data-ttu-id="f612d-335">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: имя валюты для немецкого (Швейцария) языка и региональных параметров (de-CH) изменилось с sFr.</span><span class="sxs-lookup"><span data-stu-id="f612d-335">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: The currency name for the German (Switizerland) (de-CH) culture has changed from "sFr."</span></span> <span data-ttu-id="f612d-336">на Fr.</span><span class="sxs-lookup"><span data-stu-id="f612d-336">to "Fr.".</span></span><br><span data-ttu-id="f612d-337">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: шаблон полной даты для мальдивского языка и региональных параметров (dv-MV) изменился с "дд/мммм/гггг" на "дд/мм/гггг".</span><span class="sxs-lookup"><span data-stu-id="f612d-337">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: The long date pattern for the Divehi (Maldives) (dv-MV) culture has changed from "dd/MMMM/yyyy" to "dd/MM/yyyy".</span></span><br><span data-ttu-id="f612d-338">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: обозначение времени после полудня.</span><span class="sxs-lookup"><span data-stu-id="f612d-338">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: The P.M.</span></span> <span data-ttu-id="f612d-339">для языка и региональных параметров африкаанс (Южно-Африканская Республика) (af-ZA) изменилось с nm на PM.</span><span class="sxs-lookup"><span data-stu-id="f612d-339">designator of the Afrikaans (South Africa) (af-ZA) culture has changed from "nm" to "PM".</span></span> | <span data-ttu-id="f612d-340">Обратите внимание на изменения в именах языков и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="f612d-340">Note culture name changes.</span></span> |
| <span data-ttu-id="f612d-341">**Параметр кода языка (LCID)**</span><span class="sxs-lookup"><span data-stu-id="f612d-341">**LCID parameter**</span></span> | <span data-ttu-id="f612d-342">Для соответствия ожидаемому поведению в параметрах сервера автоматизации среда CLR больше не передает текущие язык и региональные параметры для параметра `LCID` в неуправляемые приложения на основе модели COM.</span><span class="sxs-lookup"><span data-stu-id="f612d-342">To be consistent with expected behavior in automation server settings, the CLR no longer passes the current culture for the `LCID` parameter to unmanaged COM-based applications.</span></span> <span data-ttu-id="f612d-343">Вместо этого для языка и региональных параметров передается 1033 (en-us).</span><span class="sxs-lookup"><span data-stu-id="f612d-343">Instead, it passes 1033 (en-us) for the culture.</span></span> | <span data-ttu-id="f612d-344">Изменения необходимы только для собственных приложений, требующих определенного языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="f612d-344">No modifications necessary except for native applications that require a specified culture.</span></span> |
| <span data-ttu-id="f612d-345">**Устаревшие типы языка и региональных параметров**</span><span class="sxs-lookup"><span data-stu-id="f612d-345">**Obsolete culture types**</span></span> | <span data-ttu-id="f612d-346">Типы языка и региональных параметров <xref:System.Globalization.CultureTypes> и <xref:System.Globalization.CultureTypes> теперь являются устаревшими.</span><span class="sxs-lookup"><span data-stu-id="f612d-346">The <xref:System.Globalization.CultureTypes> and <xref:System.Globalization.CultureTypes> culture types are now obsolete.</span></span><br><br><span data-ttu-id="f612d-347">Для обратной совместимости поле <xref:System.Globalization.CultureTypes> теперь возвращает нейтральные и определенные языки и региональные параметры, которые были включены в более ранние версии .NET Framework, а поле <xref:System.Globalization.CultureTypes> теперь возвращает пустой список.</span><span class="sxs-lookup"><span data-stu-id="f612d-347">For backward compatibility, <xref:System.Globalization.CultureTypes> now returns neutral and specific cultures that were included with the previous .NET Framework, and <xref:System.Globalization.CultureTypes> now returns an empty list.</span></span> | <span data-ttu-id="f612d-348">Используйте другие значения перечисления <xref:System.Globalization.CultureTypes>.</span><span class="sxs-lookup"><span data-stu-id="f612d-348">Use other values of the <xref:System.Globalization.CultureTypes> enumeration.</span></span> |
| <span data-ttu-id="f612d-349">**Получение языка и региональных параметров**</span><span class="sxs-lookup"><span data-stu-id="f612d-349">**Retrieving culture**</span></span> | <span data-ttu-id="f612d-350">Начиная с Windows 7, платформа .NET Framework 4 извлекает информацию о языке и региональных параметрах из операционной системы, вместо того чтобы хранить эти данные у себя.</span><span class="sxs-lookup"><span data-stu-id="f612d-350">Beginning with Windows 7, the .NET Framework 4 retrieves culture information from the operating system instead of storing the data itself.</span></span> <span data-ttu-id="f612d-351">Кроме того, .NET Framework синхронизирует с Windows сведения о сортировке и регистре.</span><span class="sxs-lookup"><span data-stu-id="f612d-351">In addition, the .NET Framework synchronizes with Windows for sorting and casing data.</span></span> | <span data-ttu-id="f612d-352">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-352">None.</span></span> |
| <span data-ttu-id="f612d-353">**Стандарты Юникода 5.1**</span><span class="sxs-lookup"><span data-stu-id="f612d-353">**Unicode 5.1 standards**</span></span> | <span data-ttu-id="f612d-354">Платформа .NET Framework теперь поддерживает все символы Юникода 5.1 (добавлено примерно 1400 символов).</span><span class="sxs-lookup"><span data-stu-id="f612d-354">The .NET Framework now supports all Unicode 5.1 characters -- an addition of approximately 1400 characters.</span></span> <span data-ttu-id="f612d-355">Добавленные символы включают в себя новые символы, стрелки, диакритические знаки, пунктуационные и математические символы, ККЯ-штрихи, идеографические символы, дополнительные числовые знаки языков малаялам и телугу, различные символы бирманской, латинской, арабской, греческой, монгольской и кириллической письменности.</span><span class="sxs-lookup"><span data-stu-id="f612d-355">The additional characters include new symbols, arrows, diacritics, punctuation, mathematical symbols, CJK strokes and ideographs, additional Malayalam and Telugu numeric characters, and various Myanmar, Latin, Arabic, Greek, Mongolian, and Cyrillic characters.</span></span> <span data-ttu-id="f612d-356">Следующие новые виды письменности поддерживаются в Юникоде 5.1: суданская, лепча, ол-чики, ваи, саураштра, кайя ли, реджангская, гурмухи, ория, тамильская, телугу, малаялам и чамская.</span><span class="sxs-lookup"><span data-stu-id="f612d-356">The following new scripts are supported with Unicode 5.1: Sundanese, Lepcha, Ol Chiki, Vai, Saurashtra, Kayah Li, Rejang, Gurmukhi, Odia, Tamil, Telugu, and Malayalam characters and Cham.</span></span> | <span data-ttu-id="f612d-357">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-357">None.</span></span> |

### <a name="exceptions"></a><span data-ttu-id="f612d-358">Исключения</span><span class="sxs-lookup"><span data-stu-id="f612d-358">Exceptions</span></span>

<span data-ttu-id="f612d-359">Пространство имен: <xref:System>, <xref:System.Runtime.ExceptionServices>; сборка: mscorlib (в mscorlib.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-359">Namespaces: <xref:System>, <xref:System.Runtime.ExceptionServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="f612d-360">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-360">Feature</span></span> | <span data-ttu-id="f612d-361">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-361">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-362">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-362">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-363">**Исключения, касающиеся поврежденного состояния процесса**</span><span class="sxs-lookup"><span data-stu-id="f612d-363">**Exceptions for corrupted process state**</span></span> | <span data-ttu-id="f612d-364">Среда CLR больше не передает обработчику исключений в управляемом коде исключения, касающиеся поврежденного состояния процесса.</span><span class="sxs-lookup"><span data-stu-id="f612d-364">The CLR no longer delivers exceptions for corrupted process state to exception handlers in managed code.</span></span> | <span data-ttu-id="f612d-365">Эти исключения указывают, что состояние процесса повреждено.</span><span class="sxs-lookup"><span data-stu-id="f612d-365">These exceptions indicate that the state of a process has been corrupted.</span></span> <span data-ttu-id="f612d-366">Запускать приложение в этом состоянии не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="f612d-366">We do not recommend that you run your application in this state.</span></span><br><br><span data-ttu-id="f612d-367">Дополнительные сведения см. в разделе <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> и в записи [Обработка исключений поврежденного состояния](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) в журнале MSDN.</span><span class="sxs-lookup"><span data-stu-id="f612d-367">For more information, see the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> and the entry [Handling Corrupted State Exceptions](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) in the MSDN magazine.</span></span> |
| <span data-ttu-id="f612d-368">**Исключения подсистемы выполнения**</span><span class="sxs-lookup"><span data-stu-id="f612d-368">**Execution engine exceptions**</span></span> | <span data-ttu-id="f612d-369">Класс <xref:System.ExecutionEngineException> теперь является устаревшим, так как перехватываемое исключение позволяет продолжать выполнение нестабильного процесса.</span><span class="sxs-lookup"><span data-stu-id="f612d-369"><xref:System.ExecutionEngineException> is now obsolete, because a catchable exception will allow an unstable process to continue to run.</span></span> <span data-ttu-id="f612d-370">Это изменение увеличивает предсказуемость и надежность в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="f612d-370">This change improves predictability and reliability in the runtime.</span></span> | <span data-ttu-id="f612d-371">Используйте класс <xref:System.InvalidOperationException> для обозначения состояния.</span><span class="sxs-lookup"><span data-stu-id="f612d-371">Use an <xref:System.InvalidOperationException> to signal the condition.</span></span> |

### <a name="reflection"></a><span data-ttu-id="f612d-372">Отражение</span><span class="sxs-lookup"><span data-stu-id="f612d-372">Reflection</span></span>

<span data-ttu-id="f612d-373">Пространство имен: <xref:System.Reflection>; сборка: mscorlib (в mscorlib.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-373">Namespace: <xref:System.Reflection>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="f612d-374">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-374">Feature</span></span> | <span data-ttu-id="f612d-375">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-375">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-376">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-376">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-377">**Хэш-алгоритмы для сборок**</span><span class="sxs-lookup"><span data-stu-id="f612d-377">**Assembly hash algorithms**</span></span> | <span data-ttu-id="f612d-378">Свойство <xref:System.Reflection.AssemblyName.HashAlgorithm> теперь возвращает <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, так как среда выполнения не знает хэш-алгоритма сборки, на которую указывает ссылка, если сборка не загружена.</span><span class="sxs-lookup"><span data-stu-id="f612d-378">The <xref:System.Reflection.AssemblyName.HashAlgorithm> property now returns <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, because the runtime does not know the hash algorithm of the referenced assembly when the assembly is not loaded.</span></span> <span data-ttu-id="f612d-379">(Это касается использования данного свойства в сборке, на которую указывает ссылка, например в сборке, возвращаемой методом <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A>.)</span><span class="sxs-lookup"><span data-stu-id="f612d-379">(This refers to using the property on a referenced assembly such as that returned by the <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> method.)</span></span> | <span data-ttu-id="f612d-380">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-380">None.</span></span> |
| <span data-ttu-id="f612d-381">**Загрузка сборок**</span><span class="sxs-lookup"><span data-stu-id="f612d-381">**Assembly loading**</span></span> | <span data-ttu-id="f612d-382">Для предотвращения избыточной загрузки сборок и сохранения виртуального адресного пространства среда CLR теперь загружает сборки, используя только функцию `MapViewOfFile` Win32.</span><span class="sxs-lookup"><span data-stu-id="f612d-382">To prevent redundant loading of assemblies and to save virtual address space, the CLR now loads assemblies by using only the Win32 `MapViewOfFile` function.</span></span> <span data-ttu-id="f612d-383">Кроме того, больше не вызывается функция `LoadLibrary`.</span><span class="sxs-lookup"><span data-stu-id="f612d-383">It no longer also calls the `LoadLibrary` function.</span></span><br><br><span data-ttu-id="f612d-384">Это изменение влияет на диагностические приложения указанным ниже образом.</span><span class="sxs-lookup"><span data-stu-id="f612d-384">This change affects diagnostic applications in the following ways:</span></span><br><br><span data-ttu-id="f612d-385">\* Коллекция <xref:System.Diagnostics.ProcessModuleCollection> больше не будет содержать какие-либо модули из библиотеки классов (DLL-файла), как после вызова `Process.GetCurrentProcess().Modules`.</span><span class="sxs-lookup"><span data-stu-id="f612d-385">\* A <xref:System.Diagnostics.ProcessModuleCollection> will no longer contain any modules from a class library (.dll file), as obtained from a call to `Process.GetCurrentProcess().Modules`.</span></span><br><span data-ttu-id="f612d-386">\* Приложениям Win32, использующим функцию `EnumProcessModules`, не будут видны все управляемые модули в списке.</span><span class="sxs-lookup"><span data-stu-id="f612d-386">\* Win32 applications that use the `EnumProcessModules` function will not see all managed modules listed.</span></span> | <span data-ttu-id="f612d-387">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-387">None.</span></span> |
| <span data-ttu-id="f612d-388">**Объявляющий тип**</span><span class="sxs-lookup"><span data-stu-id="f612d-388">**Declaring type**</span></span> | <span data-ttu-id="f612d-389">Свойство <xref:System.Type.DeclaringType> теперь корректно возвращает значение NULL, если тип не имеет объявляющего типа.</span><span class="sxs-lookup"><span data-stu-id="f612d-389">The <xref:System.Type.DeclaringType> property now correctly returns null when the type does not have a declaring type.</span></span> | <span data-ttu-id="f612d-390">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-390">None.</span></span> |
| <span data-ttu-id="f612d-391">**Делегаты**</span><span class="sxs-lookup"><span data-stu-id="f612d-391">**Delegates**</span></span> | <span data-ttu-id="f612d-392">Делегат теперь создает исключение <xref:System.ArgumentNullException> вместо исключения <xref:System.NullReferenceException> при передаче значения NULL в конструктор делегата.</span><span class="sxs-lookup"><span data-stu-id="f612d-392">A delegate now throws an <xref:System.ArgumentNullException> instead of a <xref:System.NullReferenceException> when a null value is passed to the delegate's constructor.</span></span> | <span data-ttu-id="f612d-393">Убедитесь в том, что при обработке исключений перехватываются исключения <xref:System.ArgumentNullException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-393">Ensure that any exception handling catches <xref:System.ArgumentNullException>.</span></span> |
| <span data-ttu-id="f612d-394">**Изменение местоположения глобального кэша сборок**</span><span class="sxs-lookup"><span data-stu-id="f612d-394">**Global assembly cache location change**</span></span> | <span data-ttu-id="f612d-395">Для сборок .NET Framework 4 глобальный кэш сборок перемещен из каталога Windows (%WINDIR%) в подкаталог Microsoft.Net ( *%WINDIR%\\Microsoft.Net*).</span><span class="sxs-lookup"><span data-stu-id="f612d-395">For .NET Framework 4 assemblies, the global assembly cache has been moved from the Windows directory (%WINDIR%) to the Microsoft.Net subdirectory (*%WINDIR%\\Microsoft.Net*).</span></span> <span data-ttu-id="f612d-396">Сборки более ранних версий остаются в старом каталоге.</span><span class="sxs-lookup"><span data-stu-id="f612d-396">Assemblies from earlier versions remain in the older directory.</span></span><br><br><span data-ttu-id="f612d-397">Неуправляемое перечисление [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) содержит новый флаг `ASM_CACHE_ROOT_EX`.</span><span class="sxs-lookup"><span data-stu-id="f612d-397">The unmanaged [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) enumeration contains the new `ASM_CACHE_ROOT_EX` flag.</span></span> <span data-ttu-id="f612d-398">Этот флаг получает местоположение кэша для сборок .NET Framework 4, которые могут быть получены функцией [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md).</span><span class="sxs-lookup"><span data-stu-id="f612d-398">This flag gets the cache location for .NET Framework 4 assemblies, which can be obtained by the [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md) function.</span></span> | <span data-ttu-id="f612d-399">Нет, если приложения не используют явные пути к сборкам, что не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="f612d-399">None, assuming that applications do not use explicit paths to assemblies, which is not a recommended practice.</span></span> |
| <span data-ttu-id="f612d-400">**Средство глобального кэша сборок**</span><span class="sxs-lookup"><span data-stu-id="f612d-400">**Global assembly cache tool**</span></span> | <span data-ttu-id="f612d-401">Средство [Gacutil.exe (программа глобального кэша сборок)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) больше не поддерживает средство просмотра подключаемого модуля оболочки.</span><span class="sxs-lookup"><span data-stu-id="f612d-401">The [Gacutil.exe (Global Assembly Cache Tool)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) no longer supports the shell plugin viewer.</span></span> | <span data-ttu-id="f612d-402">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-402">None.</span></span> |

### <a name="interoperability"></a><span data-ttu-id="f612d-403">Взаимодействие</span><span class="sxs-lookup"><span data-stu-id="f612d-403">Interoperability</span></span>

<span data-ttu-id="f612d-404">Пространство имен: <xref:System.Runtime.InteropServices>; сборка: mscorlib (в mscorlib.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-404">Namespace: <xref:System.Runtime.InteropServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="f612d-405">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-405">Feature</span></span> | <span data-ttu-id="f612d-406">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-406">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-407">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-407">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-408">**Длина буфера** (неуправляемый интерфейс API)</span><span class="sxs-lookup"><span data-stu-id="f612d-408">**Buffer length** (unmanaged API)</span></span> | <span data-ttu-id="f612d-409">Для экономии памяти функциональность параметра `pBufferLengthOffset` метода [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) изменена так, чтобы соответствовать параметру `pStringLengthOffset`.</span><span class="sxs-lookup"><span data-stu-id="f612d-409">To save memory, the functionality for the `pBufferLengthOffset` parameter for the [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) method has been changed to match the `pStringLengthOffset` parameter.</span></span> <span data-ttu-id="f612d-410">Оба параметра теперь указывают на расположение смещения длины строки.</span><span class="sxs-lookup"><span data-stu-id="f612d-410">Both parameters now point to the offset location of the string's length.</span></span> <span data-ttu-id="f612d-411">Длина буфера удалена из представления строкового класса.</span><span class="sxs-lookup"><span data-stu-id="f612d-411">Buffer length has been removed from the representation of the string class.</span></span> | <span data-ttu-id="f612d-412">Измените части, зависящие от длины буфера.</span><span class="sxs-lookup"><span data-stu-id="f612d-412">Remove any dependency on the buffer length.</span></span> |
| <span data-ttu-id="f612d-413">**JIT-отладка**</span><span class="sxs-lookup"><span data-stu-id="f612d-413">**JIT debugging**</span></span> | <span data-ttu-id="f612d-414">Чтобы упростить регистрацию для JIT-отладки, отладчик .NET Framework теперь использует только раздел реестра AeDebug, управляющий поведением JIT-отладки для машинного кода.</span><span class="sxs-lookup"><span data-stu-id="f612d-414">To simplify registration for just-in-time (JIT) debugging, the .NET Framework debugger now uses only the AeDebug registry key, which controls the JIT debugging behavior for native code.</span></span> <span data-ttu-id="f612d-415">Это изменение имеет указанные ниже последствия.</span><span class="sxs-lookup"><span data-stu-id="f612d-415">This change results in the following:</span></span><br><br><span data-ttu-id="f612d-416">\* Теперь нельзя регистрировать два разных отладчика для управляемого и машинного кода.</span><span class="sxs-lookup"><span data-stu-id="f612d-416">\* You can no longer register two different debuggers for managed and native code.</span></span><br><span data-ttu-id="f612d-417">\* Теперь нельзя автоматически запускать отладчик для неинтерактивного процесса, но можно предложить пользователю интерактивный процесс.</span><span class="sxs-lookup"><span data-stu-id="f612d-417">\* You can no longer start the debugger automatically for a non-interactive process, but you can prompt the user for an interactive process.</span></span><br><span data-ttu-id="f612d-418">\* Если не удается запустить отладчик или нет зарегистрированного отладчика, который должен быть запущен, уведомление больше не выводится.</span><span class="sxs-lookup"><span data-stu-id="f612d-418">\* You are no longer notified when the debugger fails to start, or when there is no registered debugger that should be started.</span></span><br><span data-ttu-id="f612d-419">\* Политики автоматического запуска, зависящие от интерактивности приложения, больше не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="f612d-419">\* Auto-launch policies that depend on the interactivity of the application are no longer supported.</span></span> | <span data-ttu-id="f612d-420">Скорректируйте операции отладки согласно требованиям.</span><span class="sxs-lookup"><span data-stu-id="f612d-420">Adjust debugging operations as required.</span></span> |
| <span data-ttu-id="f612d-421">**Вызов неуправляемого кода**</span><span class="sxs-lookup"><span data-stu-id="f612d-421">**Platform invoke**</span></span> | <span data-ttu-id="f612d-422">Чтобы улучшить производительность при взаимодействии с неуправляемым кодом, некорректные соглашения о вызовах в вызове неуправляемого кода теперь приводят к сбою приложения.</span><span class="sxs-lookup"><span data-stu-id="f612d-422">To improve performance in interoperability with unmanaged code, incorrect calling conventions in a platform invoke now cause the application to fail.</span></span> <span data-ttu-id="f612d-423">В более ранних версиях слой маршалинга разрешал такие ошибки вверх по стеку.</span><span class="sxs-lookup"><span data-stu-id="f612d-423">In previous versions, the marshaling layer resolved these errors up the stack.</span></span> | <span data-ttu-id="f612d-424">При отладке приложений в Microsoft Visual Studio вы получите оповещения о таких ошибках и сможете исправить их.</span><span class="sxs-lookup"><span data-stu-id="f612d-424">Debugging your applications in Microsoft Visual Studio alerts you to these errors so you can correct them.</span></span><br><br><span data-ttu-id="f612d-425">Если у вас есть двоичные файлы, которые невозможно обновить, можно включить элемент [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) в файл конфигурации приложения, чтобы ошибки вызовов разрешались вверх по стеку, как в более ранних версиях.</span><span class="sxs-lookup"><span data-stu-id="f612d-425">If you have binaries that cannot be updated, you can include the [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) element in your application's configuration file to enable calling errors to be resolved up the stack as in earlier versions.</span></span> <span data-ttu-id="f612d-426">Однако это может повлиять на производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="f612d-426">However, this may affect the performance of your application.</span></span> |
| <span data-ttu-id="f612d-427">**Удаленные интерфейсы** (неуправляемый интерфейс API)</span><span class="sxs-lookup"><span data-stu-id="f612d-427">**Removed interfaces** (unmanaged API)</span></span> | <span data-ttu-id="f612d-428">Чтобы не вводить в заблуждение разработчиков, перечисленные ниже интерфейсы были удалены. Причина удаления в том, что они не обеспечивали никаких полезных сценариев времени выполнения и среда CLR не предоставляла и не принимала никаких реализаций.</span><span class="sxs-lookup"><span data-stu-id="f612d-428">To avoid developer confusion, the following interfaces were removed, because they did not provide any useful run-time scenarios, and the CLR did not provide or accept any implementations:</span></span><br><br><span data-ttu-id="f612d-429">\* **INativeImageINativeImageDependency**</span><span class="sxs-lookup"><span data-stu-id="f612d-429">\* **INativeImageINativeImageDependency**</span></span><br><span data-ttu-id="f612d-430">\* **INativeImageInstallInfo**</span><span class="sxs-lookup"><span data-stu-id="f612d-430">\* **INativeImageInstallInfo**</span></span><br><span data-ttu-id="f612d-431">\* **INativeImageEvaluate**</span><span class="sxs-lookup"><span data-stu-id="f612d-431">\* **INativeImageEvaluate**</span></span><br><span data-ttu-id="f612d-432">\* **INativeImageConverter**</span><span class="sxs-lookup"><span data-stu-id="f612d-432">\* **INativeImageConverter**</span></span><br><span data-ttu-id="f612d-433">\* **ICorModule**</span><span class="sxs-lookup"><span data-stu-id="f612d-433">\* **ICorModule**</span></span><br><span data-ttu-id="f612d-434">\* **IMetaDataConverter**</span><span class="sxs-lookup"><span data-stu-id="f612d-434">\* **IMetaDataConverter**</span></span> | <span data-ttu-id="f612d-435">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-435">None.</span></span> |

## <a name="data"></a><span data-ttu-id="f612d-436">Data</span><span class="sxs-lookup"><span data-stu-id="f612d-436">Data</span></span>

<span data-ttu-id="f612d-437">В этом разделе описаны проблемы с миграцией при использовании наборов данных и клиентов SQL, Entity Framework, LINQ to SQL и серверов данных WCF (ранее называвшихся службами данных ADO.NET).</span><span class="sxs-lookup"><span data-stu-id="f612d-437">This section describes migration issues for using data sets and SQL clients, the Entity Framework, LINQ to SQL, and WCF Data Servers (formerly known as ADO.NET Data Services).</span></span>

### <a name="dataset-and-sql-client"></a><span data-ttu-id="f612d-438">Набор данных и клиент SQL</span><span class="sxs-lookup"><span data-stu-id="f612d-438">DataSet and SQL Client</span></span>

<span data-ttu-id="f612d-439">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-439">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="f612d-440">Пространства имен: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; сборки: System.Data (в System.Data.dll), System.Data.Entity (в System.Data.Entity.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-440">Namespaces: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; assemblies: System.Data (in System.Data.dll), System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="f612d-441">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-441">Feature</span></span> | <span data-ttu-id="f612d-442">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-442">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-443">**Сценарии POCO**</span><span class="sxs-lookup"><span data-stu-id="f612d-443">**POCO Scenarios**</span></span> | <span data-ttu-id="f612d-444">Для более удобного использования в сценариях POCO интерфейс <xref:System.Data.Objects.DataClasses.IRelatedEnd> теперь имеет новые методы.</span><span class="sxs-lookup"><span data-stu-id="f612d-444">The <xref:System.Data.Objects.DataClasses.IRelatedEnd> interface has new methods to improve its usability in Plain Old CLR Object (POCO) scenarios.</span></span> <span data-ttu-id="f612d-445">Они принимают объект <xref:System.Object> вместо сущности <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> в качестве параметра.</span><span class="sxs-lookup"><span data-stu-id="f612d-445">These new methods take an <xref:System.Object> instead of an <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> entity as a parameter.</span></span> |
| <span data-ttu-id="f612d-446">**Редактирование строк**</span><span class="sxs-lookup"><span data-stu-id="f612d-446">**Editing Rows**</span></span> | <span data-ttu-id="f612d-447">Метод <xref:System.Collections.IList.IndexOf%2A>, реализованный классом <xref:System.Data.DataView>, теперь правильно возвращает значение редактируемой строки, а не значение –1.</span><span class="sxs-lookup"><span data-stu-id="f612d-447">The <xref:System.Collections.IList.IndexOf%2A> method, as implemented by the <xref:System.Data.DataView> class, now correctly returns the value of a row that is being edited, instead of returning -1.</span></span> |
| <span data-ttu-id="f612d-448">**События**</span><span class="sxs-lookup"><span data-stu-id="f612d-448">**Events**</span></span> | <span data-ttu-id="f612d-449">Событие <xref:System.Data.DataRowView.PropertyChanged> теперь вызывается, когда строка находится в измененном состоянии и вызван метод <xref:System.Data.DataRow.RejectChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="f612d-449">The <xref:System.Data.DataRowView.PropertyChanged> event is now raised when a row is in a modified state and the <xref:System.Data.DataRow.RejectChanges%2A> method is called.</span></span> <span data-ttu-id="f612d-450">Благодаря этому изменению стало проще создавать элементы управления пользовательского интерфейса, предоставляющие содержимое объекта <xref:System.Data.DataSet>.</span><span class="sxs-lookup"><span data-stu-id="f612d-450">This change makes it easier to create UI controls that expose the contents of a <xref:System.Data.DataSet> object.</span></span> |
| <span data-ttu-id="f612d-451">**Исключения**</span><span class="sxs-lookup"><span data-stu-id="f612d-451">**Exceptions**</span></span> | <span data-ttu-id="f612d-452">Когда подключение не установлено или не открыто, метод <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> теперь вызывает исключение <xref:System.InvalidOperationException> вместо исключения <xref:System.NullReferenceException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-452">The <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> method now throws an <xref:System.InvalidOperationException> when a connection is not set or open instead of a <xref:System.NullReferenceException>.</span></span> |
| <span data-ttu-id="f612d-453">**Сопоставление представлений**</span><span class="sxs-lookup"><span data-stu-id="f612d-453">**Mapping Views**</span></span> | <span data-ttu-id="f612d-454">Ошибки сопоставления представлений запросов теперь перехватываются во время разработки; во время выполнения теперь не создается исключение <xref:System.NullReferenceException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-454">Query view mapping errors are now caught at design time instead of throwing a <xref:System.NullReferenceException> at run time.</span></span><br><br><span data-ttu-id="f612d-455">Проверка сопоставления теперь перехватывает ошибку, когда два набора ассоциаций в концептуальной схеме (CSDL) сопоставлены с одним столбцом.</span><span class="sxs-lookup"><span data-stu-id="f612d-455">Mapping validation now catches the error in which two association sets in Conceptual Schema (CSDL) are mapped to the same column.</span></span> |
| <span data-ttu-id="f612d-456">**Транзакции**</span><span class="sxs-lookup"><span data-stu-id="f612d-456">**Transactions**</span></span> | <span data-ttu-id="f612d-457">Если приложение попытается выполнить оператор применительно к подключению после завершения транзакции (в том числе прерванной транзакции или отката), будет создано исключение <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-457">If an application tries to execute a statement on a connection after a transaction has been completed (including aborted or rolled back), an <xref:System.InvalidOperationException> is now thrown.</span></span> <span data-ttu-id="f612d-458">Более ранние версии не создавали исключение и позволяли выполнять дополнительные команды, даже если транзакция была прервана.</span><span class="sxs-lookup"><span data-stu-id="f612d-458">Previous versions did not throw an exception and let you execute additional commands even if a transaction was aborted.</span></span> |

### <a name="entity-framework"></a><span data-ttu-id="f612d-459">Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f612d-459">Entity Framework</span></span>

<span data-ttu-id="f612d-460">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-460">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="f612d-461">Пространства имен: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; сборка: System.Data.Entity (в System.Data.Entity.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-461">Namespaces: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; assembly: System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="f612d-462">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-462">Feature</span></span> | <span data-ttu-id="f612d-463">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-463">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-464">**Объекты сущностей**</span><span class="sxs-lookup"><span data-stu-id="f612d-464">**Entity objects**</span></span> | <span data-ttu-id="f612d-465">Установлена равнозначность между методом <xref:System.Data.Objects.ObjectContext.Detach%2A> и состоянием объекта сущности при вызове метода <xref:System.Data.Objects.ObjectContext.SaveChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="f612d-465">There is now parity between the <xref:System.Data.Objects.ObjectContext.Detach%2A> method and the state of the entity object when the <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="f612d-466">Повышение согласованности предотвращает возникновение неожиданных исключений.</span><span class="sxs-lookup"><span data-stu-id="f612d-466">This improved consistency prevents unexpected exceptions from being thrown.</span></span> |
| <span data-ttu-id="f612d-467">**Entity SQL**</span><span class="sxs-lookup"><span data-stu-id="f612d-467">**Entity SQL**</span></span> | <span data-ttu-id="f612d-468">Улучшены правила разрешения идентификаторов в Entity SQL.</span><span class="sxs-lookup"><span data-stu-id="f612d-468">Rules have been improved for identifier resolutions in Entity SQL.</span></span><br><br><span data-ttu-id="f612d-469">Анализатор Entity SQL теперь имеет улучшенную логику для разрешения составных идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="f612d-469">The Entity SQL parser has improved logic for resolving multipart identifiers.</span></span> |
| <span data-ttu-id="f612d-470">**Структурные заметки**</span><span class="sxs-lookup"><span data-stu-id="f612d-470">**Structural annotations**</span></span> | <span data-ttu-id="f612d-471">Entity Framework теперь распознает структурные заметки.</span><span class="sxs-lookup"><span data-stu-id="f612d-471">The Entity Framework now recognizes structural annotations.</span></span> |
| <span data-ttu-id="f612d-472">**Запросы**</span><span class="sxs-lookup"><span data-stu-id="f612d-472">**Queries**</span></span> | <span data-ttu-id="f612d-473">Запросов коснулись перечисленные ниже усовершенствования.</span><span class="sxs-lookup"><span data-stu-id="f612d-473">The following improvements were made in queries:</span></span><br><br><span data-ttu-id="f612d-474">\* Запрос `GroupBy` с использованием ключа NULL для пустой коллекции не приведет к возврату каких-либо строк независимо от наличия в запросе дополнительных указаний.</span><span class="sxs-lookup"><span data-stu-id="f612d-474">\* A `GroupBy` query using a null key over an empty collection will not return any rows, regardless if there are any additional selects in the query.</span></span><br><span data-ttu-id="f612d-475">\* Созданный код SQL в запросах LINQ и Entity-SQL теперь по умолчанию обрабатывает строковые параметры как значения, не имеющие кодировку Юникод.</span><span class="sxs-lookup"><span data-stu-id="f612d-475">\* Generated SQL in LINQ and Entity-SQL queries now treat string parameters as non-Unicode values by default.</span></span> |

### <a name="linq-to-sql"></a><span data-ttu-id="f612d-476">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="f612d-476">LINQ to SQL</span></span>

<span data-ttu-id="f612d-477">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-477">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="f612d-478">Пространства имен: <xref:System.Data.Linq>; сборка: System.Data.Linq (в System.Data.Linq.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-478">Namespace: <xref:System.Data.Linq>; assembly: System.Data.Linq (in System.Data.Linq.dll)</span></span>

| <span data-ttu-id="f612d-479">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-479">Feature</span></span> | <span data-ttu-id="f612d-480">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-480">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-481">**События**</span><span class="sxs-lookup"><span data-stu-id="f612d-481">**Events**</span></span> | <span data-ttu-id="f612d-482">Коллекция <xref:System.Data.Linq.EntitySet%601> теперь вызывает событие <xref:System.Data.Linq.EntitySet%601.ListChanged> для операций добавления и удаления не только когда коллекция <xref:System.Data.Linq.EntitySet%601> загружается, но и когда она выгружается.</span><span class="sxs-lookup"><span data-stu-id="f612d-482">A <xref:System.Data.Linq.EntitySet%601> collection now raises the <xref:System.Data.Linq.EntitySet%601.ListChanged> event for add and remove operations if the <xref:System.Data.Linq.EntitySet%601> is unloaded, in addition to raising the event when the collection is loaded.</span></span> |
| <span data-ttu-id="f612d-483">**Запросы**</span><span class="sxs-lookup"><span data-stu-id="f612d-483">**Queries**</span></span> | <span data-ttu-id="f612d-484">`Skip(0)` больше не игнорируется в запросах LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="f612d-484">`Skip(0)` is no longer ignored in LINQ to SQL queries.</span></span> <span data-ttu-id="f612d-485">В результате запросы, в которых есть этот метод, могут вести себя по-другому.</span><span class="sxs-lookup"><span data-stu-id="f612d-485">As a result, queries that have this method might behave differently.</span></span> <span data-ttu-id="f612d-486">Например, в некоторых случаях требуется предложение `OrderBy` со `Skip(0)`, и, если предложение `OrderBy` не было включено, запрос теперь будет вызывать исключение <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-486">For example in some cases, an `OrderBy` clause is required with `Skip(0)`, and the query will now throw a <xref:System.NotSupportedException> exception if the `OrderBy` clause was not included.</span></span> |

### <a name="wcf-data-services"></a><span data-ttu-id="f612d-487">Службы данных WCF</span><span class="sxs-lookup"><span data-stu-id="f612d-487">WCF Data Services</span></span>

<span data-ttu-id="f612d-488">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-488">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="f612d-489">Пространства имен: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; сборки: System.Data.Services (в System.Data.Services.dll), System.Data.Services.Client (в System.Data.Services.Client.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-489">Namespaces: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; assemblies: System.Data.Services (in System.Data.Services.dll), System.Data.Services.Client (in System.Data.Services.Client.dll)</span></span>

| <span data-ttu-id="f612d-490">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-490">Feature</span></span> | <span data-ttu-id="f612d-491">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-491">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-492">**Пакетное двоичное содержимое**</span><span class="sxs-lookup"><span data-stu-id="f612d-492">**Batched Binary Content**</span></span> | <span data-ttu-id="f612d-493">Службы WCF Data Services теперь поддерживают пакетное двоичное содержимое в запросах и ответах.</span><span class="sxs-lookup"><span data-stu-id="f612d-493">WCF Data Services now supports batched binary content in requests and responses.</span></span> |
| <span data-ttu-id="f612d-494">**Перехватчики изменений**</span><span class="sxs-lookup"><span data-stu-id="f612d-494">**Change interceptors**</span></span> | <span data-ttu-id="f612d-495">Перехватчики изменений теперь выполняются для запроса на удаление.</span><span class="sxs-lookup"><span data-stu-id="f612d-495">Change interceptors are now executed for a delete request.</span></span><br><br><span data-ttu-id="f612d-496">Перехватчик изменений — это метод, выполняемый каждый раз, когда сервер получает запрос на изменение сущности в наборе сущностей.</span><span class="sxs-lookup"><span data-stu-id="f612d-496">A change interceptor is a method that runs every time a request is received by the server to modify an entity in the entity set.</span></span> <span data-ttu-id="f612d-497">Он выполняется до выполнения входящего запроса.</span><span class="sxs-lookup"><span data-stu-id="f612d-497">It runs before the incoming request is executed.</span></span> <span data-ttu-id="f612d-498">Перехватчик изменений предоставляет доступ к изменяемой сущности и выполняемой операции.</span><span class="sxs-lookup"><span data-stu-id="f612d-498">The change interceptor provides access to the entity that is being changed and the operation that is being performed on it.</span></span> |
| <span data-ttu-id="f612d-499">**Исключения**</span><span class="sxs-lookup"><span data-stu-id="f612d-499">**Exceptions**</span></span> | <span data-ttu-id="f612d-500">Перечисленные ниже условия теперь вызывают более полезные исключения вместо исключения <xref:System.NullReferenceException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-500">The following conditions now throw more useful exceptions instead of a <xref:System.NullReferenceException>:</span></span><br><br><span data-ttu-id="f612d-501">\* При истечении времени ожидания для вызова службы данных возникает исключение <xref:System.ServiceProcess.TimeoutException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-501">\* A <xref:System.ServiceProcess.TimeoutException> when a call to a data service times out.</span></span><br><span data-ttu-id="f612d-502">\* При неправильном запросе службы данных вызывается исключение <xref:System.Data.Services.Client.DataServiceRequestException>.</span><span class="sxs-lookup"><span data-stu-id="f612d-502">\* A <xref:System.Data.Services.Client.DataServiceRequestException> when a bad request is made to a data service.</span></span><br><br><span data-ttu-id="f612d-503">Измените в приложениях обработку исключений, чтобы новые исключения перехватывались.</span><span class="sxs-lookup"><span data-stu-id="f612d-503">In your applications, you should change exception handling to catch the new exceptions.</span></span> |
| <span data-ttu-id="f612d-504">**Заголовки**</span><span class="sxs-lookup"><span data-stu-id="f612d-504">**Headers**</span></span> | <span data-ttu-id="f612d-505">Заголовков коснулись перечисленные ниже усовершенствования.</span><span class="sxs-lookup"><span data-stu-id="f612d-505">The following improvements were made to headers:</span></span><br><br><span data-ttu-id="f612d-506">\* Службы WCF Data Services теперь корректно отклоняют заголовок `eTag`, значение которого не задано.</span><span class="sxs-lookup"><span data-stu-id="f612d-506">\* WCF Data Services now correctly rejects an `eTag` header that has an unspecified value.</span></span><br><span data-ttu-id="f612d-507">\* Службы WCF Data Services теперь возвращают ошибку и не выполняют запрос на удаление запроса на ссылку, если в запросе есть заголовок `if-*`.</span><span class="sxs-lookup"><span data-stu-id="f612d-507">\* WCF Data Services now returns an error and does not execute the request for a delete request to a link when an `if-*` header is in the request.</span></span><br><span data-ttu-id="f612d-508">\* Службы WCF Data Services теперь возвращают клиенту ошибку в формате (Atom, JSON), который клиент указал в заголовке Accept.</span><span class="sxs-lookup"><span data-stu-id="f612d-508">\* WCF Data Services now returns an error to the client in the format (Atom, JSON) that the client specified in the Accept header.</span></span> |
| <span data-ttu-id="f612d-509">**Модуль чтения JSON**</span><span class="sxs-lookup"><span data-stu-id="f612d-509">**JSON Reader**</span></span> | <span data-ttu-id="f612d-510">Модуль чтения JSON (JavaScript Object Notation — нотация объектов JavaScript) теперь корректно возвращает ошибку при чтении одиночного escape-символа обратной косой черты (\\) во время обработки полезных нагрузок JSON, отправленных в службу данных WCF.</span><span class="sxs-lookup"><span data-stu-id="f612d-510">The JavaScript Object Notation (JSON) reader now correctly returns an error when it reads the single backslash ("\\") escape character, when it processes JSON payloads sent to a WCF Data Service.</span></span> |
| <span data-ttu-id="f612d-511">**Слияния**</span><span class="sxs-lookup"><span data-stu-id="f612d-511">**Merges**</span></span> | <span data-ttu-id="f612d-512">Перечисления <xref:System.Data.Services.Client.MergeOption> коснулись перечисленные ниже усовершенствования.</span><span class="sxs-lookup"><span data-stu-id="f612d-512">The following improvements were made to the <xref:System.Data.Services.Client.MergeOption> enumeration:</span></span><br><br><span data-ttu-id="f612d-513">\* Параметр слияния <xref:System.Data.Services.Client.MergeOption> больше не изменяет сущность в клиенте в результате последующего ответа службы данных.</span><span class="sxs-lookup"><span data-stu-id="f612d-513">\* The <xref:System.Data.Services.Client.MergeOption> merge option no longer modifies the entity on the client as a result of any subsequent response from a data service.</span></span><br><span data-ttu-id="f612d-514">\* Параметр <xref:System.Data.Services.Client.MergeOption> теперь согласован между динамическим SQL и обновлениями на основе хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="f612d-514">\* The <xref:System.Data.Services.Client.MergeOption> option is now consistent between dynamic SQL and stored procedure-based updates.</span></span> |
| <span data-ttu-id="f612d-515">**Запросы**</span><span class="sxs-lookup"><span data-stu-id="f612d-515">**Requests**</span></span> | <span data-ttu-id="f612d-516">Метод <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> теперь вызывается перед обработкой запроса, обращенного к службам данных.</span><span class="sxs-lookup"><span data-stu-id="f612d-516">The <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> method is now called before a request to data services is processed.</span></span> <span data-ttu-id="f612d-517">Это позволяет обеспечить правильную работу запроса для служб <xref:System.Data.Services.Providers.ServiceOperation>.</span><span class="sxs-lookup"><span data-stu-id="f612d-517">This enables the request to work correctly for <xref:System.Data.Services.Providers.ServiceOperation> services.</span></span> |
| <span data-ttu-id="f612d-518">**Потоки**</span><span class="sxs-lookup"><span data-stu-id="f612d-518">**Streams**</span></span> | <span data-ttu-id="f612d-519">Службы WCF Data Services больше не закрывают базовый поток для операций чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="f612d-519">WCF Data Services no longer closes the underlying stream for read and write operations.</span></span> |
| <span data-ttu-id="f612d-520">**Универсальные коды ресурсов (URI)**</span><span class="sxs-lookup"><span data-stu-id="f612d-520">**URIs**</span></span> | <span data-ttu-id="f612d-521">Экранирование кодов URI клиентом служб WCF Data Services исправлено.</span><span class="sxs-lookup"><span data-stu-id="f612d-521">The escaping of URIs by WCF Data Services client has been corrected.</span></span> |

## <a name="windows-communication-foundation-wcf"></a><span data-ttu-id="f612d-522">Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="f612d-522">Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="f612d-523">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-523">The following table describes improvements to features that previously had limitations or other issues.</span></span>

| <span data-ttu-id="f612d-524">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-524">Feature</span></span> | <span data-ttu-id="f612d-525">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-525">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-526">**Файлы конфигурации**</span><span class="sxs-lookup"><span data-stu-id="f612d-526">**Configuration files**</span></span> | <span data-ttu-id="f612d-527">Чтобы обеспечить наследование поведения в иерархии файлов конфигурации, WCF теперь поддерживает слияние по нескольким файлам конфигурации.</span><span class="sxs-lookup"><span data-stu-id="f612d-527">To enable inheritance of behaviors through the configuration file hierarchy, WCF now supports merging across configuration files.</span></span><br><br><span data-ttu-id="f612d-528">Модель наследования конфигурации расширена и теперь позволяет пользователям определять поведение, которое будет применено ко всем службам, запущенным на компьютере.</span><span class="sxs-lookup"><span data-stu-id="f612d-528">The configuration inheritance model is now expanded to let users define behaviors that will be applied to all the services that are running on the computer.</span></span><br><br><span data-ttu-id="f612d-529">Могут произойти изменения поведения, если есть несколько вариантов поведения с одинаковыми именами на различных уровнях иерархии.</span><span class="sxs-lookup"><span data-stu-id="f612d-529">You may encounter behavioral changes if there are behaviors with the same name at different levels of the hierarchy.</span></span> |
| <span data-ttu-id="f612d-530">**Размещение службы**</span><span class="sxs-lookup"><span data-stu-id="f612d-530">**Service hosting**</span></span> | <span data-ttu-id="f612d-531">Элемент конфигурации `<serviceHostingEnvironment>` больше нельзя задавать на уровне службы, добавляя атрибут `allowDefinition="MachineToApplication"` в определение элемента.</span><span class="sxs-lookup"><span data-stu-id="f612d-531">You can no longer specify the `<serviceHostingEnvironment>` configuration element at the service level by adding the attribute `allowDefinition="MachineToApplication"` to the element definition.</span></span><br><br><span data-ttu-id="f612d-532">Задание элемента `<serviceHostingEnvironment>` на уровне службы технически некорректно и приводит к нарушению целостности поведения.</span><span class="sxs-lookup"><span data-stu-id="f612d-532">Specifying the `<serviceHostingEnvironment>` element at the service level is technically incorrect and causes inconsistent behavior.</span></span> |

## <a name="windows-presentation-foundation-wpf"></a><span data-ttu-id="f612d-533">Windows Presentation Foundation (WPF)</span><span class="sxs-lookup"><span data-stu-id="f612d-533">Windows Presentation Foundation (WPF)</span></span>

### <a name="applications"></a><span data-ttu-id="f612d-534">Приложения</span><span class="sxs-lookup"><span data-stu-id="f612d-534">Applications</span></span>

<span data-ttu-id="f612d-535">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Controls>; сборка: PresentationFramework (в PresentationFramework.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-535">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>; assembly: PresentationFramework (in PresentationFramework.dll)</span></span>

| <span data-ttu-id="f612d-536">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-536">Feature</span></span> | <span data-ttu-id="f612d-537">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-537">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-538">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-538">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-539">**Обработка исключений**</span><span class="sxs-lookup"><span data-stu-id="f612d-539">**Exception handling**</span></span> | <span data-ttu-id="f612d-540">Чтобы как можно раньше обнаруживать ошибки, WPF создает исключение <xref:System.Reflection.TargetInvocationException> и задает свойство <xref:System.Exception.InnerException> для критических исключений, таких как <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException> и <xref:System.Security.SecurityException>, вместо того чтобы перехватывать исходное исключение.</span><span class="sxs-lookup"><span data-stu-id="f612d-540">To enable errors to be detected earlier, WPF throws a <xref:System.Reflection.TargetInvocationException> and sets the <xref:System.Exception.InnerException> property to critical exceptions, such as <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>, and <xref:System.Security.SecurityException>, instead of catching the original exception.</span></span> | <span data-ttu-id="f612d-541">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-541">None.</span></span> |
| <span data-ttu-id="f612d-542">**Связанные ресурсы**</span><span class="sxs-lookup"><span data-stu-id="f612d-542">**Linked resources**</span></span> | <span data-ttu-id="f612d-543">Чтобы облегчить связывание, файлы ресурсов (например, изображения), расположенные не в структуре папки проекта, используют как идентификатор ресурса полный путь к файлу ресурсов вместо простого имени файла.</span><span class="sxs-lookup"><span data-stu-id="f612d-543">To make linking easier, resource files (such as images) that are located in a location other than the project's folder structure use the resource file's full path instead of just its file name as the resource ID when the application is built.</span></span> <span data-ttu-id="f612d-544">Приложение будет иметь возможность найти эти файлы во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f612d-544">The application will be able to locate the files at run time.</span></span> | <span data-ttu-id="f612d-545">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-545">None.</span></span> |
| <span data-ttu-id="f612d-546">**Приложения с частичным доверием**</span><span class="sxs-lookup"><span data-stu-id="f612d-546">**Partial-trust applications**</span></span> | <span data-ttu-id="f612d-547">По соображениям безопасности приложения на основе Windows, использующие частичное доверие и содержащие элемент управления <xref:System.Windows.Controls.WebBrowser> или элемент управления <xref:System.Windows.Controls.Frame>, который содержит HTML, вызывают исключение <xref:System.Security.SecurityException> при создании этого элемента управления.</span><span class="sxs-lookup"><span data-stu-id="f612d-547">For security considerations, Windows-based applications that run in partial trust and contain a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML will throw a <xref:System.Security.SecurityException> when the control is created.</span></span><br><br><span data-ttu-id="f612d-548">Браузерные приложения будут вызывать исключение и выводить сообщение, если выполняются все перечисленные ниже условия.</span><span class="sxs-lookup"><span data-stu-id="f612d-548">Browser applications will throw an exception and display a message if all of the following conditions are met:</span></span><br><br><span data-ttu-id="f612d-549">\* Приложение работает в Firefox.</span><span class="sxs-lookup"><span data-stu-id="f612d-549">\* The application is running in Firefox.</span></span><br><span data-ttu-id="f612d-550">\* Приложение запускается в режиме частичного доверия в зоне Интернета с ненадежных сайтов.</span><span class="sxs-lookup"><span data-stu-id="f612d-550">\* The application is running in partial trust in the Internet zone from non-trusted sites.</span></span><br><span data-ttu-id="f612d-551">\* В приложении имеется элемент управления <xref:System.Windows.Controls.WebBrowser> или <xref:System.Windows.Controls.Frame>, содержащий HTML.</span><span class="sxs-lookup"><span data-stu-id="f612d-551">\* The application contains a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML.</span></span><br><br><span data-ttu-id="f612d-552">Следует отметить, что это не относится к приложениям, запускаемым с надежных сайтов или из зоны интрасети.</span><span class="sxs-lookup"><span data-stu-id="f612d-552">Note that applications that run from trusted sites or from the intranet zone will not be affected.</span></span> | <span data-ttu-id="f612d-553">В браузерных приложениях можно смягчить последствия этого изменения, выполнив одно из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="f612d-553">In your browser applications, you can ease this change by doing one of the following:</span></span><br><br><span data-ttu-id="f612d-554">\* запускать приложение в режиме полного доверия;</span><span class="sxs-lookup"><span data-stu-id="f612d-554">\* Run the browser application in full trust.</span></span><br><span data-ttu-id="f612d-555">\* попросить клиентов добавить сайт приложения в зону надежных сайтов;</span><span class="sxs-lookup"><span data-stu-id="f612d-555">\* Have customers add the application's site to the trusted sites zone.</span></span><br><span data-ttu-id="f612d-556">\* попросить клиентов запускать приложение в Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="f612d-556">\* Have customers run the application in Internet Explorer.</span></span> |
| <span data-ttu-id="f612d-557">**Словари ресурсов**</span><span class="sxs-lookup"><span data-stu-id="f612d-557">**Resource dictionaries**</span></span> | <span data-ttu-id="f612d-558">Чтобы улучшить словари ресурсов на уровне темы и предотвратить их изменение, фиксируемые ресурсы, определенные в словаре ресурсов и объединенные в словарь на уровне темы, теперь всегда помечаются как фиксированные и не могут изменяться.</span><span class="sxs-lookup"><span data-stu-id="f612d-558">To improve theme-level resource dictionaries and prevent them from changing, freezable resources that are defined in a resource dictionary and merged into a theme-level dictionary are now always marked as frozen and are immutable.</span></span> <span data-ttu-id="f612d-559">Это ожидаемое поведение для фиксируемых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f612d-559">This is the expected behavior for freezable resources.</span></span> | <span data-ttu-id="f612d-560">Приложения, изменяющие ресурс, определенный в объединенном словаре на уровне темы, должны клонировать ресурс и изменять копию.</span><span class="sxs-lookup"><span data-stu-id="f612d-560">Applications that modify a resource that is defined in a theme-level merged dictionary should clone the resource and modify the cloned copy.</span></span> <span data-ttu-id="f612d-561">Кроме того, можно пометить ресурс как `x:Shared="false"`, чтобы словарь <xref:System.Windows.ResourceDictionary> создавал копию каждый раз, когда ресурс запрашивается.</span><span class="sxs-lookup"><span data-stu-id="f612d-561">Alternatively, the resource can be marked `x:Shared="false"` so that the <xref:System.Windows.ResourceDictionary> creates a new copy every time the resource is queried.</span></span> |
| <span data-ttu-id="f612d-562">**Windows 7**</span><span class="sxs-lookup"><span data-stu-id="f612d-562">**Windows 7**</span></span> | <span data-ttu-id="f612d-563">Чтобы приложения WPF лучше работали в Windows 7, были внесены указанные ниже изменения для исправления поведения окна.</span><span class="sxs-lookup"><span data-stu-id="f612d-563">To make WPF applications work better on Windows 7, the following improvements were made to correct the behavior of a window:</span></span><br><br><span data-ttu-id="f612d-564">\* Состояния закрепления и жестов теперь работают предсказуемо в соответствии с действиями пользователей.</span><span class="sxs-lookup"><span data-stu-id="f612d-564">\* Dock and gesture states now work as expected based on user interactions.</span></span><br><span data-ttu-id="f612d-565">\* Команды панели задач **Окна каскадом, Отображать окна стопкой** и **Отображать окна рядом** теперь дают правильный результат и обновляют соответствующие свойства.</span><span class="sxs-lookup"><span data-stu-id="f612d-565">\* The taskbar commands **Cascade windows, Show windows stacked**, and **Show windows side-by-side** now have the correct behavior and update the appropriate properties.</span></span><br><span data-ttu-id="f612d-566">\* Свойства `Top`, `Left`, `Width` и `Height` для открытого во весь экран или свернутого окна теперь содержат правильные сведения о расположении для восстановления окна в зависимости от монитора.</span><span class="sxs-lookup"><span data-stu-id="f612d-566">\* The `Top`, `Left`, `Width`, and `Height` properties for a maximized or minimized window now contain the correct restore location of the window instead of other values, depending on the monitor.</span></span> | <span data-ttu-id="f612d-567">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-567">None.</span></span> |
| <span data-ttu-id="f612d-568">**Стиль и прозрачность Windows**</span><span class="sxs-lookup"><span data-stu-id="f612d-568">**Windows style and transparency**</span></span> | <span data-ttu-id="f612d-569">Исключение <xref:System.InvalidOperationException> создается при попытке задать для свойства <xref:System.Windows.Window.WindowStyle> значение, отличное от <xref:System.Windows.WindowStyle>, если свойство <xref:System.Windows.Window.AllowsTransparency> имеет значение `true`, а <xref:System.Windows.WindowState> имеет значение <xref:System.Windows.WindowState>.</span><span class="sxs-lookup"><span data-stu-id="f612d-569">An <xref:System.InvalidOperationException> is thrown if you try to set <xref:System.Windows.Window.WindowStyle> to a value other than <xref:System.Windows.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true` and <xref:System.Windows.WindowState> is <xref:System.Windows.WindowState>.</span></span> | <span data-ttu-id="f612d-570">Если требуется изменить значение свойства <xref:System.Windows.Window.WindowStyle>, когда свойство <xref:System.Windows.Window.AllowsTransparency> имеет значение `true`, можно вызвать функцию `SetWindowLongPtr` Win32.</span><span class="sxs-lookup"><span data-stu-id="f612d-570">If you must change the <xref:System.Windows.Window.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true`, you can call the Win32 `SetWindowLongPtr` function.</span></span> |
| <span data-ttu-id="f612d-571">**Средство просмотра XPS**</span><span class="sxs-lookup"><span data-stu-id="f612d-571">**XPS Viewer**</span></span> | <span data-ttu-id="f612d-572">В WPF не входит пакет Microsoft XML Paper Specification Essentials Pack (XPSEP).</span><span class="sxs-lookup"><span data-stu-id="f612d-572">WPF does not include the Microsoft XML Paper Specification Essentials Pack (XPSEP).</span></span> <span data-ttu-id="f612d-573">XPSEP включается в Windows 7 и Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="f612d-573">XPSEP is included with Windows 7 and Windows Vista.</span></span><br><br><span data-ttu-id="f612d-574">На компьютере с ОС Windows XP, на котором не установлена платформа .NET Framework 3.5 с пакетом обновления 1 (SP1), печать с помощью интерфейса API WPF, отличного от того, что используется в <xref:System.Windows.Controls.PrintDialog>, будет зависеть от WINSPOOL.</span><span class="sxs-lookup"><span data-stu-id="f612d-574">On a computer that is running Windows XP without the .NET Framework 3.5 SP1 installed, printing by using a WPF API other than those in <xref:System.Windows.Controls.PrintDialog> will rely on the WINSPOOL.</span></span> <span data-ttu-id="f612d-575">Не будет сообщено о некоторых возможностях принтера, и некоторые параметры принтера не будут применяться во время печати.</span><span class="sxs-lookup"><span data-stu-id="f612d-575">Some printer capabilities will not be reported and some printer settings will not be applied during printing.</span></span> | <span data-ttu-id="f612d-576">При необходимости установите [пакет Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895).</span><span class="sxs-lookup"><span data-stu-id="f612d-576">If needed, install the [Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895).</span></span> |

### <a name="controls"></a><span data-ttu-id="f612d-577">Элементы управления</span><span class="sxs-lookup"><span data-stu-id="f612d-577">Controls</span></span>

<span data-ttu-id="f612d-578">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; сборки: PresentationFramework (в PresentationFramework.dll), PresentationCore (в PresentationCore.dll), WindowsBase (в WindowsBase.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-578">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="f612d-579">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-579">Feature</span></span> | <span data-ttu-id="f612d-580">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-580">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-581">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-581">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-582">**Диалоговые окна**</span><span class="sxs-lookup"><span data-stu-id="f612d-582">**Dialog boxes**</span></span> | <span data-ttu-id="f612d-583">Для увеличения надежности метод <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> вызывается в том же потоке, где был создан элемент управления <xref:Microsoft.Win32.FileDialog>.</span><span class="sxs-lookup"><span data-stu-id="f612d-583">To improve reliability, the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method is called on the same thread that created the <xref:Microsoft.Win32.FileDialog> control.</span></span> | <span data-ttu-id="f612d-584">Элемент управления <xref:Microsoft.Win32.FileDialog> должен создаваться в том же потоке, где вызывается метод <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A>.</span><span class="sxs-lookup"><span data-stu-id="f612d-584">Be sure to create a <xref:Microsoft.Win32.FileDialog> control and call the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method on the same thread.</span></span> |
| <span data-ttu-id="f612d-585">**Плавающие окна**</span><span class="sxs-lookup"><span data-stu-id="f612d-585">**Floating windows**</span></span> | <span data-ttu-id="f612d-586">Чтобы исправить логику восстановления фокуса, которая приводит к ошибочной повторной активации плавающего окна (в результате окно появляется как модальное диалоговое окно), восстановление фокуса теперь не выполняется, если объект не является дочерним объектом окна.</span><span class="sxs-lookup"><span data-stu-id="f612d-586">To fix focus restoration logic that incorrectly keeps reactivating a floating window (making it appear like a modal dialog box), focus restoration is now prevented if the candidate is not a child of the window.</span></span> | <span data-ttu-id="f612d-587">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-587">None.</span></span> |
| <span data-ttu-id="f612d-588">**Элементы коллекции**</span><span class="sxs-lookup"><span data-stu-id="f612d-588">**Items in collections**</span></span> | <span data-ttu-id="f612d-589">Когда элемент перемещается или добавляется в базовую коллекцию, он появляется в представлении <xref:System.Windows.Data.CollectionView> в том же относительном расположении, как если бы представление <xref:System.Windows.Data.CollectionView> не сортировалось.</span><span class="sxs-lookup"><span data-stu-id="f612d-589">When an item is moved or added to an underlying collection, it appears in the <xref:System.Windows.Data.CollectionView> in the same relative location if the <xref:System.Windows.Data.CollectionView> is not sorted.</span></span> <span data-ttu-id="f612d-590">Это обеспечивает согласованность между расположением элемента в коллекции и в связанном представлении <xref:System.Windows.Data.CollectionView>.</span><span class="sxs-lookup"><span data-stu-id="f612d-590">This provides consistency between the item's position in the collection and in the associated <xref:System.Windows.Data.CollectionView>.</span></span> | <span data-ttu-id="f612d-591">Используйте метод <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> или <xref:System.Windows.Data.CollectionView.IndexOf%2A> для поиска расположения элемента в объекте <xref:System.Windows.Data.CollectionView>, вместо того чтобы полагаться на фиксированное расположение элемента.</span><span class="sxs-lookup"><span data-stu-id="f612d-591">Use the <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> or <xref:System.Windows.Data.CollectionView.IndexOf%2A> method to find the location of an item in a <xref:System.Windows.Data.CollectionView> instead of relying on a fixed location of an item.</span></span> |
| <span data-ttu-id="f612d-592">**Макеты**</span><span class="sxs-lookup"><span data-stu-id="f612d-592">**Layouts**</span></span> | <span data-ttu-id="f612d-593">Чтобы избежать ненужного повторного создания макетов, изменение свойства <xref:System.Windows.Controls.Page.ShowsNavigationUI> больше не делает макет недействительным и не вызывает передачу другого макета.</span><span class="sxs-lookup"><span data-stu-id="f612d-593">To eliminate unnecessary re-layouts, changing the <xref:System.Windows.Controls.Page.ShowsNavigationUI> no longer invalidates layout or causes another layout pass.</span></span> | <span data-ttu-id="f612d-594">Если вы предполагаете, что изменение свойства <xref:System.Windows.Controls.Page.ShowsNavigationUI> приведет к передаче другого макета, вызовите метод <xref:System.Windows.UIElement.InvalidateVisual%2A> после задания этого свойства.</span><span class="sxs-lookup"><span data-stu-id="f612d-594">If you expect that changing <xref:System.Windows.Controls.Page.ShowsNavigationUI> will cause another layout pass, call <xref:System.Windows.UIElement.InvalidateVisual%2A> after you set the property.</span></span> |
| <span data-ttu-id="f612d-595">**Меню**</span><span class="sxs-lookup"><span data-stu-id="f612d-595">**Menus**</span></span> | <span data-ttu-id="f612d-596">Чтобы текст ClearType мог использоваться во всплывающих меню, внесены изменения в класс <xref:System.Windows.Controls.ControlTemplate> и в элемент управления <xref:System.Windows.Controls.MenuItem>, а также в другие элементы управления.</span><span class="sxs-lookup"><span data-stu-id="f612d-596">To enable ClearType text in menu pop-ups, modifications were made to the <xref:System.Windows.Controls.ControlTemplate> class and to the <xref:System.Windows.Controls.MenuItem> control and other controls.</span></span> | <span data-ttu-id="f612d-597">Приложения не должны опираться на визуальную структуру шаблонов элементов управления.</span><span class="sxs-lookup"><span data-stu-id="f612d-597">Applications should not rely on the visual structure of control templates.</span></span> <span data-ttu-id="f612d-598">Частью открытого контракта являются только именованные части шаблона <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="f612d-598">Only named parts of a <xref:System.Windows.Controls.ControlTemplate> are part of the public contract.</span></span> <span data-ttu-id="f612d-599">Если приложение должно найти конкретный объект в шаблоне <xref:System.Windows.Controls.ControlTemplate>, следует выполнять поиск по визуальному дереву, а не полагаться на фиксированное расположение объекта в дереве.</span><span class="sxs-lookup"><span data-stu-id="f612d-599">If an application must find a certain object in a <xref:System.Windows.Controls.ControlTemplate>, search the visual tree for a specific type instead of relying on a fixed location of an object in the tree.</span></span> |
| <span data-ttu-id="f612d-600">**Навигация**</span><span class="sxs-lookup"><span data-stu-id="f612d-600">**Navigating**</span></span> | <span data-ttu-id="f612d-601">Если объект <xref:System.Windows.Controls.Frame> непосредственно переходит в расположение, свойство <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> принимает значение `true` после первого перехода.</span><span class="sxs-lookup"><span data-stu-id="f612d-601">If a <xref:System.Windows.Controls.Frame> directly navigates to a location, the <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> property is `true` after the initial navigation.</span></span> <span data-ttu-id="f612d-602">Это изменение предотвращает возникновение дополнительных событий при выполнении сценариев запуска.</span><span class="sxs-lookup"><span data-stu-id="f612d-602">This change prevents additional events from being raised during startup scenarios.</span></span> | <span data-ttu-id="f612d-603">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-603">None.</span></span> |
| <span data-ttu-id="f612d-604">**Всплывающие окна**</span><span class="sxs-lookup"><span data-stu-id="f612d-604">**Pop-ups**</span></span> | <span data-ttu-id="f612d-605">Теперь во время передачи макета делегат <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> может вызываться не один раз, а несколько.</span><span class="sxs-lookup"><span data-stu-id="f612d-605">The <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate can now be called multiple times during a layout pass instead of only once.</span></span> | <span data-ttu-id="f612d-606">Если делегат <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> рассчитывает положение объекта <xref:System.Windows.Controls.Primitives.Popup> на основе его предыдущего расположения, значение должно пересчитываться только в том случае, если изменились параметры `popupSize`, `targetSize` или `offset`.</span><span class="sxs-lookup"><span data-stu-id="f612d-606">If your <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate calculates the position of a <xref:System.Windows.Controls.Primitives.Popup> based on its previous position, recalculate the position only if the values of the `popupSize`, `targetSize`, or `offset` parameters change.</span></span> |
| <span data-ttu-id="f612d-607">**Значения свойств**</span><span class="sxs-lookup"><span data-stu-id="f612d-607">**Property values**</span></span> | <span data-ttu-id="f612d-608">Метод <xref:System.Windows.DependencyObject.SetCurrentValue%2A> теперь позволяет задать для свойства действующее значение, хотя он продолжает учитывать привязку, стиль или триггер, влияющие на свойство.</span><span class="sxs-lookup"><span data-stu-id="f612d-608">The <xref:System.Windows.DependencyObject.SetCurrentValue%2A> method now lets you set a property to an effective value, although it continues to respects any binding, style, or trigger that affects the property.</span></span> | <span data-ttu-id="f612d-609">Создатели элементов управления должны использовать метод <xref:System.Windows.DependencyObject.SetCurrentValue%2A> всякий раз, когда значение свойства изменяется в результате побочного эффекта какого-либо другого действия, в том числе операции пользователя.</span><span class="sxs-lookup"><span data-stu-id="f612d-609">Control authors should use <xref:System.Windows.DependencyObject.SetCurrentValue%2A> whenever the property value changes as a side-effect of some other action, including user manipulation.</span></span> |
| <span data-ttu-id="f612d-610">**Текстовые поля**</span><span class="sxs-lookup"><span data-stu-id="f612d-610">**Text boxes**</span></span> | <span data-ttu-id="f612d-611">По соображениям безопасности методы <xref:System.Windows.Forms.TextBoxBase.Copy%2A> и <xref:System.Windows.Forms.TextBoxBase.Cut%2A> завершаются ошибкой без оповещения при вызове с частичным доверием.</span><span class="sxs-lookup"><span data-stu-id="f612d-611">For security considerations, the <xref:System.Windows.Forms.TextBoxBase.Copy%2A> and <xref:System.Windows.Forms.TextBoxBase.Cut%2A> methods silently fail when they are called in partial trust.</span></span><br><br><span data-ttu-id="f612d-612">Кроме того, программное выполнение свойства <xref:System.Windows.Input.ApplicationCommands.Copy> или <xref:System.Windows.Input.ApplicationCommands.Cut> для элемента управления, наследующего от класса <xref:System.Windows.Controls.Primitives.TextBoxBase>, будет блокировано при частичном доверии.</span><span class="sxs-lookup"><span data-stu-id="f612d-612">In addition, programmatic execution of the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> property on a control that inherits from <xref:System.Windows.Controls.Primitives.TextBoxBase> will be blocked in partial trust.</span></span> <span data-ttu-id="f612d-613">Однако вызванные пользователем команды копирования и вырезания, например нажатие кнопки, свойство <xref:System.Windows.Controls.Primitives.ButtonBase.Command> которой привязано к одной из этих команд, будут работать.</span><span class="sxs-lookup"><span data-stu-id="f612d-613">However, user-initiated copy and cut commands, such as clicking a button whose <xref:System.Windows.Controls.Primitives.ButtonBase.Command> property is bound to one of these commands, will work.</span></span> <span data-ttu-id="f612d-614">Стандартное копирование и вырезание с помощью сочетания клавиш или контекстного меню будет работать как до введения режима частичного доверия.</span><span class="sxs-lookup"><span data-stu-id="f612d-614">Standard copy and cut through keyboard shortcuts and the context menu will still work as before in partial trust.</span></span> | <span data-ttu-id="f612d-615">Свяжите команды <xref:System.Windows.Input.ApplicationCommands.Copy> или <xref:System.Windows.Input.ApplicationCommands.Cut> с действием, инициированным пользователем, например нажатием кнопки.</span><span class="sxs-lookup"><span data-stu-id="f612d-615">Bind the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> command to a user-initiated action, such as clicking a button.</span></span> |

### <a name="graphics"></a><span data-ttu-id="f612d-616">Графика</span><span class="sxs-lookup"><span data-stu-id="f612d-616">Graphics</span></span>

<span data-ttu-id="f612d-617">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; сборки: PresentationFramework (в PresentationFramework.dll), PresentationCore (в PresentationCore.dll), WindowsBase (в WindowsBase.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-617">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="f612d-618">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-618">Feature</span></span> | <span data-ttu-id="f612d-619">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-619">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-620">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-620">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-621">**Эффекты для точечных рисунков**</span><span class="sxs-lookup"><span data-stu-id="f612d-621">**Bitmap effects**</span></span> | <span data-ttu-id="f612d-622">В целях повышения производительности класс <xref:System.Windows.Media.Effects.BitmapEffect> и классы, наследующие от класса <xref:System.Windows.Media.Effects.BitmapEffect>, отключены, хотя формально присутствуют.</span><span class="sxs-lookup"><span data-stu-id="f612d-622">To improve performance, the <xref:System.Windows.Media.Effects.BitmapEffect> class and the classes that inherit from the <xref:System.Windows.Media.Effects.BitmapEffect> class, although still present, are disabled.</span></span> <span data-ttu-id="f612d-623">Эффект будет отрисовываться с помощью конвейера отрисовки с аппаратным ускорением, если выполняются указанные ниже условия.</span><span class="sxs-lookup"><span data-stu-id="f612d-623">The effect will render by using the hardware-accelerated rendering pipeline if the following conditions are true:</span></span><br><br><span data-ttu-id="f612d-624">\* Приложение использует <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> или <xref:System.Windows.Media.Effects.BlurBitmapEffect> со свойством радиуса, имеющим значение менее 100 DIU.</span><span class="sxs-lookup"><span data-stu-id="f612d-624">\* The application uses a <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> or a <xref:System.Windows.Media.Effects.BlurBitmapEffect> that has a radius property set less than 100 DIU.</span></span><br><span data-ttu-id="f612d-625">\* Видеоадаптер компьютера, на котором работает приложение, поддерживает построитель текстуры 2.0.</span><span class="sxs-lookup"><span data-stu-id="f612d-625">\* The video card on the computer that runs the application supports pixel shader 2.0.</span></span><br><br><span data-ttu-id="f612d-626">Если перечисленные условия не удовлетворяются, объект <xref:System.Windows.Media.Effects.BitmapEffect> не произведет какого-либо действия.</span><span class="sxs-lookup"><span data-stu-id="f612d-626">If these conditions are not met, a <xref:System.Windows.Media.Effects.BitmapEffect> object will have no effect.</span></span><br><br><span data-ttu-id="f612d-627">Кроме того, Visual Studio создаст предупреждение компилятора при обнаружении объекта <xref:System.Windows.Media.Effects.BitmapEffect> или его подкласса.</span><span class="sxs-lookup"><span data-stu-id="f612d-627">Also, Visual Studio produces a compiler warning when it encounters the <xref:System.Windows.Media.Effects.BitmapEffect> object or a subclass.</span></span><br><br><span data-ttu-id="f612d-628">Метод <xref:System.Windows.Media.DrawingContext.PushEffect%2A> помечен как устаревший.</span><span class="sxs-lookup"><span data-stu-id="f612d-628">The <xref:System.Windows.Media.DrawingContext.PushEffect%2A> method is marked obsolete.</span></span> | <span data-ttu-id="f612d-629">Прекратите использование устаревшего класса <xref:System.Windows.Media.Effects.BitmapEffect> и его производных классов и воспользуйтесь новыми классами, производными от <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect> и <xref:System.Windows.Media.Effects.ShaderEffect>.</span><span class="sxs-lookup"><span data-stu-id="f612d-629">Discontinue using the legacy <xref:System.Windows.Media.Effects.BitmapEffect> and derived classes and instead use the new classes derived from <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>, and <xref:System.Windows.Media.Effects.ShaderEffect>.</span></span><br><br><span data-ttu-id="f612d-630">Кроме того, вы можете создавать собственные эффекты, наследуя от класса <xref:System.Windows.Media.Effects.ShaderEffect>.</span><span class="sxs-lookup"><span data-stu-id="f612d-630">You can also create your own effects by inheriting from the <xref:System.Windows.Media.Effects.ShaderEffect> class.</span></span> |
| <span data-ttu-id="f612d-631">**Кадры растрового изображения**</span><span class="sxs-lookup"><span data-stu-id="f612d-631">**Bitmap frames**</span></span> | <span data-ttu-id="f612d-632">Клонированные объекты <xref:System.Windows.Media.Imaging.BitmapFrame> теперь получают события <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> и <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>.</span><span class="sxs-lookup"><span data-stu-id="f612d-632">The cloned <xref:System.Windows.Media.Imaging.BitmapFrame> objects now receive the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, and <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> events.</span></span> <span data-ttu-id="f612d-633">Это обеспечивает корректную работу для изображений, скачиваемых из Интернета и применяемых к элементу управления <xref:System.Windows.Controls.Image> с помощью класса <xref:System.Windows.Style>.</span><span class="sxs-lookup"><span data-stu-id="f612d-633">This enables images that are downloaded from the Web and applied to the <xref:System.Windows.Controls.Image> control through a <xref:System.Windows.Style> to work correctly.</span></span><br><br><span data-ttu-id="f612d-634">Изменение поведения будет заметно только в том случае, если все следующие утверждения истинны:</span><span class="sxs-lookup"><span data-stu-id="f612d-634">You will see a change in behavior only if all of the following statements are true:</span></span><br><br><span data-ttu-id="f612d-635">\* имеется подписка на событие <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> или <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>;</span><span class="sxs-lookup"><span data-stu-id="f612d-635">\* You subscribe to the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, or <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> event.</span></span><br><span data-ttu-id="f612d-636">\* источником <xref:System.Windows.Media.Imaging.BitmapFrame> является Интернет;</span><span class="sxs-lookup"><span data-stu-id="f612d-636">\* The source of the <xref:System.Windows.Media.Imaging.BitmapFrame> is from the Web.</span></span><br><span data-ttu-id="f612d-637">\* объект <xref:System.Windows.Media.Imaging.BitmapFrame> клонирован, когда скачивание еще выполняется.</span><span class="sxs-lookup"><span data-stu-id="f612d-637">\* The <xref:System.Windows.Media.Imaging.BitmapFrame> is cloned while the download is still in progress.</span></span> | <span data-ttu-id="f612d-638">Проверьте отправителя в обработчике событий и выполните действие, только если отправителем является исходный объект <xref:System.Windows.Media.Imaging.BitmapFrame>.</span><span class="sxs-lookup"><span data-stu-id="f612d-638">Check the sender in the event handler and take action only if the sender is the original <xref:System.Windows.Media.Imaging.BitmapFrame>.</span></span> |
| <span data-ttu-id="f612d-639">**Декодирование изображений**</span><span class="sxs-lookup"><span data-stu-id="f612d-639">**Decoding images**</span></span> | <span data-ttu-id="f612d-640">Чтобы обеспечить обязательную обработку исключения <xref:System.IO.IOException> при невозможности декодировать изображение, класс <xref:System.Windows.Media.Imaging.BitmapSource> создает событие <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed>, когда не удается декодировать изображение.</span><span class="sxs-lookup"><span data-stu-id="f612d-640">To prevent an <xref:System.IO.IOException> from not being handled when images may not decode, the <xref:System.Windows.Media.Imaging.BitmapSource> class will raise the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event when it does not decode an image.</span></span> | <span data-ttu-id="f612d-641">Удалите обработку исключений для <xref:System.IO.IOException> и используйте событие <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> для обнаружения ошибок при декодировании.</span><span class="sxs-lookup"><span data-stu-id="f612d-641">Remove any exception handling for <xref:System.IO.IOException>, and use the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event to check for decode failure.</span></span> |

### <a name="input"></a><span data-ttu-id="f612d-642">Входные данные</span><span class="sxs-lookup"><span data-stu-id="f612d-642">Input</span></span>

<span data-ttu-id="f612d-643">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; сборки: PresentationFramework (в PresentationFramework.dll), PresentationCore (в PresentationCore.dll), WindowsBase (в WindowsBase.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-643">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="f612d-644">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-644">Feature</span></span> | <span data-ttu-id="f612d-645">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-645">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-646">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-646">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-647">**Привязка экземпляров команд**</span><span class="sxs-lookup"><span data-stu-id="f612d-647">**Binding command instances**</span></span> | <span data-ttu-id="f612d-648">Чтобы предоставить механизм для привязки экземпляров команд на основе модели представления к действиям ввода на основе представления, класс <xref:System.Windows.Input.InputBinding> теперь наследует от класса <xref:System.Windows.Freezable> вместо класса <xref:System.Windows.DependencyObject>.</span><span class="sxs-lookup"><span data-stu-id="f612d-648">To provide a mechanism to bind View-Model-based command instances to View-based input gestures, the <xref:System.Windows.Input.InputBinding> class now inherits from <xref:System.Windows.Freezable> instead of <xref:System.Windows.DependencyObject>.</span></span> <span data-ttu-id="f612d-649">Перечисленные ниже свойства теперь являются свойствами зависимостей.</span><span class="sxs-lookup"><span data-stu-id="f612d-649">The following properties are now dependency properties:</span></span><br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br><span data-ttu-id="f612d-650">Это изменение имеет указанные ниже последствия.</span><span class="sxs-lookup"><span data-stu-id="f612d-650">This change results in the following:</span></span><br><br><span data-ttu-id="f612d-651">\* Объект <xref:System.Windows.Input.InputBinding> теперь фиксируется после регистрации, вместо того чтобы оставаться изменяемым.</span><span class="sxs-lookup"><span data-stu-id="f612d-651">\* An <xref:System.Windows.Input.InputBinding> object is now frozen when it is registered instead of remaining mutable.</span></span><br><span data-ttu-id="f612d-652">\* Отсутствует доступ к объектам <xref:System.Windows.Input.InputBinding> на уровне экземпляра из нескольких потоков в связи с ограничениями класса <xref:System.Windows.DependencyObject>.</span><span class="sxs-lookup"><span data-stu-id="f612d-652">\* You cannot access instance-level <xref:System.Windows.Input.InputBinding> objects from multiple threads, due to the restrictions of the <xref:System.Windows.DependencyObject> class.</span></span><br><span data-ttu-id="f612d-653">\* Нельзя изменять привязки ввода на уровне класса после их регистрации в связи с ограничениями класса <xref:System.Windows.Freezable>.</span><span class="sxs-lookup"><span data-stu-id="f612d-653">\* You cannot mutate class-level input bindings after their registration, due to the restrictions of the <xref:System.Windows.Freezable> class.</span></span><br><span data-ttu-id="f612d-654">\* Нельзя задавать привязки ввода для экземпляров команд, созданных в модели представления.</span><span class="sxs-lookup"><span data-stu-id="f612d-654">\* You cannot specify input bindings on command instances that are created in a View-Model.</span></span> | <span data-ttu-id="f612d-655">Создайте отдельные экземпляры класса <xref:System.Windows.Input.InputBinding> в отдельных потоках, если привязки должны быть изменяемыми, или фиксируйте их в противном случае.</span><span class="sxs-lookup"><span data-stu-id="f612d-655">Create separate instances of an <xref:System.Windows.Input.InputBinding> class on separate threads if bindings are to be mutable, or freeze them otherwise.</span></span> <span data-ttu-id="f612d-656">Не изменяйте статическую привязку <xref:System.Windows.Input.InputBinding> уровня класса после того, как она зарегистрирована.</span><span class="sxs-lookup"><span data-stu-id="f612d-656">Do not mutate a class-level static <xref:System.Windows.Input.InputBinding> after it has been registered.</span></span> |
| <span data-ttu-id="f612d-657">**Приложения для браузеров**</span><span class="sxs-lookup"><span data-stu-id="f612d-657">**Browser applications**</span></span> | <span data-ttu-id="f612d-658">WPF-приложения для браузера (XBAP) теперь обрабатывают ключевые события как отдельные приложения WPF, поэтому объекты получают перенаправляемые ключевые события в правильном порядке.</span><span class="sxs-lookup"><span data-stu-id="f612d-658">WPF Browser applications (.XBAP) now process key events just like stand-alone WPF applications so that objects receive routed key events in the correct order.</span></span> | <span data-ttu-id="f612d-659">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-659">None.</span></span> |
| <span data-ttu-id="f612d-660">**Неработающие сочетания клавиш**</span><span class="sxs-lookup"><span data-stu-id="f612d-660">**Dead key combinations**</span></span> | <span data-ttu-id="f612d-661">WPF не показывает неработающие клавиши, которые не производят видимых символов, но указывает, что для создания символа эту клавишу следует нажать вместе со следующей буквенной клавишей.</span><span class="sxs-lookup"><span data-stu-id="f612d-661">WPF obfuscates dead keys, which produce no visible character, but instead indicates that the key is to be combined with the next letter key to produce one character.</span></span> <span data-ttu-id="f612d-662">События ввода с клавиатуры, например событие <xref:System.Windows.Input.Keyboard.KeyDownEvent>, сообщают, когда клавиша является нерабочей, задавая для свойства <xref:System.Windows.Input.KeyEventArgs.Key> значение <xref:System.Windows.Input.Key>.</span><span class="sxs-lookup"><span data-stu-id="f612d-662">The key input events, such as the <xref:System.Windows.Input.Keyboard.KeyDownEvent> event, report when a key is a dead key by setting the <xref:System.Windows.Input.KeyEventArgs.Key> property to the <xref:System.Windows.Input.Key> value.</span></span> <span data-ttu-id="f612d-663">Как правило, это ожидаемое поведение, так как в приложениях обычно не предусмотрена реакция на ввод с клавиатуры, создающий комбинированный символ.</span><span class="sxs-lookup"><span data-stu-id="f612d-663">This is usually expected behavior because applications usually do not intend to respond to keyboard input that creates a combined character.</span></span> | <span data-ttu-id="f612d-664">Приложения, которые должны считывать клавиши, бывшие частью комбинированных символов, могут получить скрытую клавишу, используя свойство <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey>.</span><span class="sxs-lookup"><span data-stu-id="f612d-664">Applications that expect to read keys that were part of combined characters can get the now obfuscated key by using the <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> property.</span></span> |
| <span data-ttu-id="f612d-665">**Диспетчер фокуса**</span><span class="sxs-lookup"><span data-stu-id="f612d-665">**Focus manager**</span></span> | <span data-ttu-id="f612d-666">Когда в метод <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> передается элемент, имеющий присоединенное свойство [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) со значением `true`, этот метод возвращает последний элемент, на котором находился фокус клавиатуры в пределах этой области фокуса, тогда и только тогда, когда возвращаемый элемент принадлежит тому же объекту <xref:System.Windows.PresentationSource>, что и элемент, переданный в метод.</span><span class="sxs-lookup"><span data-stu-id="f612d-666">When the <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> method is passed an element that has the [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) attached property set to `true`, the method returns an element that is the last keyboard-focused element within that focus scope if and only if the returned element belongs to the same <xref:System.Windows.PresentationSource> object as the element that is passed to the method.</span></span> | <span data-ttu-id="f612d-667">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-667">None.</span></span> |

### <a name="ui-automation"></a><span data-ttu-id="f612d-668">Автоматизация пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="f612d-668">UI Automation</span></span>

<span data-ttu-id="f612d-669">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; сборки: PresentationFramework (в PresentationFramework.dll), PresentationCore (в PresentationCore.dll), UIAutomationProvider (в UIAutomationProvider.dll), WindowsBase (в WindowsBase.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-669">Namespace: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), UIAutomationProvider (in UIAutomationProvider.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="f612d-670">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-670">Feature</span></span> | <span data-ttu-id="f612d-671">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-671">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-672">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-672">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-673">**Иерархия классов представлений**</span><span class="sxs-lookup"><span data-stu-id="f612d-673">**Class hierarchy of views**</span></span> | <span data-ttu-id="f612d-674">Классы <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> и <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> наследуются от <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>, а не от <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="f612d-674">The <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> and <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes inherit from <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> instead of <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span></span> | <span data-ttu-id="f612d-675">Если наследование производится от классов <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> и метод <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> переопределяется, рассмотрите возможность возврата объекта, который наследуется от нового класса <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="f612d-675">If you inherit from the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes and override the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> method, consider returning an object that inherits from the new <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> class.</span></span> |
| <span data-ttu-id="f612d-676">**Контейнеры вне экрана**</span><span class="sxs-lookup"><span data-stu-id="f612d-676">**Containers off screen**</span></span> | <span data-ttu-id="f612d-677">Для исправления неправильно возвращаемого значения метод <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> теперь корректно возвращает значение `false` для контейнеров элементов, которые при прокрутке находятся вне области видимости.</span><span class="sxs-lookup"><span data-stu-id="f612d-677">To fix an incorrect return value, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> method now correctly returns `false` for item containers that are scrolled out of view.</span></span> <span data-ttu-id="f612d-678">Кроме того, на значение метода не влияют помехи со стороны других окон или видимость элемента на определенном мониторе.</span><span class="sxs-lookup"><span data-stu-id="f612d-678">Also, the value of the method is not affected by occlusion by other windows, or by whether the element is visible on a specific monitor.</span></span> | <span data-ttu-id="f612d-679">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-679">None.</span></span> |
| <span data-ttu-id="f612d-680">**Меню и дочерние объекты**</span><span class="sxs-lookup"><span data-stu-id="f612d-680">**Menus and child objects**</span></span> | <span data-ttu-id="f612d-681">Чтобы обеспечить автоматизацию пользовательского интерфейса для меню, содержащих дочерние объекты, отличные от объектов <xref:System.Windows.Controls.MenuItem>, метод <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> теперь возвращает объект <xref:System.Windows.Automation.Peers.AutomationPeer> дочернего объекта <xref:System.Windows.UIElement> вместо объекта <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="f612d-681">To enable UI automation of menus that contain children other than <xref:System.Windows.Controls.MenuItem> objects, the <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> method now returns the <xref:System.Windows.Automation.Peers.AutomationPeer> object of a child <xref:System.Windows.UIElement> object, instead of a <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> object.</span></span> | <span data-ttu-id="f612d-682">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-682">None.</span></span> |
| <span data-ttu-id="f612d-683">**Новые интерфейсы и сборка**</span><span class="sxs-lookup"><span data-stu-id="f612d-683">**New interfaces and assembly**</span></span> | <span data-ttu-id="f612d-684">Чтобы обеспечить работу новых функций автоматизации пользовательского интерфейса, были добавлены следующие интерфейсы:</span><span class="sxs-lookup"><span data-stu-id="f612d-684">To enable new features for UI automation, the following interfaces were added:</span></span><br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | <span data-ttu-id="f612d-685">В любой проект, в котором выполняется сборка одноранговых классов автоматизации WPF, должна быть добавлена явная ссылка на файл UIAutomationProvider.dll.</span><span class="sxs-lookup"><span data-stu-id="f612d-685">Any project that builds WPF automation peers must add an explicit reference to UIAutomationProvider.dll.</span></span> |
| <span data-ttu-id="f612d-686">**Бегунки**</span><span class="sxs-lookup"><span data-stu-id="f612d-686">**Thumbs**</span></span> | <span data-ttu-id="f612d-687">Метод <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> возвращает значение вместо NULL.</span><span class="sxs-lookup"><span data-stu-id="f612d-687">The <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> method returns a value instead of null.</span></span> <span data-ttu-id="f612d-688">Поэтому такие элементы управления, как <xref:System.Windows.Controls.GridSplitter>, наследующие от класса <xref:System.Windows.Controls.Primitives.Thumb>, будут передавать имя в модель автоматизации пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="f612d-688">Therefore, controls such as <xref:System.Windows.Controls.GridSplitter> that inherit from the <xref:System.Windows.Controls.Primitives.Thumb> class will report a name to UI Automation.</span></span> | <span data-ttu-id="f612d-689">Отсутствует.</span><span class="sxs-lookup"><span data-stu-id="f612d-689">None.</span></span> |
| <span data-ttu-id="f612d-690">**Виртуальные элементы**</span><span class="sxs-lookup"><span data-stu-id="f612d-690">**Virtualized elements**</span></span> | <span data-ttu-id="f612d-691">Для повышения производительности метод <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> возвращает только дочерние объекты, действительно присутствующие в визуальном дереве, вместо всех дочерних объектов независимо от того, являются ли они виртуальными.</span><span class="sxs-lookup"><span data-stu-id="f612d-691">To improve performance, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> method returns only the child objects that are actually in the visual tree, instead of all child objects, regardless of whether they are virtualized.</span></span> | <span data-ttu-id="f612d-692">Используйте класс <xref:System.Windows.Automation.ItemContainerPattern> для перебора всех элементов объекта <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>.</span><span class="sxs-lookup"><span data-stu-id="f612d-692">Use <xref:System.Windows.Automation.ItemContainerPattern> to iterate over all items of an <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>.</span></span> |

### <a name="xaml"></a><span data-ttu-id="f612d-693">XAML</span><span class="sxs-lookup"><span data-stu-id="f612d-693">XAML</span></span>

<span data-ttu-id="f612d-694">Пространства имен: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; сборки: PresentationFramework (в PresentationFramework.dll), PresentationCore (в PresentationCore.dll), WindowsBase (в WindowsBase.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-694">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="f612d-695">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-695">Feature</span></span> | <span data-ttu-id="f612d-696">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-696">Differences from 3.5 SP1</span></span> | <span data-ttu-id="f612d-697">Рекомендованные изменения</span><span class="sxs-lookup"><span data-stu-id="f612d-697">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="f612d-698">**Расширение разметки**</span><span class="sxs-lookup"><span data-stu-id="f612d-698">**Markup extension**</span></span> | <span data-ttu-id="f612d-699">WPF теперь всегда правильно использует значение из метода <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> вместо возврата объекта <xref:System.Windows.Markup.MarkupExtension> в некоторых случаях, когда расширение разметки используется для задания свойства или для создания элемента в коллекции.</span><span class="sxs-lookup"><span data-stu-id="f612d-699">WPF now correctly always uses the value from the <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> method instead of returning the <xref:System.Windows.Markup.MarkupExtension> object in certain cases when a markup extension is used to set a property or to create an item in a collection.</span></span> <span data-ttu-id="f612d-700">В некоторых случаях расширение разметки может возвращать себя.</span><span class="sxs-lookup"><span data-stu-id="f612d-700">A markup extension might return itself in some cases.</span></span> | <span data-ttu-id="f612d-701">Если ваше приложение обращается к ресурсу, возвращавшему в более ранних версиях объект <xref:System.Windows.Markup.MarkupExtension>, создайте ссылку на объект, возвращаемый из метода <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, вместо объекта <xref:System.Windows.Markup.MarkupExtension>.</span><span class="sxs-lookup"><span data-stu-id="f612d-701">If your application accesses a resource that returned a <xref:System.Windows.Markup.MarkupExtension> object in earlier versions, reference the object that is returned from <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, instead of the <xref:System.Windows.Markup.MarkupExtension> object.</span></span> |
| <span data-ttu-id="f612d-702">**Разбор атрибутов**</span><span class="sxs-lookup"><span data-stu-id="f612d-702">**Parsing attributes**</span></span> | <span data-ttu-id="f612d-703">Атрибуты в языке XAML теперь могут иметь только одну точку.</span><span class="sxs-lookup"><span data-stu-id="f612d-703">Attributes in XAML can now have only one period.</span></span> <span data-ttu-id="f612d-704">Примеры допустимых строк:</span><span class="sxs-lookup"><span data-stu-id="f612d-704">For example, the following are valid:</span></span><br><br><span data-ttu-id="f612d-705">`<Button Background="Red"/>` (точек нет)</span><span class="sxs-lookup"><span data-stu-id="f612d-705">`<Button Background="Red"/>` (no periods)</span></span><br><br><span data-ttu-id="f612d-706">`<Button Button.Background = "Red"/>` (одна точка)</span><span class="sxs-lookup"><span data-stu-id="f612d-706">`<Button Button.Background = "Red"/>` (one period)</span></span><br><br><span data-ttu-id="f612d-707">Пример строки, ставшей недопустимой:</span><span class="sxs-lookup"><span data-stu-id="f612d-707">The following is no longer valid:</span></span><br><br><span data-ttu-id="f612d-708">`<Button Control.Button.Background = "Red"/>` (более одной точки)</span><span class="sxs-lookup"><span data-stu-id="f612d-708">`<Button Control.Button.Background = "Red"/>` (more than one period)</span></span> | <span data-ttu-id="f612d-709">Исправьте атрибуты XAML, содержащие более одной точки.</span><span class="sxs-lookup"><span data-stu-id="f612d-709">Correct XAML attributes that have more than one period.</span></span> |

## <a name="xml"></a><span data-ttu-id="f612d-710">XML</span><span class="sxs-lookup"><span data-stu-id="f612d-710">XML</span></span>

<span data-ttu-id="f612d-711">В приведенной ниже таблице описаны усовершенствования функций, с которыми ранее были связаны ограничения или другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f612d-711">The rows in this table describe improvements to features that previously had limitations or other issues.</span></span>

### <a name="schema-and-transforms"></a><span data-ttu-id="f612d-712">Схема и преобразования</span><span class="sxs-lookup"><span data-stu-id="f612d-712">Schema and transforms</span></span>

<span data-ttu-id="f612d-713">Пространства имен: <xref:System.Xml.Linq>, <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; сборки: System.Xml (в System.Xml.dll), System.Xml.Linq (в System.Xml.Linq.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-713">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="f612d-714">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-714">Feature</span></span> | <span data-ttu-id="f612d-715">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-715">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-716">**Схемы-хамелеоны**</span><span class="sxs-lookup"><span data-stu-id="f612d-716">**Chameleon schemas**</span></span> | <span data-ttu-id="f612d-717">Чтобы предотвратить повреждение данных, схемы-хамелеоны теперь правильно клонируются, когда добавляются с несколькими схемами.</span><span class="sxs-lookup"><span data-stu-id="f612d-717">To prevent data corruption, chameleon schemas are now cloned correctly when they are included with multiple schemas.</span></span><br><br><span data-ttu-id="f612d-718">Схемы-хамелеоны — это схемы, не имеющие целевого пространства имен. Когда они включаются в другой XSD-файл, они принимают целевое пространство имен схемы, в которую они импортируются.</span><span class="sxs-lookup"><span data-stu-id="f612d-718">Chameleon schemas are schemas that do not have a target namespace, and when they are included in another XSD, they take on the target namespace of the importing schema.</span></span> <span data-ttu-id="f612d-719">Часто они используются для включения в схему распространенных типов.</span><span class="sxs-lookup"><span data-stu-id="f612d-719">They are often used to include common types into a schema.</span></span> |
| <span data-ttu-id="f612d-720">**Функции ID**</span><span class="sxs-lookup"><span data-stu-id="f612d-720">**ID functions**</span></span> | <span data-ttu-id="f612d-721">[Функция id](/sql/xquery/functions-on-sequences-id) XSLT теперь возвращает правильное значение вместо NULL при передаче объекта <xref:System.Xml.XmlReader> в XLST.</span><span class="sxs-lookup"><span data-stu-id="f612d-721">The XSLT [id function](/sql/xquery/functions-on-sequences-id) now returns the correct value instead of null when an <xref:System.Xml.XmlReader> object is passed to an XLST.</span></span><br><br><span data-ttu-id="f612d-722">Если пользователь создавал объект <xref:System.Xml.XmlReader> из класса LINQ to XML с помощью метода <xref:System.Xml.Linq.XNode.CreateReader%2A> и этот объект <xref:System.Xml.XmlReader> был передан в XSLT, все экземпляры функции `id` в XSLT ранее возвращали NULL.</span><span class="sxs-lookup"><span data-stu-id="f612d-722">If the user created an <xref:System.Xml.XmlReader> object from a LINQ to XML class by using the <xref:System.Xml.Linq.XNode.CreateReader%2A> method, and this <xref:System.Xml.XmlReader> object was passed to an XSLT, any instances of the `id` function in the XSLT previously returned null.</span></span> <span data-ttu-id="f612d-723">Для функции `id` это не является разрешенным возвращаемым значением.</span><span class="sxs-lookup"><span data-stu-id="f612d-723">This is not an allowed return value for the `id` function.</span></span> |
| <span data-ttu-id="f612d-724">**Атрибут пространства имен**</span><span class="sxs-lookup"><span data-stu-id="f612d-724">**Namespace attribute**</span></span> | <span data-ttu-id="f612d-725">Во избежание повреждения данных объект <xref:System.Xml.XPath.XPathNavigator> теперь возвращает локальное имя атрибута `x:xmlns` правильно.</span><span class="sxs-lookup"><span data-stu-id="f612d-725">To prevent data corruption, an <xref:System.Xml.XPath.XPathNavigator> object now returns the local name of the `x:xmlns` attribute correctly.</span></span> |
| <span data-ttu-id="f612d-726">**Объявления пространств имен**</span><span class="sxs-lookup"><span data-stu-id="f612d-726">**Namespace declarations**</span></span> | <span data-ttu-id="f612d-727">Объект <xref:System.Xml.XmlReader> в поддереве больше не создает дублирующиеся объявления пространства имен в одном XML-элементе.</span><span class="sxs-lookup"><span data-stu-id="f612d-727">An <xref:System.Xml.XmlReader> object on a sub-tree no longer creates duplicate namespace declarations within one XML element.</span></span> |
| <span data-ttu-id="f612d-728">**Проверка схемы**</span><span class="sxs-lookup"><span data-stu-id="f612d-728">**Schema validation**</span></span> | <span data-ttu-id="f612d-729">Чтобы избежать ошибочной проверки схемы, класс <xref:System.Xml.Schema.XmlSchemaSet> обеспечивает корректную и непротиворечивую компиляцию схем XSD.</span><span class="sxs-lookup"><span data-stu-id="f612d-729">To prevent erroneous schema validation, the <xref:System.Xml.Schema.XmlSchemaSet> class allows for XSD schemas to be compiled correctly and consistently.</span></span> <span data-ttu-id="f612d-730">Схемы могут включать в себя другие схемы. Например, `A.xsd` может включать схему `B.xsd`, которая может включать `C.xsd`.</span><span class="sxs-lookup"><span data-stu-id="f612d-730">These schemas can include other schemas; for example, `A.xsd` can include `B.xsd`, which can include `C.xsd`.</span></span> <span data-ttu-id="f612d-731">Компиляция любой из указанных схем приводит к обходу этого графа зависимостей.</span><span class="sxs-lookup"><span data-stu-id="f612d-731">Compiling any one of these causes this graph of dependencies to be traversed.</span></span> |
| <span data-ttu-id="f612d-732">**Функции скрипта**</span><span class="sxs-lookup"><span data-stu-id="f612d-732">**Script functions**</span></span> | <span data-ttu-id="f612d-733">[Функция function-available](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) больше не возвращает неправильное значение `false`, когда функция на самом деле доступна.</span><span class="sxs-lookup"><span data-stu-id="f612d-733">The [function-available function](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) no longer incorrectly returns `false` when the function is actually available.</span></span> |
| <span data-ttu-id="f612d-734">**Универсальные коды ресурсов (URI)**</span><span class="sxs-lookup"><span data-stu-id="f612d-734">**URIs**</span></span> | <span data-ttu-id="f612d-735">Метод <xref:System.Xml.Linq.XElement.Load%2A> теперь возвращает правильный код BaseURI в запросах LINQ.</span><span class="sxs-lookup"><span data-stu-id="f612d-735">The <xref:System.Xml.Linq.XElement.Load%2A> method now returns the correct BaseURI in LINQ queries.</span></span> |

### <a name="validation"></a><span data-ttu-id="f612d-736">Проверка</span><span class="sxs-lookup"><span data-stu-id="f612d-736">Validation</span></span>

<span data-ttu-id="f612d-737">Пространства имен: <xref:System.Xml.Linq>, <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; сборки: System.Xml (в System.Xml.dll), System.Xml.Linq (в System.Xml.Linq.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-737">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="f612d-738">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-738">Feature</span></span> | <span data-ttu-id="f612d-739">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-739">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-740">**Сопоставители пространств имен**</span><span class="sxs-lookup"><span data-stu-id="f612d-740">**Namespace resolvers**</span></span> | <span data-ttu-id="f612d-741">Метод <xref:System.Xml.XmlReader.ReadContentAs%2A> больше не игнорирует переданный ему сопоставитель <xref:System.Xml.IXmlNamespaceResolver>.</span><span class="sxs-lookup"><span data-stu-id="f612d-741">The <xref:System.Xml.XmlReader.ReadContentAs%2A> method no longer ignores the <xref:System.Xml.IXmlNamespaceResolver> resolver passed to it.</span></span><br><br><span data-ttu-id="f612d-742">В более ранних версиях указанный сопоставитель пространств имен игнорировался; вместо него использовался <xref:System.Xml.XmlReader>.</span><span class="sxs-lookup"><span data-stu-id="f612d-742">In previous versions, the specified namespace resolver was ignored, and the <xref:System.Xml.XmlReader> was used instead.</span></span> |
| <span data-ttu-id="f612d-743">**Пробел**</span><span class="sxs-lookup"><span data-stu-id="f612d-743">**White space**</span></span> | <span data-ttu-id="f612d-744">Для предотвращения потери данных при создании средства чтения метод <xref:System.Xml.XmlReader.Create%2A> больше не отбрасывает имеющий значение пробел.</span><span class="sxs-lookup"><span data-stu-id="f612d-744">To prevent data loss when you are creating a reader, the <xref:System.Xml.XmlReader.Create%2A> method no longer discards significant white space.</span></span><br><br><span data-ttu-id="f612d-745">Проверка XML распознает режим смешанного содержимого, когда текст может идти вперемешку с XML-разметкой.</span><span class="sxs-lookup"><span data-stu-id="f612d-745">XML validation recognizes mixed-content mode, where text can be intermixed with XML markup.</span></span> <span data-ttu-id="f612d-746">В смешанном режиме все пробелы являются значимыми и должны приниматься во внимание.</span><span class="sxs-lookup"><span data-stu-id="f612d-746">In mixed mode, all white space is significant and should be reported.</span></span> |

### <a name="writing"></a><span data-ttu-id="f612d-747">Запись</span><span class="sxs-lookup"><span data-stu-id="f612d-747">Writing</span></span>

<span data-ttu-id="f612d-748">Пространства имен: <xref:System.Xml.Linq>, <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; сборки: System.Xml (в System.Xml.dll), System.Xml.Linq (в System.Xml.Linq.dll)</span><span class="sxs-lookup"><span data-stu-id="f612d-748">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="f612d-749">Функция</span><span class="sxs-lookup"><span data-stu-id="f612d-749">Feature</span></span> | <span data-ttu-id="f612d-750">Отличия от версии 3.5 с пакетом обновления 1 (SP1)</span><span class="sxs-lookup"><span data-stu-id="f612d-750">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="f612d-751">**Ссылки на сущности**</span><span class="sxs-lookup"><span data-stu-id="f612d-751">**Entity references**</span></span> | <span data-ttu-id="f612d-752">Во избежание повреждения данных ссылки на сущности больше не преобразуются дважды в атрибутах XML.</span><span class="sxs-lookup"><span data-stu-id="f612d-752">To prevent data corruption, entity references are no longer entitized twice in XML attributes.</span></span><br><br><span data-ttu-id="f612d-753">Если пользователь пытался записать сущность в атрибут `xmlns` либо в атрибут `xml:lang` или `xml:space` с помощью метода <xref:System.Xml.XmlWriter.WriteEntityRef%2A>, на выходе сущность преобразовывалась дважды, что приводило к повреждению данных.</span><span class="sxs-lookup"><span data-stu-id="f612d-753">If the user tried to write an entity into an `xmlns` attribute or into an `xml:lang` or `xml:space` attribute by using the <xref:System.Xml.XmlWriter.WriteEntityRef%2A> method, the entity was entitized twice in the output, therefore corrupting the data.</span></span> |
| <span data-ttu-id="f612d-754">**Обработка новых строк**</span><span class="sxs-lookup"><span data-stu-id="f612d-754">**New line handling**</span></span> | <span data-ttu-id="f612d-755">Во избежание повреждения данных объекты <xref:System.Xml.XmlWriter> учитывают параметр <xref:System.Xml.NewLineHandling>.</span><span class="sxs-lookup"><span data-stu-id="f612d-755">To prevent data corruption, <xref:System.Xml.XmlWriter> objects respect the <xref:System.Xml.NewLineHandling> option.</span></span> |

## <a name="see-also"></a><span data-ttu-id="f612d-756">См. также</span><span class="sxs-lookup"><span data-stu-id="f612d-756">See also</span></span>

- [<span data-ttu-id="f612d-757">Новые типы и члены в .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="f612d-757">New Types and Members in the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [<span data-ttu-id="f612d-758">Руководство по миграции на .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="f612d-758">Migration Guide to the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [<span data-ttu-id="f612d-759">Новые возможности .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="f612d-759">What's New in the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [<span data-ttu-id="f612d-760">Совместимость версий в .NET Framework</span><span class="sxs-lookup"><span data-stu-id="f612d-760">Version Compatibility in the .NET Framework</span></span>](version-compatibility.md)
- [<span data-ttu-id="f612d-761">Перенос решений Office на платформу .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="f612d-761">Migrating Office Solutions to the .NET Framework 4</span></span>](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [<span data-ttu-id="f612d-762">Устаревшие классы библиотеки классов .NET Framework</span><span class="sxs-lookup"><span data-stu-id="f612d-762">What's Obsolete in the .NET Framework Class Library</span></span>](../whats-new/whats-obsolete.md)
