---
title: программирование SQL Server и атрибуты защиты ведущего приложения
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088723"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>программирование SQL Server и атрибуты защиты ведущего приложения
Чтобы загружать и выполнять управляемый код, ведущее приложение SQL Server должно соответствовать требованиям ведущего приложения к управлению доступом для кода и защите ресурсов ведущего приложения.  Требования к безопасности доступа кода применяется один из трех наборов разрешений SQL Server: SAFE, EXTERNAL-ACCESS или UNSAFE. В коде, выполняемом с набором разрешений SAFE или EXTERNAL-ACCESS, не рекомендуется использовать определенные типы и члены, к которым применен атрибут <xref:System.Security.Permissions.HostProtectionAttribute>. Атрибут <xref:System.Security.Permissions.HostProtectionAttribute> не является разрешением безопасности в той же степени, что и гарантия надежности, поскольку в нем определяются конкретные конструкции кода (типы или методы), которые ведущее приложение может запрещать.  С помощью атрибута <xref:System.Security.Permissions.HostProtectionAttribute> можно реализовать модель программирования, которая позволяет гарантировать стабильность работы ведущего приложения.  
  
## <a name="host-protection-attributes"></a>Атрибуты защиты ведущего приложения  
 Атрибуты защиты ведущего приложения определяют типы и члены, которые не соответствуют модели программирования ведущего приложения, и представляют следующие уровни угроз надежности (по возрастанию):  
  
-   Во всех остальных случаях является безопасным.  
  
-   Может привести к дестабилизации пользовательского кода, находящегося под управлением сервера.  
  
-   Может привести к дестабилизации самого процесса сервера.  
  
 SQL Server не поддерживает использование типов или членов с атрибутом <xref:System.Security.Permissions.HostProtectionAttribute>, которые задают значения <xref:System.Security.Permissions.HostProtectionResource>, равные <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> или <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. Таким образом, сборки не могут вызывать члены, которые активируют общее состояние, выполняют синхронизацию, могут привести к утечке ресурсов при завершении или влияют на целостность процесса SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Запрещенные типы и члены  
 В следующей таблице указаны типы и члены, значения <xref:System.Security.Permissions.HostProtectionResource> которых запрещены в SQL Server.  
  
|Пространство имен|Тип или член|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> класс<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> делегат<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> класс<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> делегат<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> класс<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> делегат<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> класс<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> делегат<br /><br /> <xref:Microsoft.Win32.SystemEvents> класс<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> класс<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> делегат<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> класс<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> класс|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> метод|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> класс<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> делегат<br /><br /> <xref:System.ComponentModel.ArrayConverter> класс<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> класс<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.AsyncOperation> класс<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> класс<br /><br /> <xref:System.ComponentModel.AttributeCollection> класс<br /><br /> <xref:System.ComponentModel.BackgroundWorker> класс<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> класс<br /><br /> <xref:System.ComponentModel.BindingList%601> класс<br /><br /> <xref:System.ComponentModel.BooleanConverter> класс<br /><br /> <xref:System.ComponentModel.ByteConverter> класс<br /><br /> <xref:System.ComponentModel.CancelEventArgs> класс<br /><br /> <xref:System.ComponentModel.CancelEventHandler> делегат<br /><br /> <xref:System.ComponentModel.CharConverter> класс<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> класс<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> делегат<br /><br /> <xref:System.ComponentModel.CollectionConverter> класс<br /><br /> <xref:System.ComponentModel.ComponentCollection> класс<br /><br /> <xref:System.ComponentModel.ComponentConverter> класс<br /><br /> <xref:System.ComponentModel.ComponentEditor> класс<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> класс<br /><br /> <xref:System.ComponentModel.Container> класс<br /><br /> <xref:System.ComponentModel.ContainerFilterService> класс<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> класс<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> класс<br /><br /> <xref:System.ComponentModel.DateTimeConverter> класс<br /><br /> <xref:System.ComponentModel.DecimalConverter> класс<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> класс<br /><br /> <xref:System.ComponentModel.Design.CommandID> класс<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> класс<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> класс<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> класс<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> класс<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> класс<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> делегат<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> класс<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> класс<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> делегат<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> класс<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> класс<br /><br /> <xref:System.ComponentModel.DoubleConverter> класс<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> класс<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> делегат<br /><br /> <xref:System.ComponentModel.EnumConverter> класс<br /><br /> <xref:System.ComponentModel.EventDescriptor> класс<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> класс<br /><br /> <xref:System.ComponentModel.EventHandlerList> класс<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> класс<br /><br /> <xref:System.ComponentModel.HandledEventArgs> класс<br /><br /> <xref:System.ComponentModel.HandledEventHandler> делегат<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> класс<br /><br /> <xref:System.ComponentModel.Int16Converter> класс<br /><br /> <xref:System.ComponentModel.Int32Converter> класс<br /><br /> <xref:System.ComponentModel.Int64Converter> класс<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> класс<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> класс<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> метод<br /><br /> <xref:System.ComponentModel.License> класс<br /><br /> <xref:System.ComponentModel.LicenseContext> класс<br /><br /> <xref:System.ComponentModel.LicenseException> класс<br /><br /> <xref:System.ComponentModel.LicenseManager> класс<br /><br /> <xref:System.ComponentModel.LicenseProvider> класс<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> класс<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> класс<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.ListSortDescription> класс<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> класс<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> класс<br /><br /> <xref:System.ComponentModel.MemberDescriptor> класс<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> класс<br /><br /> <xref:System.ComponentModel.NestedContainer> класс<br /><br /> <xref:System.ComponentModel.NullableConverter> класс<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> класс<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> класс<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> класс<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> класс<br /><br /> <xref:System.ComponentModel.ReferenceConverter> класс<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> класс<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> делегат<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> класс<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> делегат<br /><br /> <xref:System.ComponentModel.SByteConverter> класс<br /><br /> <xref:System.ComponentModel.SingleConverter> класс<br /><br /> <xref:System.ComponentModel.StringConverter> класс<br /><br /> <xref:System.ComponentModel.SyntaxCheck> класс<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> класс<br /><br /> <xref:System.ComponentModel.TypeConverter> класс<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> класс<br /><br /> <xref:System.ComponentModel.TypeDescriptor> класс<br /><br /> <xref:System.ComponentModel.TypeListConverter> класс<br /><br /> <xref:System.ComponentModel.UInt16Converter> класс<br /><br /> <xref:System.ComponentModel.UInt32Converter> класс<br /><br /> <xref:System.ComponentModel.UInt64Converter> класс<br /><br /> <xref:System.ComponentModel.WarningException> класс<br /><br /> <xref:System.ComponentModel.Win32Exception> класс|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> свойство;<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> свойство;<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> свойство;<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> класс<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> класс<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> класс<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> класс<br /><br /> <xref:System.Diagnostics.PerformanceCounter> класс<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> класс<br /><br /> <xref:System.Diagnostics.Process> класс<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> класс<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> класс<br /><br /> <xref:System.Diagnostics.TraceListener> класс<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> класс<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> свойство;|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> метод|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> класс<br /><br /> <xref:System.Reflection.Emit.EventBuilder> класс<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> класс<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> класс<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> класс<br /><br /> <xref:System.Reflection.Emit.MethodRental> класс<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> класс<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> класс<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> класс<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> класс|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> метод|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> класс<br /><br /> <xref:System.Threading.EventWaitHandle> класс<br /><br /> <xref:System.Threading.ManualResetEvent> класс<br /><br /> <xref:System.Threading.Monitor> класс<br /><br /> <xref:System.Threading.Mutex> класс<br /><br /> <xref:System.Threading.ReaderWriterLock> класс<br /><br /> <xref:System.Threading.Semaphore> класс<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> метод<br /><br /> <xref:System.Threading.ThreadPool> класс<br /><br /> <xref:System.Threading.Timer> класс|  
|`System.Timers`|<xref:System.Timers.Timer> класс|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> класс|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> свойство;|  
  
## <a name="sql-server-permission-sets"></a>Наборы разрешений SQL Server  
 SQL Server позволяет пользователям задавать требования к надежности кода, развернутого в базе данных. При загрузке сборок в базе данных, автор сборки можно указать один из трех наборов разрешений для этой сборки: SAFE, EXTERNAL-ACCESS или UNSAFE.  
  
|Набор разрешений|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Управление доступом для кода|Только выполнение|Выполнение и доступ к внешним ресурсам|Без ограничений|  
|Ограничения модели программирования|Да|Да|Без ограничений|  
|Требование к проверяемости|Да|Да|Нет|  
|Возможность вызова машинного кода|Нет|Нет|Да|  
  
 Режим SAFE является наиболее надежным и безопасным с соответствующими ограничениями в отношении разрешенной модели программирования. Код с разрешениями SAFE имеет самый высокий уровень надежности и безопасности. Сборки с разрешениями SAFE получают разрешение на выполнение, проведение вычислений и доступ к локальной базе данных. Сборки с разрешениями SAFE должны иметь возможность проверки типобезопасности и не могут вызывать неуправляемый код.  
  
 Набор разрешений EXTERNAL-ACCESS представляет собой промежуточный вариант в контексте безопасности. Он разрешает коду доступ к внешним по отношению к базе данных ресурсам, но при этом по-прежнему обеспечивает уровень надежности и безопасности, соответствующий разрешениям SAFE.  
  
 Режим UNSAFE предназначен для кода с высоким уровнем доверия, который может создаваться только администраторами базы данных. Этот доверенный код не имеет ограничений на управление доступом к коду и может вызывать неуправляемый (машинный) код.  
  
 SQL Server использует уровень политики управления доступом к коду на уровне ведущего приложения для настройки политики ведущего приложения, которая предоставляет один из трех наборов разрешений на основе наборов, которые хранятся в каталогах SQL Server. Управляемый код, выполняемый в базе данных, всегда получает один из этих наборов разрешений на управление доступом к коду.  
  
## <a name="programming-model-restrictions"></a>Ограничения модели программирования  
 В модели программирования SQL Server должны применяться функции, процедуры и типы, которые не требуют удержания состояния для нескольких вызовов или использования общего состояния для нескольких пользовательских сеансов. Кроме того, как было описано ранее, наличие общего состояние может привести к возникновению критических исключений, которые повлияют на масштабируемость и надежность приложения.  
  
 Исходя из этого, SQL Server не поддерживает использование статических переменных и статических членов данных. Для сборок с разрешениями SAFE и EXTERNAL-ACCESS SQL Server проверяет метаданные сборки во время СОЗДАНИЯ СБОРКИ и возвращает состояние сбоя, если в ней используются статические переменные и члены данных.  
  
## <a name="see-also"></a>См. также

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
