---
title: области с ограничением выполнения
ms.date: 03/30/2017
helpviewer_keywords:
- constrained execution regions
- CERs
ms.assetid: 99354547-39c1-4b0b-8553-938e8f8d1808
ms.openlocfilehash: fde2bab99f156ddffec678022a58e7b14e0af01e
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75716168"
---
# <a name="constrained-execution-regions"></a><span data-ttu-id="8b457-102">области с ограничением выполнения</span><span class="sxs-lookup"><span data-stu-id="8b457-102">Constrained Execution Regions</span></span>
<span data-ttu-id="8b457-103">Область ограниченного выполнения (CER) является одной из составляющих механизма создания надежного управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="8b457-103">A constrained execution region (CER) is part of a mechanism for authoring reliable managed code.</span></span> <span data-ttu-id="8b457-104">В этой области общеязыковая среда выполнения (CLR) не может выдавать специализированные исключения, препятствующие полному выполнению заключенного в эту область кода.</span><span class="sxs-lookup"><span data-stu-id="8b457-104">A CER defines an area in which the common language runtime (CLR) is constrained from throwing out-of-band exceptions that would prevent the code in the area from executing in its entirety.</span></span> <span data-ttu-id="8b457-105">В этой области не может выполняться пользовательский код, в результате которого могут возникать специализированные исключения.</span><span class="sxs-lookup"><span data-stu-id="8b457-105">Within that region, user code is constrained from executing code that would result in the throwing of out-of-band exceptions.</span></span> <span data-ttu-id="8b457-106">Метод <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> указывается непосредственно перед блоком `try` и помечает блоки `catch`, `finally` и `fault` как области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-106">The <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> method must immediately precede a `try` block and marks `catch`, `finally`, and `fault` blocks as constrained execution regions.</span></span> <span data-ttu-id="8b457-107">После определения области ограниченного выполнения код может вызывать только другой код со строгими контрактами надежности и не должен выделять память или выполнять виртуальные вызовы для неподготовленных или ненадежных методов, если в таком коде не предусмотрены механизмы обработки сбоев.</span><span class="sxs-lookup"><span data-stu-id="8b457-107">Once marked as a constrained region, code must only call other code with strong reliability contracts, and code should not allocate or make virtual calls to unprepared or unreliable methods unless the code is prepared to handle failures.</span></span> <span data-ttu-id="8b457-108">Среда выполнения задерживает аварийные завершения потоков для кода, который выполняется в области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-108">The CLR delays thread aborts for code that is executing in a CER.</span></span>  
  
 <span data-ttu-id="8b457-109">Области ограниченного выполнения применяются в среде CLR в различных формах, в том числе в указанном выше блоке `try`. Часто это могут быть критически важные методы завершения, которые выполняются в производных от <xref:System.Runtime.ConstrainedExecution.CriticalFinalizerObject> классах, или код, выполняемый в методе <xref:System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup%2A>.</span><span class="sxs-lookup"><span data-stu-id="8b457-109">Constrained execution regions are used in different forms in the CLR in addition to an annotated `try` block, notably critical finalizers executing in classes derived from the <xref:System.Runtime.ConstrainedExecution.CriticalFinalizerObject> class and code executed using the <xref:System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup%2A> method.</span></span>  
  
## <a name="cer-advance-preparation"></a><span data-ttu-id="8b457-110">Заблаговременная подготовка области ограниченного выполнения</span><span class="sxs-lookup"><span data-stu-id="8b457-110">CER Advance Preparation</span></span>  
 <span data-ttu-id="8b457-111">Среда CLR подготавливает область ограниченного выполнения заранее, чтобы избежать ошибок, связанных с нехваткой памяти.</span><span class="sxs-lookup"><span data-stu-id="8b457-111">The CLR prepares CERs in advance to avoid out-of-memory conditions.</span></span> <span data-ttu-id="8b457-112">Таким образом удается исключить нехватку памяти во время JIT-компиляции или загрузки типов.</span><span class="sxs-lookup"><span data-stu-id="8b457-112">Advance preparation is required so the CLR does not cause an out of memory condition during just-in-time compilation or type loading.</span></span>  
  
 <span data-ttu-id="8b457-113">Разработчик должен явно определить нужный фрагмент кода как область ограниченного выполнения:</span><span class="sxs-lookup"><span data-stu-id="8b457-113">The developer is required to indicate that a code region is a CER:</span></span>  
  
- <span data-ttu-id="8b457-114">Область ограниченного выполнения верхнего уровня и методы в полном графе вызовов, к которым применяется атрибут <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute>, подготавливаются заранее.</span><span class="sxs-lookup"><span data-stu-id="8b457-114">The top level CER region and methods in the full call graph that have the <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> attribute applied are prepared in advance.</span></span> <span data-ttu-id="8b457-115">Атрибут <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> может гарантировать только состояния <xref:System.Runtime.ConstrainedExecution.Cer.Success> или <xref:System.Runtime.ConstrainedExecution.Cer.MayFail>.</span><span class="sxs-lookup"><span data-stu-id="8b457-115">The <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> can only state guarantees of <xref:System.Runtime.ConstrainedExecution.Cer.Success> or <xref:System.Runtime.ConstrainedExecution.Cer.MayFail>.</span></span>  
  
- <span data-ttu-id="8b457-116">Заблаговременная подготовка невозможна для вызовов, которые нельзя определить статически, таких как вызовы виртуальной диспетчеризации.</span><span class="sxs-lookup"><span data-stu-id="8b457-116">Advance preparation cannot be performed for calls that cannot be statically determined, such as virtual dispatch.</span></span> <span data-ttu-id="8b457-117">В таких случаях следует использовать метод <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareMethod%2A>.</span><span class="sxs-lookup"><span data-stu-id="8b457-117">Use the <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareMethod%2A> method in these cases.</span></span> <span data-ttu-id="8b457-118">При использовании метода <xref:System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup%2A> необходимо применять атрибут <xref:System.Runtime.ConstrainedExecution.PrePrepareMethodAttribute> для очистки кода.</span><span class="sxs-lookup"><span data-stu-id="8b457-118">When using the <xref:System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup%2A> method, the <xref:System.Runtime.ConstrainedExecution.PrePrepareMethodAttribute> attribute should be applied to the clean up code.</span></span>  
  
## <a name="constraints"></a><span data-ttu-id="8b457-119">Ограничения</span><span class="sxs-lookup"><span data-stu-id="8b457-119">Constraints</span></span>  
 <span data-ttu-id="8b457-120">В области ограниченного выполнения можно использовать только код определенного типа.</span><span class="sxs-lookup"><span data-stu-id="8b457-120">Users are constrained in the type of code they can write in a CER.</span></span> <span data-ttu-id="8b457-121">В допустимом коде не должны возникать специализированные исключения, например связанные с выполнением следующих операций:</span><span class="sxs-lookup"><span data-stu-id="8b457-121">The code cannot cause an out-of-band exception, such as might result from the following operations:</span></span>  
  
- <span data-ttu-id="8b457-122">Явное выделение памяти.</span><span class="sxs-lookup"><span data-stu-id="8b457-122">Explicit allocation.</span></span>  
  
- <span data-ttu-id="8b457-123">Упаковка-преобразование.</span><span class="sxs-lookup"><span data-stu-id="8b457-123">Boxing.</span></span>  
  
- <span data-ttu-id="8b457-124">Получение блокировки.</span><span class="sxs-lookup"><span data-stu-id="8b457-124">Acquiring a lock.</span></span>  
  
- <span data-ttu-id="8b457-125">Виртуальный вызов неподготовленных методов.</span><span class="sxs-lookup"><span data-stu-id="8b457-125">Calling unprepared methods virtually.</span></span>  
  
- <span data-ttu-id="8b457-126">Вызов методов со слабым или отсутствующим контрактом надежности.</span><span class="sxs-lookup"><span data-stu-id="8b457-126">Calling methods with a weak or nonexistent reliability contract.</span></span>  
  
 <span data-ttu-id="8b457-127">Для платформы .NET Framework версии 2.0 эти ограничения устанавливаются как правила.</span><span class="sxs-lookup"><span data-stu-id="8b457-127">In the .NET Framework version 2.0, these constraints are guidelines.</span></span> <span data-ttu-id="8b457-128">Для диагностики применяются средства анализа кода.</span><span class="sxs-lookup"><span data-stu-id="8b457-128">Diagnostics are provided through code analysis tools.</span></span>  
  
## <a name="reliability-contracts"></a><span data-ttu-id="8b457-129">Контракты надежности</span><span class="sxs-lookup"><span data-stu-id="8b457-129">Reliability Contracts</span></span>  
 <span data-ttu-id="8b457-130">Настраиваемый атрибут <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> определяет гарантированную надежность и состояние повреждения для указанного метода.</span><span class="sxs-lookup"><span data-stu-id="8b457-130">The <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> is a custom attribute that documents the reliability guarantees and the corruption state of a given method.</span></span>  
  
### <a name="reliability-guarantees"></a><span data-ttu-id="8b457-131">Гарантии надежности</span><span class="sxs-lookup"><span data-stu-id="8b457-131">Reliability Guarantees</span></span>  
 <span data-ttu-id="8b457-132">Гарантии надежности представляются значениями перечисления <xref:System.Runtime.ConstrainedExecution.Cer> и определяют степень надежности указанного метода:</span><span class="sxs-lookup"><span data-stu-id="8b457-132">Reliability guarantees, represented by <xref:System.Runtime.ConstrainedExecution.Cer> enumeration values, indicate the degree of reliability of a given method:</span></span>  
  
- <span data-ttu-id="8b457-133"><xref:System.Runtime.ConstrainedExecution.Cer.MayFail>.</span><span class="sxs-lookup"><span data-stu-id="8b457-133"><xref:System.Runtime.ConstrainedExecution.Cer.MayFail>.</span></span> <span data-ttu-id="8b457-134">Метод может завершиться сбоем в состоянии исключения.</span><span class="sxs-lookup"><span data-stu-id="8b457-134">Under exceptional conditions, the method might fail.</span></span> <span data-ttu-id="8b457-135">В этом случае метод возвращает вызывающему методу сведения об успешном или неудачном выполнении.</span><span class="sxs-lookup"><span data-stu-id="8b457-135">In this case, the method reports back to the calling method whether it succeeded or failed.</span></span> <span data-ttu-id="8b457-136">Такой метод должен размещаться в области ограниченного выполнения, чтобы гарантированно передавать возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="8b457-136">The method must be contained in a CER to ensure that it can report the return value.</span></span>  
  
- <span data-ttu-id="8b457-137"><xref:System.Runtime.ConstrainedExecution.Cer.None>.</span><span class="sxs-lookup"><span data-stu-id="8b457-137"><xref:System.Runtime.ConstrainedExecution.Cer.None>.</span></span> <span data-ttu-id="8b457-138">Метод, тип или сборка не поддерживает механизм области ограниченного выполнения и, скорее всего, не может безопасно вызываться в ней без надлежащих мер по исключению поврежденного состояния.</span><span class="sxs-lookup"><span data-stu-id="8b457-138">The method, type, or assembly has no concept of a CER and is most likely not safe to call within a CER without substantial mitigation from state corruption.</span></span> <span data-ttu-id="8b457-139">Этот метод не использует преимущества гарантий для области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-139">It does not take advantage of CER guarantees.</span></span> <span data-ttu-id="8b457-140">В этом случае подразумевается следующее:</span><span class="sxs-lookup"><span data-stu-id="8b457-140">This implies the following:</span></span>  
  
    1. <span data-ttu-id="8b457-141">Метод может завершиться сбоем в состоянии исключения.</span><span class="sxs-lookup"><span data-stu-id="8b457-141">Under exceptional conditions the method might fail.</span></span>  
  
    2. <span data-ttu-id="8b457-142">Метод не может гарантированно возвращать сообщение о сбое.</span><span class="sxs-lookup"><span data-stu-id="8b457-142">The method might or might not report that it failed.</span></span>  
  
    3. <span data-ttu-id="8b457-143">В большинстве случаев этот метод не предназначен для использования в областях ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-143">The method is not written to use a CER, the most likely scenario.</span></span>  
  
    4. <span data-ttu-id="8b457-144">Если метод, тип или сборка не имеют явного определения успешного выполнения, они будут неявно определены как <xref:System.Runtime.ConstrainedExecution.Cer.None>.</span><span class="sxs-lookup"><span data-stu-id="8b457-144">If a method, type, or assembly is not explicitly identified to succeed, it is implicitly identified as <xref:System.Runtime.ConstrainedExecution.Cer.None>.</span></span>  
  
- <span data-ttu-id="8b457-145"><xref:System.Runtime.ConstrainedExecution.Cer.Success>.</span><span class="sxs-lookup"><span data-stu-id="8b457-145"><xref:System.Runtime.ConstrainedExecution.Cer.Success>.</span></span> <span data-ttu-id="8b457-146">В состоянии исключения гарантируется успешное выполнение метода.</span><span class="sxs-lookup"><span data-stu-id="8b457-146">Under exceptional conditions, the method is guaranteed to succeed.</span></span> <span data-ttu-id="8b457-147">Чтобы достичь этого уровня надежности, необходимо всегда строить область ограниченного выполнения вокруг метода, который вызывается, даже если он вызывается не из такой области.</span><span class="sxs-lookup"><span data-stu-id="8b457-147">To achieve this level of reliability you should always construct a CER around the method that is called, even when it is called from within a non-CER region.</span></span> <span data-ttu-id="8b457-148">Состояние успеха достигается в том случае, если метод выполнил предусмотренные операции либо завершился успешно с субъективной точки зрения.</span><span class="sxs-lookup"><span data-stu-id="8b457-148">A method is successful if it accomplishes what is intended, although success can be viewed subjectively.</span></span> <span data-ttu-id="8b457-149">Например, если метод Count отмечен как `ReliabilityContractAttribute(Cer.Success)`, подразумевается, что он выполняется в области ограниченного выполнения, всегда возвращает число элементов в <xref:System.Collections.ArrayList> и никогда не оставляет внутренние поля в неопределенном состоянии.</span><span class="sxs-lookup"><span data-stu-id="8b457-149">For example, marking Count with `ReliabilityContractAttribute(Cer.Success)` implies that when it is run under a CER, it always returns a count of the number of elements in the <xref:System.Collections.ArrayList> and it can never leave the internal fields in an undetermined state.</span></span>  <span data-ttu-id="8b457-150">Тем не менее метод <xref:System.Threading.Interlocked.CompareExchange%2A> также помечен как успешный в том смысле, что его значение не может быть заменено новым из-за возникновения состояния гонки.</span><span class="sxs-lookup"><span data-stu-id="8b457-150">However, the <xref:System.Threading.Interlocked.CompareExchange%2A> method is marked as success as well, with the understanding that success may mean the value could not be replaced with a new value due to a race condition.</span></span>  <span data-ttu-id="8b457-151">В этом случае важно, что метод функционирует в точном соответствии с задокументированным поведением. Соответственно, для него не нужно писать код области ограниченного выполнения для обработки возможных непредвиденных результатов, которые может давать правильно написанный, но не являющийся надежным код.</span><span class="sxs-lookup"><span data-stu-id="8b457-151">The key point is that the method behaves in the way it is documented to behave, and CER code does not need to be written to expect any unusual behavior beyond what correct but unreliable code would look like.</span></span>  
  
### <a name="corruption-levels"></a><span data-ttu-id="8b457-152">Уровни повреждения</span><span class="sxs-lookup"><span data-stu-id="8b457-152">Corruption levels</span></span>  
 <span data-ttu-id="8b457-153">Уровни повреждения представлены значениями перечисления <xref:System.Runtime.ConstrainedExecution.Consistency> и указывают возможную степень повреждения состояния в указанной среде:</span><span class="sxs-lookup"><span data-stu-id="8b457-153">Corruption levels, represented by <xref:System.Runtime.ConstrainedExecution.Consistency> enumeration values, indicate how much state may be corrupted in a given environment:</span></span>  
  
- <span data-ttu-id="8b457-154"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptAppDomain>.</span><span class="sxs-lookup"><span data-stu-id="8b457-154"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptAppDomain>.</span></span> <span data-ttu-id="8b457-155">В состоянии исключения общеязыковая среда выполнения (CLR) не гарантирует обеспечение согласованности состояния в текущем домене приложения.</span><span class="sxs-lookup"><span data-stu-id="8b457-155">Under exceptional conditions, the common language runtime (CLR) makes no guarantees regarding state consistency in the current application domain.</span></span>  
  
- <span data-ttu-id="8b457-156"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptInstance>.</span><span class="sxs-lookup"><span data-stu-id="8b457-156"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptInstance>.</span></span> <span data-ttu-id="8b457-157">В состоянии исключения метод может гарантировать, что повреждение состояния будет ограничено областью текущего экземпляра.</span><span class="sxs-lookup"><span data-stu-id="8b457-157">Under exceptional conditions, the method is guaranteed to limit state corruption to the current instance.</span></span>  
  
- <span data-ttu-id="8b457-158"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptProcess>. В состоянии исключения среда CLR не гарантирует согласованность состояния, то есть такое условие может привести к повреждению процесса.</span><span class="sxs-lookup"><span data-stu-id="8b457-158"><xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptProcess>, Under exceptional conditions, the CLR makes no guarantees regarding state consistency; that is, the condition might corrupt the process.</span></span>  
  
- <span data-ttu-id="8b457-159"><xref:System.Runtime.ConstrainedExecution.Consistency.WillNotCorruptState>.</span><span class="sxs-lookup"><span data-stu-id="8b457-159"><xref:System.Runtime.ConstrainedExecution.Consistency.WillNotCorruptState>.</span></span> <span data-ttu-id="8b457-160">В состоянии исключения гарантируется, что метод не приведет к повреждению состояния.</span><span class="sxs-lookup"><span data-stu-id="8b457-160">Under exceptional conditions, the method is guaranteed not to corrupt state.</span></span>  
  
## <a name="reliability-trycatchfinally"></a><span data-ttu-id="8b457-161">Надежность блоков try/catch/finally</span><span class="sxs-lookup"><span data-stu-id="8b457-161">Reliability try/catch/finally</span></span>  
 <span data-ttu-id="8b457-162">Надежность блоков `try/catch/finally` определяет механизм обработки исключений с тем же уровнем гарантий предсказуемости, что и неуправляемая версия.</span><span class="sxs-lookup"><span data-stu-id="8b457-162">The reliability `try/catch/finally` is an exception handling mechanism with the same level of predictability guarantees as the unmanaged version.</span></span> <span data-ttu-id="8b457-163">Блок `catch/finally` представляет собой область ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-163">The `catch/finally` block is the CER.</span></span> <span data-ttu-id="8b457-164">Методы в этом блоке подготавливаются заранее и не должны прерываться.</span><span class="sxs-lookup"><span data-stu-id="8b457-164">Methods in the block require advance preparation and must be noninterruptible.</span></span>  
  
 <span data-ttu-id="8b457-165">На платформе .NET Framework версии 2.0 код информирует среду выполнения о надежности блока try, вызывая <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> непосредственно перед этим блоком.</span><span class="sxs-lookup"><span data-stu-id="8b457-165">In the .NET Framework version 2.0, code informs the runtime that a try is reliable by calling <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> immediately preceding a try block.</span></span> <span data-ttu-id="8b457-166"><xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> является членом вспомогательного класса компилятора <xref:System.Runtime.CompilerServices.RuntimeHelpers>.</span><span class="sxs-lookup"><span data-stu-id="8b457-166"><xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> is a member of <xref:System.Runtime.CompilerServices.RuntimeHelpers>, a compiler support class.</span></span> <span data-ttu-id="8b457-167">Ожидается реализация прямого вызова метода <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> посредством компиляторов.</span><span class="sxs-lookup"><span data-stu-id="8b457-167">Call <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> directly pending its availability through compilers.</span></span>  
  
## <a name="noninterruptible-regions"></a><span data-ttu-id="8b457-168">Непрерываемые области</span><span class="sxs-lookup"><span data-stu-id="8b457-168">Noninterruptible Regions</span></span>  
 <span data-ttu-id="8b457-169">Непрерываемая область служит для группировки набора инструкций в области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-169">A noninterruptible region groups a set of instructions into a CER.</span></span>  
  
 <span data-ttu-id="8b457-170">На платформе .NET Framework версии 2.0 (ожидается доступность посредством компиляторов) пользовательский код создает непрерываемые области с надежными блоками try/catch/finally, содержащие пустой блок try/catch block, которому предшествует вызов метода <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A>.</span><span class="sxs-lookup"><span data-stu-id="8b457-170">In .NET Framework version 2.0, pending availability through compiler support, user code creates non-interruptible regions with a reliable try/catch/finally that contains an empty try/catch block preceded by a <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareConstrainedRegions%2A> method call.</span></span>  
  
## <a name="critical-finalizer-object"></a><span data-ttu-id="8b457-171">Объект критически важного метода завершения</span><span class="sxs-lookup"><span data-stu-id="8b457-171">Critical Finalizer Object</span></span>  
 <span data-ttu-id="8b457-172"><xref:System.Runtime.ConstrainedExecution.CriticalFinalizerObject> гарантирует, что в методе завершения будет выполнена сборка мусора.</span><span class="sxs-lookup"><span data-stu-id="8b457-172">A <xref:System.Runtime.ConstrainedExecution.CriticalFinalizerObject> guarantees that garbage collection will execute the finalizer.</span></span> <span data-ttu-id="8b457-173">После выделения памяти метод завершения и его граф вызовов подготавливаются заблаговременно.</span><span class="sxs-lookup"><span data-stu-id="8b457-173">Upon allocation, the finalizer and its call graph are prepared in advance.</span></span> <span data-ttu-id="8b457-174">Метод завершения выполняется в области ограниченного выполнения и должен соответствовать всем ограничениям, которые применяются к таким областям и методам.</span><span class="sxs-lookup"><span data-stu-id="8b457-174">The finalizer method executes in a CER, and must obey all the constraints on CERs and finalizers.</span></span>  
  
 <span data-ttu-id="8b457-175">Для всех типов, наследуемых от <xref:System.Runtime.InteropServices.SafeHandle> и <xref:System.Runtime.InteropServices.CriticalHandle>, гарантируется выполнение метода завершения в области ограниченного выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b457-175">Any types inheriting from <xref:System.Runtime.InteropServices.SafeHandle> and <xref:System.Runtime.InteropServices.CriticalHandle> are guaranteed to have their finalizer execute within a CER.</span></span> <span data-ttu-id="8b457-176">Для выполнения любого кода, для которого требуется высвобождение дескриптора, реализуйте <xref:System.Runtime.InteropServices.SafeHandle.ReleaseHandle%2A> в производных от <xref:System.Runtime.InteropServices.SafeHandle> классах.</span><span class="sxs-lookup"><span data-stu-id="8b457-176">Implement <xref:System.Runtime.InteropServices.SafeHandle.ReleaseHandle%2A> in <xref:System.Runtime.InteropServices.SafeHandle> derived classes to execute any code that is required to free the handle.</span></span>  
  
## <a name="code-not-permitted-in-cers"></a><span data-ttu-id="8b457-177">Код, который нельзя выполнять в областях ограниченного выполнения</span><span class="sxs-lookup"><span data-stu-id="8b457-177">Code Not Permitted in CERs</span></span>  
 <span data-ttu-id="8b457-178">В областях ограниченного выполнения не допускаются следующие операции:</span><span class="sxs-lookup"><span data-stu-id="8b457-178">The following operations are not permitted in CERs:</span></span>  
  
- <span data-ttu-id="8b457-179">Явное выделение памяти.</span><span class="sxs-lookup"><span data-stu-id="8b457-179">Explicit allocations.</span></span>  
  
- <span data-ttu-id="8b457-180">Получение блокировки.</span><span class="sxs-lookup"><span data-stu-id="8b457-180">Acquiring a lock.</span></span>  
  
- <span data-ttu-id="8b457-181">Упаковка-преобразование.</span><span class="sxs-lookup"><span data-stu-id="8b457-181">Boxing.</span></span>  
  
- <span data-ttu-id="8b457-182">Доступ к многомерным массивам.</span><span class="sxs-lookup"><span data-stu-id="8b457-182">Multidimensional array access.</span></span>  
  
- <span data-ttu-id="8b457-183">Вызовы методов посредством отражения.</span><span class="sxs-lookup"><span data-stu-id="8b457-183">Method calls through reflection.</span></span>  
  
- <span data-ttu-id="8b457-184"><xref:System.Threading.Monitor.Enter%2A> или <xref:System.IO.FileStream.Lock%2A>.</span><span class="sxs-lookup"><span data-stu-id="8b457-184"><xref:System.Threading.Monitor.Enter%2A> or <xref:System.IO.FileStream.Lock%2A>.</span></span>  
  
- <span data-ttu-id="8b457-185">Проверки безопасности.</span><span class="sxs-lookup"><span data-stu-id="8b457-185">Security checks.</span></span> <span data-ttu-id="8b457-186">Нельзя выполнять запросы, только требования ссылок.</span><span class="sxs-lookup"><span data-stu-id="8b457-186">Do not perform demands, only link demands.</span></span>  
  
- <span data-ttu-id="8b457-187"><xref:System.Reflection.Emit.OpCodes.Isinst> и <xref:System.Reflection.Emit.OpCodes.Castclass> для COM-объектов и прокси-элементов.</span><span class="sxs-lookup"><span data-stu-id="8b457-187"><xref:System.Reflection.Emit.OpCodes.Isinst> and <xref:System.Reflection.Emit.OpCodes.Castclass> for COM objects and proxies</span></span>  
  
- <span data-ttu-id="8b457-188">Получение или установка полей для прозрачных прокси.</span><span class="sxs-lookup"><span data-stu-id="8b457-188">Getting or setting fields on a transparent proxy.</span></span>  
  
- <span data-ttu-id="8b457-189">Сериализация.</span><span class="sxs-lookup"><span data-stu-id="8b457-189">Serialization.</span></span>  
  
- <span data-ttu-id="8b457-190">Указатели на функции и делегаты.</span><span class="sxs-lookup"><span data-stu-id="8b457-190">Function pointers and delegates.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8b457-191">См. также:</span><span class="sxs-lookup"><span data-stu-id="8b457-191">See also</span></span>

- [<span data-ttu-id="8b457-192">Рекомендации по обеспечению надежности</span><span class="sxs-lookup"><span data-stu-id="8b457-192">Reliability Best Practices</span></span>](reliability-best-practices.md)
