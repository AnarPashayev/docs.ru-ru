---
title: События сборки мусора (трассировка событий Windows)
ms.date: 03/30/2017
helpviewer_keywords:
- GC events
- garbage collection events [.NET Framework]
- ETW, garbage collection events (CLR)
ms.assetid: f14b6fd7-0966-4d87-bc89-54ef3a44a94a
ms.openlocfilehash: 5ff214314b92796f4a4a89ddd33a976d8b1f21d1
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75716067"
---
# <a name="garbage-collection-etw-events"></a>События сборки мусора (трассировка событий Windows)

Эти события собирают сведения, относящиеся к сборке мусора. Они помогают при диагностике и отладке, в том числе позволяют определить, сколько раз осуществлялась сборка мусора, какой объем памяти был освобожден в ходе сборки мусора и т. д.

Эта категория состоит из следующих событий:

- [Событие GCStart_V1](#gcstart_v1-event)
- [Событие GCEnd_V1](#gcend_v1-event)
- [Событие GCHeapStats_V1](#gcheapstats_v1-event)
- [Событие GCCreateSegment_V1](#gccreatesegment_v1-event)
- [Событие GCFreeSegment_V1](#gcfreesegment_v1-event)
- [Событие GCRestartEEBegin_V1](#gcrestarteebegin_v1-event)
- [Событие GCRestartEEEnd_V1](#gcrestarteeend_v1-event)
- [Событие GCSuspendEE_V1](#gcsuspendee_v1-event)
- [Событие GCSuspendEEEnd_V1](#gcsuspendeeend_v1-event)
- [Событие GCAllocationTick_V2](#gcallocationtick_v2-event)
- [Событие GCFinalizersBegin_V1](#gcfinalizersbegin_v1-event)
- [Событие GCFinalizersEnd_V1](#gcfinalizersend_v1-event)
- [Событие GCCreateConcurrentThread_V1](#gccreateconcurrentthread_v1-event)
- [Событие GCTerminateConcurrentThread_V1](#gcterminateconcurrentthread_v1-event)

## <a name="gcstart_v1-event"></a>Событие GCStart_V1  

В таблице ниже показаны ключевое слово и уровень. Дополнительные сведения см. в разделе [Ключевые слова и уровни ETW среды CLR](clr-etw-keywords-and-levels.md).

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCStart_V1`|1|Сборка мусора начата.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Число|win:UInt32|Сборка мусора, *n*-я по счету.|
|Глубина|win:UInt32|Поколение, для которого выполняется сборка.|
|Причина|win:UInt32|Причина запуска сборки мусора:<br /><br /> 0x0 — выделение кучи маленьких объектов.<br /><br /> 0x1 — принудительная.<br /><br /> 0x2 — недостаточно памяти.<br /><br /> 0x3 — пусто.<br /><br /> 0x4 — выделение кучи больших объектов.<br /><br /> 0x5 — недостаточно места (для кучи маленьких объектов).<br /><br /> 0x6 — недостаточно места (для кучи больших объектов).<br /><br /> 0x7 — принудительная, но не блокирующий.|
|Тип|win:UInt32|0x0 — блокировка сборки мусора вне фоновой сборки мусора.<br /><br /> 0x1 — фоновая сборка мусора.<br /><br /> 0x2 — блокировка сборки мусора в ходе фоновой сборки мусора.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

## <a name="gcend_v1-event"></a>Событие GCEnd_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCEnd_V1`|2|Сборка мусора закончена.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Число|win:UInt32|Сборка мусора, *n*-я по счету.|
|Глубина|win:UInt32|Поколение, для которого выполнялась сборка.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

## <a name="gcheapstats_v1-event"></a>Событие GCHeapStats_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Описание|
|-----------|--------------|-----------------|
|`GCHeapStats_V1`|4|Показывает статистику кучи по завершении каждой сборки мусора.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|GenerationSize0|win:UInt64|Размер области памяти поколения 0 (в байтах).|
|TotalPromotedSize0|win:UInt64|Число байт, которые были переданы из поколения 0 в поколение 1.|
|GenerationSize1|win:UInt64|Размер области памяти поколения 1 (в байтах).|
|TotalPromotedSize1|win:UInt64|Число байт, которые были переданы из поколения 1 в поколение 2.|
|GenerationSize2|win:UInt64|Размер области памяти поколения 2 (в байтах).|
|TotalPromotedSize2|win:UInt64|Число байт, оставшихся в поколении 2 после последней сборки.|
|GenerationSize3|win:UInt64|Размер кучи больших объектов (в байтах).|
|TotalPromotedSize3|win:UInt64|Число байт, оставшихся в куче больших объектов после последней сборки.|
|FinalizationPromotedSize|win:UInt64|Общий размер (в байтах) объектов, которые готовы к завершению.|
|FinalizationPromotedCount|win:UInt64|Количество объектов, которые готовы к завершению.|
|PinnedObjectCount|win:UInt32|Количество закрепленных (неподвижных) объектов.|
|SinkBlockCount|win:UInt32|Количество используемых блоков синхронизации.|
|GCHandleCount|win:UInt32|Число используемых дескрипторов сборки мусора.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|
  
## <a name="gccreatesegment_v1-event"></a>Событие GCCreateSegment_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCCreateSegment_V1`|5|Был создан новый сегмент сборки мусора. Кроме того, при включении трассировки для уже работающего процесса это событие создается для каждого существующего сегмента.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Адрес|win:UInt64|Адрес сегмента.|
|Размер|win:UInt64|Размер сегмента.|
|Тип|win:UInt32|0x0 — куча маленьких объектов.<br /><br /> 0x1 — куча больших объектов.<br /><br /> 0x2 — куча только для чтения.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

Обратите внимание, что размер сегментов, выделенных сборщиком мусора, зависит от реализации и может быть изменен в любое время, в том числе при периодических обновлениях. Приложение не должно делать никаких допущений относительно размера определенного сегмента, полагаться на него или пытаться настроить объем памяти, доступный для выделения сегментов.

## <a name="gcfreesegment_v1-event"></a>Событие GCFreeSegment_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCFreeSegment_V1`|6|Сегмент сборки мусора был освобожден.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Адрес|win:UInt64|Адрес сегмента.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

## <a name="gcrestarteebegin_v1-event"></a>Событие GCRestartEEBegin_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCRestartEEBegin_V1`|7|Началось возобновление приостановленной среды CLR.|

Нет данных события.

## <a name="gcrestarteeend_v1-event"></a>Событие GCRestartEEEnd_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Идентификатор события|Условие вызова|
|-----------|--------------|-----------------|
|`GCRestartEEEnd_V1`|3|Возобновление приостановленной среды CLR завершено.|

Нет данных события.

## <a name="gcsuspendee_v1-event"></a>Событие GCSuspendEE_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCSuspendEE_V1`|9|Началась приостановка механизма выполнения сборки мусора.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Причина|win:UInt16|0x0 — другое.<br /><br /> 0x1 — сборка мусора.<br /><br /> 0x2 — завершение работы домена приложения.<br /><br /> 0x3 — свертка кода.<br /><br /> 0x4 — завершение работы.<br /><br /> 0x5 — отладчик.<br /><br /> 0x6 — подготовка к сборке мусора.|
|Число|win:UInt32|Счетчик сборки мусора на текущий момент времени. Обычно после этого отображается последующее событие запуска сборки мусора, а значение увеличивается на 1 в соответствии с увеличением индекса сборки мусора в ходе этого процесса.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

## <a name="gcsuspendeeend_v1-event"></a>Событие GCSuspendEEEnd_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCSuspendEEEnd_V1`|8|Завершена приостановка механизма выполнения сборки мусора.|

Нет данных события.

## <a name="gcallocationtick_v2-event"></a>Событие GCAllocationTick_V2

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCAllocationTick_V2`|10|Каждый раз выделяется около 100 КБ.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|AllocationAmount|win:UInt32|Размер выделения в байтах. Это значение является точным для выделений, размер которых меньше длины ULONG (4 294 967 295 байт). Если выделение больше, это поле содержит усеченное значение. Используйте `AllocationAmount64` для очень больших выделений.|
|AllocationKind|win:UInt32|0x0 — выделение для маленького объекта (выделение в куче маленьких объектов).<br /><br /> 0x1 — выделение для большого объекта (выделение в куче больших объектов).|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|
|AllocationAmount64|win:UInt64|Размер выделения в байтах. Это значение является точным для очень больших выделений.|
|Идентификатор типа|win:Pointer|Адрес MethodTable. Если в ходе этого события было выделено несколько типов объектов, указывается адрес MethodTable, соответствующий последнему выделенному объекту (объекту, вызвавшему превышение порогового значения 100 КБ).|
|TypeName|win:UnicodeString|Имя выделенного типа. Если в ходе этого события было выделено несколько типов объектов, указывается тип последнего выделенного объекта (объекта, вызвавшего превышение порогового значения 100 КБ).|
|HeapIndex|win:UInt32|Куча, в которой был выделен объект. Это значение равно 0 (нулю) при выполнении сборки мусора на рабочей станции.|

## <a name="gcfinalizersbegin_v1-event"></a>Событие GCFinalizersBegin_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCFinalizersBegin_V1`|14|Начало выполнения методов завершения.|

Нет данных события.

## <a name="gcfinalizersend_v1-event"></a>Событие GCFinalizersEnd_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCFinalizersEnd_V1`|13|Завершение выполнения методов завершения.|

В таблице ниже представлены данные события.

|Имя поля|Тип данных|Описание|
|----------------|---------------|-----------------|
|Число|win:UInt32|Число выполненных методов завершения.|
|ClrInstanceID|win:UInt16|Уникальный идентификатор экземпляра CLR или CoreCLR.|

## <a name="gccreateconcurrentthread_v1-event"></a>Событие GCCreateConcurrentThread_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|
|`ThreadingKeyword` (0x10000)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCCreateConcurrentThread_V1`|11|Был создан параллельный поток сборки мусора.|

Нет данных события.

## <a name="gcterminateconcurrentthread_v1-event"></a>Событие GCTerminateConcurrentThread_V1

В таблице ниже показаны ключевое слово и уровень.

|Ключевое слово для вызова события|Уровень|
|-----------------------------------|-----------|
|`GCKeyword` (0x1)|Информационный (4)|
|`ThreadingKeyword` (0x10000)|Информационный (4)|

В таблице ниже представлены сведения о событии.

|Event|Код события|Условие вызова|
|-----------|--------------|-----------------|
|`GCTerminateConcurrentThread_V1`|12|Параллельный поток сборки мусора был завершен.|

Нет данных события.

## <a name="see-also"></a>См. также:

- [События трассировки событий Windows в среде CLR](clr-etw-events.md)
