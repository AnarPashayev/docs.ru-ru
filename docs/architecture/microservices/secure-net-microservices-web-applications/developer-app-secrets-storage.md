---
title: Безопасное хранение секретов приложения во время разработки
description: Безопасность в микрослужбах .NET и веб-приложениях. Не храните секреты приложения, такие как пароли, строки подключения или ключи API, в системе управления версиями. Изучите параметры, которые можно использовать в ASP.NET Core, в частности, как обрабатывать пользовательские секреты.
author: mjrousos
ms.date: 01/30/2020
ms.openlocfilehash: 1ef2246746b9165f1564fa7be64ff7eb28eb1d32
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "77501801"
---
# <a name="store-application-secrets-safely-during-development"></a>Безопасное хранение секретов приложения во время разработки

Для подключения к защищенным ресурсам и другим службам приложения ASP.NET Core обычно используют строки подключения, пароли или другие учетные данные, содержащие конфиденциальные сведения. Эти конфиденциальные сведения называются *секреты*. Мы рекомендуем не включать секреты в исходный код и ни в коем случае не хранить секреты в системе управления версиями. Лучше использовать модель конфигурации ASP.NET Core для чтения секретов из более безопасных мест.

Следует отличать секреты для доступа к ресурсам в среде разработки и промежуточной среде от секретов для доступа к ресурсам в рабочей среде. Это разные наборы секретов, которые используют разные пользователи. Секреты, используемые на стадии разработки, как правило, хранятся в переменных среды или в менеджере секретов ASP.NET Core. Для большей безопасности в рабочих средах микрослужбы могут хранить секреты в хранилище Azure Key Vault.

## <a name="store-secrets-in-environment-variables"></a>Хранение секретов в переменных среды

Чтобы хранить секреты отдельно от исходного кода, разработчики могут установить строки секретов в качестве [переменных среды](/aspnet/core/security/app-secrets#environment-variables) на компьютерах, использующихся для разработки. При использовании переменных среды для хранения секретов с иерархическими именами, например, вложенными в разделы конфигурации, необходимо создать имя для переменных среды, чтобы включить полную иерархию разделов, разделенных двоеточием (:).

Например, если установить для переменной среды `Logging:LogLevel:Default` значение `Debug`, это будет соответствовать конфигурации из следующего файла JSON:

```json
{
    "Logging": {
        "LogLevel": {
            "Default": "Debug"
        }
    }
}
```

Чтобы обратиться к этим значениям из переменных среды, приложению достаточно вызвать AddEnvironmentVariables в ConfigurationBuilder при создании объекта IConfigurationRoot.

Учтите, что обычно переменные среды хранятся в виде обычного текста, и если компьютер или процесс с этими переменными среды будут скомпрометированы, значения переменных среды станут доступными.

## <a name="store-secrets-with-the-aspnet-core-secret-manager"></a>Хранение секретов с помощью диспетчера секретов ASP.NET Core

[Менеджер секретов](/aspnet/core/security/app-secrets#secret-manager) ASP.NET Core — это еще один инструмент для хранения секретов отдельно от исходного кода **при разработке**. Для работы с диспетчером секретов установите пакет **Microsoft.Extensions.Configuration.SecretManager** в файле проекта. Установив и восстановив эту зависимость, можно указать значение секретов в командной строке с помощью команды `dotnet user-secrets`. Секреты будут храниться в файле JSON в каталоге профилей пользователей (в зависимости от ОС), отдельно от исходного кода.

Секреты, заданные диспетчером секретов, упорядочиваются свойством `UserSecretsId` в проекте, использующем эти секреты. Поэтому обязательно задайте свойство UserSecretsId в файле проекта, как показано в следующем фрагменте кода. Значением по умолчанию является GUID, назначенный Visual Studio, но фактическая строка не важна, если она уникальна на вашем компьютере.

```xml
<PropertyGroup>
    <UserSecretsId>UniqueIdentifyingString</UserSecretsId>
</PropertyGroup>
```

Секреты, хранящиеся в диспетчере секретов, используются в приложении путем вызова `AddUserSecrets<T>` в экземпляре ConfigurationBuilder, чтобы включить секреты приложения в его конфигурацию. Общий параметр T должен обозначать тип в сборке, к которой применяется UserSecretId. Как правило, можно использовать `AddUserSecrets<Startup>`.

`AddUserSecrets<Startup>()` относится к параметрам по умолчанию для среды разработки, если в `CreateDefaultBuilder`Program.cs*используется метод*.

>[!div class="step-by-step"]
>[Назад](authorization-net-microservices-web-applications.md)
>[Вперед](azure-key-vault-protects-secrets.md)
