---
title: Потоковые сервисы против повторяющихся полей - gRPC для разработчиков WCF
description: Сравните повторяющиеся поля с потоковыми службами как способы передачи коллекций данных с помощью gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147754"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a><span data-ttu-id="d8b7c-103">gRPC потоковые услуги против повторяющихся полей</span><span class="sxs-lookup"><span data-stu-id="d8b7c-103">gRPC streaming services vs. repeated fields</span></span>

<span data-ttu-id="d8b7c-104">службы gRPC предоставляют два способа возврата наборов данных или списки объектов.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-104">gRPC services provide two ways of returning datasets, or lists of objects.</span></span> <span data-ttu-id="d8b7c-105">Спецификация сообщения Протокола `repeated` Буферов использует ключевое слово для объявления списков или массивов сообщений в другом сообщении.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-105">The Protocol Buffers message specification uses the `repeated` keyword for declaring lists or arrays of messages within another message.</span></span> <span data-ttu-id="d8b7c-106">Спецификация службы gRPC использует ключевое `stream` слово для объявления длительного постоянного соединения.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-106">The gRPC service specification uses the `stream` keyword to declare a long-running persistent connection.</span></span> <span data-ttu-id="d8b7c-107">Через это соединение, несколько сообщений отправляются, и могут быть обработаны, индивидуально.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-107">Over that connection, multiple messages are sent, and can be processed, individually.</span></span>

<span data-ttu-id="d8b7c-108">Вы также можете `stream` использовать эту функцию для длительных временных данных, таких как уведомления или сообщения журнала.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-108">You can also use the `stream` feature for long-running temporal data such as notifications or log messages.</span></span> <span data-ttu-id="d8b7c-109">Но в этой главе будет рассмотрен вопрос о его использовании для возвращения единого набора данных.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-109">But this chapter will consider its use for returning a single dataset.</span></span>

<span data-ttu-id="d8b7c-110">Которые вы должны использовать, зависит от таких факторов, как:</span><span class="sxs-lookup"><span data-stu-id="d8b7c-110">Which you should use depends on factors such as:</span></span>

- <span data-ttu-id="d8b7c-111">Общий размер набора данных.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-111">The overall size of the dataset.</span></span>
- <span data-ttu-id="d8b7c-112">Время, задеваваемый для создания набора данных в конце клиента или сервера.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-112">The time it took to create the dataset at either the client or server end.</span></span>
- <span data-ttu-id="d8b7c-113">Может ли потребитель набора данных начать действовать на него, как только появится первый элемент, или ему нужен полный набор данных, чтобы сделать что-либо полезное.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-113">Whether the consumer of the dataset can start acting on it as soon as the first item is available, or needs the complete dataset to do anything useful.</span></span>

## <a name="when-to-use-repeated-fields"></a><span data-ttu-id="d8b7c-114">Когда использовать `repeated` поля</span><span class="sxs-lookup"><span data-stu-id="d8b7c-114">When to use `repeated` fields</span></span>

<span data-ttu-id="d8b7c-115">Для любого набора данных, который ограничен в размерах и который может быть создан в полном объеме в течение короткого времени, скажем, в течение одной секунды, вы должны использовать `repeated` поле в обычном сообщении Protobuf.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-115">For any dataset that's constrained in size and that can be generated in its entirety in a short time—say, under one second—you should use a `repeated` field in a regular Protobuf message.</span></span> <span data-ttu-id="d8b7c-116">Например, в системе электронной коммерции, чтобы построить список элементов в порядке, вероятно, быстро, и список не будет очень большим.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-116">For example, in an e-commerce system, to build a list of items within an order is probably quick and the list won't be very large.</span></span> <span data-ttu-id="d8b7c-117">Возвращение одного сообщения `repeated` с полем на порядок `stream` быстрее, чем использование, и несет меньше сетевых накладных расходов.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-117">Returning a single message with a `repeated` field is an order of magnitude faster than using `stream` and incurs less network overhead.</span></span>

<span data-ttu-id="d8b7c-118">Если клиенту нужны все данные, прежде чем начать их обрабатывать, а набор `repeated` данных достаточно мал, чтобы построить в памяти, то рассмотрите возможность использования поля.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-118">If the client needs all the data before starting to process it and the dataset is small enough to construct in memory, then consider using a `repeated` field.</span></span> <span data-ttu-id="d8b7c-119">Рассмотрим это, даже если создание набора данных в памяти на сервере происходит медленнее.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-119">Consider it even if the creation of the dataset in memory on the server is slower.</span></span>

## <a name="when-to-use-stream-methods"></a><span data-ttu-id="d8b7c-120">Когда использовать `stream` методы</span><span class="sxs-lookup"><span data-stu-id="d8b7c-120">When to use `stream` methods</span></span>

<span data-ttu-id="d8b7c-121">Когда объекты сообщений в наборах данных потенциально очень велики, лучше всего передать их с помощью потоковых запросов или ответов.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-121">When the message objects in your datasets are potentially very large, it's best for you transfer them by using streaming requests or responses.</span></span> <span data-ttu-id="d8b7c-122">Эффективнее построить большой объект в памяти, записать его в сеть, а затем высвободить ресурсы.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-122">It's more efficient to construct a large object in memory, write it to the network, and then free up the resources.</span></span> <span data-ttu-id="d8b7c-123">Такой подход повысит масштабируемость вашего сервиса.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-123">This approach will improve the scalability of your service.</span></span>

<span data-ttu-id="d8b7c-124">Аналогичным образом следует отправлять наборы данных неограниченного размера по потокам, чтобы избежать иссякания памяти при их построении.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-124">Similarly, you should send datasets of unconstrained size over streams to avoid running out of memory while constructing them.</span></span>

<span data-ttu-id="d8b7c-125">Для наборов данных, в которых потребитель может отдельно обрабатывать каждый элемент, следует рассмотреть возможность использования потока, если это означает, что прогресс может быть указан пользователю.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-125">For datasets where the consumer can separately process each item, you should consider using a stream if it means that progress can be indicated to the user.</span></span> <span data-ttu-id="d8b7c-126">Использование потока может улучшить отзывчивость приложения, но вы должны сбалансировать его с общей производительностью приложения.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-126">Using a stream can improve the responsiveness of an application, but you should balance it against the overall performance of the application.</span></span>

<span data-ttu-id="d8b7c-127">Другой сценарий, в котором потоки могут быть полезны, это когда сообщение обрабатывается в нескольких службах.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-127">Another scenario where streams can be useful is where a message is being processed across multiple services.</span></span> <span data-ttu-id="d8b7c-128">Если каждая служба в цепочке возвращает поток, то служба терминала (то есть последняя в цепочке) может начать возвращать сообщения.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-128">If each service in a chain returns a stream, then the terminal service (that is, the last one in the chain) can start returning messages.</span></span> <span data-ttu-id="d8b7c-129">Эти сообщения могут быть обработаны и переданы обратно по цепочке исходительный запрашивает.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-129">These messages can be processed and passed back along the chain to the original requestor.</span></span> <span data-ttu-id="d8b7c-130">Запрос может либо вернуть поток, либо агрегировать результаты в одно сообщение ответа.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-130">The requestor can either return a stream or aggregate the results into a single response message.</span></span> <span data-ttu-id="d8b7c-131">Такой подход хорошо поддается шаблонам, таким как MapReduce.</span><span class="sxs-lookup"><span data-stu-id="d8b7c-131">This approach lends itself well to patterns like MapReduce.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="d8b7c-132">[Предыдущий](migrate-duplex-services.md)
>[Следующий](client-libraries.md)</span><span class="sxs-lookup"><span data-stu-id="d8b7c-132">[Previous](migrate-duplex-services.md)
[Next](client-libraries.md)</span></span>
