---
title: Службы потоковой передачи и повторяющиеся поля — gRPC для разработчиков WCF
description: Сравните повторяющиеся поля со службами потоковой передачи, как и способы передачи коллекций данных с помощью gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 46586ab08df6b136cdafb990ce8be75435a6bf6c
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75337870"
---
# <a name="grpc-streaming-services-versus-repeated-fields"></a>gRPC службы потоковой передачи и повторяющиеся поля

службы gRPC Services предоставляют два способа возврата наборов данных или списков объектов. Спецификация сообщения «протокол буферов» использует ключевое слово `repeated` для объявления списков или массивов сообщений в другом сообщении. Спецификация службы gRPC использует ключевое слово `stream` для объявления долго выполняющегося постоянного подключения, по которому отправляются несколько сообщений, и может обрабатываться по отдельности. `stream` функцию также можно использовать для длительных временных данных, таких как уведомления или сообщения журнала, но в этой главе будет рассматриваться использование для возврата одного набора данных.

Который следует использовать, зависит от различных факторов, таких как общий размер набора данных, времени, затраченного на создание набора данных на стороне клиента или сервера, а также от того, может ли потребитель этого набора данных начать действовать на нем, как только первый элемент станет доступным. или требуется полный набор данных для выполнения каких-либо полезных действий.

## <a name="when-to-use-repeated-fields"></a>Использование `repeated` полей

Для любого набора данных, ограниченного размером и создаваемого в течение короткого промежутка времени (скажем, в течение одной секунды), следует использовать `repeated` поле в регулярном сообщении protobuf. Например, в системе электронной коммерции, чтобы создать список элементов в порядке, возможно, это быстро, и список не будет очень большим. Возврат одного сообщения с `repeated` полем — это порядок, который быстрее, чем использование `stream` и снижает нагрузку на сеть.

Если клиенту требуются все данные перед началом обработки, а набор данных достаточно мал для создания в памяти, рассмотрите возможность использования поля `repeated`, даже если фактическое создание набора данных в памяти на сервере выполняется медленнее.

## <a name="when-to-use-stream-methods"></a>Использование методов `stream`

Наборы данных, в которых объекты сообщений потенциально очень велики, лучше переносить с помощью потоковых запросов или ответов. Более эффективно создавать большие объекты в памяти, записывать его в сеть, а затем освобождать ресурсы. Такой подход повысит масштабируемость службы.

Точно так же наборы данных с неограниченным размером следует отправлять через потоки, чтобы избежать нехватки памяти при создании этих потоков.

Для наборов данных, в которых каждый отдельный элемент может обрабатываться потребителем отдельно, следует использовать поток, если это означает, что ход выполнения может быть указан конечному пользователю. Это может улучшить очевидную скорость реагирования приложения, хотя это должно быть сбалансировано относительно общей производительности приложения.

Другой случай, когда потоки могут быть полезными, — это место обработки сообщения в нескольких службах. Если каждая служба в цепочке возвращает поток, то служба терминалов (то есть последняя в цепочке) может начать возврат сообщений, которые могут быть обработаны и переданы обратно в цепочку исходному запрашивающему, который может либо вернуть поток, либо выполнить статистическую обработку результаты в одном ответном сообщении. Этот подход хорошо подходит для шаблонов, таких как Map и reduce.

>[!div class="step-by-step"]
>[Назад](migrate-duplex-services.md)
>[Вперед](client-libraries.md)
