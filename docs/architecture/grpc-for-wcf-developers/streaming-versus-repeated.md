---
title: Потоковые сервисы против повторяющихся полей - gRPC для разработчиков WCF
description: Сравните повторяющиеся поля с потоковыми службами как способы передачи коллекций данных с помощью gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147754"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC потоковые услуги против повторяющихся полей

службы gRPC предоставляют два способа возврата наборов данных или списки объектов. Спецификация сообщения Протокола `repeated` Буферов использует ключевое слово для объявления списков или массивов сообщений в другом сообщении. Спецификация службы gRPC использует ключевое `stream` слово для объявления длительного постоянного соединения. Через это соединение, несколько сообщений отправляются, и могут быть обработаны, индивидуально.

Вы также можете `stream` использовать эту функцию для длительных временных данных, таких как уведомления или сообщения журнала. Но в этой главе будет рассмотрен вопрос о его использовании для возвращения единого набора данных.

Которые вы должны использовать, зависит от таких факторов, как:

- Общий размер набора данных.
- Время, задеваваемый для создания набора данных в конце клиента или сервера.
- Может ли потребитель набора данных начать действовать на него, как только появится первый элемент, или ему нужен полный набор данных, чтобы сделать что-либо полезное.

## <a name="when-to-use-repeated-fields"></a>Когда использовать `repeated` поля

Для любого набора данных, который ограничен в размерах и который может быть создан в полном объеме в течение короткого времени, скажем, в течение одной секунды, вы должны использовать `repeated` поле в обычном сообщении Protobuf. Например, в системе электронной коммерции, чтобы построить список элементов в порядке, вероятно, быстро, и список не будет очень большим. Возвращение одного сообщения `repeated` с полем на порядок `stream` быстрее, чем использование, и несет меньше сетевых накладных расходов.

Если клиенту нужны все данные, прежде чем начать их обрабатывать, а набор `repeated` данных достаточно мал, чтобы построить в памяти, то рассмотрите возможность использования поля. Рассмотрим это, даже если создание набора данных в памяти на сервере происходит медленнее.

## <a name="when-to-use-stream-methods"></a>Когда использовать `stream` методы

Когда объекты сообщений в наборах данных потенциально очень велики, лучше всего передать их с помощью потоковых запросов или ответов. Эффективнее построить большой объект в памяти, записать его в сеть, а затем высвободить ресурсы. Такой подход повысит масштабируемость вашего сервиса.

Аналогичным образом следует отправлять наборы данных неограниченного размера по потокам, чтобы избежать иссякания памяти при их построении.

Для наборов данных, в которых потребитель может отдельно обрабатывать каждый элемент, следует рассмотреть возможность использования потока, если это означает, что прогресс может быть указан пользователю. Использование потока может улучшить отзывчивость приложения, но вы должны сбалансировать его с общей производительностью приложения.

Другой сценарий, в котором потоки могут быть полезны, это когда сообщение обрабатывается в нескольких службах. Если каждая служба в цепочке возвращает поток, то служба терминала (то есть последняя в цепочке) может начать возвращать сообщения. Эти сообщения могут быть обработаны и переданы обратно по цепочке исходительный запрашивает. Запрос может либо вернуть поток, либо агрегировать результаты в одно сообщение ответа. Такой подход хорошо поддается шаблонам, таким как MapReduce.

>[!div class="step-by-step"]
>[Предыдущий](migrate-duplex-services.md)
>[Следующий](client-libraries.md)
