---
title: Службы потоковой передачи и повторяющиеся поля — gRPC для разработчиков WCF
description: Сравните повторяющиеся поля со службами потоковой передачи, как и способы передачи коллекций данных с помощью gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 0e717df57ba2bb52d63a063072d8a45bf0f7e395
ms.sourcegitcommit: f38e527623883b92010cf4760246203073e12898
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77503375"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC Streaming Services и повторяющиеся поля

службы gRPC Services предоставляют два способа возврата наборов данных или списков объектов. Спецификация сообщения «протокол буферов» использует ключевое слово `repeated` для объявления списков или массивов сообщений в другом сообщении. Спецификация службы gRPC использует ключевое слово `stream` для объявления долго выполняющегося постоянного подключения. Через это подключение несколько сообщений отправляются и могут обрабатываться по отдельности. 

Можно также использовать функцию `stream` для длительных временных данных, таких как уведомления или сообщения журнала. Но в этой главе рассматривается использование для возврата одного набора данных.

Что следует использовать, зависит от следующих факторов:

- Общий размер набора данных.
- Время, затраченное на создание набора данных на стороне клиента или сервера.
- Может ли потребитель набора данных начать работу с ним, как только первый элемент станет доступен, или же необходим полный набор данных для выполнения каких-либо полезных действий.

## <a name="when-to-use-repeated-fields"></a>Использование `repeated` полей

Для любого набора данных, ограниченного размером и создаваемого в течение короткого времени (скажем, в течение одной секунды), следует использовать `repeated` поле в регулярном сообщении protobuf. Например, в системе электронной коммерции, чтобы создать список элементов в порядке, возможно, это быстро, и список не будет очень большим. Возврат одного сообщения с `repeated` полем — это порядок, который быстрее, чем использование `stream` и снижает нагрузку на сеть.

Если клиенту требуются все данные перед началом обработки, а набор данных достаточно мал для создания в памяти, рассмотрите возможность использования поля `repeated`. Рассмотрите его даже в том случае, если создание набора данных в памяти на сервере выполняется медленнее.

## <a name="when-to-use-stream-methods"></a>Использование методов `stream`

Если объекты сообщений в наборах данных потенциально очень велики, их лучше передавать с помощью потоковых запросов или ответов. Более эффективно создавать большие объекты в памяти, записывать его в сеть, а затем освобождать ресурсы. Такой подход повысит масштабируемость службы.

Аналогично, следует отсылать наборы данных неограниченного размера по потокам, чтобы избежать нехватки памяти при создании этих наборов.

Для наборов данных, где потребитель может отдельно обрабатывать каждый элемент, следует использовать поток, если это означает, что ход выполнения может быть указан пользователю. Использование потока может повысить скорость реагирования приложения, но следует сбалансировать его с общей производительностью приложения.

Другой случай, когда потоки могут быть полезными, — это место обработки сообщения в нескольких службах. Если каждая служба в цепочке возвращает поток, то служба терминалов (то есть последняя в цепочке) может начать возврат сообщений. Эти сообщения могут быть обработаны и переданы обратно в цепочку исходному запрашивающему. Запрашивающий может либо вернуть поток, либо выполнить статистическую обработку результатов в одно сообщение ответа. Этот подход хорошо подходит для таких шаблонов, как MapReduce.

>[!div class="step-by-step"]
>[Назад](migrate-duplex-services.md)
>[Вперед](client-libraries.md)
