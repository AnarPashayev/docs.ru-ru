---
title: Монолитные приложения
description: Сведения об основных понятиях для контейнеризации монолитных приложений.
ms.date: 02/15/2019
ms.openlocfilehash: 8664153ee2e9d1d253164e43ac13105f6dbf476c
ms.sourcegitcommit: 559259da2738a7b33a46c0130e51d336091c2097
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2019
ms.locfileid: "72771037"
---
# <a name="monolithic-applications"></a><span data-ttu-id="41958-103">Монолитные приложения</span><span class="sxs-lookup"><span data-stu-id="41958-103">Monolithic applications</span></span>

<span data-ttu-id="41958-104">В этом сценарии вы можете создать отдельное монолитное веб-приложение или службу и развернуть их как контейнер.</span><span class="sxs-lookup"><span data-stu-id="41958-104">In this scenario, you're building a single and monolithic web application or service and deploying it as a container.</span></span> <span data-ttu-id="41958-105">Это приложение может не иметь монолитную внутреннюю структуру и состоять из нескольких библиотек, компонентов или даже уровней (прикладной уровень, уровень домена, уровень доступа к данным и т. д.).</span><span class="sxs-lookup"><span data-stu-id="41958-105">Within the application, the structure might not be monolithic; it might comprise several libraries, components, or even layers (application layer, domain layer, data access layer, etc.).</span></span> <span data-ttu-id="41958-106">Внешне оно будет представлять собой единый контейнер — единый процесс, единое веб-приложение или единую службу.</span><span class="sxs-lookup"><span data-stu-id="41958-106">Externally, it's a single container, like a single process, single web application, or single service.</span></span>

<span data-ttu-id="41958-107">Для управления этой моделью вы развертываете один контейнер, представляющий собой приложение.</span><span class="sxs-lookup"><span data-stu-id="41958-107">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="41958-108">Для масштабирования просто добавьте дополнительные копии, расположив перед ними подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="41958-108">To scale it, just add a few more copies with a load balancer in front.</span></span> <span data-ttu-id="41958-109">Управлять одним развертыванием в одном контейнере или виртуальной машине гораздо проще.</span><span class="sxs-lookup"><span data-stu-id="41958-109">The simplicity comes from managing a single deployment in a single container or virtual machine (VM).</span></span>

<span data-ttu-id="41958-110">Такой монолитный шаблон может конфликтовать с принципом контейнера: "контейнер выполняет одну задачу и в одном процессе".</span><span class="sxs-lookup"><span data-stu-id="41958-110">Following the principal that a container does one thing only, and does it in one process, the monolithic pattern is in conflict.</span></span> <span data-ttu-id="41958-111">Вы можете включить в один контейнер несколько компонентов, библиотек или внутренних слоев, как показано на рис. 4-1.</span><span class="sxs-lookup"><span data-stu-id="41958-111">You can include multiple components/libraries or internal layers within each container, as illustrated in Figure 4-1.</span></span>

![Схема, показывающая монолитное приложение, которое масштабируется путем клонирования приложения.](./media/monolithic-applications/monolithic-application-architecture-example.png)

<span data-ttu-id="41958-113">**Рис. 4-1.**</span><span class="sxs-lookup"><span data-stu-id="41958-113">**Figure 4-1.**</span></span> <span data-ttu-id="41958-114">Пример архитектуры монолитного приложения</span><span class="sxs-lookup"><span data-stu-id="41958-114">An example of monolithic application architecture</span></span>

<span data-ttu-id="41958-115">Все функции монолитного приложения или основная их часть сосредоточены в одном процессе или контейнере, который разбивается на внутренние слои или библиотеки.</span><span class="sxs-lookup"><span data-stu-id="41958-115">A monolithic app has all or most of its functionality within a single process or container and it's componentized in internal layers or libraries.</span></span> <span data-ttu-id="41958-116">Недостаток этого подхода становится очевидным, когда приложение разрастается и его необходимо масштабировать.</span><span class="sxs-lookup"><span data-stu-id="41958-116">The downside to this approach comes if or when the application grows, requiring it to scale.</span></span> <span data-ttu-id="41958-117">Если масштабируется приложение целиком, все получится.</span><span class="sxs-lookup"><span data-stu-id="41958-117">If the entire application scaled, it's not really a problem.</span></span> <span data-ttu-id="41958-118">Но в большинстве случаев необходимо масштабировать лишь некоторые части приложения, пока другие компоненты работают нормально.</span><span class="sxs-lookup"><span data-stu-id="41958-118">However, in most cases, a few parts of the application are the choke points that require scaling, whereas other components are used less.</span></span>

<span data-ttu-id="41958-119">В примере приложения для электронной торговли, вероятнее всего, потребуется масштабирование компонента со сведениями о товарах.</span><span class="sxs-lookup"><span data-stu-id="41958-119">Using the typical e-commerce example, what you likely need is to scale the product information component.</span></span> <span data-ttu-id="41958-120">Клиенты чаще просматривают товары, чем приобретают их.</span><span class="sxs-lookup"><span data-stu-id="41958-120">Many more customers browse products than purchase them.</span></span> <span data-ttu-id="41958-121">Клиенты чаще складывают товары в корзину, чем оплачивают их.</span><span class="sxs-lookup"><span data-stu-id="41958-121">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="41958-122">Не так много клиентов пишут комментарии или просматривают историю покупок.</span><span class="sxs-lookup"><span data-stu-id="41958-122">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="41958-123">И у вас, скорее всего, может быть лишь несколько сотрудников в одном регионе, которые управляют содержимым и маркетинговыми кампаниями.</span><span class="sxs-lookup"><span data-stu-id="41958-123">And you likely have only a handful of employees, in a single region, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="41958-124">При масштабировании монолитных решений весь код развертывается многократно.</span><span class="sxs-lookup"><span data-stu-id="41958-124">By scaling the monolithic design, all of the code is deployed multiple times.</span></span>

<span data-ttu-id="41958-125">Помимо того, что необходимо масштабировать все компоненты, изменения в одном компоненте требуют полного повторного тестирования всего приложения и полного повторного развертывания всех его экземпляров.</span><span class="sxs-lookup"><span data-stu-id="41958-125">In addition to the "scale-everything" problem, changes to a single component require complete retesting of the entire application as well as a complete redeployment of all the instances.</span></span>

<span data-ttu-id="41958-126">Монолитный подход нашел широкое распространение и используется многими организациями при разработке архитектуры.</span><span class="sxs-lookup"><span data-stu-id="41958-126">The monolithic approach is common, and many organizations are developing with this architectural method.</span></span> <span data-ttu-id="41958-127">Во многих случаях это позволяет добиться желаемых результатов, но иногда организация сталкивается с ограничениями.</span><span class="sxs-lookup"><span data-stu-id="41958-127">Many enjoy good enough results, whereas others encounter limits.</span></span> <span data-ttu-id="41958-128">Во многих организациях приложения строились по такой модели, так как несколько лет назад с помощью существующих инструментов и инфраструктуры слишком сложно было создавать архитектуры SOA, и проблем не возникало, пока приложение не начинало разрастаться.</span><span class="sxs-lookup"><span data-stu-id="41958-128">Many designed their applications in this model because the tools and infrastructure were too difficult to build SOAs, and they didn't see the need—until the app grew.</span></span>

<span data-ttu-id="41958-129">С точки зрения инфраструктуры, каждый сервер может выполнять множество приложений в одном узле и применять допустимое соотношение эффективности использования ресурсов, как показано на рисунке 4-2.</span><span class="sxs-lookup"><span data-stu-id="41958-129">From an infrastructure perspective, each server can run many applications within the same host and have an acceptable ratio of efficiency in your resources usage, as shown in Figure 4-2.</span></span>

![Схема, показывающая один узел с несколькими приложениями в отдельных контейнерах.](./media/monolithic-applications/host-with-multiple-apps-containers.png)

<span data-ttu-id="41958-131">**Рис. 4-2.**</span><span class="sxs-lookup"><span data-stu-id="41958-131">**Figure 4-2.**</span></span> <span data-ttu-id="41958-132">Узел, выполняющий несколько приложений/контейнеров</span><span class="sxs-lookup"><span data-stu-id="41958-132">A host running multiple apps/containers</span></span>

<span data-ttu-id="41958-133">Наконец, с точки зрения доступности монолитные приложения нужно развертывать целиком. Это означает, что если требуется выполнить *остановку и запуск*, в течение периода развертывания будут затронуты все функциональные возможности и все пользователи.</span><span class="sxs-lookup"><span data-stu-id="41958-133">Finally, from an availability perspective, monolithic applications must be deployed as a whole; that means that in case you must *stop and start*, all functionality and all users will be affected during the deployment window.</span></span> <span data-ttu-id="41958-134">В некоторых случаях использование Azure и контейнеров позволяет свести эти ситуации к минимуму, а также снизить вероятность простоя приложения, как показано на рисунке 4-3.</span><span class="sxs-lookup"><span data-stu-id="41958-134">In certain situations, the use of Azure and containers can minimize these situations and reduce the probability of downtime of your application, as you can see in Figure 4-3.</span></span>

<span data-ttu-id="41958-135">Монолитные приложения можно развернуть в Azure с помощью выделенных виртуальных машин для каждого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="41958-135">You can deploy monolithic applications in Azure by using dedicated VMs for each instance.</span></span> <span data-ttu-id="41958-136">С помощью [масштабируемых наборов виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/) можно легко масштабировать виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="41958-136">Using [Azure VM Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can scale the VMs easily.</span></span>

<span data-ttu-id="41958-137">[Службы приложений Azure](https://azure.microsoft.com/services/app-service/) также позволяют выполнять монолитные приложения и легко масштабировать экземпляры без управления виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="41958-137">You can also use [Azure App Services](https://azure.microsoft.com/services/app-service/) to run monolithic applications and easily scale instances without having to manage the VMs.</span></span> <span data-ttu-id="41958-138">Службы приложений Azure также могут выполнять отдельные экземпляры контейнеров Docker, упрощая развертывание.</span><span class="sxs-lookup"><span data-stu-id="41958-138">Azure App Services can run single instances of Docker containers, as well, simplifying the deployment.</span></span>

<span data-ttu-id="41958-139">Вы можете развернуть несколько виртуальных машин в качестве узлов Docker и запустить любое количество контейнеров на виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="41958-139">You can deploy multiple VMs as Docker hosts and run any number of containers per VM.</span></span> <span data-ttu-id="41958-140">Затем с помощью Azure Load Balancer вы можете управлять масштабированием, как показано на рисунке 4-3.</span><span class="sxs-lookup"><span data-stu-id="41958-140">Then, by using an Azure Load Balancer, as illustrated in the Figure 4-3, you can manage scaling.</span></span>

![Схема, показывающая монолитное приложение, масштабируемое на разные узлы.](./media/monolithic-applications/multiple-hosts-from-single-docker-container.png)

<span data-ttu-id="41958-142">**Рис. 4-3**.</span><span class="sxs-lookup"><span data-stu-id="41958-142">**Figure 4-3**.</span></span> <span data-ttu-id="41958-143">Масштабирование одного приложения Docker с использованием нескольких узлов</span><span class="sxs-lookup"><span data-stu-id="41958-143">Multiple hosts scaling out a single Docker application</span></span>

<span data-ttu-id="41958-144">Развертыванием самих узлов можно управлять с помощью традиционных методов развертывания.</span><span class="sxs-lookup"><span data-stu-id="41958-144">You can manage the deployment of the hosts themselves via traditional deployment techniques.</span></span>

<span data-ttu-id="41958-145">Вы можете управлять контейнерами Docker из командной строки с помощью таких команд, как `docker run` и `docker-compose up`, а также автоматизировать эту процедуру с помощью конвейеров непрерывной поставки (CD) и, например, выполнить развертывание на узлах Docker из Azure DevOps Services.</span><span class="sxs-lookup"><span data-stu-id="41958-145">You can manage Docker containers from the command line by using commands like `docker run` and `docker-compose up`, and you can also automate it in Continuous Delivery (CD) pipelines and deploy to Docker hosts from Azure DevOps Services, for instance.</span></span>

## <a name="monolithic-application-deployed-as-a-container"></a><span data-ttu-id="41958-146">Развертывание монолитного приложения в контейнере</span><span class="sxs-lookup"><span data-stu-id="41958-146">Monolithic application deployed as a container</span></span>

<span data-ttu-id="41958-147">Использование контейнеров для управления монолитными развертываниями имеет свои преимущества.</span><span class="sxs-lookup"><span data-stu-id="41958-147">There are benefits to using containers to manage monolithic deployments.</span></span> <span data-ttu-id="41958-148">Масштабировать экземпляры контейнера гораздо быстрее и проще, чем развертывать дополнительные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="41958-148">Scaling the instances of containers is far faster and easier than deploying additional VMs.</span></span>

<span data-ttu-id="41958-149">Развертывание обновлений в виде образов Docker выполняется гораздо быстрее и эффективнее с точки зрения использования сети.</span><span class="sxs-lookup"><span data-stu-id="41958-149">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="41958-150">Контейнеры Docker обычно запускаются за считаные секунды, что ускоряет выпуск.</span><span class="sxs-lookup"><span data-stu-id="41958-150">Docker containers typically start in seconds, speeding rollouts.</span></span> <span data-ttu-id="41958-151">Демонтировать контейнер Docker можно с помощью команды `docker stop`, и обычно для этого требуется меньше секунды.</span><span class="sxs-lookup"><span data-stu-id="41958-151">Tearing down a Docker container is as easy as invoking the `docker stop` command, typically completing in less than a second.</span></span>

<span data-ttu-id="41958-152">Так как контейнеры по своей природе являются неизменяемыми, вам не придется беспокоиться о возможности повреждения виртуальной машины, когда сценарии обновления не учитывают некоторые оставшиеся на диске конфигурации или файлы.</span><span class="sxs-lookup"><span data-stu-id="41958-152">Because containers are inherently immutable, by design, you never need to worry about corrupted VMs because an update script forgot to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="41958-153">Docker имеет много плюсов для монолитных приложений, и мы лишь слегка затрагиваем эту тему.</span><span class="sxs-lookup"><span data-stu-id="41958-153">Although monolithic apps can benefit from Docker, we're touching on only the tips of the benefits.</span></span> <span data-ttu-id="41958-154">Более обширные возможности при управлении контейнерами открываются благодаря развертыванию с помощью оркестраторов контейнеров, которые управляют различными экземплярами и жизненным циклом каждого экземпляра контейнера.</span><span class="sxs-lookup"><span data-stu-id="41958-154">The larger benefits of managing containers come from deploying with container orchestrators that manage the various instances and life cycle of each container instance.</span></span> <span data-ttu-id="41958-155">Когда вы разбиваете монолитное приложение на подсистемы, которые затем можно масштабировать, разрабатывать и развертывать по отдельности, вы переходите на уровень микрослужб.</span><span class="sxs-lookup"><span data-stu-id="41958-155">Breaking up the monolithic application into subsystems that can be scaled, developed, and deployed individually is your entry point into the realm of microservices.</span></span>

<span data-ttu-id="41958-156">Дополнительные сведения о том, как выполнить процедуру "lift-and-shift" для монолитных приложений с использованием контейнеров и модернизировать приложения, см. в дополнительном руководстве Майкрософт [Модернизация существующих приложений .NET с помощью облака Azure и контейнеров Windows](../../modernize-with-azure-containers/index.md), которое можно скачать в формате PDF по адресу <https://aka.ms/LiftAndShiftWithContainersEbook>.</span><span class="sxs-lookup"><span data-stu-id="41958-156">To learn about how to “lift and shift” monolithic applications with containers and how you can modernize your applications, you can read this additional Microsoft guide, [Modernize existing .NET applications with Azure cloud and Windows Containers](../../modernize-with-azure-containers/index.md), which you can also download as PDF from <https://aka.ms/LiftAndShiftWithContainersEbook>.</span></span>

## <a name="publish-a-single-docker-container-app-to-azure-app-service"></a><span data-ttu-id="41958-157">Публикация отдельного приложения на основе контейнера Docker в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="41958-157">Publish a single Docker container app to Azure App Service</span></span>

<span data-ttu-id="41958-158">Когда вы хотите быстро проверить контейнер, развернутый в Azure, или когда приложение основано на одном контейнере, вы можете воспользоваться удобной функцией предоставления масштабируемых служб на основе одного контейнера в службах приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="41958-158">Either because you want to get a quick validation of a container deployed to Azure or because the app is simply a single-container app, Azure App Services provides a great way to provide scalable single-container services.</span></span>

<span data-ttu-id="41958-159">Она интуитивно понятна и прекрасно интегрируется с Git, что ускоряет работу, так как вы можете взять свой код, выполнить его сборку в Visual Studio и развернуть его прямо в Azure.</span><span class="sxs-lookup"><span data-stu-id="41958-159">Using Azure App Service is intuitive and you can get up and running quickly because it provides great Git integration to take your code, build it in Microsoft Visual Studio, and directly deploy it to Azure.</span></span> <span data-ttu-id="41958-160">В обычном случае (без Docker), если вам требовались другие возможности, платформы или зависимости, не поддерживаемые в службах приложений, вам потребовалось бы подождать, пока команда разработчиков Azure не обновит эти зависимости в службе приложений, либо переключиться на другие службы, например Service Fabric, облачные службы или даже обычные виртуальные машины, где вы можете полнее контролировать процесс и установить необходимый компонент или необходимую платформу для своего приложения.</span><span class="sxs-lookup"><span data-stu-id="41958-160">But, traditionally (with no Docker), if you needed other capabilities, frameworks, or dependencies that aren't supported in App Services, you needed to wait for it until the Azure team updates those dependencies in App Service or switched to other services like Service Fabric, Cloud Services, or even plain VMs, for which you have further control and can install a required component or framework for your application.</span></span>

<span data-ttu-id="41958-161">Как показано на рис. 4-4, при использовании Visual Studio 2017 поддержка контейнеров в службе приложений Azure позволяет включать в среду приложения любые компоненты.</span><span class="sxs-lookup"><span data-stu-id="41958-161">Now, as shown in Figure 4-4, when using Visual Studio 2017, container support in Azure App Service gives you the ability to include whatever you want in your app environment.</span></span> <span data-ttu-id="41958-162">Если вы добавили зависимость в приложение, то поскольку оно выполняется в контейнере, вы можете включить такие зависимости в Dockerfile или образ Docker.</span><span class="sxs-lookup"><span data-stu-id="41958-162">If you added a dependency to your app, because you're running it in a container, you get the capability of including those dependencies in your Dockerfile or Docker image.</span></span>

![Снимок экрана: диалоговое окно создания Службы приложений, в котором отображается Реестр контейнеров](./media/monolithic-applications/publish-azure-app-service-container.png)

<span data-ttu-id="41958-164">**Рис. 4-4**.</span><span class="sxs-lookup"><span data-stu-id="41958-164">**Figure 4-4**.</span></span> <span data-ttu-id="41958-165">Публикация контейнера в службе приложений из приложений/контейнеров Visual Studio</span><span class="sxs-lookup"><span data-stu-id="41958-165">Publishing a container to Azure App Service from Visual Studio apps/containers</span></span>

<span data-ttu-id="41958-166">На рис. 4-4 также указано, что поток публикации отправляет образ через реестр контейнеров. Это может быть Реестр контейнеров Azure (реестр, близкий к вашим развертываниям в Azure и защищенный группами и учетными записями в Azure Active Directory) или другой реестр Docker, например Docker Hub или локальные реестры.</span><span class="sxs-lookup"><span data-stu-id="41958-166">Figure 4-4 also shows that the publish flow pushes an image through a Container Registry, which can be the Azure Container Registry (a registry near to your deployments in Azure and secured by Azure Active Directory groups and accounts) or any other Docker Registry like Docker Hub or on-premises registries.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="41958-167">[Назад](common-container-design-principles.md)
>[Вперед](state-and-data-in-docker-applications.md)</span><span class="sxs-lookup"><span data-stu-id="41958-167">[Previous](common-container-design-principles.md)
[Next](state-and-data-in-docker-applications.md)</span></span>
