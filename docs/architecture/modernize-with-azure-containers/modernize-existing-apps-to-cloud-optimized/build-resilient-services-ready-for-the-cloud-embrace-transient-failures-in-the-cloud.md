---
title: Создание отказоустойчивых служб, готовых для облака. адаптация к временным сбоям в облаке
description: Модернизировать существующих приложений .NET с помощью Azure Cloud and Windows Containers | Создание отказоустойчивых служб, готовых для облака. адаптация к временным сбоям в облаке
ms.date: 04/30/2018
ms.openlocfilehash: e6fae8140b55cb0308dca9f4b77e961501b41f8f
ms.sourcegitcommit: 22be09204266253d45ece46f51cc6f080f2b3fd6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/07/2019
ms.locfileid: "73739391"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a>Создание отказоустойчивых служб, готовых к работе в облаке: принятие временных сбоев в облаке

Устойчивость — это возможность восстановления после сбоев и продолжение работы. Устойчивость не сводится к предотвращению сбоев, но принимает тот факт, что произойдет сбой, и затем отреагировать на них таким образом, чтобы избежать простоя или потери данных. Цель устойчивости — вернуть приложение в полностью функционирующее состояние после сбоя.

Приложение готово к работе в облаке, когда, как минимум, оно реализует программную модель устойчивости, а не модель на основе оборудования. Облачное приложение должно принять в себя частичные сбои, которые, безусловно, будут выполняться. Создайте или частично выполните рефакторинг приложения, чтобы добиться устойчивости с ожидаемыми частичными сбоями. Она должна быть разработана для работы с частичными сбоями, такими как временные сбои сети, узлы или сбои виртуальных машин в облаке. Даже контейнеры, перемещаемые в другой узел в кластере Orchestrator, могут вызвать периодические кратковременные сбои в приложении.

## <a name="handling-partial-failure"></a>Обработка частичного сбоя

В облачном приложении существует риск частичного сбоя. Например, один экземпляр веб-сайта или контейнер может завершиться ошибкой или в течение короткого времени может быть недоступен или не отвечает. Или может произойти сбой одной виртуальной машины или сервера.

Поскольку клиенты и службы являются отдельными процессами, служба не может своевременно отвечать на запросы клиента. Служба может быть перегружена и медленнее реагировать на запросы, или она может быть недоступна в течение короткого промежутка времени из-за проблем с сетью.

Например, рассмотрим монолитное приложение .NET, которое обращается к базе данных в базе данных SQL Azure. Если база данных SQL Azure или любая другая служба стороннего производителя не отвечает на короткое время (база данных SQL Azure может быть перемещена на другой узел или сервер, не отвечают на несколько секунд), то при попытке пользователя выполнить какое-либо действие приложение может завершиться сбоем и попытаться в то же время исключение.

Подобный сценарий может возникать в приложении, использующем службы HTTP. Сеть или сама служба могут быть недоступны в облаке во время короткого временного сбоя.

Устойчивое приложение, как показано на рисунке 4-9, должно реализовать такие приемы, как "повторные попытки с экспоненциальной задержкой", чтобы дать приложению возможность управлять временными сбоями в ресурсах. В приложениях также следует использовать "автоматическое разбиение". Автоматическое выключение прекращает попытки приложения получить доступ к ресурсу, когда на самом деле происходит долгосрочный сбой. С помощью автоматического выключения приложение позволяет избежать заставляющегоия отказа в обслуживании.

![Диаграмма частичных сбоев, обрабатываемых повторными попытками с экспоненциальной задержкой.](./media/build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud/retry-partial-failures.png)

**Рис. 4-9.** Частичные сбои, обрабатываемые повторами с экспоненциальной задержкой

Эти методы можно использовать как в ресурсах HTTP, так и в ресурсах базы данных. На рис. 4-9 приложение основано на трехуровневой архитектуре, поэтому эти методы необходимы на уровне служб (HTTP) и на уровне данных (TCP). В монолитном приложении, которое использует только один уровень приложения в дополнение к базе данных (без дополнительных служб или микрослужб), обработка временных сбоев на уровне подключения к базе данных может быть достаточной. В этом сценарии требуется только определенная конфигурация подключения к базе данных.

При реализации отказоустойчивых соединений, обращающихся к базе данных, в зависимости от используемой версии .NET, она может быть простой (например, [с Entity Framework 6 или более поздней версии](/ef/ef6/fundamentals/connection-resiliency/retry-logic)). Это просто вопрос настройки подключения к базе данных. Также может потребоваться использовать дополнительные библиотеки, такие как [блок приложения для обработки временной ошибки](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (для более ранних версий .NET), или даже реализовать собственную библиотеку.

При реализации повторных попыток HTTP и отключений следует использовать библиотеку [Polly](https://github.com/App-vNext/Polly) , которая предназначена для .NET Framework 4,0, .NET Framework 4,5 и .NET Standard 1,1, которая включает поддержку .NET Core.

Чтобы узнать, как реализовать стратегии по обработке частичных сбоев в облаке, ознакомьтесь со следующими ссылками.

### <a name="additional-resources"></a>Дополнительные ресурсы

- **Реализация отказоустойчивого взаимодействия для выполнения частичного сбоя**

    [https://docs.microsoft.com/dotnet/architecture/microservices/implement-resilient-applications/partial-failure-strategies](../../microservices/implement-resilient-applications/partial-failure-strategies.md)

- **Отказоустойчивость подключения Entity Framework и логика повторных попыток (версия 6 и более поздние)**

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- **Блок приложения обработки временной ошибки**

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- **Библиотека Polly для устойчивого обмена данными по протоколу HTTP**

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
>[Назад](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Вперед](modernize-your-apps-with-monitoring-and-telemetry.md)
