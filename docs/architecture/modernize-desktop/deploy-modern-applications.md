---
title: Развертывание современных классических приложений
description: Все, что необходимо знать о развертывании современных настольных приложений.
ms.date: 05/12/2020
ms.openlocfilehash: ba47f09b27adf270734bbfff285fe44dd4175d29
ms.sourcegitcommit: 632818f4b527e5bf3c48fc04e0c7f3b4bdb8a248
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98615858"
---
# <a name="deploying-modern-desktop-applications"></a>Развертывание современных классических приложений

При разработке классических приложений необходимо учитывать, как ваше приложение будет упаковываться и развертываться на компьютерах пользователей. Проблема, связанная с упаковкой, развертыванием и установкой, заключается в том, что она обычно находится под кодовым знаком ИТ-специалистов, ответственных за различные вещи, чем разработчики.

В эти дни мы знакомы с концепцией DevOps, где разработчики и ИТ-специалисты тесно взаимодействуют с переносом приложений в свои рабочие среды. Но если вы находились на рабочем столе более 10 лет, вы могли увидеть следующую историю. Группа разработчиков работает вместе, чтобы соответствовать крайним срокам проекта. Бизнес-люди нервной, так как им требуется система, работающая на многих компьютерах пользователей для запуска компании. В «D-день» менеджер по проектам проверяет, правильно ли работает свой код, и все ли они могут поставляться. Затем группа пакетов создает программу установки для приложения, распространяет ее на каждый компьютер пользователя и набор тестовых пользователей, запускающих приложение. Кроме того, они пытаются, поскольку перед отображением любого пользовательского интерфейса приложение создает исключение с сообщением "метод ~ объекта ~ сбой". Тревога начинает поступать через воздушный цикл и короткое исследование указывает на неприятного и неприятного разработчика, который представил сторонний элемент управления, который определенно «работал на компьютере разработки».

Установка классических приложений традиционно была настоящим кошмаром по двум основным причинам:

- Отсутствие закрытого языка и региональных параметров для совместной работы между разработчиками и ИТ.
- Отсутствие сплошной технологии упаковки и развертывания, которую мы можем создать.

На самом деле мы работаем с тем, что иногда вы установили приложение, так как:

- На вашем компьютере есть нежелательные побочные эффекты.
- Некоторые приложения, которые были ранее установлены, перестают работать.

Кроме того, невозможно просто восстановить систему в исходное состояние путем удаления приложения. Мы используем для этого ситуацию, в которой мы ввели такие термины, как "DLL Hell" или "Винрот".

В этой главе мы поговорим о MSIX. MSIX — это новая технология от корпорации Майкрософт, которая пытается захватить лучшие из предыдущих технологий, чтобы обеспечить надежную основу для технологии упаковки будущего.

Что делает пакетную технологию с помощью модернизации? И оказалось, что эта упаковка является фундаментальной для предприятия ИТ с большим количеством денег. Модернизации не только использует новейшие технологии. Кроме того, это связано с сокращением времени до рынка с момента определения бизнес-требования до тех пор, пока ваша компания не доставляет эту функцию клиенту.

## <a name="the-modern-application-lifecycle"></a>Современный жизненный цикл приложения

Сегодня разработчики пишут и создают код для приложения, а затем передают созданные ресурсы ИТ-специалистам. Затем ИТ-специалисты перестраивают приложение и повторно упаковывают его, как правило, в MSI или в недавно в формате упаковки App-V. Затем приложение развертывается с помощью различных каналов и средств. Одна из основных проблем такого подхода обычно называется "упаковкой паралисис". Проблема заключается в том, что этот цикл повторяется каждый раз при обновлении приложения или обновлении операционной системы.

Процесс отображается на следующем рисунке:

![Схема, показывающая современный жизненный цикл ИТ](./media/deploy-modern-applications/modern-it-application-lifecycle.png)

Компаниям требуется способ разбить этот цикл упаковки на три независимых цикла:

- Обновления ОС
- Обновления приложений
- Настройка

![Схема, показывающая современный цикл ИТ тем самым эффективный](./media/deploy-modern-applications/modern-it-virtuous-cycle.png)

На предыдущей схеме показано, что можно:

- Обновление базовой ОС без необходимости переупаковки приложений.
- Включение настроек из него без необходимости переупаковки исходного пакета разработчика.

Это коренное изменение приводит нас к новому и современному жизненному циклу ИТ, как показано на следующем рисунке:

![Схема, показывающая жизненный цикл приложения с помощью средств Майкрософт](./media/deploy-modern-applications/microsoft-it-tools.png)

Разработчики создают приложение и создают пакет MSIX, который ИТ-специалисты могут использовать и настраивать без необходимости переупаковки. Вместе с технологией MSIX Корпорация Майкрософт создала средства, позволяющие настраивать и настраивать пакеты без переупаковки.

## <a name="msix-the-next-generation-of-deployment"></a>MSIX: следующее поколение развертывания

Прежде чем MSIX, доступны несколько технологий упаковки, таких как мастера установки, MSI, ClickOnce, App-V и сценарии. Каждая из этих технологий имеет свои сильные стороны, и корпорация Майкрософт решила выбрать наилучшие из них для создания MSIX. MSIX основан на основах этих существующих технологий, которые наилучшим образом подходят для каждого из них:

- App-V = \> контейнер
- ClickOnce = \> Автоматическое обновление
- MSI = \> легко распространяемый

С помощью MSIX вы получаете одну технологию установки со всеми этими функциями.

![Схема, на которой показаны различные технологии, которые оказывают влияние на создание MSIX](./media/deploy-modern-applications/msix.png)

### <a name="benefits-of-msix"></a>Преимущества MSIX

#### <a name="never-regret-installing-an-app"></a>Никогда не устанавливать приложение

MSIX обеспечивает предсказуемое, надежное и безопасное развертывание. Декларативный метод, содержащийся в манифесте пакета, позволяет операционной системе вести отслеживание каждого ресурса, необходимого приложению. Он также предоставляет истинное удаление без побочных эффектов.

#### <a name="disk-space-optimization"></a>Оптимизация дискового пространства

MSIX оптимизирована для уменьшения места, занимаемого приложением на диске компьютера пользователя. Он создает хранилище файлов одного экземпляра. То есть, если у вас есть два разных пакета с одной и той же библиотекой DLL, Библиотека DLL не устанавливается дважды. Платформа отвечает за эту проблему, поскольку она знает все файлы, установленные определенным приложением, благодаря его декларативной природе. Она также позволяет использовать разные версии DLL-библиотеки для параллельной работы.

С помощью пакетов ресурсов можно легко создавать многоязычные приложения, а операционная система — устанавливать используемые.

#### <a name="network-optimization"></a>Оптимизация сети

MSIX определяет различия в файлах на уровне блока Byte, позволяя использовать функцию разностного обновления. Это означает, что в обновлениях приложения загружаются только обновленные блоки байтов.

![Схема, показывающая, как MSIX управляет разностными обновлениями](./media/deploy-modern-applications/msix-managing-updates.png)

С помощью потоковой установки пользователь может быстро начать работу над приложением, а другие части приложения — в фоновом режиме. Эта функция влияет на работу пользователей.

С помощью необязательных пакетов вы можете реализовать компоненты для развертывания приложения, чтобы при необходимости скачать их.

#### <a name="simple-packaging-and-deployment"></a>Простая упаковка и развертывание

Идентификатор AppManifest объявляет управление версиями, нацеливание устройств и выявляет их стандартным образом для каждого приложения. Он также позволяет подписывать активы, предоставляющие надежную систему безопасности.

#### <a name="os-managed"></a>Управляемая ОС

Операционная система обрабатывает все процессы для установки, обновления и удаления приложения. Приложения устанавливаются на пользователя, но загружаются только один раз, что сводит к минимуму объем дискового пространства. Корпорация Майкрософт работает над предоставлением MSIX и Windows 7.

#### <a name="windows-provides-integrity-for-the-app"></a>Windows обеспечивает целостность приложения

С помощью цифровых подписей можно гарантировать, что вы не устанавливаете приложение из ненадежных источников. MSIX также предотвращает незаконное изменение, поскольку:

- Он хранит записи о хэшейх файлов.
- Он определяет, был ли файл изменен после установки.

#### <a name="works-for-the-entire-app-catalog"></a>Работает для всего каталога приложений

Одно из самых интересных вещей о MSIX заключается в том, что он работает для всего каталога приложений, Windows Forms, WPF, MFC/ATL, Delphi, даже если вы хотите выполнить развертывание с помощью xCopy, ClickOnce или перейти в магазин, вы можете использовать тот же пакет MSIX.

### <a name="tools"></a>Инструменты

#### <a name="windows-application-packaging-project"></a>Проект упаковки приложений Windows

Для создания пакета для классического приложения в Visual Studio можно использовать **Проект упаковки приложений Windows**. Затем можно опубликовать этот пакет на Microsoft Store или загружать неопубликованные его на один или несколько компьютеров.

#### <a name="msix-packaging-tool"></a>Средство упаковки MSIX

Средство упаковки MSIX позволяет повторно упаковывать существующие пакеты приложений Win32 в формате MSIX. Он предоставляет интерактивный пользовательский интерфейс и командную строку для преобразований и позволяет преобразовать приложение без исходного кода.

![Средство упаковки MSIX](./media/deploy-modern-applications/msix-packaging-tool.png)

#### <a name="package-support-framework"></a>Платформа поддержки пакетов

Платформа поддержки пакетов — это набор с открытым исходным кодом, который помогает применять исправления к существующему приложению Win32, если у вас нет доступа к исходному коду, чтобы он мог работать в контейнере MSIX. Платформа поддержки пакетов помогает настроить приложения в соответствии с требованиями современных сред выполнения.

#### <a name="app-installer"></a>Установщик приложений

Установщик приложений позволяет устанавливать приложения Windows 10, дважды щелкнув пакет приложения. Это означает, что пользователям не нужно использовать PowerShell или другие средства разработки для развертывания приложений Windows 10. Кроме того, Установщик приложений может устанавливать приложения из Интернета, дополнительных пакетов и связанных наборов.

## <a name="how-to-create-an-msix-package-from-an-existing-win32-desktop-application"></a>Создание пакета MSIX из существующего классического приложения Win32

Давайте проверим процесс создания пакета MSIX из существующего приложения Win32. В этом примере мы будем использовать приложение Windows Forms.

Чтобы начать, добавьте в решение новый проект, выберите проект упаковки приложений Windows и присвойте ему имя.

![Добавление нового проекта упаковки приложений Windows](./media/deploy-modern-applications/add-packaging-project.png)

Вы увидите структуру проекта упаковки и заметите специальную папку с именем *Applications*. В этой папке можно указать приложения, которые необходимо включить в пакет. Может быть больше одного.

![Структура проекта упаковки](./media/deploy-modern-applications/packaging-project.png)

Щелкните правой кнопкой мыши папку *приложения* и выберите проект Windows Forms, который требуется упаковать из решения Visual Studio.

![Добавление Windows Forms проекта в проект упаковки](./media/deploy-modern-applications/add-winforms-project.png)

На этом этапе можно скомпилировать и создать пакет, но давайте рассмотрим несколько вещей. Чтобы улучшить взаимодействие с пользователем, Visual Studio может автоматически создавать все визуальные ресурсы, необходимые современным приложениям для управления значками и мозаичными ресурсами для панели плиток и меню "Пуск". Откройте файл *Package. appxmanifest* для доступа к конструктору манифестов. Затем можно создать все визуальные ресурсы из данного образа, присутствующего в проекте, просто нажав кнопку **создать**.

![Снимок экрана конструктора манифеста в Visual Studio](./media/deploy-modern-applications/manifest-designer.png)

Если открыть код для файла *Package. appxmanifest* , можно увидеть несколько интересных вещей.

Непосредственно под `<Package>` `<Identity>` узлом находится узел. Именно здесь упакованное приложение будет получать удостоверение, управляемое операционной системой.

![Узел удостоверений](./media/deploy-modern-applications/identity-node.png)

В `<Capabilities>` узле можно найти все требования, необходимые приложению, обращая особое внимание на `<rescap:Capability Name="runFullTrust" \>` , который сообщает операционной системе запустить приложение в режиме полного доверия, поскольку это приложение Win32.

![Узел capabilities](./media/deploy-modern-applications/capabilities-node.png)

Задайте проект упаковки в качестве запускаемого проекта для решения и выберите *выполнить*. Это будет следующим:

- Скомпилируйте приложение Windows Forms.
- Создание пакета MSIX из результатов сборки.
- Разверните пакеты.
- Установите его локально на компьютере разработки.
- запуск приложения;

![Установленное приложение](./media/deploy-modern-applications/our-installed-application.png)

Благодаря этому у вас есть чистая процедура установки и удаления, которая MSIX полностью интегрирована в Windows 10.

Последним этапом является развертывание пакета MSIX на другом компьютере.

Щелкните проект упаковки правой кнопкой мыши, выберите меню **магазин** , а затем выберите параметр **создать пакеты приложений** .

Затем можно выбрать между созданием пакета для отправки в магазин или созданием пакетов для загрузки неопубликованных приложений. В большинстве модернизации сценариев вы решили **создать пакеты для загрузки неопубликованных приложений**.

![Настройка пакетов](./media/deploy-modern-applications/configuring-packages.png)

Здесь можно выбрать различные архитектуры, которые нужно использовать, так как в один и тот же пакет MSIX можно включить столько архитектур, сколько нужно.

Последним шагом является объявление того, где вы хотите развернуть окончательные ресурсы установки.

![Настройка параметров обновления](./media/deploy-modern-applications/configure-update-settings.png)

Вы можете выбрать использование веб-сервера с общим путем UNC на файловых серверах предприятия. Обратите особое внимание на параметры, чтобы указать способ обновления приложения. В следующем разделе будут рассмотрены обновления приложений.

Подробное пошаговое описание см. в разделе [Упаковка приложения для настольных компьютеров из исходного кода с помощью Visual Studio](/windows/msix/desktop/desktop-to-uwp-packaging-dot-net).

## <a name="auto-updates-in-msix"></a>Автоматическое обновление в MSIX

В магазине Windows есть отличный механизм обновления, использующий Центр обновления Windows. В большинстве корпоративных сценариев магазин не используется для распространения настольных приложений. Поэтому вам нужен аналогичный способ настройки обновлений для приложения и их извлечения пользователям.

Используя сочетание функций и пакетов MSIX для Windows 10, вы можете предоставить пользователям удобную процедуру обновления. На самом деле, пользователь не обязан быть техническим специалистом, но по-прежнему может воспользоваться преимуществами беспрепятственного обновления приложения.

Вы можете настроить обновление для взаимодействия с пользователем двумя разными способами:

- Обновления, запрошенные пользователем. в ОС отображается автоматически сформированный удобный пользовательский интерфейс для уведомления пользователя о том, что приложение собирается установить. Этот пользовательский интерфейс создается на основе свойств, указанных в файлах установки.

- Автоматическое обновление в фоновом режиме. В этом случае пользователям не нужно знать об обновлениях.

Также можно настроить время выполнения обновлений при запуске приложения или на регулярной основе. Благодаря функциям загрузки неопубликованных приложений эти обновления можно даже получить во время работы приложения.

При использовании этого типа развертывания создается специальный файл с именем *. appinstaller*. Этот простой файл содержит следующие разделы:

- Расположение файла *appinstaller*
- Основные свойства пакета MSIX приложения
- Поведение при обновлении

![файл. appinstaller](./media/deploy-modern-applications/appinstaller-file.png)

В сочетании с этим файлом Корпорация Майкрософт разработала специальный протокол URL-адресов для запуска процесса установки по ссылке:

```xml
<a href="ms-appinstaller:?source=http://mywebservice.azureedge.net/MyApp.msix">Install app package </a>
```

Этот протокол работает во всех браузерах и запускает процесс установки с большим удобством работы пользователя в Windows 10. Поскольку операционная система управляет процессом установки, она учитывает расположение, из которого было установлено это приложение, и отслеживает все файлы, затронутые процессом.

MSIX создает пользовательский интерфейс для автоматической установки, отображая некоторые свойства пакета. Это обеспечивает общий процесс установки для каждого приложения.

После создания нового пакета MSIX и его перемещения на сервер развертывания необходимо просто изменить *appinstaller* файл, чтобы отразить эти изменения, в основном это версия и путь к новому файлу MSIX. В следующий раз, когда пользователь запускает приложение, система будет обнаруживать изменения и скачивать файлы для новой версии в фоновом режиме. Когда это будет сделано, установка будет выполняться для нового запуска приложения прозрачно для пользователя.

>[!div class="step-by-step"]
>[Назад](example-migration.md)
