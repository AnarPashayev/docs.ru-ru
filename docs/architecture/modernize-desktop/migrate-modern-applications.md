---
title: Перенос современных настольных приложений
description: Все, что необходимо знать о процессе миграции для современных настольных приложений.
ms.date: 01/19/2021
ms.openlocfilehash: b5bea6e601dc040adfd8ed410320a3416cb3372e
ms.sourcegitcommit: 632818f4b527e5bf3c48fc04e0c7f3b4bdb8a248
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98615767"
---
# <a name="migrating-modern-desktop-applications"></a><span data-ttu-id="a1a99-103">Перенос современных настольных приложений</span><span class="sxs-lookup"><span data-stu-id="a1a99-103">Migrating Modern Desktop applications</span></span>

<span data-ttu-id="a1a99-104">В этой главе рассматриваются наиболее распространенные проблемы и проблемы, с которыми можно столкнуться при переносе существующего приложения из платформа .NET Framework в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-104">In this chapter, we're exploring the most common issues and challenges you can face when migrating an existing application from .NET Framework to .NET.</span></span>

<span data-ttu-id="a1a99-105">Сложное классическое приложение не работает в изоляции и требует какого-либо взаимодействия с подсистемами, которые могут находиться на локальном компьютере или на удаленном сервере.</span><span class="sxs-lookup"><span data-stu-id="a1a99-105">A complex desktop application doesn't work in isolation and needs some kind of interaction with subsystems that may reside on the local machine or on a remote server.</span></span> <span data-ttu-id="a1a99-106">Возможно, потребуется некоторый тип базы данных для подключения к хранилищу сохраняемости локально или удаленно.</span><span class="sxs-lookup"><span data-stu-id="a1a99-106">It will probably need some kind of database to connect as a persistence storage either locally or remotely.</span></span> <span data-ttu-id="a1a99-107">С порождением архитектур, ориентированных на Интернет и службы, обычно приложение подключается к некоторым службам, размещенным на удаленном сервере или в облаке.</span><span class="sxs-lookup"><span data-stu-id="a1a99-107">With the raise of Internet and service-oriented architectures, it's common to have your application connected to some sort of service residing on a remote server or in the cloud.</span></span> <span data-ttu-id="a1a99-108">Для реализации некоторой функциональности может потребоваться доступ к файловой системе компьютера.</span><span class="sxs-lookup"><span data-stu-id="a1a99-108">You may need to access the machine file system to implement some functionality.</span></span> <span data-ttu-id="a1a99-109">Кроме того, возможно, вы используете часть функциональных возможностей, находящихся внутри COM-объекта за пределами приложения, что является распространенным сценарием, например при интеграции сборок Office в приложение.</span><span class="sxs-lookup"><span data-stu-id="a1a99-109">Alternatively, maybe you're using a piece of functionality that resides inside a COM object outside your application, which is a common scenario if, for example, you're integrating Office assemblies in your app.</span></span>

<span data-ttu-id="a1a99-110">Кроме того, существуют различия в области API, предоставляемой платформа .NET Framework и .NET, а некоторые функции, доступные на платформа .NET Framework, недоступны в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-110">Besides, there are differences in the API surface that is exposed by .NET Framework and .NET, and some features that are available on .NET Framework aren't available on .NET.</span></span> <span data-ttu-id="a1a99-111">Поэтому важно понять и принять их при планировании миграции.</span><span class="sxs-lookup"><span data-stu-id="a1a99-111">So, it's important for you to know and take them into account when planning a migration.</span></span>

## <a name="configuration-files"></a><span data-ttu-id="a1a99-112">Файлы конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a1a99-112">Configuration files</span></span>

<span data-ttu-id="a1a99-113">Файлы конфигурации обеспечивают возможность хранения наборов свойств, которые считываются во время выполнения, и влияют на поведение наших приложений, например место расположения базы данных или количество выполнений цикла.</span><span class="sxs-lookup"><span data-stu-id="a1a99-113">Configuration files offer the possibility to store sets of properties that are read at run time and affect the behavior of our apps, such as where to locate a database or how many times to execute a loop.</span></span> <span data-ttu-id="a1a99-114">Преимуществом этой методики является то, что вы можете изменить некоторые аспекты приложения без необходимости Recode и повторной компиляции.</span><span class="sxs-lookup"><span data-stu-id="a1a99-114">The beauty of this technique is that you can modify some aspects of the application without the need to recode and recompile.</span></span> <span data-ttu-id="a1a99-115">Это удобно, когда, например, один и тот же код приложения выполняется в среде разработки с определенным набором значений конфигурации и в производстве с другим.</span><span class="sxs-lookup"><span data-stu-id="a1a99-115">This comes in handy when, for example, the same app code runs on a development environment with a certain set of configuration values and in production with a different one.</span></span>

### <a name="configuration-on-net-framework"></a><span data-ttu-id="a1a99-116">Конфигурация на платформа .NET Framework</span><span class="sxs-lookup"><span data-stu-id="a1a99-116">Configuration on .NET Framework</span></span>

<span data-ttu-id="a1a99-117">Если у вас есть рабочий платформа .NET Framework классическое приложение, скорее всего, у вас есть *app.configный* файл, к которому можно получить доступ с помощью <xref:System.Configuration.AppSettingsSection> класса из `System.Configuration` пространства имен.</span><span class="sxs-lookup"><span data-stu-id="a1a99-117">If you have a working .NET Framework desktop application, chances are you have an *app.config* file accessed through the <xref:System.Configuration.AppSettingsSection> class from the `System.Configuration` namespace.</span></span>

<span data-ttu-id="a1a99-118">В инфраструктуре платформа .NET Framework есть иерархия файлов конфигурации, которые наследуют свойства родительских элементов.</span><span class="sxs-lookup"><span data-stu-id="a1a99-118">Within the .NET Framework infrastructure, there's a hierarchy of configuration files that inherit properties from its parents.</span></span> <span data-ttu-id="a1a99-119">Можно найти файл *machine.config* , который определяет множество свойств и разделов конфигурации, которые можно использовать или переопределить в любом файле конфигурации потомков.</span><span class="sxs-lookup"><span data-stu-id="a1a99-119">You can find a *machine.config* file that defines many properties and configuration sections that can be used or overridden in any descendant configuration file.</span></span>

### <a name="configuration-on-net"></a><span data-ttu-id="a1a99-120">Настройка в .NET</span><span class="sxs-lookup"><span data-stu-id="a1a99-120">Configuration on .NET</span></span>

<span data-ttu-id="a1a99-121">В мире .NET нет *machine.configного* файла.</span><span class="sxs-lookup"><span data-stu-id="a1a99-121">In the .NET world, there's no *machine.config* file.</span></span> <span data-ttu-id="a1a99-122">Несмотря на то, что вы можете продолжать использовать старое <xref:System.Configuration> пространство имен, вы можете рассмотреть возможность перехода на современный <xref:Microsoft.Extensions.Configuration> , который предлагает хорошее количество улучшений.</span><span class="sxs-lookup"><span data-stu-id="a1a99-122">And even though you can continue to use the old fashioned <xref:System.Configuration> namespace, you may consider switching to the modern <xref:Microsoft.Extensions.Configuration>, which offers a good number of enhancements.</span></span>

<span data-ttu-id="a1a99-123">API конфигурации поддерживает концепцию поставщика конфигурации, который определяет источник данных, используемый для загрузки конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a1a99-123">The configuration API supports the concept of configuration provider, which defines the data source to be used to load the configuration.</span></span> <span data-ttu-id="a1a99-124">Существуют различные виды встроенных поставщиков, например:</span><span class="sxs-lookup"><span data-stu-id="a1a99-124">There are different kinds of built-in providers, such as:</span></span>

- <span data-ttu-id="a1a99-125">объектов .NET в памяти;</span><span class="sxs-lookup"><span data-stu-id="a1a99-125">In-memory .NET objects</span></span>
- <span data-ttu-id="a1a99-126">INI-файлы</span><span class="sxs-lookup"><span data-stu-id="a1a99-126">INI files</span></span>
- <span data-ttu-id="a1a99-127">файлы JSON;</span><span class="sxs-lookup"><span data-stu-id="a1a99-127">JSON files</span></span>
- <span data-ttu-id="a1a99-128">файлы XML.</span><span class="sxs-lookup"><span data-stu-id="a1a99-128">XML files</span></span>
- <span data-ttu-id="a1a99-129">Аргументы командной строки</span><span class="sxs-lookup"><span data-stu-id="a1a99-129">Command-line arguments</span></span>
- <span data-ttu-id="a1a99-130">Переменные среды</span><span class="sxs-lookup"><span data-stu-id="a1a99-130">Environment variables</span></span>
- <span data-ttu-id="a1a99-131">Зашифрованное хранилище пользователей</span><span class="sxs-lookup"><span data-stu-id="a1a99-131">Encrypted user store</span></span>

 <span data-ttu-id="a1a99-132">Вы также можете создать собственный.</span><span class="sxs-lookup"><span data-stu-id="a1a99-132">Or you can build your own.</span></span>

<span data-ttu-id="a1a99-133">Новая конфигурация позволяет получить список пар "имя-значение", которые могут быть сгруппированы в многоуровневую иерархию.</span><span class="sxs-lookup"><span data-stu-id="a1a99-133">The new configuration allows a list of name-value pairs that can be grouped into a multi-level hierarchy.</span></span> <span data-ttu-id="a1a99-134">Любое сохраненное значение сопоставляется со строкой, и существует встроенная поддержка привязки, позволяющая десериализовать параметры в пользовательском объекте Plain старого типа CLR (POCO).</span><span class="sxs-lookup"><span data-stu-id="a1a99-134">Any stored value maps to a string, and there's built-in binding support that allows you to deserialize settings into a custom plain old CLR object (POCO) object.</span></span>

<span data-ttu-id="a1a99-135"><xref:Microsoft.Extensions.Configuration.ConfigurationBuilder>Объект позволяет добавить столько поставщиков конфигурации, сколько может потребоваться для приложения, используя правило приоритета для разрешения предпочтений.</span><span class="sxs-lookup"><span data-stu-id="a1a99-135">The <xref:Microsoft.Extensions.Configuration.ConfigurationBuilder> object lets you add as many configuration providers you may need for your application, using a precedence rule to resolve preference.</span></span> <span data-ttu-id="a1a99-136">Таким образом, последний поставщик, добавленный в код, переопределит другие.</span><span class="sxs-lookup"><span data-stu-id="a1a99-136">So, the last provider you add in your code will override the others.</span></span> <span data-ttu-id="a1a99-137">Это отличная функция для управления различными средами, поскольку вы можете определить различные конфигурации для разработки, тестирования и рабочей среды, а также управлять ими с помощью одной функции внутри кода.</span><span class="sxs-lookup"><span data-stu-id="a1a99-137">This is a great feature for managing different environments for execution since you can define different configurations for development, testing and production environments, and manage them on a single function inside your code.</span></span>

### <a name="migrating-configuration-files"></a><span data-ttu-id="a1a99-138">Миграция файлов конфигурации</span><span class="sxs-lookup"><span data-stu-id="a1a99-138">Migrating Configuration files</span></span>

<span data-ttu-id="a1a99-139">Вы можете продолжить использовать существующий XML-файл app.config.</span><span class="sxs-lookup"><span data-stu-id="a1a99-139">You can continue to use your existing app.config XML file.</span></span> <span data-ttu-id="a1a99-140">Однако вы можете воспользоваться этой возможностью для переноса конфигурации, чтобы воспользоваться преимуществами некоторых усовершенствований, вносимых в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-140">However, you could take this opportunity to migrate your configuration to benefit from the several enhancements made on .NET.</span></span>

<span data-ttu-id="a1a99-141">Чтобы выполнить миграцию с *app.config* старого стиля на новый файл конфигурации, необходимо выбрать формат XML и формат JSON.</span><span class="sxs-lookup"><span data-stu-id="a1a99-141">To migrate from an old-style *app.config* to a new configuration file, you should choose between an XML format and a JSON format.</span></span>

<span data-ttu-id="a1a99-142">Если выбрать XML, преобразование будет простым.</span><span class="sxs-lookup"><span data-stu-id="a1a99-142">If you choose XML, the conversion is straightforward.</span></span> <span data-ttu-id="a1a99-143">Так как содержимое совпадает, просто сохраните файл *app.config* с типом XML.</span><span class="sxs-lookup"><span data-stu-id="a1a99-143">Since the content is the same, just save the *app.config* file with XML as type.</span></span> <span data-ttu-id="a1a99-144">Затем измените код, ссылающийся на AppSettings, для использования `ConfigurationBuilder` класса.</span><span class="sxs-lookup"><span data-stu-id="a1a99-144">Then, change the code that references AppSettings to use the `ConfigurationBuilder` class.</span></span> <span data-ttu-id="a1a99-145">Это изменение должно быть простым.</span><span class="sxs-lookup"><span data-stu-id="a1a99-145">This change should be easy.</span></span>

<span data-ttu-id="a1a99-146">Если вы хотите использовать формат JSON и вы не хотите выполнять миграцию вручную, есть средство [DotNet-config2json](https://www.nuget.org/packages/dotnet-config2json/) , доступное в .NET, которое может преобразовать файл *app.config* в файл конфигурации JSON.</span><span class="sxs-lookup"><span data-stu-id="a1a99-146">If you want to use a JSON format and you don't want to migrate by hand, there's a tool called [dotnet-config2json](https://www.nuget.org/packages/dotnet-config2json/) available on .NET that can convert an *app.config* file to a JSON configuration file.</span></span>

<span data-ttu-id="a1a99-147">Кроме того, при использовании разделов конфигурации, определенных в файле *machine.config* , могут возникнуть некоторые проблемы.</span><span class="sxs-lookup"><span data-stu-id="a1a99-147">You may also come across some issues when using configuration sections that were defined in the *machine.config* file.</span></span> <span data-ttu-id="a1a99-148">Например, рассмотрим следующую конфигурацию:</span><span class="sxs-lookup"><span data-stu-id="a1a99-148">For example, consider the following configuration:</span></span>

```xml
<configuration>
    <system.diagnostics>
        <switches>
            <add name="General" value="4" />
        </switches>
        <trace autoflush="true" indentsize="2">
            <listeners>
                <add name="myListener"
                     type="System.Diagnostics.TextWriterTraceListener,
                           System, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
                     initializeData="MyListener.log"
                     traceOutputOptions="ProcessId, LogicalOperationStack, Timestamp, ThreadId, Callstack, DateTime" />
            </listeners>
        </trace>
    </system.diagnostics>
</configuration>
```

<span data-ttu-id="a1a99-149">Если вы предпримете эту конфигурацию для .NET, вы получите исключение:</span><span class="sxs-lookup"><span data-stu-id="a1a99-149">If you take this configuration to a .NET, you'll get an exception:</span></span>

> <span data-ttu-id="a1a99-150">Нераспознанный раздел конфигурации система. Диагностика</span><span class="sxs-lookup"><span data-stu-id="a1a99-150">Unrecognized configuration section System.Diagnostics</span></span>

<span data-ttu-id="a1a99-151">Это исключение возникает, поскольку этот раздел и сборка, отвечающая за обработку этого раздела, определена в файле *machine.config* , который теперь не существует.</span><span class="sxs-lookup"><span data-stu-id="a1a99-151">This exception occurs because that section and the assembly responsible for handling that section was defined in the *machine.config* file, which now doesn't exist.</span></span>

<span data-ttu-id="a1a99-152">Чтобы легко устранить проблему, можно скопировать определение раздела из старого *machine.config* в новый файл конфигурации:</span><span class="sxs-lookup"><span data-stu-id="a1a99-152">To easily fix the issue, you can copy the section definition from your old *machine.config* to your new configuration file:</span></span>

```xml
<configSections>
    <section name="system.diagnostics"
             type="System.Diagnostics.SystemDiagnosticsSection,
                   System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
</configSections>
```

## <a name="accessing-databases"></a><span data-ttu-id="a1a99-153">Доступ к базам данных</span><span class="sxs-lookup"><span data-stu-id="a1a99-153">Accessing databases</span></span>

<span data-ttu-id="a1a99-154">Практически для всех настольных приложений требуется некоторый тип базы данных.</span><span class="sxs-lookup"><span data-stu-id="a1a99-154">Almost every desktop application needs some kind of database.</span></span> <span data-ttu-id="a1a99-155">Для настольных компьютеров часто можно найти архитектуру клиент-сервер с прямым подключением между классом Desktop и ядром СУБД.</span><span class="sxs-lookup"><span data-stu-id="a1a99-155">For desktop, it's common to find client-server architectures with a direct connection between the desktop app and the database engine.</span></span> <span data-ttu-id="a1a99-156">Эти базы данных могут быть локальными или удаленными в зависимости от необходимости обмена информацией между разными пользователями.</span><span class="sxs-lookup"><span data-stu-id="a1a99-156">These databases can be local or remote depending on the need to share information between different users.</span></span>

<span data-ttu-id="a1a99-157">С точки зрения кода существовало много технологий и платформ, которые позволяют разработчикам подключать, запрашивать и обновлять базу данных.</span><span class="sxs-lookup"><span data-stu-id="a1a99-157">From the code perspective, there have been many technologies and frameworks to give the developer the possibility to connect, query, and update a database.</span></span>

<span data-ttu-id="a1a99-158">Наиболее распространенные примеры баз данных, которые можно найти, если речь идет о классическом приложении Windows — Microsoft Access и Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a1a99-158">The most common examples of database you can find when talking about Windows Desktop application are Microsoft Access and Microsoft SQL Server.</span></span> <span data-ttu-id="a1a99-159">Если вы используете более 20 лет опыта программирования для настольных систем, такие имена, как ODBC, OLEDB, RDO, ADO, ADO.NET, LINQ и Entity Framework, будут привычными.</span><span class="sxs-lookup"><span data-stu-id="a1a99-159">If you have more than 20 years of experience programming for the desktop, names like ODBC, OLEDB, RDO, ADO, ADO.NET, LINQ, and Entity Framework will sound familiar.</span></span>

### <a name="odbc"></a><span data-ttu-id="a1a99-160">ODBC</span><span class="sxs-lookup"><span data-stu-id="a1a99-160">ODBC</span></span>

<span data-ttu-id="a1a99-161">Вы можете продолжать использовать ODBC в .NET, так как корпорация Майкрософт предоставляет `System.Data.Odbc` библиотеку, совместимую с .NET Standard 2,0.</span><span class="sxs-lookup"><span data-stu-id="a1a99-161">You can continue to use ODBC on .NET since Microsoft is providing the `System.Data.Odbc` library compatible with .NET Standard 2.0.</span></span>

### <a name="ole-db"></a><span data-ttu-id="a1a99-162">OLE DB</span><span class="sxs-lookup"><span data-stu-id="a1a99-162">OLE DB</span></span>

<span data-ttu-id="a1a99-163">[OLE DB](/previous-versions/windows/desktop/ms722784(v=vs.85)) был отличным способом для единообразного доступа к различным источникам данных.</span><span class="sxs-lookup"><span data-stu-id="a1a99-163">[OLE DB](/previous-versions/windows/desktop/ms722784(v=vs.85)) has been a great way to access various data sources in a uniform manner.</span></span> <span data-ttu-id="a1a99-164">Но это было основано на модели COM, которая является технологией только для Windows, и поэтому она не лучше всего подходит для кросс-платформенной технологии, такой как .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-164">But it was based on COM, which is a Windows-only technology, and as such wasn't the best fit for a cross-platform technology such as .NET.</span></span> <span data-ttu-id="a1a99-165">Он также не поддерживается в SQL Server версии 2014 и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="a1a99-165">It's also unsupported in SQL Server versions 2014 and later.</span></span> <span data-ttu-id="a1a99-166">По этим причинам OLE DB не будет поддерживаться .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-166">For those reasons, OLE DB won't be supported by .NET.</span></span>

### <a name="adonet"></a><span data-ttu-id="a1a99-167">ADO.NET</span><span class="sxs-lookup"><span data-stu-id="a1a99-167">ADO.NET</span></span>

<span data-ttu-id="a1a99-168">Вы по-прежнему можете использовать ADO.NET из существующего кода на рабочем столе в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-168">You can still use ADO.NET from your existing desktop code on .NET.</span></span> <span data-ttu-id="a1a99-169">Вам нужно просто обновить некоторые пакеты NuGet.</span><span class="sxs-lookup"><span data-stu-id="a1a99-169">You just need to update some NuGet packages.</span></span>

### <a name="ef-core-vs-ef6"></a><span data-ttu-id="a1a99-170">EF Core и EF6</span><span class="sxs-lookup"><span data-stu-id="a1a99-170">EF Core vs. EF6</span></span>

<span data-ttu-id="a1a99-171">В настоящее время поддерживаются две версии Entity Framework (EF), Entity Framework 6 (EF6) и EF Core.</span><span class="sxs-lookup"><span data-stu-id="a1a99-171">There are two currently supported versions of Entity Framework (EF), Entity Framework 6 (EF6) and EF Core.</span></span>

<span data-ttu-id="a1a99-172">Новейшая технология, выпущенная как часть платформа .NET Framework мира, Entity Frameworkа, а 6,4 — Последняя версия.</span><span class="sxs-lookup"><span data-stu-id="a1a99-172">The latest technology released as part of the .NET Framework world is Entity Framework, with 6.4 being the latest version.</span></span> <span data-ttu-id="a1a99-173">При запуске .NET Core Корпорация Майкрософт также выпустила новый стек доступа к данным на основе Entity Framework и называется Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="a1a99-173">With the launch of .NET Core, Microsoft also released a new data access stack based on Entity Framework and called Entity Framework Core.</span></span>

<span data-ttu-id="a1a99-174">EF 6,4 и EF Core можно использовать как в платформа .NET Framework, так и в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-174">You can use EF 6.4 and EF Core from both .NET Framework and .NET.</span></span> <span data-ttu-id="a1a99-175">Итак, каковы драйверы принятия решений, помогающие решить эти два?</span><span class="sxs-lookup"><span data-stu-id="a1a99-175">So, what are the decision drivers to help to decide between the two?</span></span>

<span data-ttu-id="a1a99-176">EF 6,3 — это первая версия EF6, которая может работать на .NET и работать на разных платформах.</span><span class="sxs-lookup"><span data-stu-id="a1a99-176">EF 6.3 is the first version of EF6 that can run on .NET and work cross-platform.</span></span> <span data-ttu-id="a1a99-177">На самом деле, основная цель этого выпуска — упростить миграцию существующих приложений, использующих EF6, в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-177">In fact, the main goal of this release was to make it easier to migrate existing applications that use EF6 to .NET.</span></span>

<span data-ttu-id="a1a99-178">EF Core был разработан как аналог EF6.</span><span class="sxs-lookup"><span data-stu-id="a1a99-178">EF Core was designed to provide a developer experience similar to EF6.</span></span> <span data-ttu-id="a1a99-179">Большая часть API верхнего уровня сохранена, поэтому EF Core покажется знакомым тем разработчикам, которые использовали EF6.</span><span class="sxs-lookup"><span data-stu-id="a1a99-179">Most of the top-level APIs remain the same, so EF Core will feel familiar to developers who have used EF6.</span></span>

<span data-ttu-id="a1a99-180">Несмотря на совместимость, существуют различия в реализации, которые следует проверить перед принятием решения.</span><span class="sxs-lookup"><span data-stu-id="a1a99-180">Although compatible, there are differences on the implementation you should check before making a decision.</span></span>
<span data-ttu-id="a1a99-181">Дополнительные сведения см. в разделе [Compare EF Core & EF6](/ef/efcore-and-ef6/).</span><span class="sxs-lookup"><span data-stu-id="a1a99-181">For more information, see [Compare EF Core & EF6](/ef/efcore-and-ef6/).</span></span>

<span data-ttu-id="a1a99-182">Рекомендуется использовать EF Core если:</span><span class="sxs-lookup"><span data-stu-id="a1a99-182">The recommendation is to use EF Core if:</span></span>

* <span data-ttu-id="a1a99-183">Приложению требуются возможности .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-183">The app needs the capabilities of .NET.</span></span>
* <span data-ttu-id="a1a99-184">EF Core поддерживает все функции, которые требуются приложению.</span><span class="sxs-lookup"><span data-stu-id="a1a99-184">EF Core supports all of the features that the app requires.</span></span>

<span data-ttu-id="a1a99-185">Используйте EF6, если выполнены оба условия:</span><span class="sxs-lookup"><span data-stu-id="a1a99-185">Consider using EF6 if both of the following conditions are true:</span></span>

* <span data-ttu-id="a1a99-186">Приложение будет работать в Windows, платформа .NET Framework 4,0 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="a1a99-186">The app will run on Windows and .NET Framework 4.0 or later.</span></span>
* <span data-ttu-id="a1a99-187">EF6 поддерживает все функции, которые требуются приложению.</span><span class="sxs-lookup"><span data-stu-id="a1a99-187">EF6 supports all of the features that the app requires.</span></span>

### <a name="relational-databases"></a><span data-ttu-id="a1a99-188">реляционные базы данных</span><span class="sxs-lookup"><span data-stu-id="a1a99-188">Relational databases</span></span>

#### <a name="sql-server"></a><span data-ttu-id="a1a99-189">SQL Server</span><span class="sxs-lookup"><span data-stu-id="a1a99-189">SQL Server</span></span>

<span data-ttu-id="a1a99-190">SQL Server была одной из выбранных баз данных, если вы разрабатываете для рабочего стола несколько лет назад.</span><span class="sxs-lookup"><span data-stu-id="a1a99-190">SQL Server has been one of the databases of choice if you were developing for the desktop some years ago.</span></span> <span data-ttu-id="a1a99-191">Используя <xref:System.Data.SqlClient> в платформа .NET Framework, можно получить доступ к версиям SQL Server, которая инкапсулирует протоколы, относящиеся к базе данных.</span><span class="sxs-lookup"><span data-stu-id="a1a99-191">With the use of <xref:System.Data.SqlClient> in .NET Framework, you could access versions of SQL Server, which encapsulates database-specific protocols.</span></span>

<span data-ttu-id="a1a99-192">В .NET можно найти новый `SqlClient` класс, полностью совместимый с существующим в платформа .NET Framework, но расположенным в <xref:Microsoft.Data.SqlClient> библиотеке.</span><span class="sxs-lookup"><span data-stu-id="a1a99-192">In .NET, you can find a new `SqlClient` class, fully compatible with the one existing in the .NET Framework but located in the <xref:Microsoft.Data.SqlClient> library.</span></span> <span data-ttu-id="a1a99-193">Необходимо просто добавить ссылку на пакет NuGet [Microsoft. Data. SqlClient](https://www.nuget.org/packages/Microsoft.Data.SqlClient/) и выполнить переименование для пространств имен, и все должно работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="a1a99-193">You just have to add a reference to the [Microsoft.Data.SqlClient](https://www.nuget.org/packages/Microsoft.Data.SqlClient/) NuGet package and do some renaming for the namespaces and everything should work as expected.</span></span>

#### <a name="microsoft-access"></a><span data-ttu-id="a1a99-194">Microsoft Access</span><span class="sxs-lookup"><span data-stu-id="a1a99-194">Microsoft Access</span></span>

<span data-ttu-id="a1a99-195">Microsoft Access использовался в течение нескольких лет, когда сложное и масштабируемое SQL Server не требовалось.</span><span class="sxs-lookup"><span data-stu-id="a1a99-195">Microsoft Access has been used for years when the sophisticated and more scalable SQL Server wasn't needed.</span></span> <span data-ttu-id="a1a99-196">Вы по-прежнему можете подключаться к Microsoft Access с помощью <xref:System.Data.Odbc> библиотеки.</span><span class="sxs-lookup"><span data-stu-id="a1a99-196">You can still connect to Microsoft Access using the <xref:System.Data.Odbc> library.</span></span>

## <a name="consuming-services"></a><span data-ttu-id="a1a99-197">Использование служб</span><span class="sxs-lookup"><span data-stu-id="a1a99-197">Consuming services</span></span>

<span data-ttu-id="a1a99-198">С порождением архитектур, ориентированных на службы, настольные приложения начали развиваться от модели "клиент-сервер" до подхода с тремя уровнями.</span><span class="sxs-lookup"><span data-stu-id="a1a99-198">With the raise of service-oriented architectures, desktop applications began to evolve from a client-server model to the three-layer approach.</span></span> <span data-ttu-id="a1a99-199">При подходе "клиент-сервер" прямое подключение к базе данных устанавливается с клиента, который владеет бизнес-логикой, как правило, внутри одного файла EXE.</span><span class="sxs-lookup"><span data-stu-id="a1a99-199">In the client-server approach, a direct database connection is established from the client holding the business logic usually inside a single EXE file.</span></span> <span data-ttu-id="a1a99-200">С другой стороны, подход с тремя уровнями устанавливает промежуточный слой служб, реализующий бизнес-логику и доступ к базе данных, что обеспечивает лучшую безопасность, масштабируемость и многократное использование.</span><span class="sxs-lookup"><span data-stu-id="a1a99-200">On the other hand, the three-layer approach establishes an intermediate service layer implementing business logic and database access allowing for better security, scalability, and reusability.</span></span> <span data-ttu-id="a1a99-201">Вместо того, чтобы работать непосредственно с наборами данных, подход слоя использует набор служб, реализующих контракты и типы объектов в качестве способа реализации обмена данными.</span><span class="sxs-lookup"><span data-stu-id="a1a99-201">Instead of working directly with datasets of data, the layer approach relies in a set of services implementing contracts and types objects as a way to implement data transfer.</span></span>

<span data-ttu-id="a1a99-202">Если у вас есть классическое приложение, использующее службу WCF, и вы хотите перенести его в .NET, необходимо учитывать некоторые моменты.</span><span class="sxs-lookup"><span data-stu-id="a1a99-202">If you have a desktop application using a WCF service and you want to migrate it to .NET, there are some things to consider.</span></span>

<span data-ttu-id="a1a99-203">В первую очередь, как разрешить конфигурацию для доступа к службе.</span><span class="sxs-lookup"><span data-stu-id="a1a99-203">The first thing is how to resolve the configuration to access the service.</span></span> <span data-ttu-id="a1a99-204">Так как конфигурация отличается в .NET, необходимо внести некоторые обновления в файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a1a99-204">Because the configuration is different on .NET, you'll need to make some updates in your configuration file.</span></span>

<span data-ttu-id="a1a99-205">Во вторых, необходимо повторно создать клиент службы с помощью новых средств, имеющихся в Visual Studio 2019.</span><span class="sxs-lookup"><span data-stu-id="a1a99-205">Second, you'll need to regenerate the service client with the new tools present on Visual Studio 2019.</span></span> <span data-ttu-id="a1a99-206">На этом шаге необходимо активировать создание синхронных операций, чтобы обеспечить совместимость клиента с существующим кодом.</span><span class="sxs-lookup"><span data-stu-id="a1a99-206">In this step, you must consider activating the generation of the synchronous operations to make the client compatible with your existing code.</span></span>

<span data-ttu-id="a1a99-207">Если после миграции обнаруживается наличие библиотек, которые отсутствуют в .NET, можно добавить ссылку на пакет NuGet [Microsoft. Windows. Compatibility](https://www.nuget.org/packages/Microsoft.Windows.Compatibility) и проверить наличие недостающих функций.</span><span class="sxs-lookup"><span data-stu-id="a1a99-207">After the migration, if you find that there are libraries you need that aren't present on .NET, you can add a reference to the [Microsoft.Windows.Compatibility](https://www.nuget.org/packages/Microsoft.Windows.Compatibility) NuGet package and see if the missing functions are there.</span></span>

<span data-ttu-id="a1a99-208">Если вы используете <xref:System.Net.WebRequest> класс для выполнения вызовов веб-служб, вы можете столкнуться с некоторыми отличиями .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-208">If you're using the <xref:System.Net.WebRequest> class to perform web service calls, you may find some differences on .NET.</span></span> <span data-ttu-id="a1a99-209">Рекомендуется использовать вместо него System .NET. http. HttpClient.</span><span class="sxs-lookup"><span data-stu-id="a1a99-209">The recommendation is to use the System.Net.Http.HttpClient instead.</span></span>

## <a name="consuming-a-com-object"></a><span data-ttu-id="a1a99-210">Использование COM-объекта</span><span class="sxs-lookup"><span data-stu-id="a1a99-210">Consuming a COM Object</span></span>

<span data-ttu-id="a1a99-211">В настоящее время нет способа добавить ссылку на COM-объект из Visual Studio 2019 для использования с .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-211">Currently, there's no way to add a reference to a COM object from Visual Studio 2019 to use with .NET.</span></span> <span data-ttu-id="a1a99-212">Поэтому необходимо вручную изменить файл проекта.</span><span class="sxs-lookup"><span data-stu-id="a1a99-212">So, you have to manually modify the project file.</span></span>

<span data-ttu-id="a1a99-213">Вставьте `COMReference` структуру в файл проекта, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="a1a99-213">Insert a `COMReference` structure inside the project file like in the following example:</span></span>

```xml
<ItemGroup>
    <COMReference Include="MSHTML">
        <Guid>{3050F1C5-98B5-11CF-BB82-00AA00BDCE0B}\</Guid>
        <VersionMajor>4</VersionMajor>
        <VersionMinor>0</VersionMinor>
        <Lcid>0</Lcid>
        <WrapperTool>primary</WrapperTool>
        <Isolated>false</Isolated>
    </COMReference>
</ItemGroup>
```

## <a name="more-things-to-consider"></a><span data-ttu-id="a1a99-214">Другие вещи, которые следует учитывать</span><span class="sxs-lookup"><span data-stu-id="a1a99-214">More things to consider</span></span>

<span data-ttu-id="a1a99-215">Несколько технологий, доступных для платформа .NET Framework библиотек, недоступны для .NET Core и .NET 5.</span><span class="sxs-lookup"><span data-stu-id="a1a99-215">Several technologies available to .NET Framework libraries aren't available for .NET Core or .NET 5.</span></span> <span data-ttu-id="a1a99-216">Если ваш код полагается на некоторые из этих технологий, рассмотрите альтернативные подходы, описанные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="a1a99-216">If your code relies on some of these technologies, consider the alternative approaches outlined in this section.</span></span>

<span data-ttu-id="a1a99-217">[Пакет обеспечения совместимости Windows](../../core/porting/windows-compat-pack.md) предоставляет доступ к интерфейсам API, которые ранее были доступны только для платформа .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a1a99-217">The [Windows Compatibility Pack](../../core/porting/windows-compat-pack.md) provides access to APIs that were previously available only for .NET Framework.</span></span> <span data-ttu-id="a1a99-218">Его можно использовать в проектах .NET Core и .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="a1a99-218">It can be used on .NET Core and .NET Standard projects.</span></span>

<span data-ttu-id="a1a99-219">Дополнительные сведения о совместимости API можно найти в документации по критическим изменениям и устаревшим API-интерфейсам <https://docs.microsoft.com/dotnet/core/compatibility/fx-core> .</span><span class="sxs-lookup"><span data-stu-id="a1a99-219">For more information on API compatibility, you can find documentation about breaking changes and deprecated/legacy APIs at <https://docs.microsoft.com/dotnet/core/compatibility/fx-core>.</span></span>

### <a name="appdomains"></a><span data-ttu-id="a1a99-220">Домены приложений</span><span class="sxs-lookup"><span data-stu-id="a1a99-220">AppDomains</span></span>

<span data-ttu-id="a1a99-221">Домены приложений позволяют изолировать приложения друг от друга.</span><span class="sxs-lookup"><span data-stu-id="a1a99-221">Application domains (AppDomains) isolate apps from one another.</span></span> <span data-ttu-id="a1a99-222">AppDomains требуется поддержка среды выполнения и дорогостоящие.</span><span class="sxs-lookup"><span data-stu-id="a1a99-222">AppDomains require runtime support and are expensive.</span></span> <span data-ttu-id="a1a99-223">Создание дополнительных доменов приложений не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="a1a99-223">Creating additional app domains isn't supported.</span></span> <span data-ttu-id="a1a99-224">Вместо нее для изоляции кода мы рекомендуем использовать отдельные процессы или контейнеры.</span><span class="sxs-lookup"><span data-stu-id="a1a99-224">For code isolation, we recommend separate processes or using containers as an alternative.</span></span> <span data-ttu-id="a1a99-225">Для динамической загрузки сборок рекомендуется использовать новый класс <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="a1a99-225">For the dynamic loading of assemblies, we recommend the new <xref:System.Runtime.Loader.AssemblyLoadContext> class.</span></span>

<span data-ttu-id="a1a99-226">Чтобы упростить миграцию кода с платформа .NET Framework, .NET предоставляет некоторую `AppDomain` поверхность API.</span><span class="sxs-lookup"><span data-stu-id="a1a99-226">To make code migration from .NET Framework easier, .NET exposes some of the `AppDomain` API surface.</span></span> <span data-ttu-id="a1a99-227">Некоторые API-интерфейсы работают без изменений (например, <xref:System.AppDomain.UnhandledException?displayProperty=nameWithType>), одни элементы не выполняют никаких действий (например, <xref:System.AppDomain.SetCachePath%2A>), а другие создают исключение <xref:System.PlatformNotSupportedException> (например, <xref:System.AppDomain.CreateDomain%2A>).</span><span class="sxs-lookup"><span data-stu-id="a1a99-227">Some of the APIs function normally (for example, <xref:System.AppDomain.UnhandledException?displayProperty=nameWithType>), some members do nothing (for example, <xref:System.AppDomain.SetCachePath%2A>), and some of them throw <xref:System.PlatformNotSupportedException> (for example, <xref:System.AppDomain.CreateDomain%2A>).</span></span>

### <a name="remoting"></a><span data-ttu-id="a1a99-228">Удаленное взаимодействие</span><span class="sxs-lookup"><span data-stu-id="a1a99-228">Remoting</span></span>

<span data-ttu-id="a1a99-229">Удаленное взаимодействие .NET использовалось для взаимодействия между доменами AppDomain, которое больше не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="a1a99-229">.NET Remoting was used for cross-AppDomain communication, which is no longer supported.</span></span> <span data-ttu-id="a1a99-230">Кроме того, для удаленного взаимодействия требуется поддержка среды выполнения, обслуживание которой дорого обходится.</span><span class="sxs-lookup"><span data-stu-id="a1a99-230">Also, Remoting requires runtime support, which is expensive to maintain.</span></span> <span data-ttu-id="a1a99-231">По этим причинам удаленное взаимодействие .NET не поддерживается в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-231">For these reasons, .NET Remoting isn't supported on .NET.</span></span>

<span data-ttu-id="a1a99-232">Для обмена данными между процессами следует рассмотреть механизмы межпроцессного взаимодействия (IPC) в качестве альтернативы удаленному взаимодействию, например <xref:System.IO.Pipes?displayProperty=nameWithType> <xref:System.IO.MemoryMappedFiles.MemoryMappedFile> классу или.</span><span class="sxs-lookup"><span data-stu-id="a1a99-232">For communication across processes, you should consider inter-process communication (IPC) mechanisms as an alternative to Remoting, such as the <xref:System.IO.Pipes?displayProperty=nameWithType> or the <xref:System.IO.MemoryMappedFiles.MemoryMappedFile> class.</span></span>

<span data-ttu-id="a1a99-233">Для взаимодействия между компьютерами в качестве альтернативы можно использовать сетевое решение,</span><span class="sxs-lookup"><span data-stu-id="a1a99-233">Across machines, use a network-based solution as an alternative.</span></span> <span data-ttu-id="a1a99-234">Желательно использовать протокол открытого текста с низкими издержками, например HTTP.</span><span class="sxs-lookup"><span data-stu-id="a1a99-234">Preferably, use a low-overhead plaintext protocol, such as HTTP.</span></span> <span data-ttu-id="a1a99-235">Еще один вариант — веб-сервер Kestrel, используемый платформой ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a1a99-235">The Kestrel web server, the web server used by ASP.NET Core, is an option here.</span></span>

### <a name="code-access-security-cas"></a><span data-ttu-id="a1a99-236">CAS (Code Access Security — безопасность доступа кода)</span><span class="sxs-lookup"><span data-stu-id="a1a99-236">Code Access Security (CAS)</span></span>

<span data-ttu-id="a1a99-237">Изолированная среда, которая использует среду выполнения или платформу для ограничения ресурсов, используемых или выполняемых управляемым приложением или библиотекой, не поддерживается в .NET.</span><span class="sxs-lookup"><span data-stu-id="a1a99-237">Sandboxing, which relies on the runtime or the framework to constrain which resources a managed application or library uses or runs, isn't supported on .NET.</span></span>

<span data-ttu-id="a1a99-238">Используйте границы безопасности, предоставляемые операционной системой, такие как виртуализация, контейнеры или учетные записи пользователей, для выполнения процессов с минимальным набором привилегий.</span><span class="sxs-lookup"><span data-stu-id="a1a99-238">Use security boundaries that are provided by the operating system, such as virtualization, containers, or user accounts for running processes with the minimum set of privileges.</span></span>

### <a name="security-transparency"></a><span data-ttu-id="a1a99-239">Прозрачность безопасности</span><span class="sxs-lookup"><span data-stu-id="a1a99-239">Security Transparency</span></span>

<span data-ttu-id="a1a99-240">Аналогично CAS, прозрачность безопасности позволяет декларативно отделить изолированный код от кода, критически важного с точки зрения безопасности, но больше не поддерживается как ограничение безопасности.</span><span class="sxs-lookup"><span data-stu-id="a1a99-240">Similar to CAS, Security Transparency separates sandboxed code from security critical code in a declarative fashion but is no longer supported as a security boundary.</span></span>

<span data-ttu-id="a1a99-241">Используйте границы безопасности, предоставляемые операционной системой, такие как виртуализация, контейнеры или учетные записи пользователей, для выполнения процессов с наименьшим набором привилегий.</span><span class="sxs-lookup"><span data-stu-id="a1a99-241">Use security boundaries that are provided by the operating system, such as virtualization, containers, or user accounts for running processes with the least set of privileges.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="a1a99-242">[Назад](whats-new-dotnet.md )
>[Вперед](windows-migration.md)</span><span class="sxs-lookup"><span data-stu-id="a1a99-242">[Previous](whats-new-dotnet.md )
[Next](windows-migration.md)</span></span>
