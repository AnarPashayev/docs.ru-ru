---
title: Кэширование в приложении, ориентированном на облако
description: Узнайте о стратегиях кэширования в собственном приложении для облака.
author: robvet
ms.date: 05/17/2020
ms.openlocfilehash: 84860ad4583e4b45d5ca9490d9f0167e7439d3d4
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91161091"
---
# <a name="caching-in-a-cloud-native-app"></a><span data-ttu-id="80997-103">Кэширование в собственном приложении для облака</span><span class="sxs-lookup"><span data-stu-id="80997-103">Caching in a cloud-native app</span></span>

<span data-ttu-id="80997-104">Преимущества кэширования хорошо понятны.</span><span class="sxs-lookup"><span data-stu-id="80997-104">The benefits of caching are well understood.</span></span> <span data-ttu-id="80997-105">Этот метод позволяет временно скопировать часто используемые данные из серверного хранилища данных в *Быстрое хранилище* , расположенное ближе к приложению.</span><span class="sxs-lookup"><span data-stu-id="80997-105">The technique works by temporarily copying frequently accessed data from a backend data store to *fast storage* that's located closer to the application.</span></span> <span data-ttu-id="80997-106">Кэширование часто реализуется там, где...</span><span class="sxs-lookup"><span data-stu-id="80997-106">Caching is often implemented where...</span></span>

- <span data-ttu-id="80997-107">Данные остаются относительно статическими.</span><span class="sxs-lookup"><span data-stu-id="80997-107">Data remains relatively static.</span></span>
- <span data-ttu-id="80997-108">Доступ к данным выполняется медленно, особенно по сравнению с скоростью кэша.</span><span class="sxs-lookup"><span data-stu-id="80997-108">Data access is slow, especially compared to the speed of the cache.</span></span>
- <span data-ttu-id="80997-109">На данные налагаются высокие уровни конкуренции.</span><span class="sxs-lookup"><span data-stu-id="80997-109">Data is subject to high levels of contention.</span></span>

## <a name="why"></a><span data-ttu-id="80997-110">Почему?</span><span class="sxs-lookup"><span data-stu-id="80997-110">Why?</span></span>

<span data-ttu-id="80997-111">Как обсуждалось в [руководстве по кэшированию Microsoft](/azure/architecture/best-practices/caching), кэширование может повысить производительность, масштабируемость и доступность для отдельных микрослужб и системы в целом.</span><span class="sxs-lookup"><span data-stu-id="80997-111">As discussed in the [Microsoft caching guidance](/azure/architecture/best-practices/caching), caching can increase performance, scalability, and availability for individual microservices and the system as a whole.</span></span> <span data-ttu-id="80997-112">Это сокращает задержку и состязание за обработку больших объемов параллельных запросов к хранилищу данных.</span><span class="sxs-lookup"><span data-stu-id="80997-112">It reduces the latency and contention of handling large volumes of concurrent requests to a data store.</span></span> <span data-ttu-id="80997-113">По мере увеличения объема данных и числа пользователей повышается преимущество кэширования.</span><span class="sxs-lookup"><span data-stu-id="80997-113">As data volume and the number of users increase, the greater the benefits of caching become.</span></span>

<span data-ttu-id="80997-114">Кэширование наиболее эффективно, когда клиент многократно считывает неизменяемые данные или редко меняются.</span><span class="sxs-lookup"><span data-stu-id="80997-114">Caching is most effective when a client repeatedly reads data that is immutable or that changes infrequently.</span></span> <span data-ttu-id="80997-115">Примеры включают справочные сведения, такие как сведения о продуктах и ценах, или общие статические ресурсы, которые являются дорогостоящими для конструирования.</span><span class="sxs-lookup"><span data-stu-id="80997-115">Examples include reference information such as product and pricing information, or shared static resources that are costly to construct.</span></span>

<span data-ttu-id="80997-116">Хотя микрослужбы не имеют состояния, распределенный кэш может поддерживать одновременный доступ к данным состояния сеанса, когда это необходимо.</span><span class="sxs-lookup"><span data-stu-id="80997-116">While microservices should be stateless, a distributed cache can support concurrent access to session state data when absolutely required.</span></span>

<span data-ttu-id="80997-117">Также рассмотрите возможность кэширования, чтобы избежать повторяющихся вычислений.</span><span class="sxs-lookup"><span data-stu-id="80997-117">Also consider caching to avoid repetitive computations.</span></span> <span data-ttu-id="80997-118">Если операция преобразует данные или выполняет сложное вычисление, кэширует результат для последующих запросов.</span><span class="sxs-lookup"><span data-stu-id="80997-118">If an operation transforms data or performs a complicated calculation, cache the result for subsequent requests.</span></span>

## <a name="caching-architecture"></a><span data-ttu-id="80997-119">Архитектура кэширования</span><span class="sxs-lookup"><span data-stu-id="80997-119">Caching architecture</span></span>

<span data-ttu-id="80997-120">Облачные машинные приложения обычно реализуют архитектуру распределенного кэширования.</span><span class="sxs-lookup"><span data-stu-id="80997-120">Cloud native applications typically implement a distributed caching architecture.</span></span> <span data-ttu-id="80997-121">Кэш размещается как облачная [Служба резервного копирования](./definition.md#backing-services), отделенная от микрослужб.</span><span class="sxs-lookup"><span data-stu-id="80997-121">The cache is hosted as a cloud-based [backing service](./definition.md#backing-services), separate from the microservices.</span></span> <span data-ttu-id="80997-122">На рис. 5-15 показана архитектура.</span><span class="sxs-lookup"><span data-stu-id="80997-122">Figure 5-15 shows the architecture.</span></span>

![Кэширование в собственном облачном приложении](media/caching-in-a-cloud-native-app.png)

<span data-ttu-id="80997-124">**Рис. 5-15**. кэширование в собственном облачном приложении</span><span class="sxs-lookup"><span data-stu-id="80997-124">**Figure 5-15**: Caching in a cloud native app</span></span>

<span data-ttu-id="80997-125">На предыдущем рисунке обратите внимание на то, как кэш не зависит от микрослужб и используется совместно.</span><span class="sxs-lookup"><span data-stu-id="80997-125">In the previous figure, note how the cache is independent of and shared by the microservices.</span></span> <span data-ttu-id="80997-126">В этом сценарии кэш вызывается [шлюзом API](./front-end-communication.md).</span><span class="sxs-lookup"><span data-stu-id="80997-126">In this scenario, the cache is invoked by the [API Gateway](./front-end-communication.md).</span></span> <span data-ttu-id="80997-127">Как обсуждалось в главе 4, шлюз выступает в качестве внешнего интерфейса для всех входящих запросов.</span><span class="sxs-lookup"><span data-stu-id="80997-127">As discussed in chapter 4, the gateway serves as a front end for all incoming requests.</span></span> <span data-ttu-id="80997-128">Распределенный кэш повышает скорость реагирования системы путем возвращения кэшированных данных везде, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="80997-128">The distributed cache increases system responsiveness by returning cached data whenever possible.</span></span> <span data-ttu-id="80997-129">Кроме того, отделение кэша от служб позволяет кэшу независимо увеличивать или уменьшать размер кэша для удовлетворения увеличенных требований к трафику.</span><span class="sxs-lookup"><span data-stu-id="80997-129">Additionally, separating the cache from the services allows the cache to scale up or out independently to meet increased traffic demands.</span></span>

<span data-ttu-id="80997-130">На предыдущем рисунке представлен общий шаблон кэширования, известный как [шаблон кэша](/azure/architecture/patterns/cache-aside).</span><span class="sxs-lookup"><span data-stu-id="80997-130">The previous figure presents a common caching pattern known as the [cache-aside pattern](/azure/architecture/patterns/cache-aside).</span></span> <span data-ttu-id="80997-131">Для входящего запроса сначала необходимо запросить кэш (шаг \# 1) для ответа.</span><span class="sxs-lookup"><span data-stu-id="80997-131">For an incoming request, you first query the cache (step \#1) for a response.</span></span> <span data-ttu-id="80997-132">Если объект найден, данные возвращаются немедленно.</span><span class="sxs-lookup"><span data-stu-id="80997-132">If found, the data is returned immediately.</span></span> <span data-ttu-id="80997-133">Если данные не существуют в кэше (называемые [промахом кэша](https://www.techopedia.com/definition/6308/cache-miss)), они извлекаются из локальной базы данных в подчиненной службе (шаг \# 2).</span><span class="sxs-lookup"><span data-stu-id="80997-133">If the data doesn't exist in the cache (known as a [cache miss](https://www.techopedia.com/definition/6308/cache-miss)), it's retrieved from a local database in a downstream service (step \#2).</span></span> <span data-ttu-id="80997-134">Затем он записывается в кэш для будущих запросов (шаг \# 3) и возвращается вызывающему.</span><span class="sxs-lookup"><span data-stu-id="80997-134">It's then written to the cache for future requests (step \#3), and returned to the caller.</span></span> <span data-ttu-id="80997-135">Необходимо принять меры для периодического исключения кэшированных данных, чтобы система своевременно и стабильно выполнялась.</span><span class="sxs-lookup"><span data-stu-id="80997-135">Care must be taken to periodically evict cached data so that the system remains timely and consistent.</span></span>

<span data-ttu-id="80997-136">По мере роста общего кэша может оказаться полезным секционировать данные на нескольких узлах.</span><span class="sxs-lookup"><span data-stu-id="80997-136">As a shared cache grows, it might prove beneficial to partition its data across multiple nodes.</span></span> <span data-ttu-id="80997-137">Это позволит сократить состязание и повысить масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="80997-137">Doing so can help minimize contention and improve scalability.</span></span> <span data-ttu-id="80997-138">Многие службы кэширования поддерживают возможность динамического добавления и удаления узлов и перераспределения данных по секциям.</span><span class="sxs-lookup"><span data-stu-id="80997-138">Many Caching services support the ability to dynamically add and remove nodes and rebalance data across partitions.</span></span> <span data-ttu-id="80997-139">Этот подход обычно включает кластеризацию.</span><span class="sxs-lookup"><span data-stu-id="80997-139">This approach typically involves clustering.</span></span> <span data-ttu-id="80997-140">Кластеризация предоставляет коллекцию федеративных узлов в виде простого единого кэша.</span><span class="sxs-lookup"><span data-stu-id="80997-140">Clustering exposes a collection of federated nodes as a seamless, single cache.</span></span> <span data-ttu-id="80997-141">Однако на внутреннем уровне данные распределены между узлами после предопределенной стратегии распределения, которая равномерно распределяет нагрузку.</span><span class="sxs-lookup"><span data-stu-id="80997-141">Internally, however, the data is dispersed across the nodes following a predefined distribution strategy that balances the load evenly.</span></span>

## <a name="azure-cache-for-redis"></a><span data-ttu-id="80997-142">Кэш Redis для Azure</span><span class="sxs-lookup"><span data-stu-id="80997-142">Azure Cache for Redis</span></span>

<span data-ttu-id="80997-143">[Кэш Azure для Redis](https://azure.microsoft.com/services/cache/) — это безопасное кэширование данных и служба посредника обмена сообщениями, полностью управляемая корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="80997-143">[Azure Cache for Redis](https://azure.microsoft.com/services/cache/) is a secure data caching and messaging broker service, fully managed by Microsoft.</span></span> <span data-ttu-id="80997-144">Использование в качестве предложения платформы как услуги (PaaS) обеспечивает высокую пропускную способность и низкую задержку доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="80997-144">Consumed as a Platform as a Service (PaaS) offering, it provides high throughput and low-latency access to data.</span></span> <span data-ttu-id="80997-145">Служба доступна для любого приложения в среде Azure или за ее пределами.</span><span class="sxs-lookup"><span data-stu-id="80997-145">The service is accessible to any application within or outside of Azure.</span></span>

<span data-ttu-id="80997-146">Кэш Azure для службы Redis управляет доступом к серверам Redis с открытым исходным кодом, размещенным в центрах обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="80997-146">The Azure Cache for Redis service manages access to open-source Redis servers hosted across Azure data centers.</span></span> <span data-ttu-id="80997-147">Служба выступает в качестве фасадной для управления, контроля доступа и безопасности.</span><span class="sxs-lookup"><span data-stu-id="80997-147">The service acts as a facade providing management, access control, and security.</span></span> <span data-ttu-id="80997-148">Служба изначально поддерживает обширный набор структур данных, включая строки, хэши, списки и наборы.</span><span class="sxs-lookup"><span data-stu-id="80997-148">The service natively supports a rich set of data structures, including strings, hashes, lists, and sets.</span></span> <span data-ttu-id="80997-149">Если приложение уже использует Redis, оно будет работать как есть с кэшем Azure для Redis.</span><span class="sxs-lookup"><span data-stu-id="80997-149">If your application already uses Redis, it will work as-is with Azure Cache for Redis.</span></span>

<span data-ttu-id="80997-150">Кэш Azure для Redis — это больше, чем простой сервер кэша.</span><span class="sxs-lookup"><span data-stu-id="80997-150">Azure Cache for Redis is more than a simple cache server.</span></span> <span data-ttu-id="80997-151">Она может поддерживать ряд сценариев для расширения архитектуры микрослужб:</span><span class="sxs-lookup"><span data-stu-id="80997-151">It can support a number of scenarios to enhance a microservices architecture:</span></span>

- <span data-ttu-id="80997-152">Хранилище данных в памяти</span><span class="sxs-lookup"><span data-stu-id="80997-152">An in-memory data store</span></span>
- <span data-ttu-id="80997-153">Распределенная нереляционная база данных</span><span class="sxs-lookup"><span data-stu-id="80997-153">A distributed non-relational database</span></span>
- <span data-ttu-id="80997-154">Брокер сообщений</span><span class="sxs-lookup"><span data-stu-id="80997-154">A message broker</span></span>
- <span data-ttu-id="80997-155">Сервер конфигурации или обнаружения;</span><span class="sxs-lookup"><span data-stu-id="80997-155">A configuration or discovery server</span></span>
  
<span data-ttu-id="80997-156">В сложных сценариях копия кэшированных данных может быть [сохранена на диске](/azure/azure-cache-for-redis/cache-how-to-premium-persistence).</span><span class="sxs-lookup"><span data-stu-id="80997-156">For advanced scenarios, a copy of the cached data can be [persisted to disk](/azure/azure-cache-for-redis/cache-how-to-premium-persistence).</span></span> <span data-ttu-id="80997-157">Если аварийное событие отключает как основной, так и кэш реплик, кэш восстанавливается из последнего моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="80997-157">If a catastrophic event disables both the primary and replica caches, the cache is reconstructed from the most recent snapshot.</span></span>

<span data-ttu-id="80997-158">Кэш Redis для Azure доступен в нескольких предварительно определенных конфигурациях и ценовых категориях.</span><span class="sxs-lookup"><span data-stu-id="80997-158">Azure Redis Cache is available across a number of predefined configurations and pricing tiers.</span></span> <span data-ttu-id="80997-159">На [уровне Premium](/azure/azure-cache-for-redis/cache-overview#service-tiers) реализовано множество функций корпоративного уровня, таких как кластеризация, сохраняемость данных, Георепликация и изоляция виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="80997-159">The [Premium tier](/azure/azure-cache-for-redis/cache-overview#service-tiers) features many enterprise-level features such as clustering, data persistence, geo-replication, and virtual-network isolation.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="80997-160">[Назад](relational-vs-nosql-data.md)
>[Вперед](elastic-search-in-azure.md)</span><span class="sxs-lookup"><span data-stu-id="80997-160">[Previous](relational-vs-nosql-data.md)
[Next](elastic-search-in-azure.md)</span></span>
