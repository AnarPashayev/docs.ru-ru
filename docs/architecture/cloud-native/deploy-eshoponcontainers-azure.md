---
title: Развертывание eShopOnContainers в Azure
description: Развертывание приложения eShopOnContainers с помощью службы Kubernetes Azure, Helm и Девспацес.
ms.date: 06/30/2019
ms.openlocfilehash: 21033cc904dc595193c69f3452ce2522740f8ff6
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/23/2019
ms.locfileid: "73840493"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="7e70c-103">Развертывание eShopOnContainers в Azure</span><span class="sxs-lookup"><span data-stu-id="7e70c-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="7e70c-104">Логика, поддерживающая приложение eShopOnContainers, может поддерживаться в Azure с помощью различных служб.</span><span class="sxs-lookup"><span data-stu-id="7e70c-104">The logic supporting the eShopOnContainers application can be supported by Azure using a variety of services.</span></span> <span data-ttu-id="7e70c-105">Рекомендуется использовать Kubernetes с помощью службы Kubernetes Azure (AKS).</span><span class="sxs-lookup"><span data-stu-id="7e70c-105">The recommended approach is to leverage Kubernetes using Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="7e70c-106">Это можно сочетать с развертыванием Helm, чтобы обеспечить легко повторяемую конфигурацию инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="7e70c-106">This can be combined with Helm deployment to ensure easily repeated infrastructure configuration.</span></span> <span data-ttu-id="7e70c-107">При необходимости разработчики могут использовать Azure Dev Spaces для Kubernetes в рамках процесса разработки.</span><span class="sxs-lookup"><span data-stu-id="7e70c-107">Optionally, developers can leverage Azure Dev Spaces for Kubernetes as part of their development process.</span></span> <span data-ttu-id="7e70c-108">Другим вариантом является размещение функциональных возможностей приложения с помощью бессерверных функций Azure, таких как функции Azure и Azure Logic Apps.</span><span class="sxs-lookup"><span data-stu-id="7e70c-108">Another option is to host the functionality of the app using Azure Serverless features like Azure Functions and Azure Logic Apps.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="7e70c-109">Служба контейнеров Azure</span><span class="sxs-lookup"><span data-stu-id="7e70c-109">Azure Kubernetes Service</span></span>

<span data-ttu-id="7e70c-110">Если вы хотите разместить приложение eShopOnContainers в собственном кластере AKS, сначала необходимо создать кластер.</span><span class="sxs-lookup"><span data-stu-id="7e70c-110">If you'd like to host the eShopOnContainers application in your own AKS cluster, the first step is to create your cluster.</span></span> <span data-ttu-id="7e70c-111">Это можно сделать с помощью портал Azure, который поможет выполнить необходимые действия. также можно использовать Azure CLI, чтобы обеспечить возможность управления доступом на основе ролей (RBAC) и маршрутизацию приложений.</span><span class="sxs-lookup"><span data-stu-id="7e70c-111">You can do this using the Azure portal, which will walk you through the required steps, or you can use the Azure CLI, taking care to ensure you enable Role-Based Access Control (RBAC) and application routing when you do so.</span></span> <span data-ttu-id="7e70c-112">В документации по eShopOnContainers описаны шаги, связанные с созданием собственного кластера AKS.</span><span class="sxs-lookup"><span data-stu-id="7e70c-112">The eShopOnContainers' documentation describes the steps involved in creating your own AKS cluster.</span></span> <span data-ttu-id="7e70c-113">После создания кластера необходимо включить доступ к панели мониторинга Kubernetes, после чего вы сможете перейти на панель мониторинга Kubernetes для управления кластером.</span><span class="sxs-lookup"><span data-stu-id="7e70c-113">Once the cluster is created, you must enable access to the Kubernetes dashboard, at which point you should be able to browse to the Kubernetes dashboard to manage the cluster.</span></span>

<span data-ttu-id="7e70c-114">После создания и настройки кластера можно развернуть приложение на нем с помощью Helm и.</span><span class="sxs-lookup"><span data-stu-id="7e70c-114">Once the cluster has been created and configured, you can deploy the application to it using Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="7e70c-115">Развертывание в службе Azure Kubernetes с помощью Helm</span><span class="sxs-lookup"><span data-stu-id="7e70c-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="7e70c-116">Основные развертывания в AKS могут использовать пользовательские сценарии CLI или простые файлы развертывания, но более сложные приложения должны использовать средство управления зависимостями, например Helm.</span><span class="sxs-lookup"><span data-stu-id="7e70c-116">Basic deployments to AKS may use custom CLI scripts or simple deployment files, but more complex applications should use a dependency management tool like Helm.</span></span> <span data-ttu-id="7e70c-117">Helm поддерживается облачной вычислительной средой и помогает определять, устанавливать и обновлять приложения Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="7e70c-117">Helm is maintained by the Cloud-native Computing Foundation and helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="7e70c-118">Helm состоит из клиента командной строки Helm, который использует диаграммы Helm и компонент в составе кластера.</span><span class="sxs-lookup"><span data-stu-id="7e70c-118">Helm is composed of a command-line client, helm, which uses helm charts, and an in-cluster component, Tiller.</span></span> <span data-ttu-id="7e70c-119">Helm диаграммы используют стандартные файлы YAML для описания связанного набора ресурсов Kubernetes и, как правило, являются версиями вместе с приложением, которое они описывают.</span><span class="sxs-lookup"><span data-stu-id="7e70c-119">Helm Charts use standard YAML-formatted files to describe a related set of Kubernetes resources and are typically versioned alongside the application they describe.</span></span> <span data-ttu-id="7e70c-120">Helm диаграммы находятся в диапазоне от простых до сложных в зависимости от требований установки, которые они описывают.</span><span class="sxs-lookup"><span data-stu-id="7e70c-120">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="7e70c-121">Диаграммы eShopOnContainers Helm находятся в папке/K8S/Helm.</span><span class="sxs-lookup"><span data-stu-id="7e70c-121">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="7e70c-122">На рис. 2-6 показано, как различные компоненты приложения организованы в структуру папок, используемую Helm для определения и управления развертываниями.</span><span class="sxs-lookup"><span data-stu-id="7e70c-122">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="7e70c-123">![архитектура eShopOnContainers](./media/eshoponcontainers-helm-folder.png)
**рис. 2-6**.</span><span class="sxs-lookup"><span data-stu-id="7e70c-123">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="7e70c-124">Папка eShopOnContainers Helm.</span><span class="sxs-lookup"><span data-stu-id="7e70c-124">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="7e70c-125">Каждый отдельный компонент устанавливается с помощью команды `helm install`.</span><span class="sxs-lookup"><span data-stu-id="7e70c-125">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="7e70c-126">Эти команды легко создать в скриптах, а eShopOnContainers предоставляет сценарий "развернуть все", который выполняет перебор различных компонентов и устанавливает их с помощью соответствующих диаграмм Helm.</span><span class="sxs-lookup"><span data-stu-id="7e70c-126">These commands are easily scripted, and eShopOnContainers provides a "deploy all" script that loops through the different components and installs them using their respective helm charts.</span></span> <span data-ttu-id="7e70c-127">Результатом является повторяемый процесс, имеющий версию приложения в системе управления версиями, который любой участник группы может развернуть в кластере AKS с помощью однострочной команды сценария.</span><span class="sxs-lookup"><span data-stu-id="7e70c-127">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span> <span data-ttu-id="7e70c-128">Это позволяет разработчикам легко диагностировать и тестировать отдельные изменения в собственных облачных приложениях на основе микрослужб. Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="7e70c-128">Especially when combined with Azure Dev Spaces, this makes it easy for developers to diagnose and test their individual changes to their microservice-based cloud-native apps.</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="7e70c-129">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="7e70c-129">Azure Dev Spaces</span></span>

<span data-ttu-id="7e70c-130">Azure Dev Spaces помогает отдельным разработчикам размещать собственные уникальные версии кластеров AKS в Azure во время разработки.</span><span class="sxs-lookup"><span data-stu-id="7e70c-130">Azure Dev Spaces helps individual developers host their own unique version of AKS clusters in Azure during development.</span></span> <span data-ttu-id="7e70c-131">Это снизит требования к локальному компьютеру и позволит участникам группы быстро увидеть, как их изменения будут вести себя в реальной среде AKS.</span><span class="sxs-lookup"><span data-stu-id="7e70c-131">This minimizes local machine requirements and allows team members to quickly see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="7e70c-132">Azure Dev Spaces предлагает разработчикам интерфейс командной строки, который используется для управления пространствами разработки и для развертывания в определенном дочернем пространстве разработки по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="7e70c-132">Azure Dev Spaces offers a CLI for developers to use to manage their dev spaces and to deploy to a specific child dev space as needed.</span></span> <span data-ttu-id="7e70c-133">На каждое дочернее пространство разработки ссылается с помощью уникального поддомена URL-адресов, что позволяет разработчикам параллельно развертывать измененные кластеры, чтобы отдельные разработчики могли избежать конфликтов между работой, выполняемой друг с другом.</span><span class="sxs-lookup"><span data-stu-id="7e70c-133">Each child dev space is referenced using a unique URL subdomain, allowing side-by-side deployments of modified clusters so that individual developers can avoid conflicting with each other's work in progress.</span></span> <span data-ttu-id="7e70c-134">На рис. 2-7 можно увидеть, как разработчик Лилия развернул собственную версию микрослужбы велосипедов в своем пространстве разработки.</span><span class="sxs-lookup"><span data-stu-id="7e70c-134">In Figure 2-7 you can see how developer Susie has deployed her own version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="7e70c-135">Затем она может проверить свои изменения с помощью настраиваемого URL-адреса, начинающегося с имени своего пространства (susie.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="7e70c-135">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="7e70c-136">![архитектура eShopOnContainers](./media/azure-devspaces-one.png)
**рис. 2-7**.</span><span class="sxs-lookup"><span data-stu-id="7e70c-136">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="7e70c-137">Разработчик Лилия развертывает собственную версию микрослужбы велосипедов и тестирует ее.</span><span class="sxs-lookup"><span data-stu-id="7e70c-137">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="7e70c-138">В то же время разработчик Джон настраивает микрослужбу резервирования и должен протестировать свои изменения.</span><span class="sxs-lookup"><span data-stu-id="7e70c-138">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="7e70c-139">Он может развернуть свои изменения в своем собственном пространстве разработки без конфликта с изменениями Лилия, как показано на рис. 2-8.</span><span class="sxs-lookup"><span data-stu-id="7e70c-139">He's able to deploy his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="7e70c-140">Он может проверить свои изменения с помощью собственного URL-адреса, который имеет префикс с именем своего пространства (john.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="7e70c-140">He can test his changes using his own URL which is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="7e70c-141">![архитектура eShopOnContainers](./media/azure-devspaces-two.png)
**рис. 2-8**.</span><span class="sxs-lookup"><span data-stu-id="7e70c-141">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="7e70c-142">Разработчик Джон развертывает собственную версию микрослужбы резервирования и тестирует ее без конфликтов с другими разработчиками.</span><span class="sxs-lookup"><span data-stu-id="7e70c-142">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="7e70c-143">С помощью Azure Dev Spaces команды могут работать непосредственно с AKS, одновременно изменяя, развертывая и тестируя свои изменения.</span><span class="sxs-lookup"><span data-stu-id="7e70c-143">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="7e70c-144">Такой подход сокращает потребность в отдельных выделенных средах размещения, так как каждый разработчик эффективно имеет собственную среду AKS.</span><span class="sxs-lookup"><span data-stu-id="7e70c-144">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="7e70c-145">Разработчики могут работать с Azure Dev Spaces с помощью интерфейса командной строки или запускать свое приложение для Azure Dev Spaces непосредственно из Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7e70c-145">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="7e70c-146">Узнайте больше о том, как Azure Dev Spaces работает и настроена.</span><span class="sxs-lookup"><span data-stu-id="7e70c-146">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="7e70c-147">Функции и Logic Apps Azure (бессерверные)</span><span class="sxs-lookup"><span data-stu-id="7e70c-147">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="7e70c-148">Образец eShopOnContainers включает поддержку отслеживания маркетинговых кампаний.</span><span class="sxs-lookup"><span data-stu-id="7e70c-148">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="7e70c-149">Функция Azure используется для извлечения сведений о маркетинговой кампании для заданного идентификатора кампании.</span><span class="sxs-lookup"><span data-stu-id="7e70c-149">An Azure Function is used to pull marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="7e70c-150">Вместо создания полного ASP.NET Core приложения для этой цели будет проще и достаточно одной конечной точки функции Azure.</span><span class="sxs-lookup"><span data-stu-id="7e70c-150">Rather than creating a complete ASP.NET Core application for this purpose, a single Azure Function endpoint is simpler and sufficient.</span></span> <span data-ttu-id="7e70c-151">Функции Azure имеют гораздо более простую модель сборки и развертывания, чем полные ASP.NET Core приложения, особенно при настройке для работы в Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="7e70c-151">Azure Functions have a much simpler build and deployment model than full ASP.NET Core applications, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="7e70c-152">Развертывание функции в скрипте осуществляется с помощью шаблонов Azure Resource Manager (ARM) и Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="7e70c-152">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="7e70c-153">Эта кампания содержит сведения о том, что микрослужба не подходит для клиентов и не имеет тех же требований, что и Интернет-магазин, что делает его хорошим кандидатом для функций Azure.</span><span class="sxs-lookup"><span data-stu-id="7e70c-153">This campaign details microservice isn't customer-facing and doesn't have the same requirements as the online store, making it a good candidate for Azure Functions.</span></span> <span data-ttu-id="7e70c-154">Для правильной работы функции требуется определенная конфигурация, например данные строки подключения к базе данных и параметры базового URI изображения.</span><span class="sxs-lookup"><span data-stu-id="7e70c-154">The function requires some configuration to work properly, such as database connection string data and image base URI settings.</span></span> <span data-ttu-id="7e70c-155">Вы настраиваете функции Azure на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="7e70c-155">You configure Azure Functions in the Azure Portal.</span></span>

## <a name="references"></a><span data-ttu-id="7e70c-156">Ссылки</span><span class="sxs-lookup"><span data-stu-id="7e70c-156">References</span></span>

- <span data-ttu-id="7e70c-157">[eShopOnContainers: Создание кластера Kubernetes в AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="7e70c-157">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="7e70c-158">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="7e70c-158">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="7e70c-159">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="7e70c-159">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="7e70c-160">[Назад](map-eshoponcontainers-azure-services.md)
>[Вперед](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="7e70c-160">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
