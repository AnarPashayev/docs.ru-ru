---
title: Устойчивость платформы Azure
description: Создание архитектуры облачных приложений .NET для Azure | Устойчивость облачной инфраструктуры к Azure
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: 752f1320d9dfa18e52b078763d221a787da15e8e
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83613984"
---
# <a name="azure-platform-resiliency"></a><span data-ttu-id="00b5b-103">Устойчивость платформы Azure</span><span class="sxs-lookup"><span data-stu-id="00b5b-103">Azure platform resiliency</span></span>

<span data-ttu-id="00b5b-104">Создание надежного приложения в облаке отличается от традиционной разработки локальных приложений.</span><span class="sxs-lookup"><span data-stu-id="00b5b-104">Building a reliable application in the cloud is different from traditional on-premises application development.</span></span> <span data-ttu-id="00b5b-105">Хотя вы приобрели высокопроизводительное аппаратное обеспечение для увеличения масштаба в облачной среде, масштабируемой. Вместо того чтобы попытаться предотвратить сбои, цель состоит в том, чтобы свести к сведению их влияние и обеспечить стабильность системы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-105">While historically you purchased higher-end hardware to scale up, in a cloud environment you scale out. Instead of trying to prevent failures, the goal is to minimize their effects and keep the system stable.</span></span>

<span data-ttu-id="00b5b-106">С другой стороны, надежные облачные приложения отображают различные характеристики:</span><span class="sxs-lookup"><span data-stu-id="00b5b-106">That said, reliable cloud applications display distinct characteristics:</span></span>

- <span data-ttu-id="00b5b-107">Они устойчивы, устраняют проблемы и продолжают работать.</span><span class="sxs-lookup"><span data-stu-id="00b5b-107">They're resilient, recover gracefully from problems, and continue to function.</span></span>
- <span data-ttu-id="00b5b-108">Они являются высокодоступными (HA) и работают в нормальном состоянии без значительного простоя.</span><span class="sxs-lookup"><span data-stu-id="00b5b-108">They're highly available (HA) and run as designed in a healthy state with no significant downtime.</span></span>

<span data-ttu-id="00b5b-109">Понимание принципов совместной работы этих характеристик и их влияние на стоимость очень важно для создания надежного облачного приложения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-109">Understanding how these characteristics work together - and how they affect cost - is essential to building a reliable cloud-native application.</span></span> <span data-ttu-id="00b5b-110">Далее мы рассмотрим способы обеспечения устойчивости и доступности в собственных облачных приложениях, использующих функции из облака Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-110">We'll next look at ways that you can build resiliency and availability into your cloud-native applications leveraging features from the Azure cloud.</span></span>

## <a name="design-with-resiliency"></a><span data-ttu-id="00b5b-111">Проектирование с устойчивостью</span><span class="sxs-lookup"><span data-stu-id="00b5b-111">Design with resiliency</span></span>

<span data-ttu-id="00b5b-112">Мы говорили о устойчивости, позволяя приложению реагировать на сбой и продолжать работать.</span><span class="sxs-lookup"><span data-stu-id="00b5b-112">We've said resiliency enables your application to react to failure and still remain functional.</span></span> <span data-ttu-id="00b5b-113">Технический документ, [устойчивость в техническом документе по Azure](https://azure.microsoft.com/mediahandler/files/resourcefiles/resilience-in-azure-whitepaper/Resilience%20in%20Azure.pdf), содержит рекомендации по обеспечению устойчивости на платформе Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-113">The whitepaper, [Resilience in Azure whitepaper](https://azure.microsoft.com/mediahandler/files/resourcefiles/resilience-in-azure-whitepaper/Resilience%20in%20Azure.pdf), provides guidance for achieving resilience in the Azure platform.</span></span> <span data-ttu-id="00b5b-114">Ниже приведены некоторые ключевые рекомендации.</span><span class="sxs-lookup"><span data-stu-id="00b5b-114">Here are some key recommendations:</span></span>

- <span data-ttu-id="00b5b-115">*Сбой оборудования.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-115">*Hardware failure.*</span></span> <span data-ttu-id="00b5b-116">Создание избыточности в приложении путем развертывания компонентов в разных доменах сбоя.</span><span class="sxs-lookup"><span data-stu-id="00b5b-116">Build redundancy into the application by deploying components across different fault domains.</span></span> <span data-ttu-id="00b5b-117">Например, убедитесь, что виртуальные машины Azure размещены в разных стойках с помощью групп доступности.</span><span class="sxs-lookup"><span data-stu-id="00b5b-117">For example, ensure that Azure VMs are placed in different racks by using Availability Sets.</span></span>

- <span data-ttu-id="00b5b-118">*Сбой центра обработки данных.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-118">*Datacenter failure.*</span></span> <span data-ttu-id="00b5b-119">Постройте избыточность в приложении с зонами изоляции сбоев в центрах обработки данных.</span><span class="sxs-lookup"><span data-stu-id="00b5b-119">Build redundancy into the application with fault isolation zones across datacenters.</span></span> <span data-ttu-id="00b5b-120">Например, убедитесь, что виртуальные машины Azure размещены в разных центрах обработки данных, изолированных от сбоев, с помощью Зоны доступности Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-120">For example, ensure that Azure VMs are placed in different fault-isolated datacenters by using Azure Availability Zones.</span></span>

- <span data-ttu-id="00b5b-121">*Региональный сбой.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-121">*Regional failure.*</span></span> <span data-ttu-id="00b5b-122">Реплицировать данные и компоненты в другой регион, чтобы приложения можно было быстро восстановить.</span><span class="sxs-lookup"><span data-stu-id="00b5b-122">Replicate the data and components into another region so that applications can be quickly recovered.</span></span> <span data-ttu-id="00b5b-123">Например, используйте Azure Site Recovery для репликации виртуальных машин Azure в другой регион Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-123">For example, use Azure Site Recovery to replicate Azure VMs to another Azure region.</span></span>

- <span data-ttu-id="00b5b-124">*Высокая нагрузка.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-124">*Heavy load.*</span></span> <span data-ttu-id="00b5b-125">Балансировка нагрузки между экземплярами для решения пиков в использовании.</span><span class="sxs-lookup"><span data-stu-id="00b5b-125">Load balance across instances to handle spikes in usage.</span></span> <span data-ttu-id="00b5b-126">Например, можно разместить несколько виртуальных машин Azure за подсистемой балансировки нагрузки, чтобы распределить трафик на все виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="00b5b-126">For example, put two or more Azure VMs behind a load balancer to distribute traffic to all VMs.</span></span>

- <span data-ttu-id="00b5b-127">*Случайное удаление или повреждение данных.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-127">*Accidental data deletion or corruption.*</span></span> <span data-ttu-id="00b5b-128">Создайте резервные копии данных, чтобы их можно было восстановить в случае удаления или повреждения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-128">Back up data so it can be restored if there’s any deletion or corruption.</span></span> <span data-ttu-id="00b5b-129">Например, используйте Azure Backup для периодического резервного копирования виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-129">For example, use Azure Backup to periodically back up your Azure VMs.</span></span>

## <a name="design-with-redundancy"></a><span data-ttu-id="00b5b-130">Проектирование с избыточностью</span><span class="sxs-lookup"><span data-stu-id="00b5b-130">Design with redundancy</span></span>

<span data-ttu-id="00b5b-131">Ошибки различаются в области влияния.</span><span class="sxs-lookup"><span data-stu-id="00b5b-131">Failures vary in scope of impact.</span></span> <span data-ttu-id="00b5b-132">Сбой оборудования, например неисправный диск, может повлиять на отдельный узел в кластере.</span><span class="sxs-lookup"><span data-stu-id="00b5b-132">A hardware failure, such as a failed disk, can affect a single node in a cluster.</span></span> <span data-ttu-id="00b5b-133">Сбой сетевого коммутатора может повлиять на всю серверную стойку.</span><span class="sxs-lookup"><span data-stu-id="00b5b-133">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="00b5b-134">Менее распространенные сбои, например потери электроэнергии, могут нарушить работу всего центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="00b5b-134">Less common failures, such as loss of power, could disrupt a whole datacenter.</span></span> <span data-ttu-id="00b5b-135">В редких случаях весь регион становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="00b5b-135">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="00b5b-136">[Избыточность](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) — один из способов обеспечения устойчивости приложений.</span><span class="sxs-lookup"><span data-stu-id="00b5b-136">[Redundancy](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) is one way to provide application resilience.</span></span> <span data-ttu-id="00b5b-137">Точный уровень избыточности зависит от бизнес-требований и влияет на стоимость и сложность системы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-137">The exact level of redundancy needed depends upon your business requirements and will affect both the cost and complexity of your system.</span></span> <span data-ttu-id="00b5b-138">Например, развертывание в нескольких регионах является более затратным и сложным для управления, чем развертывание в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="00b5b-138">For example, a multi-region deployment is more expensive and more complex to manage than a single-region deployment.</span></span> <span data-ttu-id="00b5b-139">Для управления отработкой отказа и восстановлением размещения потребуются рабочие процедуры.</span><span class="sxs-lookup"><span data-stu-id="00b5b-139">You'll need operational procedures to manage failover and failback.</span></span> <span data-ttu-id="00b5b-140">Дополнительные затраты и сложность могут быть выровнены для некоторых бизнес-сценариев, но не для других.</span><span class="sxs-lookup"><span data-stu-id="00b5b-140">The additional cost and complexity might be justified for some business scenarios, but not others.</span></span>

<span data-ttu-id="00b5b-141">Для обеспечения избыточности архитектуры необходимо определить критические пути в приложении, а затем определить, есть ли избыточность в каждой точке пути?</span><span class="sxs-lookup"><span data-stu-id="00b5b-141">To architect redundancy, you need to identify the critical paths in your application, and then determine if there's redundancy at each point in the path?</span></span> <span data-ttu-id="00b5b-142">Если произойдет сбой подсистемы, будет ли приложение переключаться на другое?</span><span class="sxs-lookup"><span data-stu-id="00b5b-142">If a subsystem should fail, will the application fail over to something else?</span></span> <span data-ttu-id="00b5b-143">Наконец, вам потребуются четкое понимание функций, встроенных в облачную платформу Azure, которые можно использовать в соответствии с требованиями к избыточности.</span><span class="sxs-lookup"><span data-stu-id="00b5b-143">Finally, you need a clear understanding of those features built into the Azure cloud platform that you can leverage to meet your redundancy requirements.</span></span> <span data-ttu-id="00b5b-144">Ниже приведены рекомендации по проектированию избыточности.</span><span class="sxs-lookup"><span data-stu-id="00b5b-144">Here are recommendations for architecting redundancy:</span></span>

- <span data-ttu-id="00b5b-145">*Развертывайте несколько экземпляров служб.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-145">*Deploy multiple instances of services.*</span></span> <span data-ttu-id="00b5b-146">Если приложение зависит от одного экземпляра службы, создается единая точка отказа.</span><span class="sxs-lookup"><span data-stu-id="00b5b-146">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="00b5b-147">Подготовка нескольких экземпляров улучшает как отказоустойчивость, так и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="00b5b-147">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="00b5b-148">При размещении в службе Kubernetes Azure можно декларативно настроить избыточные экземпляры (наборы реплик) в файле манифеста Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="00b5b-148">When hosting in Azure Kubernetes Service, you can declaratively configure redundant instances (replica sets) in the Kubernetes manifest file.</span></span> <span data-ttu-id="00b5b-149">Значение счетчика реплик можно управлять программно, на портале или с помощью функций автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="00b5b-149">The replica count value can be managed programmatically, in the portal, or through autoscaling features.</span></span>

- <span data-ttu-id="00b5b-150">*Использование балансировщика нагрузки.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-150">*Leveraging a load balancer.*</span></span> <span data-ttu-id="00b5b-151">Балансировка нагрузки распределяет запросы приложения на работоспособные экземпляры службы и автоматически удаляет неработоспособные экземпляры из вращения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-151">Load-balancing distributes your application's requests to healthy service instances and automatically removes unhealthy instances from rotation.</span></span> <span data-ttu-id="00b5b-152">При развертывании в Kubernetes можно указать балансировку нагрузки в файле манифеста Kubernetes в разделе службы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-152">When deploying to Kubernetes, load balancing can be specified in the Kubernetes manifest file in the Services section.</span></span>

- <span data-ttu-id="00b5b-153">*Спланируйте развертывание в многорегионом.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-153">*Plan for multiregion deployment.*</span></span> <span data-ttu-id="00b5b-154">Если приложение развертывается в одном регионе и этот регион становится недоступным, приложение также становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="00b5b-154">If you deploy your application to a single region, and that region becomes unavailable, your application will also become unavailable.</span></span> <span data-ttu-id="00b5b-155">Это может быть неприемлемым в соответствии с условиями соглашений об уровне обслуживания вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-155">This may be unacceptable under the terms of your application's service level agreements.</span></span> <span data-ttu-id="00b5b-156">Вместо этого рассмотрите возможность развертывания приложения и его служб в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="00b5b-156">Instead, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="00b5b-157">Например, кластер Azure Kubernetes Service (AKS) развертывается в одном регионе.</span><span class="sxs-lookup"><span data-stu-id="00b5b-157">For example, an Azure Kubernetes Service (AKS) cluster is deployed to a single region.</span></span> <span data-ttu-id="00b5b-158">Чтобы защитить систему от региональных сбоев, можно развернуть приложение на нескольких кластерах AKS в разных регионах и использовать функцию [парных регионов](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) для координации обновлений платформы и определения приоритетов при восстановлении.</span><span class="sxs-lookup"><span data-stu-id="00b5b-158">To protect your system from a regional failure, you might deploy your application to multiple AKS clusters across different regions and use the [Paired Regions](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) feature to coordinate platform updates and prioritize recovery efforts.</span></span>

- <span data-ttu-id="00b5b-159">*Включите [георепликацию](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span><span class="sxs-lookup"><span data-stu-id="00b5b-159">*Enable [geo-replication](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span></span> <span data-ttu-id="00b5b-160">Георепликация для таких служб, как база данных SQL Azure и Cosmos DB, создает вторичные реплики данных в нескольких регионах.</span><span class="sxs-lookup"><span data-stu-id="00b5b-160">Geo-replication for services such as Azure SQL Database and Cosmos DB will create secondary replicas of your data across multiple regions.</span></span> <span data-ttu-id="00b5b-161">Хотя обе службы будут автоматически реплицировать данные в пределах одного региона, Георепликация защищает вас от регионального сбоя, позволяя выполнять отработку отказа в дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="00b5b-161">While both services will automatically replicate data within the same region, geo-replication protects you against a regional outage by enabling you to fail over to a secondary region.</span></span> <span data-ttu-id="00b5b-162">Еще одна рекомендация для центров георепликации, связанных с хранением образов контейнеров.</span><span class="sxs-lookup"><span data-stu-id="00b5b-162">Another best practice for geo-replication centers around storing container images.</span></span> <span data-ttu-id="00b5b-163">Чтобы развернуть службу в AKS, необходимо сохранить образ и извлечь его из репозитория.</span><span class="sxs-lookup"><span data-stu-id="00b5b-163">To deploy a service in AKS, you need to store and pull the image from a repository.</span></span> <span data-ttu-id="00b5b-164">Реестр контейнеров Azure интегрируется с AKS и может безопасно хранить образы контейнеров.</span><span class="sxs-lookup"><span data-stu-id="00b5b-164">Azure Container Registry integrates with AKS and can securely store container images.</span></span> <span data-ttu-id="00b5b-165">Чтобы повысить производительность и доступность, рассмотрите возможность георепликации образов в реестр в каждом регионе, где имеется кластер AKS.</span><span class="sxs-lookup"><span data-stu-id="00b5b-165">To improve performance and availability, consider geo-replicating your images to a registry in each region where you have an AKS cluster.</span></span> <span data-ttu-id="00b5b-166">Затем каждый кластер AKS извлекает образы контейнеров из локального реестра контейнеров в своем регионе, как показано на рисунке 6-4:</span><span class="sxs-lookup"><span data-stu-id="00b5b-166">Each AKS cluster then pulls container images from the local container registry in its region as shown in Figure 6-4:</span></span>

![Реплицированные ресурсы в разных регионах](./media/replicated-resources.png)

<span data-ttu-id="00b5b-168">**Рис. 6-4**.</span><span class="sxs-lookup"><span data-stu-id="00b5b-168">**Figure 6-4**.</span></span> <span data-ttu-id="00b5b-169">Реплицированные ресурсы в разных регионах</span><span class="sxs-lookup"><span data-stu-id="00b5b-169">Replicated resources across regions</span></span>

- <span data-ttu-id="00b5b-170">*Реализуйте подсистему балансировки нагрузки для трафика DNS.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-170">*Implement a DNS traffic load balancer.*</span></span> <span data-ttu-id="00b5b-171">[Диспетчер трафика Azure](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) обеспечивает высокую доступность критически важных приложений с помощью балансировки нагрузки на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="00b5b-171">[Azure Traffic Manager](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) provides high-availability for critical applications by load-balancing at the DNS level.</span></span> <span data-ttu-id="00b5b-172">Он может направить трафик в разные регионы на основе географии, времени отклика кластера и даже работоспособности конечной точки приложения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-172">It can route traffic to different regions based on geography, cluster response time, and even application endpoint health.</span></span> <span data-ttu-id="00b5b-173">Например, диспетчер трафика Azure может направлять клиентов в ближайший кластер AKS и экземпляр приложения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-173">For example, Azure Traffic Manager can direct customers to the closest AKS cluster and application instance.</span></span> <span data-ttu-id="00b5b-174">Если у вас несколько кластеров AKS в разных регионах, используйте диспетчер трафика для управления передачей трафика в приложения, выполняемые в каждом кластере.</span><span class="sxs-lookup"><span data-stu-id="00b5b-174">If you have multiple AKS clusters in different regions, use Traffic Manager to control how traffic flows to the applications that run in each cluster.</span></span> <span data-ttu-id="00b5b-175">Этот сценарий показан на рис. 6-5.</span><span class="sxs-lookup"><span data-stu-id="00b5b-175">Figure 6-5 shows this scenario.</span></span>

![AKS и диспетчер трафика Azure](./media/aks-traffic-manager.png)

<span data-ttu-id="00b5b-177">**Рис. 6-5**.</span><span class="sxs-lookup"><span data-stu-id="00b5b-177">**Figure 6-5**.</span></span> <span data-ttu-id="00b5b-178">AKS и диспетчер трафика Azure</span><span class="sxs-lookup"><span data-stu-id="00b5b-178">AKS and Azure Traffic Manager</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="00b5b-179">Проектирование для масштабируемости</span><span class="sxs-lookup"><span data-stu-id="00b5b-179">Design for scalability</span></span>

<span data-ttu-id="00b5b-180">Облако не зависит от масштабирования.</span><span class="sxs-lookup"><span data-stu-id="00b5b-180">The cloud thrives on scaling.</span></span> <span data-ttu-id="00b5b-181">Возможность увеличения или уменьшения системных ресурсов для повышения или снижения загрузки системы — ключевой принцип облака Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-181">The ability to increase/decrease system resources to address increasing/decreasing system load is a key tenet of the Azure cloud.</span></span> <span data-ttu-id="00b5b-182">Но для эффективного масштабирования приложения необходимо понимать возможности масштабирования каждой службы Azure, включенной в приложение.</span><span class="sxs-lookup"><span data-stu-id="00b5b-182">But, to effectively scale an application, you need an understanding of the scaling features of each Azure service that you include in your application.</span></span>  <span data-ttu-id="00b5b-183">Ниже приведены рекомендации по эффективному внедрению масштабирования в системе.</span><span class="sxs-lookup"><span data-stu-id="00b5b-183">Here are recommendations for effectively implementing scaling in your system.</span></span>

- <span data-ttu-id="00b5b-184">*Проектирование для масштабирования.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-184">*Design for scaling.*</span></span> <span data-ttu-id="00b5b-185">Приложение должно быть спроектировано для масштабирования.</span><span class="sxs-lookup"><span data-stu-id="00b5b-185">An application must be designed for scaling.</span></span> <span data-ttu-id="00b5b-186">Для начала службы должны быть без отслеживания состояния, чтобы запросы могли маршрутизироваться к любому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="00b5b-186">To start, services should be stateless so that requests can be routed to any instance.</span></span> <span data-ttu-id="00b5b-187">Наличие служб без отслеживания состояния также означает, что добавление или удаление экземпляра не оказывает негативного воздействия на текущих пользователей.</span><span class="sxs-lookup"><span data-stu-id="00b5b-187">Having stateless services also means that adding or removing an instance doesn't adversely impact current users.</span></span>

- <span data-ttu-id="00b5b-188">*Рабочие нагрузки секционирования*.</span><span class="sxs-lookup"><span data-stu-id="00b5b-188">*Partition workloads*.</span></span> <span data-ttu-id="00b5b-189">Разбиение доменов на независимые, автономные микрослужбы позволяют каждой службе масштабироваться независимо от других.</span><span class="sxs-lookup"><span data-stu-id="00b5b-189">Decomposing domains into independent, self-contained microservices enable each service to scale independently of others.</span></span> <span data-ttu-id="00b5b-190">Как правило, службы будут иметь различные потребности и требования к масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="00b5b-190">Typically, services will have different scalability needs and requirements.</span></span> <span data-ttu-id="00b5b-191">Секционирование позволяет масштабировать только то, что нужно масштабировать, без затрат на масштабирование всего приложения.</span><span class="sxs-lookup"><span data-stu-id="00b5b-191">Partitioning enables you to scale only what needs to be scaled without the unnecessary cost of scaling an entire application.</span></span>

- <span data-ttu-id="00b5b-192">*Предпочитать развертывание.* Облачные приложения имеют приоритетное масштабирование ресурсов, а не масштабирование.</span><span class="sxs-lookup"><span data-stu-id="00b5b-192">*Favor scale-out.* Cloud-based applications favor scaling out resources as opposed to scaling up.</span></span> <span data-ttu-id="00b5b-193">Масштабирование (также называемое горизонтальным масштабированием) включает в себя добавление дополнительных ресурсов службы в существующую систему для удовлетворения и предоставления общего доступа к желаемому уровню производительности.</span><span class="sxs-lookup"><span data-stu-id="00b5b-193">Scaling out (also known as horizontal scaling) involves adding more service resources to an existing system to meet and share a desired level of performance.</span></span> <span data-ttu-id="00b5b-194">Увеличение масштаба (также известное как вертикальное масштабирование) подразумевает замену существующих ресурсов более мощным оборудованием (большим объемом диска, памяти и вычислительных ядер).</span><span class="sxs-lookup"><span data-stu-id="00b5b-194">Scaling up (also known as vertical scaling) involves replacing existing resources with more powerful hardware (more disk, memory, and processing cores).</span></span> <span data-ttu-id="00b5b-195">Масштабирование можно вызывать автоматически с помощью функций автомасштабирования, доступных в некоторых облачных ресурсах Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-195">Scaling out can be invoked automatically with the autoscaling features available in some Azure cloud resources.</span></span> <span data-ttu-id="00b5b-196">Масштабирование по нескольким ресурсам также увеличивает избыточность всей системы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-196">Scaling out across multiple resources also adds redundancy to the overall system.</span></span> <span data-ttu-id="00b5b-197">Наконец, увеличение масштаба одного ресурса обычно является более затратным, чем масштабирование по многим небольшим ресурсам.</span><span class="sxs-lookup"><span data-stu-id="00b5b-197">Finally scaling up a single resource is typically more expensive than scaling out across many smaller resources.</span></span> <span data-ttu-id="00b5b-198">На рис. 6-6 показаны два подхода:</span><span class="sxs-lookup"><span data-stu-id="00b5b-198">Figure 6-6 shows the two approaches:</span></span>

![Увеличение масштаба и масштабирование](./media/scale-up-scale-out.png)

<span data-ttu-id="00b5b-200">**Рис. 6-6.**</span><span class="sxs-lookup"><span data-stu-id="00b5b-200">**Figure 6-6.**</span></span> <span data-ttu-id="00b5b-201">Увеличение масштаба и масштабирование</span><span class="sxs-lookup"><span data-stu-id="00b5b-201">Scale up versus scale out</span></span>

- <span data-ttu-id="00b5b-202">*Пропорциональное масштабирование.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-202">*Scale proportionally.*</span></span> <span data-ttu-id="00b5b-203">При масштабировании службы следует подумать о *наборах ресурсов*.</span><span class="sxs-lookup"><span data-stu-id="00b5b-203">When scaling a service, think in terms of *resource sets*.</span></span> <span data-ttu-id="00b5b-204">Если вы хотите радикально масштабировать определенную службу, каково влияние на серверные хранилища данных, кэши и зависимые службы?</span><span class="sxs-lookup"><span data-stu-id="00b5b-204">If you were to dramatically scale out a specific service, what impact would that have on back-end data stores, caches and dependent services?</span></span> <span data-ttu-id="00b5b-205">Некоторые ресурсы, такие как Cosmos DB, могут масштабироваться пропорционально, а многие другие — нет.</span><span class="sxs-lookup"><span data-stu-id="00b5b-205">Some resources such as Cosmos DB can scale out proportionally, while many others can't.</span></span> <span data-ttu-id="00b5b-206">Необходимо убедиться, что вы не масштабируете ресурс до точки, в которой он будет исчерпан другие связанные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-206">You want to ensure that you don't scale out a resource to a point where it will exhaust other associated resources.</span></span>

- <span data-ttu-id="00b5b-207">*Избегайте сходства.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-207">*Avoid affinity.*</span></span> <span data-ttu-id="00b5b-208">Рекомендуется убедиться, что узел не требует локального сходства, часто называемый *прикрепленным сеансом*.</span><span class="sxs-lookup"><span data-stu-id="00b5b-208">A best practice is to ensure a node doesn't require local affinity, often referred to as a *sticky session*.</span></span> <span data-ttu-id="00b5b-209">Запрос должен иметь возможность маршрутизироваться к любому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="00b5b-209">A request should be able to route to any instance.</span></span> <span data-ttu-id="00b5b-210">Если необходимо сохранить состояние, его следует сохранить в распределенном кэше, например в [кэше Redis для Azure](https://azure.microsoft.com/services/cache/).</span><span class="sxs-lookup"><span data-stu-id="00b5b-210">If you need to persist state, it should be saved to a distributed cache, such as [Azure Redis cache](https://azure.microsoft.com/services/cache/).</span></span>

- <span data-ttu-id="00b5b-211">*Воспользуйтесь преимуществами функций автомасштабирования платформы.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-211">*Take advantage of platform autoscaling features.*</span></span> <span data-ttu-id="00b5b-212">Используйте встроенные функции автомасштабирования, когда это возможно, а не пользовательские или сторонние механизмы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-212">Use built-in autoscaling features whenever possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="00b5b-213">Там, где это возможно, используйте правила запланированного масштабирования, чтобы обеспечить доступность ресурсов без задержки запуска, но при необходимости добавьте автоматическое масштабирование для соответствующих правил, чтобы справиться с непредвиденными изменениями по запросу.</span><span class="sxs-lookup"><span data-stu-id="00b5b-213">Where possible, use scheduled scaling rules to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules as appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="00b5b-214">Дополнительные сведения см. в разделе [руководство по автомасштабированию](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling).</span><span class="sxs-lookup"><span data-stu-id="00b5b-214">For more information, see [Autoscaling guidance](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling).</span></span>

- <span data-ttu-id="00b5b-215">*Интенсивное горизонтальное масштабирование.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-215">*Scale out aggressively.*</span></span> <span data-ttu-id="00b5b-216">Последняя практика заключается в необходимости горизонтального масштабирования, чтобы можно было быстро удовлетворить немедленные всплески трафика без потери бизнеса.</span><span class="sxs-lookup"><span data-stu-id="00b5b-216">A final practice would be to scale out aggressively so that you can quickly meet immediate spikes in traffic without losing business.</span></span> <span data-ttu-id="00b5b-217">А затем масштабировать (то есть удалять ненужные экземпляры) консервативно, чтобы обеспечить стабильность системы.</span><span class="sxs-lookup"><span data-stu-id="00b5b-217">And, then scale in (that is, remove unneeded instances) conservatively to keep the system stable.</span></span> <span data-ttu-id="00b5b-218">Простой способ реализации этого — задать период охлаждения, который является временем ожидания между операциями масштабирования, до пяти минут для добавления ресурсов и до 15 минут для удаления экземпляров.</span><span class="sxs-lookup"><span data-stu-id="00b5b-218">A simple way to implement this is to set the cool down period, which is the time to wait between scaling operations, to five minutes for adding resources and up to 15 minutes for removing instances.</span></span>

## <a name="built-in-retry-in-services"></a><span data-ttu-id="00b5b-219">Встроенные повторные попытки в службах</span><span class="sxs-lookup"><span data-stu-id="00b5b-219">Built-in retry in services</span></span>

<span data-ttu-id="00b5b-220">Рекомендуется реализовать программные операции повторного выполнения в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="00b5b-220">We encouraged the best practice of implementing programmatic retry operations in an earlier section.</span></span> <span data-ttu-id="00b5b-221">Помните, что многие службы Azure и соответствующие клиентские пакеты SDK также включают механизмы повтора.</span><span class="sxs-lookup"><span data-stu-id="00b5b-221">Keep in mind that many Azure services and their corresponding client SDKs also include retry mechanisms.</span></span> <span data-ttu-id="00b5b-222">В следующем списке перечислены функции повтора во многих службах Azure, обсуждаемых в этой книге:</span><span class="sxs-lookup"><span data-stu-id="00b5b-222">The following list summarizes retry features in the many of the Azure services that are discussed in this book:</span></span>

- <span data-ttu-id="00b5b-223">*Azure Cosmos DB.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-223">*Azure Cosmos DB.*</span></span> <span data-ttu-id="00b5b-224"><xref:Microsoft.Azure.Documents.Client.DocumentClient>Класс из API клиента автоматически выполняет неудачные попытки.</span><span class="sxs-lookup"><span data-stu-id="00b5b-224">The <xref:Microsoft.Azure.Documents.Client.DocumentClient> class from the client API automatically retires failed attempts.</span></span> <span data-ttu-id="00b5b-225">Количество повторных попыток и максимальное время ожидания можно настроить.</span><span class="sxs-lookup"><span data-stu-id="00b5b-225">The number of retries and maximum wait time are configurable.</span></span> <span data-ttu-id="00b5b-226">Исключения, вызываемые API клиента, — это запросы, превышающие политику повтора или невременные ошибки.</span><span class="sxs-lookup"><span data-stu-id="00b5b-226">Exceptions thrown by the client API are either requests that exceed the retry policy or non-transient errors.</span></span>

- <span data-ttu-id="00b5b-227">*Кэш Redis для Azure.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-227">*Azure Redis Cache.*</span></span> <span data-ttu-id="00b5b-228">Клиент Redis StackExchange использует класс диспетчера соединений, который включает повторные попытки при неудачных попытках.</span><span class="sxs-lookup"><span data-stu-id="00b5b-228">The Redis StackExchange client uses a connection manager class that includes retries on failed attempts.</span></span> <span data-ttu-id="00b5b-229">Количество повторных попыток, политика повтора и время ожидания являются настраиваемыми.</span><span class="sxs-lookup"><span data-stu-id="00b5b-229">The number of retries, specific retry policy and wait time are all configurable.</span></span>

- <span data-ttu-id="00b5b-230">*Служебная шина Azure.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-230">*Azure Service Bus.*</span></span> <span data-ttu-id="00b5b-231">Клиент служебной шины предоставляет [класс RetryPolicy](xref:Microsoft.ServiceBus.RetryPolicy) , для которого можно настроить интервал обратной передачи, число повторных попыток и <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer%2A> значение, указывающее максимальное время, которое может занять операция.</span><span class="sxs-lookup"><span data-stu-id="00b5b-231">The Service Bus client exposes a [RetryPolicy class](xref:Microsoft.ServiceBus.RetryPolicy) that can be configured with a back-off interval, retry count, and <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer%2A>, which specifies the maximum time an operation can take.</span></span> <span data-ttu-id="00b5b-232">Политика по умолчанию — девять максимальных повторных попыток с 30-секундным периодом пересчета между попытками.</span><span class="sxs-lookup"><span data-stu-id="00b5b-232">The default policy is nine maximum retry attempts with a 30-second backoff period between attempts.</span></span>

- <span data-ttu-id="00b5b-233">*База данных SQL Azure.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-233">*Azure SQL Database.*</span></span> <span data-ttu-id="00b5b-234">Поддержка повторных попыток предоставляется при использовании библиотеки [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) .</span><span class="sxs-lookup"><span data-stu-id="00b5b-234">Retry support is provided when using the [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) library.</span></span>

- <span data-ttu-id="00b5b-235">*Служба хранилища Azure.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-235">*Azure Storage.*</span></span> <span data-ttu-id="00b5b-236">Клиентская библиотека хранилища поддерживает операции повтора.</span><span class="sxs-lookup"><span data-stu-id="00b5b-236">The storage client library support retry operations.</span></span> <span data-ttu-id="00b5b-237">Стратегии различаются для таблиц, больших двоичных объектов и очередей службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="00b5b-237">The strategies vary across Azure storage tables, blobs, and queues.</span></span> <span data-ttu-id="00b5b-238">Кроме того, при включении функции геоизбыточности можно также переключаться между расположениями служб основного и дополнительного хранилищ.</span><span class="sxs-lookup"><span data-stu-id="00b5b-238">As well, alternate retries switch between primary and secondary storage services locations when the geo-redundancy feature is enabled.</span></span>

- <span data-ttu-id="00b5b-239">*Концентраторы событий Azure.*</span><span class="sxs-lookup"><span data-stu-id="00b5b-239">*Azure Event Hubs.*</span></span> <span data-ttu-id="00b5b-240">Клиентская библиотека концентратора событий поддерживает свойство RetryPolicy, которое включает в себя настраиваемую функцию экспоненциальной задержки.</span><span class="sxs-lookup"><span data-stu-id="00b5b-240">The Event Hub client library features a RetryPolicy property, which includes a configurable exponential backoff feature.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="00b5b-241">[Назад](application-resiliency-patterns.md)
>[Вперед](resilient-communications.md)</span><span class="sxs-lookup"><span data-stu-id="00b5b-241">[Previous](application-resiliency-patterns.md)
[Next](resilient-communications.md)</span></span>
