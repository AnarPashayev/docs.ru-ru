---
title: Развертывание контейнеров в Azure
description: Развертывание контейнеров в Azure с помощью реестра контейнеров Azure, службы Kubernetes Azure и Azure Dev Spaces.
ms.date: 06/30/2019
ms.openlocfilehash: 6d95db26b6a45dd6825c88693308ffe90d1ed071
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/23/2019
ms.locfileid: "73840487"
---
# <a name="deploying-containers-in-azure"></a>Развертывание контейнеров в Azure

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

Контейнеры предоставляют множество преимуществ, одно из которых является переносимостью. Вы можете легко взять тот же контейнер, который вы разработали и тестировали локально, и развернуть в Azure, где он может запускать приложение в промежуточной и рабочей средах. Azure предоставляет ряд возможностей для размещения приложений на основе контейнеров, а также поддерживает несколько различных средств развертывания. Наиболее распространенным и наиболее гибким подходом является развертывание контейнеров в реестре контейнеров Azure (запись контроля доступа), где они доступны для тех служб, которые вы хотите использовать для их размещения. Azure Веб-приложение для контейнеров, Azure Kubernetes Services (AKS) и экземпляр контейнера Azure (ACI) имеют доступ к образам контейнеров, которые были отправлены в запись контроля доступа.

## <a name="azure-container-registry"></a>Реестр контейнеров Azure

Реестр контейнеров Azure (запись контроля доступа) позволяет создавать и хранить образы, а также управлять ими для всех развертываний контейнеров. Существуют и общедоступные и закрытые реестры контейнеров, в которых можно развертывать контейнеры. Преимущество записей контроля доступа в других вариантах заключается в том, что вы можете постоянно размещать свои образы в рабочей среде, улучшая время сборки и развертывания. Их также можно защитить с помощью тех же процедур безопасности, которые используются для остальных ресурсов Azure, что повышает безопасность и сокращает усилия по управлению ресурсами.

[Реестр контейнеров создается с помощью портала Azure](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-portal) или средств [Azure CLI](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-azure-cli) или [PowerShell](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-powershell). Для создания нового реестра контейнеров требуется только подписка Azure, Группа ресурсов и уникальное имя. На рис. 3-11 показаны основные параметры для создания реестра, который будет размещен на сайте *регистринаме*. azurecr.IO.

![создать реестр контейнеров](./media/create-container-registry.png)
**рис. 3-11**. Создание реестра контейнеров

После создания реестра для его использования необходимо пройти проверку подлинности. Как правило, вы входите в реестр с помощью команды Azure CLI:

```azurecli
az acr login --name *registryname*
```

После создания реестра в реестре контейнеров Azure можно использовать команды DOCKER для отправки в нее образов контейнеров. Однако перед тем, как это сделать, необходимо пометить образ полным именем (URL-адресом) сервера входа в систему контроля доступа. Это будет иметь формат *регистринаме*. azurecr.IO.

```console
docker tag mycontainer myregistry.azurecr.io/mycontainer:v1
```

После маркировки изображения используйте команду `docker push`, чтобы отправить образ в экземпляр записи контроля доступа.

```console
docker push myregistry.azurecr.io/mycontainer:v1
```

После отправки образа в реестр рекомендуется удалить образ из локальной среды DOCKER, выполнив следующую команду:

```console
docker rmi myregistry.azurecr.io/mycontainer:v1
```

Разработчикам редко приходится напрямую отправлять свои компьютеры в реестр контейнеров. Вместо этого этот процесс должен быть ответственным за создание конвейера сборки, определенного в средстве, например Azure DevOps. Дополнительные сведения см. в [разделе, посвященном облаку, в машинном DevOps](devops.md).

## <a name="azure-kubernetes-service"></a>Служба контейнеров Azure

Если приложение на основе контейнера включает несколько контейнеров, вам, скорее всего, потребуется определить и управлять взаимодействием между контейнерами с помощью *Orchestrator* , например Kubernetes. После развертывания образов контейнеров в записи контроля доступа можно легко настроить службы Azure Kubernetes Services для автоматического развертывания обновленных образов из записи контроля доступа. С помощью полного конвейера CI/CD можно настроить стратегию [выпуска ранний](https://martinfowler.com/bliki/CanaryRelease.html) , чтобы снизить риски, связанные с быстро развертываемыми обновлениями. Новая версия приложения изначально настраивается в рабочей среде без маршрутизации трафика, а затем небольшое число пользователей направляется в развернутую версию приложения. По мере того, как группа получает уверенность в новой версии программного обеспечения, становятся доступны дополнительные экземпляры новой версии, и экземпляры предыдущей версии будут удалены. AKS легко поддерживает этот стиль развертывания.

Как и в случае с большинством ресурсов в Azure, вы можете создавать кластеры Kubernetes Azure с помощью портала или с помощью средств командной строки или средств автоматизации инфраструктуры, таких как Helm или terraform. Чтобы начать работу с новым кластером, необходимо предоставить следующие сведения:

- Подписка Azure
- Группа ресурсов
- Имя кластера Kubernetes
- Region
- Версия Kubernetes
- Префикс DNS-имени
- Размер узла
- Число узлов

Эти сведения достаточно для начала работы. В рамках процесса создания на портале Azure можно также настроить параметры для следующих функций кластера:

- Масштаб
- Проверка подлинности
- Сети
- Мониторинг
- Tags

Это [Краткое руководство содержит инструкции по развертыванию кластера AKS с помощью портал Azure](https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal).

## <a name="azure-dev-spaces"></a>Azure Dev Spaces

Комплексные кластеры Kubernetes могут потребовать значительных ресурсов для размещения, что может усложнить для разработчиков запуск всего приложения на одном компьютере (особенно на ноутбуке). Azure Dev Spaces предлагает это решение, позволяя разработчикам работать с собственными версиями кластеров Azure Kubernetes, размещенных в Azure. Azure Dev Spaces предназначен для упрощения разработки приложений на основе микрослужб с помощью AKS.

Чтобы понять ценность Azure Dev Spaces, предоставьте мне общий доступ к этому предложению из Гейб Монрой, а также ведущих контейнеров на Microsoft Azure:

"Представьте, что новый сотрудник пытается исправить ошибку в сложном приложении микрослужб, состоящем из десятков компонентов, каждый из которых имеет собственную конфигурацию и резервные службы. Чтобы приступить к работе, необходимо настроить локальную среду разработки, чтобы она могла имитировать работу, включая настройку интегрированной среды разработки, сборку цепочки инструментов, контейнерные зависимости служб, локальную среду Kubernetes, макеты для резервных служб и многое другое. Во время настройки среды разработки исправление этой первой ошибки может занять дни.

> Также можно использовать пространства разработки и AKS ".

Процесс работы с Azure Dev Spaces состоит из следующих этапов.

1. Создайте пространство разработки.
2. Настройте корневое пространство разработки.
3. Настройка дочернего пространства разработки (для собственной версии системы).
4. Подключитесь к пространству разработки.

Все эти действия можно выполнить с помощью Azure CLI и новых средств командной строки `azds`. Например, чтобы создать новое пространство разработки Azure для данного кластера Kubernetes, используйте следующую команду:

```azurecli
az aks use-dev-spaces -g my-aks-resource-group -n MyAKSCluster
```

Затем можно использовать команду `azds prep`, чтобы создать необходимые ресурсы диаграммы DOCKER и Helm для запуска приложения. Затем запустите код в AKS с помощью `azds up`. При первом выполнении этой команды будет установлена диаграмма Helm, а контейнеры будут созданы и развернуты в соответствии с инструкциями. Это может занять несколько минут при первом запуске. Однако после внесения изменений можно подключиться к своему дочернему пространству разработки с помощью `azds space select` а затем развернуть и отладить обновления в изолированном дочернем пространстве разработки. После создания и запуска пространства разработки можно отправить его обновления, повторно выполнив команду `azds up` или воспользоваться встроенными инструментами в Visual Studio или Visual Studio Code. С помощью VS Code палитра команд используется для подключения к пространству разработки. На рис. 3-12 показано, как запустить веб-приложение с помощью Azure Dev Spaces в Visual Studio.

![подключиться к Azure Dev Spaces в Visual Studio](./media/azure-dev-spaces-visual-studio-launchsettings.png)
**рис. 3-12**. Подключение к Azure Dev Spaces в Visual Studio

## <a name="references"></a>Ссылки

- [Выпуск ранний](https://martinfowler.com/bliki/CanaryRelease.html)
- [Azure Dev Spaces с VS Code](https://docs.microsoft.com/azure/dev-spaces/quickstart-netcore)
- [Azure Dev Spaces с помощью Visual Studio](https://docs.microsoft.com/azure/dev-spaces/quickstart-netcore-visualstudio)

>[!div class="step-by-step"]
>[Назад](combine-containers-serverless-approaches.md)
>[Вперед](scale-containers-serverless.md)
