---
title: Безопасность Azure для облачных приложений
description: Архитектура облачных приложений Native .NET для Azure (ru) Безопасность Azure для облачных приложений
ms.date: 06/30/2019
ms.openlocfilehash: 13b5ad7a883a83014913fa0a6a020610c28c524f
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "80989146"
---
# <a name="azure-security-for-cloud-native-apps"></a>Безопасность Azure для облачных приложений

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

Облачные приложения могут быть проще и сложнее в безопасности, чем традиционные приложения. С этой стороны, необходимо обеспечить более мелкие приложения и выделить больше энергии для создания инфраструктуры безопасности. Неоднородный характер языков и стилей программирования в большинстве развертываний служб также означает, что необходимо уделять больше внимания бюллетеням по безопасности от многих различных поставщиков.

С другой стороны, меньшие службы, каждый из которых имеет свой собственный хранилище данных, ограничивают область действия атаки. Если злоумышленник скомпрометирует одну систему, злоумышленнику, вероятно, сложнее перейти в другую систему, чем в монолитном приложении. Границы процесса являются сильными границами. Кроме того, если резервное копирование базы данных утекает, то ущерб является более ограниченным, так как эта база данных содержит только подмножество данных и вряд ли будет содержать персональные данные.

## <a name="threat-modeling"></a>Моделирование угроз

Независимо от того, перевешивают ли преимущества недостатки облачных приложений, необходимо следовать тому же целостному менталитету безопасности. Безопасность и безопасное мышление должны быть частью каждого шага истории развития и операций. При планировании приложения задавайте такие вопросы, как:

- Каково будет влияние этих данных теряется?
- Как мы можем ограничить ущерб от плохих данных, впрыскиваемых в эту службу?
- Кто должен иметь доступ к этим данным?
- Существуют ли политики аудита в процессе разработки и выпуска?

Все эти вопросы являются частью процесса, называемого [моделированием угроз.](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool) Этот процесс пытается ответить на вопрос о том, какие угрозы существуют для системы, насколько вероятны угрозы, и потенциальный ущерб от них.

После того, как список угроз был создан, необходимо решить, стоит ли их смягчать. Иногда угроза настолько маловероятна и дорогая для того чтобы запланировать для что не стоимость тратить энергию на ем. Например, некоторые субъекты государственного уровня могут внести изменения в конструкцию процесса, который используется миллионами устройств. Теперь, вместо того, чтобы запускать определенный фрагмент кода в [Ring 3,](https://en.wikipedia.org/wiki/Protection_ring)этот код работает в Ring 0. Это позволяет использовать, который может обойти гипервизор а также запустить код атаки на голые металлические машины, позволяя атак на все виртуальные машины, которые работают на этом оборудовании.

Измененные процессоры трудно обнаружить без микроскопа и передовые знания о кремниевой дизайн этого процессора. Этот сценарий вряд ли произойдет и дорого смягчить, так что, вероятно, ни одна модель угрозы не рекомендовалбы бы защиту от эксплуатации для него.

Более вероятные угрозы, такие как `Id` сломанные элементы управления `Id=2` `Id=3` доступом, позволяющие приращаться к атакам (замена на URL) или инъекция СЗЛ, более привлекательны для создания защиты от. Смягчения этих угроз вполне разумно построить и предотвратить неловкие дыры в безопасности, которые мазок репутации компании.

## <a name="principle-of-least-privilege"></a>Принципы минимальных привилегий

Одной из основополагающих идей в области компьютерной безопасности является принцип наименьшей привилегии (POLP). Это на самом деле основополагающая идея в большинстве любой форме безопасности будь то цифровой или физической. Короче говоря, принцип заключается в том, что любой пользователь или процесс должен иметь наименьшее количество прав, которые могут быть выполнены для выполнения своей задачи.

В качестве примера, подумайте о кассирах в банке: доступ к сейфу является необычным видом деятельности. Таким образом, средний кассейн не может открыть сейф самостоятельно. Чтобы получить доступ, они должны эскалации их запрос через менеджера банка, который выполняет дополнительные проверки безопасности.

В компьютерной системе фантастическим примером является права пользователя, подключенного к базе данных. Во многих случаях существует единая учетная запись пользователя, используемая как для построения структуры базы данных, так и для запуска приложения. За исключением крайних случаев, учетная запись, работая в приложении, не нуждается в возможности обновления информации о схеме. Должно быть несколько учетных записей, которые обеспечивают различные уровни привилегий. Приложение должно использовать только уровень разрешения, который предоставляет читать и писать доступ к данным в таблицах. Этот вид защиты устраняет атаки, направленные на падение таблиц баз данных или введение вредоносных триггеров.

Почти каждая часть создания облачного приложения может извлечь выгоду из того, что мы помня о принципе наименьших привилегий. Вы можете найти его в игре при настройке брандмауэров, групп сетевой безопасности, ролей и областей в управлении доступом на основе ролей (RBAC).

## <a name="penetration-testing"></a>тестирование уязвимости;

По мере усложнения приложений число векторов атак увеличивается с угрожающей скоростью. Моделирование угроз является ошибочным в том, что оно, как правило, выполняется теми же людьми, строяющими систему. Таким же образом, что многие разработчики испытывают трудности с представлением о взаимодействии пользователей, а затем по созданию непригодных пользовательских интерфейсов, большинство разработчиков испытывают трудности с просмотром каждого вектора атаки. Также возможно, что разработчики, строяющие систему, не очень хорошо разбираются в методологиях атак и упускают что-то важное.

Проникновение тестирования или "перо тестирования" включает в себя привлечение внешних субъектов, чтобы попытаться атаковать систему. Эти злоумышленники могут быть внешней консалтинговой компанией или другими разработчиками с хорошими знаниями безопасности из другой части бизнеса. Им дают карт-бланш на попытку подорвать систему. Часто они находят обширные дыры в безопасности, которые необходимо исправить. Иногда вектор атаки будет чем-то совершенно неожиданным, как использование фишинговой атаки против генерального директора.

Сама Azure постоянно подвергается атакам со [стороны команды хакеров внутри Microsoft.](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/) На протяжении многих лет они были первыми, кто нашел десятки потенциально катастрофических векторов атак, закрыв их до того, как они могут быть использованы извне. Чем заманчивее цель, тем больше вероятность того, что вечные субъекты попытаются использовать ее, и есть несколько целей в мире более заманчивы, чем Azure.

## <a name="monitoring"></a>Наблюдение

Если злоумышленник пытается проникнуть в приложение, должно быть некоторое предупреждение о нем. Часто атаки можно выметить, изучив журналы служб. Нападения оставляют явные признаки, которые могут быть замечены, прежде чем они преуспеют. Например, злоумышленник, пытающихся угадать пароль, сделает много запросов в систему входа. Мониторинг вокруг системы входа может обнаружить странные закономерности, которые не соответствуют обычному шаблону доступа. Этот мониторинг может быть превращен в оповещение, которое, в свою очередь, может предупредить оперативного лица, чтобы активировать какую-то контрмеру. Высокозрелая система мониторинга может даже принять меры, основанные на этих отклонениях, упреждающе добавляя правила для блокирования запросов или ответов на дроссель.

## <a name="securing-the-build"></a>Обеспечение сборки

Одно из мест, где безопасность часто упускается из виду вокруг процесса сборки. Не только должна быть проверка безопасности сборки, например, сканирование небезопасного кода или учетные данные, а сама сборка должна быть защищена. Если сервер сборки скомпрометирован, он обеспечивает фантастический вектор для введения произвольного кода в продукт.

Представьте себе, что злоумышленник хочет украсть пароли людей, подписавшихся в веб-приложении. Они могут ввести шаг сборки, который изменяет проверенный код, чтобы отразить любой запрос входа на другой сервер. В следующий раз, когда код проходит через сборку, он будет обновляться без молелем. Сканирование уязвимости исходного кода не уловит это, как он работает до сборки. Кроме того, никто не будет ловить его в обзоре кода, потому что шаги сборки живут на сервере сборки. Использованный код будет идти в производство, где он может собирать пароли. Вероятно, нет аудита журнала изменения процесса сборки, или, по крайней мере, никто не контролирует аудит.

Это прекрасный пример, казалось бы, низкой стоимости цели, которые могут быть использованы для взлома в систему. После того, как злоумышленник нарушает периметр системы, он может начать работу над поиском способов повышения их разрешений до такой степени, что он может причинить реальный вред в любом месте, где им нравится.

## <a name="building-secure-code"></a>Создание безопасного кода

Рамочная программа .NET уже является достаточно безопасной структурой. Это позволяет избежать некоторых подводных камней неуправляемого кода, таких как ходьба от концов массивов. Активно ведется работа по устранению дыр в безопасности при обнаружении. Там даже [ошибка щедрость программа,](https://www.microsoft.com/msrc/bounty) которая платит исследователям, чтобы найти проблемы в рамках и сообщить о них, а не использовать их.

Существует множество способов сделать код .NET более безопасным. Следовать руководящим принципам, таким как [рекомендации по безопасному кодированию для](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) статьи .NET, необходимо предпринять разумный шаг для обеспечения безопасности кода с нуля. [Топ-10 OWASP](https://owasp.org/www-project-top-ten/) является еще одним бесценным руководством по созданию безопасного кода.

Процесс сборки является хорошим местом для размещения инструментов сканирования для обнаружения проблем в исходном коде, прежде чем они делают его в производство. Большинство каждого проекта имеет зависимость от некоторых других пакетов. Инструмент, который может сканировать устаревшие пакеты будет ловить проблемы в ночной сборки. Даже при создании изображений Docker полезно проверить и убедиться, что базовое изображение не имеет известных уязвимостей. Еще одна вещь, чтобы проверить, что никто случайно не проверили в учетных данных.

## <a name="built-in-security"></a>Встроенная безопасность

Azure предназначен для обеспечения баланса удобства использования и безопасности для большинства пользователей. У разных пользователей будут разные требования к безопасности, поэтому им необходимо доработать свой подход к облачной безопасности. Корпорация Майкрософт публикует много информации о безопасности в [Целевом центре.](https://azure.microsoft.com/support/trust-center/) Этот ресурс должен стать первой остановкой для тех специалистов, которые заинтересованы в понимании того, как работают встроенные технологии смягчения последствий атак.

На портале Azure [Azure Advisor](https://azure.microsoft.com/services/advisor/) — это система, которая постоянно сканирует среду и дает рекомендации. Некоторые из этих рекомендаций предназначены для экономии денег пользователей, но другие предназначены для выявления потенциально небезопасных конфигураций, таких как наличие контейнера для хранения, открытого для всего мира и не защищенного виртуальной сетью.

## <a name="azure-network-infrastructure"></a>Сетевая инфраструктура Azure

В условиях развертывания на местах много энергии налаживанию сетей. Настройка маршрутизаторов, переключателей, и это сложная работа. Сети позволяют определенным ресурсам общаться с другими ресурсами и предотвратить доступ в некоторых случаях. Частое сетевое правило заключается в ограничении доступа к производственной среде из среды разработки при случайном случае, если полуразвитый фрагмент кода будет работать наперекосяк и удаляет полосу данных.

Из коробки большинство ресурсов PaaS Azure имеют только самую основную и разрешительность в настройках сетей. Например, любой человек в Интернете может получить доступ к службе приложений. Новые экземпляры S'L Server обычно ограничены, так что внешние стороны не могут получить к ним доступ, но диапазоны IP-адресов, используемые самой Azure, разрешены. Таким образом, в то время как сервер S'L защищен от внешних угроз, злоумышленнику нужно только настроить плацдарм Azure, откуда он может начать атаки на все экземпляры S'L в Azure.

К счастью, большинство ресурсов Azure можно поместить в виртуальную сеть Azure, которая обеспечивает более тонкий контроль доступа. Подобно тому, как в закрытых сетях создаются частные сети, защищенные от мира, виртуальные сети являются островами частных IP-адресов, расположенных в сети Azure.

![Рисунок 10-1 Виртуальная](./media/virtual-network.png)
сеть в Azure**Рисунок 10-1**. Виртуальная сеть в Azure.

Таким же образом, что в предприимчивых сетях есть брандмауэр, регулирующий доступ к сети, можно установить аналогичный брандмауэр на границе виртуальной сети. По умолчанию все ресурсы виртуальной сети все еще могут общаться с Интернетом. Только входящие соединения требуют той или иной формы явного исключения брандмауэра.

С созданием сети внутренние ресурсы, такие как учетные записи хранения данных, могут быть настроены, чтобы обеспечить доступ только ресурсами, которые также находятся в Виртуальной сети. Этот брандмауэр обеспечивает дополнительный уровень безопасности, если ключи для этой учетной записи хранилища будут просочились, злоумышленники не смогут подключиться к нему, чтобы использовать просочившиеся ключи. Это еще один пример принципа наименьших привилегий.

Узлы в кластере Azure Kubernetes могут участвовать в виртуальной сети, как и другие ресурсы, более родные для Azure. Эта функциональность называется [Azure Container Networking Interface.](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md) По сути, он выделяет подсеть в виртуальной сети, на которой распределяются виртуальные машины и контейнерные изображения.

Продолжая идти по пути иллюстрирования принципа наименьших привилегий, не каждый ресурс в виртуальной сети должен говорить с каждым другим ресурсом. Например, в приложении, которое предоставляет веб-aPI по учетной записи хранилища и базе данных S'L, маловероятно, что база данных и учетная запись хранилища должны говорить друг с другом. Любой обмен данными между ними будет проходить через веб-приложение. Таким образом, [группа сетевой безопасности (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) может быть использована для отказа в трафике между двумя службами.

Политика отказа в связи между ресурсами может раздражать реализацию, особенно исходя из фона использования Azure без ограничений трафика. В некоторых других облаках понятие групп сетевой безопасности является гораздо более распространенным. Например, политика по умолчанию в AWS заключается в том, что ресурсы не могут общаться между собой до тех пор, пока не будут включены правила в NSG. В то время как медленнее, чтобы разработать это, более ограничительная среда обеспечивает более безопасный дефолт. Использование надлежащих методов DevOps, особенно с помощью [Azure Resource Manager или Terraform](infrastructure-as-code.md) для управления разрешениями, может упростить управление правилами.

Виртуальные сети также могут быть полезны при настройке связи между наемными и облачными ресурсами. Виртуальная частная сеть может быть использована для бесшовного присоединения двух сетей вместе. Это позволяет запустить виртуальную сеть без какого-либо шлюза для сценариев, где все пользователи находятся на месте. Есть ряд технологий, которые могут быть использованы для создания этой сети. Проще всего использовать [VPN от сайта к сайту,](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) который может быть установлен между многими маршрутизаторами и Azure. Трафик шифруется и туннелируется через Интернет по той же цене за байт, что и любой другой трафик. Для сценариев, где желательно больше пропускной способности или больше безопасности, Azure предлагает службу [express Route,](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) которая использует частную схему между приложенной сетью и Azure. Это более дорогостоящим и трудным для установления, но и более безопасным.

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a>Элемент управления доступом на основе ролей для ограничения доступа к ресурсам Azure

RBAC — это система, обеспечивающая идентификацию приложений, работающих в Azure. Приложения могут получить доступ к ресурсам, используя эту идентификацию, а не или в дополнение к использованию ключей или паролей.

## <a name="security-principals"></a>Субъекты безопасности

Первый компонент rBAC — это принцип безопасности. Директором безопасности может быть пользователь, группа, директор службы или управляемая личность.

![Рисунок 10-2 Различные](./media/rbac-security-principal.png)
типы принципов безопасности**Рисунок 10-2**. Различные типы принципов безопасности.

- Пользователь - Любой пользователь, у которого есть учетная запись в Active Directory Azure, является пользователем.
- Группа - Коллекция пользователей из Active Directory Azure. Как член группы, пользователь берет на себя роли этой группы в дополнение к своей собственной.
- Директор службы - идентификационная личность безопасности, в соответствии с которой работают службы или приложения.
- Управляемая идентификация — Итенок Active Directory Azure, управляемый Azure. Управляемые идентификаторы обычно используются при разработке облачных приложений, которые управляют учетными данными для аутентификации служб Azure.

Принцип безопасности может быть применен к большинству любых ресурсов. Это означает, что можно назначить принцип безопасности контейнеру, работая в Azure Kubernetes, что позволяет ему получить доступ к секретам, хранящимся в Key Vault. Функция Azure может получить разрешение, позволяющее ей общаться с экземпляром Active Directory для проверки JWT для вызываемого пользователя. После включения служб с помощью принципала службы их разрешения можно управлять гранулированными с помощью ролей и областей.

## <a name="roles"></a>Роли

Директор по безопасности может взять на себя множество ролей или, используя более sartorial аналогии, носить много шляп. Каждая роль определяет ряд разрешений, таких как "Чтение сообщений из конечной точки Azure Service Bus". Эффективный набор разрешений принципала безопасности — это сочетание всех разрешений, назначенных всем ролям, которые есть у директора безопасности. Azure имеет большое количество встроенных ролей, и пользователи могут определять свои собственные роли.

![Рисунок 10-3 RBAC](./media/rbac-role-definition.png)
определения ролей**Рисунок 10-3**. Определения ролей RBAC.

Встроенный в Azure также ряд высокоуровневых ролей, таких как владелец, вкладчик, читатель и администратор учетных записей пользователей. С ролью Владельца директор безопасности может получить доступ ко всем ресурсам и назначить разрешения другим. У участника одинакового уровня доступа ко всем ресурсам, но он не может назначить разрешения. Читатель может просматривать только существующие ресурсы Azure, а администратор учетных записей пользователей может управлять доступом к ресурсам Azure.

Более детальные встроенные роли, такие как [DNS-зона,](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) имеют права, ограниченные одной службой. Директора служб безопасности могут взять на себя любое количество ролей.

## <a name="scopes"></a>Области действия

Роли могут быть применены к ограниченному набору ресурсов в Azure. Например, при меняя область применения к предыдущему примеру чтения из очереди Service Bus, можно сузить разрешение до одной очереди: "Прочитайте сообщения из конечной точки `blah.servicebus.windows.net/queue1`Azure Service Bus"

Область может быть такой же узкой, как и один ресурс, или может быть применена ко всей группе ресурсов, подписке или даже к группе управления.

При тестировании, если директор службы безопасности имеет определенное разрешение, учитывается сочетание роли и сферы охвата. Эта комбинация обеспечивает мощный механизм авторизации.

## <a name="deny"></a>Запрет

Ранее для RBAC разрешались только правила "разрешить". Такое поведение усложнило создание некоторых областей. Например, предоставление основного доступа к учетным записям хранения, за исключением одного, требовало предоставления явного разрешения потенциально бесконечному списку учетных записей хранилища. Каждый раз, когда создавалась новая учетная запись хранилища, она должна быть добавлена к этому списку учетных записей. Это добавило накладных расходов управления, что, конечно, не желательно.

Отрицать правила имеют приоритет над правилами допустимого. Теперь, представляющий один и тот же объем "разрешить все, кроме одного", можно было бы представить в виде двух правил "разрешить всем" и "отказать этому конкретному". Запретить правила не только облегчить управление, но и предоставить ресурсы, которые являются дополнительными безопасными, отказывая в доступе ко всем.

## <a name="checking-access"></a>Проверка доступа

Как вы можете себе представить, наличие большого количества ролей и областей может сделать выяснение эффективного разрешения основного обслуживания довольно трудно. Piling отрицать правила вдобавок к этому, только служит для увеличения сложности. К счастью, есть калькулятор разрешений, который может показать эффективные разрешения для любого директора службы. Как правило, он находится под вкладкой IAM на портале, как показано на рисунке 10-3.

![Рисунок 10-4 Калькулятор](./media/check-rbac.png)
разрешения для службы приложений**Рисунок 10-4**. Калькулятор разрешения для службы приложений.

## <a name="securing-secrets"></a>Защита секретов

Пароли и сертификаты являются общим вектором атаки для злоумышленников. Оборудование для взлома паролей может сделать атаку грубой силы и попытаться угадать миллиарды паролей в секунду. Поэтому важно, чтобы пароли, которые используются для доступа к ресурсам, были сильными, с большим разнообразием символов. Эти пароли являются именно такие пароли, которые почти невозможно запомнить. К счастью, пароли в Azure на самом деле не должны быть известны любому человеку.

Многие эксперты по безопасности [предполагают,](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) что использование менеджера паролей для сохранения собственных паролей является наилучшим подходом. Хотя он централизует ваши пароли в одном месте, он также позволяет использовать очень сложные пароли и обеспечение их уникального для каждой учетной записи. Та же система существует в Azure: центральный магазин секретов.

## <a name="azure-key-vault"></a>Azure Key Vault

Azure Key Vault предоставляет централизованное местоположение для хранения паролей для таких вещей, как базы данных, ключи API и сертификаты. Как только секрет вводится в Убежище, он никогда не отображается снова, и команды, чтобы извлечь и просмотреть его целенаправленно сложно. Информация в сейфе защищена с помощью шифрования программного обеспечения или FIPS 140-2 Уровень 2 проверенных модулей аппаратной безопасности.

Доступ к хранилищу ключей обеспечивается через RBACs, что означает, что не только любой пользователь может получить доступ к информации в хранилище. Скажем, веб-приложение хочет получить доступ к строке подключения к базе данных, хранящейся в Azure Key Vault. Чтобы получить доступ, приложениям необходимо запускать с помощью принципала службы. Под этой предполагаемой ролью, они могут читать секреты из сейфа. Существует ряд различных параметров безопасности, которые могут еще больше ограничить доступ приложения к хранилищу, так что оно не может обновлять секреты, а только читать их.

Доступ к хранилищу ключей можно контролировать, чтобы гарантировать, что только ожидаемые приложения получают доступ к хранилищу. Эти журналы могут быть интегрированы обратно в Azure Monitor, открывая возможность настройки оповещений при возникновении неожиданных условий.

## <a name="kubernetes"></a>Kubernetes

В Kubernetes существует аналогичная служба по обслуживанию небольших фрагментов секретной информации. Kubernetes Секреты могут быть `kubectl` установлены через типичный исполняемый.

Создание секрета так же просто, как найти base64 версия значений, которые будут сохранены:

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

Затем добавить его в `secret.yml` файл секретов, названный, например, который похож на следующий пример:

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

Наконец, этот файл можно загрузить в Kubernetes, запустив следующую команду:

```console
kubectl apply -f ./secret.yaml
```

Эти секреты могут быть установлены в томах или подвержены контейнерным процессам через переменные среды. [Подход приложения «Двенадцать факторов»](https://12factor.net/) к созданию приложений предлагает использовать наименьший общий знаменатель для передачи настроек в приложение. Переменные среды являются наименьшим общим знаменателем, поскольку они поддерживаются независимо от операционной системы или приложения.

Альтернативой использованию встроенных секретов Kubernetes является доступ к секретам в Azure Key Vault из Kubernetes. Самый простой способ сделать это заключается в том, чтобы назначить роль RBAC в контейнер, желающий загрузить секреты. Приложение может использовать AIS Azure Key Vault для доступа к секретам. Однако этот подход требует внесения изменений в код и не соответствует шаблону использования переменных среды. Вместо этого можно вводить значения в контейнер с помощью [инжектора убежища azure Key Vault.](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354) Этот подход на самом деле более безопасным, чем использование секретов Kubernetes непосредственно, так как они могут быть доступны пользователям на кластере.

## <a name="encryption-in-transit-and-at-rest"></a>Шифрование в пути и в состоянии покоя

Обеспечение безопасности данных важно, будь то на диске или транзите между различными службами. Наиболее эффективным способом предотвращения утечки данных является шифрование их в формате, который не может быть легко прочитан другими. Azure поддерживает широкий спектр вариантов шифрования.

### <a name="in-transit"></a>В пути

Существует несколько способов шифрования трафика в сети Azure. Доступ к службам Azure обычно осуществляется по соединениям, которые используют безопасность транспортного уровня (TLS). Например, все подключения к ApIs Azure требуют подключения TLS. Кроме того, соединения с конечными точками в хранилище Azure могут быть ограничены только над зашифрованными соединениями TLS.

TLS является сложным протоколом и просто зная, что соединение использует TLS не достаточно для обеспечения безопасности. Например, TLS 1.0 хронически небезопасен, а TLS 1.1 не намного лучше. Даже в версиях TLS существуют различные настройки, которые могут упростить расшифровку соединений. Наилучшим способом действий является проверка и проверка того, использует ли подключение сервера современные и хорошо настроенные протоколы.

Эта проверка может быть выполнена внешней службой, такой как SSL-лаборатории SSL Server Test. Тестовый запуск в отношении типичной конечной точки Azure, в данном случае конечной точки автобуса обслуживания, дает почти идеальный балл A.

Даже такие службы, как базы данных Azure S'L, используют шифрование TLS для защиты данных. Интересная часть о шифровании данных в пути с помощью TLS является то, что это не возможно, даже для Microsoft, чтобы прослушать на соединение между компьютерами под управлением TLS. Это должно обеспечить комфорт для компаний, обеспокоенных тем, что их данные могут подвергаться риску со стороны microsoft собственно или даже государственного субъекта с большим количеством ресурсов, чем стандартный злоумышленник.

![Рисунок 10-5 SSL-лабораторий отчета, показывающий оценку A для конечной точки сервисного автобуса. ](./media/ssl-report.png)
 **Рисунок 10-5**. Отчет ы SSL-лабораторий показывает оценку A для конечной точки сервисного автобуса.

Хотя этот уровень шифрования не будет достаточным для всех времен, он должен внушать уверенность в том, что соединения Azure TLS достаточно безопасны. Azure будет продолжать развивать свои стандарты безопасности по мере улучшения шифрования. Приятно знать, что кто-то следит за стандартами безопасности и обновляет Azure по мере их улучшения.

### <a name="at-rest"></a>неактивные данные;

В любом приложении есть несколько мест, где данные опираются на диск. Сам код приложения загружается из какого-либо механизма хранения. Большинство приложений также используют какую-то базу данных, такую как S'L Server, Cosmos DB или даже удивительно экономитна на цене хранилище таблиц. Все эти базы данных используют сильно зашифрованное хранилище, чтобы гарантировать, что никто, кроме приложений с соответствующими разрешениями, не может прочитать ваши данные. Даже операторы системы не могут читать зашифрованные данные. Таким образом, клиенты могут оставаться уверенными в том, что их секретная информация остается секретной.

### <a name="storage"></a>Память

Основой большей части Azure является движок хранения Azure. Виртуальные машинные диски установлены поверх Azure Storage. Службы Azure Kubernetes работают на виртуальных машинах, которые сами по себе размещаются на Azure Storage. Даже без серверные технологии, такие как приложения Azure Функции и Экземпляры контейнеров Azure, не работают на диске, который является частью хранилища Azure.

Если Azure Storage хорошо зашифрован, то он обеспечивает основу для большинства всего остального, чтобы также быть зашифрованы. Azure Storage [шифруется](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) с [помощью FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) совместимых [256-разрядных AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard). Это хорошо продуманная технология шифрования, которая была предметом тщательного академического изучения в течение последних 20 лет или около того. В настоящее время нет известной практической атаки, которая позволила бы кому-то без знания ключа читать данные, зашифрованные AES.

По умолчанию ключи, используемые для шифрования хранилища Azure, управляются корпорацией Майкрософт. Существуют широкие меры защиты для предотвращения вредоносного доступа к этим ключам. Однако пользователи с особыми требованиями к шифрованию могут также [предоставлять свои собственные ключи хранения,](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) которые управляются в Azure Key Vault. Эти ключи могут быть отозваны в любое время, что фактически сделает содержимое учетной записи хранилища недоступным.

Виртуальные машины используют зашифрованное хранилище, но можно предоставить еще один уровень шифрования с помощью таких технологий, как BitLocker на Windows или DM-Crypt на Linux. Эти технологии означают, что даже если изображение диска было просочилось из хранилища, читать его будет практически невозможно.

### <a name="azure-sql"></a>Azure SQL

Базы данных, размещенные на Azure S'L, используют технологию [прозрачного шифрования данных (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) для обеспечения того, чтобы данные оставались зашифрованными. Он включен по умолчанию во всех недавно созданных базах данных S'L, но должен быть включен вручную для устаревших баз данных. TDE выполняет шифрование и расшифровку не только базы данных, но и резервных копий и журналов транзакций.

Параметры шифрования хранятся `master` в базе данных и при запуске считываются в память о оставшихся операциях. Это означает, `master` что база данных должна оставаться незашифрованной. Фактический ключ управляется корпорацией Майкрософт. Однако пользователи с требовательными требованиями к безопасности могут предоставлять свой ключ в Key Vault так же, как это делается для Хранилища Azure. Ключевое Убежище предоставляет такие услуги, как поворот ключей и отзыв.

"Прозрачный" часть TDS происходит от того, что Нет изменений клиента, необходимых для использования зашифрованной базы данных. Хотя этот подход обеспечивает хорошую безопасность, утечки пароля базы данных достаточно для пользователей, чтобы иметь возможность расшифровать данные. Есть еще один подход, который шифрует отдельные столбцы или таблицы в базе данных. [Всегда зашифрованное](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) гарантирует, что ни в одном месте зашифрованные данные не будут отображаться в простом тексте внутри базы данных.

Настройка этого уровня шифрования требует, чтобы через мастера в студии управления серверами S'L, чтобы выбрать вид шифрования и где в Key Vault для хранения связанных ключей.

![Рисунок 10-6 Выбор столбцов в таблице для шифрования с помощью всегда зашифрованная](./media/always-encrypted.png)
**рисунок 10-6**. Выбор столбцов в таблице для шифрования с помощью Always Encrypted.

Клиентские приложения, которые считывают информацию из этих зашифрованных столбцов, должны делать специальные надбавки для чтения зашифрованных данных. Строки подключения должны быть `Column Encryption Setting=Enabled` обновлены с и учетные данные клиента должны быть извлечены из Key Vault. Затем клиент S'L Server должен быть загрунторен ключами шифрования столбца. Как только это будет сделано, остальные действия используют стандартные интерфейсы для клиента S'L. То есть такие инструменты, как Dapper и Entity Framework, которые построены поверх клиента S'L, будут продолжать работать без изменений. Всегда зашифрованный может быть еще не доступен для каждого драйвера сервера S'L на каждом языке.

Сочетание TDE и Всегда зашифровано, оба из которых могут быть использованы с конкретными ключами клиента, гарантирует, что даже самые требовательные требования шифрования поддерживаются.

### <a name="cosmos-db"></a>Cosmos DB

Cosmos DB — новейшая база данных, предоставляемая корпорацией Майкрософт в Azure. Он был построен с нуля с безопасностью и криптографии в виду. Шифрование AES-256bit является стандартным для всех баз данных Cosmos DB и не может быть отключено. В сочетании с требованием TLS 1.2 для связи, все решение для хранения зашифровано.

![Рисунок 10-7 Поток шифрования данных](./media/cosmos-encryption.png)
в космосе DB**Рисунок 10-7**. Поток шифрования данных в рамках Cosmos DB.

В то время как Cosmos DB не обеспечивает поставку ключей шифрования клиентов, команда проделала значительную работу, чтобы убедиться, что она остается совместимой с PCI-DSS без этого. Cosmos DB также не поддерживает какой-либо одиночный столбец шифрования похож на Azure S'L всегда зашифрованы еще.

## <a name="keeping-secure"></a>Обеспечение безопасности

У Azure есть все инструменты, необходимые для выпуска высокозащищенного продукта. Однако цепь настолько сильна, насколько это самое слабое звено. Если приложения, развернутые поверх Azure, не разработаны с должным мышлением безопасности и хорошими проверками безопасности, то они становятся слабым звеном в цепочке. Существует множество замечательных инструментов статического анализа, библиотек шифрования и методов обеспечения безопасности, которые могут быть использованы для обеспечения безопасности программного обеспечения, установленного в Azure, как и сам Azure. Примеры включают [инструменты статического анализа,](https://www.whitesourcesoftware.com/) [библиотеки шифрования](https://www.libressl.org/)и [методы безопасности.](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)

>[!div class="step-by-step"]
>[Назад](security.md)
>[Вперед](devops.md)
