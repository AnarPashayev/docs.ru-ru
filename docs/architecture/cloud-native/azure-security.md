---
title: Безопасность Azure для облачных приложений
description: Архитектура облачных приложений Native .NET для Azure (ru) Безопасность Azure для облачных приложений
ms.date: 06/30/2019
ms.openlocfilehash: 13b5ad7a883a83014913fa0a6a020610c28c524f
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "80989146"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="30a69-103">Безопасность Azure для облачных приложений</span><span class="sxs-lookup"><span data-stu-id="30a69-103">Azure security for cloud-native apps</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="30a69-104">Облачные приложения могут быть проще и сложнее в безопасности, чем традиционные приложения.</span><span class="sxs-lookup"><span data-stu-id="30a69-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="30a69-105">С этой стороны, необходимо обеспечить более мелкие приложения и выделить больше энергии для создания инфраструктуры безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="30a69-106">Неоднородный характер языков и стилей программирования в большинстве развертываний служб также означает, что необходимо уделять больше внимания бюллетеням по безопасности от многих различных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="30a69-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="30a69-107">С другой стороны, меньшие службы, каждый из которых имеет свой собственный хранилище данных, ограничивают область действия атаки.</span><span class="sxs-lookup"><span data-stu-id="30a69-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="30a69-108">Если злоумышленник скомпрометирует одну систему, злоумышленнику, вероятно, сложнее перейти в другую систему, чем в монолитном приложении.</span><span class="sxs-lookup"><span data-stu-id="30a69-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="30a69-109">Границы процесса являются сильными границами.</span><span class="sxs-lookup"><span data-stu-id="30a69-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="30a69-110">Кроме того, если резервное копирование базы данных утекает, то ущерб является более ограниченным, так как эта база данных содержит только подмножество данных и вряд ли будет содержать персональные данные.</span><span class="sxs-lookup"><span data-stu-id="30a69-110">Also, if a database backup leaks, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="30a69-111">Моделирование угроз</span><span class="sxs-lookup"><span data-stu-id="30a69-111">Threat modeling</span></span>

<span data-ttu-id="30a69-112">Независимо от того, перевешивают ли преимущества недостатки облачных приложений, необходимо следовать тому же целостному менталитету безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="30a69-113">Безопасность и безопасное мышление должны быть частью каждого шага истории развития и операций.</span><span class="sxs-lookup"><span data-stu-id="30a69-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="30a69-114">При планировании приложения задавайте такие вопросы, как:</span><span class="sxs-lookup"><span data-stu-id="30a69-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="30a69-115">Каково будет влияние этих данных теряется?</span><span class="sxs-lookup"><span data-stu-id="30a69-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="30a69-116">Как мы можем ограничить ущерб от плохих данных, впрыскиваемых в эту службу?</span><span class="sxs-lookup"><span data-stu-id="30a69-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="30a69-117">Кто должен иметь доступ к этим данным?</span><span class="sxs-lookup"><span data-stu-id="30a69-117">Who should have access to this data?</span></span>
- <span data-ttu-id="30a69-118">Существуют ли политики аудита в процессе разработки и выпуска?</span><span class="sxs-lookup"><span data-stu-id="30a69-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="30a69-119">Все эти вопросы являются частью процесса, называемого [моделированием угроз.](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool)</span><span class="sxs-lookup"><span data-stu-id="30a69-119">All these questions are part of a process called [threat modeling](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="30a69-120">Этот процесс пытается ответить на вопрос о том, какие угрозы существуют для системы, насколько вероятны угрозы, и потенциальный ущерб от них.</span><span class="sxs-lookup"><span data-stu-id="30a69-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="30a69-121">После того, как список угроз был создан, необходимо решить, стоит ли их смягчать.</span><span class="sxs-lookup"><span data-stu-id="30a69-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="30a69-122">Иногда угроза настолько маловероятна и дорогая для того чтобы запланировать для что не стоимость тратить энергию на ем.</span><span class="sxs-lookup"><span data-stu-id="30a69-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="30a69-123">Например, некоторые субъекты государственного уровня могут внести изменения в конструкцию процесса, который используется миллионами устройств.</span><span class="sxs-lookup"><span data-stu-id="30a69-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="30a69-124">Теперь, вместо того, чтобы запускать определенный фрагмент кода в [Ring 3,](https://en.wikipedia.org/wiki/Protection_ring)этот код работает в Ring 0.</span><span class="sxs-lookup"><span data-stu-id="30a69-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="30a69-125">Это позволяет использовать, который может обойти гипервизор а также запустить код атаки на голые металлические машины, позволяя атак на все виртуальные машины, которые работают на этом оборудовании.</span><span class="sxs-lookup"><span data-stu-id="30a69-125">This allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="30a69-126">Измененные процессоры трудно обнаружить без микроскопа и передовые знания о кремниевой дизайн этого процессора.</span><span class="sxs-lookup"><span data-stu-id="30a69-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="30a69-127">Этот сценарий вряд ли произойдет и дорого смягчить, так что, вероятно, ни одна модель угрозы не рекомендовалбы бы защиту от эксплуатации для него.</span><span class="sxs-lookup"><span data-stu-id="30a69-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="30a69-128">Более вероятные угрозы, такие как `Id` сломанные элементы управления `Id=2` `Id=3` доступом, позволяющие приращаться к атакам (замена на URL) или инъекция СЗЛ, более привлекательны для создания защиты от.</span><span class="sxs-lookup"><span data-stu-id="30a69-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="30a69-129">Смягчения этих угроз вполне разумно построить и предотвратить неловкие дыры в безопасности, которые мазок репутации компании.</span><span class="sxs-lookup"><span data-stu-id="30a69-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="30a69-130">Принципы минимальных привилегий</span><span class="sxs-lookup"><span data-stu-id="30a69-130">Principle of least privilege</span></span>

<span data-ttu-id="30a69-131">Одной из основополагающих идей в области компьютерной безопасности является принцип наименьшей привилегии (POLP).</span><span class="sxs-lookup"><span data-stu-id="30a69-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="30a69-132">Это на самом деле основополагающая идея в большинстве любой форме безопасности будь то цифровой или физической.</span><span class="sxs-lookup"><span data-stu-id="30a69-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="30a69-133">Короче говоря, принцип заключается в том, что любой пользователь или процесс должен иметь наименьшее количество прав, которые могут быть выполнены для выполнения своей задачи.</span><span class="sxs-lookup"><span data-stu-id="30a69-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="30a69-134">В качестве примера, подумайте о кассирах в банке: доступ к сейфу является необычным видом деятельности.</span><span class="sxs-lookup"><span data-stu-id="30a69-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="30a69-135">Таким образом, средний кассейн не может открыть сейф самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="30a69-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="30a69-136">Чтобы получить доступ, они должны эскалации их запрос через менеджера банка, который выполняет дополнительные проверки безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="30a69-137">В компьютерной системе фантастическим примером является права пользователя, подключенного к базе данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="30a69-138">Во многих случаях существует единая учетная запись пользователя, используемая как для построения структуры базы данных, так и для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="30a69-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="30a69-139">За исключением крайних случаев, учетная запись, работая в приложении, не нуждается в возможности обновления информации о схеме.</span><span class="sxs-lookup"><span data-stu-id="30a69-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="30a69-140">Должно быть несколько учетных записей, которые обеспечивают различные уровни привилегий.</span><span class="sxs-lookup"><span data-stu-id="30a69-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="30a69-141">Приложение должно использовать только уровень разрешения, который предоставляет читать и писать доступ к данным в таблицах.</span><span class="sxs-lookup"><span data-stu-id="30a69-141">The application should only use the permission level that grants read and write access to the data in the tables.</span></span> <span data-ttu-id="30a69-142">Этот вид защиты устраняет атаки, направленные на падение таблиц баз данных или введение вредоносных триггеров.</span><span class="sxs-lookup"><span data-stu-id="30a69-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="30a69-143">Почти каждая часть создания облачного приложения может извлечь выгоду из того, что мы помня о принципе наименьших привилегий.</span><span class="sxs-lookup"><span data-stu-id="30a69-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="30a69-144">Вы можете найти его в игре при настройке брандмауэров, групп сетевой безопасности, ролей и областей в управлении доступом на основе ролей (RBAC).</span><span class="sxs-lookup"><span data-stu-id="30a69-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="30a69-145">тестирование уязвимости;</span><span class="sxs-lookup"><span data-stu-id="30a69-145">Penetration testing</span></span>

<span data-ttu-id="30a69-146">По мере усложнения приложений число векторов атак увеличивается с угрожающей скоростью.</span><span class="sxs-lookup"><span data-stu-id="30a69-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="30a69-147">Моделирование угроз является ошибочным в том, что оно, как правило, выполняется теми же людьми, строяющими систему.</span><span class="sxs-lookup"><span data-stu-id="30a69-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="30a69-148">Таким же образом, что многие разработчики испытывают трудности с представлением о взаимодействии пользователей, а затем по созданию непригодных пользовательских интерфейсов, большинство разработчиков испытывают трудности с просмотром каждого вектора атаки.</span><span class="sxs-lookup"><span data-stu-id="30a69-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="30a69-149">Также возможно, что разработчики, строяющие систему, не очень хорошо разбираются в методологиях атак и упускают что-то важное.</span><span class="sxs-lookup"><span data-stu-id="30a69-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="30a69-150">Проникновение тестирования или "перо тестирования" включает в себя привлечение внешних субъектов, чтобы попытаться атаковать систему.</span><span class="sxs-lookup"><span data-stu-id="30a69-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="30a69-151">Эти злоумышленники могут быть внешней консалтинговой компанией или другими разработчиками с хорошими знаниями безопасности из другой части бизнеса.</span><span class="sxs-lookup"><span data-stu-id="30a69-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="30a69-152">Им дают карт-бланш на попытку подорвать систему.</span><span class="sxs-lookup"><span data-stu-id="30a69-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="30a69-153">Часто они находят обширные дыры в безопасности, которые необходимо исправить.</span><span class="sxs-lookup"><span data-stu-id="30a69-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="30a69-154">Иногда вектор атаки будет чем-то совершенно неожиданным, как использование фишинговой атаки против генерального директора.</span><span class="sxs-lookup"><span data-stu-id="30a69-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="30a69-155">Сама Azure постоянно подвергается атакам со [стороны команды хакеров внутри Microsoft.](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)</span><span class="sxs-lookup"><span data-stu-id="30a69-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="30a69-156">На протяжении многих лет они были первыми, кто нашел десятки потенциально катастрофических векторов атак, закрыв их до того, как они могут быть использованы извне.</span><span class="sxs-lookup"><span data-stu-id="30a69-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="30a69-157">Чем заманчивее цель, тем больше вероятность того, что вечные субъекты попытаются использовать ее, и есть несколько целей в мире более заманчивы, чем Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="30a69-158">Наблюдение</span><span class="sxs-lookup"><span data-stu-id="30a69-158">Monitoring</span></span>

<span data-ttu-id="30a69-159">Если злоумышленник пытается проникнуть в приложение, должно быть некоторое предупреждение о нем.</span><span class="sxs-lookup"><span data-stu-id="30a69-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="30a69-160">Часто атаки можно выметить, изучив журналы служб.</span><span class="sxs-lookup"><span data-stu-id="30a69-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="30a69-161">Нападения оставляют явные признаки, которые могут быть замечены, прежде чем они преуспеют.</span><span class="sxs-lookup"><span data-stu-id="30a69-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="30a69-162">Например, злоумышленник, пытающихся угадать пароль, сделает много запросов в систему входа.</span><span class="sxs-lookup"><span data-stu-id="30a69-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="30a69-163">Мониторинг вокруг системы входа может обнаружить странные закономерности, которые не соответствуют обычному шаблону доступа.</span><span class="sxs-lookup"><span data-stu-id="30a69-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="30a69-164">Этот мониторинг может быть превращен в оповещение, которое, в свою очередь, может предупредить оперативного лица, чтобы активировать какую-то контрмеру.</span><span class="sxs-lookup"><span data-stu-id="30a69-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="30a69-165">Высокозрелая система мониторинга может даже принять меры, основанные на этих отклонениях, упреждающе добавляя правила для блокирования запросов или ответов на дроссель.</span><span class="sxs-lookup"><span data-stu-id="30a69-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="30a69-166">Обеспечение сборки</span><span class="sxs-lookup"><span data-stu-id="30a69-166">Securing the build</span></span>

<span data-ttu-id="30a69-167">Одно из мест, где безопасность часто упускается из виду вокруг процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="30a69-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="30a69-168">Не только должна быть проверка безопасности сборки, например, сканирование небезопасного кода или учетные данные, а сама сборка должна быть защищена.</span><span class="sxs-lookup"><span data-stu-id="30a69-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="30a69-169">Если сервер сборки скомпрометирован, он обеспечивает фантастический вектор для введения произвольного кода в продукт.</span><span class="sxs-lookup"><span data-stu-id="30a69-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="30a69-170">Представьте себе, что злоумышленник хочет украсть пароли людей, подписавшихся в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="30a69-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="30a69-171">Они могут ввести шаг сборки, который изменяет проверенный код, чтобы отразить любой запрос входа на другой сервер.</span><span class="sxs-lookup"><span data-stu-id="30a69-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="30a69-172">В следующий раз, когда код проходит через сборку, он будет обновляться без молелем.</span><span class="sxs-lookup"><span data-stu-id="30a69-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="30a69-173">Сканирование уязвимости исходного кода не уловит это, как он работает до сборки.</span><span class="sxs-lookup"><span data-stu-id="30a69-173">The source code vulnerability scanning won't catch this as it runs before the build.</span></span> <span data-ttu-id="30a69-174">Кроме того, никто не будет ловить его в обзоре кода, потому что шаги сборки живут на сервере сборки.</span><span class="sxs-lookup"><span data-stu-id="30a69-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="30a69-175">Использованный код будет идти в производство, где он может собирать пароли.</span><span class="sxs-lookup"><span data-stu-id="30a69-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="30a69-176">Вероятно, нет аудита журнала изменения процесса сборки, или, по крайней мере, никто не контролирует аудит.</span><span class="sxs-lookup"><span data-stu-id="30a69-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="30a69-177">Это прекрасный пример, казалось бы, низкой стоимости цели, которые могут быть использованы для взлома в систему.</span><span class="sxs-lookup"><span data-stu-id="30a69-177">This is a perfect example of a seemingly low value target that can be used to break into the system.</span></span> <span data-ttu-id="30a69-178">После того, как злоумышленник нарушает периметр системы, он может начать работу над поиском способов повышения их разрешений до такой степени, что он может причинить реальный вред в любом месте, где им нравится.</span><span class="sxs-lookup"><span data-stu-id="30a69-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="30a69-179">Создание безопасного кода</span><span class="sxs-lookup"><span data-stu-id="30a69-179">Building secure code</span></span>

<span data-ttu-id="30a69-180">Рамочная программа .NET уже является достаточно безопасной структурой.</span><span class="sxs-lookup"><span data-stu-id="30a69-180">.NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="30a69-181">Это позволяет избежать некоторых подводных камней неуправляемого кода, таких как ходьба от концов массивов.</span><span class="sxs-lookup"><span data-stu-id="30a69-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="30a69-182">Активно ведется работа по устранению дыр в безопасности при обнаружении.</span><span class="sxs-lookup"><span data-stu-id="30a69-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="30a69-183">Там даже [ошибка щедрость программа,](https://www.microsoft.com/msrc/bounty) которая платит исследователям, чтобы найти проблемы в рамках и сообщить о них, а не использовать их.</span><span class="sxs-lookup"><span data-stu-id="30a69-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="30a69-184">Существует множество способов сделать код .NET более безопасным.</span><span class="sxs-lookup"><span data-stu-id="30a69-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="30a69-185">Следовать руководящим принципам, таким как [рекомендации по безопасному кодированию для](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) статьи .NET, необходимо предпринять разумный шаг для обеспечения безопасности кода с нуля.</span><span class="sxs-lookup"><span data-stu-id="30a69-185">Following guidelines such as the [Secure coding guidelines for .NET](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="30a69-186">[Топ-10 OWASP](https://owasp.org/www-project-top-ten/) является еще одним бесценным руководством по созданию безопасного кода.</span><span class="sxs-lookup"><span data-stu-id="30a69-186">The [OWASP top 10](https://owasp.org/www-project-top-ten/) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="30a69-187">Процесс сборки является хорошим местом для размещения инструментов сканирования для обнаружения проблем в исходном коде, прежде чем они делают его в производство.</span><span class="sxs-lookup"><span data-stu-id="30a69-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="30a69-188">Большинство каждого проекта имеет зависимость от некоторых других пакетов.</span><span class="sxs-lookup"><span data-stu-id="30a69-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="30a69-189">Инструмент, который может сканировать устаревшие пакеты будет ловить проблемы в ночной сборки.</span><span class="sxs-lookup"><span data-stu-id="30a69-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="30a69-190">Даже при создании изображений Docker полезно проверить и убедиться, что базовое изображение не имеет известных уязвимостей.</span><span class="sxs-lookup"><span data-stu-id="30a69-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="30a69-191">Еще одна вещь, чтобы проверить, что никто случайно не проверили в учетных данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="30a69-192">Встроенная безопасность</span><span class="sxs-lookup"><span data-stu-id="30a69-192">Built-in security</span></span>

<span data-ttu-id="30a69-193">Azure предназначен для обеспечения баланса удобства использования и безопасности для большинства пользователей.</span><span class="sxs-lookup"><span data-stu-id="30a69-193">Azure is designed to balance usability and security for the majority of users.</span></span> <span data-ttu-id="30a69-194">У разных пользователей будут разные требования к безопасности, поэтому им необходимо доработать свой подход к облачной безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="30a69-195">Корпорация Майкрософт публикует много информации о безопасности в [Целевом центре.](https://azure.microsoft.com/support/trust-center/)</span><span class="sxs-lookup"><span data-stu-id="30a69-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="30a69-196">Этот ресурс должен стать первой остановкой для тех специалистов, которые заинтересованы в понимании того, как работают встроенные технологии смягчения последствий атак.</span><span class="sxs-lookup"><span data-stu-id="30a69-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="30a69-197">На портале Azure [Azure Advisor](https://azure.microsoft.com/services/advisor/) — это система, которая постоянно сканирует среду и дает рекомендации.</span><span class="sxs-lookup"><span data-stu-id="30a69-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="30a69-198">Некоторые из этих рекомендаций предназначены для экономии денег пользователей, но другие предназначены для выявления потенциально небезопасных конфигураций, таких как наличие контейнера для хранения, открытого для всего мира и не защищенного виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="30a69-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="30a69-199">Сетевая инфраструктура Azure</span><span class="sxs-lookup"><span data-stu-id="30a69-199">Azure network infrastructure</span></span>

<span data-ttu-id="30a69-200">В условиях развертывания на местах много энергии налаживанию сетей.</span><span class="sxs-lookup"><span data-stu-id="30a69-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="30a69-201">Настройка маршрутизаторов, переключателей, и это сложная работа.</span><span class="sxs-lookup"><span data-stu-id="30a69-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="30a69-202">Сети позволяют определенным ресурсам общаться с другими ресурсами и предотвратить доступ в некоторых случаях.</span><span class="sxs-lookup"><span data-stu-id="30a69-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="30a69-203">Частое сетевое правило заключается в ограничении доступа к производственной среде из среды разработки при случайном случае, если полуразвитый фрагмент кода будет работать наперекосяк и удаляет полосу данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="30a69-204">Из коробки большинство ресурсов PaaS Azure имеют только самую основную и разрешительность в настройках сетей.</span><span class="sxs-lookup"><span data-stu-id="30a69-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="30a69-205">Например, любой человек в Интернете может получить доступ к службе приложений.</span><span class="sxs-lookup"><span data-stu-id="30a69-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="30a69-206">Новые экземпляры S'L Server обычно ограничены, так что внешние стороны не могут получить к ним доступ, но диапазоны IP-адресов, используемые самой Azure, разрешены.</span><span class="sxs-lookup"><span data-stu-id="30a69-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="30a69-207">Таким образом, в то время как сервер S'L защищен от внешних угроз, злоумышленнику нужно только настроить плацдарм Azure, откуда он может начать атаки на все экземпляры S'L в Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="30a69-208">К счастью, большинство ресурсов Azure можно поместить в виртуальную сеть Azure, которая обеспечивает более тонкий контроль доступа.</span><span class="sxs-lookup"><span data-stu-id="30a69-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows finer grained access control.</span></span> <span data-ttu-id="30a69-209">Подобно тому, как в закрытых сетях создаются частные сети, защищенные от мира, виртуальные сети являются островами частных IP-адресов, расположенных в сети Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

<span data-ttu-id="30a69-210">![Рисунок 10-1 Виртуальная](./media/virtual-network.png)
сеть в Azure**Рисунок 10-1**.</span><span class="sxs-lookup"><span data-stu-id="30a69-210">![Figure 10-1 A virtual network in Azure](./media/virtual-network.png)
**Figure 10-1**.</span></span> <span data-ttu-id="30a69-211">Виртуальная сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-211">A virtual network in Azure.</span></span>

<span data-ttu-id="30a69-212">Таким же образом, что в предприимчивых сетях есть брандмауэр, регулирующий доступ к сети, можно установить аналогичный брандмауэр на границе виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="30a69-212">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="30a69-213">По умолчанию все ресурсы виртуальной сети все еще могут общаться с Интернетом.</span><span class="sxs-lookup"><span data-stu-id="30a69-213">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="30a69-214">Только входящие соединения требуют той или иной формы явного исключения брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="30a69-214">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="30a69-215">С созданием сети внутренние ресурсы, такие как учетные записи хранения данных, могут быть настроены, чтобы обеспечить доступ только ресурсами, которые также находятся в Виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="30a69-215">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="30a69-216">Этот брандмауэр обеспечивает дополнительный уровень безопасности, если ключи для этой учетной записи хранилища будут просочились, злоумышленники не смогут подключиться к нему, чтобы использовать просочившиеся ключи.</span><span class="sxs-lookup"><span data-stu-id="30a69-216">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="30a69-217">Это еще один пример принципа наименьших привилегий.</span><span class="sxs-lookup"><span data-stu-id="30a69-217">This is another example of the principle of least privilege.</span></span>

<span data-ttu-id="30a69-218">Узлы в кластере Azure Kubernetes могут участвовать в виртуальной сети, как и другие ресурсы, более родные для Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-218">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="30a69-219">Эта функциональность называется [Azure Container Networking Interface.](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md)</span><span class="sxs-lookup"><span data-stu-id="30a69-219">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="30a69-220">По сути, он выделяет подсеть в виртуальной сети, на которой распределяются виртуальные машины и контейнерные изображения.</span><span class="sxs-lookup"><span data-stu-id="30a69-220">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="30a69-221">Продолжая идти по пути иллюстрирования принципа наименьших привилегий, не каждый ресурс в виртуальной сети должен говорить с каждым другим ресурсом.</span><span class="sxs-lookup"><span data-stu-id="30a69-221">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="30a69-222">Например, в приложении, которое предоставляет веб-aPI по учетной записи хранилища и базе данных S'L, маловероятно, что база данных и учетная запись хранилища должны говорить друг с другом.</span><span class="sxs-lookup"><span data-stu-id="30a69-222">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="30a69-223">Любой обмен данными между ними будет проходить через веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="30a69-223">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="30a69-224">Таким образом, [группа сетевой безопасности (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) может быть использована для отказа в трафике между двумя службами.</span><span class="sxs-lookup"><span data-stu-id="30a69-224">So, a [network security group (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="30a69-225">Политика отказа в связи между ресурсами может раздражать реализацию, особенно исходя из фона использования Azure без ограничений трафика.</span><span class="sxs-lookup"><span data-stu-id="30a69-225">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="30a69-226">В некоторых других облаках понятие групп сетевой безопасности является гораздо более распространенным.</span><span class="sxs-lookup"><span data-stu-id="30a69-226">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="30a69-227">Например, политика по умолчанию в AWS заключается в том, что ресурсы не могут общаться между собой до тех пор, пока не будут включены правила в NSG.</span><span class="sxs-lookup"><span data-stu-id="30a69-227">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="30a69-228">В то время как медленнее, чтобы разработать это, более ограничительная среда обеспечивает более безопасный дефолт.</span><span class="sxs-lookup"><span data-stu-id="30a69-228">While slower to develop this, more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="30a69-229">Использование надлежащих методов DevOps, особенно с помощью [Azure Resource Manager или Terraform](infrastructure-as-code.md) для управления разрешениями, может упростить управление правилами.</span><span class="sxs-lookup"><span data-stu-id="30a69-229">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="30a69-230">Виртуальные сети также могут быть полезны при настройке связи между наемными и облачными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="30a69-230">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="30a69-231">Виртуальная частная сеть может быть использована для бесшовного присоединения двух сетей вместе.</span><span class="sxs-lookup"><span data-stu-id="30a69-231">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="30a69-232">Это позволяет запустить виртуальную сеть без какого-либо шлюза для сценариев, где все пользователи находятся на месте.</span><span class="sxs-lookup"><span data-stu-id="30a69-232">This allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="30a69-233">Есть ряд технологий, которые могут быть использованы для создания этой сети.</span><span class="sxs-lookup"><span data-stu-id="30a69-233">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="30a69-234">Проще всего использовать [VPN от сайта к сайту,](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) который может быть установлен между многими маршрутизаторами и Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-234">The simplest is to use a [site-to-site VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="30a69-235">Трафик шифруется и туннелируется через Интернет по той же цене за байт, что и любой другой трафик.</span><span class="sxs-lookup"><span data-stu-id="30a69-235">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="30a69-236">Для сценариев, где желательно больше пропускной способности или больше безопасности, Azure предлагает службу [express Route,](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) которая использует частную схему между приложенной сетью и Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-236">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="30a69-237">Это более дорогостоящим и трудным для установления, но и более безопасным.</span><span class="sxs-lookup"><span data-stu-id="30a69-237">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="30a69-238">Элемент управления доступом на основе ролей для ограничения доступа к ресурсам Azure</span><span class="sxs-lookup"><span data-stu-id="30a69-238">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="30a69-239">RBAC — это система, обеспечивающая идентификацию приложений, работающих в Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-239">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="30a69-240">Приложения могут получить доступ к ресурсам, используя эту идентификацию, а не или в дополнение к использованию ключей или паролей.</span><span class="sxs-lookup"><span data-stu-id="30a69-240">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="30a69-241">Субъекты безопасности</span><span class="sxs-lookup"><span data-stu-id="30a69-241">Security Principals</span></span>

<span data-ttu-id="30a69-242">Первый компонент rBAC — это принцип безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-242">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="30a69-243">Директором безопасности может быть пользователь, группа, директор службы или управляемая личность.</span><span class="sxs-lookup"><span data-stu-id="30a69-243">A security principal can be a user, group, service principal, or managed identity.</span></span>

<span data-ttu-id="30a69-244">![Рисунок 10-2 Различные](./media/rbac-security-principal.png)
типы принципов безопасности**Рисунок 10-2**.</span><span class="sxs-lookup"><span data-stu-id="30a69-244">![Figure 10-2 Different types of security principals](./media/rbac-security-principal.png)
**Figure 10-2**.</span></span> <span data-ttu-id="30a69-245">Различные типы принципов безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-245">Different types of security principals.</span></span>

- <span data-ttu-id="30a69-246">Пользователь - Любой пользователь, у которого есть учетная запись в Active Directory Azure, является пользователем.</span><span class="sxs-lookup"><span data-stu-id="30a69-246">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="30a69-247">Группа - Коллекция пользователей из Active Directory Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-247">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="30a69-248">Как член группы, пользователь берет на себя роли этой группы в дополнение к своей собственной.</span><span class="sxs-lookup"><span data-stu-id="30a69-248">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="30a69-249">Директор службы - идентификационная личность безопасности, в соответствии с которой работают службы или приложения.</span><span class="sxs-lookup"><span data-stu-id="30a69-249">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="30a69-250">Управляемая идентификация — Итенок Active Directory Azure, управляемый Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-250">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="30a69-251">Управляемые идентификаторы обычно используются при разработке облачных приложений, которые управляют учетными данными для аутентификации служб Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-251">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="30a69-252">Принцип безопасности может быть применен к большинству любых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="30a69-252">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="30a69-253">Это означает, что можно назначить принцип безопасности контейнеру, работая в Azure Kubernetes, что позволяет ему получить доступ к секретам, хранящимся в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="30a69-253">This means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="30a69-254">Функция Azure может получить разрешение, позволяющее ей общаться с экземпляром Active Directory для проверки JWT для вызываемого пользователя.</span><span class="sxs-lookup"><span data-stu-id="30a69-254">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="30a69-255">После включения служб с помощью принципала службы их разрешения можно управлять гранулированными с помощью ролей и областей.</span><span class="sxs-lookup"><span data-stu-id="30a69-255">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="30a69-256">Роли</span><span class="sxs-lookup"><span data-stu-id="30a69-256">Roles</span></span>

<span data-ttu-id="30a69-257">Директор по безопасности может взять на себя множество ролей или, используя более sartorial аналогии, носить много шляп.</span><span class="sxs-lookup"><span data-stu-id="30a69-257">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="30a69-258">Каждая роль определяет ряд разрешений, таких как "Чтение сообщений из конечной точки Azure Service Bus".</span><span class="sxs-lookup"><span data-stu-id="30a69-258">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="30a69-259">Эффективный набор разрешений принципала безопасности — это сочетание всех разрешений, назначенных всем ролям, которые есть у директора безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-259">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that security principal has.</span></span> <span data-ttu-id="30a69-260">Azure имеет большое количество встроенных ролей, и пользователи могут определять свои собственные роли.</span><span class="sxs-lookup"><span data-stu-id="30a69-260">Azure has a large number of built-in roles and users can define their own roles.</span></span>

<span data-ttu-id="30a69-261">![Рисунок 10-3 RBAC](./media/rbac-role-definition.png)
определения ролей**Рисунок 10-3**.</span><span class="sxs-lookup"><span data-stu-id="30a69-261">![Figure 10-3 RBAC role definitions](./media/rbac-role-definition.png)
**Figure 10-3**.</span></span> <span data-ttu-id="30a69-262">Определения ролей RBAC.</span><span class="sxs-lookup"><span data-stu-id="30a69-262">RBAC role definitions.</span></span>

<span data-ttu-id="30a69-263">Встроенный в Azure также ряд высокоуровневых ролей, таких как владелец, вкладчик, читатель и администратор учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="30a69-263">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="30a69-264">С ролью Владельца директор безопасности может получить доступ ко всем ресурсам и назначить разрешения другим.</span><span class="sxs-lookup"><span data-stu-id="30a69-264">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="30a69-265">У участника одинакового уровня доступа ко всем ресурсам, но он не может назначить разрешения.</span><span class="sxs-lookup"><span data-stu-id="30a69-265">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="30a69-266">Читатель может просматривать только существующие ресурсы Azure, а администратор учетных записей пользователей может управлять доступом к ресурсам Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-266">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="30a69-267">Более детальные встроенные роли, такие как [DNS-зона,](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) имеют права, ограниченные одной службой.</span><span class="sxs-lookup"><span data-stu-id="30a69-267">More granular built-in roles such as [DNS Zone Contributor](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="30a69-268">Директора служб безопасности могут взять на себя любое количество ролей.</span><span class="sxs-lookup"><span data-stu-id="30a69-268">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="30a69-269">Области действия</span><span class="sxs-lookup"><span data-stu-id="30a69-269">Scopes</span></span>

<span data-ttu-id="30a69-270">Роли могут быть применены к ограниченному набору ресурсов в Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-270">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="30a69-271">Например, при меняя область применения к предыдущему примеру чтения из очереди Service Bus, можно сузить разрешение до одной очереди: "Прочитайте сообщения из конечной точки `blah.servicebus.windows.net/queue1`Azure Service Bus"</span><span class="sxs-lookup"><span data-stu-id="30a69-271">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="30a69-272">Область может быть такой же узкой, как и один ресурс, или может быть применена ко всей группе ресурсов, подписке или даже к группе управления.</span><span class="sxs-lookup"><span data-stu-id="30a69-272">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="30a69-273">При тестировании, если директор службы безопасности имеет определенное разрешение, учитывается сочетание роли и сферы охвата.</span><span class="sxs-lookup"><span data-stu-id="30a69-273">When testing if a security principal has a certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="30a69-274">Эта комбинация обеспечивает мощный механизм авторизации.</span><span class="sxs-lookup"><span data-stu-id="30a69-274">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="30a69-275">Запрет</span><span class="sxs-lookup"><span data-stu-id="30a69-275">Deny</span></span>

<span data-ttu-id="30a69-276">Ранее для RBAC разрешались только правила "разрешить".</span><span class="sxs-lookup"><span data-stu-id="30a69-276">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="30a69-277">Такое поведение усложнило создание некоторых областей.</span><span class="sxs-lookup"><span data-stu-id="30a69-277">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="30a69-278">Например, предоставление основного доступа к учетным записям хранения, за исключением одного, требовало предоставления явного разрешения потенциально бесконечному списку учетных записей хранилища.</span><span class="sxs-lookup"><span data-stu-id="30a69-278">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="30a69-279">Каждый раз, когда создавалась новая учетная запись хранилища, она должна быть добавлена к этому списку учетных записей.</span><span class="sxs-lookup"><span data-stu-id="30a69-279">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="30a69-280">Это добавило накладных расходов управления, что, конечно, не желательно.</span><span class="sxs-lookup"><span data-stu-id="30a69-280">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="30a69-281">Отрицать правила имеют приоритет над правилами допустимого.</span><span class="sxs-lookup"><span data-stu-id="30a69-281">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="30a69-282">Теперь, представляющий один и тот же объем "разрешить все, кроме одного", можно было бы представить в виде двух правил "разрешить всем" и "отказать этому конкретному".</span><span class="sxs-lookup"><span data-stu-id="30a69-282">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="30a69-283">Запретить правила не только облегчить управление, но и предоставить ресурсы, которые являются дополнительными безопасными, отказывая в доступе ко всем.</span><span class="sxs-lookup"><span data-stu-id="30a69-283">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="30a69-284">Проверка доступа</span><span class="sxs-lookup"><span data-stu-id="30a69-284">Checking access</span></span>

<span data-ttu-id="30a69-285">Как вы можете себе представить, наличие большого количества ролей и областей может сделать выяснение эффективного разрешения основного обслуживания довольно трудно.</span><span class="sxs-lookup"><span data-stu-id="30a69-285">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="30a69-286">Piling отрицать правила вдобавок к этому, только служит для увеличения сложности.</span><span class="sxs-lookup"><span data-stu-id="30a69-286">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="30a69-287">К счастью, есть калькулятор разрешений, который может показать эффективные разрешения для любого директора службы.</span><span class="sxs-lookup"><span data-stu-id="30a69-287">Fortunately, there's a permissions calculator that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="30a69-288">Как правило, он находится под вкладкой IAM на портале, как показано на рисунке 10-3.</span><span class="sxs-lookup"><span data-stu-id="30a69-288">It's typically found under the IAM tab in the portal, as shown in Figure 10-3.</span></span>

<span data-ttu-id="30a69-289">![Рисунок 10-4 Калькулятор](./media/check-rbac.png)
разрешения для службы приложений**Рисунок 10-4**.</span><span class="sxs-lookup"><span data-stu-id="30a69-289">![Figure 10-4 Permission calculator for an app service](./media/check-rbac.png)
**Figure 10-4**.</span></span> <span data-ttu-id="30a69-290">Калькулятор разрешения для службы приложений.</span><span class="sxs-lookup"><span data-stu-id="30a69-290">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="30a69-291">Защита секретов</span><span class="sxs-lookup"><span data-stu-id="30a69-291">Securing secrets</span></span>

<span data-ttu-id="30a69-292">Пароли и сертификаты являются общим вектором атаки для злоумышленников.</span><span class="sxs-lookup"><span data-stu-id="30a69-292">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="30a69-293">Оборудование для взлома паролей может сделать атаку грубой силы и попытаться угадать миллиарды паролей в секунду.</span><span class="sxs-lookup"><span data-stu-id="30a69-293">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="30a69-294">Поэтому важно, чтобы пароли, которые используются для доступа к ресурсам, были сильными, с большим разнообразием символов.</span><span class="sxs-lookup"><span data-stu-id="30a69-294">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="30a69-295">Эти пароли являются именно такие пароли, которые почти невозможно запомнить.</span><span class="sxs-lookup"><span data-stu-id="30a69-295">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="30a69-296">К счастью, пароли в Azure на самом деле не должны быть известны любому человеку.</span><span class="sxs-lookup"><span data-stu-id="30a69-296">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="30a69-297">Многие эксперты по безопасности [предполагают,](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) что использование менеджера паролей для сохранения собственных паролей является наилучшим подходом.</span><span class="sxs-lookup"><span data-stu-id="30a69-297">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="30a69-298">Хотя он централизует ваши пароли в одном месте, он также позволяет использовать очень сложные пароли и обеспечение их уникального для каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="30a69-298">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="30a69-299">Та же система существует в Azure: центральный магазин секретов.</span><span class="sxs-lookup"><span data-stu-id="30a69-299">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="30a69-300">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="30a69-300">Azure Key Vault</span></span>

<span data-ttu-id="30a69-301">Azure Key Vault предоставляет централизованное местоположение для хранения паролей для таких вещей, как базы данных, ключи API и сертификаты.</span><span class="sxs-lookup"><span data-stu-id="30a69-301">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="30a69-302">Как только секрет вводится в Убежище, он никогда не отображается снова, и команды, чтобы извлечь и просмотреть его целенаправленно сложно.</span><span class="sxs-lookup"><span data-stu-id="30a69-302">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="30a69-303">Информация в сейфе защищена с помощью шифрования программного обеспечения или FIPS 140-2 Уровень 2 проверенных модулей аппаратной безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-303">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="30a69-304">Доступ к хранилищу ключей обеспечивается через RBACs, что означает, что не только любой пользователь может получить доступ к информации в хранилище.</span><span class="sxs-lookup"><span data-stu-id="30a69-304">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="30a69-305">Скажем, веб-приложение хочет получить доступ к строке подключения к базе данных, хранящейся в Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="30a69-305">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="30a69-306">Чтобы получить доступ, приложениям необходимо запускать с помощью принципала службы.</span><span class="sxs-lookup"><span data-stu-id="30a69-306">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="30a69-307">Под этой предполагаемой ролью, они могут читать секреты из сейфа.</span><span class="sxs-lookup"><span data-stu-id="30a69-307">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="30a69-308">Существует ряд различных параметров безопасности, которые могут еще больше ограничить доступ приложения к хранилищу, так что оно не может обновлять секреты, а только читать их.</span><span class="sxs-lookup"><span data-stu-id="30a69-308">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="30a69-309">Доступ к хранилищу ключей можно контролировать, чтобы гарантировать, что только ожидаемые приложения получают доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="30a69-309">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="30a69-310">Эти журналы могут быть интегрированы обратно в Azure Monitor, открывая возможность настройки оповещений при возникновении неожиданных условий.</span><span class="sxs-lookup"><span data-stu-id="30a69-310">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="30a69-311">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="30a69-311">Kubernetes</span></span>

<span data-ttu-id="30a69-312">В Kubernetes существует аналогичная служба по обслуживанию небольших фрагментов секретной информации.</span><span class="sxs-lookup"><span data-stu-id="30a69-312">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="30a69-313">Kubernetes Секреты могут быть `kubectl` установлены через типичный исполняемый.</span><span class="sxs-lookup"><span data-stu-id="30a69-313">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="30a69-314">Создание секрета так же просто, как найти base64 версия значений, которые будут сохранены:</span><span class="sxs-lookup"><span data-stu-id="30a69-314">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="30a69-315">Затем добавить его в `secret.yml` файл секретов, названный, например, который похож на следующий пример:</span><span class="sxs-lookup"><span data-stu-id="30a69-315">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="30a69-316">Наконец, этот файл можно загрузить в Kubernetes, запустив следующую команду:</span><span class="sxs-lookup"><span data-stu-id="30a69-316">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="30a69-317">Эти секреты могут быть установлены в томах или подвержены контейнерным процессам через переменные среды.</span><span class="sxs-lookup"><span data-stu-id="30a69-317">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="30a69-318">[Подход приложения «Двенадцать факторов»](https://12factor.net/) к созданию приложений предлагает использовать наименьший общий знаменатель для передачи настроек в приложение.</span><span class="sxs-lookup"><span data-stu-id="30a69-318">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="30a69-319">Переменные среды являются наименьшим общим знаменателем, поскольку они поддерживаются независимо от операционной системы или приложения.</span><span class="sxs-lookup"><span data-stu-id="30a69-319">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="30a69-320">Альтернативой использованию встроенных секретов Kubernetes является доступ к секретам в Azure Key Vault из Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="30a69-320">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="30a69-321">Самый простой способ сделать это заключается в том, чтобы назначить роль RBAC в контейнер, желающий загрузить секреты.</span><span class="sxs-lookup"><span data-stu-id="30a69-321">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="30a69-322">Приложение может использовать AIS Azure Key Vault для доступа к секретам.</span><span class="sxs-lookup"><span data-stu-id="30a69-322">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="30a69-323">Однако этот подход требует внесения изменений в код и не соответствует шаблону использования переменных среды.</span><span class="sxs-lookup"><span data-stu-id="30a69-323">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="30a69-324">Вместо этого можно вводить значения в контейнер с помощью [инжектора убежища azure Key Vault.](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354)</span><span class="sxs-lookup"><span data-stu-id="30a69-324">Instead, it's possible to inject values into a container through the use of the [Azure Key Vault Injector](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354).</span></span> <span data-ttu-id="30a69-325">Этот подход на самом деле более безопасным, чем использование секретов Kubernetes непосредственно, так как они могут быть доступны пользователям на кластере.</span><span class="sxs-lookup"><span data-stu-id="30a69-325">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="30a69-326">Шифрование в пути и в состоянии покоя</span><span class="sxs-lookup"><span data-stu-id="30a69-326">Encryption in transit and at rest</span></span>

<span data-ttu-id="30a69-327">Обеспечение безопасности данных важно, будь то на диске или транзите между различными службами.</span><span class="sxs-lookup"><span data-stu-id="30a69-327">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="30a69-328">Наиболее эффективным способом предотвращения утечки данных является шифрование их в формате, который не может быть легко прочитан другими.</span><span class="sxs-lookup"><span data-stu-id="30a69-328">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="30a69-329">Azure поддерживает широкий спектр вариантов шифрования.</span><span class="sxs-lookup"><span data-stu-id="30a69-329">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="30a69-330">В пути</span><span class="sxs-lookup"><span data-stu-id="30a69-330">In transit</span></span>

<span data-ttu-id="30a69-331">Существует несколько способов шифрования трафика в сети Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-331">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="30a69-332">Доступ к службам Azure обычно осуществляется по соединениям, которые используют безопасность транспортного уровня (TLS).</span><span class="sxs-lookup"><span data-stu-id="30a69-332">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="30a69-333">Например, все подключения к ApIs Azure требуют подключения TLS.</span><span class="sxs-lookup"><span data-stu-id="30a69-333">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="30a69-334">Кроме того, соединения с конечными точками в хранилище Azure могут быть ограничены только над зашифрованными соединениями TLS.</span><span class="sxs-lookup"><span data-stu-id="30a69-334">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="30a69-335">TLS является сложным протоколом и просто зная, что соединение использует TLS не достаточно для обеспечения безопасности.</span><span class="sxs-lookup"><span data-stu-id="30a69-335">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="30a69-336">Например, TLS 1.0 хронически небезопасен, а TLS 1.1 не намного лучше.</span><span class="sxs-lookup"><span data-stu-id="30a69-336">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="30a69-337">Даже в версиях TLS существуют различные настройки, которые могут упростить расшифровку соединений.</span><span class="sxs-lookup"><span data-stu-id="30a69-337">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="30a69-338">Наилучшим способом действий является проверка и проверка того, использует ли подключение сервера современные и хорошо настроенные протоколы.</span><span class="sxs-lookup"><span data-stu-id="30a69-338">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="30a69-339">Эта проверка может быть выполнена внешней службой, такой как SSL-лаборатории SSL Server Test.</span><span class="sxs-lookup"><span data-stu-id="30a69-339">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="30a69-340">Тестовый запуск в отношении типичной конечной точки Azure, в данном случае конечной точки автобуса обслуживания, дает почти идеальный балл A.</span><span class="sxs-lookup"><span data-stu-id="30a69-340">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="30a69-341">Даже такие службы, как базы данных Azure S'L, используют шифрование TLS для защиты данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-341">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="30a69-342">Интересная часть о шифровании данных в пути с помощью TLS является то, что это не возможно, даже для Microsoft, чтобы прослушать на соединение между компьютерами под управлением TLS.</span><span class="sxs-lookup"><span data-stu-id="30a69-342">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="30a69-343">Это должно обеспечить комфорт для компаний, обеспокоенных тем, что их данные могут подвергаться риску со стороны microsoft собственно или даже государственного субъекта с большим количеством ресурсов, чем стандартный злоумышленник.</span><span class="sxs-lookup"><span data-stu-id="30a69-343">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

<span data-ttu-id="30a69-344">![Рисунок 10-5 SSL-лабораторий отчета, показывающий оценку A для конечной точки сервисного автобуса. ](./media/ssl-report.png)
 **Рисунок 10-5**.</span><span class="sxs-lookup"><span data-stu-id="30a69-344">![Figure 10-5 SSL labs report showing a score of A for a Service Bus endpoint.](./media/ssl-report.png)
**Figure 10-5**.</span></span> <span data-ttu-id="30a69-345">Отчет ы SSL-лабораторий показывает оценку A для конечной точки сервисного автобуса.</span><span class="sxs-lookup"><span data-stu-id="30a69-345">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="30a69-346">Хотя этот уровень шифрования не будет достаточным для всех времен, он должен внушать уверенность в том, что соединения Azure TLS достаточно безопасны.</span><span class="sxs-lookup"><span data-stu-id="30a69-346">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="30a69-347">Azure будет продолжать развивать свои стандарты безопасности по мере улучшения шифрования.</span><span class="sxs-lookup"><span data-stu-id="30a69-347">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="30a69-348">Приятно знать, что кто-то следит за стандартами безопасности и обновляет Azure по мере их улучшения.</span><span class="sxs-lookup"><span data-stu-id="30a69-348">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="30a69-349">неактивные данные;</span><span class="sxs-lookup"><span data-stu-id="30a69-349">At rest</span></span>

<span data-ttu-id="30a69-350">В любом приложении есть несколько мест, где данные опираются на диск.</span><span class="sxs-lookup"><span data-stu-id="30a69-350">In any application, there are a number of places where data rests on disk.</span></span> <span data-ttu-id="30a69-351">Сам код приложения загружается из какого-либо механизма хранения.</span><span class="sxs-lookup"><span data-stu-id="30a69-351">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="30a69-352">Большинство приложений также используют какую-то базу данных, такую как S'L Server, Cosmos DB или даже удивительно экономитна на цене хранилище таблиц.</span><span class="sxs-lookup"><span data-stu-id="30a69-352">Most applications also use some kind of database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="30a69-353">Все эти базы данных используют сильно зашифрованное хранилище, чтобы гарантировать, что никто, кроме приложений с соответствующими разрешениями, не может прочитать ваши данные.</span><span class="sxs-lookup"><span data-stu-id="30a69-353">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="30a69-354">Даже операторы системы не могут читать зашифрованные данные.</span><span class="sxs-lookup"><span data-stu-id="30a69-354">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="30a69-355">Таким образом, клиенты могут оставаться уверенными в том, что их секретная информация остается секретной.</span><span class="sxs-lookup"><span data-stu-id="30a69-355">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="30a69-356">Память</span><span class="sxs-lookup"><span data-stu-id="30a69-356">Storage</span></span>

<span data-ttu-id="30a69-357">Основой большей части Azure является движок хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-357">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="30a69-358">Виртуальные машинные диски установлены поверх Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="30a69-358">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="30a69-359">Службы Azure Kubernetes работают на виртуальных машинах, которые сами по себе размещаются на Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="30a69-359">Azure Kubernetes Services run on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="30a69-360">Даже без серверные технологии, такие как приложения Azure Функции и Экземпляры контейнеров Azure, не работают на диске, который является частью хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-360">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="30a69-361">Если Azure Storage хорошо зашифрован, то он обеспечивает основу для большинства всего остального, чтобы также быть зашифрованы.</span><span class="sxs-lookup"><span data-stu-id="30a69-361">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="30a69-362">Azure Storage [шифруется](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) с [помощью FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) совместимых [256-разрядных AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span><span class="sxs-lookup"><span data-stu-id="30a69-362">Azure Storage [is encrypted](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="30a69-363">Это хорошо продуманная технология шифрования, которая была предметом тщательного академического изучения в течение последних 20 лет или около того.</span><span class="sxs-lookup"><span data-stu-id="30a69-363">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="30a69-364">В настоящее время нет известной практической атаки, которая позволила бы кому-то без знания ключа читать данные, зашифрованные AES.</span><span class="sxs-lookup"><span data-stu-id="30a69-364">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="30a69-365">По умолчанию ключи, используемые для шифрования хранилища Azure, управляются корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="30a69-365">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="30a69-366">Существуют широкие меры защиты для предотвращения вредоносного доступа к этим ключам.</span><span class="sxs-lookup"><span data-stu-id="30a69-366">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="30a69-367">Однако пользователи с особыми требованиями к шифрованию могут также [предоставлять свои собственные ключи хранения,](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) которые управляются в Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="30a69-367">However, users with particular encryption requirements can also [provide their own storage keys](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="30a69-368">Эти ключи могут быть отозваны в любое время, что фактически сделает содержимое учетной записи хранилища недоступным.</span><span class="sxs-lookup"><span data-stu-id="30a69-368">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="30a69-369">Виртуальные машины используют зашифрованное хранилище, но можно предоставить еще один уровень шифрования с помощью таких технологий, как BitLocker на Windows или DM-Crypt на Linux.</span><span class="sxs-lookup"><span data-stu-id="30a69-369">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="30a69-370">Эти технологии означают, что даже если изображение диска было просочилось из хранилища, читать его будет практически невозможно.</span><span class="sxs-lookup"><span data-stu-id="30a69-370">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="30a69-371">Azure SQL</span><span class="sxs-lookup"><span data-stu-id="30a69-371">Azure SQL</span></span>

<span data-ttu-id="30a69-372">Базы данных, размещенные на Azure S'L, используют технологию [прозрачного шифрования данных (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) для обеспечения того, чтобы данные оставались зашифрованными.</span><span class="sxs-lookup"><span data-stu-id="30a69-372">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="30a69-373">Он включен по умолчанию во всех недавно созданных базах данных S'L, но должен быть включен вручную для устаревших баз данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-373">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="30a69-374">TDE выполняет шифрование и расшифровку не только базы данных, но и резервных копий и журналов транзакций.</span><span class="sxs-lookup"><span data-stu-id="30a69-374">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="30a69-375">Параметры шифрования хранятся `master` в базе данных и при запуске считываются в память о оставшихся операциях.</span><span class="sxs-lookup"><span data-stu-id="30a69-375">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="30a69-376">Это означает, `master` что база данных должна оставаться незашифрованной.</span><span class="sxs-lookup"><span data-stu-id="30a69-376">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="30a69-377">Фактический ключ управляется корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="30a69-377">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="30a69-378">Однако пользователи с требовательными требованиями к безопасности могут предоставлять свой ключ в Key Vault так же, как это делается для Хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-378">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="30a69-379">Ключевое Убежище предоставляет такие услуги, как поворот ключей и отзыв.</span><span class="sxs-lookup"><span data-stu-id="30a69-379">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="30a69-380">"Прозрачный" часть TDS происходит от того, что Нет изменений клиента, необходимых для использования зашифрованной базы данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-380">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="30a69-381">Хотя этот подход обеспечивает хорошую безопасность, утечки пароля базы данных достаточно для пользователей, чтобы иметь возможность расшифровать данные.</span><span class="sxs-lookup"><span data-stu-id="30a69-381">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="30a69-382">Есть еще один подход, который шифрует отдельные столбцы или таблицы в базе данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-382">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="30a69-383">[Всегда зашифрованное](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) гарантирует, что ни в одном месте зашифрованные данные не будут отображаться в простом тексте внутри базы данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-383">[Always Encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="30a69-384">Настройка этого уровня шифрования требует, чтобы через мастера в студии управления серверами S'L, чтобы выбрать вид шифрования и где в Key Vault для хранения связанных ключей.</span><span class="sxs-lookup"><span data-stu-id="30a69-384">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

<span data-ttu-id="30a69-385">![Рисунок 10-6 Выбор столбцов в таблице для шифрования с помощью всегда зашифрованная](./media/always-encrypted.png)
**рисунок 10-6**.</span><span class="sxs-lookup"><span data-stu-id="30a69-385">![Figure 10-6 Selecting columns in a table to be encrypted using Always Encrypted](./media/always-encrypted.png)
**Figure 10-6**.</span></span> <span data-ttu-id="30a69-386">Выбор столбцов в таблице для шифрования с помощью Always Encrypted.</span><span class="sxs-lookup"><span data-stu-id="30a69-386">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="30a69-387">Клиентские приложения, которые считывают информацию из этих зашифрованных столбцов, должны делать специальные надбавки для чтения зашифрованных данных.</span><span class="sxs-lookup"><span data-stu-id="30a69-387">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="30a69-388">Строки подключения должны быть `Column Encryption Setting=Enabled` обновлены с и учетные данные клиента должны быть извлечены из Key Vault.</span><span class="sxs-lookup"><span data-stu-id="30a69-388">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="30a69-389">Затем клиент S'L Server должен быть загрунторен ключами шифрования столбца.</span><span class="sxs-lookup"><span data-stu-id="30a69-389">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="30a69-390">Как только это будет сделано, остальные действия используют стандартные интерфейсы для клиента S'L.</span><span class="sxs-lookup"><span data-stu-id="30a69-390">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="30a69-391">То есть такие инструменты, как Dapper и Entity Framework, которые построены поверх клиента S'L, будут продолжать работать без изменений.</span><span class="sxs-lookup"><span data-stu-id="30a69-391">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="30a69-392">Всегда зашифрованный может быть еще не доступен для каждого драйвера сервера S'L на каждом языке.</span><span class="sxs-lookup"><span data-stu-id="30a69-392">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="30a69-393">Сочетание TDE и Всегда зашифровано, оба из которых могут быть использованы с конкретными ключами клиента, гарантирует, что даже самые требовательные требования шифрования поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="30a69-393">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="30a69-394">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="30a69-394">Cosmos DB</span></span>

<span data-ttu-id="30a69-395">Cosmos DB — новейшая база данных, предоставляемая корпорацией Майкрософт в Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-395">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="30a69-396">Он был построен с нуля с безопасностью и криптографии в виду.</span><span class="sxs-lookup"><span data-stu-id="30a69-396">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="30a69-397">Шифрование AES-256bit является стандартным для всех баз данных Cosmos DB и не может быть отключено.</span><span class="sxs-lookup"><span data-stu-id="30a69-397">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="30a69-398">В сочетании с требованием TLS 1.2 для связи, все решение для хранения зашифровано.</span><span class="sxs-lookup"><span data-stu-id="30a69-398">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

<span data-ttu-id="30a69-399">![Рисунок 10-7 Поток шифрования данных](./media/cosmos-encryption.png)
в космосе DB**Рисунок 10-7**.</span><span class="sxs-lookup"><span data-stu-id="30a69-399">![Figure 10-7 The flow of data encryption within Cosmos DB](./media/cosmos-encryption.png)
**Figure 10-7**.</span></span> <span data-ttu-id="30a69-400">Поток шифрования данных в рамках Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="30a69-400">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="30a69-401">В то время как Cosmos DB не обеспечивает поставку ключей шифрования клиентов, команда проделала значительную работу, чтобы убедиться, что она остается совместимой с PCI-DSS без этого.</span><span class="sxs-lookup"><span data-stu-id="30a69-401">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="30a69-402">Cosmos DB также не поддерживает какой-либо одиночный столбец шифрования похож на Azure S'L всегда зашифрованы еще.</span><span class="sxs-lookup"><span data-stu-id="30a69-402">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="30a69-403">Обеспечение безопасности</span><span class="sxs-lookup"><span data-stu-id="30a69-403">Keeping secure</span></span>

<span data-ttu-id="30a69-404">У Azure есть все инструменты, необходимые для выпуска высокозащищенного продукта.</span><span class="sxs-lookup"><span data-stu-id="30a69-404">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="30a69-405">Однако цепь настолько сильна, насколько это самое слабое звено.</span><span class="sxs-lookup"><span data-stu-id="30a69-405">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="30a69-406">Если приложения, развернутые поверх Azure, не разработаны с должным мышлением безопасности и хорошими проверками безопасности, то они становятся слабым звеном в цепочке.</span><span class="sxs-lookup"><span data-stu-id="30a69-406">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="30a69-407">Существует множество замечательных инструментов статического анализа, библиотек шифрования и методов обеспечения безопасности, которые могут быть использованы для обеспечения безопасности программного обеспечения, установленного в Azure, как и сам Azure.</span><span class="sxs-lookup"><span data-stu-id="30a69-407">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="30a69-408">Примеры включают [инструменты статического анализа,](https://www.whitesourcesoftware.com/) [библиотеки шифрования](https://www.libressl.org/)и [методы безопасности.](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)</span><span class="sxs-lookup"><span data-stu-id="30a69-408">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="30a69-409">[Назад](security.md)
>[Вперед](devops.md)</span><span class="sxs-lookup"><span data-stu-id="30a69-409">[Previous](security.md)
[Next](devops.md)</span></span>
