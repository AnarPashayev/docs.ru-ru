---
title: Устойчивое взаимодействие
description: Создание архитектуры облачных приложений .NET для Azure | Устойчивое взаимодействие
ms.date: 06/30/2019
ms.openlocfilehash: 324f5426af1c892db73aa6fc2336a19b7a8e499e
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "73841225"
---
# <a name="resilient-communications"></a>Устойчивое взаимодействие

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

В этой книге мы еванжелизеди о том, что далеко не работали с традиционным монолитным проектированием приложений и используем архитектуру на основе микрослужб, где набор распределенных автономных служб выполняется независимо друг от друга и взаимодействует с каждым другие используют стандартные протоколы связи, такие как HTTP и HTTPS. Хотя такая архитектура покупает многие важные преимущества, она также предоставляет множество проблем. Рассмотрим, к примеру, следующие проблемы:

- *Необработанное сетевое взаимодействие.* Каждая служба взаимодействует по сетевому протоколу, который представляет перегрузку сети, задержку и временные сбои.
- *Обнаружение службы.* Как службы обнаруживают друг друга и взаимодействуют друг с другом с каждой службой, работающей в кластере компьютеров с собственным IP-адресом и портом?
- *Устойчивость.* Как управлять кратковременными сбоями и поддерживать стабильность системы?
- *Балансировка нагрузки.* Как входящий трафик распределяется по нескольким экземплярам службы?
- *Безопасность.* Как применяются такие проблемы безопасности, как шифрование на транспортном уровне и управление сертификатами?
- *Распределенный мониторинг.* — Как вы устанавливаете и отслеживаете трассировку и мониторинг для одного запроса в нескольких потребленных службах?

Хотя эти проблемы могут быть решены с помощью различных библиотек и платформ, их реализация в базе кода может быть дорогостоящей, сложной и трудоемкой. Более того, у вас есть решение о том, что проблемы с инфраструктурой связаны с бизнес-логикой.

## <a name="service-mesh"></a>Сеть службы

Лучшим подходом является рассмотрение новой и быстро развивающейся *сети*с технологией. [Сетка служб](https://www.nginx.com/blog/what-is-a-service-mesh/) — это настраиваемый уровень инфраструктуры со встроенными возможностями для управления взаимодействием служб и многими из описанных выше проблем. Он отделяет эти проблемы от вашего бизнес-кода и перемещает их в прокси-сервер службы, экземпляр, сопровождающий каждую из служб. Прокси-сервер сетки служб, часто называемый [шаблоном расширения](https://docs.microsoft.com/azure/architecture/patterns/sidecar), развертывается в отдельный процесс, чтобы обеспечить изоляцию и инкапсуляцию из вашего бизнес-кода. Однако прокси тесно связан с созданной службой вместе с ней и предоставляет общий доступ к ее жизненному циклу. Этот сценарий показан на рис. 6-9.

![Сеть службы с побочным автомобилем](./media/service-mesh-with-side-car.png)

**Рис. 6-9**. Сеть службы с побочным автомобилем

На предыдущем рисунке обратите внимание, как прокси-сервер перехватывает и управляет связью между микрослужбами и кластером.

Сетка служб логически разделяется на два разнородных компонента: [плоскость данных](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) и [плоскость управления](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc). На рис. 6-10 показаны эти компоненты и их обязанности.

![Управление сеткой услуг и плоскость данных](./media/istio-control-and-data-plane.png)

**Рис. 6-10.** Управление сеткой услуг и плоскость данных

После настройки сеть службы сильно функционирует. Он может получить соответствующий пул экземпляров из конечной точки обнаружения службы. Затем он может отправить запрос к определенному экземпляру, записывая тип задержки и ответа результата. Сетка может выбрать экземпляр, который, скорее всего, будет возвращать быстрый ответ на основе многих факторов, включая наблюдаемую задержку для последних запросов.

Если экземпляр не отвечает или завершается ошибкой, сеть может повторить запрос на другом экземпляре. Если пул постоянно возвращает ошибки, сеть может исключить ее из пула балансировки нагрузки, чтобы периодически выполнять повторную попытку после сброса. Если время ожидания запроса истекло, произойдет сбой сетки, а затем повторите запрос. Сетка захватывает поведение в виде метрик и распределенной трассировки, которую затем можно передать в централизованную систему метрик.

## <a name="istio-and-envoy"></a>Istio и делегат

Хотя в настоящее время существует несколько параметров сетки служб, [Istio](https://istio.io/docs/concepts/what-is-istio/) является самым популярным на момент написания этой статьи. Совместное предприятие от IBM, Google и Лифт — это предложение с открытым кодом, которое можно интегрировать в новое или существующее распределенное приложение. Она предоставляет единообразное и полное решение для защиты и подключения микрослужб, а также для их мониторинга. Его функции включают:

- Защита обмена данными между службами в кластере с помощью надежной проверки подлинности и авторизации на основе удостоверений.
- Автоматическая балансировка нагрузки для трафика HTTP, [gRPC](https://grpc.io/), WEBSOCKET и TCP.
- Детальное управление поведением трафика с богатыми правилами маршрутизации, повторными попытками, отработкой отказа и внедрением ошибок.
- Подключаемый уровень политики и API конфигурации, поддерживающий элементы управления доступом, ограничения скорости и квоты.
- Автоматические метрики, журналы и трассировки для всего трафика в кластере, включая входящие и исходящие данные кластера.

Ключевым компонентом для реализации Istio является служба прокси-сервера с [представителем прокси](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy). Исходя из Лифт и, в дальнейшем, внесены в [облачный машинный фундамент](https://www.cncf.io/) (рассматривается в главе 1), прокси-сервер работает вместе с каждой службой и предоставляет независимую от платформы основу для следующих функций:

- Динамическое обнаружение служб.
- Балансировка нагрузки.
- Завершение TLS.
- Прокси-серверы HTTP и gRPC.
- Устойчивость выключателя.
- Проверки работоспособности.
- Последовательные обновления с развертываниями [ранний](https://martinfowler.com/bliki/CanaryRelease.html) .

Как уже говорилось, представитель развертывается как расширения для каждой микрослужбы в кластере.

## <a name="integration-with-azure-kubernetes-services"></a>Интеграция с Azure Kubernetes Services

Облако Azure использует Istio и обеспечивает прямую поддержку в Azure Kubernetes Services. Следующие ссылки помогут вам приступить к работе:

- [Установка Istio в AKS](https://docs.microsoft.com/azure/aks/istio-install)
- [Использование AKS и Istio](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
>[Назад](infrastructure-resiliency-azure.md)
>[Вперед](monitoring-health.md)
