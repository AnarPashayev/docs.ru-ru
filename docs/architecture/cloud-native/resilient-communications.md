---
title: Устойчивое взаимодействие
description: Создание архитектуры облачных приложений .NET для Azure | Устойчивое взаимодействие
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: 18b26223634efc5c05f680d0cbb7c8cbc2490a59
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91166044"
---
# <a name="resilient-communications"></a>Устойчивое взаимодействие

В рамках этой книги мы включили архитектурный подход на основе микрослужб. Хотя такая архитектура обеспечивает важные преимущества, она предоставляет множество проблем:

- *Необработанное сетевое взаимодействие.* Каждая микрослужба взаимодействует по сетевому протоколу, который представляет перегрузку сети, задержку и временные сбои.

- *Обнаружение службы.* Как микрослужбы обнаруживают и взаимодействуют друг с другом при работе в кластере компьютеров с собственными IP-адресами и портами?

- *Устойчивость.* Как управлять кратковременными сбоями и поддерживать стабильность системы?

- *Балансировка нагрузки.* Как входящий трафик распределяется по нескольким экземплярам микрослужбы?

- *Безопасность.* Как применяются такие проблемы безопасности, как шифрование на транспортном уровне и управление сертификатами?

- *Распределенный мониторинг.* Как вы устанавливаете и отслеживаете трассировку и мониторинг для одного запроса в нескольких микрослужбах?

Эти проблемы можно решить с помощью различных библиотек и платформ, но реализация может быть дорогостоящей, сложной и трудоемкой. Кроме того, в итоге связаны проблемы с инфраструктурой, связанные с бизнес-логикой.

## <a name="service-mesh"></a>Сеть службы

Лучший подход — это развивающаяся технология, предназначенная для работы с сетями *служб*. [Сетка служб](https://www.nginx.com/blog/what-is-a-service-mesh/) — это настраиваемый уровень инфраструктуры со встроенными возможностями для управления взаимодействием служб и другими упомянутыми выше проблемами. Она разделяет эти проблемы, перемещая их в прокси-сервер службы. Прокси-сервер развертывается в отдельный процесс (называемый [расширения](/azure/architecture/patterns/sidecar)) для обеспечения изоляции от бизнес-кода. Однако расширения связывается с этой службой. она создается с ней и разделяет жизненный цикл. Этот сценарий показан на рис. 6-7.

![Сеть службы с побочным автомобилем](./media/service-mesh-with-side-car.png)

**Рис. 6-7**. Сеть службы с побочным автомобилем

На предыдущем рисунке обратите внимание, как прокси-сервер перехватывает и управляет связью между микрослужбами и кластером.

Сетка служб логически разделяется на два разнородных компонента: [плоскость данных](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) и [плоскость управления](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc). На рис. 6-8 показаны эти компоненты и их обязанности.

![Управление сеткой услуг и плоскость данных](./media/istio-control-and-data-plane.png)

**Рис. 6-8.** Управление сеткой услуг и плоскость данных

После настройки сеть службы сильно функционирует. Он может получить соответствующий пул экземпляров из конечной точки обнаружения службы. Затем сетка может отправить запрос к определенному экземпляру, записывая тип задержки и ответа результата. Сетка может выбрать экземпляр, который, скорее всего, будет возвращать быстрый ответ на основе многих факторов, включая наблюдаемую задержку для последних запросов.

Если экземпляр не отвечает или завершается неудачно, сеть попытается повторить запрос на другом экземпляре. Если он возвращает ошибки, сеть удаляет экземпляр из пула балансировки нагрузки и переводит его после восстановлении. Если время ожидания запроса истекло, произойдет сбой сетки, а затем повторите запрос. Сетка захватывает и выдает метрики и распределенную трассировку в централизованную систему метрик.

## <a name="istio-and-envoy"></a>Istio и делегат

Хотя в настоящее время существует несколько вариантов сетки служб, [Istio](https://istio.io/docs/concepts/what-is-istio/) является самым популярным в момент написания этой статьи. Istio — это совместное предприятие от IBM, Google и Лифт. Это предложение с открытым кодом, которое можно интегрировать в новое или существующее распределенное приложение. Эта технология обеспечивает единообразное и полное решение для защиты и подключения микрослужб, а также для их мониторинга. Она обладает следующими возможностями:

- Защита обмена данными между службами в кластере с помощью надежной проверки подлинности и авторизации на основе удостоверений.
- Автоматическая балансировка нагрузки для трафика HTTP, [gRPC](https://grpc.io/), WEBSOCKET и TCP.
- Детальное управление поведением трафика с богатыми правилами маршрутизации, повторными попытками, отработкой отказа и внедрением ошибок.
- Подключаемый уровень политики и API конфигурации, поддерживающий элементы управления доступом, ограничения скорости и квоты.
- Автоматические метрики, журналы и трассировки для всего трафика в кластере, включая входящие и исходящие данные кластера.

Ключевым компонентом для реализации Istio является служба прокси-сервера с [представителем прокси](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy). Она выполняется параллельно с каждой службой и предоставляет независимую от платформы основу для следующих функций:

- Динамическое обнаружение служб.
- Балансировка нагрузки.
- Завершение TLS.
- Прокси-серверы HTTP и gRPC.
- Устойчивость выключателя.
- Проверки работоспособности.
- Последовательные обновления с развертываниями [ранний](https://martinfowler.com/bliki/CanaryRelease.html) .

Как уже говорилось, представитель развертывается как расширения для каждой микрослужбы в кластере.

## <a name="integration-with-azure-kubernetes-services"></a>Интеграция с Azure Kubernetes Services

Облако Azure использует Istio и обеспечивает прямую поддержку в Azure Kubernetes Services. Следующие ссылки помогут вам приступить к работе:

- [Установка Istio в AKS](/azure/aks/istio-install)
- [Использование AKS и Istio](/azure/aks/istio-scenario-routing)

### <a name="references"></a>Ссылки

- [Polly](http://www.thepollyproject.org/)

- [Шаблон повторов](/azure/architecture/patterns/retry)

- [Шаблон автоматического выключения](/azure/architecture/patterns/circuit-breaker)

- [Обеспечение устойчивости в техническом документе Azure](https://azure.microsoft.com/mediahandler/files/resourcefiles/resilience-in-azure-whitepaper/Resilience%20in%20Azure.pdf)

- [задержка в сети](https://www.techopedia.com/definition/8553/network-latency)

- [Избыточность](/azure/architecture/guide/design-principles/redundancy)

- [Георепликация](/azure/sql-database/sql-database-active-geo-replication)

- [Диспетчер трафика Azure](/azure/traffic-manager/traffic-manager-overview)

- [Руководство по автоматическому масштабированию](/azure/architecture/best-practices/auto-scaling)

- [Istio](https://istio.io/docs/concepts/what-is-istio/)

- [Прокси-сервер делегата](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy)

>[!div class="step-by-step"]
>[Назад](infrastructure-resiliency-azure.md)
>[Вперед](monitoring-health.md)
