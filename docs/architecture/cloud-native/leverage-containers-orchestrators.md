---
title: Использование контейнеров и оркестраторов
description: Использование контейнеров DOCKER и orchestration Kubernetes в Azure
ms.date: 06/30/2019
ms.openlocfilehash: 7b136ed2760ea471f42ff82d20298ff8714c6dee
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73841765"
---
# <a name="leveraging-containers-and-orchestrators"></a><span data-ttu-id="9ca81-103">Использование контейнеров и оркестраторов</span><span class="sxs-lookup"><span data-stu-id="9ca81-103">Leveraging containers and orchestrators</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="9ca81-104">Контейнеры и оркестрации предназначены для решения проблем, характерных для монолитных подходов к развертыванию.</span><span class="sxs-lookup"><span data-stu-id="9ca81-104">Containers and orchestrators are designed to solve problems common to monolithic deployment approaches.</span></span>

## <a name="challenges-with-monolithic-deployments"></a><span data-ttu-id="9ca81-105">Проблемы с монолитными развертываниями</span><span class="sxs-lookup"><span data-stu-id="9ca81-105">Challenges with monolithic deployments</span></span>

<span data-ttu-id="9ca81-106">Обычно большинство приложений развернуты как единое целое.</span><span class="sxs-lookup"><span data-stu-id="9ca81-106">Traditionally, most applications have been deployed as a single unit.</span></span> <span data-ttu-id="9ca81-107">Такие приложения называются монолитными.</span><span class="sxs-lookup"><span data-stu-id="9ca81-107">Such applications are referred to as a monolith.</span></span> <span data-ttu-id="9ca81-108">Этот общий подход к развертыванию приложений в виде отдельных единиц, даже если они состоят из нескольких модулей или сборок, называется монолитной архитектурой, как показано на рисунке 3-1.</span><span class="sxs-lookup"><span data-stu-id="9ca81-108">This general approach of deploying applications as single units even if they're composed of multiple modules or assemblies is known as monolithic architecture, as shown in Figure 3-1.</span></span>

![Монолитная архитектура.](./media/monolithic-architecture.png)

<span data-ttu-id="9ca81-110">**Рис. 3-1**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-110">**Figure 3-1**.</span></span> <span data-ttu-id="9ca81-111">Монолитная архитектура.</span><span class="sxs-lookup"><span data-stu-id="9ca81-111">Monolithic architecture.</span></span>

<span data-ttu-id="9ca81-112">Хотя они имеют преимущество простоты, монолитные архитектуры сталкиваются с несколькими проблемами:</span><span class="sxs-lookup"><span data-stu-id="9ca81-112">Although they have the benefit of simplicity, monolithic architectures face a number of challenges:</span></span>

### <a name="deployments"></a><span data-ttu-id="9ca81-113">развертывания,</span><span class="sxs-lookup"><span data-stu-id="9ca81-113">Deployments</span></span>

<span data-ttu-id="9ca81-114">Развертывание в монолитных приложениях обычно требует перезапуска всего приложения, даже если заменяется только один маленький модуль.</span><span class="sxs-lookup"><span data-stu-id="9ca81-114">Deploying to monolithic applications typically requires restarting the entire application, even if only one small module is being replaced.</span></span> <span data-ttu-id="9ca81-115">В зависимости от количества компьютеров, на которых размещается приложение, это может привести к простою во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="9ca81-115">Depending on the number of machines hosting the application, this can result in downtime during deployments.</span></span>

### <a name="hosting"></a><span data-ttu-id="9ca81-116">Размещение</span><span class="sxs-lookup"><span data-stu-id="9ca81-116">Hosting</span></span>

<span data-ttu-id="9ca81-117">Монолитные приложения полностью размещаются на одном экземпляре компьютера.</span><span class="sxs-lookup"><span data-stu-id="9ca81-117">Monolithic applications are hosted entirely on a single machine instance.</span></span> <span data-ttu-id="9ca81-118">Это может потребовать наличия оборудования более высокого уровня, чем требуется для любого модуля в распределенном приложении.</span><span class="sxs-lookup"><span data-stu-id="9ca81-118">This may require higher-capability hardware than any module in a distributed application would need.</span></span> <span data-ttu-id="9ca81-119">Кроме того, если какая-либо часть приложения становится узким местом, все приложение должно быть развернуто на дополнительных узлах компьютера для масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9ca81-119">Also, if any part of the app becomes a bottleneck, the entire application must be deployed to additional machine nodes in order to scale out.</span></span>

### <a name="environment"></a><span data-ttu-id="9ca81-120">Среда</span><span class="sxs-lookup"><span data-stu-id="9ca81-120">Environment</span></span>

<span data-ttu-id="9ca81-121">Монолитные приложения обычно развертываются в существующей среде размещения (операционная система, установленные платформы и т. д.).</span><span class="sxs-lookup"><span data-stu-id="9ca81-121">Monolithic applications are typically deployed into an existing hosting environment (operating system, installed frameworks, etc.).</span></span> <span data-ttu-id="9ca81-122">Эта среда может не соответствовать среде, в которой приложение было разработано или протестировано.</span><span class="sxs-lookup"><span data-stu-id="9ca81-122">This environment may not match the environment in which the application was developed or tested.</span></span> <span data-ttu-id="9ca81-123">Несоответствия в среде приложения являются распространенным источником проблем для монолитных развертываний.</span><span class="sxs-lookup"><span data-stu-id="9ca81-123">Inconsistencies in the application's environment are a common source of problems for monolithic deployments.</span></span>

### <a name="coupling"></a><span data-ttu-id="9ca81-124">Тесн</span><span class="sxs-lookup"><span data-stu-id="9ca81-124">Coupling</span></span>

<span data-ttu-id="9ca81-125">Монолитные приложения, скорее всего, будут иметь большое отношение между различными частями приложения и между приложением и его средой.</span><span class="sxs-lookup"><span data-stu-id="9ca81-125">Monolithic applications are likely to have a great deal of coupling between different parts of the application, and between the application and its environment.</span></span> <span data-ttu-id="9ca81-126">Это может усложнить выгрузку определенной службы или устранить ее позже, чтобы повысить масштабируемость или переключение в другой реализации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-126">This can make it difficult to factor out a particular service or concern later, in order to increase its scalability or swap in an alternative implementation.</span></span> <span data-ttu-id="9ca81-127">Такая связь также приводит к значительному увеличению возможных последствий изменений в системе, что требует всестороннего тестирования в больших приложениях.</span><span class="sxs-lookup"><span data-stu-id="9ca81-127">This coupling also leads to much larger potential impacts for changes to the system, requiring extensive testing in larger applications.</span></span>

### <a name="technology-choice"></a><span data-ttu-id="9ca81-128">Вариант технологии</span><span class="sxs-lookup"><span data-stu-id="9ca81-128">Technology choice</span></span>

<span data-ttu-id="9ca81-129">Монолитные приложения создаются и развертываются как единое целое.</span><span class="sxs-lookup"><span data-stu-id="9ca81-129">Monolithic applications are built and deployed as a unit.</span></span> <span data-ttu-id="9ca81-130">Это обеспечивает простоту и единообразие, но может быть препятствием для инноваций.</span><span class="sxs-lookup"><span data-stu-id="9ca81-130">This offers simplicity and uniformity but can be a barrier to innovation.</span></span> <span data-ttu-id="9ca81-131">Несмотря на то что новая функция или модуль в системе лучше подходят для более современной платформы или платформы, она, скорее всего, будет построена с использованием текущего подхода приложения для обеспечения согласованности, а также для простоты разработки и развертывания.</span><span class="sxs-lookup"><span data-stu-id="9ca81-131">Although a new feature or module in the system might be better-suited to a more modern platform or framework, it's likely to be built using the application's current approach for the sake of consistency as well as ease of development and deployment.</span></span>

## <a name="what-are-the-benefits-of-containers-and-orchestrators"></a><span data-ttu-id="9ca81-132">Каковы преимущества контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="9ca81-132">What are the benefits of containers and orchestrators?</span></span>

<span data-ttu-id="9ca81-133">DOCKER — это самая популярная платформа управления контейнерами и создания образов, которая позволяет быстро работать с контейнерами в Linux и Windows.</span><span class="sxs-lookup"><span data-stu-id="9ca81-133">Docker is the most popular container management and imaging platform and allows you to quickly work with containers on Linux and Windows.</span></span> <span data-ttu-id="9ca81-134">Контейнеры предоставляют отдельные, но воспроизводимые среды приложений, которые выполняются одинаково в любой системе.</span><span class="sxs-lookup"><span data-stu-id="9ca81-134">Containers provide separate but reproducible application environments that run the same way on any system.</span></span> <span data-ttu-id="9ca81-135">Это делает их идеальными для разработки и размещения приложений и компонентов приложений в собственных облачных приложениях.</span><span class="sxs-lookup"><span data-stu-id="9ca81-135">This makes them perfect for developing and hosting applications and app components in cloud-native applications.</span></span> <span data-ttu-id="9ca81-136">Контейнеры изолированы друг от друга, поэтому два контейнера на одном и том же оборудовании могут иметь разные версии программного обеспечения и даже установленные операционные системы, без зависимостей, вызывающих конфликты.</span><span class="sxs-lookup"><span data-stu-id="9ca81-136">Containers are isolated from one another, so two containers on the same host hardware can have different versions of software and even operating system installed, without the dependencies causing conflicts.</span></span>

<span data-ttu-id="9ca81-137">Более того, контейнеры определяются простыми файлами, которые можно вернуть в систему управления версиями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-137">What’s more, containers are defined by simple files that can be checked into source control.</span></span> <span data-ttu-id="9ca81-138">В отличие от полных серверов, даже виртуальных машин, для которых часто требуется ручная работа по применению обновлений или установке дополнительных служб, инфраструктура контейнеров может легко управлять версиями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-138">Unlike full servers, even virtual machines, which frequently require manual work to apply updates or install additional services, container infrastructure can easily be version-controlled.</span></span> <span data-ttu-id="9ca81-139">Таким образом, приложения, созданные для работы в контейнерах, можно разрабатывать, тестировать и развертывать с помощью автоматизированных средств в составе конвейера сборки.</span><span class="sxs-lookup"><span data-stu-id="9ca81-139">Thus, apps built to run in containers can be developed, tested, and deployed using automated tools as part of a build pipeline.</span></span>

<span data-ttu-id="9ca81-140">Контейнеры являются неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="9ca81-140">Containers are immutable.</span></span> <span data-ttu-id="9ca81-141">Определив контейнер, вы можете повторно создать этот контейнер, который будет выполняться точно так же.</span><span class="sxs-lookup"><span data-stu-id="9ca81-141">Once you have the definition of a container, you can recreate that container and it will run exactly the same way.</span></span> <span data-ttu-id="9ca81-142">Эта неизменность предоставляет модель, основанную на компонентах.</span><span class="sxs-lookup"><span data-stu-id="9ca81-142">This immutability lends itself to component-based design.</span></span> <span data-ttu-id="9ca81-143">Если некоторые части приложения не изменяются так часто, как и другие, то зачем повторно развертывать все приложение, когда можно просто развернуть наиболее часто меняющиеся части?</span><span class="sxs-lookup"><span data-stu-id="9ca81-143">If some parts of an application don’t change as often as others, why redeploy the entire app when you can just deploy the parts that change most frequently?</span></span> <span data-ttu-id="9ca81-144">Различные функции и проблемы с перекрестной обрезкой приложения можно разбить на отдельные единицы.</span><span class="sxs-lookup"><span data-stu-id="9ca81-144">Different features and cross-cutting concerns of an app can be broken up into separate units.</span></span> <span data-ttu-id="9ca81-145">На рис. 3-2 показано, как монолитное приложение может использовать преимущества контейнеров и микрослужб, делегируя определенные функции или функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="9ca81-145">Figure 3-2 shows how a monolithic app can take advantage of containers and microservices by delegating certain features or functionality.</span></span> <span data-ttu-id="9ca81-146">Остальные функции в самом приложении также были контейнерными.</span><span class="sxs-lookup"><span data-stu-id="9ca81-146">The remaining functionality in the app itself has also been containerized.</span></span>

<span data-ttu-id="9ca81-147">![разбить монолитное приложение на использование микрослужб в серверной части.](./media/breaking-up-monolith-with-backend-microservices.png)
**рис. 3-2**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-147">![Breaking up a monolithic app to use microservices in the back end.](./media/breaking-up-monolith-with-backend-microservices.png)
**Figure 3-2**.</span></span> <span data-ttu-id="9ca81-148">Разбивает монолитное приложение на использование микрослужб в серверной части.</span><span class="sxs-lookup"><span data-stu-id="9ca81-148">Breaking up a monolithic app to use microservices in the back end.</span></span>

<span data-ttu-id="9ca81-149">Облачные приложения, созданные с помощью отдельных контейнеров, могут развертывать как можно больше или как небольшую часть приложения по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="9ca81-149">Cloud-native apps built using separate containers benefit from the ability to deploy as much or as little of an application as needed.</span></span> <span data-ttu-id="9ca81-150">Отдельные службы могут размещаться на узлах с ресурсами, соответствующими каждой службе.</span><span class="sxs-lookup"><span data-stu-id="9ca81-150">Individual services can be hosted on nodes with resources appropriate to each service.</span></span> <span data-ttu-id="9ca81-151">Среда, в которой работает каждая служба, является неизменяемой, ее можно совместно использовать для разработки, тестирования и рабочей среды, а также для легкого управления версиями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-151">The environment each service runs in is immutable, can be shared between dev, test, and production, and can easily be versioned.</span></span> <span data-ttu-id="9ca81-152">Связь между различными областями приложения происходит явным образом в виде вызовов или сообщений между службами, а не зависимостями во время компиляции внутри монолиты.</span><span class="sxs-lookup"><span data-stu-id="9ca81-152">Coupling between different areas of the application occurs explicitly as calls or messages between services, not compile-time dependencies within the monolith.</span></span> <span data-ttu-id="9ca81-153">И любая заданная часть приложения может выбрать технологию, которая наиболее эффективно подходит для этой функции или возможности, не требуя внесения изменений в остальную часть приложения.</span><span class="sxs-lookup"><span data-stu-id="9ca81-153">And any given part of the overall app can choose the technology that makes the most sense for that feature or capability without requiring changes to the rest of the app.</span></span>

## <a name="what-are-the-scaling-benefits"></a><span data-ttu-id="9ca81-154">Каковы преимущества масштабирования?</span><span class="sxs-lookup"><span data-stu-id="9ca81-154">What are the scaling benefits?</span></span>

<span data-ttu-id="9ca81-155">Службы, созданные на основе контейнеров, могут использовать преимущества масштабирования, предоставляемые средствами оркестрации, такими как Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-155">Services built on containers can leverage scaling benefits provided by orchestration tools like Kubernetes.</span></span> <span data-ttu-id="9ca81-156">По проектам контейнеры хорошо осведомлены о себе.</span><span class="sxs-lookup"><span data-stu-id="9ca81-156">By design containers only know about themselves.</span></span> <span data-ttu-id="9ca81-157">После начала работы с несколькими контейнерами, которые должны работать вместе, может быть целесообразно упорядочить их на более высоком уровне.</span><span class="sxs-lookup"><span data-stu-id="9ca81-157">Once you start to have multiple containers that need to work together, it can be worthwhile to organize them at a higher level.</span></span> <span data-ttu-id="9ca81-158">Организация большого количества контейнеров и их общих зависимостей, таких как конфигурация сети, заключается в том, где средства оркестрации могут сэкономить день!</span><span class="sxs-lookup"><span data-stu-id="9ca81-158">Organizing large numbers of containers and their shared dependencies, such as network configuration, is where orchestration tools come in to save the day!</span></span> <span data-ttu-id="9ca81-159">Kubernetes — это платформа оркестрации контейнеров, предназначенная для автоматизации развертывания, масштабирования и управления контейнерными приложениями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-159">Kubernetes is a container orchestration platform designed to automate deployment, scaling, and management of containerized applications.</span></span> <span data-ttu-id="9ca81-160">Он создает слой абстракции поверх групп контейнеров и организует их в модули *Pod.*</span><span class="sxs-lookup"><span data-stu-id="9ca81-160">It creates an abstraction layer on top of groups of containers and organizes them into *pods*.</span></span> <span data-ttu-id="9ca81-161">Модули Pod выполняются на рабочих компьютерах, которые называются *узлами*.</span><span class="sxs-lookup"><span data-stu-id="9ca81-161">Pods run on worker machines referred to as *nodes*.</span></span> <span data-ttu-id="9ca81-162">Вся упорядоченная группа называется *кластером*.</span><span class="sxs-lookup"><span data-stu-id="9ca81-162">The whole organized group is referred to as a *cluster*.</span></span> <span data-ttu-id="9ca81-163">На рис. 3-3 показаны различные компоненты кластера Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-163">Figure 3-3 shows the different components of a Kubernetes cluster.</span></span>

<span data-ttu-id="9ca81-164">![компоненты кластера Kubernetes.](./media/kubernetes-cluster-components.png)
**рис. 3-3**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-164">![Kubernetes cluster components.](./media/kubernetes-cluster-components.png)
**Figure 3-3**.</span></span> <span data-ttu-id="9ca81-165">Компоненты кластера Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-165">Kubernetes cluster components.</span></span>

<span data-ttu-id="9ca81-166">Kubernetes имеет встроенную поддержку масштабирования кластеров в соответствии с потребностями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-166">Kubernetes has built-in support for scaling clusters to meet demand.</span></span> <span data-ttu-id="9ca81-167">В сочетании с контейнерными микрослужбами это обеспечивает собственные облачные приложения с возможностью быстрого и эффективного реагирования на пиковые нагрузки с дополнительными ресурсами, когда и где они требуются.</span><span class="sxs-lookup"><span data-stu-id="9ca81-167">Combined with containerized micro-services, this provides cloud-native applications with the ability to quickly and efficiently respond to spikes in demand with additional resources when and where they're needed.</span></span>

### <a name="declarative-versus-imperative"></a><span data-ttu-id="9ca81-168">Декларативная и императивная</span><span class="sxs-lookup"><span data-stu-id="9ca81-168">Declarative versus imperative</span></span>

<span data-ttu-id="9ca81-169">Kubernetes поддерживает как декларативную, так и императивную конфигурацию объекта.</span><span class="sxs-lookup"><span data-stu-id="9ca81-169">Kubernetes supports both declarative and imperative object configuration.</span></span> <span data-ttu-id="9ca81-170">Императивный подход включает выполнение различных команд, которые сообщают Kubernetes, что делать каждый шаг.</span><span class="sxs-lookup"><span data-stu-id="9ca81-170">The imperative approach involves running various commands that tell Kubernetes what to do each step of the way.</span></span> <span data-ttu-id="9ca81-171">*Запустите* этот образ.</span><span class="sxs-lookup"><span data-stu-id="9ca81-171">*Run* this image.</span></span> <span data-ttu-id="9ca81-172">*Удалите* этот модуль.</span><span class="sxs-lookup"><span data-stu-id="9ca81-172">*Delete* this pod.</span></span> <span data-ttu-id="9ca81-173">*Предоставление* этого порта.</span><span class="sxs-lookup"><span data-stu-id="9ca81-173">*Expose* this port.</span></span> <span data-ttu-id="9ca81-174">С помощью декларативного подхода вы используете файл конфигурации, который описывает, что *вам нужно* , а не *то, что делать, и Kubernetes* , что нужно сделать для достижения нужного конечного состояния.</span><span class="sxs-lookup"><span data-stu-id="9ca81-174">With the declarative approach, you use a configuration file that describes *what you want* instead of *what to do* and Kubernetes figures out what to do to achieve the desired end state.</span></span> <span data-ttu-id="9ca81-175">Если вы уже настроили кластер с помощью императивных команд, можно экспортировать декларативный манифест с помощью `kubectl get svc SERVICENAME -o yaml > service.yaml`.</span><span class="sxs-lookup"><span data-stu-id="9ca81-175">If you've already configured your cluster using imperative commands, you can export a declarative manifest by using `kubectl get svc SERVICENAME -o yaml > service.yaml`.</span></span> <span data-ttu-id="9ca81-176">При этом будет создан файл манифеста следующего вида:</span><span class="sxs-lookup"><span data-stu-id="9ca81-176">This will produce a manifest file like this one:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: "2019-09-13T13:58:47Z"
  labels:
    component: apiserver
    provider: kubernetes
  name: kubernetes
  namespace: default
  resourceVersion: "153"
  selfLink: /api/v1/namespaces/default/services/kubernetes
  uid: 9b1fac62-d62e-11e9-8968-00155d38010d
spec:
  clusterIP: 10.96.0.1
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: 6443
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}
```

<span data-ttu-id="9ca81-177">При использовании декларативной конфигурации можно предварительно просмотреть изменения, которые будут внесены перед их фиксацией, с помощью `kubectl diff -f FOLDERNAME` к папке, в которой находятся файлы конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-177">When using declarative configuration, you can preview the changes that will be made before committing them by using `kubectl diff -f FOLDERNAME` against the folder where your configuration files are located.</span></span> <span data-ttu-id="9ca81-178">Убедившись, что вы хотите применить изменения, запустите `kubectl apply -f FOLDERNAME`.</span><span class="sxs-lookup"><span data-stu-id="9ca81-178">Once you're sure you want to apply the changes, run `kubectl apply -f FOLDERNAME`.</span></span> <span data-ttu-id="9ca81-179">Добавьте `-R` для рекурсивной обработки иерархии папок.</span><span class="sxs-lookup"><span data-stu-id="9ca81-179">Add `-R` to recursively process a folder hierarchy.</span></span>

<span data-ttu-id="9ca81-180">В дополнение к службам можно использовать декларативную конфигурацию для других функций Kubernetes, таких как *развертывания*.</span><span class="sxs-lookup"><span data-stu-id="9ca81-180">In addition to services, you can use declarative configuration for other Kubernetes features, such as *deployments*.</span></span> <span data-ttu-id="9ca81-181">Декларативные развертывания используются контроллерами развертывания для обновления ресурсов кластера.</span><span class="sxs-lookup"><span data-stu-id="9ca81-181">Declarative deployments are used by deployment controllers to update cluster resources.</span></span> <span data-ttu-id="9ca81-182">Развертывания используются для развертывания новых изменений, увеличения масштаба для поддержки дополнительной нагрузки или отката к предыдущей редакции.</span><span class="sxs-lookup"><span data-stu-id="9ca81-182">Deployments are used to roll out new changes, scale up to support more load, or roll back to a previous revision.</span></span> <span data-ttu-id="9ca81-183">Если кластер работает нестабильно, декларативные развертывания предоставляют механизм для автоматического переноса кластера в требуемое состояние.</span><span class="sxs-lookup"><span data-stu-id="9ca81-183">If a cluster is unstable, declarative deployments provide a mechanism for automatically bringing the cluster back to a desired state.</span></span>

<span data-ttu-id="9ca81-184">Использование декларативной конфигурации позволяет представить инфраструктуру в виде кода, который можно возвратить и поработать с версиями вместе с кодом приложения.</span><span class="sxs-lookup"><span data-stu-id="9ca81-184">Using declarative configuration allows infrastructure to be represented as code that can be checked in and versioned alongside the application code.</span></span> <span data-ttu-id="9ca81-185">Это обеспечивает улучшенный контроль изменений и улучшенную поддержку непрерывного развертывания с помощью конвейера сборки и развертывания, привязанного к изменениям системы управления версиями.</span><span class="sxs-lookup"><span data-stu-id="9ca81-185">This provides improved change control and better support for continuous deployment using a build and deploy pipeline tied to source control changes.</span></span>

## <a name="what-scenarios-are-ideal-for-containers-and-orchestrators"></a><span data-ttu-id="9ca81-186">Какие сценарии идеально подходят для контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="9ca81-186">What scenarios are ideal for containers and orchestrators?</span></span>

<span data-ttu-id="9ca81-187">Следующие сценарии идеально подходят для использования контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-187">The following scenarios are ideal for using containers and orchestrators.</span></span>

### <a name="applications-requiring-high-uptime-and-scalability"></a><span data-ttu-id="9ca81-188">Приложения, которым требуются высокая отказоустойчивость и масштабируемость</span><span class="sxs-lookup"><span data-stu-id="9ca81-188">Applications requiring high uptime and scalability</span></span>

<span data-ttu-id="9ca81-189">Отдельные приложения с высокой степенью бесперебойной работы и требованиями к масштабируемости являются идеальным кандидатом для собственных облачных архитектур, использующих микрослужбы, контейнеры и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-189">Individual applications that have high uptime and scalability requirements are ideal candidates for cloud-native architectures using microservices, containers, and orchestrators.</span></span> <span data-ttu-id="9ca81-190">Эти приложения можно разрабатывать в контейнерах с помощью сред с управлением версиями. их можно тщательно протестировать, прежде чем перейти в рабочую среду и можно будет развернуть в рабочей среде с нулевым временем простоя.</span><span class="sxs-lookup"><span data-stu-id="9ca81-190">These applications can be developed in containers using versioned environments, can be extensively tested before going to production, and can be deployed to production with zero downtime.</span></span> <span data-ttu-id="9ca81-191">Использование кластеров Kubernetes гарантирует, что такие приложения также могут масштабироваться по запросу и автоматически восстанавливаться при сбоях узлов.</span><span class="sxs-lookup"><span data-stu-id="9ca81-191">The use of Kubernetes clusters ensures such apps can also scale on demand and recover automatically from node failures.</span></span>

### <a name="large-numbers-of-applications"></a><span data-ttu-id="9ca81-192">Большое число приложений</span><span class="sxs-lookup"><span data-stu-id="9ca81-192">Large numbers of applications</span></span>

<span data-ttu-id="9ca81-193">Организации, которые развертывают и должны в дальнейшем поддерживать большое количество приложений, имеют преимущество от контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-193">Organizations that deploy and must subsequently maintain large numbers of applications benefit from containers and orchestrators.</span></span> <span data-ttu-id="9ca81-194">Настройка контейнерных сред и кластеров Kubernetes в первую очередь является фиксированной ценой.</span><span class="sxs-lookup"><span data-stu-id="9ca81-194">The up front effort of setting up containerized environments and Kubernetes clusters is primarily a fixed cost.</span></span> <span data-ttu-id="9ca81-195">При развертывании, обслуживании и обновлении отдельных приложений стоимость зависит от количества приложений, которые необходимо поддерживать.</span><span class="sxs-lookup"><span data-stu-id="9ca81-195">Deploying, maintaining, and updating individual applications has a cost that varies with the number of applications that must be maintained.</span></span> <span data-ttu-id="9ca81-196">Помимо определенного довольно небольшого количества приложений, сложность обслуживания пользовательских приложений вручную превышает затраты на реализацию решения с помощью контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-196">Beyond a certain fairly small number of applications, the complexity of maintaining custom applications manually exceeds the cost of implementing a solution using containers and orchestrators.</span></span>

## <a name="when-should-you-avoid-using-containers-and-orchestrators"></a><span data-ttu-id="9ca81-197">Когда следует избегать использования контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="9ca81-197">When should you avoid using containers and orchestrators?</span></span>

<span data-ttu-id="9ca81-198">Если вы не собираетесь создавать приложение и не сможете создать его, следуя этим принципам, возможно, лучше избегать контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="9ca81-198">If you're unwilling or unable to build your application following Twelve-Factor App principles, you'll probably be better off avoiding containers and orchestrators.</span></span> <span data-ttu-id="9ca81-199">В таких случаях лучше всего перейти вперед с платформы размещения на основе виртуальных машин или, возможно, некоторой гибридной системы, в которой можно прокрутить определенные части функциональности на отдельные контейнеры или даже на бессерверные функции.</span><span class="sxs-lookup"><span data-stu-id="9ca81-199">In these cases, it may be best to move forward with a VM-based hosting platform, or possibly some hybrid system in which you can spin off certain pieces of functionality into separate containers or even serverless functions.</span></span>

## <a name="development-resources"></a><span data-ttu-id="9ca81-200">Ресурсы по разработке</span><span class="sxs-lookup"><span data-stu-id="9ca81-200">Development resources</span></span>

<span data-ttu-id="9ca81-201">В этом разделе приведен краткий список ресурсов по разработке, которые могут помочь приступить к использованию контейнеров и оркестрации для следующего приложения.</span><span class="sxs-lookup"><span data-stu-id="9ca81-201">This section shows a short list of development resources that may help you get started using containers and orchestrators for your next application.</span></span> <span data-ttu-id="9ca81-202">Если вы ищете рекомендации по проектированию собственного облачного приложения архитектуры микрослужб, ознакомьтесь с руководством по работе с этой книгой, [микрослужбами .NET: архитектурой для контейнерных приложений .NET](https://aka.ms/microservicesebook).</span><span class="sxs-lookup"><span data-stu-id="9ca81-202">If you're looking for guidance on how to design your cloud-native microservices architecture app, read this book's companion, [.NET Microservices: Architecture for Containerized .NET Applications](https://aka.ms/microservicesebook).</span></span>

### <a name="local-kubernetes-development"></a><span data-ttu-id="9ca81-203">Локальная разработка Kubernetes</span><span class="sxs-lookup"><span data-stu-id="9ca81-203">Local Kubernetes Development</span></span>

<span data-ttu-id="9ca81-204">Развертывания Kubernetes предоставляют отличное значение в рабочих средах, но их также можно запускать локально.</span><span class="sxs-lookup"><span data-stu-id="9ca81-204">Kubernetes deployments provide great value in production environments, but you can also run them locally.</span></span> <span data-ttu-id="9ca81-205">Несмотря на то, что очень важно иметь возможность работать с отдельными приложениями или микрослужбами независимо, иногда бывает неплохо иметь возможность запускать всю систему локально, так же, как она будет выполняться при развертывании в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9ca81-205">Although much of the time it's good to be able to work on individual apps or microservices independently, sometimes it's good to be able to run the whole system locally just as it will run when deployed to production.</span></span> <span data-ttu-id="9ca81-206">Существует несколько способов добиться этого, два из которых — Minikube и DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="9ca81-206">There are several ways to achieve this, two of which are Minikube and Docker Desktop.</span></span> <span data-ttu-id="9ca81-207">Visual Studio также предоставляет средства для разработки DOCKER.</span><span class="sxs-lookup"><span data-stu-id="9ca81-207">Visual Studio also provides tooling for Docker development.</span></span>

### <a name="minikube"></a><span data-ttu-id="9ca81-208">Minikube</span><span class="sxs-lookup"><span data-stu-id="9ca81-208">Minikube</span></span>

<span data-ttu-id="9ca81-209">Что такое Minikube?</span><span class="sxs-lookup"><span data-stu-id="9ca81-209">What is Minikube?</span></span> <span data-ttu-id="9ca81-210">Проект Minikube говорит «Minikube реализует локальный кластер Kubernetes в macOS, Linux и Windows».</span><span class="sxs-lookup"><span data-stu-id="9ca81-210">The Minikube project says "Minikube implements a local Kubernetes cluster on macOS, Linux, and Windows."</span></span> <span data-ttu-id="9ca81-211">Ее основными целями являются «лучший инструмент для разработки локальных Kubernetes приложений и поддержка всех функций Kubernetes».</span><span class="sxs-lookup"><span data-stu-id="9ca81-211">Its primary goals are "to be the best tool for local Kubernetes application development and to support all Kubernetes features that fit."</span></span> <span data-ttu-id="9ca81-212">Установка Minikube отделена от DOCKER, но Minikube поддерживает различные низкоуровневые оболочки, чем поддерживает DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="9ca81-212">Installing Minikube is separate from Docker, but Minikube supports different hypervisors than Docker Desktop supports.</span></span> <span data-ttu-id="9ca81-213">В настоящее время Minikube поддерживает следующие функции Kubernetes:</span><span class="sxs-lookup"><span data-stu-id="9ca81-213">The following Kubernetes features are currently supported by Minikube:</span></span>

- <span data-ttu-id="9ca81-214">DNS</span><span class="sxs-lookup"><span data-stu-id="9ca81-214">DNS</span></span>
- <span data-ttu-id="9ca81-215">нодепортс</span><span class="sxs-lookup"><span data-stu-id="9ca81-215">NodePorts</span></span>
- <span data-ttu-id="9ca81-216">Конфигмапс и секреты</span><span class="sxs-lookup"><span data-stu-id="9ca81-216">ConfigMaps and secrets</span></span>
- <span data-ttu-id="9ca81-217">Панели мониторинга</span><span class="sxs-lookup"><span data-stu-id="9ca81-217">Dashboards</span></span>
- <span data-ttu-id="9ca81-218">Среды выполнения контейнеров: DOCKER, RKT, CRI-O и контейнеры</span><span class="sxs-lookup"><span data-stu-id="9ca81-218">Container runtimes: Docker, rkt, CRI-O, and containerd</span></span>
- <span data-ttu-id="9ca81-219">Включение сетевого интерфейса контейнера (CNI)</span><span class="sxs-lookup"><span data-stu-id="9ca81-219">Enabling Container Network Interface (CNI)</span></span>
- <span data-ttu-id="9ca81-220">Входящего трафика</span><span class="sxs-lookup"><span data-stu-id="9ca81-220">Ingress</span></span>

<span data-ttu-id="9ca81-221">После установки Minikube можно быстро приступить к работе, выполнив команду `minikube start`, которая скачивает образ и запускает локальный кластер Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-221">After installing Minikube, you can quickly start using it by running the `minikube start` command, which downloads an image and start the local Kubernetes cluster.</span></span> <span data-ttu-id="9ca81-222">После запуска кластера вы взаимодействуете с ним с помощью стандартных команд `kubectl` Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-222">Once the cluster is started, you interact with it using the standard Kubernetes `kubectl` commands.</span></span>

### <a name="docker-desktop"></a><span data-ttu-id="9ca81-223">DOCKER Desktop</span><span class="sxs-lookup"><span data-stu-id="9ca81-223">Docker Desktop</span></span>

<span data-ttu-id="9ca81-224">Вы также можете работать с Kubernetes непосредственно из DOCKER Desktop в Windows.</span><span class="sxs-lookup"><span data-stu-id="9ca81-224">You can also work with Kubernetes directly from Docker Desktop on Windows.</span></span> <span data-ttu-id="9ca81-225">Это единственный вариант, если вы используете контейнеры Windows, а также отличный выбор для контейнеров, отличных от Windows.</span><span class="sxs-lookup"><span data-stu-id="9ca81-225">This is your only option if you're using Windows Containers, and is a great choice for non-Windows containers as well.</span></span> <span data-ttu-id="9ca81-226">Для настройки Kubernetes, запускаемой из DOCKER Desktop, используется стандартное приложение конфигурации DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="9ca81-226">The standard Docker Desktop configuration app is used to configure Kubernetes running from Docker Desktop.</span></span>

![Настройка Kubernetes в DOCKER Desktop](./media/docker-desktop-kubernetes.png)

<span data-ttu-id="9ca81-228">**Рис. 3-4**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-228">**Figure 3-4**.</span></span> <span data-ttu-id="9ca81-229">Настройка Kubernetes в DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="9ca81-229">Configuring Kubernetes in Docker Desktop.</span></span>

<span data-ttu-id="9ca81-230">DOCKER Desktop уже является самым популярным средством для локальной настройки и запуска контейнерных приложений.</span><span class="sxs-lookup"><span data-stu-id="9ca81-230">Docker Desktop is already the most popular tool for configuring and running containerized apps locally.</span></span> <span data-ttu-id="9ca81-231">При работе с DOCKER Desktop можно разрабатывать локально на основе того же набора образов контейнеров DOCKER, который будет развернут в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9ca81-231">When you work with Docker Desktop, you can develop locally against the exact same set of Docker container images that you'll deploy to production.</span></span> <span data-ttu-id="9ca81-232">Приложение DOCKER Desktop предназначено для локального создания, тестирования и поставки контейнерных приложений.</span><span class="sxs-lookup"><span data-stu-id="9ca81-232">Docker Desktop is designed to "build, test, and ship" containerized apps locally.</span></span> <span data-ttu-id="9ca81-233">После отправки образов в реестр образов, например в реестр контейнеров Azure или DOCKER Hub, службы, такие как Azure Kubernetes Service (AKS), управляют приложением в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9ca81-233">Once the images have been shipped to an image registry like Azure Container Registry or Docker Hub, then services like Azure Kubernetes Service (AKS) manage the application in production.</span></span>

### <a name="visual-studio-docker-tooling"></a><span data-ttu-id="9ca81-234">Инструментарий DOCKER в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9ca81-234">Visual Studio Docker Tooling</span></span>

<span data-ttu-id="9ca81-235">Visual Studio поддерживает разработку DOCKER для веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="9ca81-235">Visual Studio supports Docker development for web applications.</span></span> <span data-ttu-id="9ca81-236">При создании нового ASP.NET Core приложения вы можете настроить его с поддержкой DOCKER в рамках процесса создания проекта, как показано на рис. 3-5.</span><span class="sxs-lookup"><span data-stu-id="9ca81-236">When you create a new ASP.NET Core application, you're given the option to configure it with Docker support as part of the project creation process, as shown in Figure 3-5.</span></span>

![Visual Studio включить поддержку DOCKER](./media/visual-studio-enable-docker-support.png)

<span data-ttu-id="9ca81-238">**Рис. 3-5**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-238">**Figure 3-5**.</span></span> <span data-ttu-id="9ca81-239">Visual Studio включить поддержку DOCKER</span><span class="sxs-lookup"><span data-stu-id="9ca81-239">Visual Studio Enable Docker Support</span></span>

<span data-ttu-id="9ca81-240">Если выбран этот параметр, проект создается с `Dockerfile` в корневом каталоге, который можно использовать для создания и размещения приложения в контейнере DOCKER.</span><span class="sxs-lookup"><span data-stu-id="9ca81-240">When this option is selected, the project is created with a `Dockerfile` in its root, which can be used to build and host the app in a Docker container.</span></span> <span data-ttu-id="9ca81-241">Пример Dockerfile показан на рисунке 3-6.</span><span class="sxs-lookup"><span data-stu-id="9ca81-241">An example Dockerfile is shown in Figure 3-6.</span></span>

```docker
FROM mcr.microsoft.com/dotnet/core/aspnet:3.0-stretch-slim AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/core/sdk:3.0-stretch AS build
WORKDIR /src
COPY ["WebApplication3/WebApplication3.csproj", "WebApplication3/"]
RUN dotnet restore "WebApplication3/WebApplication3.csproj"
COPY . .
WORKDIR "/src/WebApplication3"
RUN dotnet build "WebApplication3.csproj" -c Release -o /app

FROM build AS publish
RUN dotnet publish "WebApplication3.csproj" -c Release -o /app

FROM base AS final
WORKDIR /app
COPY --from=publish /app .
ENTRYPOINT ["dotnet", "WebApplication3.dll"]
```

<span data-ttu-id="9ca81-242">**Рис. 3-6**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-242">**Figure 3-6**.</span></span> <span data-ttu-id="9ca81-243">Visual Studio Generated Dockerfile</span><span class="sxs-lookup"><span data-stu-id="9ca81-243">Visual Studio generated Dockerfile</span></span>

<span data-ttu-id="9ca81-244">Поведение по умолчанию при запуске приложения настроено на использование DOCKER.</span><span class="sxs-lookup"><span data-stu-id="9ca81-244">The default behavior when the app runs is configured to use Docker as well.</span></span> <span data-ttu-id="9ca81-245">На рис. 3-7 показаны различные параметры запуска, доступные в новом проекте ASP.NET Core, созданном с помощью добавленной поддержки DOCKER.</span><span class="sxs-lookup"><span data-stu-id="9ca81-245">Figure 3-7 shows the different run options available from a new ASP.NET Core project created with Docker support added.</span></span>

![Параметры запуска для Visual Studio DOCKER](./media/visual-studio-docker-run-options.png)

<span data-ttu-id="9ca81-247">**Рис. 3-7**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-247">**Figure 3-7**.</span></span> <span data-ttu-id="9ca81-248">Параметры запуска для Visual Studio DOCKER</span><span class="sxs-lookup"><span data-stu-id="9ca81-248">Visual Studio Docker Run Options</span></span>

<span data-ttu-id="9ca81-249">Помимо локальной разработки [Azure dev Spaces](https://docs.microsoft.com/azure/dev-spaces/) предоставляет несколько разработчикам удобный способ работы с собственными конфигурациями Kubernetes в Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca81-249">In addition to local development, [Azure Dev Spaces](https://docs.microsoft.com/azure/dev-spaces/) provides a convenient way for multiple developers to work with their own Kubernetes configurations within Azure.</span></span> <span data-ttu-id="9ca81-250">Как видно на рисунке 3-7, приложение можно также запустить в Azure Dev Spaces.</span><span class="sxs-lookup"><span data-stu-id="9ca81-250">As you can see in Figure 3-7, you can also run the application in Azure Dev Spaces.</span></span>

<span data-ttu-id="9ca81-251">Если вы не добавляете поддержку DOCKER в приложение ASP.NET Core при его создании, всегда можно добавить его позже.</span><span class="sxs-lookup"><span data-stu-id="9ca81-251">If you don't add Docker support to your ASP.NET Core application when you create it, you can always add it later.</span></span> <span data-ttu-id="9ca81-252">В обозреватель решений Visual Studio щелкните проект правой кнопкой мыши и выберите **добавить** > **Поддержка DOCKER**, как показано на рис. 3-8.</span><span class="sxs-lookup"><span data-stu-id="9ca81-252">From the Visual Studio Solution Explorer, right click on the project and select **Add** > **Docker Support**, as shown in Figure 3-8.</span></span>

![Поддержка добавления DOCKER в Visual Studio](./media/visual-studio-add-docker-support.png)

<span data-ttu-id="9ca81-254">**Рис. 3-8**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-254">**Figure 3-8**.</span></span> <span data-ttu-id="9ca81-255">Поддержка добавления DOCKER в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9ca81-255">Visual Studio Add Docker Support</span></span>

<span data-ttu-id="9ca81-256">Помимо поддержки DOCKER, также можно добавить поддержку оркестрации контейнеров, также показанную на рисунке 3-8.</span><span class="sxs-lookup"><span data-stu-id="9ca81-256">In addition to Docker support, you can also add Container Orchestration Support, also shown in Figure 3-8.</span></span> <span data-ttu-id="9ca81-257">По умолчанию Orchestrator использует Kubernetes и Helm.</span><span class="sxs-lookup"><span data-stu-id="9ca81-257">By default, the orchestrator uses Kubernetes and Helm.</span></span> <span data-ttu-id="9ca81-258">После выбора Orchestrator в корневой каталог проекта добавляется `azds.yaml` файл, и добавляется папка `charts`, содержащая диаграммы Helm, используемые для настройки и развертывания приложения в Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9ca81-258">Once you've chosen the orchestrator, a `azds.yaml` file is added to the project root and a `charts` folder is added containing the Helm charts used to configure and deploy the application to Kubernetes.</span></span> <span data-ttu-id="9ca81-259">На рис. 3-9 показаны итоговые файлы в новом проекте.</span><span class="sxs-lookup"><span data-stu-id="9ca81-259">Figure 3-9 shows the resulting files in a new project.</span></span>

![Добавление поддержки Orchestrator в Visual Studio](./media/visual-studio-add-orchestrator-support.png)

<span data-ttu-id="9ca81-261">**Рис. 3-9**.</span><span class="sxs-lookup"><span data-stu-id="9ca81-261">**Figure 3-9**.</span></span> <span data-ttu-id="9ca81-262">Добавление поддержки Orchestrator в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9ca81-262">Visual Studio Add Orchestrator Support</span></span>

## <a name="references"></a><span data-ttu-id="9ca81-263">Ссылки</span><span class="sxs-lookup"><span data-stu-id="9ca81-263">References</span></span>

- [<span data-ttu-id="9ca81-264">Что такое Kubernetes?</span><span class="sxs-lookup"><span data-stu-id="9ca81-264">What is Kubernetes?</span></span>](https://blog.newrelic.com/engineering/what-is-kubernetes/)
- [<span data-ttu-id="9ca81-265">Установка Kubernetes с помощью Minikube</span><span class="sxs-lookup"><span data-stu-id="9ca81-265">Installing Kubernetes with Minikube</span></span>](https://kubernetes.io/docs/setup/learning-environment/minikube/)
- [<span data-ttu-id="9ca81-266">MiniKube VS DOCKER Desktop</span><span class="sxs-lookup"><span data-stu-id="9ca81-266">MiniKube vs Docker Desktop</span></span>](https://medium.com/containers-101/local-kubernetes-for-windows-minikube-vs-docker-desktop-25a1c6d3b766)
- [<span data-ttu-id="9ca81-267">Инструменты Visual Studio для Docker</span><span class="sxs-lookup"><span data-stu-id="9ca81-267">Visual Studio Tools for Docker</span></span>](https://docs.microsoft.com/dotnet/standard/containerized-lifecycle-architecture/design-develop-containerized-apps/visual-studio-tools-for-docker)

>[!div class="step-by-step"]
><span data-ttu-id="9ca81-268">[Назад](scale-applications.md)
>[Вперед](leverage-serverless-functions.md)</span><span class="sxs-lookup"><span data-stu-id="9ca81-268">[Previous](scale-applications.md)
[Next](leverage-serverless-functions.md)</span></span>
