---
title: Использование контейнеров и оркестраторов
description: Использование контейнеров DOCKER и orchestration Kubernetes в Azure
ms.date: 04/13/2020
ms.openlocfilehash: 64c6c0666398d9ccbc87efad18017bf278568fc4
ms.sourcegitcommit: 957c49696eaf048c284ef8f9f8ffeb562357ad95
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2020
ms.locfileid: "82895552"
---
# <a name="leveraging-containers-and-orchestrators"></a><span data-ttu-id="669a0-103">Использование контейнеров и оркестраторов</span><span class="sxs-lookup"><span data-stu-id="669a0-103">Leveraging containers and orchestrators</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="669a0-104">Контейнеры и оркестрации предназначены для решения проблем, характерных для монолитных подходов к развертыванию.</span><span class="sxs-lookup"><span data-stu-id="669a0-104">Containers and orchestrators are designed to solve problems common to monolithic deployment approaches.</span></span>

## <a name="challenges-with-monolithic-deployments"></a><span data-ttu-id="669a0-105">Проблемы с монолитными развертываниями</span><span class="sxs-lookup"><span data-stu-id="669a0-105">Challenges with monolithic deployments</span></span>

<span data-ttu-id="669a0-106">Обычно большинство приложений развернуты как единое целое.</span><span class="sxs-lookup"><span data-stu-id="669a0-106">Traditionally, most applications have been deployed as a single unit.</span></span> <span data-ttu-id="669a0-107">Такие приложения называются монолитными.</span><span class="sxs-lookup"><span data-stu-id="669a0-107">Such applications are referred to as a monolith.</span></span> <span data-ttu-id="669a0-108">Этот общий подход к развертыванию приложений в виде отдельных единиц, даже если они состоят из нескольких модулей или сборок, называется монолитной архитектурой, как показано на рисунке 3-1.</span><span class="sxs-lookup"><span data-stu-id="669a0-108">This general approach of deploying applications as single units even if they're composed of multiple modules or assemblies is known as monolithic architecture, as shown in Figure 3-1.</span></span>

![Монолитная архитектура.](./media/monolithic-architecture.png)

<span data-ttu-id="669a0-110">**Рис. 3-1**.</span><span class="sxs-lookup"><span data-stu-id="669a0-110">**Figure 3-1**.</span></span> <span data-ttu-id="669a0-111">Монолитная архитектура.</span><span class="sxs-lookup"><span data-stu-id="669a0-111">Monolithic architecture.</span></span>

<span data-ttu-id="669a0-112">Хотя они имеют преимущество простоты, монолитные архитектуры сталкиваются с несколькими проблемами:</span><span class="sxs-lookup"><span data-stu-id="669a0-112">Although they have the benefit of simplicity, monolithic architectures face a number of challenges:</span></span>

### <a name="deployment"></a><span data-ttu-id="669a0-113">Развертывание</span><span class="sxs-lookup"><span data-stu-id="669a0-113">Deployment</span></span>

<span data-ttu-id="669a0-114">Для монолитных приложений требуется полное развертывание всего приложения, даже если было внесено небольшое изменение.</span><span class="sxs-lookup"><span data-stu-id="669a0-114">Monolithic applications require a full deployment of the entire application, even if only a small change has been made.</span></span> <span data-ttu-id="669a0-115">Полные развертывания могут быть дорогостоящими и подвержены ошибкам.</span><span class="sxs-lookup"><span data-stu-id="669a0-115">Full deployments can be expensive and error prone.</span></span> <span data-ttu-id="669a0-116">Кроме того, они нуждаются в перезапуске приложения, временно влияющем на недоступность.</span><span class="sxs-lookup"><span data-stu-id="669a0-116">Additionally, they require a restart of the application, which temporarily impacts unavailability.</span></span>

### <a name="scaling"></a><span data-ttu-id="669a0-117">Масштабирование</span><span class="sxs-lookup"><span data-stu-id="669a0-117">Scaling</span></span>

<span data-ttu-id="669a0-118">Монолитное приложение полностью размещается на одном экземпляре компьютера, что часто требует наличия оборудования с высокой степенью возможностей.</span><span class="sxs-lookup"><span data-stu-id="669a0-118">A monolithic application is hosted entirely on a single machine instance, often requiring high-capability hardware.</span></span> <span data-ttu-id="669a0-119">Если для какой бы то ни было части монолита требуется масштабирование, то на другой компьютер должна быть развернута еще одна копия всего приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-119">If any part of the monolith requires scaling, another copy of the entire application must be deployed to another machine.</span></span> <span data-ttu-id="669a0-120">С монолитой вы не можете масштабировать компоненты приложения по отдельности — все или ничего.</span><span class="sxs-lookup"><span data-stu-id="669a0-120">With a monolith, you can't scale application components individually - it's all or nothing.</span></span> <span data-ttu-id="669a0-121">Масштабирование компонентов, которые не требуют масштабирования, приводит к неэффективному и дорогостоящему использованию ресурсов.</span><span class="sxs-lookup"><span data-stu-id="669a0-121">Scaling components that don't require scaling results in inefficient and costly resource usage.</span></span>

### <a name="environment"></a><span data-ttu-id="669a0-122">Среда</span><span class="sxs-lookup"><span data-stu-id="669a0-122">Environment</span></span>

<span data-ttu-id="669a0-123">Монолитные приложения обычно развертываются в среде размещения с предварительно установленными зависимостями операционной системы, среды выполнения и библиотек.</span><span class="sxs-lookup"><span data-stu-id="669a0-123">Monolithic applications are typically deployed to a hosting environment with a pre-installed operating system, runtime, and library dependencies.</span></span> <span data-ttu-id="669a0-124">Эта среда может не совпадать с той, на которой приложение было разработано или протестировано.</span><span class="sxs-lookup"><span data-stu-id="669a0-124">This environment may not match that upon which the application was developed or tested.</span></span> <span data-ttu-id="669a0-125">Несогласованность между средами приложений является распространенным источником проблем для монолитных развертываний.</span><span class="sxs-lookup"><span data-stu-id="669a0-125">Inconsistencies across application environments are a common source of problems for monolithic deployments.</span></span>

### <a name="coupling"></a><span data-ttu-id="669a0-126">Тесн</span><span class="sxs-lookup"><span data-stu-id="669a0-126">Coupling</span></span>

<span data-ttu-id="669a0-127">Монолитное приложение, скорее всего, будет работать с высокой взаимозависимостью от функциональных компонентов.</span><span class="sxs-lookup"><span data-stu-id="669a0-127">A monolithic application is likely to experience high coupling across its functional components.</span></span> <span data-ttu-id="669a0-128">Без жестких границ системные изменения часто приводят к непредвиденным и дорогостоящим побочным эффектам.</span><span class="sxs-lookup"><span data-stu-id="669a0-128">Without hard boundaries, system changes often result in unintended and costly side effects.</span></span> <span data-ttu-id="669a0-129">Новые функции и исправления становятся сложными, трудоемкими и затратными для реализации.</span><span class="sxs-lookup"><span data-stu-id="669a0-129">New features/fixes become tricky, time-consuming, and expensive to implement.</span></span> <span data-ttu-id="669a0-130">Для обновлений требуется всестороннее тестирование.</span><span class="sxs-lookup"><span data-stu-id="669a0-130">Updates require extensive testing.</span></span> <span data-ttu-id="669a0-131">Связывание также затрудняет рефакторинг компонентов или замену в альтернативных реализациях.</span><span class="sxs-lookup"><span data-stu-id="669a0-131">Coupling also makes it difficult to refactor components or swap in alternative implementations.</span></span> <span data-ttu-id="669a0-132">Даже при использовании строгого разделения проблем архитектурные еросион наборы в виде монолитной базы кода, как правило, приводит к разрушению незавершенных "особых случаев".</span><span class="sxs-lookup"><span data-stu-id="669a0-132">Even when constructed with a strict separation of concerns, architectural erosion sets in as the monolithic code base deteriorates with never-ending "special cases."</span></span>

### <a name="platform-lock-in"></a><span data-ttu-id="669a0-133">Блокировка платформы — в</span><span class="sxs-lookup"><span data-stu-id="669a0-133">Platform lock-in</span></span>

<span data-ttu-id="669a0-134">Монолитное приложение создается с помощью одного стека технологий.</span><span class="sxs-lookup"><span data-stu-id="669a0-134">A monolithic application is constructed with a single technology stack.</span></span> <span data-ttu-id="669a0-135">При предоставлении единообразия это обязательство может стать препятствием для инноваций.</span><span class="sxs-lookup"><span data-stu-id="669a0-135">While offering uniformity, this commitment can become a barrier to innovation.</span></span> <span data-ttu-id="669a0-136">Новые функции и компоненты будут создаваться с использованием текущего стека приложения, даже если более современные технологии могут быть лучшим выбором.</span><span class="sxs-lookup"><span data-stu-id="669a0-136">New features and components will be built using the application's current stack - even when more modern technologies may be a better choice.</span></span> <span data-ttu-id="669a0-137">Долгосрочный риск — ваш стек технологий становится устаревшим и устаревшим.</span><span class="sxs-lookup"><span data-stu-id="669a0-137">A longer-term risk is your technology stack becoming outdated and obsolete.</span></span> <span data-ttu-id="669a0-138">При перепроектировании всего приложения до новой, более современной платформы лучше всего надорого и рискованно.</span><span class="sxs-lookup"><span data-stu-id="669a0-138">Rearchitecting an entire application to a new, more modern platform is at best expensive and risky.</span></span>

## <a name="what-are-the-benefits-of-containers-and-orchestrators"></a><span data-ttu-id="669a0-139">Каковы преимущества контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="669a0-139">What are the benefits of containers and orchestrators?</span></span>

<span data-ttu-id="669a0-140">Мы предоставили контейнеры в главе 1.</span><span class="sxs-lookup"><span data-stu-id="669a0-140">We introduced containers in Chapter 1.</span></span> <span data-ttu-id="669a0-141">Мы выделили, каким образом облачная инфраструктура машинного кода (КНКФ) ранжирует схему в качестве первого шага в [собственных облачных](https://raw.githubusercontent.com/cncf/trailmap/master/CNCF_TrailMap_latest.png) руководствах по основам для предприятий, которые начинают свое облако в собственном облаке.</span><span class="sxs-lookup"><span data-stu-id="669a0-141">We highlighted how the Cloud Native Computing Foundation (CNCF) ranks containerization as the first step in their [Cloud-Native Trail Map](https://raw.githubusercontent.com/cncf/trailmap/master/CNCF_TrailMap_latest.png) - guidance for enterprises beginning their cloud-native journey.</span></span> <span data-ttu-id="669a0-142">В этом разделе обсуждаются преимущества контейнеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-142">In this section, we discuss the benefits of containers.</span></span>

<span data-ttu-id="669a0-143">DOCKER — это самая популярная платформа управления контейнерами.</span><span class="sxs-lookup"><span data-stu-id="669a0-143">Docker is the most popular container management platform.</span></span> <span data-ttu-id="669a0-144">Он работает с контейнерами как в Linux, так и в Windows.</span><span class="sxs-lookup"><span data-stu-id="669a0-144">It works with containers on both Linux or Windows.</span></span> <span data-ttu-id="669a0-145">Контейнеры предоставляют отдельные, но воспроизводимые среды приложений, которые выполняются одинаково в любой системе.</span><span class="sxs-lookup"><span data-stu-id="669a0-145">Containers provide separate but reproducible application environments that run the same way on any system.</span></span> <span data-ttu-id="669a0-146">Этот аспект делает их идеальными для разработки и размещения облачных служб.</span><span class="sxs-lookup"><span data-stu-id="669a0-146">This aspect makes them perfect for developing and hosting cloud-native services.</span></span> <span data-ttu-id="669a0-147">Контейнеры изолированы друг от друга.</span><span class="sxs-lookup"><span data-stu-id="669a0-147">Containers are isolated from one another.</span></span> <span data-ttu-id="669a0-148">Два контейнера на одном и том же оборудовании узла могут иметь разные версии программного обеспечения, не вызывая конфликтов.</span><span class="sxs-lookup"><span data-stu-id="669a0-148">Two containers on the same host hardware can have different versions of software, without causing conflicts.</span></span>

<span data-ttu-id="669a0-149">Контейнеры определяются простыми текстовыми файлами, которые становятся артефактами проекта и возвращаются в систему управления версиями.</span><span class="sxs-lookup"><span data-stu-id="669a0-149">Containers are defined by simple text-based files that become project artifacts and are checked into source control.</span></span> <span data-ttu-id="669a0-150">Хотя для обновления полных серверов и виртуальных машин требуется ручное обновление, контейнеры легко контролируются версиями.</span><span class="sxs-lookup"><span data-stu-id="669a0-150">While full servers and virtual machines require manual effort to update, containers are easily version-controlled.</span></span> <span data-ttu-id="669a0-151">Приложения, созданные для работы в контейнерах, можно разрабатывать, тестировать и развертывать с помощью автоматизированных средств в составе конвейера сборки.</span><span class="sxs-lookup"><span data-stu-id="669a0-151">Apps built to run in containers can be developed, tested, and deployed using automated tools as part of a build pipeline.</span></span>

<span data-ttu-id="669a0-152">Контейнеры являются неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="669a0-152">Containers are immutable.</span></span> <span data-ttu-id="669a0-153">После определения контейнера его можно повторно создать и запустить точно таким же образом.</span><span class="sxs-lookup"><span data-stu-id="669a0-153">Once you define a container, you can recreate and run it exactly the same way.</span></span> <span data-ttu-id="669a0-154">Эта неизменность предоставляет модель, основанную на компонентах.</span><span class="sxs-lookup"><span data-stu-id="669a0-154">This immutability lends itself to component-based design.</span></span> <span data-ttu-id="669a0-155">Если некоторые части приложения развиваются иначе, чем другие, то зачем развертывать все приложение, когда можно просто развернуть наиболее часто меняющиеся части?</span><span class="sxs-lookup"><span data-stu-id="669a0-155">If some parts of an application evolve differently than others, why redeploy the entire app when you can just deploy the parts that change most frequently?</span></span> <span data-ttu-id="669a0-156">Различные функции и проблемы с перекрестной обрезкой приложения можно разбить на отдельные единицы.</span><span class="sxs-lookup"><span data-stu-id="669a0-156">Different features and cross-cutting concerns of an app can be broken up into separate units.</span></span> <span data-ttu-id="669a0-157">На рис. 3-2 показано, как монолитное приложение может использовать преимущества контейнеров и микрослужб, делегируя определенные функции или функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="669a0-157">Figure 3-2 shows how a monolithic app can take advantage of containers and microservices by delegating certain features or functionality.</span></span> <span data-ttu-id="669a0-158">Остальные функции в самом приложении также были контейнерными.</span><span class="sxs-lookup"><span data-stu-id="669a0-158">The remaining functionality in the app itself has also been containerized.</span></span>

<span data-ttu-id="669a0-159">Контейнеры являются неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="669a0-159">Containers are immutable.</span></span> <span data-ttu-id="669a0-160">После определения контейнера его можно повторно создать и запустить точно таким же образом.</span><span class="sxs-lookup"><span data-stu-id="669a0-160">Once you define a container, you can recreate and run it exactly the same way.</span></span> <span data-ttu-id="669a0-161">Эта неизменность предоставляет модель, основанную на компонентах.</span><span class="sxs-lookup"><span data-stu-id="669a0-161">This immutability lends itself to component-based design.</span></span> <span data-ttu-id="669a0-162">Если некоторые части приложения развиваются иначе, чем другие, то зачем развертывать все приложение, когда можно просто развернуть наиболее часто меняющиеся части?</span><span class="sxs-lookup"><span data-stu-id="669a0-162">If some parts of an application evolve differently than others, why redeploy the entire app when you can just deploy the parts that change most frequently?</span></span> <span data-ttu-id="669a0-163">Различные функции и проблемы с перекрестной обрезкой приложения можно разбить на отдельные единицы.</span><span class="sxs-lookup"><span data-stu-id="669a0-163">Different features and cross-cutting concerns of an app can be broken up into separate units.</span></span> <span data-ttu-id="669a0-164">На рис. 3-2 показано, как монолитное приложение может использовать преимущества контейнеров и микрослужб, делегируя определенные функции или функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="669a0-164">Figure 3-2 shows how a monolithic app can take advantage of containers and microservices by delegating certain features or functionality.</span></span> <span data-ttu-id="669a0-165">Остальные функции в самом приложении также были контейнерными.</span><span class="sxs-lookup"><span data-stu-id="669a0-165">The remaining functionality in the app itself has also been containerized.</span></span>

<span data-ttu-id="669a0-166">![Разбивает монолитное приложение на использование микрослужб в серверной части. ](./media/breaking-up-monolith-with-backend-microservices.png)
 **Рис. 3-2**.</span><span class="sxs-lookup"><span data-stu-id="669a0-166">![Breaking up a monolithic app to use microservices in the back end.](./media/breaking-up-monolith-with-backend-microservices.png)
**Figure 3-2**.</span></span> <span data-ttu-id="669a0-167">Разбивает монолитное приложение на использование микрослужб в серверной части.</span><span class="sxs-lookup"><span data-stu-id="669a0-167">Breaking up a monolithic app to use microservices in the back end.</span></span>

<span data-ttu-id="669a0-168">Каждая облачная служба строится и развертывается в отдельном контейнере.</span><span class="sxs-lookup"><span data-stu-id="669a0-168">Each cloud-native service is built and deployed in a separate container.</span></span> <span data-ttu-id="669a0-169">Каждый из них может обновляться по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="669a0-169">Each can update as needed.</span></span> <span data-ttu-id="669a0-170">Отдельные службы могут размещаться на узлах с ресурсами, соответствующими каждой службе.</span><span class="sxs-lookup"><span data-stu-id="669a0-170">Individual services can be hosted on nodes with resources appropriate to each service.</span></span> <span data-ttu-id="669a0-171">Среда, в которой работает каждая служба, является неизменяемой, совместно используемой в средах разработки, тестирования и рабочей среды и легко связана с управлением версиями.</span><span class="sxs-lookup"><span data-stu-id="669a0-171">The environment each service runs in is immutable, shared across dev, test, and production environments, and easily versioned.</span></span> <span data-ttu-id="669a0-172">Связь между различными областями приложения происходит явным образом в виде вызовов или сообщений между службами, а не зависимостями во время компиляции внутри монолиты.</span><span class="sxs-lookup"><span data-stu-id="669a0-172">Coupling between different areas of the application occurs explicitly as calls or messages between services, not compile-time dependencies within the monolith.</span></span> <span data-ttu-id="669a0-173">Вы также можете выбрать технологию, которая лучше всего подходит для данной возможности, не требуя внесения изменений в остальную часть приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-173">You can also choose the technology that best suites a given capability without requiring changes to the rest of the app.</span></span>

<span data-ttu-id="669a0-174">Для контейнерных служб требуется автоматическое управление.</span><span class="sxs-lookup"><span data-stu-id="669a0-174">Containerized services require automated management.</span></span> <span data-ttu-id="669a0-175">Было бы невозможным вручную администрировать большой набор независимо развернутых контейнеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-175">It wouldn't be feasible to manually administer a large set of independently deployed containers.</span></span> <span data-ttu-id="669a0-176">Например, рассмотрим следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="669a0-176">For example, consider the following tasks:</span></span>

- <span data-ttu-id="669a0-177">Как будут подготавливаться экземпляры контейнеров в кластере нескольких компьютеров?</span><span class="sxs-lookup"><span data-stu-id="669a0-177">How will container instances be provisioned across a cluster of many machines?</span></span>
- <span data-ttu-id="669a0-178">Как будет развернут, как контейнеры будут обнаруживать друг друга и обмениваться данными?</span><span class="sxs-lookup"><span data-stu-id="669a0-178">Once deployed, how will containers discover and communicate with each other?</span></span>
- <span data-ttu-id="669a0-179">Как контейнеры могут масштабироваться или по требованию?</span><span class="sxs-lookup"><span data-stu-id="669a0-179">How can containers scale in or out on-demand?</span></span>
- <span data-ttu-id="669a0-180">Как отслеживать работоспособность каждого контейнера?</span><span class="sxs-lookup"><span data-stu-id="669a0-180">How do you monitor the health of each container?</span></span>
- <span data-ttu-id="669a0-181">Как защитить контейнер от сбоев оборудования и программного обеспечения?</span><span class="sxs-lookup"><span data-stu-id="669a0-181">How do you protect a container against hardware and software failures?</span></span>
- <span data-ttu-id="669a0-182">Как обновить Контейнеры для активного приложения с нулевым временем простоя?</span><span class="sxs-lookup"><span data-stu-id="669a0-182">How do upgrade containers for a live application with zero downtime?</span></span>

<span data-ttu-id="669a0-183">Оркестрации контейнеров позволяют решать и автоматизировать эти и другие задачи.</span><span class="sxs-lookup"><span data-stu-id="669a0-183">Container orchestrators address and automate these and other concerns.</span></span>

<span data-ttu-id="669a0-184">В облачной системе экономичной системы Kubernetes стал де-факто контейнером Orchestrator.</span><span class="sxs-lookup"><span data-stu-id="669a0-184">In the cloud-native eco-system, Kubernetes has become the de facto container orchestrator.</span></span> <span data-ttu-id="669a0-185">Это платформа с открытым кодом, управляемая облачной средой Cloud Foundation (КНКФ).</span><span class="sxs-lookup"><span data-stu-id="669a0-185">It's an open-source platform managed by the Cloud Native Computing Foundation (CNCF).</span></span> <span data-ttu-id="669a0-186">Kubernetes автоматизирует развертывание, масштабирование и эксплуатационные проблемы в контейнерных рабочих нагрузках в кластере компьютеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-186">Kubernetes automates the deployment, scaling, and operational concerns of containerized workloads across a machine cluster.</span></span> <span data-ttu-id="669a0-187">Однако установка Kubernetes и управление ими являются сложными.</span><span class="sxs-lookup"><span data-stu-id="669a0-187">However, installing and managing Kubernetes is notoriously complex.</span></span>

<span data-ttu-id="669a0-188">Гораздо лучшим подходом является использование Kubernetes в качестве управляемой службы от поставщика облачных служб.</span><span class="sxs-lookup"><span data-stu-id="669a0-188">A much better approach is to leverage Kubernetes as a managed service from a cloud vendor.</span></span> <span data-ttu-id="669a0-189">В облаке Azure реализована полностью управляемая платформа Kubernetes с [пакетом Azure Kubernetes Service (AKS)](https://azure.microsoft.com/services/kubernetes-service/).</span><span class="sxs-lookup"><span data-stu-id="669a0-189">The Azure cloud features a fully managed Kubernetes platform entitled [Azure Kubernetes Service (AKS)](https://azure.microsoft.com/services/kubernetes-service/).</span></span> <span data-ttu-id="669a0-190">AKS абстрагирует сложность и эксплуатационные издержки на управление Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-190">AKS abstracts the complexity and operational overhead of managing Kubernetes.</span></span> <span data-ttu-id="669a0-191">Использование Kubernetes в качестве облачной службы; Корпорация Майкрософт несет ответственность за управление и поддержку.</span><span class="sxs-lookup"><span data-stu-id="669a0-191">You consume Kubernetes as a cloud service; Microsoft takes responsibility for managing and supporting it.</span></span> <span data-ttu-id="669a0-192">AKS также тесно интегрируется с другими службами Azure и средствами разработки.</span><span class="sxs-lookup"><span data-stu-id="669a0-192">AKS also tightly integrates with other Azure services and dev tools.</span></span>

<span data-ttu-id="669a0-193">AKS — это технология на основе кластера.</span><span class="sxs-lookup"><span data-stu-id="669a0-193">AKS is a cluster-based technology.</span></span> <span data-ttu-id="669a0-194">Пул федеративных виртуальных машин или узлов развертывается в облаке Azure.</span><span class="sxs-lookup"><span data-stu-id="669a0-194">A pool of federated virtual machines, or nodes, is deployed to the Azure cloud.</span></span> <span data-ttu-id="669a0-195">Вместе они формируют среду высокой доступности или кластер.</span><span class="sxs-lookup"><span data-stu-id="669a0-195">Together they form a highly available environment, or cluster.</span></span> <span data-ttu-id="669a0-196">Кластер выглядит как простая единая сущность для собственного облачного приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-196">The cluster appears as a seamless, single entity to your cloud-native application.</span></span> <span data-ttu-id="669a0-197">В этом случае AKS развертывает контейнерные службы на этих узлах после предопределенной стратегии, которая равномерно распределяет нагрузку.</span><span class="sxs-lookup"><span data-stu-id="669a0-197">Under the hood, AKS deploys your containerized services across these nodes following a predefined strategy that evenly distributes the load.</span></span>

<span data-ttu-id="669a0-198">Для контейнерных служб требуется автоматическое управление.</span><span class="sxs-lookup"><span data-stu-id="669a0-198">Containerized services require automated management.</span></span> <span data-ttu-id="669a0-199">Было бы невозможным вручную администрировать большой набор независимо развернутых контейнеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-199">It wouldn't be feasible to manually administer a large set of independently deployed containers.</span></span> <span data-ttu-id="669a0-200">Например, рассмотрим следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="669a0-200">For example, consider the following tasks:</span></span>

- <span data-ttu-id="669a0-201">Как будут подготавливаться экземпляры контейнеров в кластере нескольких компьютеров?</span><span class="sxs-lookup"><span data-stu-id="669a0-201">How will container instances be provisioned across a cluster of many machines?</span></span>
- <span data-ttu-id="669a0-202">Как будет развернут, как контейнеры будут обнаруживать друг друга и обмениваться данными?</span><span class="sxs-lookup"><span data-stu-id="669a0-202">Once deployed, how will containers discover and communicate with each other?</span></span>
- <span data-ttu-id="669a0-203">Как контейнеры могут масштабироваться или по требованию?</span><span class="sxs-lookup"><span data-stu-id="669a0-203">How can containers scale in or out on-demand?</span></span>
- <span data-ttu-id="669a0-204">Как отслеживать работоспособность каждого контейнера?</span><span class="sxs-lookup"><span data-stu-id="669a0-204">How do you monitor the health of each container?</span></span>
- <span data-ttu-id="669a0-205">Как защитить контейнер от сбоев оборудования и программного обеспечения?</span><span class="sxs-lookup"><span data-stu-id="669a0-205">How do you protect a container against hardware and software failures?</span></span>
- <span data-ttu-id="669a0-206">Как обновить Контейнеры для активного приложения с нулевым временем простоя?</span><span class="sxs-lookup"><span data-stu-id="669a0-206">How do upgrade containers for a live application with zero downtime?</span></span>

<span data-ttu-id="669a0-207">Оркестрации контейнеров позволяют решать и автоматизировать эти и другие задачи.</span><span class="sxs-lookup"><span data-stu-id="669a0-207">Container orchestrators address and automate these and other concerns.</span></span>

<span data-ttu-id="669a0-208">В облачной системе экономичной системы Kubernetes стал де-факто контейнером Orchestrator.</span><span class="sxs-lookup"><span data-stu-id="669a0-208">In the cloud-native eco-system, Kubernetes has become the de facto container orchestrator.</span></span> <span data-ttu-id="669a0-209">Это платформа с открытым кодом, управляемая облачной средой Cloud Foundation (КНКФ).</span><span class="sxs-lookup"><span data-stu-id="669a0-209">It's an open-source platform managed by the Cloud Native Computing Foundation (CNCF).</span></span> <span data-ttu-id="669a0-210">Kubernetes автоматизирует развертывание, масштабирование и эксплуатационные проблемы в контейнерных рабочих нагрузках в кластере компьютеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-210">Kubernetes automates the deployment, scaling, and operational concerns of containerized workloads across a machine cluster.</span></span> <span data-ttu-id="669a0-211">Однако установка Kubernetes и управление ими являются сложными.</span><span class="sxs-lookup"><span data-stu-id="669a0-211">However, installing and managing Kubernetes is notoriously complex.</span></span>

<span data-ttu-id="669a0-212">Гораздо лучшим подходом является использование Kubernetes в качестве управляемой службы от поставщика облачных служб.</span><span class="sxs-lookup"><span data-stu-id="669a0-212">A much better approach is to leverage Kubernetes as a managed service from a cloud vendor.</span></span> <span data-ttu-id="669a0-213">В облаке Azure реализована полностью управляемая платформа Kubernetes с [пакетом Azure Kubernetes Service (AKS)](https://azure.microsoft.com/services/kubernetes-service/).</span><span class="sxs-lookup"><span data-stu-id="669a0-213">The Azure cloud features a fully managed Kubernetes platform entitled [Azure Kubernetes Service (AKS)](https://azure.microsoft.com/services/kubernetes-service/).</span></span> <span data-ttu-id="669a0-214">AKS абстрагирует сложность и эксплуатационные издержки на управление Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-214">AKS abstracts the complexity and operational overhead of managing Kubernetes.</span></span> <span data-ttu-id="669a0-215">Использование Kubernetes в качестве облачной службы; Корпорация Майкрософт несет ответственность за управление и поддержку.</span><span class="sxs-lookup"><span data-stu-id="669a0-215">You consume Kubernetes as a cloud service; Microsoft takes responsibility for managing and supporting it.</span></span> <span data-ttu-id="669a0-216">AKS также тесно интегрируется с другими службами Azure и средствами разработки.</span><span class="sxs-lookup"><span data-stu-id="669a0-216">AKS also tightly integrates with other Azure services and dev tools.</span></span>

<span data-ttu-id="669a0-217">AKS — это технология на основе кластера.</span><span class="sxs-lookup"><span data-stu-id="669a0-217">AKS is a cluster-based technology.</span></span> <span data-ttu-id="669a0-218">Пул федеративных виртуальных машин или узлов развертывается в облаке Azure.</span><span class="sxs-lookup"><span data-stu-id="669a0-218">A pool of federated virtual machines, or nodes, is deployed to the Azure cloud.</span></span> <span data-ttu-id="669a0-219">Вместе они формируют среду высокой доступности или кластер.</span><span class="sxs-lookup"><span data-stu-id="669a0-219">Together they form a highly available environment, or cluster.</span></span> <span data-ttu-id="669a0-220">Кластер выглядит как простая единая сущность для собственного облачного приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-220">The cluster appears as a seamless, single entity to your cloud-native application.</span></span> <span data-ttu-id="669a0-221">В этом случае AKS развертывает контейнерные службы на этих узлах после предопределенной стратегии, которая равномерно распределяет нагрузку.</span><span class="sxs-lookup"><span data-stu-id="669a0-221">Under the hood, AKS deploys your containerized services across these nodes following a predefined strategy that evenly distributes the load.</span></span>

## <a name="what-are-the-scaling-benefits"></a><span data-ttu-id="669a0-222">Каковы преимущества масштабирования?</span><span class="sxs-lookup"><span data-stu-id="669a0-222">What are the scaling benefits?</span></span>

<span data-ttu-id="669a0-223">Службы, созданные на основе контейнеров, могут использовать преимущества масштабирования, предоставляемые средствами оркестрации, такими как Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-223">Services built on containers can leverage scaling benefits provided by orchestration tools like Kubernetes.</span></span> <span data-ttu-id="669a0-224">По проектам контейнеры хорошо осведомлены о себе.</span><span class="sxs-lookup"><span data-stu-id="669a0-224">By design containers only know about themselves.</span></span> <span data-ttu-id="669a0-225">После создания нескольких контейнеров, которые должны работать вместе, следует упорядочить их на более высоком уровне.</span><span class="sxs-lookup"><span data-stu-id="669a0-225">Once you have multiple containers that need to work together, you should organize them at a higher level.</span></span> <span data-ttu-id="669a0-226">Организация большого количества контейнеров и их общих зависимостей, таких как конфигурация сети, заключается в том, где средства оркестрации могут сэкономить день!</span><span class="sxs-lookup"><span data-stu-id="669a0-226">Organizing large numbers of containers and their shared dependencies, such as network configuration, is where orchestration tools come in to save the day!</span></span> <span data-ttu-id="669a0-227">Kubernetes создает слой абстракции для групп контейнеров и организует *их в модули*Pod.</span><span class="sxs-lookup"><span data-stu-id="669a0-227">Kubernetes creates an abstraction layer over groups of containers and organizes them into *pods*.</span></span> <span data-ttu-id="669a0-228">Модули Pod выполняются на рабочих компьютерах, которые называются *узлами*.</span><span class="sxs-lookup"><span data-stu-id="669a0-228">Pods run on worker machines referred to as *nodes*.</span></span> <span data-ttu-id="669a0-229">Эта организованная структура называется *кластером*.</span><span class="sxs-lookup"><span data-stu-id="669a0-229">This organized structure is referred to as a *cluster*.</span></span> <span data-ttu-id="669a0-230">На рис. 3-3 показаны различные компоненты кластера Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-230">Figure 3-3 shows the different components of a Kubernetes cluster.</span></span>

<span data-ttu-id="669a0-231">![Компоненты кластера Kubernetes. ](./media/kubernetes-cluster-components.png)
 **Рис. 3-3**.</span><span class="sxs-lookup"><span data-stu-id="669a0-231">![Kubernetes cluster components.](./media/kubernetes-cluster-components.png)
**Figure 3-3**.</span></span> <span data-ttu-id="669a0-232">Компоненты кластера Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-232">Kubernetes cluster components.</span></span>

<span data-ttu-id="669a0-233">Масштабирование контейнерных рабочих нагрузок является ключевой функцией оркестрации контейнеров.</span><span class="sxs-lookup"><span data-stu-id="669a0-233">Scaling containerized workloads is a key feature of container orchestrators.</span></span> <span data-ttu-id="669a0-234">AKS поддерживает автоматическое масштабирование в двух измерениях: экземпляры контейнеров и расчетные узлы.</span><span class="sxs-lookup"><span data-stu-id="669a0-234">AKS supports automatic scaling across two dimensions: Container instances and compute nodes.</span></span> <span data-ttu-id="669a0-235">Вместе они дают AKS возможность быстро и эффективно реагировать на всплески спроса и добавлять дополнительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="669a0-235">Together they give AKS the ability to quickly and efficiently respond to spikes in demand and add additional resources.</span></span> <span data-ttu-id="669a0-236">Далее в этой главе обсуждается масштабирование в AKS.</span><span class="sxs-lookup"><span data-stu-id="669a0-236">We discuss scaling in AKS later in this chapter.</span></span>

### <a name="declarative-versus-imperative"></a><span data-ttu-id="669a0-237">Декларативная и императивная</span><span class="sxs-lookup"><span data-stu-id="669a0-237">Declarative versus imperative</span></span>

<span data-ttu-id="669a0-238">Kubernetes поддерживает как декларативную, так и императивную конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="669a0-238">Kubernetes supports both declarative and imperative configuration.</span></span> <span data-ttu-id="669a0-239">Императивный подход включает выполнение различных команд, которые сообщают Kubernetes, что делать каждый шаг.</span><span class="sxs-lookup"><span data-stu-id="669a0-239">The imperative approach involves running various commands that tell Kubernetes what to do each step of the way.</span></span> <span data-ttu-id="669a0-240">Запустите этот образ.</span><span class="sxs-lookup"><span data-stu-id="669a0-240">Run this image.</span></span> <span data-ttu-id="669a0-241">Удалите этот модуль.</span><span class="sxs-lookup"><span data-stu-id="669a0-241">Delete this pod.</span></span> <span data-ttu-id="669a0-242">Предоставление этого порта.</span><span class="sxs-lookup"><span data-stu-id="669a0-242">Expose this port.</span></span> <span data-ttu-id="669a0-243">С помощью декларативного подхода вы создаете файл конфигурации, который называется манифестом, чтобы описать, что вам нужно, а не делать.</span><span class="sxs-lookup"><span data-stu-id="669a0-243">With the declarative approach, you create a configuration file, called a manifest, to describe what you want instead of what to do.</span></span> <span data-ttu-id="669a0-244">Kubernetes считывает манифест и преобразует требуемое конечное состояние в фактическое конечное состояние.</span><span class="sxs-lookup"><span data-stu-id="669a0-244">Kubernetes reads the manifest and transforms your desired end state into actual end state.</span></span>

<span data-ttu-id="669a0-245">Императивные команды прекрасно подходят для обучения и интерактивного эксперимента.</span><span class="sxs-lookup"><span data-stu-id="669a0-245">Imperative commands are great for learning and interactive experimentation.</span></span> <span data-ttu-id="669a0-246">Однако необходимо декларативно создать файлы манифеста Kubernetes, чтобы использовать инфраструктуру в качестве подхода к коду, обеспечивая надежность и повторяемые развертывания.</span><span class="sxs-lookup"><span data-stu-id="669a0-246">However, you'll want to declaratively create Kubernetes manifest files to embrace an infrastructure as code approach, providing for reliable and repeatable deployments.</span></span> <span data-ttu-id="669a0-247">Файл манифеста становится артефактом проекта и используется в конвейере CI/CD для автоматизации развертываний Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-247">The manifest file becomes a project artifact and is used in your CI/CD pipeline for automating Kubernetes deployments.</span></span>

<span data-ttu-id="669a0-248">Если вы уже настроили кластер с помощью императивных команд, можно экспортировать декларативный манифест с `kubectl get svc SERVICENAME -o yaml > service.yaml`помощью.</span><span class="sxs-lookup"><span data-stu-id="669a0-248">If you've already configured your cluster using imperative commands, you can export a declarative manifest by using `kubectl get svc SERVICENAME -o yaml > service.yaml`.</span></span> <span data-ttu-id="669a0-249">Эта команда создает манифест, аналогичный показанному ниже.</span><span class="sxs-lookup"><span data-stu-id="669a0-249">This command produces a manifest similar to one shown below:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: "2019-09-13T13:58:47Z"
  labels:
    component: apiserver
    provider: kubernetes
  name: kubernetes
  namespace: default
  resourceVersion: "153"
  selfLink: /api/v1/namespaces/default/services/kubernetes
  uid: 9b1fac62-d62e-11e9-8968-00155d38010d
spec:
  clusterIP: 10.96.0.1
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: 6443
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}
```

<span data-ttu-id="669a0-250">При использовании декларативной конфигурации можно предварительно просмотреть изменения, которые будут сделаны до их фиксации, используя `kubectl diff -f FOLDERNAME` для папки, в которой находятся файлы конфигурации.</span><span class="sxs-lookup"><span data-stu-id="669a0-250">When using declarative configuration, you can preview the changes that will be made before committing them by using `kubectl diff -f FOLDERNAME` against the folder where your configuration files are located.</span></span> <span data-ttu-id="669a0-251">Убедившись, что изменения необходимо применить, выполните команду `kubectl apply -f FOLDERNAME`.</span><span class="sxs-lookup"><span data-stu-id="669a0-251">Once you're sure you want to apply the changes, run `kubectl apply -f FOLDERNAME`.</span></span> <span data-ttu-id="669a0-252">Добавьте `-R` в рекурсивную обработку иерархии папок.</span><span class="sxs-lookup"><span data-stu-id="669a0-252">Add `-R` to recursively process a folder hierarchy.</span></span>

<span data-ttu-id="669a0-253">Также можно использовать декларативную конфигурацию с другими функциями Kubernetes, одной из которых является развертывание.</span><span class="sxs-lookup"><span data-stu-id="669a0-253">You can also use declarative configuration with other Kubernetes features, one of which being deployments.</span></span> <span data-ttu-id="669a0-254">Декларативные развертывания помогают управлять выпусками, обновлениями и масштабированием.</span><span class="sxs-lookup"><span data-stu-id="669a0-254">Declarative deployments help manage releases, updates, and scaling.</span></span> <span data-ttu-id="669a0-255">Они указывают контроллеру развертывания Kubernetes о том, как развертывать новые изменения, масштабировать нагрузку и откатить до предыдущей редакции.</span><span class="sxs-lookup"><span data-stu-id="669a0-255">They instruct the Kubernetes deployment controller on how to deploy new changes, scale out load, or roll back to a previous revision.</span></span> <span data-ttu-id="669a0-256">Если кластер работает нестабильно, декларативное развертывание автоматически вернет кластер в нужное состояние.</span><span class="sxs-lookup"><span data-stu-id="669a0-256">If a cluster is unstable, a declarative deployment will automatically return the cluster back to a desired state.</span></span> <span data-ttu-id="669a0-257">Например, если узел должен аварийно завершить работу, механизм развертывания повторно развертывает замену для достижения требуемого состояния.</span><span class="sxs-lookup"><span data-stu-id="669a0-257">For example, if a node should crash, the deployment mechanism will redeploy a replacement to achieve your desired state</span></span>

<span data-ttu-id="669a0-258">Использование декларативной конфигурации позволяет представить инфраструктуру в виде кода, который можно возвратить и поработать с версиями вместе с кодом приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-258">Using declarative configuration allows infrastructure to be represented as code that can be checked in and versioned alongside the application code.</span></span> <span data-ttu-id="669a0-259">Он обеспечивает улучшенный контроль изменений и улучшенную поддержку непрерывного развертывания с помощью конвейера сборки и развертывания.</span><span class="sxs-lookup"><span data-stu-id="669a0-259">It provides improved change control and better support for continuous deployment using a build and deploy pipeline.</span></span>

## <a name="what-scenarios-are-ideal-for-containers-and-orchestrators"></a><span data-ttu-id="669a0-260">Какие сценарии идеально подходят для контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="669a0-260">What scenarios are ideal for containers and orchestrators?</span></span>

<span data-ttu-id="669a0-261">Следующие сценарии идеально подходят для использования контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="669a0-261">The following scenarios are ideal for using containers and orchestrators.</span></span>

### <a name="applications-requiring-high-uptime-and-scalability"></a><span data-ttu-id="669a0-262">Приложения, которым требуются высокая отказоустойчивость и масштабируемость</span><span class="sxs-lookup"><span data-stu-id="669a0-262">Applications requiring high uptime and scalability</span></span>

<span data-ttu-id="669a0-263">Отдельные приложения с высокой степенью бесперебойной работы и требованиями к масштабируемости являются идеальным кандидатом для собственных облачных архитектур, использующих микрослужбы, контейнеры и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="669a0-263">Individual applications that have high uptime and scalability requirements are ideal candidates for cloud-native architectures using microservices, containers, and orchestrators.</span></span> <span data-ttu-id="669a0-264">Их можно разрабатывать в контейнерах, тестировать в средах с управлением версиями и развертывать в рабочей среде с нулевым временем простоя.</span><span class="sxs-lookup"><span data-stu-id="669a0-264">They can be developed in containers, tested across versioned environments, and deployed into production with zero downtime.</span></span> <span data-ttu-id="669a0-265">Использование кластеров Kubernetes гарантирует, что такие приложения также могут масштабироваться по запросу и автоматически восстанавливаться при сбоях узлов.</span><span class="sxs-lookup"><span data-stu-id="669a0-265">The use of Kubernetes clusters ensures such apps can also scale on demand and recover automatically from node failures.</span></span>

### <a name="large-numbers-of-applications"></a><span data-ttu-id="669a0-266">Большое число приложений</span><span class="sxs-lookup"><span data-stu-id="669a0-266">Large numbers of applications</span></span>

<span data-ttu-id="669a0-267">Организации, которые развертывают и обслуживают большое количество приложений, получают преимущество от контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="669a0-267">Organizations that deploy and maintain large numbers of applications benefit from containers and orchestrators.</span></span> <span data-ttu-id="669a0-268">Настройка контейнерных сред и кластеров Kubernetes в первую очередь является фиксированной ценой.</span><span class="sxs-lookup"><span data-stu-id="669a0-268">The up front effort of setting up containerized environments and Kubernetes clusters is primarily a fixed cost.</span></span> <span data-ttu-id="669a0-269">Для развертывания, обслуживания и обновления отдельных приложений стоимость зависит от количества приложений.</span><span class="sxs-lookup"><span data-stu-id="669a0-269">Deploying, maintaining, and updating individual applications has a cost that varies with the number of applications.</span></span> <span data-ttu-id="669a0-270">Помимо небольшого числа приложений сложность обслуживания пользовательских приложений вручную превышает затраты на реализацию решения с помощью контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="669a0-270">Beyond a small number of applications, the complexity of maintaining custom applications manually exceeds the cost of implementing a solution using containers and orchestrators.</span></span>

## <a name="when-should-you-avoid-using-containers-and-orchestrators"></a><span data-ttu-id="669a0-271">Когда следует избегать использования контейнеров и оркестрации?</span><span class="sxs-lookup"><span data-stu-id="669a0-271">When should you avoid using containers and orchestrators?</span></span>

<span data-ttu-id="669a0-272">Если вы не можете создать приложение, следуя принципам применения двенадцати факторов, следует рассмотреть возможность исключения контейнеров и оркестрации.</span><span class="sxs-lookup"><span data-stu-id="669a0-272">If you're unable to build your application following the Twelve-Factor App principles, you should consider avoiding containers and orchestrators.</span></span> <span data-ttu-id="669a0-273">В таких случаях рассмотрим платформу размещения на основе виртуальных машин или, возможно, некоторую гибридную систему.</span><span class="sxs-lookup"><span data-stu-id="669a0-273">In these cases, consider a VM-based hosting platform, or possibly some hybrid system.</span></span> <span data-ttu-id="669a0-274">С его помощью можно всегда отключать определенные части функциональности в отдельные контейнеры или даже бессерверные функции.</span><span class="sxs-lookup"><span data-stu-id="669a0-274">With it, you can always spin off certain pieces of functionality into separate containers or even serverless functions.</span></span>

## <a name="development-resources"></a><span data-ttu-id="669a0-275">Ресурсы по разработке</span><span class="sxs-lookup"><span data-stu-id="669a0-275">Development resources</span></span>

<span data-ttu-id="669a0-276">В этом разделе приведен краткий список ресурсов по разработке, которые могут помочь приступить к использованию контейнеров и оркестрации для следующего приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-276">This section shows a short list of development resources that may help you get started using containers and orchestrators for your next application.</span></span> <span data-ttu-id="669a0-277">Если вы ищете рекомендации по проектированию собственного облачного приложения архитектуры микрослужб, ознакомьтесь с руководством по работе с этой книгой, [микрослужбами .NET: архитектурой для контейнерных приложений .NET](https://dotnet.microsoft.com/download/thank-you/microservices-architecture-ebook).</span><span class="sxs-lookup"><span data-stu-id="669a0-277">If you're looking for guidance on how to design your cloud-native microservices architecture app, read this book's companion, [.NET Microservices: Architecture for Containerized .NET Applications](https://dotnet.microsoft.com/download/thank-you/microservices-architecture-ebook).</span></span>

### <a name="local-kubernetes-development"></a><span data-ttu-id="669a0-278">Локальная разработка Kubernetes</span><span class="sxs-lookup"><span data-stu-id="669a0-278">Local Kubernetes Development</span></span>

<span data-ttu-id="669a0-279">Развертывания Kubernetes обеспечивают отличное значение в рабочих средах, но также могут выполняться локально на компьютере разработки.</span><span class="sxs-lookup"><span data-stu-id="669a0-279">Kubernetes deployments provide great value in production environments, but can also run locally on your development machine.</span></span> <span data-ttu-id="669a0-280">Хотя вы можете работать с отдельными микрослужбами независимо, иногда приходится запускать всю систему локально — так же, как она будет выполняться при развертывании в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="669a0-280">While you may work on individual microservices independently, there may be times when you'll need to run the entire system locally - just as it will run when deployed to production.</span></span> <span data-ttu-id="669a0-281">Существует несколько средств, которые могут помочь: Minikube и DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="669a0-281">There are several tools that can help: Minikube and Docker Desktop.</span></span> <span data-ttu-id="669a0-282">Visual Studio также предоставляет средства для разработки DOCKER.</span><span class="sxs-lookup"><span data-stu-id="669a0-282">Visual Studio also provides tooling for Docker development.</span></span>

### <a name="minikube"></a><span data-ttu-id="669a0-283">Minikube</span><span class="sxs-lookup"><span data-stu-id="669a0-283">Minikube</span></span>

<span data-ttu-id="669a0-284">Что такое Minikube?</span><span class="sxs-lookup"><span data-stu-id="669a0-284">What is Minikube?</span></span> <span data-ttu-id="669a0-285">Проект Minikube говорит «Minikube реализует локальный кластер Kubernetes в macOS, Linux и Windows».</span><span class="sxs-lookup"><span data-stu-id="669a0-285">The Minikube project says "Minikube implements a local Kubernetes cluster on macOS, Linux, and Windows."</span></span> <span data-ttu-id="669a0-286">Ее основными целями являются «лучший инструмент для разработки локальных Kubernetes приложений и поддержка всех функций Kubernetes».</span><span class="sxs-lookup"><span data-stu-id="669a0-286">Its primary goals are "to be the best tool for local Kubernetes application development and to support all Kubernetes features that fit."</span></span> <span data-ttu-id="669a0-287">Установка Minikube отделена от DOCKER, но Minikube поддерживает различные низкоуровневые оболочки, чем поддерживает DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="669a0-287">Installing Minikube is separate from Docker, but Minikube supports different hypervisors than Docker Desktop supports.</span></span> <span data-ttu-id="669a0-288">В настоящее время Minikube поддерживает следующие функции Kubernetes:</span><span class="sxs-lookup"><span data-stu-id="669a0-288">The following Kubernetes features are currently supported by Minikube:</span></span>

- <span data-ttu-id="669a0-289">DNS</span><span class="sxs-lookup"><span data-stu-id="669a0-289">DNS</span></span>
- <span data-ttu-id="669a0-290">нодепортс</span><span class="sxs-lookup"><span data-stu-id="669a0-290">NodePorts</span></span>
- <span data-ttu-id="669a0-291">Конфигмапс и секреты</span><span class="sxs-lookup"><span data-stu-id="669a0-291">ConfigMaps and secrets</span></span>
- <span data-ttu-id="669a0-292">Панели мониторинга</span><span class="sxs-lookup"><span data-stu-id="669a0-292">Dashboards</span></span>
- <span data-ttu-id="669a0-293">Среды выполнения контейнеров: DOCKER, RKT, CRI-O и контейнеры</span><span class="sxs-lookup"><span data-stu-id="669a0-293">Container runtimes: Docker, rkt, CRI-O, and containerd</span></span>
- <span data-ttu-id="669a0-294">Включение сетевого интерфейса контейнера (CNI)</span><span class="sxs-lookup"><span data-stu-id="669a0-294">Enabling Container Network Interface (CNI)</span></span>
- <span data-ttu-id="669a0-295">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="669a0-295">Ingress</span></span>

<span data-ttu-id="669a0-296">После установки Minikube можно быстро приступить к `minikube start` работе, выполнив команду, которая скачивает образ и запускает локальный кластер Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-296">After installing Minikube, you can quickly start using it by running the `minikube start` command, which downloads an image and start the local Kubernetes cluster.</span></span> <span data-ttu-id="669a0-297">После запуска кластера вы взаимодействуете с ним с помощью стандартных команд Kubernetes `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="669a0-297">Once the cluster is started, you interact with it using the standard Kubernetes `kubectl` commands.</span></span>

### <a name="docker-desktop"></a><span data-ttu-id="669a0-298">Docker Desktop</span><span class="sxs-lookup"><span data-stu-id="669a0-298">Docker Desktop</span></span>

<span data-ttu-id="669a0-299">Вы также можете работать с Kubernetes непосредственно из DOCKER Desktop в Windows.</span><span class="sxs-lookup"><span data-stu-id="669a0-299">You can also work with Kubernetes directly from Docker Desktop on Windows.</span></span> <span data-ttu-id="669a0-300">Это единственный вариант, если вы используете контейнеры Windows, а также отличный выбор для контейнеров, отличных от Windows.</span><span class="sxs-lookup"><span data-stu-id="669a0-300">It is your only option if you're using Windows Containers, and is a great choice for non-Windows containers as well.</span></span> <span data-ttu-id="669a0-301">На рис. 3-4 показано, как включить поддержку локальных Kubernetes при работе с DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="669a0-301">Figure 3-4 shows how to enable local Kubernetes support when running Docker Desktop.</span></span>

![Настройка Kubernetes в DOCKER Desktop](./media/docker-desktop-kubernetes.png)

<span data-ttu-id="669a0-303">**Рис. 3-4**.</span><span class="sxs-lookup"><span data-stu-id="669a0-303">**Figure 3-4**.</span></span> <span data-ttu-id="669a0-304">Настройка Kubernetes в DOCKER Desktop.</span><span class="sxs-lookup"><span data-stu-id="669a0-304">Configuring Kubernetes in Docker Desktop.</span></span>

<span data-ttu-id="669a0-305">DOCKER Desktop — это наиболее популярное средство для локальной настройки и запуска контейнерных приложений.</span><span class="sxs-lookup"><span data-stu-id="669a0-305">Docker Desktop is the most popular tool for configuring and running containerized apps locally.</span></span> <span data-ttu-id="669a0-306">При работе с DOCKER Desktop можно разрабатывать локально на основе того же набора образов контейнеров DOCKER, который будет развернут в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="669a0-306">When you work with Docker Desktop, you can develop locally against the exact same set of Docker container images that you'll deploy to production.</span></span> <span data-ttu-id="669a0-307">Приложение DOCKER Desktop предназначено для локального создания, тестирования и поставки контейнерных приложений.</span><span class="sxs-lookup"><span data-stu-id="669a0-307">Docker Desktop is designed to "build, test, and ship" containerized apps locally.</span></span> <span data-ttu-id="669a0-308">Он поддерживает контейнеры Linux и Windows.</span><span class="sxs-lookup"><span data-stu-id="669a0-308">It supports both Linux and Windows containers.</span></span> <span data-ttu-id="669a0-309">После отправки образов в реестр образов, например реестр контейнеров Azure или DOCKER Hub, AKS может извлечь и развернуть их в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="669a0-309">Once you push your images to an image registry, like Azure Container Registry or Docker Hub, AKS can pull and deploy them to production.</span></span>

### <a name="visual-studio-docker-tooling"></a><span data-ttu-id="669a0-310">Инструментарий DOCKER в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="669a0-310">Visual Studio Docker Tooling</span></span>

<span data-ttu-id="669a0-311">Visual Studio поддерживает разработку с помощью DOCKER для веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="669a0-311">Visual Studio supports Docker development for web-based applications.</span></span> <span data-ttu-id="669a0-312">При создании нового ASP.NET Core приложения вы можете настроить его с помощью поддержки DOCKER, как показано на рис. 3-5.</span><span class="sxs-lookup"><span data-stu-id="669a0-312">When you create a new ASP.NET Core application, you have an option to configure it with Docker support, as shown in Figure 3-5.</span></span>

![Visual Studio включить поддержку DOCKER](./media/visual-studio-enable-docker-support.png)

<span data-ttu-id="669a0-314">**Рис. 3-5**.</span><span class="sxs-lookup"><span data-stu-id="669a0-314">**Figure 3-5**.</span></span> <span data-ttu-id="669a0-315">Visual Studio включить поддержку DOCKER</span><span class="sxs-lookup"><span data-stu-id="669a0-315">Visual Studio Enable Docker Support</span></span>

<span data-ttu-id="669a0-316">Если выбран этот параметр, проект создается с помощью `Dockerfile` в корневом каталоге, который можно использовать для сборки и размещения приложения в контейнере DOCKER.</span><span class="sxs-lookup"><span data-stu-id="669a0-316">When this option is selected, the project is created with a `Dockerfile` in its root, which can be used to build and host the app in a Docker container.</span></span> <span data-ttu-id="669a0-317">Пример Dockerfile показан на рис. 3 -6. git</span><span class="sxs-lookup"><span data-stu-id="669a0-317">An example Dockerfile is shown in Figure 3-6.git</span></span>

```docker
FROM mcr.microsoft.com/dotnet/core/aspnet:3.0-stretch-slim AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/core/sdk:3.0-stretch AS build
WORKDIR /src
COPY ["WebApplication3/WebApplication3.csproj", "WebApplication3/"]
RUN dotnet restore "WebApplication3/WebApplication3.csproj"
COPY . .
WORKDIR "/src/WebApplication3"
RUN dotnet build "WebApplication3.csproj" -c Release -o /app

FROM build AS publish
RUN dotnet publish "WebApplication3.csproj" -c Release -o /app

FROM base AS final
WORKDIR /app
COPY --from=publish /app .
ENTRYPOINT ["dotnet", "WebApplication3.dll"]
```

<span data-ttu-id="669a0-318">**Рис. 3-6**.</span><span class="sxs-lookup"><span data-stu-id="669a0-318">**Figure 3-6**.</span></span> <span data-ttu-id="669a0-319">Visual Studio Generated Dockerfile</span><span class="sxs-lookup"><span data-stu-id="669a0-319">Visual Studio generated Dockerfile</span></span>

<span data-ttu-id="669a0-320">Поведение по умолчанию при запуске приложения настроено на использование DOCKER.</span><span class="sxs-lookup"><span data-stu-id="669a0-320">The default behavior when the app runs is configured to use Docker as well.</span></span> <span data-ttu-id="669a0-321">На рис. 3-7 показаны различные параметры запуска, доступные в новом проекте ASP.NET Core, созданном с помощью добавленной поддержки DOCKER.</span><span class="sxs-lookup"><span data-stu-id="669a0-321">Figure 3-7 shows the different run options available from a new ASP.NET Core project created with Docker support added.</span></span>

![Параметры запуска для Visual Studio DOCKER](./media/visual-studio-docker-run-options.png)

<span data-ttu-id="669a0-323">**Рис. 3-7**.</span><span class="sxs-lookup"><span data-stu-id="669a0-323">**Figure 3-7**.</span></span> <span data-ttu-id="669a0-324">Параметры запуска для Visual Studio DOCKER</span><span class="sxs-lookup"><span data-stu-id="669a0-324">Visual Studio Docker Run Options</span></span>

<span data-ttu-id="669a0-325">Помимо локальной разработки [Azure dev Spaces](https://docs.microsoft.com/azure/dev-spaces/) предоставляет несколько разработчикам удобный способ работы с собственными конфигурациями Kubernetes в Azure.</span><span class="sxs-lookup"><span data-stu-id="669a0-325">In addition to local development, [Azure Dev Spaces](https://docs.microsoft.com/azure/dev-spaces/) provides a convenient way for multiple developers to work with their own Kubernetes configurations within Azure.</span></span> <span data-ttu-id="669a0-326">Как видно на рисунке 3-7, приложение можно также запустить в Azure Dev Spaces.</span><span class="sxs-lookup"><span data-stu-id="669a0-326">As you can see in Figure 3-7, you can also run the application in Azure Dev Spaces.</span></span>

<span data-ttu-id="669a0-327">Кроме того, в любое время можно добавить поддержку DOCKER в существующее приложение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="669a0-327">Also, at any time you can add Docker support to an existing ASP.NET Core application.</span></span> <span data-ttu-id="669a0-328">В Обозреватель решений Visual Studio щелкните правой кнопкой мыши проект и **добавьте** > **поддержку DOCKER**, как показано на рис. 3-8.</span><span class="sxs-lookup"><span data-stu-id="669a0-328">From the Visual Studio Solution Explorer, right click on the project and **Add** > **Docker Support**, as shown in Figure 3-8.</span></span>

<span data-ttu-id="669a0-329">**Рис. 3-8**.</span><span class="sxs-lookup"><span data-stu-id="669a0-329">**Figure 3-8**.</span></span> <span data-ttu-id="669a0-330">Добавление поддержки DOCKER в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="669a0-330">Adding Docker support to Visual Studio</span></span>

<span data-ttu-id="669a0-331">Также можно добавить поддержку оркестрации контейнера, также показанную на рисунке 3-8.</span><span class="sxs-lookup"><span data-stu-id="669a0-331">You can also add Container Orchestration Support, also shown in Figure 3-8.</span></span> <span data-ttu-id="669a0-332">По умолчанию Orchestrator использует Kubernetes и Helm.</span><span class="sxs-lookup"><span data-stu-id="669a0-332">By default, the orchestrator uses Kubernetes and Helm.</span></span> <span data-ttu-id="669a0-333">После выбора Orchestrator в корневой каталог проекта `azds.yaml` добавляется файл, и добавляется `charts` папка, содержащая диаграммы Helm, используемые для настройки и развертывания приложения в Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-333">Once you've chosen the orchestrator, a `azds.yaml` file is added to the project root and a `charts` folder is added containing the Helm charts used to configure and deploy the application to Kubernetes.</span></span> <span data-ttu-id="669a0-334">На рис. 3-9 показаны итоговые файлы в новом проекте.</span><span class="sxs-lookup"><span data-stu-id="669a0-334">Figure 3-9 shows the resulting files in a new project.</span></span>

<span data-ttu-id="669a0-335">Также можно добавить поддержку оркестрации контейнера, также показанную на рисунке 3-8.</span><span class="sxs-lookup"><span data-stu-id="669a0-335">You can also add Container Orchestration Support, also shown in Figure 3-8.</span></span> <span data-ttu-id="669a0-336">По умолчанию Orchestrator использует Kubernetes и Helm.</span><span class="sxs-lookup"><span data-stu-id="669a0-336">By default, the orchestrator uses Kubernetes and Helm.</span></span> <span data-ttu-id="669a0-337">После выбора Orchestrator в корневой каталог проекта `azds.yaml` добавляется файл, и добавляется `charts` папка, содержащая диаграммы Helm, используемые для настройки и развертывания приложения в Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="669a0-337">Once you've chosen the orchestrator, a `azds.yaml` file is added to the project root and a `charts` folder is added containing the Helm charts used to configure and deploy the application to Kubernetes.</span></span> <span data-ttu-id="669a0-338">На рис. 3-9 показаны итоговые файлы в новом проекте.</span><span class="sxs-lookup"><span data-stu-id="669a0-338">Figure 3-9 shows the resulting files in a new project.</span></span>

<span data-ttu-id="669a0-339">**Рис. 3-9**.</span><span class="sxs-lookup"><span data-stu-id="669a0-339">**Figure 3-9**.</span></span> <span data-ttu-id="669a0-340">Добавление поддержки оркестрации в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="669a0-340">Adding orchestration support to Visual Studio</span></span>

### <a name="visual-studio-code-docker-tooling"></a><span data-ttu-id="669a0-341">Visual Studio Code средства DOCKER</span><span class="sxs-lookup"><span data-stu-id="669a0-341">Visual Studio Code Docker Tooling</span></span>

<span data-ttu-id="669a0-342">Для Visual Studio Code, поддерживающих разработку DOCKER, доступно несколько расширений.</span><span class="sxs-lookup"><span data-stu-id="669a0-342">There are a number of extensions available for Visual Studio Code that support Docker development.</span></span>

<span data-ttu-id="669a0-343">Microsoft предоставляет [DOCKER для расширения Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker).</span><span class="sxs-lookup"><span data-stu-id="669a0-343">Microsoft provides the [Docker for Visual Studio Code extension](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker).</span></span> <span data-ttu-id="669a0-344">Это расширение упрощает процесс добавления поддержки контейнеров в приложения.</span><span class="sxs-lookup"><span data-stu-id="669a0-344">This extension simplifies the process of adding container support to applications.</span></span> <span data-ttu-id="669a0-345">Он формирует шаблоны для необходимых файлов, создает образы DOCKER и позволяет выполнять отладку приложения в контейнере.</span><span class="sxs-lookup"><span data-stu-id="669a0-345">It scaffolds required files, builds Docker images, and enables you to debug your app inside a container.</span></span> <span data-ttu-id="669a0-346">Расширение включает в себя визуальный обозреватель, который упрощает выполнение действий с контейнерами и изображениями, такими как запуск, завершение, проверка, удаление и многое другое.</span><span class="sxs-lookup"><span data-stu-id="669a0-346">The extension features a visual explorer that makes it easy to take actions on containers and images such as start, stop, inspect, remove, and more.</span></span> <span data-ttu-id="669a0-347">Расширение также поддерживает Docker Compose, что позволяет управлять несколькими работающими контейнерами как одним блоком.</span><span class="sxs-lookup"><span data-stu-id="669a0-347">The extension also supports Docker Compose enabling you to manage multiple running containers as a single unit.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="669a0-348">[Назад](scale-applications.md)
>[Вперед](leverage-serverless-functions.md)</span><span class="sxs-lookup"><span data-stu-id="669a0-348">[Previous](scale-applications.md)
[Next](leverage-serverless-functions.md)</span></span>
