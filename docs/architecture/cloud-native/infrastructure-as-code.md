---
title: Инфраструктура как код
description: Создание архитектуры облачных приложений .NET для Azure | Инфраструктура как код
ms.date: 06/30/2019
ms.openlocfilehash: 3957da68ac28774f899f49fb181a29c2435902f8
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73841783"
---
# <a name="infrastructure-as-code"></a>Инфраструктура как код

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

Облачные приложения обычно используют все виды компонентов PaaS (платформа как услуга). На облачной платформе, такой как Azure, эти компоненты могут включать такие функции, как хранилище, служебная шина и служба SignalR. По мере того, как приложения становятся более сложными, количество используемых этих служб, вероятно, будет расти. Так же, как непрерывная доставка изменяла традиционную модель развертывания в среде вручную, быстрый темп изменений также нарушал модель централизованной ИТ-группы для управления средами.

Среда разработки может также быть автоматизирована. Существует широкий спектр хорошо продуманных средств, которые могут упростить процесс.

## <a name="azure-resource-manager-templates"></a>Шаблоны Azure Resource Manager

Шаблоны Azure Resource Manager — это язык на основе JSON для определения различных ресурсов в Azure. Основная схема выглядит примерно так, как показано на рис. 11-10.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "",
  "apiProfile": "",
  "parameters": {  },
  "variables": {  },
  "functions": [  ],
  "resources": [  ],
  "outputs": {  }
}
```

**Рис. 11-10** . схема для шаблона диспетчер ресурсов

В этом шаблоне можно определить контейнер хранилища в разделе ресурсов следующим образом:

```json
"resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "name": "[variables('storageAccountName')]",
      "location": "[parameters('location')]",
      "apiVersion": "2018-07-01",
      "sku": {
        "name": "[parameters('storageAccountType')]"
      },
      "kind": "StorageV2",
      "properties": {}
    }
  ],
```

**Рис. 11-11** . пример учетной записи хранения, определенной в шаблоне диспетчер ресурсов

Шаблоны можно параметризованными, чтобы один шаблон можно было использовать повторно с разными параметрами для определения разработки, контроля качества и рабочей среды. Это помогает избежать непредвиденных сюрпризов при переходе на более высокую среду, которая настроена иначе, чем в более низких средах. Ресурсы, определенные в шаблоне, обычно создаются в одной группе ресурсов в Azure (можно определить несколько групп ресурсов в одном шаблоне диспетчер ресурсов, но нередко). Это позволяет легко удалить среду, просто удалив группу ресурсов в целом. Анализ затрат также может выполняться на уровне группы ресурсов, что позволяет быстро учитывать объем данных каждой среды.

Существует множество примеров шаблонов, определенных в проекте [шаблонов](https://github.com/Azure/azure-quickstart-templates) быстрого запуска Azure на сайте GitHub, которые будут подниматься при запуске нового шаблона или добавлении к существующему.

Шаблоны диспетчер ресурсов могут выполняться различными способами. Возможно, самый простой способ — просто вставить их в портал Azure. Для экспериментальных развертываний этот метод может быть очень быстрым. Они также могут выполняться как часть процесса сборки или выпуска в Azure DevOps. Существуют задачи, которые будут использовать подключения к Azure для запуска шаблонов. Изменения шаблонов диспетчер ресурсов применяются постепенно, то есть для добавления нового ресурса необходимо просто добавить его в шаблон. Инструментарий будет выполнять сравнение текущей группы ресурсов с требуемой группой ресурсов, определенной в шаблоне. Ресурсы будут созданы или изменены так, чтобы они совпадали с тем, что определено в шаблоне.  

## <a name="terraform"></a>Terraform

Неудобство использования шаблонов диспетчер ресурсов заключается в том, что они относятся только к облаку Azure. Создавать приложения, которые включают ресурсы из нескольких облаков, нередко, но в тех случаях, когда предприятие полагается на впечатляющая, стоимость поддержки нескольких облаков может быть целесообразной. Если существует один язык шаблонов, который можно использовать в каждом облаке, он также позволит повысить уровень переносимости навыков разработки.

Существует несколько технологий, которые делают именно это! Наиболее зрелое предложение в этой области называется [terraform](https://www.terraform.io/). Terraform поддерживает все крупные облачные проигрыватели, такие как Azure, Google Cloud Platform, AWS и Аликлауд, а также десятки дополнительных игроков, таких как Heroku и Дигиталоцеан. Вместо использования JSON в качестве языка определения шаблона он использует немного более сжатый YAML.

Пример файла terraform, который делает то же, что и предыдущий шаблон диспетчер ресурсов (рис. 11-11), показан на рис. 11-12:

```terraform
provider "azurerm" {
  version = "=1.28.0"
}

resource "azurerm_resource_group" "test" {
  name     = "production"
  location = "West US"
}

resource "azurerm_storage_account" "testsa" {
  name                     = "${var.storageAccountName}"
  resource_group_name      = "${azurerm_resource_group.testrg.name}"
  location                 = "${var.region}"
  account_tier             = "${var.tier}"
  account_replication_type = "${var.replicationType}"

}
```

**Рис. 11-12** . пример шаблона диспетчер ресурсов

Terraform позволяет лучше предоставлять разумные сообщения об ошибках, когда ресурс не может быть развернут из-за ошибки в шаблоне. Это область, где диспетчер ресурсов шаблоны имеют некоторые текущие проблемы. Также есть очень удобная задача проверки, которую можно использовать на этапе сборки для перехвата ошибок шаблона на раннем этапе.

Как и в случае с шаблонами диспетчер ресурсов, для развертывания шаблонов terraform можно использовать программы командной строки. Кроме того, в Azure Pipelines есть задачи, созданные сообществом, которые могут проверять и применять шаблоны terraform.

В случае, если шаблон terraform или диспетчер ресурсов выводит интересные значения, такие как строка подключения к вновь созданной базе данных, они могут быть захвачены в конвейере сборки и использованы в последующих задачах.

>[!div class="step-by-step"]
>[Назад](devops.md)
>[Вперед](application-bundles.md)
