---
title: Взаимодействие между службами
description: Узнайте, как встроенные микрослужбы облака взаимодействуют с другими внутренними микрослужбами.
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: 9761b99cd9ad076eb82a23a00ec3099e8913168b
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91166083"
---
# <a name="service-to-service-communication"></a><span data-ttu-id="9e9ab-103">Взаимодействие между службами</span><span class="sxs-lookup"><span data-stu-id="9e9ab-103">Service-to-service communication</span></span>

<span data-ttu-id="9e9ab-104">Перемещаясь с клиентского клиента, мы теперь подключаемся к внутренним микрослужбам.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-104">Moving from the front-end client, we now address back-end microservices communicate with each other.</span></span>

<span data-ttu-id="9e9ab-105">При создании собственного облачного приложения необходимо учитывать, как серверные службы взаимодействуют друг с другом.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-105">When constructing a cloud-native application, you'll want to be sensitive to how back-end services communicate with each other.</span></span> <span data-ttu-id="9e9ab-106">В идеале, чем меньше взаимодействие между службами, тем лучше.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-106">Ideally, the less inter-service communication, the better.</span></span> <span data-ttu-id="9e9ab-107">Тем не менее, не всегда возможно, что серверные службы часто зависят друг от друга, чтобы выполнить операцию.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-107">However, avoidance isn't always possible as back-end services often rely on one another to complete an operation.</span></span>

<span data-ttu-id="9e9ab-108">Существует несколько широко принятых подходов к реализации взаимодействия между службами.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-108">There are several widely accepted approaches to implementing cross-service communication.</span></span> <span data-ttu-id="9e9ab-109">*Тип взаимодействия* взаимодействия часто определяет наилучший подход.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-109">The *type of communication interaction* will often determine the best approach.</span></span>

<span data-ttu-id="9e9ab-110">Рассмотрим следующие типы взаимодействия:</span><span class="sxs-lookup"><span data-stu-id="9e9ab-110">Consider the following interaction types:</span></span>

- <span data-ttu-id="9e9ab-111">*Запрос* . когда вызывающей микрослужбе требуется ответ от вызываемой микрослужбы, например "Эй, дайте мне сведения о покупателе для данного идентификатора клиента".</span><span class="sxs-lookup"><span data-stu-id="9e9ab-111">*Query* – when a calling microservice requires a response from a called microservice, such as, "Hey, give me the buyer information for a given customer Id."</span></span>

- <span data-ttu-id="9e9ab-112">*Команда* — когда вызывающей микрослужбе требуется другая микрослужба для выполнения действия, но не требуется ответ, например «Эй, просто поставьте этот заказ».</span><span class="sxs-lookup"><span data-stu-id="9e9ab-112">*Command* – when the calling microservice needs another microservice to execute an action but doesn't require a response, such as, "Hey, just ship this order."</span></span>

- <span data-ttu-id="9e9ab-113">*Событие* — когда микрослужба, называемая издателем, вызывает событие, которое изменилось или произошло действие.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-113">*Event* – when a microservice, called the publisher, raises an event that state has changed or an action has occurred.</span></span> <span data-ttu-id="9e9ab-114">Другие микрослужбы, называемые подписчиками, могут реагировать на событие соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-114">Other microservices, called subscribers, who are interested, can react to the event appropriately.</span></span> <span data-ttu-id="9e9ab-115">Издатель и подписчики не знают друг о друга.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-115">The publisher and the subscribers aren't aware of each other.</span></span>

<span data-ttu-id="9e9ab-116">Системы микрослужб обычно используют сочетание этих типов взаимодействия при выполнении операций, требующих взаимодействия между службами.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-116">Microservice systems typically use a combination of these interaction types when executing operations that require cross-service interaction.</span></span> <span data-ttu-id="9e9ab-117">Давайте подробно рассмотрим каждую из них и то, как их можно реализовать.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-117">Let's take a close look at each and how you might implement them.</span></span>

## <a name="queries"></a><span data-ttu-id="9e9ab-118">Запросы</span><span class="sxs-lookup"><span data-stu-id="9e9ab-118">Queries</span></span>

<span data-ttu-id="9e9ab-119">Во многих случаях одной микрослужбе может потребоваться выполнить *запрос* к другой, что требует немедленного реагирования на выполнение операции.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-119">Many times, one microservice might need to *query* another, requiring an immediate response to complete an operation.</span></span> <span data-ttu-id="9e9ab-120">Микрослужбе корзины покупок может потребоваться информация о продукте и цена для добавления товара в корзину.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-120">A shopping basket microservice may need product information and a price to add an item to its basket.</span></span> <span data-ttu-id="9e9ab-121">Существует ряд подходов к реализации операций запросов.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-121">There are a number of approaches for implementing query operations.</span></span>

### <a name="requestresponse-messaging"></a><span data-ttu-id="9e9ab-122">Обмен сообщениями с запросами и ответами</span><span class="sxs-lookup"><span data-stu-id="9e9ab-122">Request/Response Messaging</span></span>

<span data-ttu-id="9e9ab-123">Одним из вариантов реализации этого сценария является вызов микрослужбы на внутреннем сервере для выполнения прямых HTTP-запросов к микрослужбам, которые необходимо запросить, как показано на рис. 4-8.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-123">One option for implementing this scenario is for the calling back-end microservice to make direct HTTP requests to the microservices it needs to query, shown in Figure 4-8.</span></span>

![Прямой обмен данными по протоколу HTTP](./media/direct-http-communication.png)

<span data-ttu-id="9e9ab-125">**Рис. 4-8**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-125">**Figure 4-8**.</span></span> <span data-ttu-id="9e9ab-126">Прямой обмен данными по протоколу HTTP</span><span class="sxs-lookup"><span data-stu-id="9e9ab-126">Direct HTTP communication</span></span>

<span data-ttu-id="9e9ab-127">Хотя прямые вызовы HTTP между микрослужбами относительно просты для реализации, следует соблюдать осторожность, чтобы не усложнять эту методику.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-127">While direct HTTP calls between microservices are relatively simple to implement, care should be taken to minimize this practice.</span></span> <span data-ttu-id="9e9ab-128">Для начала эти вызовы всегда *синхронны* и будут блокировать операцию до тех пор, пока не будет возвращен результат или не истечет время ожидания запроса.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-128">To start, these calls are always *synchronous* and will block the operation until a result is returned or the request times outs.</span></span> <span data-ttu-id="9e9ab-129">Что делать, когда автономные, независимые службы, могут развиваться независимо друг от друга и развертывать их часто, теперь становятся взаимосвязанными друг с другом.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-129">What were once self-contained, independent services, able to evolve independently and deploy frequently, now become coupled to each other.</span></span> <span data-ttu-id="9e9ab-130">При увеличении взаимосвязей между микрослужбами их архитектурные преимущества уменьшаются.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-130">As coupling among microservices increase, their architectural benefits diminish.</span></span>

<span data-ttu-id="9e9ab-131">Асинхронный запрос, выполняющий один прямой вызов HTTP к другой микрослужбе, может быть приемлемым для некоторых систем.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-131">Executing an infrequent request that makes a single direct HTTP call to another microservice might be acceptable for some systems.</span></span> <span data-ttu-id="9e9ab-132">Однако не рекомендуется делать вызовы с большими объемами, которые вызывают прямые вызовы HTTP к нескольким микрослужбам.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-132">However, high-volume calls that invoke direct HTTP calls to multiple microservices aren't advisable.</span></span> <span data-ttu-id="9e9ab-133">Они могут увеличить задержку и негативно сказаться на производительности, масштабируемости и доступности системы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-133">They can increase latency and negatively impact the performance, scalability, and availability of your system.</span></span> <span data-ttu-id="9e9ab-134">Еще хуже, длинная последовательность прямого обмена данными по протоколу HTTP может привести к серьезным и сложным цепочкам синхронных вызовов микрослужб, показанных на рисунке 4-9:</span><span class="sxs-lookup"><span data-stu-id="9e9ab-134">Even worse, a long series of direct HTTP communication can lead to deep and complex chains of synchronous microservices calls, shown in Figure 4-9:</span></span>

![Сцепление HTTP-запросов](./media/chaining-http-queries.png)

<span data-ttu-id="9e9ab-136">**Рис. 4-9**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-136">**Figure 4-9**.</span></span> <span data-ttu-id="9e9ab-137">Сцепление HTTP-запросов</span><span class="sxs-lookup"><span data-stu-id="9e9ab-137">Chaining HTTP queries</span></span>

<span data-ttu-id="9e9ab-138">Вы наверняка можете представить риск в структуре, показанной на предыдущем изображении.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-138">You can certainly imagine the risk in the design shown in the previous image.</span></span> <span data-ttu-id="9e9ab-139">Что происходит при \# сбое шага 3?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-139">What happens if Step \#3 fails?</span></span> <span data-ttu-id="9e9ab-140">Или \# 8 завершается ошибкой?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-140">Or Step \#8 fails?</span></span> <span data-ttu-id="9e9ab-141">Как выполнить восстановление?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-141">How do you recover?</span></span> <span data-ttu-id="9e9ab-142">Что если шаг \# 6 замедлится из-за того, что базовая служба занята?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-142">What if Step \#6 is slow because the underlying service is busy?</span></span> <span data-ttu-id="9e9ab-143">Как продолжить?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-143">How do you continue?</span></span> <span data-ttu-id="9e9ab-144">Даже если все работает правильно, подумайте о задержке этого вызова, которая является суммой задержки каждого шага.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-144">Even if all works correctly, think of the latency this call would incur, which is the sum of the latency of each step.</span></span>

<span data-ttu-id="9e9ab-145">Большая степень связывания в предыдущем образе предполагает, что службы не были оптимально смоделированы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-145">The large degree of coupling in the previous image suggests the services weren't optimally modeled.</span></span> <span data-ttu-id="9e9ab-146">Он направляет бы команду повторно посетить свой проект.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-146">It would behoove the team to revisit their design.</span></span>

### <a name="materialized-view-pattern"></a><span data-ttu-id="9e9ab-147">Шаблон материализованного представления</span><span class="sxs-lookup"><span data-stu-id="9e9ab-147">Materialized View pattern</span></span>

<span data-ttu-id="9e9ab-148">Распространенным вариантом для удаления связи микрослужб является [шаблон материализованных представлений](/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-148">A popular option for removing microservice coupling is the [Materialized View pattern](/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="9e9ab-149">В этом шаблоне микрослужба хранится собственная локальная денормализованная копия данных, принадлежащих другим службам.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-149">With this pattern, a microservice stores its own local, denormalized copy of data that's owned by other services.</span></span> <span data-ttu-id="9e9ab-150">Вместо микрослужбы покупательской корзины, которая запрашивает Каталог продуктов и микрослужбы ценообразования, она сохраняет собственную локальную копию этих данных.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-150">Instead of the Shopping Basket microservice querying the Product Catalog and Pricing microservices, it maintains its own local copy of that data.</span></span> <span data-ttu-id="9e9ab-151">Этот шаблон устраняет ненужную связь и повышает надежность и время ответа.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-151">This pattern eliminates unnecessary coupling and improves reliability and response time.</span></span> <span data-ttu-id="9e9ab-152">Вся операция выполняется внутри одного процесса.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-152">The entire operation executes inside a single process.</span></span> <span data-ttu-id="9e9ab-153">Мы рассмотрим этот шаблон и другие проблемы с данными в главе 5.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-153">We explore this pattern and other data concerns in Chapter 5.</span></span>

### <a name="service-aggregator-pattern"></a><span data-ttu-id="9e9ab-154">Шаблон агрегатора служб</span><span class="sxs-lookup"><span data-stu-id="9e9ab-154">Service Aggregator Pattern</span></span>

<span data-ttu-id="9e9ab-155">Другой вариант для устранения межсерверной связи между микрослужбами — [микрослужба агрегатора](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), как показано на рисунке 4-10.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-155">Another option for eliminating microservice-to-microservice coupling is an [Aggregator microservice](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), shown in purple in Figure 4-10.</span></span>

![Служба агрегатора](./media/aggregator-service.png)

<span data-ttu-id="9e9ab-157">**Рис. 4-10**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-157">**Figure 4-10**.</span></span> <span data-ttu-id="9e9ab-158">Микрослужба агрегатора</span><span class="sxs-lookup"><span data-stu-id="9e9ab-158">Aggregator microservice</span></span>

<span data-ttu-id="9e9ab-159">Шаблон изолирует операцию, которая вызывает несколько серверных микрослужб, путем централизации ее логики в специализированной микрослужбе.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-159">The pattern isolates an operation that makes calls to multiple back-end microservices, centralizing its logic into a specialized microservice.</span></span>  <span data-ttu-id="9e9ab-160">На предыдущем рисунке микрослужба агрегатора для извлечения фиолетового цвета управляет рабочим процессом для операции извлечения.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-160">The purple checkout aggregator microservice in the previous figure orchestrates the workflow for the Checkout operation.</span></span> <span data-ttu-id="9e9ab-161">Он включает вызовы нескольких серверных микрослужб в упорядоченном порядке.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-161">It includes calls to several back-end microservices in a sequenced order.</span></span> <span data-ttu-id="9e9ab-162">Данные из рабочего процесса объединяются и возвращаются вызывающему.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-162">Data from the workflow is aggregated and returned to the caller.</span></span> <span data-ttu-id="9e9ab-163">Несмотря на то, что он по-прежнему реализует прямые вызовы HTTP, микрослужба агрегатора сокращает прямые зависимости между внутренними микрослужбами.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-163">While it still implements direct HTTP calls, the aggregator microservice reduces direct dependencies among back-end microservices.</span></span>

### <a name="requestreply-pattern"></a><span data-ttu-id="9e9ab-164">Шаблон "запрос-ответ"</span><span class="sxs-lookup"><span data-stu-id="9e9ab-164">Request/Reply Pattern</span></span>

<span data-ttu-id="9e9ab-165">Другой подход к разделению синхронных HTTP-сообщений — это шаблон типа " [запрос-ответ](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html)", который использует связь с очередями.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-165">Another approach for decoupling synchronous HTTP messages is a [Request-Reply Pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html), which uses queuing communication.</span></span> <span data-ttu-id="9e9ab-166">Связь с помощью очереди всегда является односторонним каналом с тем, что производитель отправляет сообщение и получает его потребитель.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-166">Communication using a queue is always a one-way channel, with a producer sending the message and consumer receiving it.</span></span> <span data-ttu-id="9e9ab-167">При использовании этого шаблона реализуются как очередь запросов, так и очередь ответов, показанные на рисунке 4-11.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-167">With this pattern, both a request queue and response queue are implemented, shown in Figure 4-11.</span></span>

![Шаблон "запрос-ответ"](./media/request-reply-pattern.png)

<span data-ttu-id="9e9ab-169">**Рис. 4-11**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-169">**Figure 4-11**.</span></span> <span data-ttu-id="9e9ab-170">Шаблон "запрос-ответ"</span><span class="sxs-lookup"><span data-stu-id="9e9ab-170">Request-reply pattern</span></span>

<span data-ttu-id="9e9ab-171">В этом случае производитель сообщения создает сообщение на основе запроса, которое содержит уникальный идентификатор корреляции и помещает его в очередь запросов.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-171">Here, the message producer creates a query-based message that contains a unique correlation ID and places it into a request queue.</span></span> <span data-ttu-id="9e9ab-172">Служба, использующая службу, выводит сообщения из очереди, обрабатывает их и помещает ответ в очередь ответов с тем же ИДЕНТИФИКАТОРом корреляции.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-172">The consuming service dequeues the messages, processes it and places the response into the response queue with the same correlation ID.</span></span> <span data-ttu-id="9e9ab-173">Служба Producer выводит сообщение из очереди, сопоставляет его с ИДЕНТИФИКАТОРом корреляции и возобновляет обработку.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-173">The producer service dequeues the message, matches it with the correlation ID and continues processing.</span></span> <span data-ttu-id="9e9ab-174">Мы подробно рассмотрим очереди в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-174">We cover queues in detail in the next section.</span></span>

## <a name="commands"></a><span data-ttu-id="9e9ab-175">Команды</span><span class="sxs-lookup"><span data-stu-id="9e9ab-175">Commands</span></span>

<span data-ttu-id="9e9ab-176">Другим типом взаимодействия является *команда*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-176">Another type of communication interaction is a *command*.</span></span> <span data-ttu-id="9e9ab-177">Микрослужбе может потребоваться другая микрослужба для выполнения действия.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-177">A microservice may need another microservice to perform an action.</span></span> <span data-ttu-id="9e9ab-178">Микрослужбе заказа может потребоваться микрослужба доставки для создания отгрузки для утвержденного заказа.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-178">The Ordering microservice may need the Shipping microservice to create a shipment for an approved order.</span></span> <span data-ttu-id="9e9ab-179">На рис. 4-12 одна микрослужба, называемая производителем, отправляет сообщение другой микрослужбе, потребителю, что делает что-то.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-179">In Figure 4-12, one microservice, called a Producer, sends a message to another microservice, the Consumer, commanding it to do something.</span></span>

![Взаимодействие команд с очередью](./media/command-interaction-with-queue.png)

<span data-ttu-id="9e9ab-181">**Рис. 4-12**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-181">**Figure 4-12**.</span></span> <span data-ttu-id="9e9ab-182">Взаимодействие команд с очередью</span><span class="sxs-lookup"><span data-stu-id="9e9ab-182">Command interaction with a queue</span></span>

<span data-ttu-id="9e9ab-183">Чаще всего производителю не требуется ответ, и он может *запустить и забыть* сообщение.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-183">Most often, the Producer doesn't require a response and can *fire-and-forget* the message.</span></span> <span data-ttu-id="9e9ab-184">Если требуется ответ, потребитель отправляет отдельное сообщение обратно в Producer на другом канале.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-184">If a reply is needed, the Consumer sends a separate message back to Producer on another channel.</span></span> <span data-ttu-id="9e9ab-185">Командное сообщение лучше отсылается асинхронно с помощью очереди сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-185">A command message is best sent asynchronously with a message queue.</span></span> <span data-ttu-id="9e9ab-186">поддерживается облегченным посредником сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-186">supported by a lightweight message broker.</span></span> <span data-ttu-id="9e9ab-187">На предыдущей схеме Обратите внимание на то, как очередь разделяет и отделяет обе службы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-187">In the previous diagram, note how a queue separates and decouples both services.</span></span>

<span data-ttu-id="9e9ab-188">Очередь сообщений — это промежуточная конструкция, с помощью которой производитель и потребитель проходят сообщение.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-188">A message queue is an intermediary construct through which a producer and consumer pass a message.</span></span> <span data-ttu-id="9e9ab-189">Очереди реализуют асинхронный шаблон обмена сообщениями типа "точка — точка".</span><span class="sxs-lookup"><span data-stu-id="9e9ab-189">Queues implement an asynchronous, point-to-point messaging pattern.</span></span> <span data-ttu-id="9e9ab-190">Производитель знает, где должна быть отправлена команда, и правильно ли они перенаправляются.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-190">The Producer knows where a command needs to be sent and routes appropriately.</span></span> <span data-ttu-id="9e9ab-191">Очередь гарантирует, что сообщение обрабатывается только одним из экземпляров потребителя, которые считываются из канала.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-191">The queue guarantees that a message is processed by exactly one of the consumer instances that are reading from the channel.</span></span> <span data-ttu-id="9e9ab-192">В этом сценарии либо производитель, либо служба-потребитель могут масштабироваться без влияния на другую.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-192">In this scenario, either the producer or consumer service can scale out without affecting the other.</span></span> <span data-ttu-id="9e9ab-193">Кроме того, технологии могут быть разными на разных сторонах, то есть у нас может быть микрослужба Java, вызывающая микрослужбу [Golang](https://golang.org) .</span><span class="sxs-lookup"><span data-stu-id="9e9ab-193">As well, technologies can be disparate on each side, meaning that we might have a Java microservice calling a [Golang](https://golang.org) microservice.</span></span>

<span data-ttu-id="9e9ab-194">В главе 1 мы говорили о *резервных службах*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-194">In chapter 1, we talked about *backing services*.</span></span> <span data-ttu-id="9e9ab-195">Резервные службы — это вспомогательные ресурсы, от которых зависят облачные системы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-195">Backing services are ancillary resources upon which cloud-native systems depend.</span></span> <span data-ttu-id="9e9ab-196">Очереди сообщений являются резервными службами.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-196">Message queues are backing services.</span></span> <span data-ttu-id="9e9ab-197">Облако Azure поддерживает два типа очередей сообщений, которые могут использоваться облачными системами для реализации обмена сообщениями с помощью команд: очереди службы хранилища Azure и очереди служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-197">The Azure cloud supports two types of message queues that your cloud-native systems can consume to implement command messaging: Azure Storage Queues and Azure Service Bus Queues.</span></span>

### <a name="azure-storage-queues"></a><span data-ttu-id="9e9ab-198">Очереди службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="9e9ab-198">Azure Storage Queues</span></span>

<span data-ttu-id="9e9ab-199">Очереди службы хранилища Azure предлагают простую инфраструктуру очередей, которая является быстрой, доступной и поддерживается учетными записями хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-199">Azure storage queues offer a simple queueing infrastructure that is fast, affordable, and backed by Azure storage accounts.</span></span>

<span data-ttu-id="9e9ab-200">[Очереди службы хранилища Azure](/azure/storage/queues/storage-queues-introduction) — это механизм очередей на основе RESTful с надежной и устойчивой системой обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-200">[Azure Storage Queues](/azure/storage/queues/storage-queues-introduction) feature a REST-based queuing mechanism with reliable and persistent messaging.</span></span> <span data-ttu-id="9e9ab-201">Они обеспечивают минимальный набор функций, но представляют собой недорогие и хранят миллионы сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-201">They provide a minimal feature set, but are inexpensive and store millions of messages.</span></span> <span data-ttu-id="9e9ab-202">Их емкость составляет до 500 ТБ.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-202">Their capacity ranges up to 500 TB.</span></span> <span data-ttu-id="9e9ab-203">Размер одного сообщения может доставлять до 64 КБ.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-203">A single message can be up to 64 KB in size.</span></span>

<span data-ttu-id="9e9ab-204">Доступ к сообщениям можно получить из любой точки мира через вызовы с проверкой подлинности с помощью HTTP или HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-204">You can access messages from anywhere in the world via authenticated calls using HTTP or HTTPS.</span></span> <span data-ttu-id="9e9ab-205">Очереди службы хранилища могут масштабироваться до большого количества параллельных клиентов, чтобы справиться с нагрузками на трафик.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-205">Storage queues can scale out to large numbers of concurrent clients to handle traffic spikes.</span></span>

<span data-ttu-id="9e9ab-206">С другой стороны, существуют ограничения службы:</span><span class="sxs-lookup"><span data-stu-id="9e9ab-206">That said, there are limitations with the service:</span></span>

- <span data-ttu-id="9e9ab-207">Порядок сообщений не гарантируется.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-207">Message order isn't guaranteed.</span></span>

- <span data-ttu-id="9e9ab-208">Сообщение может храниться только в течение семи дней, прежде чем оно будет автоматически удалено.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-208">A message can only persist for seven days before it's automatically removed.</span></span>

- <span data-ttu-id="9e9ab-209">Поддержка управления состоянием, обнаружения повторяющихся данных или транзакций недоступна.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-209">Support for state management, duplicate detection, or transactions isn't available.</span></span>

<span data-ttu-id="9e9ab-210">На рис. 4-13 показана иерархия очереди службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-210">Figure 4-13 shows the hierarchy of an Azure Storage Queue.</span></span>

![Иерархия очередей хранилища](./media/storage-queue-hierarchy.png)

<span data-ttu-id="9e9ab-212">**Рис. 4-13**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-212">**Figure 4-13**.</span></span> <span data-ttu-id="9e9ab-213">Иерархия очередей хранилища</span><span class="sxs-lookup"><span data-stu-id="9e9ab-213">Storage queue hierarchy</span></span>

<span data-ttu-id="9e9ab-214">На предыдущем рисунке обратите внимание, как очереди хранилища хранят свои сообщения в базовой учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-214">In the previous figure, note how storage queues store their messages in the underlying Azure Storage account.</span></span>

<span data-ttu-id="9e9ab-215">Для разработчиков Корпорация Майкрософт предоставляет несколько клиентских и серверных библиотек для обработки очереди хранилища.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-215">For developers, Microsoft provides several client and server-side libraries for Storage queue processing.</span></span> <span data-ttu-id="9e9ab-216">Поддерживаются большинство основных платформ, включая .NET, Java, JavaScript, Ruby, Python и Go.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-216">Most major platforms are supported including .NET, Java, JavaScript, Ruby, Python, and Go.</span></span> <span data-ttu-id="9e9ab-217">Разработчики никогда не должны обмениваться данными напрямую с этими библиотеками.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-217">Developers should never communicate directly with these libraries.</span></span> <span data-ttu-id="9e9ab-218">Это обеспечит тесное связывание кода микрослужбы с служба очередей службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-218">Doing so will tightly couple your microservice code to the Azure Storage Queue service.</span></span> <span data-ttu-id="9e9ab-219">Рекомендуется изолировать сведения о реализации API.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-219">It's a better practice to insulate the implementation details of the API.</span></span> <span data-ttu-id="9e9ab-220">Познакомьтесь с уровнем взаимодействий или промежуточным API, который предоставляет универсальные операции и инкапсулирует конкретную библиотеку.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-220">Introduce an intermediation layer, or intermediate API, that exposes generic operations and encapsulates the concrete library.</span></span> <span data-ttu-id="9e9ab-221">Эта слабая связь позволяет переключать одну службу очереди на другую без внесения изменений в код службы магистрали.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-221">This loose coupling enables you to swap out one queuing service for another without having to make changes to the mainline service code.</span></span>

<span data-ttu-id="9e9ab-222">Очереди службы хранилища Azure — это экономичный вариант для реализации обмена сообщениями в собственных облачных приложениях.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-222">Azure Storage queues are an economical option to implement command messaging in your cloud-native applications.</span></span> <span data-ttu-id="9e9ab-223">Особенно если размер очереди превысит 80 ГБ, а простой набор функций приемлем.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-223">Especially when a queue size will exceed 80 GB, or a simple feature set is acceptable.</span></span> <span data-ttu-id="9e9ab-224">Вы платите только за хранение сообщений; нет фиксированной почасовой оплаты.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-224">You only pay for the storage of the messages; there are no fixed hourly charges.</span></span>

### <a name="azure-service-bus-queues"></a><span data-ttu-id="9e9ab-225">очереди служебной шины Azure;</span><span class="sxs-lookup"><span data-stu-id="9e9ab-225">Azure Service Bus Queues</span></span>

<span data-ttu-id="9e9ab-226">Для более сложных требований к обмену сообщениями рекомендуется использовать очереди служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-226">For more complex messaging requirements, consider Azure Service Bus queues.</span></span>

<span data-ttu-id="9e9ab-227">В рамках надежной инфраструктуры сообщений [служебная шина Azure](/azure/service-bus-messaging/service-bus-messaging-overview) поддерживает *модель обмена сообщениями через брокер*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-227">Sitting atop a robust message infrastructure, [Azure Service Bus](/azure/service-bus-messaging/service-bus-messaging-overview) supports a *brokered messaging model*.</span></span> <span data-ttu-id="9e9ab-228">Сообщения надежно хранятся в брокере (очереди) до получения потребителем.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-228">Messages are reliably stored in a broker (the queue) until received by the consumer.</span></span> <span data-ttu-id="9e9ab-229">Очередь гарантирует доставку сообщений по принципу "первым поступил/первым обслужен" (FIFO), учитывающую порядок добавления сообщений в очередь.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-229">The queue guarantees First-In/First-Out (FIFO) message delivery, respecting the order in which messages were added to the queue.</span></span>

<span data-ttu-id="9e9ab-230">Размер сообщения может быть намного больше, до 256 КБ.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-230">The size of a message can be much larger, up to 256 KB.</span></span> <span data-ttu-id="9e9ab-231">Сообщения сохраняются в очереди в течение неограниченного периода времени.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-231">Messages are persisted in the queue for an unlimited period of time.</span></span> <span data-ttu-id="9e9ab-232">Служебная шина поддерживает не только вызовы на основе HTTP, но и обеспечивает полную поддержку [протокола AMQP](/azure/service-bus-messaging/service-bus-amqp-overview).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-232">Service Bus supports not only HTTP-based calls, but also provides full support for the [AMQP protocol](/azure/service-bus-messaging/service-bus-amqp-overview).</span></span> <span data-ttu-id="9e9ab-233">AMQP — это открытый стандарт для поставщиков, поддерживающих двоичный протокол и более высокий уровень надежности.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-233">AMQP is an open-standard across vendors that supports a binary protocol and higher degrees of reliability.</span></span>

<span data-ttu-id="9e9ab-234">Служебная шина предоставляет широкий набор функций, включая [поддержку транзакций](/azure/service-bus-messaging/service-bus-transactions) и [функцию обнаружения дубликатов](/azure/service-bus-messaging/duplicate-detection).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-234">Service Bus provides a rich set of features, including [transaction support](/azure/service-bus-messaging/service-bus-transactions) and a [duplicate detection feature](/azure/service-bus-messaging/duplicate-detection).</span></span> <span data-ttu-id="9e9ab-235">Очередь гарантирует "не более одной доставки" на каждое сообщение.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-235">The queue guarantees "at most once delivery" per message.</span></span> <span data-ttu-id="9e9ab-236">Оно автоматически удаляет сообщение, которое уже было отправлено.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-236">It automatically discards a message that has already been sent.</span></span> <span data-ttu-id="9e9ab-237">Если производитель сомнительен, он может повторно отправить то же сообщение, а служебная шина гарантирует, что будет обработана только одна копия.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-237">If a producer is in doubt, it can resend the same message, and Service Bus guarantees that only one copy will be processed.</span></span> <span data-ttu-id="9e9ab-238">Обнаружение дубликатов освобождает вас от необходимости создавать дополнительные коммуникации по инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-238">Duplicate detection frees you from  having to build additional infrastructure plumbing.</span></span>

<span data-ttu-id="9e9ab-239">Два других корпоративных компонента — это секционирование и сеансы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-239">Two more enterprise features are partitioning and sessions.</span></span> <span data-ttu-id="9e9ab-240">Обычная очередь служебной шины обрабатывается одним посредником сообщений и хранится в одном хранилище сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-240">A conventional Service Bus queue is handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="9e9ab-241">Однако [секционирование служебной шины](/azure/service-bus-messaging/service-bus-partitioning) распределяет очередь между несколькими брокерами сообщений и хранилищами сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-241">But, [Service Bus Partitioning](/azure/service-bus-messaging/service-bus-partitioning) spreads the queue across multiple message brokers and message stores.</span></span> <span data-ttu-id="9e9ab-242">Общая пропускная способность больше не ограничивается производительностью одного брокера сообщений или хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-242">The overall throughput is no longer limited by the performance of a single message broker or messaging store.</span></span> <span data-ttu-id="9e9ab-243">Временное отключение хранилища сообщений не приводит к недоступности секционированной очереди.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-243">A temporary outage of a messaging store doesn't render a partitioned queue unavailable.</span></span>

<span data-ttu-id="9e9ab-244">[Сеансы служебной шины](https://codingcanvas.com/azure-service-bus-sessions/) предоставляют возможность группирования сообщений, связанных с группировкой.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-244">[Service Bus Sessions](https://codingcanvas.com/azure-service-bus-sessions/) provide a way to group-related messages.</span></span> <span data-ttu-id="9e9ab-245">Представьте себе сценарий рабочего процесса, в котором сообщения должны обрабатываться вместе, а операция завершилась в конце.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-245">Imagine a workflow scenario where messages must be processed together and the operation completed at the end.</span></span> <span data-ttu-id="9e9ab-246">Чтобы воспользоваться преимуществами, необходимо явно включить сеансы для очереди, а каждое связанное с ним сообщение должно содержать один и тот же идентификатор сеанса.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-246">To take advantage, sessions must be explicitly enabled for the queue and each related messaged must contain the same session ID.</span></span>

<span data-ttu-id="9e9ab-247">Однако существуют некоторые важные предостережения: размер очередей служебной шины ограничен 80 ГБ, что намного меньше, чем доступно из очередей хранилища.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-247">However, there are some important caveats: Service Bus queues size is limited to 80 GB, which is much smaller than what's available from store queues.</span></span> <span data-ttu-id="9e9ab-248">Кроме того, очереди служебной шины имеют базовую стоимость и плату за операцию.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-248">Additionally, Service Bus queues incur a base cost and charge per operation.</span></span>

<span data-ttu-id="9e9ab-249">На рис. 4-14 показано высокоуровневая архитектура очереди служебной шины.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-249">Figure 4-14 outlines the high-level architecture of a Service Bus queue.</span></span>

![Очередь служебной шины](./media/service-bus-queue.png)

<span data-ttu-id="9e9ab-251">**Рис. 4-14**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-251">**Figure 4-14**.</span></span> <span data-ttu-id="9e9ab-252">Очередь служебной шины</span><span class="sxs-lookup"><span data-stu-id="9e9ab-252">Service Bus queue</span></span>

<span data-ttu-id="9e9ab-253">На предыдущем рисунке обратите внимание на связь «точка-точка».</span><span class="sxs-lookup"><span data-stu-id="9e9ab-253">In the previous figure, note the point-to-point relationship.</span></span> <span data-ttu-id="9e9ab-254">Два экземпляра одного поставщика постановку сообщения в одну очередь служебной шины.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-254">Two instances of the same provider are enqueuing messages into a single Service Bus queue.</span></span> <span data-ttu-id="9e9ab-255">Каждое сообщение потребляется только одним из трех экземпляров потребителей справа.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-255">Each message is consumed by only one of three consumer instances on the right.</span></span> <span data-ttu-id="9e9ab-256">Далее мы обсудим, как реализовать обмен сообщениями, когда разным потребителям может быть интересно одно и то же сообщение.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-256">Next, we discuss how to implement messaging where different consumers may all be interested the same message.</span></span>

## <a name="events"></a><span data-ttu-id="9e9ab-257">События</span><span class="sxs-lookup"><span data-stu-id="9e9ab-257">Events</span></span>

<span data-ttu-id="9e9ab-258">Очередь сообщений — это эффективный способ реализации взаимодействия, когда производитель может асинхронно отправить сообщение потребителю.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-258">Message queuing is an effective way to implement communication where a producer can asynchronously send a consumer a message.</span></span> <span data-ttu-id="9e9ab-259">Но что происходит, когда *много различных потребителей* интересуют одно и то же сообщение?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-259">However, what happens when *many different consumers* are interested in the same message?</span></span> <span data-ttu-id="9e9ab-260">Выделенная очередь сообщений для каждого потребителя не масштабируется хорошо, а управление становится затруднительным.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-260">A dedicated message queue for each consumer wouldn't scale well and would become difficult to manage.</span></span>

<span data-ttu-id="9e9ab-261">Для решения этой ситуации мы перейдем к третьему типу взаимодействия сообщений, *событию*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-261">To address this scenario, we move to the third type of message interaction, the *event*.</span></span> <span data-ttu-id="9e9ab-262">Одна микрослужба объявляет о том, что произошло действие.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-262">One microservice announces that an action had occurred.</span></span> <span data-ttu-id="9e9ab-263">Другие микрослужбы, если интересно, реагируют на действие или событие.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-263">Other microservices, if interested, react to the action, or event.</span></span>

<span data-ttu-id="9e9ab-264">Процесс обработки событий состоит из двух этапов.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-264">Eventing is a two-step process.</span></span> <span data-ttu-id="9e9ab-265">Для данного изменения состояния микрослужба публикует событие в брокере сообщений, делая его доступным для любой другой заинтересованной микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-265">For a given state change, a microservice publishes an event to a message broker, making it available to any other interested microservice.</span></span> <span data-ttu-id="9e9ab-266">Заинтересованная микрослужба получает уведомление от подписки на событие в брокере сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-266">The interested microservice is notified by subscribing to the event in the message broker.</span></span> <span data-ttu-id="9e9ab-267">Для реализации [взаимодействия на основе событий](/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications)используется шаблон [публикации или подписки](/azure/architecture/patterns/publisher-subscriber) .</span><span class="sxs-lookup"><span data-stu-id="9e9ab-267">You use the [Publish/Subscribe](/azure/architecture/patterns/publisher-subscriber) pattern to implement [event-based communication](/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span></span>

<span data-ttu-id="9e9ab-268">На рис. 4-15 показана микрослужба корзины покупок, публикующая событие с двумя другими микрослужбами, подписавшими на нее.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-268">Figure 4-15 shows a shopping basket microservice publishing an event with two other microservices subscribing to it.</span></span>

![Обмен сообщениями на основе событий](./media/event-driven-messaging.png)

<span data-ttu-id="9e9ab-270">**Рис. 4-15**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-270">**Figure 4-15**.</span></span> <span data-ttu-id="9e9ab-271">Обмен сообщениями на основе событий</span><span class="sxs-lookup"><span data-stu-id="9e9ab-271">Event-Driven messaging</span></span>

<span data-ttu-id="9e9ab-272">Обратите внимание на компонент *шины событий* , расположенный в середине коммуникационного канала.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-272">Note the *event bus* component that sits in the middle of the communication channel.</span></span> <span data-ttu-id="9e9ab-273">Это пользовательский класс, который инкапсулирует брокер сообщений и отделяет его от базового приложения.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-273">It's a custom class that encapsulates the message broker and decouples it from the underlying application.</span></span> <span data-ttu-id="9e9ab-274">Микрослужбы упорядочивания и инвентаризации независимо работают с событиями, не зная друг друга, а микрослужбой корзины покупок.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-274">The ordering and inventory microservices independently operate the event with no knowledge of each other, nor the shopping basket microservice.</span></span> <span data-ttu-id="9e9ab-275">Когда зарегистрированное событие публикуется в шине событий, оно работает над ним.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-275">When the registered event is published to the event bus, they act upon it.</span></span>

<span data-ttu-id="9e9ab-276">С помощью событий мы перейдем от технологии очередей к *разделам*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-276">With eventing, we move from queuing technology to *topics*.</span></span> <span data-ttu-id="9e9ab-277">[Раздел](/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) похож на очередь, но поддерживает шаблон обмена сообщениями «один ко многим».</span><span class="sxs-lookup"><span data-stu-id="9e9ab-277">A [topic](/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) is similar to a queue, but supports a one-to-many messaging pattern.</span></span> <span data-ttu-id="9e9ab-278">Одна микрослужба публикует сообщение.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-278">One microservice publishes a message.</span></span> <span data-ttu-id="9e9ab-279">При наличии нескольких подписок микрослужб можно принять это сообщение и выполнить действия.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-279">Multiple subscribing microservices can choose to receive and act upon that message.</span></span> <span data-ttu-id="9e9ab-280">На рис. 4-16 показана архитектура раздела.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-280">Figure 4-16 shows a topic architecture.</span></span>

![Архитектура раздела](./media/topic-architecture.png)

<span data-ttu-id="9e9ab-282">**Рис. 4-16**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-282">**Figure 4-16**.</span></span> <span data-ttu-id="9e9ab-283">Архитектура раздела</span><span class="sxs-lookup"><span data-stu-id="9e9ab-283">Topic architecture</span></span>

<span data-ttu-id="9e9ab-284">На предыдущем рисунке издатели отправляют сообщения в раздел.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-284">In the previous figure, publishers send messages to the topic.</span></span> <span data-ttu-id="9e9ab-285">В итоге подписчики получают сообщения из подписок.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-285">At the end, subscribers receive messages from subscriptions.</span></span> <span data-ttu-id="9e9ab-286">В середине раздел пересылает сообщения в подписки на основе набора правил, показанных в темно-синем прямоугольнике.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-286">In the middle, the topic forwards messages to subscriptions based on a set of rules, shown in dark blue boxes.</span></span> <span data-ttu-id="9e9ab-287">Правила действуют в качестве фильтра, который перенаправляет определенные сообщения в подписку.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-287">Rules act as a filter that forward specific messages to a subscription.</span></span> <span data-ttu-id="9e9ab-288">Здесь событие "стоимость" будет отправлено на подписки цены и ведения журнала, так как подписка на ведение журналов решила получать все сообщения.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-288">Here, a "GetPrice" event would be sent to the price and logging subscriptions as the logging subscription has chosen to receive all messages.</span></span>  <span data-ttu-id="9e9ab-289">В сведения и журналы подписки будет отправлено событие "с информацией".</span><span class="sxs-lookup"><span data-stu-id="9e9ab-289">A "GetInformation" event would be sent to the information and logging subscriptions.</span></span>

<span data-ttu-id="9e9ab-290">Облако Azure поддерживает два разных тематических служб: разделы служебной шины Azure и Azure EventGrid.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-290">The Azure cloud supports two different topic services: Azure Service Bus Topics and Azure EventGrid.</span></span>

### <a name="azure-service-bus-topics"></a><span data-ttu-id="9e9ab-291">Разделы служебной шины Azure</span><span class="sxs-lookup"><span data-stu-id="9e9ab-291">Azure Service Bus Topics</span></span>

<span data-ttu-id="9e9ab-292">В основе той же надежной модели брокера сообщений для очередей служебной шины Azure входят разделы служебной [шины Azure](/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-292">Sitting on top of the same robust brokered message model of Azure Service Bus queues are [Azure Service Bus Topics](/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="9e9ab-293">Раздел может получать сообщения от нескольких независимых издателей и отправлять сообщения до 2 000 подписчиков.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-293">A topic can receive messages from multiple independent publishers and send messages to up to 2,000 subscribers.</span></span> <span data-ttu-id="9e9ab-294">Подписки можно динамически добавлять или удалять во время выполнения без остановки системы или повторного создания раздела.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-294">Subscriptions can be dynamically added or removed at runtime without stopping the system or recreating the topic.</span></span>

<span data-ttu-id="9e9ab-295">Многие расширенные возможности очередей служебной шины Azure также доступны для разделов, в том числе для [поиска повторяющихся](/azure/service-bus-messaging/duplicate-detection) сообщений и [поддержки транзакций](/azure/service-bus-messaging/service-bus-transactions).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-295">Many advanced features from Azure Service Bus queues are also available for topics, including [Duplicate Detection](/azure/service-bus-messaging/duplicate-detection) and [Transaction support](/azure/service-bus-messaging/service-bus-transactions).</span></span> <span data-ttu-id="9e9ab-296">По умолчанию разделы служебной шины обрабатываются одним посредником сообщений и хранятся в одном хранилище сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-296">By default, Service Bus topics are handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="9e9ab-297">Однако [секционирование служебной шины](/azure/service-bus-messaging/service-bus-partitioning) масштабирует раздел, распределяя его между несколькими брокерами сообщений и хранилищами сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-297">But, [Service Bus Partitioning](/azure/service-bus-messaging/service-bus-partitioning) scales a topic by spreading it across many message brokers and message stores.</span></span>

<span data-ttu-id="9e9ab-298">[Запланированная доставка сообщений](/azure/service-bus-messaging/message-sequencing) помечает сообщение с заданным временем для обработки.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-298">[Scheduled Message Delivery](/azure/service-bus-messaging/message-sequencing) tags a message with a specific time for processing.</span></span> <span data-ttu-id="9e9ab-299">Это сообщение не будет отображаться в разделе до этого времени.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-299">The message won't appear in the topic before that time.</span></span> <span data-ttu-id="9e9ab-300">[Период отсрочки сообщения](/azure/service-bus-messaging/message-deferral) позволяет отложить получение сообщения на более позднее время.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-300">[Message Deferral](/azure/service-bus-messaging/message-deferral) enables you to defer a retrieval of a message to a later time.</span></span> <span data-ttu-id="9e9ab-301">Оба они часто используются в сценариях обработки рабочих процессов, где операции обрабатываются в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-301">Both are commonly used in workflow processing scenarios where operations are processed in a particular order.</span></span> <span data-ttu-id="9e9ab-302">Обработку полученных сообщений можно отложить до завершения предыдущей работы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-302">You can postpone processing of received messages until prior work has been completed.</span></span>

<span data-ttu-id="9e9ab-303">Разделы служебной шины — это надежная и проверенная технология, позволяющая обеспечить взаимодействие публикации и подписки в собственных системах в облаке.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-303">Service Bus topics are a robust and proven technology for enabling publish/subscribe communication in your cloud-native systems.</span></span>

### <a name="azure-event-grid"></a><span data-ttu-id="9e9ab-304">Сетка событий Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-304">Azure Event Grid</span></span>

<span data-ttu-id="9e9ab-305">Хотя служебная шина Azure — это проверенный брокер сообщений с полным набором корпоративных функций, служба " [Сетка событий Azure](/azure/event-grid/overview) " — это новый ребенок в блоке.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-305">While Azure Service Bus is a battle-tested messaging broker with a full set of enterprise features, [Azure Event Grid](/azure/event-grid/overview) is the new kid on the block.</span></span>

<span data-ttu-id="9e9ab-306">На первый взгляд, сетка событий может выглядеть как просто другая система обмена сообщениями на основе разделов.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-306">At first glance, Event Grid may look like just another topic-based messaging system.</span></span> <span data-ttu-id="9e9ab-307">Однако во многих отношениях он отличается.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-307">However, it's different in many ways.</span></span> <span data-ttu-id="9e9ab-308">С учетом рабочих нагрузок, управляемых событиями, она обеспечивает обработку событий в реальном времени, глубокую интеграцию с Azure и инфраструктуру «открытый платформенный-все» в бессерверной инфраструктуре.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-308">Focused on event-driven workloads, it enables real-time event processing, deep Azure integration, and an open-platform - all on serverless infrastructure.</span></span> <span data-ttu-id="9e9ab-309">Он предназначен для современных облачных и бессерверных приложений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-309">It's designed for contemporary cloud-native and serverless applications</span></span>

<span data-ttu-id="9e9ab-310">Как централизованная *Объединительная плата для событий*или канал, служба "Сетка событий" реагирует на события в ресурсах Azure и из собственных служб.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-310">As a centralized *eventing backplane*, or pipe, Event Grid reacts to events inside Azure resources and from your own services.</span></span>

<span data-ttu-id="9e9ab-311">Уведомления о событиях публикуются в разделе сетки событий, который, в свою очередь, направляет каждое событие в подписку.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-311">Event notifications are published to an Event Grid Topic, which, in turn, routes each event to a subscription.</span></span> <span data-ttu-id="9e9ab-312">Подписчики сопоставляются с подписками и используют события.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-312">Subscribers map to subscriptions and consume the events.</span></span> <span data-ttu-id="9e9ab-313">Как и служебная шина, служба "Сетка событий" поддерживает *модель фильтрованного подписчика* , в которой подписка задает правило для событий, которые он хочет получить.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-313">Like Service Bus, Event Grid supports a *filtered subscriber model* where a subscription sets rule for the events it wishes to receive.</span></span> <span data-ttu-id="9e9ab-314">Служба "Сетка событий" обеспечивает высокую пропускную способность с гарантией 10 000 000 событий в секунду, обеспечивающей доставку практически в реальном времени, намного больше, чем может создать служебная шина Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-314">Event Grid provides fast throughput with a guarantee of 10 million events per second enabling near real-time delivery - far more than what Azure Service Bus can generate.</span></span>

<span data-ttu-id="9e9ab-315">Очень полезное место для службы "Сетка событий" — это глубокая интеграция в структуру инфраструктуры Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-315">A sweet spot for Event Grid is its deep integration into the fabric of Azure infrastructure.</span></span> <span data-ttu-id="9e9ab-316">Ресурс Azure, например Cosmos DB, может публиковать встроенные события непосредственно в других заинтересованных ресурсах Azure без необходимости создавать пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-316">An Azure resource, such as Cosmos DB, can publish built-in events directly to other interested Azure resources - without the need for custom code.</span></span> <span data-ttu-id="9e9ab-317">Служба "Сетка событий" может публиковать события из подписки Azure, группы ресурсов или службы, предоставляя разработчикам точный контроль над жизненным циклом облачных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-317">Event Grid can publish events from an Azure Subscription, Resource Group, or Service, giving developers fine-grained control over the lifecycle of cloud resources.</span></span> <span data-ttu-id="9e9ab-318">Однако служба "Сетка событий" не ограничена в Azure.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-318">However, Event Grid isn't limited to Azure.</span></span> <span data-ttu-id="9e9ab-319">Это открытая платформа, которая может использовать пользовательские HTTP-события, опубликованные из приложений или сторонних служб, и перенаправлять события внешним подписчикам.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-319">It's an open platform that can consume custom HTTP events published from applications or third-party services and route events to external subscribers.</span></span>

<span data-ttu-id="9e9ab-320">При публикации и подписке на собственные события из ресурсов Azure не требуется писать код.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-320">When publishing and subscribing to native events from Azure resources, no coding is required.</span></span> <span data-ttu-id="9e9ab-321">С помощью простой конфигурации можно интегрировать события из одного ресурса Azure в другой, используя встроенные коммуникации для разделов и подписок.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-321">With simple configuration, you can integrate events from one Azure resource to another leveraging built-in plumbing for Topics and Subscriptions.</span></span> <span data-ttu-id="9e9ab-322">На рис. 4-17 показана структура сетки событий.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-322">Figure 4-17 shows the anatomy of Event Grid.</span></span>

![Таблица событий Анатомия](./media/event-grid-anatomy.png)

<span data-ttu-id="9e9ab-324">**Рис. 4-17**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-324">**Figure 4-17**.</span></span> <span data-ttu-id="9e9ab-325">Таблица событий Анатомия</span><span class="sxs-lookup"><span data-stu-id="9e9ab-325">Event Grid anatomy</span></span>

<span data-ttu-id="9e9ab-326">Основным различием между EventGrid и служебной шиной является основной *шаблон обмена сообщениями*.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-326">A major difference between EventGrid and Service Bus is the underlying *message exchange pattern*.</span></span>

<span data-ttu-id="9e9ab-327">Служебная шина реализует устаревшую *модель извлечения* в стиле, в которой подчиненный подписчик активно опрашивает подписку на раздел на предмет новых сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-327">Service Bus implements an older style *pull model* in which the downstream subscriber actively polls the topic subscription for new messages.</span></span> <span data-ttu-id="9e9ab-328">На самом переуровне этот подход дает подписчику полный контроль над темпом обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-328">On the upside, this approach gives the subscriber full control of the pace at which it processes messages.</span></span> <span data-ttu-id="9e9ab-329">Он определяет, когда и сколько сообщений должны обрабатываться в любое заданное время.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-329">It controls when and how many messages to process at any given time.</span></span> <span data-ttu-id="9e9ab-330">Непрочитанные сообщения остаются в подписке до обработки.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-330">Unread messages remain in the subscription until processed.</span></span> <span data-ttu-id="9e9ab-331">Серьезным недостатком является задержка между временем создания события и операцией опроса, которая извлекает это сообщение подписчику для обработки.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-331">A significant shortcoming is the latency between the time the event is generated and the polling operation that pulls that message to the subscriber for processing.</span></span> <span data-ttu-id="9e9ab-332">Кроме того, затраты на постоянный опрос для следующего события потребляют ресурсы и деньги.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-332">Also, the overhead of constant polling for the next event consumes resources and money.</span></span>

<span data-ttu-id="9e9ab-333">Однако EventGrid отличается.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-333">EventGrid, however, is different.</span></span> <span data-ttu-id="9e9ab-334">Он реализует *модель отправки* , в которой события отправляются в евенсандлерс как полученные, что обеспечивает доставку событий почти в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-334">It implements a *push model* in which events are sent to the EventHandlers as received, giving near real-time event delivery.</span></span> <span data-ttu-id="9e9ab-335">Это также сокращает затраты, так как служба активируется только в том случае, когда требуется использовать событие — не постоянно, как при опросе.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-335">It also reduces cost as the service is triggered only when it's needed to consume an event – not continually as with polling.</span></span> <span data-ttu-id="9e9ab-336">С другой стороны, обработчик событий должен обрабатывать входящую нагрузку и предоставлять механизмы регулирования, чтобы защитить себя от чрезмерного увеличения.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-336">That said, an event handler must handle the incoming load and provide throttling mechanisms to protect itself from becoming overwhelmed.</span></span> <span data-ttu-id="9e9ab-337">Многие службы Azure, использующие эти события, такие как функции Azure и Logic Apps, обеспечивают автоматическое Автомасштабирование для обработки повышенных нагрузок.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-337">Many Azure services that consume these events, such as Azure Functions and Logic Apps provide automatic autoscaling capabilities to handle increased loads.</span></span>  

<span data-ttu-id="9e9ab-338">Служба "Сетка событий" является полностью управляемой облачной службой.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-338">Event Grid is a fully managed serverless cloud service.</span></span> <span data-ttu-id="9e9ab-339">Он динамически масштабируется на основе трафика и оплачивается только для фактического использования, а не предварительно приобретенной емкости.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-339">It dynamically scales based on your traffic and charges you only for your actual usage, not pre-purchased capacity.</span></span> <span data-ttu-id="9e9ab-340">Первые 100 000 операций в месяц — это операции, которые определяются как исходящие события (входящие уведомления о событиях), попытки доставки подписки, вызовы управления и фильтрация по субъекту.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-340">The first 100,000 operations per month are free – operations being defined as event ingress (incoming event notifications), subscription delivery attempts, management calls, and filtering by subject.</span></span> <span data-ttu-id="9e9ab-341">Благодаря 99,99% доступности EventGrid гарантирует доставку события в течение 24-часового периода, используя встроенные функции повтора для неудачной доставки.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-341">With 99.99% availability, EventGrid guarantees the delivery of an event within a 24-hour period, with built-in retry functionality for unsuccessful delivery.</span></span> <span data-ttu-id="9e9ab-342">Недоставленные сообщения можно переместить в очередь недоставленных сообщений для разрешения.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-342">Undelivered messages can be moved to a "dead-letter" queue for resolution.</span></span>  <span data-ttu-id="9e9ab-343">В отличие от служебной шины Azure, служба "Сетка событий" настроена на высокую производительность и не поддерживает такие функции, как упорядоченные сообщения, транзакции и сеансы.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-343">Unlike Azure Service Bus, Event Grid is tuned for fast performance and doesn't support features like ordered messaging, transactions, and sessions.</span></span>

### <a name="streaming-messages-in-the-azure-cloud"></a><span data-ttu-id="9e9ab-344">Потоковая передача сообщений в облаке Azure</span><span class="sxs-lookup"><span data-stu-id="9e9ab-344">Streaming messages in the Azure cloud</span></span>

<span data-ttu-id="9e9ab-345">Служебная шина Azure и служба "Сетка событий" обеспечивают отличную поддержку для приложений, которые предоставляют отдельные дискретные события, такие как новый документ, в Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-345">Azure Service Bus and Event Grid provide great support for applications that expose single, discrete events like a new document has been inserted into a Cosmos DB.</span></span> <span data-ttu-id="9e9ab-346">Но что делать, если ваша облачная система должна обработать *поток связанных событий*?</span><span class="sxs-lookup"><span data-stu-id="9e9ab-346">But, what if your cloud-native system needs to process a *stream of related events*?</span></span> <span data-ttu-id="9e9ab-347">[Потоки событий](/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems) более сложны.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-347">[Event streams](/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems) are more complex.</span></span> <span data-ttu-id="9e9ab-348">Обычно они упорядочены по времени, взаимосвязаны и должны обрабатываться как группа.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-348">They're typically time-ordered, interrelated, and must be processed as a group.</span></span>

<span data-ttu-id="9e9ab-349">[Концентратор событий Azure](https://azure.microsoft.com/services/event-hubs/) — это платформа потоковой передачи данных и служба приема событий, которая собирает, преобразует и хранит события.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) is a data streaming platform and event ingestion service that collects, transforms, and stores events.</span></span> <span data-ttu-id="9e9ab-350">Она настроена для сбора данных потоковой передачи, таких как уведомления о непрерывных событиях, созданные из контекста телеметрии.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-350">It's fine-tuned to capture streaming data, such as continuous event notifications emitted from a telemetry context.</span></span> <span data-ttu-id="9e9ab-351">Служба обладает высокой степенью масштабируемости и может хранить и [обрабатывать миллионы событий в секунду](/azure/event-hubs/event-hubs-about).</span><span class="sxs-lookup"><span data-stu-id="9e9ab-351">The service is highly scalable and can store and [process millions of events per second](/azure/event-hubs/event-hubs-about).</span></span> <span data-ttu-id="9e9ab-352">Как показано на рисунке 4-18, это часто первая дверца для конвейера событий, которая разсопряжена с приемом потока от потребления событий.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-352">Shown in Figure 4-18, it's often a front door for an event pipeline, decoupling ingest stream from event consumption.</span></span>

![концентратору событий Azure](./media/azure-event-hub.png)

<span data-ttu-id="9e9ab-354">**Рис. 4-18**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-354">**Figure 4-18**.</span></span> <span data-ttu-id="9e9ab-355">концентратору событий Azure</span><span class="sxs-lookup"><span data-stu-id="9e9ab-355">Azure Event Hub</span></span>

<span data-ttu-id="9e9ab-356">Концентратор событий поддерживает низкую задержку и настраиваемое хранение времени.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-356">Event Hub supports low latency and configurable time retention.</span></span> <span data-ttu-id="9e9ab-357">В отличие от очередей и разделов, концентраторы событий сохраняют данные событий после их считывания потребителем.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-357">Unlike queues and topics, Event Hubs keep event data after it's been read by a consumer.</span></span> <span data-ttu-id="9e9ab-358">Эта функция позволяет другим службам аналитики данных, как внутренним, так и внешним, воспроизводить данные для дальнейшего анализа.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-358">This feature enables other data analytic services, both internal and external, to replay the data for further analysis.</span></span> <span data-ttu-id="9e9ab-359">События, хранящиеся в концентраторе событий, удаляются только по истечении срока хранения, который по умолчанию является одним днем, но настраивается.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-359">Events stored in event hub are only deleted upon expiration of the retention period, which is one day by default, but configurable.</span></span>

<span data-ttu-id="9e9ab-360">Концентратор событий поддерживает общие протоколы публикации событий, включая HTTPS и AMQP.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-360">Event Hub supports common event publishing protocols including HTTPS and AMQP.</span></span> <span data-ttu-id="9e9ab-361">Он также поддерживает Kafka 1,0.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-361">It also supports Kafka 1.0.</span></span> <span data-ttu-id="9e9ab-362">[Существующие приложения Kafka могут взаимодействовать с концентратором событий](/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) с помощью протокола Kafka, предоставляющего альтернативу управлению крупными кластерами Kafka.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-362">[Existing Kafka applications can communicate with Event Hub](/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) using the Kafka protocol providing an alternative to managing large Kafka clusters.</span></span> <span data-ttu-id="9e9ab-363">Многие облачные системы с открытым исходным кодом включают Kafka.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-363">Many open-source cloud-native systems embrace Kafka.</span></span>

<span data-ttu-id="9e9ab-364">Концентраторы событий реализуют потоковую передачу сообщений через [модель секционированных потребителей](/azure/event-hubs/event-hubs-features) , в которой каждый потребитель считывает только определенное подмножество или секцию потока сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-364">Event Hubs implements message streaming through a [partitioned consumer model](/azure/event-hubs/event-hubs-features) in which each consumer only reads a specific subset, or partition, of the message stream.</span></span> <span data-ttu-id="9e9ab-365">Это позволяет получить непревзойденные преимущества горизонтального масштабирования для обработки событий и другие ориентированные на работу с потоками функции, недоступные в очередях и разделах.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-365">This pattern enables tremendous horizontal scale for event processing and provides other stream-focused features that are unavailable in queues and topics.</span></span> <span data-ttu-id="9e9ab-366">Секция — это упорядоченная последовательность событий, хранящаяся в концентраторе событий.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-366">A partition is an ordered sequence of events that is held in an event hub.</span></span> <span data-ttu-id="9e9ab-367">По мере поступления новых событий они добавляются в конец этой последовательности.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-367">As newer events arrive, they're added to the end of this sequence.</span></span><span data-ttu-id="9e9ab-368">На рис. 4-19 показано секционирование в концентраторе событий.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-368"> Figure 4-19 shows partitioning in an Event Hub.</span></span>

![Секционирование концентратора событий](./media/event-hub-partitioning.png)

<span data-ttu-id="9e9ab-370">**Рис. 4-19**.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-370">**Figure 4-19**.</span></span> <span data-ttu-id="9e9ab-371">Секционирование концентратора событий</span><span class="sxs-lookup"><span data-stu-id="9e9ab-371">Event Hub partitioning</span></span>

<span data-ttu-id="9e9ab-372">Вместо того чтобы считывать данные из одного и того же ресурса, каждая группа потребителей считывает данные из подмножества или секции потока сообщений.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-372">Instead of reading from the same resource, each consumer group reads across a subset, or partition, of the message stream.</span></span>

<span data-ttu-id="9e9ab-373">Для облачных приложений, которые должны выполнять потоковую передачу большого количества событий, концентратор событий Azure может быть надежным и доступным решением.</span><span class="sxs-lookup"><span data-stu-id="9e9ab-373">For cloud-native applications that must stream large numbers of events, Azure Event Hub can be a robust and affordable solution.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="9e9ab-374">[Назад](front-end-communication.md)
>[Вперед](grpc.md)</span><span class="sxs-lookup"><span data-stu-id="9e9ab-374">[Previous](front-end-communication.md)
[Next](grpc.md)</span></span>
