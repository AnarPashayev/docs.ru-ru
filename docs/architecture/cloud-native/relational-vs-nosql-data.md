---
title: Реляционные и Данные NoSQL
description: Сведения о реляционных и NoSQL данных в облачных приложениях
author: robvet
ms.date: 01/19/2021
ms.openlocfilehash: 1148778b68c90586187d927eccd9b733403ede44
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505515"
---
# <a name="relational-vs-nosql-data"></a>Реляционные и Данные NoSQL

Реляционные и NoSQL — это два типа систем баз данных, которые обычно реализуются в собственных облачных приложениях. Они создаются по-разному, хранят данные по-разному и обращаются по-разному. В этом разделе мы рассмотрим оба варианта. Далее в этой главе мы рассмотрим новые технологии базы данных с именем *невскл*.

*Реляционные базы данных* были распространенной технологией для десятилетий. Они являются зрелыми, проверенными и широко реализованными. Конкурирующие продукты баз данных, Инструментарий и опыт SPFE. Реляционные базы данных предоставляют хранилище связанных таблиц данных. Эти таблицы имеют фиксированную схему, используют SQL (язык SQL) для управления данными, а поддержка ACID гарантируется.

*Базы данных No-SQL* относятся к высокопроизводительным, нереляционным хранилищам данных. Эти приложения Excel позволяют легко использовать, масштабируемость, устойчивость и характеристики доступности. Вместо объединения таблиц нормализованных данных NoSQL хранит неструктурированные или частично структурированные данные, часто в парах «ключ-значение» или в документах JSON. Базы данных без SQL обычно не предоставляют гарантий ACID за пределами области одной секции базы данных. Службы большого объема, для которых требуется время отклика в секунду, имеют приоритет в NoSQL хранилищах данных.

Влияние технологий [NoSQL](https://www.geeksforgeeks.org/introduction-to-nosql/) на распределенные облачные системы не может быть слишком высокой. Распространение новых технологий для работы с данными в этом пространстве приводит к нарушению работы решений, которые в монопольном режиме пополагались на реляционные базы данных.

Базы данных NoSQL включают несколько различных моделей для доступа к данным и управления ими, которые подходят для конкретных вариантов использования. На рис. 5-9 представлены четыре общие модели.

![Модели данных NoSQL](./media/types-of-nosql-datastores.png)

**Рис. 5-9**. модели данных для баз данных NoSQL

| Модель | Характеристики |
| :-------- | :-------- |
| Хранилище документов | Данные и метаданные хранятся иерархически в документах на основе JSON внутри базы данных. |
| Хранилище ключевых значений | Самая простая из баз данных NoSQL представляет собой коллекцию пар "ключ-значение". |
| Хранилище Wide-Column | Связанные данные хранятся в виде набора пар «вложенный ключ-значение» в одном столбце. |
| Графовое хранилище | Данные хранятся в структуре графа как свойства узла, ребра и данных. |

## <a name="the-cap-theorem"></a>Теорема CAP

Чтобы понять различия между этими типами баз данных, рассмотрим Теорема CAP, набор принципов, применяемых к распределенным системам, в которых хранится состояние. На рис. 5-10 показаны три свойства теоремаа CAP.

![Теорема CAP](./media/cap-theorem.png)

**Рис. 5-10**. Теорема CAP

Теорема указывает, что распределенные системы данных предлагают компромисс между согласованностью, доступностью и отклонением секций. И все базы данных могут гарантировать только *два* из трех свойств:

- *Согласованности.* Каждый узел в кластере отвечает последним данным, даже если система должна блокировать запрос до тех пор, пока все реплики не будут обновлены. Если вы запрашиваете "последовательную систему" для обновляемого элемента, дождитесь этого ответа, пока все реплики не будут успешно обновлены. Однако вы получите самые актуальные данные.

- *Ресурс.* Каждый узел возвращает немедленный ответ, даже если этот ответ не является самыми последними данными. Если вы запрашиваете доступную систему для обновляемого элемента, вы получите наилучший ответ, который может предоставить служба.

- *Допустимое отклонение секций.* Гарантирует, что система продолжит работать, даже если реплицированный узел данных завершается сбоем или теряет связь с другими реплицируемыми узлами данных.

Реляционные базы данных обычно обеспечивают согласованность и доступность, но не допускают отклонения секций. Обычно они подготавливаются для одного сервера и вертикально масштабируются путем добавления дополнительных ресурсов на компьютер.

Многие системы реляционных баз данных поддерживают встроенные функции репликации, в которых копии базы данных-источника могут быть сделаны на других экземплярах сервера-получателя. Операции записи вносятся в основной экземпляр и реплицируются на каждый из баз данных-получателей. При сбое основной экземпляр может выполнить отработку отказа на сервер-получатель, чтобы обеспечить высокий уровень доступности. Вторичные реплики также можно использовать для распределения операций чтения. Несмотря на то, что операции записи всегда проходят по отношению к первичной реплике, операции чтения могут направляться на любой из серверов-получателей, чтобы снизить нагрузку на систему.

Данные также можно горизонтально секционировать между несколькими узлами, например с [сегментированием](/azure/sql-database/sql-database-elastic-scale-introduction). Но сегментирование значительно увеличивает эксплуатационные расходы, спиттинг данные на множество частей, которые не могут легко обмениваться данными. Управление может быть дорогостоящим и длительным. Это может повлиять на производительность, соединение таблиц и ссылочную целостность.

Если реплики данных пришлось потерять сетевое подключение в кластере реляционной базы данных с высоким уровнем совместимости, вы не сможете записывать данные в базу данных. Система отклонит операцию записи, так как не сможет реплицировать это изменение в другую реплику данных. Каждая реплика данных должна быть обновлена до завершения транзакции.

Базы данных NoSQL обычно поддерживают высокий уровень доступности и отказоустойчивость секций. Они масштабируются горизонтально, часто на разных серверах. Такой подход обеспечивает огромную доступность как внутри, так и между географическими регионами по сниженным затратам. Вы разбиваете и реплицируете данные на этих компьютерах или узлах, обеспечивая избыточность и отказоустойчивость. Недостатком является согласованность. Изменение данных на одном узле NoSQL может занять некоторое время для распространения на другие узлы. Как правило, узел базы данных NoSQL предоставит немедленный ответ на запрос, даже если представленные данные устарели и еще не обновлены.

Если реплики данных были потеряют подключение в кластере базы данных NoSQL высокой доступности, то по-прежнему можно выполнить операцию записи в базу данных. Кластер базы данных разрешит операцию записи и обновит каждую реплику данных по мере ее появления.

Этот тип результата известен как итоговая согласованность, характеристика распределенных систем данных, в которой транзакции ACID не поддерживаются. Это небольшая задержка между обновлением элемента данных и временем, которое требуется для распространения этого обновления на каждый из узлов реплик. В нормальных условиях запаздывание обычно короткий, но может увеличиться при возникновении проблем. Например, что произойдет, если обновить элемент продукта в базе данных NoSQL в США и запросить тот же элемент данных из узла реплики в Европе? Вы получите более раннюю информацию о продукте, пока кластер не обновит Европейский узел с изменением продукта. Немедленно возвращая результат запроса и не ожидая обновления всех узлов реплик, вы получаете огромные масштаб и том, но с возможностью представления более старых данных.

Высокая доступность и широкие возможности масштабирования часто являются более важными для бизнеса, чем строгая согласованность. Разработчики могут реализовать методы и шаблоны, такие как саг, CQRS и асинхронный обмен сообщениями, чтобы принять окончательную согласованность.

> Настоящее время, следует соблюдать осторожность при рассмотрении ограничений CAP теорема. Появилось новый тип базы данных с именем Невскл, который расширяет ядро реляционной базы данных для поддержки горизонтальной масштабируемости и масштабируемой производительности систем NoSQL.

## <a name="considerations-for-relational-vs-nosql-systems"></a>Рекомендации по реляционным и NoSQL системам

Основываясь на конкретных требованиях к данным, микрослужба, основанная на облаке, может реализовать реляционную, NoSQL хранилище данных или и то, и другое.

|  Используйте хранилище данных NoSQL в следующих случаях: | Рассмотрим реляционную базу данных в следующих случаях: |
| :-------- | :-------- |
| У вас есть большие объемы рабочих нагрузок, требующих большого масштаба. | Том рабочей нагрузки является последовательным и требует средних и крупных масштабов |
| Ваши рабочие нагрузки не нуждаются в гарантиях ACID |  Требуются гарантии ACID |
| Данные являются динамическими и часто меняются | Данные являются прогнозируемыми и хорошо структурированными |
| Данные могут быть выражены без связей | Данные лучше выразить реляционно |  
| Высокая скорость записи и безопасность записи не являются критическими | Безопасность записи является требованием |  
| Получение данных является простым и, как правило, является плоским | Работа с сложными запросами и отчетами|
| Для данных требуется широкое географическое распределение | Ваши пользователи являются более централизованными |
| Ваше приложение будет развернуто на оборудовании для товара, например в общедоступных облаках | Приложение будет развернуто на большом и высоком оборудовании. |

В следующих разделах мы рассмотрим параметры, доступные в облаке Azure для хранения и управления собственными данными в облаке.

## <a name="database-as-a-service"></a>База данных как услуга

Для начала можно подготовить виртуальную машину Azure и установить для каждой службы выбранную базу данных. Хотя вы бы могли получить полный контроль над средой, вы отказаться от множество встроенных функций облачной платформы. Кроме того, вы несете ответственность за управление виртуальной машиной и базой данных для каждой службы. Такой подход может быстро занять много времени и затрат.

Вместо этого облачные приложения применяют службы данных, предоставляемые в качестве [базы данных в качестве службы (DBaaS)](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/). Эти службы полностью управляются поставщиком облачных служб, обеспечивающими встроенную безопасность, масштабируемость и мониторинг. Вместо того чтобы присвоить службе, вы просто принимаете ее в качестве [резервной службы](./definition.md#backing-services). Поставщик управляет ресурсами в масштабе и несет ответственность за производительность и обслуживание.

Их можно настроить в зонах доступности облака и регионах для обеспечения высокой доступности. Все они поддерживают JIT-поддержку и модель с оплатой по мере использования. В Azure доступны различные виды управляемых служб данных, каждый из которых имеет определенные преимущества.

Сначала мы рассмотрим реляционные службы DBaaS Services, доступные в Azure. Вы увидите, что база данных Microsoft Флагманское SQL Server доступна вместе с несколькими вариантами с открытым кодом. Затем мы поговорим о службах данных NoSQL в Azure.

## <a name="azure-relational-databases"></a>Реляционные базы данных Azure

Для встроенных в облако микрослужб, требующих реляционных данных, Azure предлагает четыре управляемых предложения в виде услуги (DBaaS), показанные на рисунке 5-11.

![Управляемые реляционные базы данных в Azure](./media/azure-managed-databases.png)

**Рис. 5-11**. Управляемые реляционные базы данных, доступные в Azure

На предыдущем рисунке обратите внимание на то, как каждая из них находится на общей DBaaS инфраструктуре, которая содержит ключевые возможности без дополнительных затрат.

Эти функции особенно важны для организаций, которые подготавливают большое количество баз данных, но имеют ограниченные ресурсы для их администрирования.
Вы можете подготавливать базу данных Azure за считаные минуты, выбрав объем вычислительных ядер, память и базовое хранилище. Вы можете масштабировать базу данных в режиме реального времени и динамически настраивать ресурсы без простоя.

## <a name="azure-sql-database"></a>База данных SQL Azure

Группы разработки с опытом в Microsoft SQL Server должны учитывать [базу данных SQL Azure](/azure/sql-database/). Это полностью управляемая реляционная база данных как услуга (DBaaS) на основе ядро СУБД Microsoft SQL Server. Служба использует множество функций, которые находятся в локальной версии SQL Server и запускают последнюю стабильную версию ядро СУБД SQL Server.

Для использования с микрослужбой, встроенной в облако, доступна база данных SQL Azure с тремя вариантами развертывания:

- Отдельная база данных представляет полностью управляемую базу данных SQL, работающую на [сервере базы данных SQL Azure](/azure/sql-database/sql-database-servers) в облаке Azure. База данных считается [*включенной*](/sql/relational-databases/databases/contained-databases) , так как она не имеет зависимостей конфигурации на базовом сервере базы данных.
  
- [Управляемый экземпляр](/azure/sql-database/sql-database-managed-instance) — это полностью управляемый экземпляр Microsoft SQL Server ядро СУБД, обеспечивающий совместимость почти 100% с локальной SQL Server. Этот параметр поддерживает большие базы данных размером до 35 ТБ и размещается в [виртуальной сети Azure](/azure/virtual-network/virtual-networks-overview) для лучшей изоляции.

- [Сервер базы данных SQL Azure](/azure/sql-database/sql-database-serverless) — это уровень вычислений для одной базы данных, которая автоматически масштабируется на основе спроса на рабочую нагрузку. Счета выставляются только за количество вычислений, использованных в секунду. Служба хорошо подходит для рабочих нагрузок с временными и непредсказуемыми шаблонами использования, смешанными с периодами бездействия. Уровень вычислений "бессерверный" также автоматически приостанавливает базы данных в течение неактивных периодов, чтобы взиматься только плата за хранилище. Он автоматически возобновляется при возврате действия.

Помимо традиционного стека Microsoft SQL Server в Azure также реализованы управляемые версии трех популярных баз данных с открытым исходным кодом.

## <a name="open-source-databases-in-azure"></a>Базы данных с открытым исходным кодом в Azure

Реляционные базы данных с открытым исходным кодом стали популярным выбором для облачных приложений. Многие предприятия применяют их к коммерческим продуктам базы данных, особенно для экономии затрат. Многие группы разработчиков повышают свою гибкость, ориентированную на сообщества разработку и экосистему средств и расширений. Базы данных с открытым исходным кодом можно развертывать в нескольких облачных поставщиках, что позволяет сократить затраты на блокировку поставщиков.

Разработчики могут легко размещать любую базу данных с открытым кодом на виртуальной машине Azure. При обеспечении полного контроля этот подход полагается на обработчик для управления, мониторинга и обслуживания базы данных и виртуальной машины.

Однако корпорация Майкрософт сохраняет свои обязательства по обеспечению "открытой платформы" в Azure, предлагая несколько популярных баз данных с открытым кодом в качестве *полностью управляемых* DBaaS Services.

### <a name="azure-database-for-mysql"></a>База данных Azure для MySQL

[MySQL](https://en.wikipedia.org/wiki/MySQL) — это реляционная база данных с открытым исходным кодом и основа для приложений, построенных на [стеке программного обеспечения лампы](https://en.wikipedia.org/wiki/LAMP_(software_bundle)). Широко выбрано для *интенсивных* рабочих нагрузок чтения, оно используется многими крупными организациями, включая Facebook, Twitter и YouTube. Выпуск Community Edition предоставляется бесплатно, а выпуск Enterprise требует приобретения лицензии. Продукт, изначально созданный в 1995, был приобретен корпорацией Sun Microsystems в 2008. Oracle приобрели Sun и MySQL в 2010.

[База данных Azure для MySQL](https://azure.microsoft.com/services/mysql/) — это управляемая служба реляционной базы данных, основанная на ядре сервера MySQL с открытым кодом. Он использует MySQL Community Edition. Сервер MySQL Azure является административной точкой для службы. Это тот же модуль MySQL Server, который используется для локальных развертываний. Подсистема может создать отдельную базу данных на один сервер или несколько баз данных на один сервер с общими ресурсами. Вы можете продолжать управлять данными с помощью одних и тех же средств с открытым кодом без необходимости изучать новые навыки или управлять виртуальными машинами.

### <a name="azure-database-for-mariadb"></a>База данных Azure для MariaDB

[MariaDB](https://mariadb.com/) Сервер — это еще один популярный сервер базы данных с открытым кодом. Он был создан как *вилка* MySQL, когда компания Oracle приобрела Sun Microsystems, которая владеет MySQL. Цель заключается в том, чтобы MariaDB оставался открытым исходным кодом. Поскольку MariaDB является вилкой MySQL, определения данных и таблиц совместимы, а клиентские протоколы, структуры и интерфейсы API — Close-компиляция.

MariaDB имеет надежное сообщество и используется многими крупными предприятиями. Несмотря на то, что Oracle продолжит поддерживать, улучшать и поддерживать MySQL, MariaDB Foundation управляет MariaDB, позволяя получить доступ к продуктам и документации.

[База данных Azure для MariaDB](https://azure.microsoft.com/services/mariadb/) — это полностью управляемая реляционная база данных как услуга в облаке Azure. Служба основана на ядре сервера MariaDB Community Edition. Она может обслуживать критически важные рабочие нагрузки с прогнозируемой производительностью и динамической масштабируемостью.

### <a name="azure-database-for-postgresql"></a>База данных Azure для PostgreSQL

[PostgreSQL](https://www.postgresql.org/) — это реляционная база данных с открытым исходным кодом в течение более 30 лет активной разработки. PostgresSQL обеспечивает надежную репутацию надежности и целостности данных. Он обладает широкими возможностями, совместимыми с SQL и считается более производительным, чем MySQL, особенно для рабочих нагрузок с сложными запросами и большими операциями записи. Многие крупные предприятия, включая Apple, Red Hat и Fujitsu, имеют встроенные продукты, использующие PostgreSQL.

[База данных Azure для PostgreSQL](https://azure.microsoft.com/services/postgresql/) — это полностью управляемая служба реляционных баз данных, основанная на ядре СУБД Postgres с открытым исходным кодом. Служба поддерживает множество платформ разработки, включая C++, Java, Python, Node, C \# и PHP. Вы можете перенести базы данных PostgreSQL в нее с помощью средства [интерфейса командной строки](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1) или службы Azure Data Migration Service.

База данных Azure для PostgreSQL доступна с двумя вариантами развертывания:

- Вариант развертывания с [одним сервером](/azure/postgresql/concepts-servers) — это центральная точка администрирования для нескольких баз данных, в которых можно развернуть множество баз данных. Цены структурированы для каждого сервера на основе ядер и хранилища.

- [Параметр Цитус](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/) обеспечивает технологию Цитус DATA Technology. Она обеспечивает высокую производительность, *горизонтальное масштабирование* отдельной базы данных на сотнях узлов, чтобы обеспечить высокую производительность и масштабируемость. Этот параметр позволяет подсистеме разместить больше данных в памяти, параллельно выполнять запросы на сотни узлов и быстрее индексировать данные.

## <a name="nosql-data-in-azure"></a>NoSQL данных в Azure

Cosmos DB — полностью управляемая глобально распределенная служба базы данных NoSQL в облаке Azure. Он принят многими крупными компаниями по всему миру, включая Coca-Cola, Skype, Ексксонмобил и Liberty.

Если вашим службам требуется быстрый отклик из любой точки мира, высокой доступности или масштабируемости, Cosmos DB является отличным выбором. На рис. 5-12 показано Cosmos DB.

![Общие сведения о Cosmos DB](./media/cosmos-db-overview.png)

**Рис. 5-12**. Обзор Cosmos DB

На предыдущем рисунке представлено множество встроенных возможностей облака, доступных в Cosmos DB. В этом разделе мы рассмотрим их Подробнее.

### <a name="global-support"></a>Глобальная поддержка

Облачные приложения часто имеют глобальную аудиторию и нуждаются в глобальном масштабе.

Базы данных Cosmos можно распределять по регионам или по всему миру, размещая данные ближе к пользователям, улучшая время отклика и сокращая задержку. Вы можете добавить или удалить базу данных из региона, не прибегая к приостановке или повторному развертыванию служб. В фоновом режиме Cosmos DB прозрачно реплицирует данные в каждый из настроенных регионов.

Cosmos DB поддерживает кластеризацию [Active/Active](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/) на глобальном уровне, позволяя настраивать любой регион базы данных для поддержки *операций записи и чтения*.

Протокол с [несколькими хозяевами](/azure/cosmos-db/multi-master-benefits) является важной функцией в Cosmos DB, которая обеспечивает следующие функциональные возможности:

- Неограниченная эластичная запись и масштабируемость чтения.

- доступность для чтения и записи на 99,999 % по всему миру;

- гарантированные операции чтения или записи, обслуживаемые менее чем за 10 миллисекунд в 99-м процентиле.

С помощью Cosmos DB [API-интерфейсов с несколькими](/azure/cosmos-db/distribute-data-globally)адресами микрослужба автоматически узнается о ближайшем регионе Azure и отправляет в нее запросы. Ближайший регион определяется Cosmos DB без каких-либо изменений конфигурации. Если регион станет недоступным, функция множественной адресации автоматически направит запросы в следующий ближайший доступный регион.

### <a name="multi-model-support"></a>Поддержка нескольких моделей

При изменении платформы монолитных приложений на облачную архитектуру, группам разработчиков иногда приходится переносить хранилища данных с открытым кодом NoSQL. Cosmos DB может помочь вам сохранить инвестиции в эти NoSQL хранилища данных с помощью своей платформы *многомодели Data Model* . В следующей таблице приведены поддерживаемые [API совместимости](https://www.wikiwand.com/en/Cosmos_DB)NoSQL.

| Поставщик | Описание  |
| :-------- | :-------- |
| API SQL | Собственный API, поддерживающий документы JSON и запросы на основе SQL |
| API MongoDB | Поддержка API-интерфейсов Mongo DB и документов JSON|
| API Gremlin | Поддерживает API Gremlin с узлами на основе графов и представлениями данных с краевыми данными |
| API Cassandra | Поддерживает API Касандра для представлений данных в расширенных столбцах |  
| API таблиц  | Поддержка хранилища таблиц Azure с расширенными возможностями Premium |  
| API etcd | Включает Cosmos DB в качестве резервного хранилища для кластеров службы Kubernetes Azure. |

Группы разработчиков могут перенести существующие базы данных Mongo, Gremlin или Cassandra в Cosmos DB с минимальными изменениями данных или кода. Для новых приложений группы разработчиков могут выбрать один из вариантов с открытым исходным кодом или встроенную модель API SQL.

> На внутреннем уровне Cosmos хранит данные в простом формате структуры, который состоит из примитивных типов данных. Для каждого запроса ядро СУБД преобразует примитивные данные в выбранное представление модели.

В предыдущей таблице обратите внимание на параметр [API таблиц](/azure/cosmos-db/table-introduction) . Этот API является развитием хранилища таблиц Azure. Они используют одну и ту же базовую модель таблицы, но Cosmos DB API таблиц добавляет расширения Premium, недоступные в API службы хранилища Azure. В следующей таблице перечислены функции, которые можно сравнить.

|  | Хранилище таблиц Azure  | Azure Cosmos DB  |
| :-------- | :-------- |:-------- |
| Задержка | Быстрый | Однозначная задержка в миллисекундах для операций чтения и записи в любом месте мира |
| Пропускная способность | Ограничение в 20 000 операций на таблицу | 10 000 000 операций на таблицу |
| Глобальное распределение | Один регион с необязательным одним дополнительным регионом чтения | Готовые дистрибутивы для всех регионов с автоматической отработкой отказа |
| Индексация | Доступно только для свойств ключа раздела и строки | Автоматическое индексирование всех свойств |
| Цены | На основе хранилища | На основе пропускной способности |

Микрослужбы, использующие хранилище таблиц Azure, можно легко перенести на Cosmos DB API таблиц. Изменения кода не требуются.

### <a name="tunable-consistency"></a>Настраиваемая согласованность

Ранее в разделе *реляционной версии VS. NoSQL* мы обсуждали тему *согласованности данных*. Согласованность данных — это *целостность* данных. Облачные службы с распределенными данными полагаются на репликацию и должны обеспечить фундаментальный компромисс между согласованностью операций чтения, доступности и задержкой.

Большинство распределенных баз данных позволяют разработчикам выбирать между двумя моделями согласованности: строгая согласованность и окончательная согласованность. *Строгая согласованность* является золотым стандартом для программирования данных. Он гарантирует, что запрос всегда будет возвращать самые актуальные данные, даже если система должна потребовать задержки в ожидании репликации обновления во всех копиях базы данных. Хотя база данных, настроенная для *окончательной согласованности* , будет возвращать данные немедленно, даже если эти данные не являются самой последней копией. Последний вариант обеспечивает повышенную доступность, большую масштабируемость и повышает производительность.

Azure Cosmos DB предлагает пять четко определенных [моделей согласованности](/azure/cosmos-db/consistency-levels) , показанных на рисунке 5-13.

![Диаграмма согласованности Cosmos DB](./media/cosmos-consistency-level-graph.png)

**Рис. 5-13**. Cosmos DB уровней согласованности

 Эти параметры позволяют выполнять точные и детализированные компромиссы для обеспечения согласованности, доступности и производительности данных. Уровни представлены в следующей таблице.

| Уровень согласованности | Описание  |
| :-------- | :-------- |
| Уровень согласованности "Итоговая" | Нет гарантий упорядочивания для операций чтения. В конечном итоге реплики будут согласованы. |
| Постоянный префикс | Операции чтения по-прежнему выполняются, но данные возвращаются в порядке их написания. |
| Сеанс | Гарантирует возможность чтения любых данных, записанных во время текущего сеанса. Это уровень согласованности по умолчанию. |
| Ограниченное устаревание | Считывает записи в конце по указанному интервалу. |  
| Уровень согласованности "Строгая"  | Операции чтения гарантированно возвращают последнюю зафиксированную версию элемента. Клиент никогда не видит Незафиксированное или частичное чтение. |  

В статье, посвященной [9-шарику: Cosmos DB уровнях согласованности](https://blog.jeremylikness.com/blog/2018-03-23_getting-behind-the-9ball-cosmosdb-consistency-levels/), Microsoft Program Manager Джереми ликнесс (предоставляет отличное объяснение пяти моделей.

### <a name="partitioning"></a>Секционирование

Azure Cosmos DB поддерживает автоматическое [секционирование](/azure/cosmos-db/partitioning-overview) для масштабирования базы данных в соответствии с потребностями производительности облачных служб.

Управление данными в Cosmos DB данных осуществляется путем создания баз данных, контейнеров и элементов.

Контейнеры находятся в базе данных Cosmos DB и представляют независимую от схемы группу элементов. Элементы — это данные, которые добавляются в контейнер. Они представлены в виде документов, строк, узлов или ребер. Все элементы, добавленные в контейнер, автоматически индексируются.

Чтобы секционировать контейнер, элементы делятся на отдельные подмножества, называемые логическими секциями. Логические секции заполняются на основе значения ключа секции, связанного с каждым элементом в контейнере. На рис. 5-14 показаны два контейнера, каждый из которых имеет логическую секцию на основе значения ключа секции.

![Механизм секционирования Cosmos DB](./media/cosmos-db-partitioning.png)

**Рис. 5-14**. механизм секционирования Cosmos DB

Обратите внимание, что в предыдущем рисунке каждый элемент включает ключ раздела «City» или «аэропорт». Ключ определяет логическую секцию элемента. Элементы с кодом города назначаются контейнеру слева, а элементы с кодом аэропорта — контейнеру справа. Сочетание значения ключа секции со значением идентификатора создает индекс элемента, однозначно определяющий элемент.

На внутреннем уровне Cosmos DB автоматически управляет размещением [логических секций](/azure/cosmos-db/partition-data) в физических секциях, чтобы удовлетворить потребности в масштабируемости и производительности контейнера. По мере увеличения пропускной способности приложения и требований к хранилищу Azure Cosmos DB повторно распределяет логические секции между большим количеством серверов. Операции распространения управляются Cosmos DB и вызываются без прерывания или простоя.

## <a name="newsql-databases"></a>Базы данных NewSQL

*Невскл* — это новая технология баз данных, которая сочетает распределенную масштабируемость NoSQL с ГАРАНТИЯми ACID в реляционной базе данных. Базы данных Невскл важны для бизнес-систем, которые должны обрабатывать большие объемы данных, в распределенных средах с полной поддержкой транзакций и соответствием ACID. Хотя база данных NoSQL может обеспечить массовую масштабируемость, она не гарантирует согласованности данных. Временные проблемы несоответствия данных могут полагаться на группу разработчиков. Разработчики должны создавать меры безопасности в коде микрослужбы для управления проблемами, вызванными непоследовательными данными.

Облачная инфраструктура машинного кода (КНКФ) включает в себя несколько проектов баз данных Невскл.

| Проект | Характеристики |
| :-------- | :-------- |
| Коккроач DB |Глобальная, совместимая с ACID реляционная база данных, которая масштабируется глобально. Добавьте новый узел в кластер, и Коккроачдб подбирает баланс данных между экземплярами и географическими регионами. Он создает, управляет и распространяет реплики для обеспечения надежности. Это открытый исходный код и свободно доступен.  |
| тидб | База данных с открытым исходным кодом, поддерживающая гибридные рабочие нагрузки транзакций и аналитической обработки (HTAP). Эта функция совместима с MySQL и обеспечивает горизонтальную масштабируемость, строгую согласованность и высокий уровень доступности.  Тидб действует как сервер MySQL. Вы можете продолжать использовать существующие клиентские библиотеки MySQL, не требуя внесения значительных изменений в код приложения. |
| югабитедб | Распределенная база данных SQL с открытым исходным кодом и высокой производительностью. Она поддерживает низкую задержку запросов, устойчивость к сбоям и глобальному распределению данных. Югабитедб является Постгрессскл совместимым и обрабатывает масштабируемые РЕЛЯЦИОНные и масштабируемые рабочие нагрузки OLTP в Интернете. Продукт также поддерживает NoSQL и совместим с Cassandra. |
|витесс | Витесс — это решение базы данных для развертывания и масштабирования больших кластеров экземпляров MySQL и управления ими. Он может работать в архитектуре общедоступного или частного облака. Витесс объединяет и расширяет множество важных функций и функций MySQL и поддерживает вертикальное и горизонтальное сегментирование. Порожденный YouTube, Витесс обслуживает весь трафик YouTube с 2011. |

Проекты с открытым исходным кодом, приведенные на предыдущем рисунке, доступны в облаке машинного кода для вычислений. Три предложения — это полные продукты базы данных, которые включают поддержку .NET. Другой, Витесс, — это система кластеризации баз данных, которая горизонтально масштабирует крупные кластеры экземпляров MySQL.

Ключевая цель проектирования для баз данных Невскл заключается в том, чтобы работать изначально в Kubernetes, используя преимущества отказоустойчивости и масштабируемости платформы.

Базы данных Невскл предназначены для использования в временных облачных средах, где базовые виртуальные машины могут быть перезапущены или перепланированы в заданное время. Базы данных предназначены для сохранения сбоев узлов без потери данных и простоя. Коккроачдб, например, может избежать потери компьютера, сохраняя три согласованных реплики любых данных на узлах в кластере.

Kubernetes использует *конструкцию служб* , чтобы позволить клиенту обращаться к группе идентичных процессов баз данных невскл из одной записи DNS. Путем разделения экземпляров базы данных по адресу службы, с которой она связана, можно масштабироваться без нарушения работы существующих экземпляров приложения. Отправка запроса любой службе в заданное время всегда приведет к тому же результату.

В этом сценарии все экземпляры базы данных равны. Нет первичных или вторичных связей. Такие методы, как *репликация с согласия* в коккроачдб, позволяют любому узлу базы данных работать с любыми запросами. Если узел, получающий запрос с балансировкой нагрузки, содержит данные, необходимые для локального входа, он немедленно реагирует на него. В противном случае узел станет шлюзом и перенаправит запрос соответствующим узлам, чтобы получить правильный ответ. С точки зрения клиента каждый узел базы данных один и тот же: они отображаются как единая *логическая* база данных с гарантированной согласованностью системы с одним компьютером, несмотря на наличие десятков или даже сотен узлов, работающих в фоновом режиме.

Подробный обзор механизмов работы с базами данных Невскл см. в разделе « [тире: четыре свойства Kubernetes-Native баз данных](https://thenewstack.io/dash-four-properties-of-kubernetes-native-databases/) ».

## <a name="data-migration-to-the-cloud"></a>Перенос данных в облако

Одной из более ресурсоемких задач является перенос данных с одной платформы данных на другую. [Служба Azure Data Migration Service](https://azure.microsoft.com/services/database-migration/) может помочь в ускорении таких усилий. Он может перенести данные из нескольких внешних источников базы данных в платформы данных Azure с минимальным временем простоя. Целевыми платформами являются следующие службы:

- База данных SQL Azure
- База данных Azure для MySQL
- База данных Azure для MariaDB
- База данных Azure для PostgreSQL
- Cosmos DB
  
Служба предоставляет рекомендации по выполнению изменений, необходимых для выполнения миграции, как малых, так и больших.

>[!div class="step-by-step"]
>[Назад](distributed-data.md)
>[Вперед](azure-caching.md)
