---
title: Централизованная конфигурация
description: Централизация конфигураций для облачных приложений с помощью конфигурации приложений Azure и хранилища Азурекэй.
ms.date: 01/19/2021
ms.openlocfilehash: 770c0c19a6de01250c59a586badb6a4afa2e9ae5
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505717"
---
# <a name="centralized-configuration"></a>Централизованная конфигурация

В отличие от монолитного приложения, в котором все работает в пределах одного экземпляра, облачное приложение состоит из независимых служб, распределенных между виртуальными машинами, контейнерами и географическими регионами. Управление параметрами конфигурации для десятков взаимозависимых служб может оказаться непростой задачей. Дублированные копии параметров конфигурации в разных местах могут быть подвержены ошибкам и сложно управлять ими. Централизованная настройка является критически важным требованием для распределенных облачных приложений.

Как описано в [главе 1](introduction.md), рекомендации по Twelve-Factor приложению требует четкого разделения между кодом и конфигурацией. Конфигурация должна быть сохранена извне из приложения и при необходимости доступна для чтения. Хранение значений конфигурации в виде констант или литеральных значений в коде является нарушением. Одни и те же значения конфигурации часто используются многими службами в одном приложении. Кроме того, мы должны поддерживать одни и те же значения в нескольких средах, таких как разработка, тестирование и производство. Рекомендуется хранить их в централизованном хранилище конфигураций.

Облако Azure предоставляет несколько замечательных вариантов.

## <a name="azure-app-configuration"></a>Конфигурация приложений Azure

[Настройка приложений Azure](/azure/azure-app-configuration/overview) — это полностью управляемая служба Azure, которая хранит несекретные параметры конфигурации в безопасном централизованном расположении. Сохраненные значения могут совместно использоваться несколькими службами и приложениями.

Служба проста в использовании и предоставляет несколько преимуществ.

- Гибкие представления "ключ — значение" и сопоставления
- Добавление тегов с помощью меток Azure
- Выделенный пользовательский интерфейс для управления
- Шифрование конфиденциальной информации
- Запросы и получение пакетов

В конфигурации приложений Azure сохраняются изменения, внесенные в параметры "ключ — значение" в течение семи дней. Функция создания моментальных снимков на момент времени позволяет воссоздать историю настроек и даже откатить для неудачного развертывания.

Конфигурация приложения автоматически кэширует каждый параметр, чтобы избежать чрезмерного вызова хранилища конфигурации. Операция обновления ожидает, пока не истечет срок действия кэшированного значения параметра, даже если его значение изменяется в хранилище конфигураций. Срок действия кэша по умолчанию составляет 30 секунд. Можно переопределить срок действия.

Конфигурация приложения шифрует все значения конфигурации во время передачи и неактивных. Имена и метки ключей используются в качестве индексов для получения данных конфигурации и не шифруются.

Хотя конфигурация приложений обеспечивает усиленную безопасность, Azure Key Vault по-прежнему является лучшим местом для хранения секретов приложения. Key Vault обеспечивает шифрование на уровне оборудования, политики детализированного доступа и операции управления, такие как смена сертификатов. Можно создать значения конфигурации приложения, которые ссылаются на секреты, хранящиеся в Key Vault.

## <a name="azure-key-vault"></a>Azure Key Vault

Key Vault — это управляемая служба для безопасного хранения секретов и доступа к ним. Секрет — это то, к чему необходимо строго контролировать доступ, например ключи API, пароли или сертификаты. Хранилище — это логическая группа секретов.

Key Vault значительно снижает вероятность случайной утечки секретов. При использовании Key Vault разработчикам приложений больше не требуется хранить информацию о безопасности своих приложений. Это избавляет от необходимости хранить эти сведения внутри кода. Например, приложению может потребоваться подключиться к базе данных. Вместо хранения строки подключения в коде приложений она безопасно хранится в Key Vault.

Ваши приложения могут безопасно получить необходимые сведения, используя URI. Эти URI позволяют приложениям получить определенные версии секрета. Нет необходимости писать пользовательский код для защиты секретной информации, хранящейся в Key Vault.

Для доступа к Key Vault требуется правильная проверка подлинности и авторизация вызывающей стороны. Как правило, каждая микрослужба, собственная в облаке, использует сочетание ClientId/ClientSecret. Важно защитить эти учетные данные вне системы управления версиями. Рекомендуется задавать их в среде приложения. Прямой доступ к Key Vault из AKS можно достичь с помощью [Key Vault флексволуме](https://github.com/Azure/kubernetes-keyvault-flexvol).

## <a name="configuration-in-eshop"></a>Конфигурация в Ешоп

Приложение eShopOnContainers содержит файлы параметров локального приложения для каждой микрослужбы. Эти файлы возвращаются в систему управления версиями, но не включают в себя рабочие секреты, такие как строки подключения или ключи API. В рабочей среде отдельные параметры могут быть перезаписаны с помощью переменных среды для каждой службы. Внедрение секретов в переменные среды является распространенной практикой для размещенных приложений, но не предоставляет центрального хранилища конфигураций. Для поддержки централизованного управления параметрами конфигурации каждая микрослужба включает параметр для переключения между использованием локальных параметров или параметров Azure Key Vault.

## <a name="references"></a>Ссылки

- [Архитектура eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности](../microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications.md)
- [Управление API Azure](/azure/api-management/api-management-key-concepts)
- [Обзор базы данных SQL Azure](/azure/sql-database/sql-database-technical-overview)
- [Кэш Azure для Redis](https://azure.microsoft.com/services/cache/)
- [API Azure Cosmos DB для MongoDB](/azure/cosmos-db/mongodb-introduction)
- [служебной шине Azure](/azure/service-bus-messaging/service-bus-messaging-overview)
- [Общие сведения о службе Azure Monitor](/azure/azure-monitor/overview)
- [eShopOnContainers: Создание кластера Kubernetes в AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)
- [eShopOnContainers: Azure Dev Spaces](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [Azure Dev Spaces](/azure/dev-spaces/about);

>[!div class="step-by-step"]
>[Назад](deploy-eshoponcontainers-azure.md)
>[Вперед](scale-applications.md)
