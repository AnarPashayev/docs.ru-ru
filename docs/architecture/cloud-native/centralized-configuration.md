---
title: Централизованная конфигурация
description: Централизация конфигураций для облачных приложений с помощью конфигурации приложений Azure и хранилища Азурекэй.
ms.date: 05/13/2020
ms.openlocfilehash: 0d40c5b2d70f30beb17489dfd55900f7c5fc1a75
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91160883"
---
# <a name="centralized-configuration"></a><span data-ttu-id="ef7d6-103">Централизованная конфигурация</span><span class="sxs-lookup"><span data-stu-id="ef7d6-103">Centralized configuration</span></span>

<span data-ttu-id="ef7d6-104">В отличие от монолитного приложения, в котором все работает в пределах одного экземпляра, облачное приложение состоит из независимых служб, распределенных между виртуальными машинами, контейнерами и географическими регионами.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="ef7d6-105">Управление параметрами конфигурации для десятков взаимозависимых служб может оказаться непростой задачей.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="ef7d6-106">Дублированные копии параметров конфигурации в разных местах могут быть подвержены ошибкам и сложно управлять ими.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-106">Duplicate copies of configuration settings across different locations is error prone and difficult to manage.</span></span> <span data-ttu-id="ef7d6-107">Централизованная настройка является критически важным требованием для распределенных облачных приложений.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="ef7d6-108">Как обсуждалось в [главе 1](introduction.md), для рекомендаций по развертыванию кода и конфигурации требуется четкое разделение.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="ef7d6-109">Конфигурация должна быть сохранена извне из приложения и при необходимости доступна для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="ef7d6-110">Хранение значений конфигурации в виде констант или литеральных значений в коде является нарушением.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="ef7d6-111">Одни и те же значения конфигурации часто используются многими службами в одном приложении.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="ef7d6-112">Кроме того, мы должны поддерживать одни и те же значения в нескольких средах, таких как разработка, тестирование и производство.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="ef7d6-113">Рекомендуется хранить их в централизованном хранилище конфигураций.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="ef7d6-114">Облако Azure предоставляет несколько замечательных вариантов.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="ef7d6-115">Конфигурация приложений Azure</span><span class="sxs-lookup"><span data-stu-id="ef7d6-115">Azure App Configuration</span></span>

<span data-ttu-id="ef7d6-116">[Настройка приложений Azure](/azure/azure-app-configuration/overview) — это полностью управляемая служба Azure, которая хранит несекретные параметры конфигурации в безопасном централизованном расположении.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-116">[Azure App Configuration](/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="ef7d6-117">Сохраненные значения могут совместно использоваться несколькими службами и приложениями.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="ef7d6-118">Служба проста в использовании и предоставляет несколько преимуществ.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="ef7d6-119">Гибкие представления "ключ — значение" и сопоставления</span><span class="sxs-lookup"><span data-stu-id="ef7d6-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="ef7d6-120">Добавление тегов с помощью меток Azure</span><span class="sxs-lookup"><span data-stu-id="ef7d6-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="ef7d6-121">Выделенный пользовательский интерфейс для управления</span><span class="sxs-lookup"><span data-stu-id="ef7d6-121">Dedicated UI for management</span></span>
- <span data-ttu-id="ef7d6-122">Шифрование конфиденциальной информации</span><span class="sxs-lookup"><span data-stu-id="ef7d6-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="ef7d6-123">Запросы и получение пакетов</span><span class="sxs-lookup"><span data-stu-id="ef7d6-123">Querying and batch retrieval</span></span>

<span data-ttu-id="ef7d6-124">В конфигурации приложений Azure сохраняются изменения, внесенные в параметры "ключ — значение" в течение семи дней.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="ef7d6-125">Функция создания моментальных снимков на момент времени позволяет воссоздать историю настроек и даже откатить для неудачного развертывания.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="ef7d6-126">Конфигурация приложения автоматически кэширует каждый параметр, чтобы избежать чрезмерного вызова хранилища конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="ef7d6-127">Операция обновления ожидает, пока не истечет срок действия кэшированного значения параметра, даже если его значение изменяется в хранилище конфигураций.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="ef7d6-128">Срок действия кэша по умолчанию составляет 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="ef7d6-129">Можно переопределить срок действия.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-129">You can override the expiration time.</span></span>

<span data-ttu-id="ef7d6-130">Конфигурация приложения шифрует все значения конфигурации во время передачи и неактивных.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="ef7d6-131">Имена и метки ключей используются в качестве индексов для получения данных конфигурации и не шифруются.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="ef7d6-132">Хотя конфигурация приложений обеспечивает усиленную безопасность, Azure Key Vault по-прежнему является лучшим местом для хранения секретов приложения.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="ef7d6-133">Key Vault обеспечивает шифрование на уровне оборудования, политики детализированного доступа и операции управления, такие как смена сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="ef7d6-134">Можно создать значения конфигурации приложения, которые ссылаются на секреты, хранящиеся в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="ef7d6-135">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ef7d6-135">Azure Key Vault</span></span>

<span data-ttu-id="ef7d6-136">Key Vault — это управляемая служба для безопасного хранения секретов и доступа к ним.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="ef7d6-137">Секрет — это то, к чему необходимо строго контролировать доступ, например ключи API, пароли или сертификаты.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="ef7d6-138">Хранилище — это логическая группа секретов.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="ef7d6-139">Key Vault значительно снижает вероятность случайной утечки секретов.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="ef7d6-140">При использовании Key Vault разработчикам приложений больше не требуется хранить информацию о безопасности своих приложений.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="ef7d6-141">Это избавляет от необходимости хранить эти сведения внутри кода.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="ef7d6-142">Например, приложению может потребоваться подключиться к базе данных.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="ef7d6-143">Вместо хранения строки подключения в коде приложений она безопасно хранится в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="ef7d6-144">Ваши приложения могут безопасно получить необходимые сведения, используя URI.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="ef7d6-145">Эти URI позволяют приложениям получить определенные версии секрета.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="ef7d6-146">Нет необходимости писать пользовательский код для защиты секретной информации, хранящейся в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="ef7d6-147">Для доступа к Key Vault требуется правильная проверка подлинности и авторизация вызывающей стороны.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="ef7d6-148">Как правило, каждая микрослужба, собственная в облаке, использует сочетание ClientId/ClientSecret.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="ef7d6-149">Важно защитить эти учетные данные вне системы управления версиями.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="ef7d6-150">Рекомендуется задавать их в среде приложения.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="ef7d6-151">Прямой доступ к Key Vault из AKS можно достичь с помощью [Key Vault флексволуме](https://github.com/Azure/kubernetes-keyvault-flexvol).</span><span class="sxs-lookup"><span data-stu-id="ef7d6-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="ef7d6-152">Конфигурация в Ешоп</span><span class="sxs-lookup"><span data-stu-id="ef7d6-152">Configuration in eShop</span></span>

<span data-ttu-id="ef7d6-153">Приложение eShopOnContainers содержит файлы параметров локального приложения для каждой микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="ef7d6-154">Эти файлы возвращаются в систему управления версиями, но не включают в себя рабочие секреты, такие как строки подключения или ключи API.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="ef7d6-155">В рабочей среде отдельные параметры могут быть перезаписаны с помощью переменных среды для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="ef7d6-156">Внедрение секретов в переменные среды является распространенной практикой для размещенных приложений, но не предоставляет центрального хранилища конфигураций.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="ef7d6-157">Для поддержки централизованного управления параметрами конфигурации каждая микрослужба включает параметр для переключения между использованием локальных параметров или параметров Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ef7d6-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="ef7d6-158">Ссылки</span><span class="sxs-lookup"><span data-stu-id="ef7d6-158">References</span></span>

- [<span data-ttu-id="ef7d6-159">Архитектура eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="ef7d6-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="ef7d6-160">Управление микрослужбами и многоконтейнерными приложениями для обеспечения высокого уровня масштабируемости и доступности</span><span class="sxs-lookup"><span data-stu-id="ef7d6-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](../microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications.md)
- [<span data-ttu-id="ef7d6-161">Управление API Azure</span><span class="sxs-lookup"><span data-stu-id="ef7d6-161">Azure API Management</span></span>](/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="ef7d6-162">Обзор базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="ef7d6-162">Azure SQL Database Overview</span></span>](/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="ef7d6-163">Кэш Azure для Redis</span><span class="sxs-lookup"><span data-stu-id="ef7d6-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="ef7d6-164">API Azure Cosmos DB для MongoDB</span><span class="sxs-lookup"><span data-stu-id="ef7d6-164">Azure Cosmos DB's API for MongoDB</span></span>](/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="ef7d6-165">служебной шине Azure</span><span class="sxs-lookup"><span data-stu-id="ef7d6-165">Azure Service Bus</span></span>](/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="ef7d6-166">Общие сведения о службе Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="ef7d6-166">Azure Monitor overview</span></span>](/azure/azure-monitor/overview)
- <span data-ttu-id="ef7d6-167">[eShopOnContainers: Создание кластера Kubernetes в AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="ef7d6-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="ef7d6-168">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="ef7d6-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="ef7d6-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="ef7d6-169">Azure Dev Spaces</span></span>](/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="ef7d6-170">[Назад](deploy-eshoponcontainers-azure.md)
>[Вперед](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="ef7d6-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
