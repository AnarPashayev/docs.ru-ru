---
title: Общие сведения о преобразователях типов для XAML
ms.date: 03/30/2017
helpviewer_keywords:
- XAML [XAML Services], type converters
- XAML [XAML Services], TypeConverter
- type conversion for XAML [XAML Services]
ms.assetid: 51a65860-efcb-4fe0-95a0-1c679cde66b7
ms.openlocfilehash: c3c69aebacd140a14e74545d601c0207cb8de681
ms.sourcegitcommit: c2d9718996402993cf31541f11e95531bc68bad0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "81432872"
---
# <a name="overview-of-type-converters-for-xaml"></a><span data-ttu-id="d94b6-102">Обзор преобразователей типов для XAML</span><span class="sxs-lookup"><span data-stu-id="d94b6-102">Overview of type converters for XAML</span></span>

<span data-ttu-id="d94b6-103">Преобразователи типов предоставляют логику для средства записи объекта, преобразующую строку в разметке XAML в конкретные объекты в графе объектов.</span><span class="sxs-lookup"><span data-stu-id="d94b6-103">Type converters supply logic for an object writer that converts from a string in XAML markup into particular objects in an object graph.</span></span> <span data-ttu-id="d94b6-104">В службах .NET XAML преобразователь типа <xref:System.ComponentModel.TypeConverter>должен быть классом, который вытекает из.</span><span class="sxs-lookup"><span data-stu-id="d94b6-104">In .NET XAML Services, the type converter must be a class that derives from <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="d94b6-105">Некоторые преобразователи также поддерживают путь сохранения XAML и могут использоваться для сериализации объекта в виде строки в разметке сериализации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-105">Some converters also support the XAML save path and can be used to serialize an object into a string form in serialization markup.</span></span> <span data-ttu-id="d94b6-106">В этом разделе описывается, как и когда вызываются преобразователи типов в XAML, а также представлены рекомендации по реализации переопределений методов класса <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-106">This topic describes how and when type converters in XAML are invoked, and provides implementation advice for the method overrides of <xref:System.ComponentModel.TypeConverter>.</span></span>

## <a name="type-conversion-concepts"></a><span data-ttu-id="d94b6-107">Понятия преобразования типов</span><span class="sxs-lookup"><span data-stu-id="d94b6-107">Type Conversion Concepts</span></span>

<span data-ttu-id="d94b6-108">В следующих разделах объясняются основные понятия о том, как XAML использует строки, и как авторы объектов в службах .NET XAML используют преобразователи типа для обработки некоторых значений строк, встречающихся в источнике XAML.</span><span class="sxs-lookup"><span data-stu-id="d94b6-108">The following sections explain basic concepts about how XAML uses strings, and how object writers in .NET XAML Services use type converters to process some of the string values that are encountered in a XAML source.</span></span>

### <a name="xaml-and-string-values"></a><span data-ttu-id="d94b6-109">XAML и строковые значения</span><span class="sxs-lookup"><span data-stu-id="d94b6-109">XAML and String Values</span></span>

<span data-ttu-id="d94b6-110">При установке значения атрибута в файле XAML начальный тип этого значения — это строка в общем смысле и значение строкового атрибута в контексте XML.</span><span class="sxs-lookup"><span data-stu-id="d94b6-110">When you set an attribute value in a XAML file, the initial type of that value is a string in a general sense, and a string attribute value in an XML sense.</span></span> <span data-ttu-id="d94b6-111">Даже другие примитивные типы, такие как <xref:System.Double> , изначально являются строками для обработчика XAML.</span><span class="sxs-lookup"><span data-stu-id="d94b6-111">Even other primitives such as <xref:System.Double> are initially strings to a XAML processor.</span></span>

<span data-ttu-id="d94b6-112">В большинстве случаев XAML-обработчику требуется два компонента для обработки значения атрибута.</span><span class="sxs-lookup"><span data-stu-id="d94b6-112">In most cases, a XAML processor needs two pieces of information to process an attribute value.</span></span> <span data-ttu-id="d94b6-113">Первый из них — это тип значения свойства, которое должно быть задано.</span><span class="sxs-lookup"><span data-stu-id="d94b6-113">The first piece of information is the value type of the property that is being set.</span></span> <span data-ttu-id="d94b6-114">Любую строку, которая определяет значение атрибута и обрабатывается в XAML, в конечном счете необходимо преобразовать или разрешить в значение этого типа.</span><span class="sxs-lookup"><span data-stu-id="d94b6-114">Any string that defines an attribute value and that is processed in XAML must ultimately be converted or resolved to a value of that type.</span></span> <span data-ttu-id="d94b6-115">Если значение — примитивный тип, понятный средству синтаксического анализа XAML (например, числовое значение), выполняется попытка прямого преобразования строки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-115">If the value is a primitive that is understood by the XAML parser (such as a numeric value), a direct conversion of the string is attempted.</span></span> <span data-ttu-id="d94b6-116">Если значение атрибута ссылается на перечисление, предоставленная строка проверяется на совпадение имени с именем константы в этом перечислении.</span><span class="sxs-lookup"><span data-stu-id="d94b6-116">If the value for the attribute references an enumeration, the supplied string is checked for a name match to a named constant in that enumeration.</span></span> <span data-ttu-id="d94b6-117">Если значение не является примитивным или постоянным названием из перечисления, применимый тип должен быть в состоянии предоставить значение или ссылку, основанную на преобразованной строке.</span><span class="sxs-lookup"><span data-stu-id="d94b6-117">If the value is not a parser-understood primitive or a constant name from an enumeration, the applicable type must be able to provide a value or reference that is based on a converted string.</span></span>

> [!NOTE]
> <span data-ttu-id="d94b6-118">Директивы языка XAML не используют преобразователи типов.</span><span class="sxs-lookup"><span data-stu-id="d94b6-118">XAML language directives do not use type converters.</span></span>

### <a name="type-converters-and-markup-extensions"></a><span data-ttu-id="d94b6-119">Преобразователи типов и расширения разметки</span><span class="sxs-lookup"><span data-stu-id="d94b6-119">Type Converters and Markup Extensions</span></span>

<span data-ttu-id="d94b6-120">Процессор XAML должен обработать расширения разметки, прежде чем он проверит тип свойства и другие аспекты.</span><span class="sxs-lookup"><span data-stu-id="d94b6-120">Markup extension usages must be handled by a XAML processor before it checks for property type and other considerations.</span></span> <span data-ttu-id="d94b6-121">Например, если устанавливаемое как атрибут свойство обычно использует преобразования типов, однако в конкретном случае задается расширение разметки, сначала обрабатывается расширение разметки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-121">For example, if a property being set as an attribute normally has a type conversion, but in a particular case is set by a markup extension usage, then the markup extension behavior processes first.</span></span> <span data-ttu-id="d94b6-122">Одна из распространенных ситуаций, где необходимо расширение разметки — указание ссылки на объект, который уже существует.</span><span class="sxs-lookup"><span data-stu-id="d94b6-122">One common situation where a markup extension is necessary is to make a reference to an object that already exists.</span></span> <span data-ttu-id="d94b6-123">Для этого сценария преобразователь типов без состояния может создать только новый экземпляр, что может быть нежелательно.</span><span class="sxs-lookup"><span data-stu-id="d94b6-123">For this scenario, a stateless type converter can only generate a new instance, which might not be desirable.</span></span> <span data-ttu-id="d94b6-124">Дополнительные сведения о расширениях разметки см. в разделе [Markup Extensions for XAML Overview](markup-extensions-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d94b6-124">For more information about markup extensions, see [Markup Extensions for XAML Overview](markup-extensions-overview.md).</span></span>

### <a name="native-type-converters"></a><span data-ttu-id="d94b6-125">Собственные преобразователи типа</span><span class="sxs-lookup"><span data-stu-id="d94b6-125">Native Type Converters</span></span>

<span data-ttu-id="d94b6-126">В реализации служб Windows Presentation Foundation (WPF) и .NET XAML существуют определенные типы CLR, которые имеют обработку конверсии родного типа.</span><span class="sxs-lookup"><span data-stu-id="d94b6-126">In the Windows Presentation Foundation (WPF) and .NET XAML services implementations, there are certain CLR types that have native type conversion handling.</span></span> <span data-ttu-id="d94b6-127">Тем не менее, эти типы CLR обычно не считаются примитивами.</span><span class="sxs-lookup"><span data-stu-id="d94b6-127">However, those CLR types are not conventionally thought of as primitives.</span></span> <span data-ttu-id="d94b6-128">Пример такого типа — <xref:System.DateTime>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-128">An example of such a type is <xref:System.DateTime>.</span></span> <span data-ttu-id="d94b6-129">Одна из причин этого — работа архитектуры платформы .NET Framework: тип <xref:System.DateTime> определяется в mscorlib, в основной библиотеке .NET.</span><span class="sxs-lookup"><span data-stu-id="d94b6-129">One reason for this is how the .NET Framework architecture works: the type <xref:System.DateTime> is defined in mscorlib, the most basic library in .NET.</span></span> <span data-ttu-id="d94b6-130"><xref:System.DateTime>не разрешается приписывать атрибут, который исходит от другой сборки,<xref:System.ComponentModel.TypeConverterAttribute> которая вводит зависимость (от системы).</span><span class="sxs-lookup"><span data-stu-id="d94b6-130"><xref:System.DateTime> is not permitted to be attributed with an attribute that comes from another assembly that introduces a dependency (<xref:System.ComponentModel.TypeConverterAttribute> is from System).</span></span> <span data-ttu-id="d94b6-131">Таким образом, обычный механизм обнаружения преобразователя типа путем приписывания не может быть поддержан.</span><span class="sxs-lookup"><span data-stu-id="d94b6-131">Therefore, the usual type converter discovery mechanism by attributing cannot be supported.</span></span> <span data-ttu-id="d94b6-132">Вместо этого средство синтаксического анализа XAML использует список типов, требующих собственный обработки. Эти типы обрабатываются как настоящие примитивы.</span><span class="sxs-lookup"><span data-stu-id="d94b6-132">Instead, the XAML parser has a list of types that need native processing, and it processes these types similar to how the true primitives are processed.</span></span> <span data-ttu-id="d94b6-133">В случае <xref:System.DateTime>при обработке вызывается <xref:System.DateTime.Parse%2A>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-133">In the case of <xref:System.DateTime>, this processing involves a call to <xref:System.DateTime.Parse%2A>.</span></span>

## <a name="implementing-a-type-converter"></a><span data-ttu-id="d94b6-134">Реализация преобразователя типов</span><span class="sxs-lookup"><span data-stu-id="d94b6-134">Implementing a Type Converter</span></span>

<span data-ttu-id="d94b6-135">В следующих разделах рассматриваются API-интерфейс класса <xref:System.ComponentModel.TypeConverter> .</span><span class="sxs-lookup"><span data-stu-id="d94b6-135">The following sections discuss the API of the <xref:System.ComponentModel.TypeConverter> class.</span></span>

### <a name="typeconverter"></a><span data-ttu-id="d94b6-136">TypeConverter</span><span class="sxs-lookup"><span data-stu-id="d94b6-136">TypeConverter</span></span>

<span data-ttu-id="d94b6-137">В соответствии с услугами .NET XAML все преобразователи типа, <xref:System.ComponentModel.TypeConverter>используемые для целей XAML, являются классами, которые вытекают из базового класса.</span><span class="sxs-lookup"><span data-stu-id="d94b6-137">Under .NET XAML Services, all type converters that are used for XAML purposes are classes that derive from the base class <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="d94b6-138">Класс <xref:System.ComponentModel.TypeConverter> существовал в версиях .NET Framework до появления XAML. Один исходный сценарии <xref:System.ComponentModel.TypeConverter> использовался для преобразование строк в редакторах свойств визуальных конструкторов.</span><span class="sxs-lookup"><span data-stu-id="d94b6-138">The <xref:System.ComponentModel.TypeConverter> class existed in versions of the .NET Framework before XAML existed; one of the original <xref:System.ComponentModel.TypeConverter> scenarios was to provide string conversion for property editors in visual designers.</span></span>

<span data-ttu-id="d94b6-139">Для XAML роль <xref:System.ComponentModel.TypeConverter> расширяется.</span><span class="sxs-lookup"><span data-stu-id="d94b6-139">For XAML, the role of <xref:System.ComponentModel.TypeConverter> is expanded.</span></span> <span data-ttu-id="d94b6-140">В XAML <xref:System.ComponentModel.TypeConverter> — это базовый класс для поддержки определенных преобразований в строку и из строки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-140">For XAML purposes, <xref:System.ComponentModel.TypeConverter> is the base class for providing support for certain to-string and from-string conversions.</span></span> <span data-ttu-id="d94b6-141">Преобразование из строки позволяет выполнить анализ значения строкового атрибута из XAML.</span><span class="sxs-lookup"><span data-stu-id="d94b6-141">From-string enables parsing a string attribute value from XAML.</span></span> <span data-ttu-id="d94b6-142">Преобразование в строку позволяет преобразовать значение определенного свойства объекта во время выполнения в атрибут в XAML для сериализации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-142">To-string might enable processing a run-time value of a particular object property back into an attribute in XAML for serialization.</span></span>

<span data-ttu-id="d94b6-143">В<xref:System.ComponentModel.TypeConverter> определены четыре элемента, относящихся к преобразованию в строку и из строки для обработки XAML:</span><span class="sxs-lookup"><span data-stu-id="d94b6-143"><xref:System.ComponentModel.TypeConverter> defines four members that are relevant for converting to-string and from-string for XAML processing purposes:</span></span>

- <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A>

- <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A>

- <xref:System.ComponentModel.TypeConverter.ConvertTo%2A>

- <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A>

<span data-ttu-id="d94b6-144">Наиболее важный из этих элементов — это метод <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A>, который преобразует входную строку в требуемый тип объекта.</span><span class="sxs-lookup"><span data-stu-id="d94b6-144">Of these members, the most important method is <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A>, which converts the input string to the required object type.</span></span> <span data-ttu-id="d94b6-145">Метод <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> можно реализовать для преобразования более широкого диапазона типов в требуемый конечный тип преобразователя.</span><span class="sxs-lookup"><span data-stu-id="d94b6-145">The <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> method can be implemented to convert a wider range of types into the intended destination type of the converter.</span></span> <span data-ttu-id="d94b6-146">Таким образом его можно использовать в целях, выходящих за пределы языка XAML, например для поддержки преобразований во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="d94b6-146">Therefore, it can serve purposes that extend beyond XAML, such as supporting run-time conversions.</span></span> <span data-ttu-id="d94b6-147">Однако для XAML важен только путь кода, который может обрабатывать входные данные <xref:System.String> .</span><span class="sxs-lookup"><span data-stu-id="d94b6-147">However, for XAML use, only the code path that can process a <xref:System.String> input is important.</span></span>

<span data-ttu-id="d94b6-148">Вторым по значимости <xref:System.ComponentModel.TypeConverter.ConvertTo%2A>методом является .</span><span class="sxs-lookup"><span data-stu-id="d94b6-148">The second-most important method is <xref:System.ComponentModel.TypeConverter.ConvertTo%2A>.</span></span> <span data-ttu-id="d94b6-149">Если приложение преобразуется в представление разметки (например, если оно сохранено в XAML как файл), <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> участвует в более широком сценарии текстовых авторов XAML для создания представления разметки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-149">If an application is converted to a markup representation (for example, if it is saved to XAML as a file), <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> is involved in the larger scenario of a XAML text writer to produce a markup representation.</span></span> <span data-ttu-id="d94b6-150">В этом случае важный путь кода XAML — передача вызывающим объектом `destinationType` из <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-150">In this case, the important code path for XAML is when the caller passes a `destinationType` of <xref:System.String>.</span></span>

<span data-ttu-id="d94b6-151"><xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> и <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A> — это вспомогательные методы, используемые, когда служба запрашивает возможности реализации <xref:System.ComponentModel.TypeConverter> .</span><span class="sxs-lookup"><span data-stu-id="d94b6-151"><xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> and <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A> are support methods that are used when a service queries the capabilities of the <xref:System.ComponentModel.TypeConverter> implementation.</span></span> <span data-ttu-id="d94b6-152">Вам необходимо реализовать эти методы для возврата `true` для определенных типов. Они аналогичны методам преобразования для поддержки вашего преобразователя.</span><span class="sxs-lookup"><span data-stu-id="d94b6-152">You must implement these methods to return `true` for type-specific cases that the equivalent conversion methods of your converter support.</span></span> <span data-ttu-id="d94b6-153">В целях XAML обычно это означает тип <xref:System.String> .</span><span class="sxs-lookup"><span data-stu-id="d94b6-153">For XAML purposes, this generally means the <xref:System.String> type.</span></span>

### <a name="culture-information-and-type-converters-for-xaml"></a><span data-ttu-id="d94b6-154">Сведения о языке и преобразователи типов для XAML</span><span class="sxs-lookup"><span data-stu-id="d94b6-154">Culture Information and Type Converters for XAML</span></span>

<span data-ttu-id="d94b6-155">Каждая реализация <xref:System.ComponentModel.TypeConverter> может однозначно интерпретировать допустимую строку для преобразования, а также может использовать или игнорировать описание типа, переданного в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="d94b6-155">Each <xref:System.ComponentModel.TypeConverter> implementation can uniquely interpret what is a valid string for a conversion, and it can also use or ignore the type description that is passed as parameters.</span></span> <span data-ttu-id="d94b6-156">Важный аспект для региональных параметров и преобразования типов XAML: хотя использование локализуемых строк в качестве значений атрибутов поддерживается в XAML, невозможно применять эти локализуемые строки в качестве входных данных преобразователя типов с определенными требованиями для региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="d94b6-156">An important consideration for culture and XAML type conversion is the following: although using localizable strings as attribute values is supported by XAML, you cannot use these localizable strings as type converter input with specific culture requirements.</span></span> <span data-ttu-id="d94b6-157">Это ограничение вызвано тем, что преобразователи типов для значений атрибутов XAML обязательно используют фиксированное поведение обработки XAML, для чего применяются региональные параметры `en-US` .</span><span class="sxs-lookup"><span data-stu-id="d94b6-157">This limitation is because type converters for XAML attribute values involve a necessarily fixed-language XAML-processing behavior that uses `en-US` culture.</span></span> <span data-ttu-id="d94b6-158">Для получения дополнительной информации о причинах этого ограничения можно ознакомиться с спецификацией языка XAML[\[(MS-XAML)\]](https://docs.microsoft.com/previous-versions/msp-n-p/ff650760(v=pandp.10))или [обзором глобализации и локализации WPF.](../../framework/wpf/advanced/wpf-globalization-and-localization-overview.md)</span><span class="sxs-lookup"><span data-stu-id="d94b6-158">For more information about the design reasons for this restriction, see the XAML language specification ([\[MS-XAML\]](https://docs.microsoft.com/previous-versions/msp-n-p/ff650760(v=pandp.10))) or [WPF Globalization and Localization Overview](../../framework/wpf/advanced/wpf-globalization-and-localization-overview.md).</span></span>

<span data-ttu-id="d94b6-159">Вот пример проблемы с языком и региональными параметрами: в некоторых языках в качестве десятичного разделителя для чисел в виде строки вместо точки используется запятая.</span><span class="sxs-lookup"><span data-stu-id="d94b6-159">As an example where culture can be an issue, some cultures use a comma instead of a period as the decimal point delimiter for numbers in string form.</span></span> <span data-ttu-id="d94b6-160">Это противоречит поведению многих существующих преобразователей типов, которые используют запятую в качестве разделителя.</span><span class="sxs-lookup"><span data-stu-id="d94b6-160">This use collides with the behavior that many existing type converters have, which is to use a comma as a delimiter.</span></span> <span data-ttu-id="d94b6-161">Передача языка через `xml:lang` в XAML не решает проблему.</span><span class="sxs-lookup"><span data-stu-id="d94b6-161">Passing a culture through `xml:lang` in the surrounding XAML does not solve the issue.</span></span>

### <a name="implementing-convertfrom"></a><span data-ttu-id="d94b6-162">Реализация ConvertFrom</span><span class="sxs-lookup"><span data-stu-id="d94b6-162">Implementing ConvertFrom</span></span>

<span data-ttu-id="d94b6-163">Для использования в качестве реализации <xref:System.ComponentModel.TypeConverter> , поддерживающей XAML, метод <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> данного преобразователя должен принимать строку как параметр `value` .</span><span class="sxs-lookup"><span data-stu-id="d94b6-163">To be usable as a <xref:System.ComponentModel.TypeConverter> implementation that supports XAML, the <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> method for that converter must accept a string as the `value` parameter.</span></span> <span data-ttu-id="d94b6-164">Если строка представлена в допустимом формате и может быть преобразована реализацией <xref:System.ComponentModel.TypeConverter> , возвращаемый объект должен поддерживать приведение к типу, ожидаемому свойством.</span><span class="sxs-lookup"><span data-stu-id="d94b6-164">If the string is in a valid format and can be converted by the <xref:System.ComponentModel.TypeConverter> implementation, the returned object must support a cast to the type that is expected by the property.</span></span> <span data-ttu-id="d94b6-165">В противном случае реализация <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> должна возвращать `null`.</span><span class="sxs-lookup"><span data-stu-id="d94b6-165">Otherwise, the <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> implementation must return `null`.</span></span>

<span data-ttu-id="d94b6-166">Каждая реализация <xref:System.ComponentModel.TypeConverter> может однозначно интерпретировать допустимую строку для преобразования, а также может использовать или игнорировать описание типа или контекст языка, переданного в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="d94b6-166">Each <xref:System.ComponentModel.TypeConverter> implementation can uniquely interpret what constitutes a valid string for a conversion, and it can also use or ignore the type description or culture contexts that are passed as parameters.</span></span> <span data-ttu-id="d94b6-167">Однако обработка XAML в WPF может не передавать значения в контекст описания типа во всех случаях, а также может не передавать язык на основе `xml:lang`.</span><span class="sxs-lookup"><span data-stu-id="d94b6-167">However, the WPF XAML processing might not pass values to the type description context in all cases and also might not pass culture based on `xml:lang`.</span></span>

> [!NOTE]
> <span data-ttu-id="d94b6-168">Не используйте скобки{}(), в частности, открытие скобки (я), в качестве элемента вашего формата строки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-168">Do not use the braces ({}), specifically the opening brace ({), as an element of your string format.</span></span> <span data-ttu-id="d94b6-169">Эти символы зарезервированы как вход и выход для последовательности расширения разметки.</span><span class="sxs-lookup"><span data-stu-id="d94b6-169">These characters are reserved as the entry and exit for a markup extension sequence.</span></span>

<span data-ttu-id="d94b6-170">Целесообразно выбросить исключение, когда конвертер вашего типа должен иметь доступ к службе XAML <xref:System.IServiceProvider.GetService%2A> от автора объектов .NET XAML Services, но вызов, который выполняется в контексте, не возвращает эту службу.</span><span class="sxs-lookup"><span data-stu-id="d94b6-170">It is appropriate to throw an exception when your type converter must have access to a XAML service from .NET XAML Services object writer, but the <xref:System.IServiceProvider.GetService%2A> call that is made against the context does not return that service.</span></span>

### <a name="implementing-convertto"></a><span data-ttu-id="d94b6-171">Реализация ConvertTo</span><span class="sxs-lookup"><span data-stu-id="d94b6-171">Implementing ConvertTo</span></span>

<span data-ttu-id="d94b6-172"><xref:System.ComponentModel.TypeConverter.ConvertTo%2A> может использоваться для поддержки сериализации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-172"><xref:System.ComponentModel.TypeConverter.ConvertTo%2A> is potentially used for serialization support.</span></span> <span data-ttu-id="d94b6-173">Поддержка сериализации с помощью <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> для пользовательского типа и его преобразователя типов не обязательна.</span><span class="sxs-lookup"><span data-stu-id="d94b6-173">Serialization support through <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> for your custom type and its type converter is not an absolute requirement.</span></span> <span data-ttu-id="d94b6-174">Тем не менее, при реализации элемента управления или использовании сериализации как часть функций или класса, необходимо реализовать <xref:System.ComponentModel.TypeConverter.ConvertTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-174">However, if you are implementing a control, or using serialization of as part of the features or design of your class, you should implement <xref:System.ComponentModel.TypeConverter.ConvertTo%2A>.</span></span>

<span data-ttu-id="d94b6-175">Для использования в качестве реализации <xref:System.ComponentModel.TypeConverter> , поддерживающей XAML, метод <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> данного преобразователя должен принимать экземпляр поддерживаемого типа (или значение) как параметр `value` .</span><span class="sxs-lookup"><span data-stu-id="d94b6-175">To be usable as a <xref:System.ComponentModel.TypeConverter> implementation that supports XAML, the <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> method for that converter must accept an instance of the type (or a value) that is supported as the `value` parameter.</span></span> <span data-ttu-id="d94b6-176">Если тип параметра `destinationType` — тип <xref:System.String>, возвращаемый объект должен иметь возможность приведения к <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-176">When the `destinationType` parameter is of type <xref:System.String>, the returned object must be able to be cast as <xref:System.String>.</span></span> <span data-ttu-id="d94b6-177">Возвращаемая строка должна представлять сериализованное значение `value`.</span><span class="sxs-lookup"><span data-stu-id="d94b6-177">The returned string must represent a serialized value of `value`.</span></span> <span data-ttu-id="d94b6-178">В идеальном случае выбранный формат сериализации должен позволять создавать то же значение, как и при передаче строки реализации <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> того же преобразователя без значительной потери информации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-178">Ideally, the serialization format that you choose should be able to generate the same value as if that string were passed to the <xref:System.ComponentModel.TypeConverter.ConvertFrom%2A> implementation of the same converter, without significant loss of information.</span></span>

<span data-ttu-id="d94b6-179">Если значение не может быть сериализовано или преобразователь не поддерживает сериализацию, реализация <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> должна возвращать `null` и может вызывать исключение.</span><span class="sxs-lookup"><span data-stu-id="d94b6-179">If the value cannot be serialized or the converter does not support serialization, the <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> implementation must return `null` and can throw an exception.</span></span> <span data-ttu-id="d94b6-180">Однако при создании исключений, следует сообщать о невозможности использовать это преобразование в вашей реализации <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> , поэтому рекомендуется проверять с помощью <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> , чтобы предотвратить исключения.</span><span class="sxs-lookup"><span data-stu-id="d94b6-180">However, if you do throw exceptions, you should report the inability to use that conversion as part of your <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> implementation so that the best practice of checking with <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> first to avoid exceptions is supported.</span></span>

<span data-ttu-id="d94b6-181">Если параметр `destinationType` не относится к типу <xref:System.String>, можно выбрать собственную обработку преобразователя.</span><span class="sxs-lookup"><span data-stu-id="d94b6-181">If the `destinationType` parameter is not of type <xref:System.String>, you can choose your own converter handling.</span></span> <span data-ttu-id="d94b6-182">Как правило, вы возвращаетесь к базовой обработке реализации, которая с помощью <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> вызывает определенное исключение.</span><span class="sxs-lookup"><span data-stu-id="d94b6-182">Typically, you revert to base implementation handling, which in the base <xref:System.ComponentModel.TypeConverter.ConvertTo%2A> raises a specific exception.</span></span>

<span data-ttu-id="d94b6-183">Целесообразно выбросить исключение, когда конвертер вашего типа должен иметь доступ к службе XAML <xref:System.IServiceProvider.GetService%2A> от автора объектов .NET XAML Services, но вызов, который выполняется в контексте, не возвращает эту службу.</span><span class="sxs-lookup"><span data-stu-id="d94b6-183">It is appropriate to throw an exception when your type converter must have access to a XAML service from .NET XAML Services object writer, but the <xref:System.IServiceProvider.GetService%2A> call that is made against the context does not return that service.</span></span>

### <a name="implementing-canconvertfrom"></a><span data-ttu-id="d94b6-184">Реализация CanConvertFrom</span><span class="sxs-lookup"><span data-stu-id="d94b6-184">Implementing CanConvertFrom</span></span>

<span data-ttu-id="d94b6-185">Ваша реализация <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A> должна возвращать `true` для `sourceType` типа <xref:System.String> , а в противном случае обращаться к базовой реализации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-185">Your <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A> implementation should return `true` for `sourceType` of type <xref:System.String> and otherwise, defer to the base implementation.</span></span> <span data-ttu-id="d94b6-186">Не вызывайте исключения из <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-186">Do not throw exceptions from <xref:System.ComponentModel.TypeConverter.CanConvertFrom%2A>.</span></span>

### <a name="implementing-canconvertto"></a><span data-ttu-id="d94b6-187">Реализация CanConvertTo</span><span class="sxs-lookup"><span data-stu-id="d94b6-187">Implementing CanConvertTo</span></span>

<span data-ttu-id="d94b6-188">Ваша реализация <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> должна возвращать `true` для `destinationType` типа <xref:System.String>, а в противном случае обращаться к базовой реализации.</span><span class="sxs-lookup"><span data-stu-id="d94b6-188">Your <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A> implementation should return `true` for `destinationType` of type <xref:System.String>, and otherwise defer to the base implementation.</span></span> <span data-ttu-id="d94b6-189">Не вызывайте исключения из <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="d94b6-189">Do not throw exceptions from <xref:System.ComponentModel.TypeConverter.CanConvertTo%2A>.</span></span>

## <a name="applying-the-typeconverterattribute"></a><span data-ttu-id="d94b6-190">Применение TypeConverterAttribute</span><span class="sxs-lookup"><span data-stu-id="d94b6-190">Applying the TypeConverterAttribute</span></span>

<span data-ttu-id="d94b6-191">Для того, чтобы конвертер пользовательского типа использовался в качестве преобразователя типа действия <xref:System.ComponentModel.TypeConverterAttribute> для пользовательского класса службами .NET XAML, необходимо применить его к определению класса.</span><span class="sxs-lookup"><span data-stu-id="d94b6-191">For your custom type converter to be used as the acting type converter for a custom class by .NET XAML Services, you must apply the <xref:System.ComponentModel.TypeConverterAttribute> to your class definition.</span></span> <span data-ttu-id="d94b6-192">Имя <xref:System.ComponentModel.TypeConverterAttribute.ConverterTypeName%2A> , указываемое в атрибуте, должно быть именем типа пользовательского преобразователя типов.</span><span class="sxs-lookup"><span data-stu-id="d94b6-192">The <xref:System.ComponentModel.TypeConverterAttribute.ConverterTypeName%2A> that you specify through the attribute must be the type name of your custom type converter.</span></span> <span data-ttu-id="d94b6-193">Если этот атрибут применяется, обработчик XAML может передать строки и вернуть экземпляры объекта, когда он обрабатывает значения, в которых тип свойства применяет тип пользовательского класса.</span><span class="sxs-lookup"><span data-stu-id="d94b6-193">If you apply this attribute, when a XAML processor handles values where the property type uses your custom class type, it can input strings and return object instances.</span></span>

<span data-ttu-id="d94b6-194">Вы также можете предоставить преобразователь типов для отдельных свойств.</span><span class="sxs-lookup"><span data-stu-id="d94b6-194">You can also provide a type converter on a per-property basis.</span></span> <span data-ttu-id="d94b6-195">Вместо того, <xref:System.ComponentModel.TypeConverterAttribute> чтобы применять определение класса, примените его к определению свойства (основное определение, а не `get` / `set` реализации в нем).</span><span class="sxs-lookup"><span data-stu-id="d94b6-195">Instead of applying a <xref:System.ComponentModel.TypeConverterAttribute> to the class definition, apply it to a property definition (the main definition, not the `get`/`set` implementations within it).</span></span> <span data-ttu-id="d94b6-196">Тип свойства должен соответствовать типу, который обрабатывается пользовательским преобразователем типов.</span><span class="sxs-lookup"><span data-stu-id="d94b6-196">The type of the property must match the type that is processed by your custom type converter.</span></span> <span data-ttu-id="d94b6-197">Если этот атрибут применяется, обработчик XAML может обработать входные строки и вернуть экземпляры объекта при работе со значениями этого свойства.</span><span class="sxs-lookup"><span data-stu-id="d94b6-197">With this attribute applied, when a XAML processor handles values of that property, it can process input strings and return object instances.</span></span> <span data-ttu-id="d94b6-198">Метод конвертера типа в свойстве полезен, если вы решите использовать тип свойств из Microsoft .NET Framework <xref:System.ComponentModel.TypeConverterAttribute> или из какой-либо другой библиотеки, где вы не можете контролировать определение класса и не можете применить его.</span><span class="sxs-lookup"><span data-stu-id="d94b6-198">The per-property type converter technique is useful if you choose to use a property type from Microsoft .NET Framework or from some other library where you cannot control the class definition and cannot apply a <xref:System.ComponentModel.TypeConverterAttribute> there.</span></span>

<span data-ttu-id="d94b6-199">Чтобы реализовать поведение преобразования типов для пользовательского присоединенного члена, примените <xref:System.ComponentModel.TypeConverterAttribute> к методу доступа `Get` шаблона реализации присоединенного члена.</span><span class="sxs-lookup"><span data-stu-id="d94b6-199">To supply a type conversion behavior for a custom attached member, apply <xref:System.ComponentModel.TypeConverterAttribute> to the `Get` accessor method of the implementation pattern for the attached member.</span></span>

## <a name="accessing-service-provider-context-from-a-markup-extension-implementation"></a><span data-ttu-id="d94b6-200">Доступ к контексту поставщика службы из реализации расширения разметки</span><span class="sxs-lookup"><span data-stu-id="d94b6-200">Accessing Service Provider Context from a Markup Extension Implementation</span></span>

<span data-ttu-id="d94b6-201">Доступные службы одинаковы для всех преобразователей значений.</span><span class="sxs-lookup"><span data-stu-id="d94b6-201">The available services are the same for any value converter.</span></span> <span data-ttu-id="d94b6-202">Разница заключается в том, как преобразователь значения получает контекст службы.</span><span class="sxs-lookup"><span data-stu-id="d94b6-202">The difference is in how each value converter receives the service context.</span></span> <span data-ttu-id="d94b6-203">Доступ к службам и предоставляемые службы описаны в разделе [Type Converters and Markup Extensions for XAML](type-converters-and-markup-extensions.md).</span><span class="sxs-lookup"><span data-stu-id="d94b6-203">Accessing services and the services available are documented in the topic [Type Converters and Markup Extensions for XAML](type-converters-and-markup-extensions.md).</span></span>

## <a name="type-converters-in-the-xaml-node-stream"></a><span data-ttu-id="d94b6-204">Преобразователи значений в потоке узлов XAML</span><span class="sxs-lookup"><span data-stu-id="d94b6-204">Type Converters in the XAML Node Stream</span></span>

<span data-ttu-id="d94b6-205">При работе с потоком узлов XAML действие преобразователя типов еще не выполнено (или результат не достигнут).</span><span class="sxs-lookup"><span data-stu-id="d94b6-205">If you are working with a XAML node stream, the action or end result of a type converter is not yet executed.</span></span> <span data-ttu-id="d94b6-206">В пути загрузки строка атрибута, которой со временем потребуется преобразовать для загрузки, остается текстовым значением в пределах начального и конечного элемента.</span><span class="sxs-lookup"><span data-stu-id="d94b6-206">In a load path, the attribute string that eventually needs to be type-converted in order to load remains as a text value within a start member and end member.</span></span> <span data-ttu-id="d94b6-207">Преобразователь типов, который потребуется для этой операции, можно определить с помощью свойства <xref:System.Xaml.XamlMember.TypeConverter%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="d94b6-207">The type converter that is eventually needed for this operation can be determined by using the <xref:System.Xaml.XamlMember.TypeConverter%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="d94b6-208">Однако для получения допустимого значения из <xref:System.Xaml.XamlMember.TypeConverter%2A?displayProperty=nameWithType> необходим контекст схемы XAML, который может получить доступ к такой информации через базовый член, или тип объектного значения, используемого этим членом.</span><span class="sxs-lookup"><span data-stu-id="d94b6-208">However, obtaining a valid value from <xref:System.Xaml.XamlMember.TypeConverter%2A?displayProperty=nameWithType> relies on having a XAML schema context, which can access such information through the underlying member, or the type of the object value that the member uses.</span></span> <span data-ttu-id="d94b6-209">Для вызова преобразования типов также необходим контекст схемы XAML, так как для этого требуется сопоставление типов и создание экземпляра преобразователя.</span><span class="sxs-lookup"><span data-stu-id="d94b6-209">Invoking the type conversion behavior also requires the XAML schema context because that requires type-mapping and creating a converter instance.</span></span>

## <a name="see-also"></a><span data-ttu-id="d94b6-210">См. также</span><span class="sxs-lookup"><span data-stu-id="d94b6-210">See also</span></span>

- <xref:System.ComponentModel.TypeConverterAttribute>
- [<span data-ttu-id="d94b6-211">Преобразователи типов или расширения разметки для XAML</span><span class="sxs-lookup"><span data-stu-id="d94b6-211">Type Converters and Markup Extensions for XAML</span></span>](type-converters-and-markup-extensions.md)
- [<span data-ttu-id="d94b6-212">Обзор XAML (WPF)</span><span class="sxs-lookup"><span data-stu-id="d94b6-212">XAML Overview (WPF)</span></span>](../fundamentals/xaml.md)
