---
title: Определение ресурсов XAML
description: Сведения о ресурсах XAML в WPF для .NET Core. Ознакомьтесь с общими сведениями о типах ресурсов XAML и узнайте, как определять ресурсы XAML.
author: adegeo
ms.author: adegeo
ms.date: 08/21/2019
ms.openlocfilehash: f8eaf3fd931aa6804b0b9a9c19c6bcc042678ebf
ms.sourcegitcommit: dc2feef0794cf41dbac1451a13b8183258566c0e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/24/2020
ms.locfileid: "85325710"
---
# <a name="overview-of-xaml-resources"></a>Общие сведения о ресурсах XAML

Ресурс — это объект, который можно повторно использовать в разных местах в приложении. Примерами ресурсов являются кисти и стили. В этой статье описываются общие сведения об использовании ресурсов в XAML. Вы также можете создать ресурсы и получать к ним доступ с помощью кода.

> [!NOTE]
> Ресурсы XAML, описанные в этой статье, отличаются от *ресурсов приложения*, которые обычно добавляются в приложение в форме файлов, например содержимое, данные или внедренные файлы.

<!-- TODO: File redirect from docs\framework\wpf\advanced\xaml-resources.md -->

[!INCLUDE [desktop guide under construction](../../../includes/desktop-guide-preview-note.md)]

## <a name="using-resources-in-xaml"></a>Использование ресурсов в XAML

В приведенном ниже примере определяется <xref:System.Windows.Media.SolidColorBrush> в качестве ресурса для корневого элемента страницы. Затем этот пример ссылается на ресурс и использует его для того, чтобы задать свойства нескольких дочерних элементов, в том числе <xref:System.Windows.Shapes.Ellipse>, <xref:System.Windows.Controls.TextBlock>и <xref:System.Windows.Controls.Button>.

[!code-xaml[FEResourceSH_snip#XAML](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page1.xaml#xaml)]

Каждый элемент уровня платформы (<xref:System.Windows.FrameworkElement> или <xref:System.Windows.FrameworkContentElement>) имеет свойство <xref:System.Windows.FrameworkElement.Resources%2A>, которое представляет собой тип <xref:System.Windows.ResourceDictionary>, содержащий определенные ресурсы. Вы можете определить ресурсы в любом элементе, например <xref:System.Windows.Controls.Button>. Однако наиболее часто ресурсы определяются в корневом элементе, которым в примере является <xref:System.Windows.Controls.Page>.

Каждый ресурс в словаре ресурсов должен иметь уникальный ключ. При определении ресурсов в разметке уникальный ключ назначается с помощью [директивы x:Key](../xaml-services/xkey-directive.md). Как правило, ключ является строкой. Однако можно задать его как другой тип объекта с помощью соответствующих расширений разметки. Нестроковые ключи для ресурсов используются в определенных функциональных областях WPF, в частности в стилях, ресурсах компонентов и стилях данных.

Вы можете использовать определенный ресурс с синтаксисом расширения разметки ресурса, который указывает имя ключа ресурса. Например, используйте ресурс в качестве значения свойства другого элемента.

[!code-xaml[FEResourceSH_snip#KeyNameUsage](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page2.xaml#keynameusage)]

В предыдущем примере, когда загрузчик XAML обрабатывает значение `{StaticResource MyBrush}` для свойства <xref:System.Windows.Controls.Control.Background%2A> в <xref:System.Windows.Controls.Button>, логика подстановки ресурсов сначала проверяет словарь ресурсов для элемента <xref:System.Windows.Controls.Button>. Если <xref:System.Windows.Controls.Button> не имеет определения ключа ресурса `MyBrush` (в этом примере не имеет; коллекция ресурсов пуста), логика подстановки проверяет родительский элемент <xref:System.Windows.Controls.Button>, которым является <xref:System.Windows.Controls.Page>. При определении ресурса в корневом элементе <xref:System.Windows.Controls.Page> все элементы в логическом дереве <xref:System.Windows.Controls.Page> могут получить к нему доступ. Вы можете повторно использовать тот же ресурс для задания значения любого свойства, которое принимает тот же представляемый ресурсом тип. В предыдущем примере один и тот же ресурс `MyBrush` задает два разных свойства: свойство <xref:System.Windows.Controls.Control.Background%2A> типа <xref:System.Windows.Controls.Button> и свойство <xref:System.Windows.Shapes.Shape.Fill%2A> типа <xref:System.Windows.Shapes.Rectangle>.

## <a name="static-and-dynamic-resources"></a>Статические и динамические ресурсы

Ресурс может использоваться как статический или динамический ресурс. Ссылки создаются с помощью [расширения разметки StaticResource](../../framework/wpf/advanced/staticresource-markup-extension.md) или [расширения разметки DynamicResource](../../framework/wpf/advanced/dynamicresource-markup-extension.md). Расширение разметки — это функция XAML, с помощью которой можно задать ссылку на объект путем обработки строки атрибута расширением разметки и возврата объекта загрузчику XAML. Дополнительные сведения о поведении расширения разметки и WPF XAML см. в [этой статье](../../framework/wpf/advanced/markup-extensions-and-wpf-xaml.md).

При использовании расширения разметки обычно предоставляют один или несколько параметров в виде строки. Они обрабатываются этим расширением разметки. [Расширение разметки StaticResource](../../framework/wpf/advanced/staticresource-markup-extension.md) обрабатывает ключ путем поиска для него значения во всех доступных словарях ресурсов. Обработка происходит во время загрузки, когда для процесса загрузки необходимо присвоить значение свойства. Вместо этого [расширение разметки DynamicResource](../../framework/wpf/advanced/dynamicresource-markup-extension.md) обрабатывает ключ путем создания выражения, которое остается необработанным до тех пор, пока приложение не будет запущено. В этот момент выражение вычисляется и получается значение.

Приведенные ниже соображения могут повлиять на выбор использования ссылки на статический или динамический ресурс.

- При определении общей структуры создания ресурсов для приложения (постранично, в приложении, в свободном XAML или в сборке, содержащей только ресурсы) учитывайте следующее:

- Функциональные возможности приложения. Выполняется ли обновление ресурсов в режиме реального времени в рамках требований вашего приложения?
- Соответствующее поведение подстановки этого ссылочного типа ресурса.
- Конкретное свойство или тип ресурса и собственное поведение этих типов.

## <a name="static-resources"></a>Статические ресурсы

Ссылки на статические ресурсы лучше всего использовать в указанных ниже случаях.

- Когда структура приложения концентрирует большую часть его ресурсов в словарях ресурсов уровня страницы или приложения. Ссылки на статические ресурсы не обрабатываются повторно на основе поведения среды выполнения, например при перезагрузке страницы. Поэтому можно получить некоторое преимущество в производительности, если избегать большого количества ссылок на динамические ресурсы, когда согласно структуре ресурсов и приложения в них нет необходимости.

- Когда вы устанавливаете значение свойства, не являющегося <xref:System.Windows.DependencyObject> или <xref:System.Windows.Freezable>.

- При создании словаря ресурсов, который будет скомпилирован в DLL и либо упакован как часть приложения, либо совместно использоваться приложениями.

- При создании темы для пользовательского элемента управления и определении ресурсов, используемых в темах. В этом случае обычно не требуется подстановка ссылок на динамические ресурсы. Вместо этого требуется подстановка ссылок на статические ресурсы, чтобы подстановка была прогнозируемой и самодостаточной для темы. При использовании ссылки на динамический ресурс даже ссылка в теме остается необработанной до времени выполнения и есть вероятность того, что при применении темы некоторые локальные элементы переопределят ключ, на который тема пытается сослаться, и локальный элемент окажется перед темой при подстановке. Если такое случится, тема будет работать не так, как ожидалось.

- При использовании ресурсов для задания большого количества свойств зависимостей. Свойства зависимостей обладают эффективным кэшированием значений, обеспечиваемым системой свойств, поэтому, если предоставить свойству зависимости значение, которое может быть вычислено во время загрузки, свойству не потребуется проверять пересчитанное выражение и оно сможет вернуть последнее фактическое значение. Этот метод может обеспечить выигрыш в производительности.

- Необходимо изменить базовый ресурс для всех объектов-получателей либо поддерживать отдельные записываемые экземпляры для каждого объекта-получателя с помощью [атрибута x:Shared](../xaml-services/xshared-attribute.md).

### <a name="static-resource-lookup-behavior"></a>Поведение подстановки статического ресурса

Ниже описан процесс подстановки, который выполняется автоматически при ссылке на статический ресурс с помощью свойства или элемента.

01. Процесс подстановки ищет запрошенный ключ в словаре ресурсов, определенном элементом, который устанавливает это свойство.

01. Затем процесс подстановки обходит логическое дерево снизу вверх до родительского элемента и его словаря ресурсов. Этот процесс продолжается до тех пор, пока не будет достигнут корневой элемент.

01. Проверяются ресурсы приложения. Ресурсы приложения — это ресурсы в словаре ресурсов, которые определены с помощью объекта <xref:System.Windows.Application> для приложения WPF.

Ссылки на статический ресурс из словаря ресурсов должны указывать на ресурс, уже определенный лексически до ссылки на ресурс. Опережающие ссылки не могут быть разрешены ссылкой на статический ресурс. По этой причине разработайте структуру словаря ресурсов таким образом, чтобы ресурсы определялись в начале каждого соответствующего словаря ресурсов или рядом с ним.

Подстановку статических ресурсов можно расширить в темы или в системные ресурсы, но это поддерживается только потому, что загрузчик XAML задерживает запрос. Задержка необходима, чтобы тема среды выполнения в момент загрузки страницы правильно применялась к приложению. Однако не рекомендуется использовать ссылки на статические ресурсы для ключей, которые существуют только в темах или в качестве системных ресурсов, так как такие ссылки не обрабатываются повторно, если тема изменяется пользователем в режиме реального времени. Ссылки на динамические ресурсы более надежны при запросе темы или системных ресурсов. Исключением является случай, когда элемент темы сам запрашивает другой ресурс. Такие ссылки должны быть статическими по причинам, упомянутым выше.

Поведение исключения, если ссылка на статический ресурс не найдена, варьируется. Если ресурс был задержан, то исключение возникнет во время выполнения. Если ресурс не был задержан, исключение возникнет во время загрузки.

## <a name="dynamic-resources"></a>Динамические ресурсы

Динамические ресурсы лучше подходят в нижеуказанных случаях.

- Когда значение ресурса, в том числе системных ресурсов или ресурсов, которые в противном случае устанавливаются пользователем, зависит от условий, которые не известны до времени выполнения. Например, вы можете создать значения метода задания, которые ссылаются на системные свойства, как представлено <xref:System.Windows.SystemColors>, <xref:System.Windows.SystemFonts> или <xref:System.Windows.SystemParameters>. Эти значения являются действительно динамическими, так как они в конечном счете берутся из среды выполнения пользователя и операционной системы. Кроме того, возможны темы уровня приложения, которые могут изменяться, когда при доступе к ресурсу уровня страницы также необходимо отследить изменения.

- При создании стилей темы или ссылки на них для пользовательского элемента управления.

- Когда необходимо настроить содержимое <xref:System.Windows.ResourceDictionary> во время существования приложения.

- Когда имеется сложная структура ресурсов с взаимозависимостями, где могут потребоваться опережающие ссылки. Ссылки на статические ресурсы не поддерживают опережающие ссылки, но ссылки на динамические ресурсы поддерживают их, так как ресурс не нужно пересчитывать до времени выполнения, и опережающие ссылки, таким образом, не имеют значения.

- При ссылке на большой с точки зрения компиляции или рабочего множества ресурс, если он может не использоваться немедленно при загрузке страницы. Ссылки на статические ресурсы всегда загружаются из XAML при загрузке страницы. Однако ссылка на динамический ресурс не загружается до фактического использования.

- При создании стиля, где значения для метода задания могут браться из других значений, на которые влияют темы или другие пользовательские параметры.

- Когда ресурсы применяются к элементам, для которых во время существования приложения может быть изменен порядок наследования в логическом дереве. Изменение родительского элемента также потенциально изменяет область подстановки ресурса, так что, если необходим пересчет ресурса в новой области элемента с измененным порядком наследования, всегда следует использовать ссылку на динамический ресурс.

### <a name="dynamic-resource-lookup-behavior"></a>Поведение подстановки динамического ресурса

Поведение подстановки ресурса для ссылки на динамический ресурс аналогично поведению подстановки в коде при вызове <xref:System.Windows.FrameworkElement.FindResource%2A> или <xref:System.Windows.FrameworkElement.SetResourceReference%2A>.

01. Процесс подстановки ищет запрошенный ключ в словаре ресурсов, определенном элементом, который устанавливает это свойство:

    - если элемент определяет свойство <xref:System.Windows.FrameworkElement.Style%2A>, для свойства <xref:System.Windows.FrameworkElement.Style?displayProperty=fullName> элемента проверяется словарь <xref:System.Windows.Style.Resources>;

    - если элемент определяет свойство <xref:System.Windows.Controls.Control.Template%2A>, проверяется словарь <xref:System.Windows.FrameworkTemplate.Resources?displayProperty=fullName> элемента.

01. Процесс подстановки обходит логическое дерево снизу вверх до родительского элемента и его словаря ресурсов. Этот процесс продолжается до тех пор, пока не будет достигнут корневой элемент.

01. Проверяются ресурсы приложения. Ресурсы приложения — это ресурсы в словаре ресурсов, которые определены с помощью объекта <xref:System.Windows.Application> для приложения WPF.

01. Для текущей активной темы проверяется словарь ресурсов темы. Если тема изменяется во время выполнения, значение будет повторно вычислено.

01. Проверяются системные ресурсы.

Поведение исключения (если таковое имеется) варьируется.

- Если ресурс был запрошен с помощью вызова <xref:System.Windows.FrameworkElement.FindResource%2A> и не найден, возникает исключение.

- Если ресурс был запрошен с помощью вызова <xref:System.Windows.FrameworkElement.TryFindResource%2A> и не найден, исключение не возникает, а возвращаемое значение равно `null`. Если задаваемое свойство не принимает `null`, то по-прежнему возможен вызов исключения более глубокого уровня в зависимости от задания отдельного свойства.

- Если ресурс запрошен по ссылке на динамический ресурс в XAML и не был найден, то поведение зависит от общей системы свойств. Общее поведение таково, как если бы на уровне, где существует ресурс, не произошла операция настройки свойства. Например, при попытке задать фон для отдельного элемента кнопки с помощью ресурса, который не может быть вычислен, не происходит задание значения, но фактическое значение по-прежнему может быть получено от других членов системы свойств и приоритета значения. Например, значение фона может быть по-прежнему получено из локально определенного стиля кнопки или из стиля темы. Для свойств, не определенных стилями темы, после неудавшейся попытки обработки ресурса фактическое значение может быть получено из значения по умолчанию в метаданных свойства.

### <a name="restrictions"></a>Ограничения

Для ссылок на динамические ресурсы есть некоторые важные ограничения. Должно выполняться по крайней мере одно из указанных ниже условий.

- Задаваемое свойство должно быть свойством <xref:System.Windows.FrameworkElement> или <xref:System.Windows.FrameworkContentElement>. Это свойство должно подкрепляться с помощью <xref:System.Windows.DependencyProperty>.

- Ссылка указывает на значение в `StyleSetter`.

- Задаваемое свойство должно быть свойством <xref:System.Windows.Freezable>, которое предоставляется как значение свойства <xref:System.Windows.FrameworkElement> или <xref:System.Windows.FrameworkContentElement> или как значение <xref:System.Windows.Setter>.

Так как задаваемое свойство должно быть свойством <xref:System.Windows.DependencyProperty> или <xref:System.Windows.Freezable>, большинство изменений свойств может распространяться на пользовательский интерфейс, так как изменение свойства (измененное значение динамического ресурса) подтверждается системой свойств. Большая часть элементов управления содержит логику, которая принудительно создаст макет элемента управления, если <xref:System.Windows.DependencyProperty> изменяется и это свойство может повлиять на макет. Однако не все свойства, имеющие [расширение разметки DynamicResource](../../framework/wpf/advanced/dynamicresource-markup-extension.md) в качестве значения, гарантированно предоставляют обновления в пользовательском интерфейсе в режиме реального времени. Функциональные возможности по-прежнему могут отличаться в зависимости от свойства, а также типа, которому принадлежит свойство, или даже логической структуры приложения.

## <a name="styles-datatemplates-and-implicit-keys"></a>Стили, DataTemplates и неявные ключи

Хотя все элементы в <xref:System.Windows.ResourceDictionary> должны иметь ключ, это не значит, что все ресурсы должны иметь явный атрибут `x:Key`. Некоторые типы объектов поддерживают неявный ключ, если он определен как ресурс, где значение ключа связано со значением другого свойства. Этот тип ключа называется неявным ключом, в то время как атрибут `x:Key` является явным ключом. Любой неявный ключ можно перезаписать, указав явный ключ.

Одним очень важным сценарием для ресурсов является определение <xref:System.Windows.Style>. На самом деле <xref:System.Windows.Style> почти всегда определяется как запись в словаре ресурсов, так как стили наследственным образом предназначены для повторного использования. Дополнительные сведения о стилях см. в статье [Стили и шаблоны в WPF](styles-templates-overview.md).

С помощью неявного ключа можно создавать стили для элементов управления либо ссылаться на них. Стили темы, определяющие внешний вид элемента управления по умолчанию, используют этот неявный ключ. Неявный ключ с точки зрения запроса представляет тип <xref:System.Type> самого элемента управления. С точки зрения определения ресурсов неявным ключом является <xref:System.Windows.Style.TargetType%2A> стиля. Таким образом, если вы создаете темы для пользовательских элементов управления, создавая стили, которые взаимодействуют с существующими стилями темы, нет необходимости задавать [директиву x:Key](../xaml-services/xkey-directive.md) для этого стиля <xref:System.Windows.Style>. А если требуется использовать стили из тем, то вообще не нужно задавать стиль. Например, следующее определение стиля работает, даже если ресурс <xref:System.Windows.Style> не имеет ключа:

[!code-xaml[FEResourceSH_snip#ImplicitStyle](~/samples/snippets/csharp/VS_Snippets_Wpf/FEResourceSH_snip/CS/page2.xaml#implicitstyle)]

У этого стиля на самом деле есть ключ: неявный ключ `typeof(System.Windows.Controls.Button)`. В разметке можно непосредственно указать свойство [ в качестве имени типа (при необходимости можно использовать директиву <xref:System.Windows.Style.TargetType%2A>{x:Type...}](../xaml-services/xtype-markup-extension.md) для возврата <xref:System.Type>.

В механизмах стилей темы по умолчанию, используемых в WPF, этот стиль будет применен как стиль среды выполнения для <xref:System.Windows.Controls.Button> на странице, даже если элемент <xref:System.Windows.Controls.Button> не пытается задать свое свойство <xref:System.Windows.FrameworkElement.Style%2A> или конкретную ссылку на ресурс в качестве стиля. Стиль, определенный на странице, находится в последовательности подстановки раньше, чем стиль словаря темы, и использует тот же ключ, что и стиль словаря темы. Вы можете просто указать `<Button>Hello</Button>` в любом месте на странице, и стиль, определенный с помощью `Button` для <xref:System.Windows.Style.TargetType%2A>, будет применен к этой кнопке. Если требуется, можно по-прежнему явно задать ключ стиля с тем же значением типа, что и для <xref:System.Windows.Style.TargetType%2A>, для ясности в разметке, но это необязательно.

Неявные ключи для стилей не применяются к элементу управления, если <xref:System.Windows.FrameworkElement.OverridesDefaultStyle%2A> равно `true`. (Также обратите внимание, что <xref:System.Windows.FrameworkElement.OverridesDefaultStyle%2A> можно может быть задан как часть собственного поведения для класса элементов управления, а не явным образом в экземпляре элемента управления.) Кроме того, чтобы поддерживать неявные ключи для сценариев производных классов, элемент управления должен переопределить <xref:System.Windows.FrameworkElement.DefaultStyleKey%2A> (все существующие элементы управления, предоставляемые как часть WPF, выполняют переопределение). Дополнительные сведения о стилях, темах и разработке элементов управления см. в статье [Рекомендации по разработке элементов управления с возможностью использования стилей](../../framework/wpf/controls/guidelines-for-designing-stylable-controls.md).

<xref:System.Windows.DataTemplate> также имеет неявный ключ. Неявным ключом для <xref:System.Windows.DataTemplate> является значение свойства <xref:System.Windows.DataTemplate.DataType%2A>. <xref:System.Windows.DataTemplate.DataType%2A> также можно задать как имя типа вместо явного использования [{x:Type...}](../xaml-services/xtype-markup-extension.md). Дополнительные сведения см. в статье [Общие сведения о шаблонах данных](../../framework/wpf/data/data-templating-overview.md).

## <a name="see-also"></a>См. также

- <xref:System.Windows.ResourceDictionary>
- [Ресурсы приложений](../../framework/wpf/advanced/optimizing-performance-application-resources.md)
- [Ресурсы и код](../../framework/wpf/advanced/resources-and-code.md)
- [Определение и создание ссылки на ресурс](../../framework/wpf/advanced/how-to-define-and-reference-a-resource.md)
- [Общие сведения об управлении приложением](../../framework/wpf/app-development/application-management-overview.md)
- [Расширение разметки x:Type](../xaml-services/xtype-markup-extension.md)
- [Расширение разметки StaticResource](../../framework/wpf/advanced/staticresource-markup-extension.md)
- [Расширение разметки DynamicResource](../../framework/wpf/advanced/dynamicresource-markup-extension.md)
