---
ms.openlocfilehash: 0237c848d71150aaea1f9de4f4b16a0cbbc4ab3a
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2020
ms.locfileid: "85615749"
---
### <a name="new-64-bit-jit-compiler-in-the-net-framework-46"></a>Новый 64-разрядный JIT-компилятор в .NET Framework 4.6

#### <a name="details"></a>Подробнее

Начиная с .NET Framework 4.6, для JIT-компиляции используется новый 64-разрядный компилятор JIT. В некоторых случаях вызывается непредвиденное исключение или наблюдается другое поведение, отличное от поведения при выполнении приложения с использованием 32-разрядного компилятора или старого 64-разрядного JIT-компилятора. Это изменение не влияет на 32-разрядный компилятор JIT. Известные различия включают в себя следующее.

- При определенных условиях операция распаковки может вызывать исключение <xref:System.NullReferenceException> в сборках выпусков с включенной оптимизацией.
- В некоторых случаях выполнение рабочего кода в большом теле метода может вызывать исключение <xref:System.StackOverflowException>.
- При определенных условиях в сборках выпусков передаваемые методу структуры обрабатываются как ссылочные типы, а не типы значений. Одним из проявлений этой проблемы является отображение отдельных элементов коллекции в непредвиденном порядке.
- При определенных условиях сравнение значений <xref:System.UInt16> с установленным старшим битом выполняется неверно, если включена оптимизация.
- При определенных условиях, особенно при инициализации значений массивов, инициализация памяти инструкцией <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> IL может инициализировать память неправильным значением. Это может привести либо к необработанному исключению, либо к неправильным выходным данным.
- В некоторых редких случаях условная поразрядная проверка может возвращать неверное значение типа <xref:System.Boolean> или вызывать исключение, если включены оптимизации компилятора.
- При определенных условиях, если инструкция `if` используется для проверки условия перед входом в блок `try` и на выходе из блока `try`, и такое же условие вычисляется в блоке `catch` или `finally`, новый 64-разрядный JIT-компилятор удаляет условие `if` из блока `catch` или `finally` при оптимизации кода. В результате код внутри инструкции `if` в блоке `catch` или `finally` выполняется безусловно.

#### <a name="suggestion"></a>Предложение

**Устранение известных проблем** <br/> При возникновении перечисленных выше проблем их можно решить, выполнив одно из следующих действий.

- Обновление до .NET Framework 4.6.2. Новый 64-разрядный компилятор, входящий в состав .NET Framework 4.6.2, устраняет все эти известные проблемы.
- Обновление Windows до актуального состояния при запуске Центра обновления Windows. Обновления служб до .NET Framework 4.6 и 4.6.1 решают все эти проблемы, кроме исключения <xref:System.NullReferenceException> при распаковке-преобразовании.
- Компиляция с помощью старого 64-разрядного JIT-компилятора. Дополнительные сведения о том, как это сделать, см. в разделе **Устранение других проблем**.
**Устранение других проблем** <br/> При возникновении любых других различий в поведении между кодом, скомпилированным с помощью старого и нового 64-разрядных JIT-компиляторов, или между отладочной и окончательной версиями приложения, которые обе скомпилированы новым 64-разрядным JIT-компилятором, можно выполнить следующие действия для компиляции приложения с помощью старого 64-разрядного JIT-компилятора.

- Для каждого отдельного приложения можно добавить элемент [<](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) в файл конфигурации приложения. Следующее действие отключает компиляцию с помощью нового 64-разрядного JIT-компилятора и вместо этого использует устаревший 64-разрядный JIT-компилятор.

    ```xml
    <?xml version ="1.0"?>
    <configuration>
      <runtime>
       <useLegacyJit enabled="1" />
      </runtime>
    </configuration>
    ```

- Для каждого отдельного пользователя можно добавить значение `REG_DWORD` с именем `useLegacyJit` в раздел реестра `HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework`. Значение 1 включает устаревший 64-разрядный JIT-компилятор; значение 0 отключает его и включает новый 64-разрядный JIT-компилятор.
- Для каждого отдельного компьютера можно добавить значение `REG_DWORD` с именем `useLegacyJit` в раздел реестра `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework`. Значение `1` включает устаревший 64-разрядный JIT-компилятор; значение `0` отключает его и включает новый 64-разрядный JIT-компилятор.
Можно также сообщить нам об обнаруженной проблеме, обратившись в службу [Microsoft Connect](https://connect.microsoft.com/VisualStudio).

| name    | Значение       |
|:--------|:------------|
| Область   | Пограничный случай        |
| Version | 4.6         |
| Type    | Изменение целевой платформы |
